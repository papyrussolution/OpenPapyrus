% PPMANUAL.TEX
% Copyright (c) A.Sobolev 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018, 2019
% Part of project Papyrus
% Руководство пользователя
%

%ppyl2h:

\documentclass[nobib]{papyrus}
\usepackage{index}
\makeindex
%\usepackage{makeidx}
%
% Титульный лист {
%
\usepackage{CoverPage}

\CoverPageSetup{
	title={Papyrus},
	author={},
	copyright={\copyright Петроглиф},
	institute={},
	insource={Руководство пользователя}
}

\renewcommand{\CoverPageFooterInfo}{
	\parbox[b]{.5\textwidth}{
		\tiny Документ создан: \today \\
		Версия системы: 10.5.3
    }
}

\renewcommand{\CPTitleFont}{\Huge\sffamily}
\renewcommand{\CoverPageHeader}{}%{\includegraphics[width=\textwidth]{\ppy\ctpath/BrushedMetal}}
\renewcommand{\CoverPageFooterLogo}{}%\includegraphics[scale=0.4]{\ppypictpath/petroglif}}
%
% } Титульный лист
%
\usepackage[Bjornstrup]{fncychap}
%\oddsidemargin 0in
%\evensidemargin 0in
%\topmargin 0.1in
%\footskip 0.2in
%\textwidth 6in

%\fontencoding{U}\fontfamily{helvetic}\selectfont
\sloppy
%\raggedright
\setlength{\parskip}{0.5em} % 5pt
\setlength{\parindent}{0pt}
%
% Регулярный фонт теперь будет из семейства Serif (без засечек).
% Если надо, чтобы регулярный фонт был с засечками (Roman), то закомментируйте
% следующую строку.
% Для русских букв почему-то copy-paste текста из шрифта Roman работает не правильно.
%
\renewcommand{\familydefault}{\sfdefault}

\title{
	\huge
	\begin{flushleft}
	Papyrus
	\newline\Large{Руководство пользователя}
	\end{flushleft}
}
\author{
	\Large\copyright Петроглиф
}

%\usepackage[bookmarks]{hyperref}
%\hypersetup{pageref}

\begin{document}
%\makeindex
%\maketitle
\tableofcontents

\chapter{Введение\label{ch-introduce}}

Вашему вниманию предлагается руководство пользователя системы автоматизации предприятий \ppybrand{}.

\ppybrand{} является зрелой системой, разрабатываемой и используемой клиентами в различных областях
деятельности с 1996 года.

Система ориентирована на малые и средние предприятия, работающие в сферах оптовой и розничной торговли,
промышленности, общественного питания и др.
Она предназначена для ведения бухгалтерского и товарного учета на предприятии, а также управления %
персонифицированным учетом. Система удобна в работе, имеет широкие
возможности ввода, хранения и обработки информации, подготовки всевозможной отчетности.

Использовать систему могут  руководители предприятий, экономисты, бухгалтеры, товароведы, кассиры и т.д.
Кроме того, систему можно применять при обучении студентов в Вузах, техникумах, курсах и т.д.

При написании настоящего руководства мы придерживались следующих принципов:
\begin{itemize}
	\item Текст должен быть понятным. Это - самое главное. Мы будем рады любым
	замечаниям и предложениям, призванным улучшить его качество.

	\item При описании различных аспектов использования системы мы пытались
	максимально четко определять ее поведение в том или ином случае.

	Мотивом	для этого принципа выступает необходимость нахождения общего языка между
	разработчиками и пользователями системы. Учитывая сложность и универсальность
	системы, приходится признать, что то или иное ее поведение в разных случаях
	не всегда очевидно, именно по этому, тогда, когда это так, мы старательно
	детализируем это поведение.

	\item Руководство ориентировано на людей, имеющих некоторую подготовку. То есть
	(возможно, к сожалению) нам не удалось сделать его простым. В конце концов
	мы решили, что текст предназначен не столько тем, кто непосредственно использует
	систему, сколько тем, кто ее сопровождает и помогает конечным пользователям
	работать с ней.

	С другой стороны, в некоторых случаях мы включаем в руководство элементы,
	обеспечивающие конечных пользователей подробными инструкциями. К сожалению,
	это не всегда удается из-за большого разнообразия бизнес-процессов в которые
	вовлечены те или иные компоненты системы.

	\item Эта документация пишется в течении многих лет и тем не менее, не
	является завершенным документом. Одной из причин этого является постоянное
	развитие самой системы. В результате мы пришли к тому, что новый функционал
	и изменения в системе описываются с наивысшим приоритетом.

	Следствием сказанного является некоторый \qu{перекос} в описаниях в сторону
	тех модулей и функций, которые развиваются наиболее активно.

	Другое следствие - документация может описывать возможности, которых нет
	в версии системы, используемой вами. На титульном листе книги указаны дата ее последнего
	изменения и номер версии системы, которой соответствует редакция документации,
	находящаяся у вас в руках.
\end{itemize}

\section{Архитектура системы}

В этом разделе мы кратко обрисуем архитектурную схему системы \ppybrand{}.
Целью этого описания является не столько объяснение технических подробностей устройства
системы, сколько ввод некоторых понятий, без которых будет довольно сложно
объяснять многие аспекты функционирования системы и ее использования.

\ppypict{schema-architect}{Схема взаимодействия блоков системы}

Рис.~\ref{pic-schema-architect} представляет составные части архитектуры.
Блоков здесь, как видно, не много, так как мы решили обойтись без лишнего усложнения.

Пойдем по порядку снизу-вверх.

\subsection{Операционная система}

Этот компонент, как нетрудно догадаться, не является частью системы. Тем не менее, он
показан на схеме с целью простой демонстрации того факта, что \ppybrand{} должен
взаимодействовать с операционной системой.

\subsection{СУБД}

Как и операционная система, система управления базами данных (СУБД),
не является частью \ppybrand{}. Опять же, без упоминания этого компонента,
схема была бы не полной.

СУБД выполняет функцию управления данными, не уточняя при этом
специфическую природу этих данных. Этот компонент берет на себя функции
хранения, изменения и выборки данных из хранилища на аппаратном сервере
базы данных.

Саму СУБД часто называют программным сервером базы данных.

Таким образом, если употребляется выражение сервер базы данных, то
оно может означать как аппаратный сервер (компьютер, на котором
располагается база данных), так и программный сервер базы данных (СУБД).

\subsection{Слой SLIB}

Значительный по объему компонент, обеспечивающий низкоуровневую поддержку
для всех остальных модулей системы. Подробности об этом слое совершенно не
важны для дальнейшего изложения.

Скажем лишь, что он обеспечивает функции взаимодействия системы с операционной
системой и унифицирует механизмы работы всех остальных модулей.

\subsection{Слой интерфейса с СУБД}

Этот слой реализует механизмы взаимодействия системы с СУБД. В этом он похож на слой SLIB (только последний, главным образом,
обеспечивает взаимодействие с операционной системой).

Учитывая то, что на уровне использования и настройки системы данный компонент практически невидим, мы и долго задерживаться на нем не станем.

\subsection{Объекты данных\label{sec-ppobject-concept}}

Здесь мы подошли к весьма существенному слою. Объекты данных представлены множеством модулей, построенных на общих принципах и реализующих
логику управления специфическими с точки зрения функционала системы данными.

Как правило, объект данных представляет множество однотипных сущностей, моделирующих нечто во внешнем либо внутреннем окружении предприятия.

Самые простые примеры объектов данных: персоналии, товары, документы.

\ppybrand{} оперирует несколькими десятками объектов данных.

Коль скоро мы упомянули о том, что каждый объект данных представляет множество однотипных сущностей, то определим понятие \ppyterm{экземпляра
объекта данных} или \ppyterm{записи объекта}.

Сам объект данных безотносительно его экземпляров будем называть либо \ppyterm{типом объекта данных}, либо, собственно, \ppyterm{объектом данных}.

\subsubsection{Идентификация объектов данных}

Проблему идентификации объектов данных необходимо обсудить как по терминологическим причинам, так и по причине практической работы с системой.

Суть проблемы в том, что объекты данных могут содержать от нескольких записей до десятков и сотен тысяч (иногда миллионов). Следовательно, как
пользователи, так и сама система должны иметь возможность правильно выбрать одну или несколько требуемых записей из множества.

Требования к процессу выборки самые несложные:
\begin{itemize}
	\item Однозначность - если вы выбираете нечто (скажем, товар) по коду, то вы хотите быть уверены, что система вам выдала запись
	которую вы просили и не получится так, что в следующий раз на такой же запрос система вернет вам другую запись.
	\item Скорость - время на выборку заданного экземпляра объекта данных должно быть предельно малым.
\end{itemize}

В действительности, эти требования порождают ряд сложностей, из-за которых мы и взялись обсуждать вопрос идентификации.

Перечислим возможные универсальные средства идентификации записей объектов данных в системе \ppybrand{}:

\begin{description}
	\item[Идентификатор] Каждой записи объекта данных система присваивает
	числовое значение, которое уникально среди всех записей этого объекта данных
	и не может изменяться с течением времени. Значение этого идентификатора
	не несет никакого смысла, важны лишь указанные два его свойства.

	Важным свойством идентификатора является невозможность управлять
	его значением вручную. То есть система самостоятельно назначает
	новой записи объекта идентификатор, который пользователь не
	имеет возможности изменить.

	В дальнейшем, если требуется сослаться на эту запись, система
	пользуется идентификатором.

	Так, товар знает о единице измерения на основании того факта, что
	в записи этого товара содержится идентификатор единицы измерения (но не
	ее наименование или какие-либо иные атрибуты).
	\item[Наименование] Текстовая строка, по которой пользователь может
	идентифицировать запись объекта. В отличии от идентификатора наименование
	несет в себе смысл, воспринимаемый человеком. Соответственно, и сам
	способ идентификации важен для пользователей, а не для системы.

	Для большинства объектов данных система \qu{насильно} поддерживает
	уникальность наименований записей. То есть пользователь не сможет
	ввести две записи объекта с одинаковым именем. Однако, это верно не
	для всех объектов. Так, персоналии, могут иметь одинаковые имена.
	Это - необходимость, обусловленная тем, что как имена людей, так
	и названия компаний могут дублироваться.

	\item[Символ] Идентификатор и наименование решают большую часть
	проблем с идентификацией записей объектов. Символ экземпляра
	объекта является опциональным средством идентификации (причем
	его поддерживают далеко не все типы объектов данных).

	Назначение символа состоит в том, что он обеспечивает уникальную
	идентификацию записи с помощью короткой строки. Необходимость
	в использовании символов возникает тогда, когда не пригодно
	наименование в силу того, что является весьма длинной строкой,
	которую трудно ввести по памяти либо задокументировать, а
	идентификатор не подходит по причине того, что пользователь не
	имеет возможности управлять его значением.

	Примером идентификации по символу может служить объект данных
	\ppyrsrv{Суммы документов}. Здесь символ используется для того,
	чтобы ссылаться на значения этих сумм в формулах при настройке
	шаблонов проводок по документам (стр.~\pageref{sec-accturntemplate}).

	Другой пример - символ склада. Он часто используется для контекстной
	синхронизации записей складов, созданных независимо в разных
	разделах базы данных (стр.~\pageref{ch-dbxchg}).
\end{description}

Кроме указанных универсальных инструментов идентификации экземпляров
объектов данных существуют специализированные, характерные
для отдельных типов объектов данных.

Самым понятным примером может служить идентификация товаров по
кодам. Для товаров система поддерживает следующие дополнительные
средства идентификации:

\begin{description}
	\item[Номенклатурные коды (штрихкоды)] обеспечивают (опциональный)
	список уникальных кодов, связанных с товаром. Необходимость в
	этих кодах очевидна - кодировка очень часто присваивается товару
	вне пределов предприятия, и каждый код может быть ассоциирован
	с количеством единиц товара. То есть ни один из рассмотренных
	выше стандартных методов идентификации заменить эту кодировку не
	может (идентификатор - не управляемый, символ - один на запись).
	\item[Артикулы] коды аналогичные номенклатурным, но с дополнительным
	условием: каждый артикул может быть связан с каким-либо контрагентом
	предприятия. Уникальность артикулов обеспечивается по сочетанию
	(контрагент - товар - код).

	Опять мы видим, что ни один из стандартных методов (даже дополненных номенклатурными номерами) не способен решить проблему
	столь сложной идентификации.
\end{description}

\subsubsection{Общие черты всех объектов данных}

Объекты данных в \ppybrand{}, несмотря на то, что представляют самые
разнообразные реалии, построены по унифицированной технологии и содержат
набор свойств, который позволяет рассматривать их с общих позиций.

Сначала мы перечислим общие атрибуты всех типов объектов данных, затем
свойства записей объектов и, наконец то, что объекты данных умеют делать.

\paragraph{Общие атрибуты типа объекта данных}

\begin{description}
	\item[Идентификатор типа] зарезервированное значение, закрепленное за каждым объектом данных.
	\item[Наименование типа] зарезервированная текстовая строка, закрепленная за каждым объектом данных.
	\item[Набор прав доступа] список флагов, регламентирующих возможность выполнения пользователем тех
	или иных действий над экземплярами объектов.
	\item[Конфигурация] набор параметров, регулирующих поведение объекта в данной базе данных.
	Конфигурация определена не для всех типов объектов. Как правило, ее имеют объекты наиболее сложных
	типов (например, товары, персоналии, документы).
\end{description}

\paragraph{Общие атрибуты экземпляра объекта данных}

\begin{itemize}
	\item Идентификатор типа
	\item Идентификатор
	\item Наименование
	\item Символ
\end{itemize}

Обратите внимание на то, что все перечисленные атрибуты используются для идентификации записи объекта.

Еще один атрибут \qu{поле флагов} присутствует в записях практически
всех объектов данных. Он используется для установки переключаемых
признаков экземпляров объектов. Само собой, значения каждого
флага в этом поле специфично.

Все остальные атрибуты записей определяются назначением объектов
и будут рассмотрены отдельно в соответствующих разделах.

\paragraph{Общие функции объектов данных}

\begin{description}
	\item[Отображение списка записей] Большинство объектов реализуют
	отображение своих записей посредством контроллеров анализа данных (о них
	речь пойдет ниже).

	В то же время, ряд объектов предоставляет упрощенный сервис
	отображения списка записей через диалог, в котором просто показаны
	наименования записей. В этом случае возможности фильтрации весьма
	ограничены (да они в таких случаях и не важны, поскольку это относится к
	тем типам объектов данных, которые включают не значительное количество записей).

	\item[Создание новой записи] Эта функция поддерживается подавляющим числом
	объектов данных, за исключением небольшого числа специализированных
	объектов, которые формируются автоматически. Примером такого исключения могут
	служить кассовые сессии, которые создаются при открытии кассовой смены либо
	при импорте данных из внешнего кассового модуля.

	\item[Редактирование записи] Функция состоит в изменении существующего
	экземпляра объекта данных.

	Аналогично функции \qu{Создание новой записи}, эта реализована практически
	для всех типов объектов.
	\item[Удаление записи] Как следует из названия, данная функция решает
	задачу удаления экземпляра объекта данных.

	Реализована функция для всех типов объектов.

	Вместе с тем существуют (причем, достаточно часто) причины, не позволяющие
	удалить произвольную запись объекта данных. Самая понятная из этих причин -
	отсутствие прав доступа пользователя на удаление записей объектов (впрочем,
	это соображение справедливо и для других функций объектов данных).

	Другая причина - наличие экземпляров иных объектов данных, ссылающихся на
	тот, который пользователь хочет удалить. Например, если предпринимается попытка
	удаления товара, то система проверяет нет ли документов, в которых этот товар
	используется. Если есть, то операция по удалению товара блокируется с
	соответствующим сообщением об ошибке.

	\item[Передача в другой раздел базы данных] Тема синхронизации данных между
	удаленными разделами рассматривается в главе \ref{ch-dbxchg}.

	Здесь мы только заметим, что большинство типов объектов данных
	предоставляют сервис независимой передачи в другие разделы. Несмотря на то,
	что явно этими функциями пользуются редко, они оказываются крайне полезными
	в некоторых случаях.
	\item[Объединение двух записей] Функция состоит в том, что все ссылки в базе
	данных с одного экземпляра объекта переносятся на другой с целью
	удаления первого (что и осуществляется этой функцией, но после запроса
	подтверждения от пользователя).

	Смысл этой операции заключается в устранении дубликатов записей, возникших
	из-за невнимательности сотрудников.

	Функция поддерживается многими, но далеко не всеми типами объектов данных.

	Существует специальный флаг в правах доступа, регламентирующий возможность
	выполнения объединения записей конкретными пользователями.
	\item[Ограничение прав доступа, регламентированное правами пользователя]
	Для всех типов объектов данных существует функция регламента прав доступа.
	Базовый набор прав состоит из следующих флагов:
	\begin{itemize}
		\item \dlgflag{Просмотр}
		\item \dlgflag{Создание}
		\item \dlgflag{Модификация}
		\item \dlgflag{Удаление}
		\item \dlgflag{Админ}
	\end{itemize}
	Последний флаг требует пояснений: если он установлен, то пользователь
	имеет возможность изменять права доступа для выбранного объекта данных.

	Кроме этих базовых флагов многие объекты поддерживают дополнительные.
	Например, права на объединение записей, права на массовые изменения и т.д.
\end{description}

В дополнение к перечисленным функциям, многие типы объектов данных предоставляют
весьма обширный список других функций, специфичный конкретно для них.

\subsection{Контроллеры анализа данных}

Контроллеры анализа данных представлены семейством унифицированных модулей,
реализующих следующие функции:
\begin{itemize}
	\item Отображение данных в таблицах
	\item Отбор данных в соответствии с условиями фильтра, заданного
	пользователем
	\item Вывод отображенных данных на печать или экспорт этих данных
	\item Вызов функций, характерных для отображенного в таблице набора данных
\end{itemize}

Унифицированная техника реализации контроллеров анализа данных не только
определяет логичность внутренней структуры этого архитектурного слоя, но
и позволяет предоставлять конечным пользователям следующие преимущества:
\begin{itemize}
	\item Общая идеология использования %
	\item Механизм предварительной настройки условий фильтрации
	\item Единые принципы построения интерфейсов доступа к данным \ppybrand{}
	из других программ
	\item Простота кастомизации отчетов и экспорта данных
\end{itemize}

\subsection{Инфраструктура}

Слой инфраструктуры реализует значительное количество функций системы,
обеспечивающих общее \qu{жизнеобеспечение} внутреннего состояния и
пользовательских сервисов.

К наиболее заметным модулям этого слоя относятся:
\begin{itemize}
	\item Администрирование и резервное копирование баз данных
	\item Управление конфигурациями и правами доступа
	\item Управление синхронизацией данных между распределенными разделами
	\item Модули, реализующие функции импорта/экспорта данных
	\item Подсистема DL600, обеспечивающая формирование данных
	для печати, экспорта и интерфейсы с внешними программами
\end{itemize}

\chapter{Установка\label{ch-install}}

\section{Требования к ресурсам компьютеров}

В этом подразделе перечисляются формальные требования к аппаратному и программному обеспечению компьютеров,
которые участвуют в функционированию системы. То есть, речь идет в первую очередь о сервере базы данных и
рабочих станциях. Учитывая высокую сложность общей информационной инфраструктуры на предприятиях, необходимо
заметить, что сервер и рабочие станции обычно не исчерпывают список компонентов, непосредственно влияющих
на общую производительность и надежность системы.

Приводимые здесь требования являются формальными в том смысле, что компания (провайдер), обеспечивающая поддержку
на вашем предприятии системы \ppybrand{}, вправе отказаться от рассмотрения претензий по качеству функционирования %
системы, если оборудование не удовлетворяет этим требованиям.

\subsection{Требования к серверу}

Общие требования к серверу:
	\begin{itemize}
		\item Оперативная память - обязательно с поддержкой контроля целостности.
		Например, ECC.
		\item Сетевая карта - GigabitEthernet
		\item Операционная система - \trademark{Windows 2003 Server}, \trademark{Windows 2008 Server}
		или выше.
	\end{itemize}

Далее следует спецификация отдельных компонентов сервера в зависимости от количества пользователей.

\subsubsection{Количество пользователей до 10-ти}

\begin{description}
	\item[Процессор] \trademark{Intel Xeon DualCore}
	\item[Оперативная память] 2048 мегабайт или больше
	\item[Дисковая подсистема] SATA RAID-1
\end{description}

\subsubsection{Количество пользователей от 11 до 30-ти}

\begin{description}
	\item[Процессор] два процессора \trademark{Intel Xeon DualCore}
	\item[Оперативная память] 4096 мегабайт или больше
	\item[Дисковая подсистема] SAS RAID-10
\end{description}

\subsubsection{Количество пользователей от 31 до 70-ти}

\begin{description}
	\item[Процессор] два процессора \trademark{Intel Xeon DualCore}
	\item[Оперативная память] 16384 мегабайт или больше
	\item[Дисковая подсистема] SAS RAID-10 не менее 8 дисков
\end{description}

В случае, если количество пользователей больше 70-ти, конфигурация сервера
должна подбираться на основе специального изучения специфики предприятия.

\subsection{Требования к рабочим станциям}

\begin{description}
	\item[Процессор] любой пригодный для работы перечисленных ниже операционных систем с поддержкой
	набора команд SSE2.
	\item[Оперативная память] 512 мегабайт или больше
	\item[Дисковая подсистема] любая
	\item[Сетевая карта] обязательно
	\item[Операционная система] Windows XP, Windows Vista, Windows 7, Windows 8 или выше.
\end{description}

\section{Размещение объектов системы в сети}

\ppypict{schemainstall}{Схема размещения компонентов системы на компьютерах сети}

Схема расположения объектов установки системы между сервером и рабочей станцией
показана на рис.~\ref{pic-schemainstall}.

Прямоугольниками отмечены пакеты установки, а овалами - объекты, инсталлируемые этими пакетами.

Основной каталог системы (каталог \ppybrand{}) размещается на сервере, однако программный модуль ppw.exe,
будучи вызванным с сервера, запускается на рабочей станции.

Централизованное хранение основной массы файлов системы позволяет значительно снизить трудозатраты
на обновление версий системы.

\section{Обозначение версий системы}
Версии системы нумеруются следующим образом: мажор . минор . релиз (номер сборки).

\ppyexample{
	5.2.07 (1665)

	В этом примере: мажор - 5, минор - 2, релиз - 7, номер сборки - 1665.
}

Номера релизов меняются от 0 до 12 (изредка, значение номера релиза может превышать 12).
Когда номер релиза превышает этот предел, увеличивается номер минора, а релиз становится равным нулю.

Номер минора меняется от 0 до 9. Когда номер минора превышает 9, увеличивается номер мажора,
а минор и релиз становятся равными нулю.

Номер сборки является уникальным номером, увеличивающимся при каждой сборке дистрибутива на единицу.
Номер сборки не зависит от мажора, минора и релиза.

\section {Дистрибутив}

Полный дистрибутив системы \ppybrand{} имеет следующую структуру:

\begin{Verbatim}[fontfamily=courier, fontsize=\small, frame=single]
	Каталог V9999a
		Файл PpyClient_9.9.99(9999).exe
		Файл PpyJobSrvr_9.9.99(9999).exe
		Файл PpyServer_9.9.99(9999).exe
		Файл PpyUpdate_9.9.99(9999).exe
\end{Verbatim}

В приведенной структуре дистрибутива девятками обозначен номер версии (сборки).
Для номера каталога используется следующее правило: первый символ - латинская буква v,
далее следует номер версии без точек, затем буква латинского алфавита, меняющаяся в зависимости от номера сборки.

\ppyexample{
Для версии 5.2.07 сборка 1665, каталог дистрибутива будет называться v5207b.

Файлы дистрибутива будут иметь маркировку:
	{\newline PpyClient\_5.2.07(1665).exe},
	{\newline PpyJobSrvr\_5.2.07(1665).exe},
	{\newline PpyServer\_5.2.07(1665).exe},
	{\newline PpyUpdate\_5.2.07(1665).exe}.
}

\section{Установка серверной части системы}

Серверная установка подразумевает установку основной массы компонентов системы в каталог сервера, общедоступный
для всех компьютеров сети, на которых будет загружаться система. Для управления базой данных система использует
программный продукт \trademark{Pervasive.SQL} версии 8.0 или выше.
Так как этот программный продукт приобретается отдельно от системы \ppybrand{}, то предполагается, что сначала
будет установлен он.
Для демонстрационных целей в комплект дистрибутива \ppybrand{} входит ограниченный комплект пакета \trademark{Pervasive.SQL}.
Если вы устанавливаете систему для ознакомления, то можно использовать его.

Порядок установки:
\begin{enumerate}
	\item Зайти на сервер с правами администратора
	\item Установить на сервере систему \trademark{Pervasive.SQL} (не обязательно. См. п.6).
	\item Создать на одном из дисков сервера общедоступный каталог. Например, C:/WORK.
	\item Подключите сетевой диск к этому каталогу. Мы рекомендуем использовать (для однообразия) букву H:,
	но никаких принципиальных ограничений на этот счет нет. Более того, подключение диска не является обязательными,
	так как система нормально работает с UNC-именами файлов. Однако, мы все же рекомендуем использовать буквенные
	подключения, так как это упрощает перенос системы в другой каталог или на другой сервер и снижает трудоемкость администрирования.
	\item Запустить программу инсталляции \ppybrand{}: PpyServer\_9.9.99(9999)\.exe из комплекта дистрибутива системы.
	\item После двух вводных диалогов появится диалог выбора компонентов. Если вы установили \trademark{Pervasive.SQL},
	то отключите компонент Pervasive.SQL Server. Выбрав нужные компоненты, нажмите кнопку \dlgbutton{Далее}.
	\item Следующий диалог предлагает выбрать каталог установки. По умолчанию, инсталлятор предлагает каталог c:/ppy.
	Если вы устанавливаете систему только для одной рабочей станции, то этот вариант подходит, в противном случае вам следует
	выбрать подкаталог в каталоге, который вы предварительно сделали общедоступным (см. п.3).
	Так, если общедоступный каталог C:/WORK (общее имя WORK), а сервер называется PPYSERVER, то каталог
	для установки может называться //PPYSERVER/WORK/PPY.
	Если вы подключили //PPYSERVER/WORK как диск H:, то каталог для установки может называться H:/PPY.
	\item Следующий диалог показывает имя папки в меню \ppymenu{Пуск}. Нажмите здесь кнопку \dlgbutton{Далее}.
	Сразу вслед за этим инсталлятор проведет процесс установки системы на сервер.
\end{enumerate}

\section{Установка клиентской части системы}

Клиентская часть системы должна быть установлена на каждой рабочей станции, с которой будет запускаться \ppybrand{}.
Если планируется запускать \ppybrand{} на компьютере, являющемся сервером, то и на нем тоже следует установить клиентскую часть.
Порядок установки:
\begin{enumerate}
	\item Для установки клиентской части системы запустите программу инсталляции
	\newline PpyClient\_9.9.99(9999).exe
	из комплекта дистрибутива системы.
	\item После двух вводных диалогов инсталлятор предложит вам выбрать компоненты для установки:
	\qu{Pervasive.SQL Client} и \qu{CrystalReports 10.0}. Обычно требуется выбор обоих компонентов.
	Нажмите кнопку \dlgbutton{Далее}.
	\item На экране появится список, в котором, возможно, будут перечислены быстро обнаруженные серверные установки.
	Если на этом компьютере \ppybrand{} ни разу не запускался, то список будет пуст.
	В случае, если список пуст или в списке нет той установки, для которой вы хотите установить клиентскую часть, нажмите кнопку
	\dlgbutton{Поиск установленных версий на дисках}: инсталлятор просканирует все диски компьютера (включая сетевые) с целью найти
	существующие серверные установки. Этот процесс может быть довольно продолжительным.
	Вместо поиска, вы можете перейти на следующую страницу инсталляции и выбрать каталог,
	в котором установлена серверная часть. Обращаем внимание на то, что в качестве каталога следует указывать головной каталог
	установки, а не каталог BIN, в котором находятся исполняемые файлы \ppybrand{}.
	\item Следующий диалог показывает имя папки в меню \ppymenu{Пуск}. Нажмите здесь кнопку \dlgbutton{Далее}.
	Сразу вслед за этим инсталлятор проведет процесс установки системы на клиентской машине.
\end{enumerate}

После завершения процесса на компьютере будут установлены необходимые компоненты и на рабочем столе появится
иконка для запуска системы.

\section{Установка сервера задач\label{sec-setup-jobserver}}

Установка сервера задач является необязательной и осуществляется после установки серверной части системы.
Порядок этой установки следующий:
\begin{enumerate}
	\item Зайти на сервер с правами администратора
	\item Запустить программу инсталляции \ppybrand{}: PpyJobSrvr\_9.9.99(9999).exe из комплекта дистрибутива системы.
	\item После первого вводного диалога на экране появится предложение ввести имя и пароль для входа сервиса сервера в сеть.
	Введенное здесь имя должно иметь достаточно привилегий для того, чтобы сервер мог исполнять необходимые действия.
	Фактически, подойдет любое имя, с которым пользователи входят в сеть для работы с системой \ppybrand{}.
	Не забудьте указать имя домена, если ваша сеть использует домен сетей Windows. Например: mydomen/papyrus.
	Нажмите кнопку \dlgbutton{Далее}.
	\item В появившемся на экране диалоге будет указан путь для установки сервера. Вы можете указать другой каталог, помните лишь,
	что в указанном каталоге должна находиться серверная установка системы.
	Каталог задается с точным указанием размещения программы сервера ppws.exe (без самого этого имени).
	Например: //PPYSERVER/WORK/PPY/BIN или C:/PPY/BIN. Нажмите кнопку \dlgbutton{Далее}
	\item Инсталлятор запустит процесс установки.
\end{enumerate}

Для правильной работы сервера существенны следующие моменты:

Сервис не умеет работать с подключаемыми дисками. Это значит, что если ваша система использует ссылки на каталоги через
мнемонические дисковые буквы, то вам следует прописать соответствие этих букв UNC-именам в файле pp.ini в зоне [drivemapping].
\ppyexample{
	[drivemapping] \\
	h=//ppyserver/work \\
	v=//192.168.0.1/etc \\
	w=//server2/data
}

Сервис авторизуется в базах данных \ppybrand{} с именем \$SYSSERVICE\$. Вы должны создать учетную запись пользователя с таким именем.
При этом пароль, который вы укажете не имеет значения, поскольку система автоматически управляет входом под этим
именем (вы не сможете войти в базу данных, применив это имя, оно работает только для сервера).
С другой стороны, сервер \qu{уважает} права доступа, которые определены пользователю \$SYSSERVICE\$. То есть,
если этот пользователь чего-то не имеет права делать, то сервер, соответственно, и не сможет этого сделать.

\chapter{Запуск и завершение работы\label{ch-start}}

\section{Запуск системы}

Дважды щелкнуть мышью по иконке \ppybrand{} на рабочем столе.

Исполняемый файл называется PPW.EXE и лежит, как правило, в каталоге PPY/BIN на диске, доступном всем
пользователям \ppybrand{} в сети.

\subsection{Командная строка\label{sec-cmdline}}

Общий вид командной строки выглядит следующим образом

{\itshape PPW.EXE [имя пользователя] [опции]}

Опции командной строки предназначены для задания некоторых директивных или настроечных команд системе.
Они описаны в таблице.

\begin{description}
		\item[/cash:cashNodeName]
		Запуск в режиме просмотра и ввода чеков синхронного кассового узла cashNodeName.
		\item[/prc:processorSymb]
		Запуск в режиме панели процессора. processorSymb может быть идентификатором требуемого процессора,
		его символом или именем.
		\item[/tsess:processorSymb]
		После запуска система запустит просмотр таблицы технологических сессий, подчиненных текущей (по системному времени)
		суперсессии для группы процессоров processorSymb. processorSymb может быть идентификатором требуемого процессора,
		его символом или именем.
		\item[/goodsinfo:InfoKiosk]
		Система запустит диалог информационного киоска с именем infoKiosk. Справочник инфо-киосков доступен через меню
		\ppymenu{Справочники\rdir Оборудование\rdir Информационные киоски}.
		\item[/exp:exportJobName]
		Экспорт данных. Если exportJobName является именем асинхронного кассового узла, то вызывает экспорт справочника
		товаров для асинхронной кассовой сессии.  Другие задания для экспорта:

		\begin{itemize}
			\item MONARCH - экспорт данных для принтера штрихкодов Monarch
			\item LP15 - экспорт данных для весов LP15
		\end{itemize}
		\item[/imp:importJobName]
		Импорт данных. Если importJobName является именем асинхронного кассового узла, то импорт результатов
		работы асинхронной кассовой сессии.
		\item[/in:path]
		Позволяет переопределить путь доступа к входящим файлам.
		\item[/out:path]
		Позволяет переопределить путь доступа к исходящим файлам.
		\item[/syncput]
		Передача документов другому разделу БД.
		\item[/syncget]
		Прием пакетов синхронизации из других разделов БД.
		\item[/batch]
		Пакетный режим работы. Позволяет выполнить работу, заданную командной строкой и немедленно выгрузить программу.
		\item[/db:dbname]
		Символ базы данных, с которой следует работать.
		\item[/x-]
		В Windows версии не используется %
		Запрещает использование расширенной памяти для загрузки оверлейных сегментов. Единственный известный случай
		когда эта опция необходима - запуск программы под отладчиком Borland C++ 3.1 в режиме эмуляции DOS из Windows95.
		\item[/l-]
		В Windows версии не используется. %
		Запрещает использование логических блокировок \trademark{Novell NetWare} для блокировки объектов.
		Этот параметр может понадобиться в случае, когда без всяких разумных оснований выдается сообщение
		\qu{Ошибка логической блокировки}.
		\item[/convertrbcbnk:path]
		Конвертация файлов справочника банков в пригодный для импорта системой вид.

		Файл можно скачать по адресу http://cbrates.rbc.ru/bnk/bnk.exe.
		После получения файла bnk.exe в каталог $path$ (например c:/temp) его следует запустить как
		обычную программу. При этом будут распакованы два файла: bnkseek.txt и reg.txt.

		Описываемая опция командной строки преобразует упомянутые два файла в
		bnkseet.dbf и reg.dbf соответственно. После этого можно запустить функцию
		импорта банков.
		\item[/billcash:nodename]
		Устанавливает кассовый узел (по наименованию) для печати чеков по документам
		(см. стр.~\pageref{ppvbill-posprint}).

		\item[/uilang:langcode]
		Экспериментальная опция, запускающая сеанс с языком интерфейса, определяемом кодом langcode.
		На момент включения опции в дистрибутив поддерживаются символы:
		\begin{description}
			\item[en] Английский язык
			\item[nl] Нидерландский язык
		\end{description}
		По умолчанию, либо в случае, когда символ языка не распознан либо не поддерживается, применяется русский язык интефейса.

		Еще раз заметим: на момент написания (версия системы 10.4.4) поддержка нерусских языков очень ограниченная и
		может быть использован только для изучения, правки, отладки, но не для реальной работы.
\end{description}

Подробно сущность и особенности приведенных в таблице параметров и опций будут рассмотрены в соответствующих
разделах настоящего руководства.

%topic(DLG_LOGIN)

\subsection{Диалог входа в систему}

\ppypict{dlg-login}{Диалог входа в систему}

Прежде, чем начать работу в системе, требуется ввести в диалоге приветствия имя и пароль пользователя.
При вводе пароля нельзя будет увидеть на экране то, что вводится с клавиатуры, вместо этого будут видны звездочки.
Это обычный трюк, используемый для того, чтобы посторонний человек не мог увидеть пароль.

Кроме имени и пароля вводный диалог содержит также текущую рабочую дату. По умолчанию используется текущая системная дата.
Если вам удобнее работать с иной текущей датой, то установите требуемое значение.

Администратор системы может настроить ее для работы с более чем одной базой данных. Если это так, то первым полем вводного
диалога будет комбо-бокс выбора рабочей базы данных.

После заполнения всех необходимых полей следует нажать кнопку \dlgbutton{OK}. Если имя или пароль введены неправильно,
система выдаст сообщение об ошибке, после которого можно будет повторить попытку.

Кнопка \dlgbutton{Сервис\dots} в этом диалоге открывает доступ к сервисным функциям, исполнение
которых не требует авторизации в системе (более того, в ряде случаев требует чтобы никто в базе
данных не работал).

%endtopic

\subsection{Выход из системы}

Для того чтобы покинуть систему следует закрыть все открытые окна и воспользоваться пунктом меню
\ppymenu{Справочники\rdir Выход} или нажать \keyb{Alt-F4} или \keyb{Alt-X} если вы работаете с DOS версией системы.

В Windows-версии системы завершить работу можно просто закрыв основное окно программы щелкнув мышью по крестику в правом
верхнем углу этого окна.

\section{Управление сеансами пользователей}

\subsection{Блокировка запуска системы}

Для того, чтобы заблокировать запуск системы пользователями, необходимо в каталоге, в котором находится исполняемый файл
клиентской части \ppybrand{}'а (обычно PPY/BIN), создать файл с именем pplock (без расширения).

Когда модуль ppw.exe запускается, он сразу проверяет наличие этого файла. Если такой файл обнаружен,
то выполнение программы немедленно прекращается.

\subsection{Принудительное завершение работы пользователей}

Для того, чтобы принудительно завершить работу всех сеансов запуска исполняемого модуля ppw.exe, необходимо в каталоге,
из которого запущен этот модуль (обычно PPY/BIN), создать файл с именем pplock (без расширения), и внутри него с начала
первой строки написать слово QUIT.

Система, обнаружив этот файл, с таким содержимым, выдает выделенное красным цветом предупреждение в строке состояния.
Предупреждение сопровождается отсчетом времени (в секундах), оставшимся до принудительного завершения работы сеанса.
По сигналу QUIT отпускается 300 секунд на завершение пользователем начатых операций.

Если вместо слова QUIT вы укажите целое число, то его значение будет интерпретироваться как таймаут (в секундах),
после которого будет осуществлено принудительное завершение работы сеансов \ppybrand{}.
Для отмены принудительного завершения работы, в течении таймаута следует удалить файл pplock из каталога.

\subsection{Просмотр списка пользователей, работающих с базой данных}

Для того, чтобы увидеть, какие пользователи в данный момент работают с системой, выберите пункт меню
\ppymenu{Админ\rdir Список работающих пользователей}. На экране появится диалог, в котором будут видны все сеансы,
работающие с той же базой данных, в которой находитесь и вы. Кроме имен пользователей в списке видны
идентификаторы сессий и MAC-адреса компьютеров, с которых запущены сеансы.

\ppypictsc{dlg-usersesslist}{Список работающих сеансов}{0.4}

Для просмотра наименований компьютеров, с которых запущены сеансы установите
флаг \dlgflag{Показывать названия компьютеров}.

\ppynote{
	Идентификация наименований компьютеров может занять довольно
	продолжительное время (до нескольких минут).
}

\section{Администрирование имен и паролей пользователей}

Администрирование имен пользователей осуществляется в диалоге \qu{Группы и пользователи},
доступном посредством меню \ppymenu{Админ\rdir Группы и пользователи}.

Пользователь имеет право изменить собственный пароль. Для этого необходимо выбрать
пункт меню \ppymenu{Админ\rdir Изменить пароль}.

Система резервирует несколько имен пользователей:

\begin{description}
	\item[MASTER] Это - имя суперпользователя. Система никак не ограничивает
	его права доступа. В связи с этим мы настоятельно рекомендуем, если базой
	данных пользуется более двух человек, не работать под этим именем.

	Одновременно, для пользователя MASTER следует установить пароль, который
	будет доступен только узкому доверенному кругу лиц.
	\item[SYSTEM] Это имя аналогично MASTER с той лишь разницей, что когда
	вы входите в базу данных с этим именем применяется специальное меню,
	в котором доступны некоторые редко используемые административные
	функции системы.

	В справочнике пользователей вы не найдете записи с этим именем, поскольку
	оно обрабатывается программой автоматически (используется запись
	пользователя MASTER).
	\item[\$SYSSERVICE\$] Мы уже упоминали про это имя, когда рассматривали
	установку сервера задач (см. стр.~\pageref{sec-setup-jobserver}).
\end{description}

\section{Синхронизация системного времени на рабочих станциях}

Система \ppybrand{} предоставляет специальный сервис, позволяющий автоматически
синхронизировать системное время на компьютерах пользователей с выбранным
сервером.

Все что необходимо сделать для этого - в файле конфигурации pp.ini, который
находится в том же каталоге, где и исполняемый файл системы (обычно PPY/BIN),
установить параметр в зоне \[config\]

$TimeServer=ServerName$

где $ServerName$ - имя сервера, с которым необходимо синхронизировать время.

Начиная с версии 6.0.8 после имени сервера через запятую может быть указан
признак, означающий, что система во время сеанса работы должна
отслеживать изменение системного времени. Если этот признак установлен и
во время сеанса было изменено системное время, то программа вновь извлечет
время с сервера и установит на рабочей станции такое время, какое и на сервере.

\ppyexampletitle{Примеры}{
	TimeServer=192.168.0.1 \\
	TimeServer=PAPYRUSSERVER \\
	TimeServer=SERVER,1
}

При каждом запуске сеанса система будет извлекать текущее время с указанного
сервера и, если оно отличается от времени на рабочей станции более чем на 1 секунду,
устанавливать на рабочей станции это время.

В случае, если время было изменено, в файле журнала ppinfo.log заносится строка,
информирующая об этом.

Если при попытке получить время с сервера или при установке текущего времени
на рабочей станции возникла ошибка, то информация о ней заносится в файл
журнала pperror.log.

Пользователь, запускающий сеанс, не получает на экране указанной выше
информации.

\chapter{Интерфейс пользователя\label{ch-ui}}

Работа с любой программой ведется при помощи специальных средств, называемых пользовательским интерфейсом.
Как правило, это стандартные для большинства систем элементы. В этой главе дается подробное описание рабочей
среды \ppybrand{}, объясняются общие принципы работы, основные компоненты пользовательского интерфейса.

\section{Устройства ввода информации}

\subsection{Клавиатура}

Любое действие \ppybrand{} можно выполнить с помощью клавиатуры. При описании использования клавиатуры мы будем
опираться на следующие правила:
\begin{itemize}
	\item Слово 'клавиша' обозначает одну из клавиш клавиатуры и больше ничего другого
	\item В системе используются все символьные клавиши, несколько функциональных (\keyb{F1}\dots\keyb{F10}) и другие
	\item Обозначение двух клавиш имеет следующий смысл: необходимо, удерживая первую
	клавишу в нажатом состоянии,нажать вторую. Например: \keyb{Alt-F3},
	\keyb{Ctrl-F9}, \keyb{Shift-F6}.
	\item Клавишами управления курсором будем называть следующие:
	\begin{itemize}
		\item четыре клавиши со стрелками
		\item клавиши \keyb{Home}, \keyb{End}, \keyb{PgUp}, \keyb{PgDown}.
		\item если на клавиатуре имеется два набора клавиш управления курсором,
		то не имеет значения каким пользоваться %
	\end{itemize}
	\item При работе со списками строк и таблицами нажатие \keyb{Ctrl-PgUp} имеет
	смысл \qu{идти в начало}, а нажатие \keyb{Ctrl-PgDown} - \qu{идти в конец}
	\item При работе с \ppybrand{} клавиша \keyb{Insert} имеет смысл \qu{добавить},
	а клавиша \keyb{Delete} - \qu{удалить}
	\item Под обозначением \keyb{Enter} подразумевается клавиша, имеющая одну из следующих
	меток: Enter, CR, Return, Ввод.
	Клавиша \keyb{Enter} обычно имеет смысл подтверждения некоторых действий.
	В списках строк или таблицах этой клавише может соответствовать смысл \qu{Выбрать}
	или \qu{Посмотреть}.
	\item Когда употребляется обозначение \keyb{Пробел}, то это означает длинную клавишу
	без метки внизу клавиатуры, предназначенную для ввода пробелов между словами.
\end{itemize}

\subsection{Мышь}

Использование мыши обычно не вызывает каких-либо затруднений и вопросов.
Здесь мы просто сообщим основные моменты работы с этим устройством в системе
\ppybrand{} (которые, впрочем, мало чем отличаются от других интерактивных систем).

\begin{itemize}
	\item Курсором будем называть указатель мыши, видимый на экране
	\item Фраза \qu{щелкнуть мышью} означает, что необходимо подвести курсор к указанному
	элементу окна программы и нажать левую кнопку мыши
	\item Правая кнопка мыши используется обычно для вызова функций, системы, зависящих
	от контекста. Чаще всего при нажатии правой кнопки мыши появляется контекстное меню,
	из которого можно выбрать одну из возможностей.
	\item Колесико мыши, являющееся по совместительству и средней кнопкой, при вращении,
	если курсор находится в окне, содержимое которого может быть прокручено вверх или
	вниз, делает это.
	\item Колесико мыши как средняя кнопка используется только для очистки содержимого
	комбо-боксов (стр.~\pageref{sec-combobox})
\end{itemize}

\subsection{Сенсорный монитор}
Специализированный монитор, позволяющий пользователю нажатиями на экран имитировать работу с мышью.
Является исключительно удобным инструментом при автоматизации рабочих мест в ресторанном бизнесе и в сфере услуг.

Фактически, работа с сенсорным монитором не отличается от использования мыши. Одно важное различие заключается в том,
что человеческие пальцы имеют больший размер, чем курсор мыши. В связи с этим в системе ряд окон специально
адаптирован к использованию сенсорных мониторов (окна имеют больший размер, равно как и управляющие элементы в
этих окнах значительно увеличены для облегчения работы).

\subsection{Сканер штрихкодов}
Сканер штрихкодов является специализированным устройством ввода, позволяющим считать
штрихкод с целью ввода его в компьютер. Подробно сканеры будут рассмотрены в разделе,
посвященном торговому оборудованию.

\section{Компоненты рабочей среды \ppybrand{}}

\ppypictsc{Schema-Ui-Workspace-01}{Компоненты рабочей среды}{0.35}

Рабочую среду \ppybrand{} образуют следующие компоненты:
\begin{itemize}
	\item Меню системы в верхней части окна программы
	\item Общая панель инструментов, находящаяся ниже полосы меню
	\item Строка состояния в нижней части окна
	\item Таблицы. Одновременно может быть открыто произвольное количество окон таблиц,
	однако на переднем плане находится только одно из них. Мы будем называть такое окно активным.
	\item Локальная панель инструментов. Эта панель инструментов принадлежит активному
	окну таблицы и позволяет вызывать команды, специфичные для этой таблицы.
	\item Ярлыки открытых окон. Это - вспомогательный компонент рабочей среды,
	позволяющий быстро перемещаться между открытыми окнами с помощью мыши.
	\item Диалог. Ввод всех данных осуществляется пользователем посредством
	модальных окон диалогов. Термин \ppyterm{модальное} будет рассмотрен ниже.
	\item Рабочий стол. На приведенном рисунке этот компонент не виден (правда, о его существовании
	говорит ярлык \qu{Мой стол}).
\end{itemize}
В следующих параграфах мы подробно рассмотрим каждый из компонентов рабочей среды системы.

\subsection{Меню}

\ppypict{workspace-menu}{Пример выбора пункта меню}

Меню является базовым средством доступа к командам системы.

Этот компонент представляет собой горизонтальную полосу с перечнем пунктов выбора. Выбор одного и них влечет за собой
появление на экране вертикального меню со списком команд и, возможно, следующих уровней подменю.

Если в конце строки вертикального меню расположен символ \dots, то при обращении к этому
пункту в рабочей области возникнет диалоговое окно (см. стр.~\pageref{sec-dialog}).
Символ обращенного углом вправо треугольника, свидетельствует о возможности
активизировать следующий уровень подменю. Отсутствие, каких бы то ни было символов
указывает на непосредственно исполняемую команду.

В ходе работы некоторые пункты меню бывают недоступны. Как правило, в этот момент они
отличаются по цвету от остальных.
Для обозначения в настоящем руководстве пунктов меню мы будем пользоваться следующей схемой:
\ppymenu{Пункт1\rdir Пункт2\rdir Пункт3}.
Это означает, что для доступа к описываемой функции системы следует выбрать Пункт1
в горизонтальной полосе меню, затем в появившемся вертикальном меню выбрать Пункт2 и,
если указано, то во вновь появившемся вертикальном меню выбрать Пункт3.

Заметим, что ссылки на пункты меню делаются относительно основного меню системы,
поставляемого с дистрибутивом.

Вы сами, либо администратор системы на вашем предприятии можете самостоятельно
настроить любые варианты меню. В этом случае может возникнуть рассогласование между
тем, что указывается в настоящем документе и тем, что вы видите на экране.

\subsubsection{Работа с меню}
\begin{enumerate}
	\item Для активизации горизонтального меню необходимо нажать клавишу \keyb{F10} либо \keyb{Alt}.
	\item Передвигаться по меню можно, используя клавиши управления курсором.
	\item Чтобы выбрать требуемый пункт, следует установить на него курсор и нажать клавишу \keyb{Enter}.
	\item Для отмены выбора нужно нажать клавишу \keyb{Escape}.
\end{enumerate}

Можно ускорить активизацию определенного пункта меню, пользуясь клавишами быстрого доступа.

\ppyexample{
	Для того чтобы быстро обратиться к пункту меню \ppymenu{Операции\rdir Товарные документы}
	следует нажать следующую комбинацию клавиш: \keyb{Alt-О} \keyb{Д}.
}

Для быстрого доступа к пункту горизонтального меню требуется нажать комбинацию
клавиш \keyb{Alt} - 'буква', где 'буква' - выделенный подчеркиванием символ в пункте меню.
Например, чтобы обратиться к меню \ppymenu{Справочники} следует нажать \keyb{Alt-С}.
Для быстрого доступа к пункту вертикального (выпадающего) меню следует просто нажать
выделенную букву.

\subsection{Общая панель инструментов}

Общая панель инструментов располагается под строкой меню. Главное назначение этого компонента -
ускорение доступа к часто используемым командам системы. Любая кнопка этой панели инструментов
имеет аналог среди пунктов меню.

При подведении курсора мыши к какой-либо из кнопок общей панели инструментов
появляется текстовая подсказка, уточняющая назначение этой кнопки.

\subsection{Строка состояния}

Строка состояния расположена в нижней части экрана и предназначена для того,
чтобы сообщать пользователю следующую информацию:
\begin{itemize}
	\item Наименование главной организации
	\item Наименование активного раздела базы данных (если определен)
	\item Наименование текущего склада
	\item Текущую дату
	\item Наименование базы данных
	\item Символ, сигнализирующий о том, что у вас есть не просмотренные задачи,
	в которых вы обозначены как исполнитель.
	\item Если запущен процесс автоматического выхода всех сеансов, то в строке
	состояния отображается красная полоса, в которой показывается оставшееся до
	автовыхода время.
\end{itemize}

Если вы щелкните дважды мышью на строке состояния, то откроется диалог,
показывающий более подробно информацию о текущем рабочем состоянии сеанса.

\subsection{Рабочий стол}

Рабочий стол является инструментом для тонкой настройки команд, часто используемых
пользователем. Каждый пользователь может иметь собственный рабочий стол. Вместе с тем,
один рабочий стол может совместно использоваться несколькими пользователями.

На рабочем столе можно создавать ярлыки для часто используемых функций. Кроме простого
указания какая именно функция должна быть связана с ярлыком, во многих случаях система
позволяет определить фильтр, применяемый к этой функции при обращении к ярлыку.

Допускается настройка цвета и фонового рисунка для рабочих столов.

\subsection{Рабочая область}

Рабочая область занимает большую часть экрана между строками меню и состояния.
Вся основная визуальная работа системы и пользователя ведется именно в рабочей области.

\section{Настройка меню пользователя}

\subsection{Создание локального меню}

\subsection{Привязка локального меню к группе или пользователю}

\section{Диалоги\label{sec-dialog}}

В процессе работы с \ppybrand{}, по своей инициативе или по запросу системы, приходится вводить различные данные.
В большинстве случаев ввод данных в \ppybrand{} осуществляется при помощи диалогов, обеспечивающих удобный способ
просмотра и задания тех или иных параметров.
Диалог  - это окно фиксированного размера, работа в котором ведется с помощью элементов управления. Существует
пять базовых типов элементов управления:

\begin{itemize}
	\item строка ввода
	\item флажки
	\item переключатели
	\item кнопки
	\item списки строк (или просто списки)
\end{itemize}

Рисунок демонстрирует типовой вид диалога. Перед тем, как подробно описать каждый
из управляющих элементов, приведем основные методы работы, общие для всех диалогов.
Как любое окно диалог имеет нерабочую область с необходимыми элементами.
В связи с тем, что размер диалога фиксирован, в его служебной области отсутствуют
маркер расширения окна и угол изменения размера. В каждый момент времени один из
элементов диалога является выбранным. Это означает, что элемент готов
принять информацию или выполнить команду. Для того чтобы выбрать другой элемент
существуют следующие способы:

\begin{itemize}
	\item Нажать клавишу \keyb{Tab} для выбора следующего элемента.
	\item Нажать клавишу \keyb{Shift-Tab} для выбора предыдущего
	\item Подвести курсор мыши и щелкнуть кнопкой
\end{itemize}

Если относящийся к управляющему элементу текст имеет выделенную подчеркиванием
\qu{горячую} букву, то для выбора этого элемента можно нажать комбинацию
\keyb{Alt-буква}, где 'буква' - клавиша, соответствующая горячей букве.

Так как во многих популярных программах переход от одного управляющего элемента
к другому осуществляется по клавише \keyb{Enter}, считаем необходимым,
акцентировать ваше внимание на том, что в \ppybrand{} клавиша \keyb{Enter} при
работе с диалоговыми окнами имеет другой смысл.

Теперь, зная, что такое диалог, мы можем обсудить подробно каждый тип управляющего элемента.

\subsection{Кнопки}

представляют собой горизонтальные прямоугольники с тенью.
Внутри кнопки содержится текст, который отражает ее назначение.

Основной задачей кнопки является передача команды от пользователя диалогу.
Для выполнения команды кнопки необходимо щелкнуть по ней мышью. Кроме того, кнопку, как и любой другой
управляющий элемент, можно выбрать с помощью клавиш \keyb{Tab} и \keyb{Shift-Tab}, а следующее за этим нажатие
клавиши \keyb{Enter}, активизирует команду. Использование \qu{горячих} клавиш  по отношению к кнопкам приведет
к непосредственному выполнению команды.

Среди большого количества передаваемых кнопкой команд некоторые встречаются наиболее часто и являются стандартными.

Среди кнопок диалога может присутствовать одна кнопка \qu{по умолчанию}. Она запускается при нажатии клавиши \keyb{Enter},
если выбранным является любой из управляющих элементов за исключением кнопок. Если выбранной является кнопка, то
по клавише \keyb{Enter} активизируется она.
Чаще всего  кнопкой \qu{по умолчанию} назначается кнопка \dlgbutton{OK} - стандартная %
кнопка модального диалога, имеющая смысл подтверждения всех сделанных изменений данных и закрытия окна диалога.

Еще один распространенный в модальных диалогах тип кнопки - \dlgbutton{Отмена}.
Эта кнопка приводит к закрытию модального диалога без сохранения сделанных
изменений в данных. Клавиша \keyb{Escape} всегда эквивалентна кнопке \dlgbutton{Отмена}.

Некоторые кнопки при определенных условиях бывают запрещены к использованию. Это хорошо заметно по внешнему виду
кнопок - они имеют затемненный цвет. Как и в случае с запрещенными пунктами меню, это может быть вызвано
отсутствием смысла в команде, с возможностью возникновения сбойной или неоднозначной ситуации либо с ограничением
доступа к модификации данных.

Кроме стандартных кнопок \dlgbutton{OK} и \dlgbutton{Отмена} в диалогах \ppybrand{} часто встречаются кнопки
для добавления, удаления и редактирования информации.

В некоторых диалогах, содержащих списки строк, встречаются кнопки смены
уровня \dlgbutton{+\dots} и \dlgbutton{-\dots}. Кнопка \dlgbutton{+\dots}
означает \qu{перейти на следующий уровень},
кнопка \dlgbutton{-\dots} - \qu{вернуться на предыдущий}.

Кнопками переноса будем называть кнопки содержащие вместо пояснительного текста символы:
\dlgbutton{›}, \dlgbutton{‹}, \dlgbutton{‹‹}, \dlgbutton{››}.
Эти кнопки встречаются в диалогах, содержащих более одного списка. Назначение кнопок заключается в том,
чтобы переносить выбранные строки из одного списка в другой. В зависимости от направления стрелки на кнопке,
строка либо переносится в очередной список, либо исключается из него. Кнопка, содержащая двойную стрелку,
отвечает за перемещения всех элементов из одного списка в другой.

\subsection{Поле ввода}

предназначено для ввода символьной и цифровой информации и представляет собой узкий прямоугольник с расположенным
рядом поясняющим текстом. При работе с полем ввода используются основные клавиши редактирования, левая и правая %
стрелки \keyb{Home}, \keyb{End}, \keyb{Insert}, \keyb{Delete}. Размер поля является фиксированным и не обязательно равным
длине вводимого текста. Если текст превышает размер поля, то содержимое поля автоматически прокручивается, а на
концах появляются символы стрелок, направленные в зависимости от того, в какую сторону прокручен текст.

Если в поле требуется ввести число, то диалог автоматически проверяет принадлежность введенного числа некоторому
диапазону и при любом несоответствии, выдается сообщение об ошибке. Это одна из мер защиты против ввода некорректных
данных. Если вместо числа вводить буквы или другие недозволенные знаки, то введенная строка будет
интерпретироваться как ноль.

\ppybrand{} предусматривает ввод некоторых типизированных данных, таких как дата, время, и др. Полный их перечень
с подробным описанием приводится позже.

\subsection{Флажок}

Представляет собой прямоугольник, с левой стороны которого расположены квадратные скобки ([ ]) с символом 'X'
между ними или без него. Справа от скобок размещен поясняющий текст. Флажок может находиться в двух состояниях -
'включен' и 'выключен' (другая аналогия - это 'Да' и 'Нет'). Включенный флажок имеет в квадратных скобках символ 'X',
выключенный - не имеет. Для изменения состояния флажка щелкните над ним мышью или, установив на него курсор,
нажмите клавишу \keyb{Пробел}.

Часто, несколько флажков сведены в группы, для перемещения по ним используются клавиши управления курсором.

\subsection{Переключатели}

похожи на флажки, но вместо квадратных скобок используются круглые, а в качестве маркера маленький кружочек.
Переключатели, как и флажки, могут быть включенными и выключенными, но, в отличие от предыдущих, включенным
может быть только один переключатель в группе, остальные при этом выключены. Для выбора какого-либо переключателя %
из группы щелкните над ним мышью или, выбрав группу переключателей, включите нужный клавишами \keyb{\textdownarrow}
или \keyb{\textuparrow}.

\subsection{Списки строк}

Представляют собой прямоугольные окна, в которых изображены текстовые строки. Рядом со списком располагается %
линейка прокрутки.  Только один элемент из списка является текущим. Для выбора элемента, следует установить на
него курсор, убедиться, что курсор стоит на искомой записи, иначе, нажимая клавишу \keyb{\textdownarrow},
подвести курсор к требуемой строке.

Если список велик, и отыскать требуемую строку затруднительно, можно применить
\qu{быстрый} поиск. В системе предусмотрены два способа \qu{быстрого} поиска:
по первым буквам строки и по подстроке.

Обратим внимание на то, что поиск по первым буквам ведется, начиная с первой строки
списка, в отличие от поиска по подстроке, где просматриваются только нижестоящие от
текущей строки записи.

\ppyexampletitle{Пример поиска по первым буквам}{
	Необходимо получить информацию о шоколадных конфетах. Для этого:
	Находясь на любой строке списка, требуется нажать клавишу 'ш'. На экране появится окно с полем ввода, содержащее
	эту букву. По желанию можно ввести еще несколько букв слова 'шоколад', например добавить 'ок'
	Нажать \keyb{Enter}. В этом случае курсор переместится на первую запись в списке, начинающуюся с 'шок'.
}

\ppyexampletitle{Пример поиска по подстроке}{
	Необходимо найти строку, содержащую в своем составе слово \qu{орех}.
	Для этого следует нажать клавишу (*). В появившемся поле ввода после символа '*' набрать \qu{орех},
	нажать \keyb{Enter}. Курсор переместится на искомую запись. Подчеркнем, что в этом случае просматриваются %
	только те записи, которые расположены ниже текущей. Чтобы вести поиск по всему списку, сначала нужно
	перейти в его начало, нажав \keyb{Ctrl-PgUp}, а затем уже повторить перечисленные выше действия.

	Для поиска следующей записи, содержащей слово \qu{орех}, надо нажать \keyb{Ctrl-G}.
}

В системе используется три вида списков. Они очень схожи по своим свойствам, но несколько отличаются внешним
видом и сферой использования.

\subsubsection{Встроенные обычные списки}

Такие списки полностью отображаются в диалоге. Функции редактирования элементов списка
реализуются посредством дополнительных кнопок, которые находятся справа или снизу от списка.

\subsubsection{Встроенные многоколоночные списки}

Так же как и предыдущие, эти списки отображаются в диалоге. Единственное отличие состоит в том,
что многоколоночные списки отображают каждый элемент не в виде одной строки, а в несколько колонок,
каждая из которых, как правило, имеет заголовок в верхней части списка.

Обращаем внимание, что быстрый поиск в многоколоночных списках возможен только по первой колонке
(которая обычно содержит основной смысловой текст элемента).

\subsubsection{Выпадающие списки}

Выпадающие списки \qu{свободны} от диалога. Это значит, что они сами по себе являются упрощенным
окном диалога, в котором нет ни кнопок, ни каких-либо иных управляющих элементов кроме, собственно,
списка.

Такие списки предназначены исключительно для выбора одного элемента.

Некоторые из выпадающих списков предоставляют возможность добавлять или редактировать элементы.
Чтобы воспользоваться этими функциями вы можете вызвать локально меню списка, нажав правую кнопку
мыши на нем. В локальном меню обычно представлены две опции: добавить и редактировать.
Клавиатурными эквивалентами этих функций являются, соответственно, клавиши \keyb{Insert} и \keyb{F11}.

Клавиша \keyb{Enter} или двойной щелчок мыши приводят к выбору текущего элемента списка.

\subsection{Комбинированные списки (комбо-боксы)\label{sec-combobox}}

являются объединением поля ввода и выпадающего списка строк. Внешне они аналогичны полю ввода, справа от которого
изображен маркер открытия списка в виде обращенного вниз треугольника. В системе \ppybrand{} поле ввода
комбинированного списка допускает выбор только указанных в списке строк. Чтобы развернуть список следует,
находясь на выбранном  поле списка, нажать клавишу \keyb{\textdownarrow} или щелкнуть мышью по маркеру
открытия списка.

Перемещение по строкам комбинированного списка аналогично передвижению по записям обычного списка строк.

Еще один вариант открытия списка комбо-бокса состоит в наборе символов для поиска, находясь в его поле.
При этом, после набора первого символа, появится окно ввода строки поиска. Наберите полный текст поиска
и нажмите \keyb{Enter}. Список откроется и в нем программа найдет (если сможет) искомый текст.

Третий вариант открытия списка: вращение колеса мыши в поле комбо-бокса.

Редактирование строки списка комбо-бокса (если это допускается правами доступа и возможностями конкретного
списка) осуществляется нажатием \keyb{F11}.

Выбор требуемого элемента и последующее закрытия списка осуществляется нажатием клавиши \keyb{Enter} или
двойным щелчком мыши.

Для того чтобы очистить поле комбо-бокса необходимо нажать клавишу \keyb{Delete}. Эта функция доступна
только в том случае, если комбо-бокс допускает пустое значение. Альтернативный способ очистки поля комбо-бокса -
нажать средним колесиком мыши, когда ее курсор находится в поле комбо-бокса.

Некоторые комбинированные списки позволяют добавлять новые строки и удалять существующие. Для этого
используются соответственно клавиши \keyb{Insert} и \keyb{Delete}.

\subsection{Поля ввода типизированных данных}

Как упоминалось выше, в \ppybrand{} существуют поля для ввода типизированных данных. Эти поля требуют,
при ввода в них информации, выполнения определенных правил. Ввод в такие поля нетипичных для них данных,
выдаст сообщение об ошибке. Ниже перечисляются основные типы данных, для которых предусмотрены специальные
поля, и дается их подробное описание.

\subsubsection{Дата}

\ppypict{dlg-ctl-input-date}{Пример поля ввода даты}

Обычный шаблон ввода даты выглядит следующим образом:
дд/мм/гг, где
\begin{description}
	\item[дд] число ( от 0 до 31)
	\item[мм] номер месяца
	\item[гг] год
	\item[/]  разделитель ( '.', '/','-')
\end{description}

Правила ввода номера года следующие:
\begin{itemize}
	\item Если год вводится полным числом, то здесь все понятно
	\item Если год вводится числом от 1 до 49, то к нему прибавляется число 2000.
	Таким образом получается год 21-го столетия.
	\item Если год вводится числом от 50 до 99, то к нему прибавляется 1900.
	Таким образом получается год 20-го века.
	\item Если год вводится числом от 200 до 299, то программа воспринимает
	его как год 21-го века с пропущенным нулем. Такой трюк позволяет ускорить
	ввод данных. К примеру, число 208 интерпретируется как 2008-й год.
\end{itemize}

\ppyexample{
	\begin{description}
		\item[10.04.98] Десятое апреля тысяча девятьсот девяносто восьмого года.
		\item[10-4-98] Тоже.
		\item[10/4/07] Десятое апреля 2007 года.
		\item[10/4/207] Тоже.
		\item[10.4] Десятое апреля текущего года.
		\item[10] Десятое число текущего месяца текущего года.
	\end{description}
}

Если необходимо ввести дату за текущий год, то значение года можно опустить при вводе.
Тоже самое касается текущего месяца.
Текущий месяц и текущий год определяются текущей датой, в которой вы работаете.
Если при входе в систему вы переопределили дату, то она может отличаться от текущей календарной.

Как правило, справа от поля ввода даты в диалоге присутствует кнопка вызова
календаря, позволяющая выбрать дату мышью (см. рис.~\ref{pic-dlg-ctl-input-date}).

В поле ввода даты можно задействовано колесо мыши:
\begin{itemize}
	\item При вращении колеса \qu{к себе} дата, введенная в поле уменьшается на
	один день.
	\item При вращении колеса \qu{от себя} дата, введенная в поле увеличивается на
	один день.
	\item Если до начала вращения колеса поле было пустым, то отсчет идет от текущей
	системной даты.
\end{itemize}

\subsubsection{Период}

\ppypict{dlg-ctl-input-period}{Пример поля ввода периода}

Для ввода границ периода существует следующая форма
дд/мм/гг..дд/мм/гг,
но, при необходимости, можно опускать некоторые параметры.

Отсутствие левой границы интерпретируется системой, как все доступные данные до указанной даты.

Если нет правой границы, то берутся данные от отмеченной даты по настоящий момент.

Кроме того, в системе предусмотрена особая форма ввода квартала, при этом применяются символы
латинского алфавита. Записи вида: I, II, III, IV или i, ii, iii, iv, означают, соответственно, первый,
второй, третий и четвертый кварталы.

В случае отсутствия левой границы, за начало отсчета принимается дата начала функционирования системы
на предприятии, либо начало периода, ограниченного правами доступа.

\ppyexampletitle{Поясним вышесказанное на примерах}{
	\begin{description}
		\item[1.2.07..29.3.07] С 1 февраля по 29-е марта 2007 года.
		\item[..4.07] По апрель 2007 года включительно.
		\item[4.98] Весь апрель 1998 года.
		\item[1.207..5.207] С января по май 2007 года.
		\item[1.2007..] С января 2007 года по настоящий момент.
		\item[..23.4] По 23 апреля текущего года.
		\item[..23] По 23 число текущего месяца текущего года.
		\item[I..II] С первого по второй квартал текущего года включительно.
		\item[IV] Только четвертый квартал текущего года.
		\item[iv/2006..ii/07] С четвертого квартала 2006 года по второй квартал 2007 включительно.
	\end{description}
}

Обычно справа от поля ввода периода находится кнопка вызова
специализированного диалога календаря, позволяющего выбрать
требуемый период мышью (см. рис.~\ref{pic-dlg-ctl-input-period}).

\subsubsection{Шаблонизированная дата\label{sec-input-tamplatedate}}

Система предоставляет специальный сервис, обеспечивающий ввод даты и периода, которые
актуализируются в момент применения относительно какой-либо конкретной (обычно текущей)
даты.

Такой способ определения дат и периодов применяется в сохраняемых фильтрах и
конфигурациях. То есть тогда, когда необходимо определить некоторую дату либо период
не в абсолютном выражении, а относительно того дня, когда это будет нужно.

Например, вы хотите каждый день анализировать отчет о продажах с начала месяца
до текущего дня. В этом случае, вы можете создать ярлык для отчета на рабочем столе
и в параметрах фильтра этого ярлыка указать период 1/@/@..@ что будет означать
именно то, что нужно. То есть, каждый раз, когда вы вызываете отчет этим ярлыком
в фильтре будет устанавливаться период с 1-го числа текущего месяца текущего года до
сегодняшнего дня включительно.

Правила ввода шаблонизированных дат следующие:

\begin{description}
	\item[Одиночный символ @] означает текущую системную дату
	\item[Одиночный символ @ со следующим за ним числом, которому предшествует знак + или -] означает
	текущую системную дату, к которой прибавляется (+) или вычитается (-) заданное количество
	календарных дней.

	Например:
	\begin{description}
		\item[@] Сегодняшний день
		\item[@-7] Ровно неделя назад
		\item[@+1] Завтра
	\end{description}

	\item[Одиночный символ \textasciicircum со следующим за ним числом] означает первый день текущего месяца, если число меньше или равно текущему дню месяца и начало
	предыдущего месяца в случае, если текущий день месяца меньше этого числа.

	Например:
	\begin{description}
		\item[\textasciicircum1] Всегда 1-е число текущего месяца
		\item[\textasciicircum10] с 1-го по 9-е - первый день предыдущего месяца, начиная с 10-го
		числа - первый день текущего месяца
	\end{description}

	\item[Полное представление даты, элементы которого заменяются на выражения с @]
	Такое представление воспринимается как дата, в которой элемент (день, месяц или год),
	замененный на шаблонизированную форму при актуализации замещается на соответственно
	текущий день, месяц или год с вычитанием или добавлением заданного значения.

	Заметим, число, будучи примененным к шаблонизированному месяцу будет
	преобразовываться в день, не превышающий последнее число полученного после
	подстановки месяца (один из примеров ниже продемонстрирует это правило).

	Например:
	\begin{description}
		\item[1/@/@] Первое числе текущего месяца
		\item[@/@-1] Ровно месяц назад (пропущенный год заменяется на текущий, однако
		при вычитании месяца программа аккуратно переведет год в предыдущий если
		дело происходит в январе).
		\item[29/6/@] 29 июня текущего года.
		\item[31/@-1] Последний день предыдущего месяца (31 будет заменено на
		последний день предыдущего месяца).
	\end{description}

	\item[Год и(или) месяц может быть заменен на специальный символ '?']
	Это означает, что вас интересует только день и, возможно, месяц даты не зависимо от года (и, возможно, месяца).
	Такой шаблон работает лишь в некоторых ситуациях, и главным образом, ориентирован на идентификацию дат
	соответствующих дням рождения.

	Например:
	\begin{description}
		\item[7/4/?] 7-е апреля любого года.
		\item[13/?/?] 13 число любого месяца и года.
		\item[20/?/2017] 13 число любого месяца 2017-го года.
	\end{description}

\end{description}

\subsubsection{Время}

\ppypict{dlg-ctl-input-time}{Пример поля ввода времени}

Обычный шаблон ввода времени выглядит следующим образом:
чч:мм:cc, где
\begin{description}
	\item[чч] часы
	\item[мм] минуты
	\item[сс] секунды
	\item[:]  разделитель
\end{description}

Секунды и минуты могут быть опущены. Для упрощения ввода в качестве разделителя можно
вводить пробел.

\ppyexample{
	\begin{description}
		\item[12:48:37] 12 часов 48 минут 37 секунд
		\item[12 48 37] Тоже.
		\item[12:48] 12 часов 48 минут 00 секунд
		\item[12] 12 часов 0 минут 0 секунд
	\end{description}
}

\subsubsection{Число}

При вводе числа допустимы все символы цифровой клавиатуры, символы плюс (+) и минус (-) в начале числа
а, также точка (.) в качестве разделителя целой и дробной части. Если ввести какие-нибудь другие символы
система их воспримет как ошибку или ноль.

При вращении колеса мыши в активном поле ввода числового значения величина значения увеличивается на
единицу при вращении колеса \qu{от себя} и уменьшается на единицу при вращении \qu{к себе}.

\subsubsection{Текст}

Эти поля позволяют вводить любую символьную информацию.

\subsubsection{Специальные поля ввода}

Кроме перечисленных выше существует группа полей позволяющих вводить очень специфическую информацию,
такую как штрихкоды, формулы. При вводе штрихкода можно использовать только цифры, о формулах подробно
поговорим ниже в каждом конкретном случае.

\section{Таблица}

\ppypictsc{workspace-table}{Пример таблицы}{0.45}

Основная часть информации, хранящейся в системе, отображается в таблицах - специальных окнах просмотра данных.
Таблица (см. рисунок) состоит из шапки, списка строк и панели инструментов.

Как правило, функции таблиц не ограничивается только просмотром. Очень часто таблица является средством
доступа к диалогам ввода и редактирования информации. С его помощью можно получить распечатку выборки,
просмотреть и распечатать итоги, получить углубленную информацию об интересующем предмете.

\subsection{Навигация по таблице}

В таблице выделяются так называемые текущая строка и текущая ячейка.

Для перемещения по таблице используются клавиши управления курсором:
\begin{itemize}
	\item Клавиши \keyb{\textdownarrow} и \keyb{\textuparrow} перемещают текущую ячейку, соответственно,
	на одну строку вниз и вверх.
	\item Клавиши \keyb{\textleftarrow} и \keyb{\textrightarrow} перемещают текущую ячейку, соответственно,
	на одну колонку влево и вправо.
	\item Клавиши \keyb{PgDown} и \keyb{PgUp} перемещают текущую ячейку, соответственно,
	на один экран вниз и вверх.
	\item Клавиши \keyb{Home} и \keyb{End} перемещают текущую ячейку, соответственно,
	на первую и последнюю строку таблицы.
\end{itemize}

Нажав левую кнопку мыши и перемещая курсор, можно перемещать текущую ячейку в пределах видимой части таблицы.

Вращение колеса мыши перемещает текущую строку на несколько строк вниз или вверх.

Нижняя полоса прокрутки позволяет перемещать текущую ячейку в пределах текущей строки.

Левая полоса прокрутки позволяет перемещать текущую строку в пределах всей таблицы.
Однако, для этой полосы прокрутки не доступна возможность \qu{ухватить и тащить}.
Вы можете перемещать текущую строку только на одну строку вниз или вверх, либо на
одни экран вниз или вверх (щелкнув мышью, соответственно, ниже указателя полосы или выше него).

Если необходимо изменить размер какой-либо колонки в таблице, то для этого можно ухватить
мышью левую вертикальную черту, ограничивающую справа выбранную колонку в области
заголовка и перемещением мыши менять ширину колонки.

Закрыть таблицу можно при помощи клавиши \keyb{Escape} либо щелкнув мышью по крестику
в правом верхнем углу окна.

\ppynote{
	Конфигурация пользовательского интерфейса позволяет отключить закрытие окна таблицы клавишей \keyb{Escape}.
}

\subsection{Поиск в таблицах}

При необходимости найти в таблице строку, содержащую интересующий вас текст можно воспользоваться функцией поиска.
Для этого установите клавишами управления курсором выделенную ячейку в том столбце, в котором хотите осуществить поиск.

Затем наберите на клавиатуре несколько первых символов искомой строки или нажмите \keyb{Ctrl-F} и в появившемся на экране
поле ввода введите первые несколько символов.

Нажмите \keyb{Enter}.

Если в таблице существует запись, \emph{начинающаяся} с введенных
символов, то курсор установится на ней. В противном случае курсор встанет на последнюю запись в таблице, что означает, что
поиск окончился неудачно.

Если необходимо найти ячейку, которая содержит интересующую вас строку, но не обязательно начинается с нее, то предварите
искомый набор символов звездочкой ('*'). В этом случае поиск ведется не с первой строки таблицы, как при поиске с начала
строки, а со строки, следующей за текущей. Это дает возможность пройти по всем строкам таблицы, содержащим в выделенном
столбце искомую подстроку.

Для поиска следующей строки, удовлетворяющей условию поиска, следует нажать \keyb{Ctrl-G}.

По умолчанию, при неудачном поиске в середине экрана появляется красное полупрозрачное сообщение об этом.
Если вы не хотите, чтобы такое сообщение появлялось, то его можно отключить в опциях пользовательского интерфейса (см. стр.~\pageref{sec-cfg-ui}).

\subsection{Локальная панель инструментов}

Панель инструментов таблицы позволяет выбрать доступные для этой таблицы команды для выполнения. Как правило, с каждой из
иконок панели инструментов ассоциирована клавиша или комбинация клавиш, которая позволяет выполнить ту же команду с клавиатуры.

Альтернативой панели инструментов является контекстное меню таблицы, которое вы можете увидеть если нажмете правую кнопку мыши,
когда курсор находится в области таблицы. В этом меню будут перечислены все команды, доступные в таблице и с права от каждой команды
показан обозначение клавиш, которые позволяют вызвать команду.

\ppynote{
	В действительности, не все команды, показанные в панели инструментов приведут к какому-то эффекту. Это может зависеть
	от контекста, в котором создана таблица. В дальнейшем, при описании конкретных таблиц, мы будем уточнять нюансы.
}

\subsection{Экспорт содержимого таблицы в другие программы}

\subsubsection{Копирование содержимого таблиц в буфер обмена}
Вы можете выделить несколько столбцов из таблицы, удерживая клавишу \keyb{Ctrl} и щелкнув по заголовку выбранного столбца
левой кнопкой мыши. При этом столбец будет обведен пунктирной линией. Выделив таким образом столбцы, которые вы хотите
скопировать в буфер обмена, нажмите \keyb{Ctrl-Insert}. Все данные из выделенных столбцов попадут в буфер обмена.

После этого вы можете вставить эти данные в программу, которая поддерживает возможность вставки таблиц из буфера обмена.
Например, \trademark{Microsoft Excel} или \trademark{OpenOffice Calc}.

Отмена всех выделений осуществляется нажатием левой кнопкой мыши в области таблицы с одновременным удерживанием нажатой
клавиши \keyb{Shift}.

\ppyadmin{
	Данные в буфер копируются в формате SYLK.
}

\subsubsection{Прямая передача содержимого таблицы в \trademark{Microsoft Excel}}
Во многих таблицах доступна функция переноса всего содержимого таблицы непосредственно в новую рабочую книгу
программы \trademark{Microsoft Excel}.

Для того, чтобы это сделать нажмите сначала \keyb{F10}, а затем \keyb{X}. \ppybrand{} откроет сеанс \trademark{Microsoft Excel}
и занесет в новую рабочую книгу все содержимое активной таблицы.

\section{Конфигурация интерфейса\label{sec-cfg-ui}}

\ppypict{dlg-cfg-ui}{Диалог конфигурации интерфейса}

Ряд опций интерфейса система позволяет определить на усмотрение пользователя.
Для доступа к этим опциям выберите пункт меню \ppymenu{Админ\rdir Интерфейс\rdir Конфигурация интерфейса}.

\ppyadmin{
Акцентируем внимание на следующем важном свойстве этой конфигурации. Данные
о ней хранятся не в базе данных, а в системном реестре операционной системы.

Адрес хранения следующий: $HKEY\_CURRENT\_USER//Software/Papyrus/UI2$.

Таким образом, обсуждаемые настройки сохраняются для учетной записи
пользователя операционной системы, а не для пользователя \ppybrand{}.

Для примера, если пользователь \ppybrand{} СЕМЕН авторизуется в операционной
системе под именем SALEMGR, то если он войдет в \ppybrand{} под именем
MASTER на том же компьютере, то его настройки интерфейса останутся прежними,
но если он перейдет на другой компьютер, сеанс на котором авторизован
под именем OPER02, а в \ppybrand{} войдет под именем СЕМЕН, то он, весьма
вероятно, увидит несколько иной внешний вид интерфейса пользователя.
}

Внешний вид диалога конфигурации интерфейса приведен на рис.~\ref{pic-dlg-cfg-ui}.
Далее мы перечислим флаги и другие управляющие элементы этого окна.

\begin{description}
	\item[\dlgcombo{Цветовая схема броузера}]
	В этом комбо-боксе можно выбрать одну из предопределенных цветовых схем таблиц.

	\item[\dlgcombo{Внешний вид окон}]
	Определяет визуальные особенности отображение окон диалогов. На текущий момент
	устойчиво работают варианты \qu{Standard} и \qu{Vector}.

	\item[\dlgflag{Выход из броузера по Esc}]
	Если вам не нравится, что нажатие клавиши \keyb{Escape} приводит к закрытию активной таблицы, то отключите этот флаг.

	В этом случае закрывать окна вам придется мышью.

	\item[\dlgflag{Показывать закладки}]
	Если флаг включен, то в нижней части экрана будут отображаться ярлычки,
	соответствующие открытым окнам таблиц и рабочего стола.

	Рекомендуется устанавливать эту опцию, поскольку работать с окнами
	в таком случае на много удобнее. Единственный возможный аргумент против этой
	функции - малый размер экрана.

	\item[\dlgflag{При добавлении элемента в товарную корзину количество брать и текущей колонки}]
	Эта (довольно специфичная) опция предписывает системе при добавлении товара
	из товарных отчетов в корзину в качестве количества использовать величину в
	текущей колонке таблицы.

	Резоном для применения данного флага может служить то, что вас по каким либо
	причинам не устраивает количество, применяемое системой по умолчанию (зависит
	от конкретной таблицы).

	Если вы используете опцию, то будьте внимательны, поскольку вероятность
	ошибки при ее использовании весьма велика.

	Подробно товарные корзины описаны на стр.~\pageref{sec-goodsbasket}.

	\item[\dlgflag{Отображать бизнес-показатели на рабочем столе}]
	Установка этого флага приведет к тому, что в правом нижнем углу
	рабочего стола будет отображаться окно, содержащее актуальные
	значения бизнес-показателей. Подробнее см.~\ref{ch-bizscore}.

	\item[\dlgflag{Не показывать окно 'Не найдено' при не удачном поиске}]
	При вызове штатной функции поиска в таблицах, если заданная строка
	не была найдена, то в центре экрана появляется красное полупрозрачное
	окно, информирующее о том, что поиск закончился не удачно.

	Если по каким-либо причинам вам мешает это окно, то установите данный флаг.

	\item[\dlgflag{Уведомлять о наличии обновлений}]
	Экспериментальная опция, предписывающая системе проверять наличие новой версии на сервере Universe-HTT.
	Опция работает если с компьютера, на котором запущен сеанс есть доступ в Интернет и в конфигурации глобального обмена
	установлены параметры учетной записи Universe-HTT.

	Если сеанс обнаружит новую версию, то информирует об этом в строке состояния.

	\item[\dlgflag{Черезстрочная расцветка временной диаграммы}]
	До версии \ppybrand{} 7.9.2 горизонтальные полосы временной диаграммы выделялись черезстрочным
	изменением цвета. В последующий версиях выделение этих полос по умолчанию реализуется разделительными
	линиями. Если черезстрочная расцветка вам больше нравиться, то установите этот флаг.

	\item[\dlgflag{Запрет на звуковые сигналы}]
	Если флаг установлен, то сеанс, для которого применима данная конфигурация, ограничивает использование
	звуковых сигналов.

	Использование данного флага может быть обусловлено например тем, что к данному компьютеру, подключены
	звукоусиливающие устройства, из-за которых сигналы слышны в зале.

	\item[\dlgflag{В элементе корзины фокус - на количестве упаковок}]
	Специализированный флаг, предписывающий системе, при открытии диалога элемента товарной корзины,
	устанавливать фокус ввода на поле количества упаковок. По умолчанию фокус устанавливается на поле
	количества торговых единиц чтобы избежать ошибочного пересчета упаковок в штуки при дробном количестве упаковок.

	Подробно товарные корзины описаны на стр.~\pageref{sec-goodsbasket}.

	\item[\dlgflag{Традиционный режим выбора знака строки документа модификации}]

	\item[\dlgflag{В расширенном списке выбора товаров - полные наименования}]
	По умолчанию, в списках выбора товара отображаются сокращенные наименования. Если же этот флаг установлен,
	то в диалоге расширенного выбора товара отображаются полные наименования.

	\item[\dlgflag{Обрабатывать события телефонного сервиса}]
	Если у вас системан настроена на работу с телефонным сервисом, то установка этого флага включает интерфейсные
	функции взаимодействия с сервисом IP-телефонии.

	\item[\dlgradioc{Множественная печать документов}]
	Этот блок радио-кнопок позволяет переопределить для данного рабочего место опцию
	\dlgflag{Разрешить множественную печать первичных документов} конфигурации документов
	(см. стр.~\pageref{sec-bill-cfg}).
	\begin{description}
		\item[\dlgradioi{По общей конфигурации}]
		При таком выборе применяется установка флага из конфигурации документов.
		\item[\dlgradioi{Разрешить}]
		Разрешает множественную печать первичных документов.
		\item[\dlgradioi{Запретить}]
		Отключает возможность использовать множественную печать первичных документов.
	\end{description}

	\item[Количество элементов в списке]
	Поле, позволяющее указать количество элементов, отображаемых в списках выбора.

	Если у вас малоформатный монитор или, наоборот, высокий, то
	подстройте высоту списков значением в этом поле.

	\item[\dlgbutton{Шрифт таблиц}]
	Открывает стандартный диалог выбора шрифта.
	Этот шрифт будет использоваться для отображения данных в таблицах.

	На меню, диалоги и списки выбора эта опция не влияет.

	Справа от кнопки находится поле, в котором показываются параметры выбранного шрифта.

	\item[\dlgbutton{Шрифт списков}]
	Открывает диалог выбора шрифта для отображения символов в списках выбора.

	Справа от кнопки находится поле, в котором показываются параметры выбранного шрифта.
\end{description}

\chapter{Печать информации\label{ch-printing}}

Система \ppybrand{} позволяет получить в отпечатанном виде любой отчет или форму первичного документа.

Кроме собственно печати, система предоставляет инструменты для предварительного просмотра и экспорта данных.

В дистрибутив входит большое число готовых форм отчетов. При этом вы не ограничены только этими формами,
поскольку существуют средства настройки новых либо изменения существующих форм отчетов.

\ppyadmin{
	Система использует для печати данных модуль \trademark{Crystal Reports} версии 7.0 или выше.

	Если вы имеете в своем распоряжении систему дизайнера отчетов \trademark{Crystal Reports}, то
	можете самостоятельно настраивать формы отчетов.

	Формирование данных для печати реализуются внутренней подсистемой DL600, обеспечивающей средства
	кастомизации данных для печати.
}

\section{Использование печати}

Функция печати доступна практически из всех таблиц, из некоторых диалогов,
а также из окна вывода сообщений.

Как правило, печать осуществляется по нажатию клавиши \keyb{F7} либо выбору
соответствующей кнопки на панели инструментов или в диалоге.

Специализированные способы печати могут использовать иные комбинации клавиш.
Такие случаи разбираются отдельно в каждом конкретном случае.

Перед печатью на экране обычно появляется стандартный для всех разделов системы диалог установок печати.
Иногда ему могут предшествовать другие диалоги, например, диалог выбора формы печатаемого документа.

\ppypict{dlg-print}{Диалог печати}

Диалог печати (рис.~\ref{pic-dlg-print}) содержит следующие элементы:

\begin{description}
	\item[Переключатель выбора действия]
	Этот переключатель позволяет выбрать действие, которое вы собираетесь выполнить:
	\begin{description}
		\item[\dlgradioi{Печать}]
		Если нажать \dlgbutton{ОК} при таком выборе, то документ сразу отправится на принтер,
		установленный на вашем компьютере по умолчанию.

		\item[\dlgradioi{Экспорт}]
		Этот вариант позволяет преобразовать отчет в один из форматов, которые будут предложены вслед за выбором
		этой опции. Система может преобразовать отчет  в форматы Microsoft Word, Microsoft Excel, RTF, CSV и
		многие другие.

		Если для отчета, который должен быть отправлен на экспорт, заданы специальные опции
		экспорта с признаком $silent$ (см. ниже), то открывается для использования флаг
		\dlgflag{Отправить на электронную почту}. Включив этот флаг и указав адрес назначения,
		вы предпишете системе отправить файл отчета по данному адресу.

		\item[\dlgradioi{Предварительный просмотр}]
		При выборе этой опции внешний вид отчета будет показан на экране точно в том виде, в каком будет выведен
		на печать. Такая возможность бывает очень полезна при печати многостраничных отчетов (система позволит
		вам при этом отпечатать только выборочные страницы) для экономии времени и бумаги.

		\item[\dlgradioi{Экспорт в XML}]
		Выбрав этот вариант, вы заставите систему создать файл в формате XML.

		Файл имеет такое же имя, как и структура данных, по которой должен строиться отчет.
		Файл формируется в каталоге для исходящих файлов, определенном конфигурацией.

		Комментарии к полям файла можно увидеть в файле описания данных dd/ppexp.dl6.

		\item[\dlgradioi{Подготовка данных для конструирования отчета}]
		Создает файлы данных, необходимые для редактирования формы отчета в системе
		Crystal Reports.

		Поле под переключателем содержит путь к каталогу, в котором будут сформированы
		эти файлы. По умолчанию система использует каталог, определенный следующими
		правилами:
		\begin{itemize}
			\item Если в файле конфигурации pp.ini установлен каталог данных для отчетов
			(параметр [system] reportdatapath=path), то этот каталог будет применен как заголовочный.
			\item В противном случае, заголовочным каталогом будет тот, который определен как
			временный.
			\item Внутри заголовочного каталога создается (если не существует) подкаталог
			с именем структуры данных DL600, по которой должен строиться отчет.
		\end{itemize}

		\ppyexampletitlewidth{Пример}{0.8}{
			Если параметр reportdatapath=h:/reportdata, а структура данных для отчета
			называется PersonEvent, то полный путь к файлам данных для отчета по умолчанию
			будет h:/reportdata/personevent
		}

		Вы можете переопределить путь к создаваемым файлам по своему усмотрению.

		\item[\dlgradioi{Конструирование отчета}]
		Эта опция делает то же, что и предыдущая и в дополнение к этому вызывает
		редактор форм Crystal Reports.

		Если \ppybrand{} не может обнаружить на вашем компьютере установленный
		редактор отчетов, то данный вариант будет не доступен.
	\end{description}

	\item[\dlgcombo{Отчет}]
	Комбо-бокс позволяет выбрать один из нескольких альтернативных форм отчета, если это
	предусматривается конкретной настройкой.

	В поле ввода комбо-бокса отображается текстовое описание отчета, как оно определено
	в конфигурационном файле stdrpt.ini или report.ini.

	При выборе какого-либо варианта отчета служебные поля, расположенные под обсуждаемым
	комбо-боксом, отображают следующую информацию:
	\begin{itemize}
		\item Полный путь к файлу отчета
		\item Дату и время модификации файла отчета
		\item Наименование структуры данных DL600, используемое
		для печати отчета.
	\end{itemize}

	Эта информация может понадобиться в случае, если вы столкнетесь с какими-либо
	проблемами при печати отчета. В таком случае сообщите указанные здесь
	данные службе поддержки.

	\item[\dlgcombo{Принтер}]
	В этом комбо-боксе можно выбрать принтер, на который должен быть выведен
	отчет. В списке комбо-бокса отображаются все принтеры, установленные на
	компьютере, на котором запущен сеанс \ppybrand{}.

	Изначально в комбо-боксе ничего не выбрано.

	Фактически при пустом поле принтера печать будет идти на принтер по
	умолчанию. С другой стороны технически существует небольшая разница между
	печатью без явного выбора принтера и выбором принтера по умолчанию.
	Суть данного различия в том, что при явном выборе принтера в этом поле,
	программа сообщает подсистеме печати Crystal Reports о необходимости
	печатать на конкретный принтер, в то время как в противном случае Crystal
	Reports самостоятельно выбирает принтер. Это может (с небольшой вероятностью)
	повлиять на применяемые опции печати.

	\item[Количество копий]
	Если вы выбираете действие \dlgradioi{Печать}, то в этом поле можно установить
	количество экземпляров отчета, которое должно быть отправлено на принтер.

	Для остальных действий это поле не значимо.
\end{description}

\section{Настройка печати}

Этот раздел адресован системным администраторам и людям, занимающимся поддержкой системы.

\subsection{Терминология}

	\paragraph{Стандартный отчет}
	Форма отчета, поставляемая вместе с дистрибутивом системы. Все стандартные отчеты хранятся в каталоге BIN/RPT.
	При обновлении версии системы стандартные отчеты могут быть заменены процедурой инсталляции без предупреждения.
	Поэтому, если вы меняете какой-либо из стандартных отчетов, не следует оставлять его в этом каталоге.

	\paragraph{Локальный отчет}
	Форма отчета, имеющая имя, совпадающее с именем стандартного отчета, но отличающееся по виду
	от стандартной формы и хранимая в специальном подкаталоге BIN/RPT/LOCAL.

	При печати какого-либо отчета, система ищет файл этого отчета сначала в каталоге BIN/RPT/LOCAL.
	Если искомая форма найдена в этом каталоге, то для печати используется она, в противном случае
	используется стандартная форма.

	При обновлении версии системы каталог локальных форм не затрагивается, поэтому измененные
	формы отчетов утеряны не будут.

	\paragraph{Альтернативный отчет}
	Отчет, который может быть распечатан наряду со стандартным или локальным простым выбором в поле
	\qu{Вид отчета} диалога печати, описанного в предыдущем пункте.
	В отличие от локального отчета, который замещает стандартный, альтернативный отчет не лишает
	пользователя возможности пользоваться стандартной формой.

	\paragraph{Структура данных DL600}
	Описание данных для отчета с использованием специального языка. В подавляющем большинстве случаев
	структуры данных, поставляемые с дистрибутивом системы, удовлетворяют требованиям, предъявляемым пользователями.
	В редких случаях, когда это не так, структуры данных можно адаптировать под нужды пользователей.

\subsection{Локальные отчеты}

Система позволяет изменять стандартные отчеты, превращая их в локальные, и печатать измененные локальные
отчеты вместо стандартных. При печати система ищет требуемый файл отчета сначала в каталоге BIN/RPT/LOCAL и,
если не находит его там, обращается к каталогу BIN/RPT.

Таким образом, если вы хотите изменить форму одного из стандартных отчетов, скажем Invoice, то скопируйте файл
Invoice.rpt из каталога BIN/RPT в каталог BIN/RPT/LOCAL, и изменяйте его уже в этом каталоге. Благодаря этому,
при очередном обновлении версии системы, изменения, вносимые вами в файл отчета, не будут потеряны.

\ppynote{
	Если структура данных, по которому строится локальный отчет изменилась в новой версии, то этот локальный отчет
	следует верифицировать.

	Сведения об измененных структурах данных содержатся в файле DOC/Version.txt.
}

\subsection{Файлы определения отчетов}

Перед тем, как рассказать об альтернативных отчетах и способах фиксации параметров экспорта отчетов, необходимо
разъяснить, что такое файлы определения отчетов.

Для того, чтобы система могла идентифицировать когда и какой файл отчета использовать, а также связать файл отчета
со структурой данных, которой этот отчет соответствует, используются файлы определения отчетов. Их всего два:
BIN/StdRpt.ini и BIN/Report.ini. Оба файла имеют текстовый формат, аналогичный ini-файлам системы Windows.

\subsubsection{Файл stdrpt.ini}

Этот файл поставляется с дистрибутивом системы. Поэтому, при каждом обновлении
версии системы, он заменяется на новый. В связи с этим не следует менять этот
файл самостоятельно за исключением очень редких случаев, когда это действительно
необходимо. При этом обязательно сохраняйте копию измененного вами файла.

Файл stdrpt.ini состоит из зон, каждая из которых описывает один стандартный отчет. Формат описания следующий:

\ppysrc{
	[$ReportName$] \\
	\underline{$ModifDate$}=date \\
	\underline{$Data$}=StructName \\
	\underline{$Descr$}=Description
}

Здесь слова, выделенные подчеркиванием - параметры.

\begin{description}
	\item[$ReportName$]
	имя файла отчета без пути и расширения.
	\item[$Date$]
	дата последней модификации описания этой зоны.
	\item[$StructName$]
	наименование структуры данных, используемой отчетом.
	\item[$Description$]
	краткий текст описания файла отчета. Этот текст
	высвечивается в диалоге печати.
\end{description}

\ppyexampletitle{Пример описания отчета}{
	\ppysrc{
		[Invoice] \\
		ModifDate=13/03/2004 \\
		data=InvoiceData \\
		descr=Счет-фактура \\
	}
}

\subsubsection{Файл report.ini}

Этот файл, как и предыдущий, находится в подкаталоге BIN каталога системы. В файле report.ini
определяются альтернативные отчеты и параметры экспорта.

Файл разделен на зоны по именам отчетов. Формат этих зон следующий:

\ppysrc{
	[ReportName] \\
	ReportFilePath=Description;StructName \\
	\underline{Format}=xls,1 \\
	\underline{Destination}=Application,c:/temp\$\$\$.xls \\
	\underline{Silent}=1 \\
}

Здесь слова, выделенные подчеркивание - параметры.

Первая строка определяет альтернативную форму отчета. Таких строк на каждое наименование отчета
может быть несколько.

Строка состоит из следующих элементов:

\begin{description}
	\item[ReportFilePath]
	Путь к файлу альтернативного отчета. Это должен быть либо полный путь
	(например, h:/ppy/bin/rpt/local/invoice2.rpt), либо путь, заданный относительно подкаталога
	BIN основного каталога системы (например, rpt/local/invoice2.rpt).
	Если система не обнаружит файл по заданному пути, то вся строка будет проигнорирована без
	сообщений об ошибке.
	\item[Description]
	Краткое текстовое описание отчета, которое будет высвечиваться в диалоге выбора формы отчета.
	\item[StructName]
	Необязательный параметр, указывающий какую структуру данных система должна использовать для печати
	этой формы отчета. Если структура не указывается, то точка с запятой, предшествующая этому параметру
	также опускаются %
	\ppynote{
		Указанная здесь структура данных должна иметь общего предка с основной структурой отчета.
	}
\end{description}

\ppyexample{
	\ppysrc{
		\newline [GoodsBill]
		\newline h:/ppy/rpt/local/goodsbillz.rpt=Счет заказа
		\newline h:/ppy/rpt/local/goodsbillt.rpt=Товарный чек
		\newline h:/ppy/rpt/local/plabelsmall1.rpt=Ценник малый;GoodsBillData2
	}
}

Параметры Format, Destination и Silent определяют фиксацию опций экспорта.

\begin{description}
	\item[Format]
	Обозначение формата, в котором следует экспортировать отчет с дополнительными параметрами,
	следующими после обозначения формата и друг после друга через запятую. См ниже.

	\item[Destination]
	Назначение экспорта:
	\begin{description}
		\item[Application, FilePath]
		Экспортировать в файл FilePath и сразу запустить приложение, открывающее этот файл.
		В имени файла следует указывать расширение, по скольку приложение, которое должно быть
		запущено, идентифицируется именно по расширению файла.
		\item[Disk, FilePath] Просто экспортировать в файл с именем FilePath.

		Если $FilePath$ не указан, то экспорт будет осуществлен в каталог $OUT$, а имя файла
		будет иметь вид exp00000.ext, где $ext$ - расширение, определяемое форматом экспорта,
		а $00000$ заменяется на уникальный для этого каталога номер.

		Если указанный $FilePath$ является каталогом, то имя файла формируется так же,
		как описано выше, но вывод осуществляется в заданный каталог.

		Если указано имя файла без пути или с относительным путем, то полный путь
		результирующего файла определяется относительно текущего рабочего каталога.
	\end{description}

	\item[Silent]
	Этот параметр может принимать значение 0 или 1. В первом случае экспорт будет осуществляться %
	также, как будто никакие параметры фиксации экспорта не заданы.

	Значение 1 позволяет автоматически передать сформированный файл по адресу
	электронной почты, указанному в диалоге печати.
\end{description}

Следующая таблица перечисляет все допустимые обозначения форматов и соответствующие им параметры.

\begin{description}
	\item[WordWin] \trademark{Microsoft Word}.

	\item[Text] Текстовый файл.

	\item[Pdf] Файл в формате Pdf.

	\item[RichText] Rich Text Format (RTF).

	\item[CommaSeparated] Текстовый файл со значениями разделенными запятыми.

	Параметры:
	\begin{enumerate}
		\item использовать формат даты такой же, как в отчете (1 - да, 0 - нет)
		\item использовать числовой формат такой же, как в отчете (1 - да, 0 - нет)
	\end{enumerate}

	\item[TabSeparated] Текстовый файл со значениями разделенными символами табуляции.

	Параметры:
	\begin{enumerate}
		\item использовать формат даты такой же, как в отчете (1 - да, 0 - нет)
		\item использовать числовой формат такой же, как в отчете (1 - да, 0 - нет)
	\end{enumerate}

	\item[CharSeparated]
	Текстовый файл со значениями, разделенными символами, определяемыми дополнительными параметрами.

	Параметры:
	\begin{enumerate}
		\item использовать формат даты такой же как в отчете (1 - да, 0 - нет)
		\item использовать числовой формат такой же как в отчете (1 - да, 0 - нет)
		\item разделитель строк (символ)
		\item разделитель полей (строка символов)
	\end{enumerate}

	\item[Xls]
	Файл электронных таблицы \trademark{Microsoft Excel}.

	Параметры:
	\begin{enumerate}
		\item экспортировать заголовки (1 - да, 0 - нет)

		\item все объекты одной области в строку (1 - да, 0 - нет)

		\item постоянная ширина колонок (1 - да, 0 - нет)

		\item если параметр \qu{постоянная ширина колонок} имеет значение 0 и параметр
		\qu{ширина колонок основана на} имеет значение 3 или 5, то этот параметр номер
		группы - по умолчанию задавать 1

		\item ширина колонок основана на
		\begin{description}
			\item[1] заголовке отчета,
			\item[2] заголовке страницы,
			\item[3] заголовке группы,
			\item[4] теле отчета,
			\item[5] нижней части группы,
			\item[6] нижней части страницы,
			\item[7] нижней части отчета
		\end{description}
		по умолчанию - 4

		\item постоянная ширина колонок (число, используется если параметр
		\qu{постоянная ширина колонок} - 1)
	\end{enumerate}
\end{description}

Если вы хотите задать фиксацию параметров экспорта для всех отчетов, то определите их в зоне [default].
В этом случае, если для какого-либо отчета параметры экспорта не заданы, то используются параметры из этой зоны.

\subsection{Автоматическая генерация файлов данных}

В ряде случаев возникает необходимость в верификации отчетов Crystal Reports в
соответствии с изменившимися структурами данных DL600. Если речь идет об одном
отчете, то это легко реализуется с помощью штатного диалога печати.
В том же случае, когда необходимо верифицировать большое количество отчетов
поможет специальная функция генерации пустых файлов данных для отчетов.

Для вызова функции обратитесь к пункту меню \ppymenu{Справочники\rdir Админ\rdir Создание файлов для Win32 отчетов}.
На экране вы увидите диалог в котором два поля:

\begin{description}
	\item[Наименование отчета]
	В этом поле следует ввести имя отчета. Обращаем внимание
	на то, что речь идет именно об имени отчета, а не о наименовании структуры данных
	DL600. Так для стандартной счета-фактуры следует ввести Invoice (регистр символов не важен).

	Если вы хотите, чтобы система сформировала файлы данных для всех отчетов,
	зарегистрированных в системе, то наберите в этом поле $ALL$.

	\item[Каталог данных]
	Головной каталог, внутри которого будут создаваться каталоги с файлами данных.
	По умолчанию система устанавливает здесь путь к каталогу, определенному
	параметром

	[system] reportdatapath

	в файле конфигурации pp.ini.

	Если этот параметр не определен, то будет предложен каталог временных
	файлов, действующий для текущего сеанса системы.

	Естественно, вы можете выбрать любой каталог, который хотите (важно лишь
	чтобы к нему был доступ на запись и чтение). Если каталог, заданный
	в этом поле не существует, то функция создаст его.
\end{description}

\chapter{Универсальные концепции\label{ch-concepts-u}}

До того, как мы приступим к рассмотрению различных инструментов системы, ориентированных на
выполнение конкретных задач, необходимо остановиться на ряде универсальных понятий,
свойственных многим объектам данных.

\section{Теги объектов}

Система \ppybrand{} оперирует значительным количеством объектов данных (эта концепция рассмотрена на стр.~\pageref{sec-ppobject-concept}).
Каждый тип объекта данных определяется собственным встроенным набором атрибутов.
Для расширения этого набора применяется механизм тегов объектов.

Общий принцип работы тегов состоит в том, что вы определяете типы тегов, свойственные для данного
типа объекта (теги персоналий, теги товаров и т.д.). К объектам же привязываете
теги, относящиеся к заданным типам.

Например, вы можете определить тег персоналии \qu{Надежность плательщика} и к каким-либо
клиентам привязывать оценку надежности его как плательщика.

На текущий момент теги можно привязывать к следующим объектам данных:
\begin{itemize}
	\item Персоналии
	\item Локации
	\item Товары
	\item Документы
	\item Лоты
	\item Глобальные учетные записи
	\item Интернет-магазины Universe-HTT
\end{itemize}

\subsection{Типы тегов}
Каждый прикрепленный к конкретному объекту тег должен относиться к предварительно
определенному типу тега.

Для редактирования типов тегов используются следующие команды меню:
\begin{description}
	\item[Персоналии]                \ppymenu{Справочники\rdir Админ\rdir Теги объектов\rdir Теги персоналий}
	\item[Товары]                    \ppymenu{Справочники\rdir Админ\rdir Теги объектов\rdir Теги товаров}
	\item[Документы]                 \ppymenu{Справочники\rdir Админ\rdir Теги объектов\rdir Теги документов}
	\item[Лоты]                      \ppymenu{Справочники\rdir Админ\rdir Теги объектов\rdir Теги лотов}
	\item[Глобальные учетные записи] \ppymenu{Справочники\rdir Админ\rdir Теги объектов\rdir Теги глобальных учетных записей}
\end{description}

При вызове любого из перечисленных пунктов меню открывается список просмотра типов тегов соответствующего
объекта данных.

\subsubsection{Типы значений тегов}

Главное применение тегов - привязка настраиваемых значений к объектам данных.
Эти значения могут иметь различные типы. Вот полный список возможных типов
значений тегов с кратким описанием:
\begin{description}
	\item[Логический]
	Такой тег может иметь только два значения: \ppyrsrv{ИСТИНА} или \ppyrsrv{ЛОЖЬ}.

	\item[Строка]
	Тег ассоциирует с объектом строки длиной до 127 символов (включительно).

	\item[Число]
	Вещественное число.

	\item[Перечисление]
	Такой тег связывает с объектом один из предварительно настроенных вариантов выбора.

	Варианты перечисляемого тега хранятся как динамические объекты данных.

	\item[Дата]
	Календарная дата.

	\item[Метка времени]
	Комбинация дата/время.

	\ppyadmin{
		Значение метки времени хранится в формате Microsoft Ole (как число
		с плавающей точкой двойной точности).
	}

	\item[Объект]
	Значением тега является ссылка на объект данных из этой же базы данных.

	Пока применение данного типа ограничено: может быть использовано только для лотов
	и связанным объектом может быть лишь персоналия и сертификат качества.

	\item[GUID]
	Глобально уникальный идентификатор.

	\item[Изображение]
	Файл изображения.
\end{description}

\subsubsection{Параметры типа тега}

\ppypict{dlg-objtag}{Диалог редактирования типа тега}

Диалог редактирования записи типа тега приведен на рис.~\ref{pic-dlg-objtag}. Далее
приводится описание управляющих элементов этого диалога.

Необходимо заметить, что при создании нового типа тега, данному диалогу предшествует
выбор типа значения, который будет использоваться для создаваемого тега. После
создания менять тип значения тега нельзя.

\begin{description}
	\item[Идентификатор]
	Обычный для всех объектов данных атрибут, используемый для внутренней идентификации
	экземпляра тега.

	\item[Наименование]
	Уникальное среди всех типов тегов наименование.

	\item[Символ]
	Символьное обозначение типа тега, используемое для доступа к тегам
	из внешних программ и для импорта/экспорта.

	Символ может быть пустым, но если он указан, то система проследит за
	его уникальностью.

	\item[\dlgcombo{Группа}]
	Типы тегов могут быть выстроены в иерархию. То есть, программа допускает
	создание групп тегов и опциональной привязки тегов к группам.

	В этом комбо-боксе может быть выбрана группа, которой должен принадлежать
	данный тип тега.

	\item[\dlgflag{Извещать о нулевом или отрицательном значении}]
	Специализированный флаг, используемый только при создании персонального
	события командой рабочего стола.

	\item[\dlgflag{Наследуемый}]
	Флаг применяется пока только для тегов лотов. Если установлен, то при вводе
	новой строки приходного товарного документа, если последний лот выбранного товара
	содержит тег такого типа, то новая строка автоматически получит такой же тег
	с аналогичным значением.
	\item[\dlgflag{Извещение в кассовой панели}]
	что-то
	\item[\dlgflag{Иерархическое перечисление}]
	что-то
	\item[Тип]
	Наименование типа значения тега. Как упоминалось выше, тип значения нельзя менять
	после создания нового тега. Поэтому, данное поле не допускает радактирования.

	\item[\dlgcombo{Группа объектов}]
	Этот комбо-бокс доступен только для тегов с типом значения \ppyrsrv{Объект}.
	Группа объектов позволяет уточнить набор объектов, с которым может быть связано
	значение тега. Для тегов, связанных с персоналиями, группа объектов позволяет
	выбрать вид персоналии.

	\item[\dlgbutton{Элементы перечисления}]
	Кнопка доступна только для тегов с типом значений \ppyrsrv{Перечисление}.
	Нажатие кнопки открывает для редактирования список элементов перечисления.
\end{description}

\subsection{Значения тегов}

\ppypict{dlg-tagvallist}{Список значений тегов}

Значения тегов объекта обычно отображаются для просмотра и редактирования в виде списка, изображенного на рис.~\ref{pic-dlg-tagvallist}.
Кнопки \dlgbutton{Редакт}, \dlgbutton{Добавить}, \dlgbutton{Удалить} служат, соответственно, для редактирования, создания и удаления элементов списка.

Перед созданием нового тега объекта программа запрашивает тип, предлагая список выбора, в котором перечислены типы тегов,  определенные для объекта данных
(для товаров, персоналий и т.д.).

Диалог редактирования тега зависит от выбранного типа тега. Для примера на рис.~\ref{pic-dlg-tagvlnk} приведен вид диалога редактирования перечисляемого тега.

\ppypict{dlg-tagvlnk}{Диалог редактирования значения перечисляемого тега}.

\subsection{Фильтр значений тегов\label{sec-tagv-filt}}

Фильтр значений тегов является вспомогательным инструментом, включаемым в состав других фильтров для отбора объектов, теги которых удовлетворяют заданным
критериям. Так, фильтрация по тегам включена в фильтр товаров (стр.~\pageref{sec-filt-goods}), персоналий (стр.~\pageref{sec-filt-person}), лотов (стр.~\pageref{sec-ppview-lots}).

Кроме, собственно, фильтрации, фильтр тегов применяется для индикации объектов, чьи теги соответствуют заданным критериям, в таблицах.

\ppypict{dlg-f-tagv}{Диалог фильтра значений тегов}

Диалог фильтра по тегам выглядит так, как показано на рис.~\ref{pic-dlg-f-tagv}. Поясним назначение управляющих элементов этого диалога:
\begin{description}
	\item[Список тегов и ограничений] Список, в котором отображаются установленные ограничения.
	\item[\dlgbutton{Добавить}] Создать новое ограничение.
	\item[\dlgbutton{Редакт}] Изменить выбранное ограничение.
	\item[\dlgbutton{Удалить}] Удалить выбранное ограничение.
	\item[\dlgbutton{Очистить}] Удалить все ограничения.
	\item[\dlgbutton{Вверх}] Кнопка для перемещения выбранного ограничения вверх по списку. Имеет смысл для фильтров, определяющих правила
	индикации объектов в зависимости от заданных здесь критериев. Критерий, находящийся выше по списку имеет более высокий приоритет, чем
	нижестоящие.
	\item[\dlgbutton{Вниз}] Кнопка для перемещения выбранного ограничения вниз по списку. Назначение аналогично кнопке \dlgbutton{Вверх}, но
	с обратными смыслом.
	\item[\dlgflag{Отсутствие данных тегов}] Установка этого флага предписывает системе выбирать только те объекты, для которых отсутствуют все
	указанные в списке теги. При этом ограничения, естественно, игнорируются - принимаются во внимание только перечисленные типы тегов.

	Для фильтров правил индикации этот флаг игнорируется.
\end{description}

%topic(DLG_SELTAG)

\ppypict{dlg-tagvcritlnk}{Диалог критерия значения тега}

На рис.~\ref{pic-dlg-tagvcritlnk} показан диалог одного критерия фильтра значений тегов.

\begin{description}
	\item[\dlgcombo{Тег}] Тег, для которого указывается критерий фильтрации.
	\item[Подсказка] Справочный текст, подсказывающий формат ввода ограничений в зависимости от типа значения тега.
	\item[Ограничение] Текстовое поле, в котором вводится ограничение или отображается выбранный из списка критерий.
	\item[\dlgbutton{...}] Для перечисляемых тегов и тегов, ссылающихся на другие объекты данных, по этой кнопке можно
	выбрать значение, которым должно присутствовать в теге объекта, дабы он удовлетворял фильтру.
	\item[\dlgradioc{Выбор специальных критериев}]
		Блок радио-кнопок, позволяющий выбрать специальный критерий фильтрации по тегу:
		\begin{description}
			\item[Ограничение] При этом варианте работает обыкновенный критерий выбора тега по введенному
			в поле \ppyrsrv{Ограничение} ограничению.
			\item[Пустой] Этот вариант предписывает системе считать условие удовлетворенным, если тег по
			объекту имеет пустое значение либо не имеет тега заданного типа вообще.
			\item[Существующий] При этом варианте условие считается удовлетворенным, если объект имеет тег
			заданного типа независимо от значения этого тега.
		\end{description}

	\item[Цвет] Цвет применяется для правил индикации. Выбранный здесь цвет будет применяться для выделения объектов,
	удовлетворяющих данному критерию.
\end{description}

%endtopic

\subsection{Зарезервированные и специальные теги}

Здесь мы задокументируем зарезервированные теги объектов, то есть те, о которых система \qu{знает} (считает, что тег с такими-то
идентификатором имеет точно определенный смысл). И, так же, специальные теги, которые не имеют зарезервированных идентификаторов,
но на которые какие-либо компоненты системы могут ссылаться по заранее определенному символу.

\subsubsection{Зарезервированные теги\label{reservedobj-teg}}
Эти теги создаются автоматически командой \ppymenu{Создание зарезервированных объектов}.

\begin{description}
	\item[Права агента на доступ к кассовым операциям]

		ИД=4
		\\Символ = \ppyrsrv{POSRIGHTS}
		\\Тип объекта = \ppyrsrv{PERSON}
		\\Тип тега = \ppyrsrv{STRING}
	\item[Дата рождения]

		ИД=5
		\\Символ = \ppyrsrv{DOB}
		\\Тип объекта = \ppyrsrv{PERSON}
		\\Тип тега = \ppyrsrv{DATE}
	\item[Права на доступ и изменение товаров]

		ИД=10
		\\Символ = \ppyrsrv{GOODSRIGHTS}
		\\Тип объекта = \ppyrsrv{GLOBALUSER}
		\\Тип тега = \ppyrsrv{STRING}
	\item[Права на доступ и изменение персоналий]

		ИД=11
		\\Символ = \ppyrsrv{PERSONRIGHTS}
		\\Тип объекта = \ppyrsrv{GLOBALUSER}
		\\Тип тега = \ppyrsrv{STRING}
	\item[Права на доступ и изменение персональных карт]

		ИД=12
		\\Символ = \ppyrsrv{SCARDRIGHTS}
		\\Тип объекта = \ppyrsrv{GLOBALUSER}
		\\Тип тега = \ppyrsrv{STRING}
	\item[Префикс номеров персональных карт]

		ИД=13
		\\Символ = \ppyrsrv{SCARDPREFIX}
		\\Тип объекта = \ppyrsrv{GLOBALUSER}
		\\Тип тега = \ppyrsrv{STRING}
	\item[Дата производства]

		ИД=14
		\\Символ = \ppyrsrv{MANUFTIME}
		\\Тип объекта = \ppyrsrv{LOT}
		\\Тип тега = \ppyrsrv{TIMESTAMP}
	\item[Права на доступ к файлам]

		ИД=15
		\\Символ = \ppyrsrv{FILESRIGHTS}
		\\Тип объекта = \ppyrsrv{GLOBALUSER}
		\\Тип тега = \ppyrsrv{STRING}
	\item[UUID документа]

		ИД=16
		\\Символ = \ppyrsrv{BILLUUID}
		\\Тип объекта = \ppyrsrv{BILL}
		\\Тип тега = \ppyrsrv{UUID}
	\item[Ключевые слова товара]

		ИД=17
		\\Символ = \ppyrsrv{GOODSKEYWORDS}
		\\Тип объекта = \ppyrsrv{GOODS}
		\\Тип тега = \ppyrsrv{STRING}
	\item[Ключевые слова документа]

		ИД=18
		\\Символ = \ppyrsrv{BILLKEYWORDS}
		\\Тип объекта = \ppyrsrv{BILL}
		\\Тип тега = \ppyrsrv{STRING}
	\item[Символ тега приватной товарной группы]

		ИД=19
		\\Символ = \ppyrsrv{PGGTAGSYMB}
		\\Тип объекта = \ppyrsrv{GLOBALUSER}
		\\Тип тега = \ppyrsrv{STRING}
	\item[Ключевые слова рабочих книг]

		ИД=20
		\\Символ = \ppyrsrv{WORKBOOKKEYWORDS}
		\\Тип объекта = \ppyrsrv{WORKBOOK}
		\\Тип тега = \ppyrsrv{STRING}
	\item[Синонимы ключевых слов рабочих книг]

		ИД=21
		\\Символ = \ppyrsrv{WORKBOOKKWSYN}
		\\Тип объекта = \ppyrsrv{WORKBOOK}
		\\Тип тега = \ppyrsrv{STRING}
	\item[Локации ключевых слов рабочих книг]

		ИД=22
		\\Символ = \ppyrsrv{WORKBOOKKWLOC}
		\\Тип объекта = \ppyrsrv{WORKBOOK}
		\\Тип тега = \ppyrsrv{STRING}
	\item[UUID сессии, создавшей JUNK-чек]

		ИД=23
		\\Символ = \ppyrsrv{CCHECKJSUUID}
		\\Тип объекта = \ppyrsrv{CCHECK}
		\\Тип тега = \ppyrsrv{UUID}
	\item[Права на доступ и изменение автономных адресов]

		ИД=24
		\\Символ = \ppyrsrv{SALOCRIGHTS}
		\\Тип объекта = \ppyrsrv{GLOBALUSER}
		\\Тип тега = \ppyrsrv{STRING}
	\item[Права на доступ и изменение рабочих книг]

		ИД=25
		\\Символ = \ppyrsrv{WORKBOOKRIGHTS}
		\\Тип объекта = \ppyrsrv{GLOBALUSER}
		\\Тип тега = \ppyrsrv{STRING}
	\item[Длинный код рабочей книги]

		ИД=26
		\\Символ = \ppyrsrv{WORKBOOKLONGCODE}
		\\Тип объекта = \ppyrsrv{WORKBOOK}
		\\Тип тега = \ppyrsrv{STRING}
	\item[Метка автоматически созданного документа]

		ИД=27
		\\Символ = \ppyrsrv{BILLAUTOCREATION}
		\\Тип объекта = \ppyrsrv{BILL}
		\\Тип тега = \ppyrsrv{STRING}
	\item[Номер документа у контрагента]

		ИД=28
		\\Символ = \ppyrsrv{BILLOUTERCODE}
		\\Тип объекта = \ppyrsrv{BILL}
		\\Тип тега = \ppyrsrv{STRING}
	\item[Дата документа у контрагента]

		ИД=29
		\\Символ = \ppyrsrv{BILLOUTERDATE}
		\\Тип объекта = \ppyrsrv{BILL}
		\\Тип тега = \ppyrsrv{DATE}
	\item[Идент получателя эл налоговых документов]

		ИД=30
		\\Символ = \ppyrsrv{ENALOGDEST}
		\\Тип объекта = \ppyrsrv{PERSON}
		\\Тип тега = \ppyrsrv{STRING}
	\item[ФИАС-GUID адреса]

		ИД=31
		\\Символ = \ppyrsrv{FIASGUIDADR}
		\\Тип объекта = \ppyrsrv{LOCATION}
		\\Тип тега = \ppyrsrv{UUID}
	\item[ФИАС-GUID здания]

		ИД=32
		\\Символ = \ppyrsrv{FIASGUIDHSE}
		\\Тип объекта = \ppyrsrv{LOCATION}
		\\Тип тега = \ppyrsrv{UUID}
	\item[Права на доступ и изменение устройств Stylo]

		ИД=33
		\\Символ = \ppyrsrv{STYLORIGHTS}
		\\Тип объекта = \ppyrsrv{GLOBALUSER}
		\\Тип тега = \ppyrsrv{STRING}
	\item[Права на доступ и изменение процессоров]

		ИД=34
		\\Символ = \ppyrsrv{PRCRIGHTS}
		\\Тип объекта = \ppyrsrv{GLOBALUSER}
		\\Тип тега = \ppyrsrv{STRING}
	\item[Права на доступ и изменение технологических сес]

		ИД=35
		\\Символ = \ppyrsrv{TSESSRIGHTS}
		\\Тип объекта = \ppyrsrv{GLOBALUSER}
		\\Тип тега = \ppyrsrv{STRING}
	\item[UUID технологической сессии]

		ИД=36
		\\Символ = \ppyrsrv{TSESSUUID}
		\\Тип объекта = \ppyrsrv{TSESSION}
		\\Тип тега = \ppyrsrv{UUID}
	\item[Описание технологической сессии]

		ИД=37
		\\Символ = \ppyrsrv{TSESSDESCR}
		\\Тип объекта = \ppyrsrv{TSESSION}
		\\Тип тега = \ppyrsrv{STRING}
	\item[ФСРАР идентификатор склада]

		ИД=38
		\\Символ = \ppyrsrv{FSRARIDLOC}
		\\Тип объекта = \ppyrsrv{LOCATION}
		\\Тип тега = \ppyrsrv{STRING}
	\item[ФСРАР идентификатор предприятия]

		ИД=39
		\\Символ = \ppyrsrv{FSRARIDORG}
		\\Тип объекта = \ppyrsrv{PERSON}
		\\Тип тега = \ppyrsrv{STRING}
	\item[ФСРАР код справки А]

		ИД=41
		\\Символ = \ppyrsrv{FSRARINFALOTCODE}
		\\Тип объекта = \ppyrsrv{LOT}
		\\Тип тега = \ppyrsrv{STRING}
	\item[ФСРАР код справки Б]

		ИД=42
		\\Символ = \ppyrsrv{FSRARINFBLOTCODE}
		\\Тип объекта = \ppyrsrv{LOT}
		\\Тип тега = \ppyrsrv{STRING}
	\item[ФСРАР код товара в лоте]

		ИД=43
		\\Символ = \ppyrsrv{FSRARLOTGOODSCODE}
		\\Тип объекта = \ppyrsrv{LOT}
		\\Тип тега = \ppyrsrv{STRING}
	\item[EDI подтверждение доставки документа]

		ИД=44
		\\Символ = \ppyrsrv{EDIACKBILL}
		\\Тип объекта = \ppyrsrv{BILL}
		\\Тип тега = \ppyrsrv{STRING}
	\item[EDI идентификатор документа]

		ИД=45
		\\Символ = \ppyrsrv{EDIIDENTBILL}
		\\Тип объекта = \ppyrsrv{BILL}
		\\Тип тега = \ppyrsrv{STRING}
	\item[URL сервера ЕГАИС (склад)]

		ИД=46
		\\Символ = \ppyrsrv{EGAISSRVURL}
		\\Тип объекта = \ppyrsrv{LOCATION}
		\\Тип тега = \ppyrsrv{STRING}
	\item[ФСРАР данные справки А]

		ИД=47
		\\Символ = \ppyrsrv{EGIASINFAREG}
		\\Тип объекта = \ppyrsrv{LOT}
		\\Тип тега = \ppyrsrv{STRING}
	\item[URL сервера ЕГАИС (главная организация)]

		ИД=48
		\\Символ = \ppyrsrv{EGAISSRVURLMP}
		\\Тип объекта = \ppyrsrv{PERSON}
		\\Тип тега = \ppyrsrv{STRING}
	\item[EDI RECADV CONFIRM]

		ИД=49
		\\Символ = \ppyrsrv{EDIRECADVCONFIRM}
		\\Тип объекта = \ppyrsrv{BILL}
		\\Тип тега = \ppyrsrv{UUID}
	\item[Размерности лота]

		ИД=50
		\\Символ = \ppyrsrv{DIMENTIONS}
		\\Тип объекта = \ppyrsrv{LOT}
		\\Тип тега = \ppyrsrv{STRING}
	\item[EDI подтверждение отмены документа]

		ИД=51
		\\Символ = \ppyrsrv{EDIREJECTACKBILL}
		\\Тип объекта = \ppyrsrv{BILL}
		\\Тип тега = \ppyrsrv{STRING}
	\item[EDI канал доставки документа]

		ИД=53
		\\Символ = \ppyrsrv{EDICHANNEL}
		\\Тип объекта = \ppyrsrv{BILL}
		\\Тип тега = \ppyrsrv{STRING}
	\item[EDI ответ на запрос об отмене документа]

		ИД=54
		\\Символ = \ppyrsrv{EDIREPEALACK}
		\\Тип объекта = \ppyrsrv{BILL}
		\\Тип тега = \ppyrsrv{STRING}
	\item[EDI проблемные товарные строки]

		ИД=55
		\\Символ = \ppyrsrv{EDIPROBLEMTRFR}
		\\Тип объекта = \ppyrsrv{BILL}
		\\Тип тега = \ppyrsrv{STRING}
	\item[Серийный номер исходного лота]

		ИД=56
		\\Символ = \ppyrsrv{SOURCESERIAL}
		\\Тип объекта = \ppyrsrv{LOT}
		\\Тип тега = \ppyrsrv{STRING}
	\item[UUID персоналии]

		ИД=57
		\\Символ = \ppyrsrv{PERSONUUID}
		\\Тип объекта = \ppyrsrv{PERSON}
		\\Тип тега = \ppyrsrv{UUID}
	\item[UUID локации]

		ИД=58
		\\Символ = \ppyrsrv{LOCUUID}
		\\Тип объекта = \ppyrsrv{LOCATION}
		\\Тип тега = \ppyrsrv{UUID}
	\item[Формальное основание документа]

		ИД=59
		\\Символ = \ppyrsrv{FORMALREASON}
		\\Тип объекта = \ppyrsrv{BILL}
		\\Тип тега = \ppyrsrv{ENUM}

	\item[EDI запрос на отмену проведения документа]

		ИД=60
		\\Символ = \ppyrsrv{EDIREPEALREQ}
		\\Тип объекта = \ppyrsrv{BILL}
		\\Тип тега = \ppyrsrv{STRING}
	\item[UUID кассового узла]

		ИД=61
		\\Символ = \ppyrsrv{POSNODEUUID}
		\\Тип объекта = \ppyrsrv{POSNODE}
		\\Тип тега = \ppyrsrv{UUID}
	\item[UUID управляющего кассового узла]

		ИД=62
		\\Символ = \ppyrsrv{POSNODEHOSTUUID}
		\\Тип объекта = \ppyrsrv{POSNODE}
		\\Тип тега = \ppyrsrv{UUID}
	\item[Ид государственного контракта]

		ИД=63
		\\Символ = \ppyrsrv{STATECONTRACTID}
		\\Тип объекта = \ppyrsrv{BILL}
		\\Тип тега = \ppyrsrv{STRING}
	\item[Ид участника эл документооборота nalog.ru]

		ИД=64
		\\Символ = \ppyrsrv{ENALOGID}
		\\Тип объекта = \ppyrsrv{PERSON}
		\\Тип тега = \ppyrsrv{STRING}
	\item[Формальная ссылка на комплементарный документ]

		ИД=65
		\\Символ = \ppyrsrv{BILLCOMPLEMENTARY}
		\\Тип объекта = \ppyrsrv{BILL}
		\\Тип тега = \ppyrsrv{STRING}
	\item[ВЕТИС идентификатор предприятия]

		ИД=66
		\\Символ = \ppyrsrv{PERSONVETISUUID}
		\\Тип объекта = \ppyrsrv{PERSON}
		\\Тип тега = \ppyrsrv{UUID}
	\item[Имя для авторизации]

		ИД=67
		\\Символ = \ppyrsrv{GUALOGIN}
		\\Тип объекта = \ppyrsrv{GLOBALUSER}
		\\Тип тега = \ppyrsrv{STRING}
	\item[UUID товара]

		ИД=68
		\\Символ = \ppyrsrv{GOODSUUID}
		\\Тип объекта = \ppyrsrv{GOODS}
		\\Тип тега = \ppyrsrv{UUID}
	\item[EDI RECADV RCV]

		ИД=69
		\\Символ = \ppyrsrv{EDIRECADVRCV}
		\\Тип объекта = \ppyrsrv{BILL}
		\\Тип тега = \ppyrsrv{STRING}
	\item[EDI DESADV SENT]

		ИД=70
		\\Символ = \ppyrsrv{EDIDESADVSENT}
		\\Тип объекта = \ppyrsrv{BILL}
		\\Тип тега = \ppyrsrv{STRING}
	\item[EDI ORDRSP SENT]

		ИД=71
		\\Символ = \ppyrsrv{EDIORDRSPSENT}
		\\Тип объекта = \ppyrsrv{BILL}
		\\Тип тега = \ppyrsrv{STRING}
	\item[EDI ALCODESADV SENT]

		ИД=72
		\\Символ = \ppyrsrv{EDIALCDESADVSENT}
		\\Тип объекта = \ppyrsrv{BILL}
		\\Тип тега = \ppyrsrv{STRING}
	\item[EDI INVOIC SENT]

		ИД=73
		\\Символ = \ppyrsrv{EDIINVOICSENT}
		\\Тип объекта = \ppyrsrv{BILL}
		\\Тип тега = \ppyrsrv{STRING}
	\item[ВЕТИС issuer UUID]

		ИД=74
		\\Символ = \ppyrsrv{PERSONVETISISSUUID}
		\\Тип объекта = \ppyrsrv{PERSON}
		\\Тип тега = \ppyrsrv{UUID}
	\item[ВЕТИС пользователь-инициатор операций]

		ИД=75
		\\Символ = \ppyrsrv{PERSONVETISUSER}
		\\Тип объекта = \ppyrsrv{PERSON}
		\\Тип тега = \ppyrsrv{STRING}
	\item[ВЕТИС UUID лота]

		ИД=76
		\\Символ = \ppyrsrv{LOTVETISUUID}
		\\Тип объекта = \ppyrsrv{LOT}
		\\Тип тега = \ppyrsrv{UUID}
	\item[ВЕТИС GUID локации]

		ИД=77
		\\Символ = \ppyrsrv{LOCVETISGUID}
		\\Тип объекта = \ppyrsrv{LOCATION}
		\\Тип тега = \ppyrsrv{UUID}

\end{description}


\subsubsection{Специальные теги}
Эти теги не зарезервированы, однако некоторые компоненты инфраструктуры Papyrus ссылаются на них по приведенному символу.

\begin{description}
	\item[Символ рабочей книги с шаблоном письма для покупателя интернет-магазина Universe-HTT]

		Символ=\ppyrsrv{BUYER\_MSG\_TEMPLATE}
		\\Тип объекта=\ppyrsrv{UHTTSTORE}
		\\Тип тега = \ppyrsrv{STRING}
	\item[Признак чужего интернет-магазина]

		Символ=\ppyrsrv{FOREIGNSTORE}
		\\Тип объекта=\ppyrsrv{UHTTSTORE}
		\\Тип тега = \ppyrsrv{BOOLEAN}
	\item[Список адресов электронной почты, по которым надо отослать уведомление о появлении заказа от покупателя]

		Символ=\ppyrsrv{STORE\_NOTIFY\_MAIL}
		\\Тип объекта=\ppyrsrv{UHTTSTORE}
		\\Тип тега = \ppyrsrv{STRING}

		Строка может содержать несколько адресов, разделенных точкой с запятой (;).
		\ppyexample{
			mystore@abc.ru;oleg@abc.ru
		}
\end{description}

\chapter{Географические объекты\label{ch-world}}

Многие объекты учета, так или иначе, связаны с определенным географическим положением.
Это может быть место изготовления товара, адрес склада,  город, в котором живет поставщик
и т.д. Каждое предприятие явно или неявно взаимодействует с различными географическими
пунктами. Для того, чтобы дать географическое описание какого-либо объекта, будь то товар,
производитель, поставщик или еще что-нибудь, в \ppybrand{} предусмотрен раздел \qu{География}

Система предполагает пять уровней классификации географических объектов, показанных на рис.~\ref{pic-GeoObjects}.

\ppypict{GeoObjects}{Иерархия географических объектов}

Следует учесть, что эти уровни классификации обобщенные. То есть, категория \ppyrsrv{город}
объединяет в себе все населенные пункты.

Категория \ppyrsrv{улица} объединяет все именованные объекты административно принадлежащие
населенным пунктам, как то: собственно улицы, площади, проспекты и т.д.
В категорию \ppyrsrv{регион} попадают все административно-территориальные объекты,
полностью входящие в государство, но имеющие больший территориальный охват,
чем населенный пункт.

Некоторые города (особенно это касается мегаполисов) могут содержать вложенные населенные пункты.
На текущий момент регионы могут быть определены только внутри государства.
То есть, нельзя создать запись региона, охватывающую несколько стран.

\section{Использование географических объектов}

Для редактирования географических объектов используется пункт меню
\ppymenu{Справочники\rdir География\rdir География}.
При этом открывается иерархический список географических объектов.
В этом списке представлены все категории объектов кроме улиц.
Для просмотра списка улиц (если вы этим пользуетесь) необходимо, выделив
требуемый населенный пункт, нажать кнопку \dlgbutton{Улицы}.

\subsection{Создание нового объекта}

Для создания нового географического объекта необходимо в списке нажать кнопку \dlgbutton{Добавить} либо клавишу \keyb{Insert}.
После этого на экране появится диалог выбора категории объекта. Выбрав то, что вам нужно, нажмите кнопку \dlgbutton{ОК} и укажите
необходимые атрибуты записи. Далее подробно описаны соответствующие диалоги редактирования.

\subsection{Диалог редактирования географического объекта}

\ppypict{dlg-066}{Диалог населенного пункта}

На рис.~\ref{pic-dlg-066} приведен диалог редактирования населенного пункта. Учитывая, что такие географические объекты наиболее часто добавляются и
редактируются, мы рассмотрим именно их в качестве примера для редактирования.

Диалоги, соответствующие континентам, государствам и регионам несколько проще, но используют похожие управляющие элементы и построены на тех же принципах.

\begin{description}
	\item[Наименование]
	Наименование географического объекта. Система допускает дублирование наименований
	географических объектов. Это сделано потому, что в мире существуют города и другие
	населенные пункты с одинаковыми наименованиями. В связи с этим, необходимо быть
	внимательным для того, чтобы избегать неоправданного дублирования географических
	объектов.

	\item[Сокращение]
	Сокращенное наименование географического объекта.

	\item[\dlgcombo{Статус}]
	Под статусом географического объекта подразумевается соответствие этого объекта
	общепринятой классификации населенных пунктов, включающей следующие категории:
	город, поселок и т.д.

	\item[\dlgcombo{Государство}]
	Государство, которому принадлежит этот населенный пункт. Для любого населенного пункта
	вы обязательно должны указать либо государство, либо регион, которому этот населенный
	пункт принадлежит.
	\item[\dlgcombo{Регион}]
	\item[Телефонный код]
	\item[Почтовый индекс]
	\item[Классификатор]
\end{description}

\subsection{Диалог редактирования улицы}

\ppypict{dlg-068}{Диалог редактирования улицы}

\begin{description}
	\item[\dlgcombo{Город}]
	\item[Наименование]
	\item[\dlgcombo{Статус}]
	\item[Классификатор]
\end{description}

\chapter{Персоналии\label{ch-person}}

В ходе своей деятельности предприятие взаимодействует с юридическими и физическими лицами.
Это могут быть поставщики, покупатели, клиенты, персонал предприятия и многие другие. Все они в
системе фигурируют как персоналии.

Собственное предприятие также является объектом персоналий.

В зависимости от своих отношений с предприятием все персоналии объединяются в группы, именуемые
видами персоналий. Каждая персоналия принадлежит не менее чем к одному виду, в то же время она может
быть объектом и других видов. Например, некоторая фирма может быть для предприятия, как поставщиком,
так и покупателем. Чтобы просмотреть существующие виды персоналий, выберите пункт меню
\ppymenu{Справочники\rdir Персоналии\rdir Виды персоналий}.

Для определения нового вида персоналии достаточно ввести его наименование.

Система предоставляет возможность вести обширную информацию о персоналиях. Любой объект персоналий
определяется юридическим статусом и наименованием. Эти два атрибута являются обязательными.
То есть нельзя ввести в базу данных новую персоналию, у которой не были бы определены эти атрибуты.

Наряду с указанными выше обязательными атрибутами персоналия может иметь и другие характеристики:
\begin{itemize}
	\item адрес, состоящий из города, почтового кода (индекса) и строки, содержащей текстовое описание адреса
	внутри указанного города. Обратите внимание на этот момент: текст адреса не содержит наименования населенного пункта,
	а лишь улицу (проспект или др.), дом (корпус) и, возможно, номер квартиры.
	\item список электронных адресов (телефоны, пейджеры, факсы, адреса электронной почты и т.д.);

	Электронный адрес является обобщением таких понятий как \qu{номер телефона}, \qu{номер факса},
	\qu{адрес электронной почты} и других адресов, используемых в электронных коммуникациях.

	\ppybrand{} позволяет сформулировать какие угодно типы электронных адресов.
	Изначально в базе данных заданы несколько таких типов, являющихся зарезервированными. Остальные можно задать по мере надобности.

	Список видов электронных адресов вызывается при обращении к пункту меню \ppymenu{Справочники\rdir Персоналии\rdir Виды электронных адресов}.
	Каждый вид электронного адреса характеризуется: названием, принадлежностью к определенному типу, признаком предпочтительности.

	Предпочтительный вид в перечнях выбора вида связи будет стоять на первом месте. Система предусматривает следующие типы электронных адресов:
	\begin{itemize}
		\item Телефон
		\item Факс
		\item Пейджер
		\item Электронная почта
		\item Web-страница
		\item Другой
	\end{itemize}
	\item список регистрационных данных, то есть любые данные, содержащие тип регистрации, дату, серию, номер
	и регистрирующий орган.

	Например: паспорт, свидетельство частного предпринимателя, свидетельство о браке,
	лицензия на занятие какой-либо деятельностью и т.д.

	Типы регистрационных документов описаны ниже.
	\item список банковских счетов.

	Любой банковский счет характеризуется своей принадлежностью какому-либо банку,
	типом банковского счета, номером и датой открытия.

	Тип банковского счета является классификатором банковских счетов.

	Наиболее распространенным типом банковского счета является расчетный счет. Типы банковских счетов отображаются в
	списке при обращении к пункту \ppymenu{Справочники\rdir Персоналии\rdir Типы банковских счетов}.

	В системе изначально зарезервировано несколько типов банковских счетов, которых с избытком
	хватит для большинства применений.
	\item примечание, содержащее любую краткую текстовую информацию.
\end{itemize}

\section{Юридические статусы персоналий\label{sec-person-status}}

Признак, обеспечивающий дифференциацию персоналий по юридическому статусу, так
и называется \ppyterm{юридический статус}.

Список юридических статусов, определенных в базе данных, доступен в пункте
меню \ppymenu{Справочники\rdir Персоналии\rdir Юридические статусы}.

Кроме обычных для простых справочников атрибутов (наименование, идентификатор),
запись юридического статуса содержит переключатель, определяющий является ли
этот статус принадлежностью юридического или физического лица.

Несколько юридических статусов зарезервированы системой. Наиболее примечательным
(и необычным) среди них является \ppyrsrv{Государство}. Этот статус специально
зарезервирован для упрощенного ввода персоналий-производителей товаров.

Если на вашем предприятии не принято детально идентифицировать производителей, но
необходимо определять только страну-изготовителя товара, то вы можете создать
записи персоналий с юридическим статусом \ppyrsrv{Государство} и наименованием страны
и подставлять их в качестве персоналии-производителя в записях товаров.

\section{Виды персоналий}

Вид персоналии является вспомогательным типом объектов данных, обеспечивающим
классификацию персоналий по характеру взаимодействия с ними вашего предприятия.

Проще выражаясь, принадлежность персоналии к виду отвечает на вопрос \qu{кто это?}.

Важной особенностью данного классификатора является множественность
отношения \qu{Персоналия \rdir Вид}. То есть, каждая персоналия может принадлежать
более, чем одному виду. Вместе с тем, система не допускает ситуации, когда
персоналия не принадлежит ни к одному из видов.

Администрирование списка видов персоналий доступно через пункт меню
\ppymenu{Справочники\rdir Персоналии\rdir Виды персоналий}.

\subsection{Диалог редактирования вида персоналии}

\ppypict{dlg-personkind}{Диалог редактирования вида персоналии}

Диалог, используемый для создания и редактирования элемента справочника
видов персоналий, изображен на рис.~\ref{pic-dlg-personkind}.

Далее описываются управляющие элементы диалога:

\begin{description}
	\item[Наименование] Уникальное имя вида персоналии.

	\item[Символ] Опциональное символьное наименование записи,
	используемое для доступа к ней из формул и внешних приложений.

	Если символ не пустой, то он должен быть уникальным среди
	остальных записей видов персоналий.

	Рекомендуется для символа использовать односложные
	сочетания латинскими буквами и цифрами.

	\item[ИД] Справочное поле, отображающее идентификатор записи.

	\item[\dlgcombo{Тип регистрационного документа для поиска}]
	Тип регистрационного документа, номер которого будет
	использоваться как основной поисковый код персоналии.

	\item[\dlgcombo{Тип регистра, идентифицирующего наименование папки}]
	Специализированная опция, позволяющая организовать в файловой системе
	каталоги для хранения различных файлов, ассоциированных с персоналиями,
	и быстро обращаться к ним из таблицы персоналий (см. стр.~\pageref{loc-viewperson-cmd}).

	\item[\dlgcombo{Статус по умолчанию}]
	При создании новой персоналии, принадлежащей данному виду, она
	получит статус, заданный в рассматриваемом комбо-боксе.

	Опция позволяет увеличить производительность при вводе персоналий,
	большая часть которых имеет один и тот же юридический статус.

	\item[\dlgflag{При создании персоналии использовать сокращенный диалог}]
	Если при создании персоналии система \qu{знает} из контекста
	что новая персоналия относится к виду, у которого установлен этот флаг, то
	будет применен специализированный упрощенный диалог редактирования новой персоналии.
\end{description}

\subsection{Зарезервированные виды персоналий}
Система резервирует несколько идентификаторов видов персоналий:

\begin{description}
	\item[Главная организация] id=1
	Организация, ведущая учет в этой базе данных.
	\item[Филиал главной организации] id=2
	Не используется.
	\item[Персонал]  id=3
	Сотрудники главной организации.
	\item[Клиенты] id=4
	Клиенты, покупатели и т.д.
	\item[Поставщики] id=5
	Персоналии, у которых закупаются товары и услуги.
	\item[Банки] id=6
	\item[Производители] id=7
	\item[Агенты]  id=8
	\item[Управления внутренних дел] id=9
	\item[Гос. службы, регистрирующие юр. лица] id=10
	\item[Работодатель] id=11
	\item[Неизвестные] id=12
	Если в какой либо ситуации система вынуждена сохранить в базе данных персоналию, которая не относится ни к одному
	виду, то такой персоналии присваивается вид \ppyrsrv{Неизвестные}.
	\item[Владельцы транспортных средств] id=13
	\item[Транспортные брокеры] id=14
	\item[Командиры транспортных средств] id=15
\end{description}

\section{Регистрационные документы\label{sec-register}}

Регистрационные документы (или, просто регистры) используются для управления информацией об официальных документах, ассоциированных с
персоналиями и, в некоторых случаях, с адресами.

В качестве примеров регистрационных документов можно привести следующие:

\begin{description}
	\item[Паспорт]
	\item[Свидетельство о рождении]
	\item[Штатный код сотрудника организации]
	\item[ИНН]
	\item[КПП]
\end{description}

Регистрационный документ имеет следующие атрибуты:
\begin{description}
	\item[Идентификатор] Уникальное число, идентифицирующее запись документа.
	\item[Тип регистрационного документа] Важнейший атрибут, определяющий основные характеристика регистрационного
	документа и особенности его учета. И главное - его смысл. Все примеры регистров, приведенные выше, проецируются
	на какой-то один тип регистрационного документа.
	\item[Серия] Серийный номер документа. Символьное значение длиной не более 11 знаков.
	\item[Номер] Собственно номер регистрационного документа. Символьное значение длиной не более 31 знака.
	\item[Дата регистрации] Не обязательный атрибут, указывающий дату начала действия документа. Для официальных документов это,
	обычно, дата выдачи, регистрации и т.д. Для регистров, отражающих какое-либо событие, но не имеющих соответствующего официального документа,
	это дата возникновения события.
	\item[Дата истечения срока действия] Не обязательный атрибут, отражающий дату, до которой (включительно) действителен данный регистр.
	\item[Регистрирующая организация] Обязательный атрибут. Персоналия, выдавшая или утвердившая регистрационный документ. Так, для
	общегражданского паспорта (в России) регистрирующей организацией будет какой либо отдел внутренних дел, для внутрикорпоративных регистров -
	персоналия, представляющая организацию.
\end{description}

\subsection{Зависимости регистрационных документов}
Регистрационный документ всегда является зависимым объектом. То есть, для любого регистра существует какой-либо объект данных,
к которому он относится. Чаще всего регистрационные документы привязаны к персоналиям. Реже в специальных случаях - к локациям (адресам или
складам).

Еще один специфический вариант зависимости регистра - привязка его одновременно к персоналии и персональному событию. Такая
зависимость возникает в случае, если данные о регистрационном документе были заполнены вместе с вводом персонального события.
Например, при вводе персонального события \qu{Прием на работу} может быть сформирован регистр приказа о приеме на работу. Тогда
этот регистр будет связан одновременно с персональным событием и персоналией, которая была принята на работу.

\subsection{Типы регистрационных документов\label{sec-registertype}}

Тип регистрационного документа определяет особенности записи регистра,
относящейся к персоналии.

Каждый тип регистрационного документа характеризуется следующими основными атрибутами:
\begin{itemize}
	\item названием
	\item видом регистрирующего органа
	\item условием, для кого действителен данный тип регистрации (для юридических, физических лиц или для тех
	и других)
	\item форматной строкой, задающей форму вывода регистрационных данных на печать
	\item набором флагов, определяющих особенности поведения регистров, относящихся к
	этому типу
\end{itemize}

Перечень используемых в форматной строке зарезервированных переменных и
необходимые к ним пояснения, даны в приложении.

Несколько типов регистрационных документов зарезервированы и
присутствуют в справочнике изначально. Остальные можно ввести по мере необходимости.

Список типов регистрационных документов доступен для просмотра и
редактирования через пункт меню \ppymenu{Справочники\rdir Персоналии\rdir Типы регистрационных документов}.

%topic(DLG_PREGTYP)

\subsubsection{Диалог редактирования типа регистрационного документа}

\ppypict{dlg-138}{Тип регистрационного документа}

Вид диалога редактирования типа регистрационного документа приведен на рис.~\ref{pic-dlg-138}.
Следующая таблица поясняет назначение управляющих элементов показанного диалога.

\begin{description}
	\item[Наименование]
	Имя типа регистрационного документа длиной до 47 знаков.
	Это имя должно быть уникальным, то есть не должно быть ни одного
	другого типа с таким же наименованием.

	\item[Символ]
	Опциональный символ типа регистрационного документа, используемый
	для ссылки на этот тип из формул и из внешних систем.

	Рекомендуется использовать для символа одиночные слова латинскими буквами.

	Если символ не пустой, то система следит за тем, чтобы ни одни другой
	тип не имел такого же символа.

	\item[ИД]
	Справочное (не доступное для изменения) поле с внутренним идентификатором типа регистрационного документа.

	\item[\dlgcombo{Вид регистрирующего органа}]
	Вид персоналии, используемый для регистрирующего органа, связанного с регистрационным документом, относящимся к этому типу.

	Необходимо выбрать здесь какой-либо вид персоналии. Для персональных регистров общего назначения (ИНН, паспорт,
	водительское удостоверение, свидетельство о браке и т.д.) рекомендуется использовать зарезервированный вид
	персоналии \ppyrsrv{Регистрационные службы}.

	Для регистров, генерируемых вашим предприятием (например, табельный номер сотрудника или
	код торгового представителя) рекомендуется применять вид персоналии \ppyrsrv{Главная организация}.

	\item[\dlgcombo{Допустимый вид персоналии}]
	Если вы хотите ограничить установку регистров данного типа только определенным
	видом персоналии, то выберите его в этом комбо-боксе. В этом случае программа
	проследить чтобы пользователь по ошибке либо намеренно не присвоил такой
	регистр персоналии, которая не принадлежит выбранному виду.

	Примером использования такого ограничения может служить табельный номер
	сотрудника, который, вероятно, должен быть применен только к персоналиям,
	относящимся к виду \ppyrsrv{Сотрудники}.

	Аналогично, зарезервированный тип регистрационного документа БИК (банковский
	идентификационный код) может быть задан только для персоналий вида \ppyrsrv{Банк}.

	\item[\dlgflag{Уникальный документ}]
	Если этот флаг включен, то для одной персоналии может быть определен только один регистр заданного вида.

	В большинстве случаев это признак следует устанавливать. Примером типа регистрационного документа, для которого не следует
	устанавливать этот флаг может служить диплом о высшем образовании, поскольку некоторые люди имеют более одного такого диплома.

	\item[\dlgflag{Запретить ввод персоналии без регистра}]
	Результатом	включения этого признака будет то, что при изменении (но не при вводе новой) персоналии система проверит запись на
	предмет наличия в ней регистра этого типа. Если такого регистра в персоналии не будет, то пользователь будет проинформирован
	сообщением об ошибке.

	\item[\dlgflag{Предупреждать об истечении срока действия (в документах)}]
	Установка этого флага приведет к тому, что при выборе в каком либо документе контрагента, связанного с персоналией, для которой дата
	истечения срока действия регистра данного вида меньше текущей операционной даты, система выдаст предупреждение.

	\item[\dlgflag{Предупреждать об отсутствии (в документах)}]
	Аналогично предыдущему флагу, этот обрабатывается при выборе в документах контрагента, связанного с персоналией.

	Установка этого флага приведет к тому, что при выборе в каком либо документе контрагента, связанного с персоналией, для которой не
	определен регистр данного типа, система выдаст предупреждение.

	Пользоваться этим флагом следует с большой осторожностью поскольку неоправданные предупреждения будут мешать работе сотрудников,
	вводящих документы.

	\item[\dlgflag{Не уникальный номер}]
	Чаще всего персональные регистры имеют уникальные пары серия-номер. В случае, если для регистров этого типа разные персоналии могут
	иметь одинаковые пары серия-номер (очень часто серия не вводится, при этом можно говорить об уникальности просто номера регистра),
	то рассматриваемый флаг следует установить.

	Будьте внимательны. Для многих регистров уникальность номера является необходимым требованием. Так, едва ли можно устанавливать
	этот флаг для типа регистра, соответствующего гражданскому паспорту либо табельному номеру сотрудника.

	\item[\dlgflag{Приоритетный ввод номера}]
	Сервисный флаг, используемый в типах регистрационных документов, для которых основной смысл сосредоточен в номере.

	Если флаг установлен, то при открытии диалога редактирования персонального регистра, после выбора типа регистра, курсор
	будет сразу устанавливаться в поле номера документа. Это помогает сэкономить время на ввод соответствующих данных.

	\item[Ограничение по статусу персоналии, к которой относится регистр данного типа]
	Здесь возможны следующие варианты:
	\begin{description}
		\item[\dlgradioi{Физ и юр лица}] Регистр данного типа доступен для любых
		юридических статусов персоналий.
		\item[\dlgradioi{Только физические лица}]
		Регистр может быть определен только для физических лиц.
		\item[\dlgradioi{Только юридические лица}]
		Регистр может быть связан только с юридическими лицами.
	\end{description}
	Соответствует ли статус персоналии юридическому, либо физическому
	лицу определяется признаком записи юридического статуса
	(меню \ppymenu{Справочники\rdir Персоналии\rdir Юридические статусы}).

	\item[Шаблон номера]
	Шаблон для автоматической нумерации регистрационных документов.
	Подробнее об этом сказано ниже (стр.~\pageref{sec-pregtype-counter}).

	\item[Счетчик]
	Счетчик, используемый для автоматической нумерации персональных регистров.

	\item[Срок действия, дней] Если в этом поле стоит значение больше нуля,
	то при вводе нового регистра персоналии, относящегося к данному типу,
	в диалоге ввода регистра автоматически будет устанавливаться текущая системная дата,
	а дата истечения срока действия будет установлена равной текущей системной дате
	плюс указанное в этом поле количество дней.

	Данная опция позволяет одновременно увеличить производительность оператора
	при вводе данных и снизить вероятность ошибок в тех случаях, когда правило
	установки срока действия регистрационного документа формализовано.

	\item[Формат]
	Здесь может быть указана специальная строка форматирования регистрационного
	документа для представления его в отчетах.

	Подробно формат описан ниже (стр.~\pageref{sec-pregtype-format}).

	\item[\dlgcombo{Товарная группа}]

	Комбо-бокс, совмещенный с группой радиокнопок, позволяющий ограничивать
	включение в товарные документы номенклатурных позиций в зависимости от
	наличия у персоналии-контрагент регистра с данным типом.

	В комбо-боксе может быть выбрана как обыкновенная, так и альтернативная группа.
	Допускается также выбор группы-папки.

	Возможны следующие варианты ограничения:
	\begin{description}
		\item[Разрешить продавать только эту группу]
		Если контрагент по документу имеет такой регистр, то в документ могут
		быть включены только те товары, которые принадлежат выбранной группе.

		Заметим, что наличие двух и более регистров, с типами, определяющими товарную группу
		с таким вариантом ограничения, обеспечивает возможность вставки в документ
		только тех товаров, которые одновременно принадлежат всем этим группа.

		\item[Не разрешать продавать эту группу]
		В документ, контрагент которого содержит такой регистр, не могут быть
		вставлены строки с номенклатурой, принадлежащей этой группе.

		\item[Разрешать продавать эту группу при наличии регистра]
		Такой варинат разрешает вставлять в товарный документ позиции
		из выбранной группы только в том случае, если контрагент имеет
		регистр, относящийся к данному типу.

		Заметим, что если статья документа не связана с персоналией,
		то это ограничение не действует.
	\end{description}
\end{description}

\subsubsection{Шаблон нумерации и счетчик типа\label{sec-pregtype-counter}}

Для некоторых регистрационных документов будет логичным \qu{заставить} систему
автоматически назначать новые уникальные номера. Это, в первую очередь, относится к
тем регистрам, которые определяются внутренним администрированием на предприятии.
Например, коды клиентов, табельные номера сотрудников и т.д.

Чтобы включить механизм автоматического назначения номеров персональным регистрам
достаточно в типе этих регистров установить шаблон нумерации.

Формат этого шаблона выглядит так:

$prefix\%number$

где $prefix$ символьный префикс номера документа, а $\%number$ - это шаблон нумерации ($number$ - число знаков в цифровой части номера,
если это значение начинается с нуля, то номер документа будет выравниваться до заданного числа символов нулями). Проще всего продемонстрировать
использование шаблона на примерах.

\ppyexampletitle{Примеры шаблонов нумерации персональных регистров}{
	\begin{itemize}
		\item Т\%08 - результирующие номера документов будут иметь вид: Т00000001, Т00000002 и т.д.
		(8 знаков после префикса Т).
		\item \% - результирующие номера будут иметь вид:  1, 2, 3 и т.д.
		\item Б/Н - все результирующие номера будут иметь вид Б/Н.
	\end{itemize}
}

Счетчик кодировки увеличивается на единицу с каждым новым регистром. Если вы хотите,
чтобы порядок нумерации изменился, то есть начался бы с иного чем в данный момент номера,
то установите счетчик в значение на единицу меньшее, чем то, которое должно присутствовать
в следующем вводимом регистре.

\ppynote{
	Система не гарантирует сплошного порядка нумерации по нескольким причинам:
	\begin{itemize}
		\item Счетчик может быть изменен вручную.
		\item Регистр, которому автоматически был присвоен номер
		не был сохранен в базе данных (при этом счетчик все равно убегает вперед).
		\item Персоналия либо регистр могут быть удалены либо номер регистра,
		после автоматического присвоения, может быть изменен вручную.
	\end{itemize}
}

%endtopic

\subsection{Формат представления регистра\label{sec-pregtype-format}}

Форматирование персональных регистров применяется в основном в печатных формах.

Для примера, вы можете определить правило форматирования типа регистрационных
документов \ppyrsrv{Паспорт} с тем, чтобы в расходном кассовом ордере номер паспорта
получателя печатался по тем правилам, которые вам необходимы.

Формат представляет собой текстовую строку, как правило, содержащую несколько
метапеременных, вместо которых система вставляет актуальные значения.

Существуют следующие варианты метапеременных, используемых в формате
регистрационных документов:

\begin{description}
	\item[@regname] Наименование типа регистра
	\item[@regsn]   Серия регистра
	\item[@regno]   Номер регистра
	\item[@date]    Дата регистра
	\item[@expiry]  Дата окончания срока действия регистра
	\item[@regorg]  Регистрирующий орган (наименование персоналии)
\end{description}

\ppyexampletitle{Примеры форматной строки типа регистра}{
	паспорт @regsn № @regno выдан @date @regorg \\
}

\subsubsection{Зарезервированные типы регистрационных документов}

Система резервирует несколько типов регистрационных документов,
часто используемыми в учете. Вот список этих типов:

\begin{description}
	\item[Паспорт] \indent id=1

	Гражданский паспорт физического лица. Регистр этого типа обычно
	содержит серию, номер, дату выдачи (дата регистра) и ссылку на
	орган, выдавший паспорт.

	\item[Свидетельство частного предпринимателя] \indent id=2

	Регистр, содержащий сведения о документе, на основании которого
	физическое лицо ведет предпринимательскую деятельность без
	образования юридического лица.

	\item[ИНН] \indent id=3

	Идентификационный номер налогоплательщика. Регистр этого типа обычно содержит
	номер и, возможно, дату регистрации кода в налоговом органе.

	Для этого типа регистра, применяемого на территории Российской Федерации,
	система реализует алгоритм проверки корректности ввода.

	\item[ОКОНХ] \indent id=4

	Российский классификатор, присваиваемый лицам и организациям, ведущим
	хозяйственную деятельность.

	\item[ОКПО] \indent id=5

	Российский классификатор, присваиваемый лицам и организациям, ведущим
	хозяйственную деятельность.

	Для этого типа регистра, применяемого на территории Российской Федерации,
	система реализует алгоритм проверки корректности ввода.

	\item[БИК (банковский идентификационный код)] \indent id=6

	Идентификационный код банка. Регистры этого типа присваиваются персоналиям,
	относящимся к виду \ppyrsrv{Банки} и необходимы для печати платежных поручений
	(требований). Кроме того, этот код применяется для проверки корректности
	ввода счетов персоналий, открытых в соответствующих банках.

	\item[Корреспондентский счет банка] \indent id=7

	Корреспондентский счет банка, открытый в отделении центрального банка.
	Каждый банк обязательно содержит такой счет (не путать с корреспондентскими
	счетами для межбанковских расчетов, которые коммерческие банки открывают
	на добровольной основе друг у друга).

	Для этого типа регистра система предусматривает проверку корректности,
	которая использует также БИК, введенный для того же банка, что и корреспонденский счет.

	\item[Код персоналии] \indent id=8

	Этот тип не используется системой (администратор системы волен задавать
	собственные типы регистрационных документов, используемые в качестве
	кодов).

	\item[Идентификатор клиента проекта Альбатрос] \indent id=9

	Тип, используемый для публикации прайс-листов и приема заказов
	через интернет.

	\item[Код КПП (код причины постановки на налоговый учет налогоплательщика)] \indent id=10

	Российский классификатор, присваиваемый организациям и частным предпринимателям
	налоговыми органами.

	\item[Код фискального органа по ОКАТО] \indent id=11

	Российский классификатор налоговых органов.

	\item[Код сертифицирующей организации] \indent id=12

	Не используется.

	\item[Код GLN] \indent id=13
	Код GLN (Global Location Number), ассоциированный с персоналией.

	Обратим внимание на то, что если необходимо ассоциировать GLN с адресом
	или складом, то в этом случае следует GLN вводить в поле кода адреса (склада).

\end{description}

\section{Диалог редактирования списка регистрационных документов}

\section{Диалог редактирования регистрационного документа}

\section{Адреса}

Адреса являются сложными атрибутами персоналий, определяющими места их
географического расположения.

Персоналия может иметь два фиксированный адреса, именуемых \qu{Юридический}
и \qu{Фактический}, а также произвольное количество, так называемых, адресов доставки.

\subsubsection{Диалог адреса персоналии}

\ppypictsc{dlg-067}{Диалог адреса}{0.5}

Внешний вид диалога редактирования адреса приведен на рис.~\ref{pic-dlg-067}.
Далее следует описание управляющих элементов этого диалога.

\begin{description}
	\item[Наименование]
	Не обязательное для заполнения поле. Здесь может быть введена
	произвольная строка каким-либо образом идентифицирующая адрес.

	Максимальная длина наименования адреса - 47 символов.

	\item[Идентификатор]
	Не доступное для изменения поле, отображающее значение идентификатора адреса.

	\item[Код]
	Символьный идентификатор адреса. Обычно используется для электронного
	обмена данными с контрагентами вашего предприятия.

	Программа следит за тем, чтобы этот код (если не пустой) не дублировался для различных адресов.

	Максимальная длина кода - 15 символов.

	\item[Почтовый код]
	Почтовый индекс адреса.

	\item[\dlgcombo{Город}]
	Населенный пункт, в котором расположен адрес.

	\item[Строка адреса]
	Короткая строка адреса (без почтового кода и наименования населенного пункта).

	\item[\dlgflag{Вводить полный адрес вручную}]
	Как правило, система автоматически формирует полную строку адреса,
	составляя ее из почтового кода, наименования населенного пункта и
	короткой строки адреса.

	Если по каким-либо причинам вас не устраивает такая полная строка
	адреса, то можно включить данный флаг и ввести полную строку адреса
	вручную.

	\item[Полный адрес]
	Если флаг \dlgflag{Вводить полный адрес вручную} (см. выше) выключен,
	то это поле закрыто для редактирования, и в нем отображается автоматически
	сформированная программой полная строка адреса.

	В противном случае строка доступна для изменения и в ней можно вручную набрать полную строку адреса.

	\item[\dlgbutton{Тест разбора адреса}]
	Система \ppybrand{} умеет структурировать адреса, введенный произвольным образом, для извлечения из них
	отдельных элементов: города, улицы, номера дома и т.д. Несмотря на развитость этой функции, не все адреса
	могут быть корректно разобраны. Для того, чтобы проверить насколько правильно программа может проанализировать
	адрес, введена данная кнопка. При нажатии на нее появляется диалог, в котором отображаются отдельные элементы
	адреса, в том виде, как это \qu{видится} программе.

	\item[Географические координаты]
	Координаты адреса, представленные географической широтой и долготой.
	Это поле используется для связи с картографическими системами. Координаты указываются в виде двух чисел:
	широты и долготы, разделенных пробелом или запятой. Десятичным разделителем целой и дробной частей
	широты и долготы должна быть точка.

	\item[\dlgbutton{Регистры}]
	С адресом, как и с персоналией, может быть связано произвольное количество регистрационных документов.
	Эта кнопка открывает диалог редактирования списка регистров данного адреса.

	\item[\dlgbutton{Теги}]
	Как и со многими иными типами объектов данных, с адресами может быть связано некоторое множество
	тегов. Данная кнопка позволяет редактировать список тегов адреса.

	\item[\dlgbutton{Дополнительные поля}]
	Кроме перечисленный выше атрибутов, адрес может иметь несколько дополнительных
	текстовых полей.

	При нажатии на эту кнопку откроется диалог списка дополнительных полей адреса.
	Диалог состоит из списка, в котором перечислены предустановленные категории
	дополнительных полей (см. стр.~\pageref{sec-person-cfg}).

	\item[Блок специальных текстовых полей для автономных адресов]
	С адресом может быть связаны так называемые автономные атрибуты - телефон, контакт и электронный адрес.
	Эти атрибуты предназначены, главным образом, для автономных адресов. То есть, адресов, не связанных с
	какой-либо записью персоналии. Для адресов, связанных с персоналиями, едва ли эти атрибуты имеют смысл, по скольку
	каждый из них может быть указан непосредственно в блоке редактирования персоналии.
	\begin{description}
		\item[Телефон] Номер телефона для связи.
		\item[Контакт] Текстовое описание контакта.
		\item[Электронный адрес] Электронный адрес (обычно адрес электронной почты).
	\end{description}

\end{description}

\subsection{Особенности адресов как объектов данных}

Адреса являются полноценными объектами данных (тип объекта 1010).
Кроме адресов этот тип управляет так же складами и местами хранения.

Важной особенностью адресов, как объектов данных, является их подчиненное
положение по отношению к персоналиям (иногда, документам). То есть,
автономное администрирование адресов вне контекста персоналии, которой
они принадлежат, не возможно.

\subsubsection{Системные события по адресам}

При создании, изменении и удалении адресов в системном журнале
формируются события, соответственно, \ppyrsrv{Объект создан}, \ppyrsrv{Объект изменен} и
\ppyrsrv{Объект удален}.

Права доступа отдельно по адресам (вне контекста персоналий) не регламентируются.

\section{Таблица персоналий}

С помощью таблицы персоналий вы можете просмотреть и распечатать список персоналий, отобранных с помощью фильтра
по набору заданных вами критериев. Также, таблица персоналий позволяет выполнить операции по вводу, редактированию,
удалению и прочие действия.

Для вызова таблицы персоналий используйте пункт меню \ppymenu{Справочники\rdir Персоналии\rdir Персоналии}.

\subsection{Фильтр персоналий\label{sec-filt-person}}

\ppypict{dlg-f-person}{Диалог фильтра персоналий}

Фильтр таблицы персоналий показан на рис.~\ref{pic-dlg-f-person}.

Он обеспечивает вас обширным набором критериев отбора и просмотра персоналий. Кроме простых
условий, он включает в себя развитые средства фильтрации по факторам наличия либо отсутствия какого-либо атрибута,
поиска (в том числе нечеткого) по наименованию, и отбора по комбинированным фильтрам тегов.

Подробная информация о всех элементах фильтра персоналий сведена в следующей таблице.

\begin{description}
	\item[Вид]
	Вид персоналий, которые вы хотите увидеть в таблице.

	\item[\dlgcombo{Категория}]
	В этом комбо-боксе вы можете выбрать категорию, к которой должны относиться персоналии, попавшие в выборку.

	\item[\dlgcombo{Юр статус}]
	Юридический статус выбираемых персоналий (физическое лицо, ООО и пр.).

	\item[\dlgcombo{Город}]
	Город местонахождения персоналии (выбирается по юридическому адресу).

	\item[\dlgcombo{Атрибут}]
	Дополнительный атрибут для просмотра.

	Если вы выбираете одно из предложенных системой значений,
	то в таблице наряду с именем будут показаны параметры выбранного атрибута. Это может быть:
	расчетный счет, адрес, любой из регистров либо тегов, и т.д. Подробно дополнительные
	атрибуты рассмотрены ниже.

	\item[Переключатель отбора по наличию атрибута]
	Этот переключатель позволяет отобрать только те персоналии, которые либо имеют пустой атрибут
	(например, не заполненный регистр ИНН), либо имеют не пустой атрибут.

	\item[Строка поиска по наименованию]
	В этой строке можно ввести строку, которую должны содержать имена выбранных персоналий.

	Скажем, можно вывести всех покупателей имеющих в своем наименовании слово \qu{Союз}.
	Поиск подстроки осуществляется без учета регистра ввода (строчные и прописные буквы не различаются).

	Существует возможность отбора списка персоналий на нескольким подстрокам, содержащимся в имени,
	связанными условием \ppyrsrv{И} или \ppyrsrv{ИЛИ}. Например, если вам необходимо найти все
	персоналии, в имени которых есть подстрока ООО и СОКОЛ, то введите \qu{ООО\&\&СОКОЛ}. Если же необходим
	список персоналий, в имени которых есть СОКОЛ или ОРЕЛ, то введите \qu{ОРЕЛ||СОКОЛ}.

	Система, кроме того, предоставляет возможность так называемого нечеткого поиска по подстроке.
	Это значит, что вы можете найти все персоналии, которые имеют имя похожее на
	введенную строку. Для реализации этой возможность поставьте перед строкой поиска знак
	восклицания (например по строке \qu{!коктейль} будут найдены все персоналии,
	имена которых содержат слова \qu{коктейль}, \qu{коктель}, \qu{коктейли} и т.д.).

	\item[\dlgflag{Освобожден от НДС}]
	Если вы хотите выбрать только те персоналии, для которых установлен признак \dlgflag{Освобожден от НДС}
	то включите этот флажок.

	\item[\dlgflag{Только с картинками}]
	Установка этого флага предписывает системе отображать только те персоналии,
	к котором привязаны изображения.

	\item[\dlgflag{Показывать не привязанные к персоналиям адреса}]
	Этот флаг доступен только при условии выбора дополнительного атрибута \ppyrsrv{Все адреса}. При установке
	флага в таблице будут показаны адреса, не привязанные ни к одной из персоналий.

	Необходимость в такой опции обусловлена возникающими иногда потребностями найти (не автономные) адреса,
	которые не являются в полном смысле \qu{зависшими} (видные с помощью дополнительного
	атрибута \ppyrsrv{Зависшие адреса}), но при этом и не связанные ни с одной из персоналий.

	\item[\dlgflag{Критерии тегов применять к локациям}]
	Флаг работает только при выборе в качестве дополнительного атрибута, связанного с отображением
	адресов. В этом случае, при установке обсуждаемого флага, критерии фильтрации по тегам
	применяются к тегам локаций, а не персоналий.

	\item[\dlgflag{Сопоставить адреса с ФИАС}]
	Флаг работает только при выборе в качестве дополнительного атрибута, связанного с отображением
	адресов и ваша база данных использует внутреннее представление российской базы данных адресов ФИАС.
	При совпадении этих условий и установке флага, таблица будет отображать
	результаты автоматического разбора и сопоставления адресов в базе данных с адресами ФИАС.

	\item[\dlgflag{Кросстаб с тегами}]
	Экспериментальная опция. Находится в процессе разработки.

	\item[Период идентификации новых контрагентов]
	Здесь можно ввести период для того, чтобы в таблице выделялись цветом новые контрагенты, ставшие таковыми
	за указанный период времени.

	Правила идентификации новых контрагентов системой определяются в конфигурации персоналий.

	\item[Период идентификации новых контрагентов]
	Если в конфигурации персоналий определены критерии идентификации новых контрагентов и это
	поле содержит период, закрытый слева, то при построении выборке система проверит
	каждую персоналии на соответствие критериям нового контрагента за заданный период.

	В результирующей таблице наименования персоналий, ставших новыми контрагентами за указанный период,
	будут выделены оранжевым цветом.

	\item[\dlgflag{Показывать только новых контрагентов}]
	Если выполнены все критерии для идентификации новых контрагентов, описанные выше, то
	установка этого флага приведет к тому, что в выборку попадут только новые контрагенты.

	\item[\dlgbutton{Дополнительно}]
	По этой кнопке доступны параметры отбора персоналий по серии и номеру регистрационного
	документа (ИНН, паспорт и т.д.).

	\item[\dlgbutton{Теги}]
	Выводит на экран диалог, в котором можно перечислить критерии отбора по тегам персоналий.

	Подробно о редактировании фильтров тегов рассказано на стр.~\pageref{sec-tagv-filt}.

	\item[\dlgbutton{События}]
	Кнопка вызывает диалог, в котором можно задать критерии отбора персоналий по системным событиям.
	Например, только те записи, которые были созданы в течении определенного периода и определенным пользователем.

\end{description}

\subsubsection{Дополнительные атрибуты таблицы персоналий}

Фильтр персоналий позволяет выбрать следующие дополнительные атрибуты просмотра:

\begin{description}
	\item[Все адреса]
	Каждая персоналия отображается в таблице одной или несколькими строками так,
	что отдельная строка показывает один из адресов персоналии.

	Специальная колонка \ppyrsrv{Тип адреса} обозначает является ли адрес
	юридическим, фактическим, либо одним из адресов доставки.

	Переключатель отбора по наличию атрибута в этом случае работает следующим
	образом:
	\begin{description}
		\item[\dlgradioi{Все}] Отображает все персоналии, соответствующие фильтру, не зависимо
		от того, определены ли для них адреса.
		Персоналии, для которых не определено никаких адресов показываются строками
		с пустым типом адреса.

		\item[\dlgradioi{Только с не пустым атрибутом}] Отображаются только те персоналии,
		для которых определен хотя бы один адрес.

		\item[\dlgradioi{Только с пустым атрибутом}] Выводятся только персоналии, для которых
		вообще не определено никаких адресов (ни юридических, ни фактических, ни
		адресов доставки).

	\end{description}

	Дополнительная опция фильтра \dlgflag{Показывать не привязанные к персоналиям адреса} позволяет отобразить
	адреса, не привязанные ни к одной из персоналий, но при этом не являющиеся автономными.

	\item[Адреса доставки]
	Работает также как и предыдущий вариант \qu{Все адреса} за тем исключением, что
	отображаются только адреса доставки (то есть, юридические и фактические адреса
	персоналий не выводятся в таблице).

	\item[Автономные адреса]
	Строго говоря, таблица, отображаемая по этому атрибуту, не относится к персоналиям.
	При выборе данного варианта в таблицу будут выведены адреса, не привязанные к персоналиям,
	но имеющие статус автономных (то есть, существующих не зависимо от персоналий и каких-либо
	иных объектов данных).

	Автономные адреса применяются, например, при организации доставки, когда нет смысла или возможности
	вводить по каждой заявке отдельную персоналию. В этом случае система формирует автономные
	адреса, содержащие информацию достаточную для доставки заказа.

	\item[Зависшие адреса]
	Специальная опция, выводящая в таблице только те адреса, на которые не
	ссылается ни одна персоналия.

	Данная функция может быть полезна для выявления и устранения проблем
	в базе данных.

	Обратим внимание, что при таком выборе дополнительного атрибута все остальные
	критерии фильтрации не используются.

	\item[Дублируемые адреса доставки]
	Аналогично предыдущему пункту, это используется для диагностики проблем.
	Данную опцию просмотра следует выбирать одновременно с положением
	переключателя \dlgradioi{Только с не пустым атрибутом}. В этом случае
	таблица отобразить адреса доставки, связанные и одной персоналией и
	имеющие одинаковые строки адреса.

	\item[Расчетный счет]
	Таблица отображает колонки параметров банковских счетов. Если персоналия имеет
	более одного счета, то каждый из счетов будет показан отдельной строкой.

	Переключатель отбора по наличию атрибута здесь работает аналогично режиму
	отображения адресов: если выбран вариант только не пустых атрибутов, то
	показываются те персоналии, которым сопоставлен хотя бы один счет.
	Если выбран вариант \dlgradioi{Только с пустым атрибутом}, то
	показываются персоналии, не имеющие ни одного счета.

	\item[Телефон/адрес]
	Вместе с наименованием персоналии отображается:
	\begin{itemize}
		\item Список электронных адресов, разделенных точкой с запятой
		\item Юридический адрес
		\item Фактический адрес
	\end{itemize}

	\item[Регистр на выбор]
	В комбо-боксе выбора дополнительного атрибута каждый тип регистрационного
	документа перечислен следом за словом \ppyrsrv{Регистр:}.

	При выборе какого-либо варианта из этого семейства, таблица персоналий
	отобразит серию и номер регистрационного документа выбранного типа,
	сопоставленного каждой персоналии, а так же дату регистрации и дату
	истечения срока действия.

	\item[Тег на выбор]
	Аналогично предыдущему пункту, этот представлен семейством вариантов
	выбора, по одному на каждый тип тега персоналий.
\end{description}

\subsection{Действия в таблице персоналий\label{loc-viewperson-cmd}}

\paragraph{Редактировать}\indent\keyb{Enter}
Открывает диалог редактирования выбранной персоналии.

Редактирование возможно при наличии соответствующего права по объекту \ppyrsrv{Персоналии}.

\paragraph{Добавить}\indent\keyb{Insert}
Открывает диалог создания новой персоналии. Если в фильтре таблицы задан
вид персоналии, то в диалоге новой персоналии будет предустановлен это вид.

Операция возможно при наличии права \ppyrsrv{Создание} по объекту \ppyrsrv{Персоналии}.

\paragraph{Удалить}\indent\keyb{Delete}
Удаляет выбранную персоналию.

Операция возможно при наличии права \ppyrsrv{Удаление} по объекту \ppyrsrv{Персоналии}.

Даже при наличии указанного права удаление персоналии может натолкнуться на
препятствие в виде связанных с этой персоналией объектов. В этом случае система сообщит
о первом встретившемся таком объекте.

\paragraph{Теги}\indent\keyb{F2}
Открывает диалог просмотра и редактирования тегов выбранной персоналии.

\paragraph{Персональные события}\indent\keyb{F3}
Открывает список персональный операций, в который выбранная персоналия фигурирует
как первичная.

Подробно о персональных операциях см. гл.~\ref{ch-personevent}.

\paragraph{Регистры}\indent\keyb{F5}
Открывает диалог просмотра и редактирования регистров по выбранной персоналии.

\paragraph{Текущий регистр}\indent\keyb{Ctrl-F5}
Эта функция доступна в том случае, если в фильтре текущей таблицы
определен в качестве дополнительного атрибута просмотра какой-либо
регистр. В этом случае данная функция открывает диалог редактирования этого
регистра для выбранной персоналии.

\paragraph{Штатные суммы работодателя}\indent\keyb{Shift-F5}
Специфическая функция, действующая только для персоналий вида \ppyrsrv{Работодатели}.
Открывает список штатных сумм работодателя. Эти суммы влияют на процесс
расчета заработной платы.

\paragraph{Отношения}\indent\keyb{F6}
Открывает список персоналий, связанных с выбранной персональными отношениями.
Данная функция (в отличии от следующей) показывает только те персоналии,
с которыми выбранная персоналия связана прямыми отношениями.

\paragraph{Обратные отношения}\indent\keyb{Shift-F6}
Открывает список персоналий, с которыми выбранная персоналия связана обратными
персональными отношениями.

\paragraph{Добавить отношение}\indent\keyb{Ctrl-F6}
Позволяет добавить новое отношение между выбранной персоналией и какой-либо иной.

\paragraph{Печать}\indent\keyb{F7}
Отправляет список персоналий на печать.

Стандартные формы отчета зависят от дополнительного атрибута фильтра:
\begin{description}
	\item[Все адреса] \ppyrsrv{PsnAttrAddr}
	\item[Адреса доставки] \ppyrsrv{PsnAttrAddr}
	\item[Автономные адреса] \ppyrsrv{PsnAttrAddr}
	\item[Зависшие адреса] \ppyrsrv{PsnAttrAddr}
	\item[Дублируемые адреса доставки] \ppyrsrv{PsnAttrAddr}
	\item[Расчетный счет] \ppyrsrv{PsnAttrBnkAcct}
	\item[Телефон/адрес] \ppyrsrv{PsnAttrPhoneAddr}
	\item[Регистр на выбор] \ppyrsrv{PsnAttrRegister}
	\item[Тег на выбор] \ppyrsrv{PsnAttrTag}
	\item[В остальных случаях] \ppyrsrv{PersonList}
\end{description}

\ppyrsrv{PsnRelList}.

\paragraph{Системный журнал}\indent\keyb{Ctrl-J}
Открывает список системных событий, связанный с текущей персоналией.

\paragraph{Передать выборку персоналий}\indent\keyb{Ctrl-H}
Позволяет передать всю выборку персоналий, соответствующую текущему фильтру, в
другой раздел.

\paragraph{Передать выборку видов персоналий}\indent\keyb{Ctrl-B}
Дополнительная функция передачи данных, позволяющая переслать
список видов персоналий, которым соответствуют персоналии данной выборки,
в другой раздел.

\paragraph{Папка клиента}\indent\keyb{F4}
Если в конфигурации персоналий определен головной каталог персональный папок и
для персоналии определен регистр, идентифицирующий папку, то обращение
к этой функции откроет каталог персоналии благодаря чему пользователь сможет
быстро получить доступ к файлам, связанным с данной персоналией.

\paragraph{Аналитические статьи}\indent\keyb{Ctrl-A}
Так как персоналии как правило связаны с аналитическими статьями,
посредством чего участвуют в документообороте, учитываемом системой \ppybrand{},
данная функция позволяет открыть список аналитических статей, соответствующих
выбранной персоналии.

Подробно таблица просмотра аналитических статей разобрана на стр.~\pageref{sec-brw-ar}.

\paragraph{Просмотр задач по персоналии}\indent\keyb{Ctrl-T}
Эта функция открывает таблицу просмотра задач, связанных с данной персоналией.

Так как персоналия может играть в задачах различную роль (клиент, исполнитель, создатель),
система использует следующее правило для определения роли выбранной
персоналии, по которой следует фильтровать таблицу задач:
\begin{itemize}
	\item Если таблица персоналий отфильтрована по зарезервированному
	виду персоналий \ppyrsrv{Покупатели}, то отображаются задачи, в которых
	выбранная персоналия является клиентом.
	\item Если таблица персоналий отфильтрована по зарезервированному виду
	персоналий \ppyrsrv{Сотрудники}, то отображаются задачи, в которых
	выбранная персоналия является исполнителем.
	\item Если ни одно из предыдущих условий не выполняется, но
	выбранная персоналия относится к виду \ppyrsrv{Сотрудники}, то
	отображаются задачи, в которых выбранная персоналия является исполнителем.
	\item В противном случае будут показаны задачи, в который
	текущая персоналия является клиентом.
\end{itemize}

\paragraph{Просмотр персональных карт}\indent\keyb{Ctrl-S}
Выводит на экран таблицу персональных карт, владельцем которых является выбранная персоналия.

\paragraph{Объединение персоналий}\indent\keyb{Ctrl-U}
Взывает диалог объединения выбранной персоналии с какой-либо иной.
Другая персоналия для объединения должна быть выбрана в
появившемся диалоге.

Для выполнения этой функции пользователь должен обладать правом \dlgflag{Объединение персоналий}.

Если в фильтре задан один из следующих атрибутов:
\begin{itemize}
	\item Все адреса
	\item Адреса доставки
	\item Зависшие адреса
	\item Дублируемые адреса доставки
\end{itemize}

То данное действие повлечет вызов функции объединения адресов доставки
персоналии. Эта функция регламентируется флагом прав доступа \dlgflag{Объединение адресов}.

\paragraph{Редактировать фиксированную должность}\indent\keyb{Ctrl-Q}
Открывает диалог редактирования фиксированных должностей выбранной персоналии.
Как правило, эту функцию применяют для персоналий вида \ppyrsrv{Главная организация}
(см. стр.~\pageref{sec-mainorg-staff}).

\paragraph{Штатные календари}\indent\keyb{Ctrl-E}
Открывает диалог просмотра и редактирования штатных календарей выбранной персоналии.
Подробно штатные календари разобраны на стр.~\pageref{sec-staffcal}.

\paragraph{Итог по выборке}\indent\keyb{F9}
Выводит на экран диалог, в котором показано общее число записей в выборке,
соответствующей текущему фильтру.

\paragraph{Фильтр}\indent\keyb{Ctrl-V}
Позволяет изменить условия фильтрации текущей выборки персоналий.

\section{Диалог редактирования персоналии}

\ppypictsc{dlg-person}{Диалог персоналии}{0.4}

При создании новой записи о персоналии или редактировании существующей вы увидите диалог показанный на рис.~\ref{pic-dlg-person}.

Диалог, используемый при создании новой записи отличается от диалога редактирования наличием кнопки \dlgbutton{Найти аналог\dots}.
С помощью этой кнопки вы можете найти все персоналии, имена которых похожи на то, что вы сейчас будете вводить.
Эта функция позволяет избежать ввода дублирующих друг друга записей для одной и той же персоналии.

Еще одна функция, служащая этой цели работает следующим образом: после ввода нового наименования и перехода на другое поле,
система пытается найти среди всех персоналий в базе данных те, которые имеют такое же наименование (с точностью до регистра
символов - то есть, строчные и прописные символы не различаются). Если такие записи найдены, то на экран выпадает список
с именами и видами этих персоналий. Если пользователь обнаружил, что требуемая запись уже есть, ему достаточно
воспользоваться ею вместо ввода новой.

Следующая таблица перечисляет управляющие элементы этого диалога.

\begin{description}

	\item[\dlgcombo{Юридический статус}]
	В этом комбо-боксе следует выбрать юридический статус персоналии. Этот атрибут является обязательным.

	\item[Имя]
	В этом поле должно быть введено наименование персоналии в том виде, в котором эта персоналия будет
	представлена в списках выбора и отчетах. Другими словами, имя идентифицирует персоналию так,
	чтобы сотрудники вашей организации могли отличить ее от других персоналий.

	\item[Расширенное наименование]
	В этом поле может быть введено достаточно длинное (до 127 символов) полное наименование персоналии в том
	виде, в котором оно должно выводиться в печатных первичных документах (накладных, счетах-фактурах, и т.д.).

	Если это поле пустое, то для печати в таких документах используется имя персоналии.

	\item[\dlgcombo{Категория}]
	Перечисляемый параметр, позволяющий задать дополнительный классификатор для персоналии, который может
	использоваться в отчетах.

	Например, можно определить категории клиентов оптовой торговой фирмы: опт; розница; сетевая розница.

	\item[Примечание]
	Произвольный текст длиной до 251 символа. В этом поле вы можете указать любую краткую информацию о персоналии.

	\item[\dlgflag{Освобожден от НДС}]
	Если этот флаг установлен, то система считает, что все товарные операции с этим контрагентом освобождены от НДС.
	В основном это касается поставщиков и самой организации, ведущей учет.

	\item[\dlgflag{Не рассылать уведомления}]
	Если флаг установлен, то никакие SMS и e-mail рассылки не будут применяться к этой персоналии.

	\item[\dlgbutton{Юридический адрес}]
	При нажатии на эту кнопку открывается диалог редактирования юридического адреса персоналии.

	\item[\dlgbutton{Фактический адрес}]
	По этой кнопке вы можете редактировать фактический адрес персоналии. Если персоналия имеет пустой фактический адрес,
	то там, где необходимо, за фактический адрес принимается юридический.

	\item[\dlgbutton{Адреса доставки}]
	При нажатии этой кнопки станет доступен диалог редактирования списка адресов доставки персоналии.
	Персоналия может иметь любое количество адресов доставки. Чаще всего этот список применяется для оформления отгрузочных
	документов для покупателей, имеющих множество точек доставки товаров и услуг (сеть магазинов, сеть киосков,
	географически разделенные склады одного предприятия и т.д.).

	\item[\dlgbutton{Регистры}]
	Эта кнопка открывает доступ к редактированию списка регистрационных документов персоналии.

	\item[\dlgbutton{Счета}]
	По этой кнопке становится доступен список банковских счетов персоналии.

	\item[\dlgbutton{Телефоны}]
	Список телефонов, адресов электронной почты, web-адресов и прочих адресов для электронных коммуникаций с персоналией.

	\item[\dlgbutton{Отношения}]
	Позволяет получить доступ к диалогу просмотра и редактирования отношений между персоналиями.

	\item[\dlgbutton{Теги}]
	Предоставляет доступ к списку тегов персоналии.

	\item[Список \qu{Виды персоналии}]
	В этом списке перечисляются виды, к которым относится персоналия. Любая персоналия должна относиться как
	минимум к одному какому-либо виду.

	Для того, чтобы присвоить персоналии еще один вид нажмите кнопку \dlgbutton{+}. Для того, чтобы \qu{отнять} у
	персоналии принадлежность какому-либо виду нажмите кнопку \dlgbutton{-}.
	\ppynote{
		Система может запретить отъем у персоналии какого-либо вида, если принадлежность этому виду связывает
		персоналию со статьей аналитического учета, или если этот вид - последний в списке.
	}
\end{description}

\subsubsection{Диалог электронных адресов персоналии}

Нажатие кнопки \dlgbutton{Телефоны} в диалоге персоналии приведет к появлению на экране диалога \qu{Электронные адреса}.
Здесь предусмотрена возможность ввода номеров телефонов, факсов, пейджеров и других средств связи персоналии.

Последовательно нажимая клавишу \keyb{Tab}, можно переходить с комбо-бокса на сопутствующее ему поле ввода и вводить
соответствующие номера. Кнопка \dlgbutton{Весь список} позволит просмотреть и изменить электронные адреса списком.
Это может понадобиться в том случае, если для персоналии определено больше адресов, чем может вместиться в диалоговом окне.

\subsubsection{Диалог регистрационных данных персоналии}

\ppypict{dlg-psn-register}{Диалог редактирования регистра}

Кнопка \dlgbutton{Регистры} вызывает диалог, содержащий список всех введенных регистрационных данных персоналии.
Чтобы добавить информацию по новому регистрационному документу нажмите кнопку \dlgbutton{Добавить}.

Вид диалога редактирования регистрационного документа показан на рис.~\ref{pic-dlg-psn-register}. Далее
перечисляются его управляющие элементы.

\begin{description}
	\item[\dlgcombo{Тип документа}] Комбо-бокс выбора типа регистрационного документа.
	Значение в этом поле не может быть изменено равно как и не может оставаться пустым.

	\item[Персоналия] Справочное поле, показывающее наименование персоналии, к которой
	относится данный регистрационный документ.

	\item[Дата регистр] Дата выдачи (регистрации) документа. Значение, которое следует
	устанавливать в этом поле определяется спецификой типа регистра. Часто это поле
	остается пустым поскольку во многих случаях предприятию не важна дата инициации
	регистра.

	Если тип регистрационного документа содержит период срока действия регистров,
	относящихся к нему, то при вводе новой записи (после выбора типа) это поле
	автоматически заполняется значением текущей системной даты.
	\item[Действителен до]
	Дата, до которой данный регистр действителен. Так же как и для предыдущего
	поля это значение является опциональным и зависящим от конкретного типа регистра.

	Если тип регистрационного документа содержит период срока действия регистров,
	относящихся к нему, то при вводе новой записи (после выбора типа) это поле
	автоматически заполняется значением даты, отстоящей от текущей системной даты
	на заданное в типе количество дней.

	\item[Серия регистр]
	Серийный номер регистра. Во многих регистрационных документах это поле
	остается пустым. Однако, существует ряд типов регистров, в которых его следует
	заполнять. Например, гражданский паспорт.

	Индикатор под этим полем отображает количество символов в строке серии.
	Это поможет при вводе значений, длина которых может служить критерием правильности
	ввода.
	\item[Номер регистр]
	Символьный номер регистра. Обычно, наиболее существенная часть регистрационного
	документа.

	Если тип регистра задает счетчик номера, то при вводе нового документа (после выбора
	типа) это поле заполняется автоматически в соответствии с шаблоном и значением
	счетчика (см. стр.~\pageref{sec-pregtype-counter}).

	\item[\dlgcombo{Орган регистр}]
	Здесь может быть выбран регистрирующий орган, выдавший документ, которому
	соответствует запись.

	Вид, к которому относится персоналия регистрирующего
	органа определяется типом регистра.
\end{description}

\subsubsection{Диалог банковских счетов персоналии}

\ppypict{dlg-bnkacc}{Диалог банковского счета}

По кнопке \dlgbutton{Счета} активизируется диалог \qu{Банковские счета}.

Чтобы добавить новый счет нажмите кнопку \dlgbutton{Добавить}.
В диалоге \qu{Банковский счет} (рис.~\ref{pic-dlg-bnkacc}) выберите банк, тип счета,
номер и дату открытия счета. Последний параметр является необязательным.

Справа от номера счета высвечивается количество символов в строке номера.
Это - подсказка, помогающая не ошибиться при вводе номера.

Признак \dlgflag{Предпочтительный} используется в том случае, если персоналия имеет несколько расчетных счетов.
В этом случае, для печати документов и выборе расчетного счета в диалогах (платежного поручения, например)
в первую очередь будет использоваться счет с таким признаком.

\section{Персональные отношения\label{sec-personrel}}

\ppypict{Schema-PersonRelConcept}{Концептуальное представление персонального отношения}

Система \ppybrand{} позволяет определять между персоналиями отношения.

Персональное отношение представляет из себя связку между двумя персоналиями. Эта
связка обладает двумя важными свойствами:

\begin{description}
	\item[Направленность] Данное свойство означает, что всякое отношение
	четко задает направление от одной персоналии к другой.

	Со свойством направленности тесно связано понятие \ppyterm{обратного отношения}.
	Таковым называется отношение, направленное к данной персоналии от какой-либо
	иной.

	Описываемое свойство приводит к необходимости ввести два термина, употребляемых
	в контексте персональных отношений:
	\begin{description}
		\item[Первичная персоналия] Персоналия, от которой направлено отношение.
		\item[Вторичная персоналия] Персоналия, к которой направлено отношений.
	\end{description}

	Например, в отношении \qu{Член группы} первичной будет персоналия,
	являющаяся членом группы, а вторичной - персоналия, олицетворяющая группу.

	\item[Типизация] Каждое отношение между персоналиями имеет собственный
	тип. Типы отношений, в свою очередь, представлены, аналогично большинству
	объектов данных, идентификатором, наименованием, а также рядом атрибутов,
	необходимых для уточнения особенностей отношений каждого типа.
\end{description}

\subsection{Типы персональных отношений}

Типы персональных отношений доступны для просмотра и редактирования посредством
пункта меню \ppymenu{Справочники\rdir Персоналии\rdir Типы персональных отношений}.

Визуально справочник представлен типичным списком, в котором перечислены определенные
в базе данных типы отношений.

\subsubsection{Диалог редактирования типа персональных отношений}

\ppypict{dlg-personreltype}{Диалог редактирования типа персональных отношений}

Вид диалога показан на рис.~\ref{pic-dlg-personreltype}. Диалог содержит следующие
управляющие элементы:

\begin{description}
	\item[Наименование]
	Наименование типа отношения. Не допускается создание двух и
	более типов с одинаковыми именами.

	\item[ИД]
	Справочное поле, отображающее идентификатор типа.

	\item[Символ]
	Опциональный символ типа отношения. Используется для ссылки
	на запись из других программ или через программные интерфейсы.

	Если символ не пустой, то программа следит за тем, чтобы не было
	другой записи с таким же символом.

	\item[\dlgradioc{Отношение}]
	Переключатель, определяющий кратность (cardinality) отношений данного типа.
	Возможны следующие варианты (рис.~\ref{pic-Schema-PersonRelCardinality}):
	\begin{description}
		\item[\dlgradioi{Один-к-одному}]
		Одна персоналия может ссылаться отношением данного типа только
		к одной персоналии. Одновременно, к каждой персоналии может быть
		направлено только одно отношение такого типа от какой-либо иной персоналии.

		Типичным примером такого вида отношений является брак (в моногамной культуре,
		конечно же). То есть, один человек может состоять в браке только с одним, равно
		как и его брачный партнер может состоять в законном браке только с единственным
		человеком.

		\item[\dlgradioi{Один-ко-многим}]
		Такая кратность допускает чтобы одна персоналия имела отношение
		с любым числом других персоналий. Одновременно, к каждой персоналии не
		может быть направлено более одного отношения такого типа.

		В качестве примера можно привести отношение отцовства: один человек
		может быть отцом многих, в то время как ни один человек не может
		иметь более одного отца.

		\item[\dlgradioi{Многие-к-одному}]
		Этот вариант предполагает, что одна персоналия может иметь только
		одно отношения такого типа, но каждая персоналия может иметь произвольное
		число обратных отношений этого типа.

		Для примера можно использовать отношение филиал -> головная организация.
		Филиал имеет только одну головную организацию, в то время как одна
		организация в праве иметь произвольное число филиалов.

		\item[\dlgradioi{Многие-ко-многим}]
		Наконец, самый \qu{либеральный} вид кратности отношений: каждая персоналия может
		иметь любое число отношений такого типа с другими персоналиями. Это же касается и
		обратных отношений.

		Для этого случая примеров предостаточно: отношение друг -> друг,
		отношение акционер -> эмитент, поставщик -> покупатель и т.д.
	\end{description}

	\item[\dlgradioc{Статус отношений}]
	Переключатель определяет ограничение на установку отношения между
	персоналиями по юридическому статусу персоналий (см. стр.~\pageref{sec-person-status}).
	Фактически, это ограничение применяется к признаку \dlgradioi{Физическое лицо}/\dlgradioi{Юридическое лицо}
	статуса персоналии.

	Здесь варианты следующие:
	\begin{description}
		\item[\dlgradioi{Не определен}]
		Ограничение не применяется.

		\item[\dlgradioi{Человек-Человек}]
		Отношение может быть установлено только между физическими лицами.

		\item[\dlgradioi{Человек-Организация}]
		Отношение может быть установлено от физического к юридическому лицу.

		\item[\dlgradioi{Организация-Человек}]
		Допустимо отношение от юридического лица к физическому.

		\item[\dlgradioi{Организация-Организация}]
		Допускаются только отношения между юридическими лицами.

	\end{description}

	\item[\dlgflag{Наследует адрес}]
	Не используется (зарезервировано на будущее).

	\item[\dlgflag{Наследует фактический адрес}]
	Не используется (зарезервировано на будущее).

	\item[\dlgflag{Группирующее отношение}]
	Если флаг установлен, то отчеты, фильтруемые по персоналии, в случае,
	если в качестве критерия фильтрации выбрана персоналия, с которой связанны
	этим отношением другие персоналии, то отбор будет происходить по множеству
	этих персоналий (включая выбранную).

	Так, допустим вы определили группу сотрудников, связав их группирующим
	отношением с условной персоналией, олицетворяющей группу. Выбрав в качестве
	критерия фильтрации задач эту группу, вы увидите задачи связанные с любой
	из персоналией, входящей в эту группу.

	\item[\dlgflag{Наследует соглашение главной организации}]
	Этот признак применим только для зарезервированного соглашения \qu{Филиал}.

	Если флаг установлен, то аналитическая статья, соответствующая персоналии,
	связанной с головной организацией таким отношением, будет наследовать
	соглашение с покупателем от головной организации.

	Опция позволяет избежать дублирования ввода одинаковых соглашений
	для каждого из предприятий, входящих в филиальную сеть, являющуюся вашим
	клиентом.

	\item[Типы наследуемых регистров]
	В этом списке могут быть определены типы регистрационных документов,
	которые персоналии наследуют от той персоналии, с которой они связаны
	данным отношением.

\end{description}

\ppypict{Schema-PersonRelCardinality}{Иллюстрация видов кратности персональных отношений}

\subsection{Редактирование персональных отношений}

\subsubsection{Список отношений персоналии}

\ppypict{dlg-personrellist}{Диалог списка отношений персоналии}

При редактировании персоналии вы можете открыть для изменения список,
отображающий все отношения, которыми эта персоналия связана с другими.

Вид диалога списка показан на рис.~\ref{pic-dlg-personrellist}.

Здесь, кроме собственно списка, присутствует справочное поле с наименованием
персоналии, для которой выведены отношения.

Кнопки \dlgbutton{Добавить} и \dlgbutton{Удалить} предназначены, соответственно,
для добавления новых и удаления существующих записей списка.

Обратите внимание на то, что здесь нет кнопки \dlgbutton{Редактировать}. Связано это
с тем, что отношения изменять нельзя: их можно только создавать и удалять.

Кнопка \dlgbutton{Обратные отношения} позволяет увидеть отношения, которыми с
данной персоналией связаны другие персоналии.

\subsubsection{Диалог создания нового отношения}

\ppypict{dlg-personrel}{Диалог персонального отношения}

Для создания отношения между персоналиями применяется диалог, показанный
на рис.~\ref{pic-dlg-personrel}.

Управляющие элементы в здесь следующие:

\begin{description}
	\item[\dlgcombo{Персоналия}]
	В этом комбо-боксе отображается наименование первичной персоналии отношения.

	\item[\dlgcombo{Вид}] Вспомогательный комбо-бокс, позволяющий выбрать вид
	персоналий, которому должны соответствовать элементы списка комбо-бокса
	вторичной выбора первичной персоналии.

	\item[\dlgcombo{относится к персоналии}]
	Здесь должна быть выбрана вторичная персоналия отношения.

	Справа от комбо-бокса присутствует кнопка \dlgbutton{\dots}, с помощью
	которой можно определить сразу несколько персоналия, с которыми связана
	первичная данным отношением (кнопка доступна только если выбран вид
	персоналии).

	\item[\dlgcombo{как}]
	Здесь должен быть выбран тип отношения.
\end{description}

Следует заметить, что описанный диалог иногда используется для создания обратных
отношений. В этом случае элементы \dlgcombo{Персоналия} и \dlgcombo{относится к персоналии}
меняются местами.

\subsection{Таблица персональных отношений}

Для удобства работы с персональными отношениями в системе предусмотрена
функция просмотра и администрирования персональных отношения.

Функция может быть вызвана посредством пункта меню \ppymenu{Справочники\rdir Персоналии\rdir Персональные отношения}.

Команда \qu{Персональные отношения} позволяет создать на рабочем столе
иконку для вызова этой функции (в том числе с предустановленным фильтром).

\subsubsection{Фильтр персональных отношений}

\ppypict{dlg-f-personrel}{Диалог фильтра персональных отношений}

Вот описание элементов диалога:

\begin{description}
	\item[\dlgcombo{Тип отношения}]
	В комбо-боксе может быть выбран тип, которому
	должны соответствовать выводимые в отчете отношения.

	\item[\dlgbutton{Фильтр по персоналии}]
	Кнопка вызова диалога фильтра по персоналиям. С кнопкой сопряжен
	блок переключателей, определяющих к первичной или вторичной
	персоналии должен быть применен выбранный фильтр.

	\item[\dlgradioc{Сортировать по}]
	Позволяет выбрать порядок сортировки отчета.

	\item[\dlgradioc{Селектор выбора персоналии}]
	Специфический переключатель, определяющий поведение комбо-бокса,
	встроенного в панель инструментов таблицы персональных отношений.

	Если выбрано \dlgradioi{Первичная персоналия}, то указанный комбо-бокс
	позволит быстро отфильтровать отчет по первичной персоналии (то есть,
	в нем будут отображены только те отношения, первичной персоналией для которых
	выступает выбранная.

	Если выбрано \dlgradioi{Вторичная персоналия}, то комбо-бокс панели
	инструментов будет служить для быстрой фильтрации по вторичной персоналии.
\end{description}

\subsubsection{Действия в таблице персональных отношений}

\paragraph{Добавить}\indent\keyb{Insert}

Вызывает диалог создания нового персонального отношения. Если
в фильтре отчета установлен тип отношения, то в диалоге автоматически
будет установлен этот же тип (что не запрещает изменить его).

\paragraph{Добавить обратное отношение}
Вызывает диалог создания обратного отношения.

\paragraph{Удалить}\indent\keyb{Delete}
Удаляет выбранное отношение (предварительно запросив подтверждение).

\paragraph{Персоналия}\indent\keyb{F2}
Открывает диалог редактирования первичной персоналии и выбранного
в таблице отношения.

\paragraph{Обратные отношения}\indent\keyb{Ctrl-R}
Отображает таблицу обратных персональных отношений для персоналии,
которая является первичной в выбранной строке.

\paragraph{Фильтр}\indent\keyb{Ctrl-V}
Позволяет изменить условия фильтрации.

\paragraph{Печать}\indent\keyb{F7}
Отправляет на печать (или на экспорт) выборку отчета.

Стандартная форма отчета: \ppyrsrv{PsnRelList}.

\section{Конфигурация персоналий\label{sec-person-cfg}}

\ppypict{dlg-079}{Диалог конфигурации персоналий}

Доступ к опциям конфигурации персоналий возможен через пункт меню
\ppymenu{Админ\rdir Прочие конфигурации\rdir Конфигурация персоналий}.

Право просмотра и редактирования этой конфигурации регламентируется списком доступных конфигурации,
определенном для пользователя или группы пользователей.

На рис.~\ref{pic-dlg-079} изображен вид диалога редактирования конфигурации, а следующая таблица подробно перечисляет
управляющие элементы этого диалога.

\begin{description}
	\item[Каталог персональных папок]
	Это поле используется для настройки быстрого доступа к каталогам, в которых
	содержаться файлы, которые ваша организация ассоциирует с персоналиями.
	Если вы хотите воспользоваться функционалом быстрого доступа к файлам
	персоналий, то в этом поле необходимо указать головной каталог, в котором
	содержаться подкаталоги, соответствующие конкретным персоналиям.

	Имя каждого подкаталога определяется типом регистра, идентифицирующего
	наименование папки, определенного в записи вида персоналии.
	Естественно, для каждой персоналии, доступ к папке которой вам необходим
	из системы, необходимо указать номер такого регистра.

	\item[Каталог для файлов изображений]
	Каталог, из которого система пытается извлечь файлы изображений
	для привязки к персоналиям.

	\item[\dlgcombo{Тип регистра торговой лицензии}]
	Специализированный тип персонального регистрационного документа, определяющий номер и
	другие атрибуты торговой лицензии персоналии. Это поле должно быть заполнено, если
	вам необходимо в отчетах видеть атрибуты торговой лицензии предприятий.

	В структуре DL600 Person соответствующее поле, ссылающееся на регистр торговой лицензии,
	называется TradeLicID.

	\item[\dlgcombo{Регулярный штатный календарь}]
	Штатный календарь, используемый системой для определения рабочего времени персоналий (обычно это касается персонала
	предприятия).

	\item[Квант времени во временной диаграмме, сек]
	Минимальный временной промежуток, используемый во временной диаграмме
	штатных календарей.

	По умолчанию применяется 15-минутный квант времени.

	\item[\dlgflag{Синхронизировать персоналии по имени}]
	Опция, предписывающая системе, при приеме данных из других разделов,
	использовать контекстную синхронизацию по имени. При этом ищутся персоналии с точно совпадающим именем и
	принадлежностью тому же виду, что и персоналия, информация о которой поступила из другого раздела.

	Подробнее о синхронизации можно прочитать с соответствующем разделе этого руководства.

	\item[\dlgflag{Синхронизировать персоналии по поисковому регистру}]
	Если этот флаг установлен, то система при приеме данных из другого раздела, будет использовать контекстную
	синхронизацию по поисковому регистру.

	Регистром для поиска (или поисковым) считается регистрационный документ, связанный с персоналией и
	относящийся к типу, определенному в записи одного из видов персоналии как
	\qu{Тип регистрационного документа для поиска}.

	Если поступившая из другого раздела персоналия принадлежит нескольким видам, то порядок контекстной
	синхронизации по регистру следующий:
	Перебираются все виды, которым принадлежит персоналия, и для каждого вида, если в нем
	определен тип регистра для поиска и новая запись имеет такой регистр,
	ищется соответствующая персоналия в базе данных. Как только такая персоналия обнаруживается,
	поиск считается успешно завершенным.

	Обратите внимание на то, что обычно порядок следования видов, которым принадлежит персоналия непредсказуем.
	То есть, хотя это почти никогда не может привести к проблемам, необходимо помнить что теоретически это
	вносит некоторый элемент непредсказуемости в определение контекстной синхронизации персоналий по регистру.

	Замечание, касающееся предыдущих двух флагов.
	Если они оба установлены, то система пытается сначала идентифицировать персоналию по имени и, если это
	не удалось, то - по поисковому регистру.

	\item[\dlgflag{Не принимать изменения из других разделов}]
	Если вы установите этот флаг, то ваш раздел не будет принимать никаких изменений в персоналиях из
	других разделов.

	При этом персоналии, созданные в других разделах и отсутствующие в вашем, приниматься будут.

	\item[\dlgflag{Показывать картинку при вызове ассоциаций команд}]
	Специальная опция, предписывающая системе, при вводе новой персональной
	операции по команде рабочего стола, показывать фотографию персоналии.

	\item[\dlgflag{При синхронизации сливать списки регистров}]
	Опция влияет на процесс акцепта персоналии из другого раздела
	базы данных.

	Если флаг установлен, то при изменении персоналии, инициированном
	другим разделом базы данных, список регистров в текущем разделе будет
	объединяться с тем, что пришел из другого раздела. При этом, если
	регистрационный документ одного типа есть и текущем разделе и в
	разделе-отправителе, то здесь он будет замещаться.

	Если флаг не установлен, то список регистров изменяемой персоналии
	будет полностью переписан списком, пришедшим из другого раздела.

	Данная опция может понадобиться для того, чтобы избежать неоправданной
	потери регистров персоналий в результате акцепта данных из других разделов.

	\item[\dlgflag{Передавать прикрепленные файлы}]
	Если флаг установлен, то при синхронизации разделов базы данных данный раздел будет передавать
	в другие разделы файлы, связанные с персоналиями (обычно, это - изображения).

	\item[\dlgflag{При синхронизации дополнять отсутствующими видами}]
	Опция, регулирующая акцепт персоналий, поступающих из других разделов базы данных.


	\item[\dlgbutton{Дополнительные поля адресов}]
	Список наименований дополнительных полей адресов.
	Каждое дополнительное поле определяется идентификатором от 101 до
	120 и текстом.

	В адресе можно ввести только те поля, которые определены в этой конфигурации.

	\item[\dlgbutton{Транзакции нового клиента}]
	Кнопка открывает диалог редактирования параметров идентификации новых контрагентов.

\end{description}

\section{Права доступа к персоналиям}

\ppypict{dlg-080}{Диалог прав доступа к персоналиям}

Диалог редактирования прав доступа по персоналиям показан на рис.~\ref{pic-dlg-080}.

\begin{description}
	\item[\dlgflag{Просмотр}]
	Разрешает просмотр списка персоналий.

	\item[\dlgflag{Создание}]
	Разрешает создание новой записи о персоналии.

	\item[\dlgflag{Модификация}]
	Разрешает изменение существующей записи о персоналии.

	\item[\dlgflag{Удаление}]
	Разрешает удаление записи о персоналии.

	Наличии этого права не отменяет проверку системой
	возможности удаления на предмет наличия ссылок на эту персоналию из других объектов данных.

	\item[\dlgflag{Админ}]
	Позволяет модифицировать права доступа к персоналии.

	\item[\dlgflag{Объединение персоналий}]
	Предоставляет право на объединение записей о персоналиях.

	Учитывая необратимость операции объединения персоналий, мы рекомендуем предоставлять
	это право только узкому числу лиц.

	\item[\dlgflag{Изменение изображений}]
	Разрешает изменять привязку изображения, связанного с записью о персоналии.

	\item[\dlgflag{Объединение адресов}]
	Флаг предоставляет право на объединение адресов доставки.

	\item[\dlgflag{Массовое изменение персоналий}]
	Установка флага разрешает пользователю применять функции массового изменения
	выборки персоналий.

\end{description}

\section{Управление информацией о собственной организации}

Предприятие, непосредственно работающее с системой называется \ppyterm{Главной организацией}.
Естественно, главная организация является персоналией. Вы можете управлять одновременно
информацией о произвольном количестве главных организаций. Все они должны иметь
принадлежность к одноименному зарезервированному виду.

Таким образом, редактирование данных о главных организациях доступно из таблицы персоналий,
обсуждавшейся выше.

\subsection{Главная организация по умолчанию\label{sec-mainorg}}

При открытии нового сеанса работы система выбирает текущую главную организацию
следующим образом:

\begin{enumerate}
	\item Извлекается конфигурация, действующая для учетной записи пользователя,
	который авторизовался в базе данных. Если в этой конфигурации указана
	главная организация по умолчанию, то таковая и будет установлена.
	\item Если в конфигурации пользователя не определена главная организация %
	по умолчанию, то значение этого параметра извлекается из общих настроек
	\ppymenu{Админ\rdir Настройки} \dlgbutton{Главная организация} (стр.~\pageref{sec-commcfg-mainorg}).
\end{enumerate}

\subsection{Изменение текущей главной организации}

Если вы хотите изменить текущую главную организацию, с которой работает
ваш сеанс, то откройте диалог текущего состояния (\ppymenu{Справочники\rdir Текущее состояние}
либо двойной щелчок мышью в крайней левой зоне строки состояния, находящейся в нижней
части рабочего окна) и в этом диалоге измените главную организацию.

\subsection{Управление информацией об ответственных сотрудниках организации\label{sec-mainorg-staff}}

При печати различных первичных документов, необходимо, чтобы в отчетах отображались
данные об ответственных лицах. Чаще всего речь идет о директоре и главном бухгалтере
предприятия.

Самый простой способ указания директора и главного бухгалтера состоит в
обращении к уже упоминавшемуся диалогу информации о главной организации в
общих настройках системы (\ppymenu{Админ\rdir Настройки} \dlgbutton{Главная организация} стр.~\pageref{sec-commcfg-mainorg}).

В этом диалоге есть комбо-боксы выбора соответствующих сотрудников. Как не трудно
догадаться, эти сотрудники также являются персоналиями. Они должны принадлежать к
зарезервированному виду \ppyrsrv{Персонал}.

У рассмотренного способа наряду с простотой есть существенный недостаток: если
вы работаете с несколькими главными организациями, то система будет считать, что
указанные в настройках директор и главный бухгалтер ответственны за все эти
организации.

Для решения этой проблемы существует понятие фиксированных должностей.
Суть его заключается в резервировании системой специальных должностных назначений
и привязки сотрудников к организациям согласно этим должностям.

Практически (с точки зрения пользователя) такая привязка делается достаточно просто:
откройте таблицу персоналий, относящихся к виду \ppyrsrv{Главная организация} и на той
записи, к которой вы хотите привязать директора и (или) главного бухгалтера, выберите
пункт локального меню \ppymenu{Редактировать фиксированную должность} либо нажмите
\keyb{Ctrl-Q}. Откроется диалог, в котором вы сможете сделать обсуждаемые действия.

В дополнение скажем, что фиксированных должности могут быть присвоены не только
персоналиям с видом \ppyrsrv{Главная организация}, но и любым другим.

\chapter{Товары\label{ch-goods}}

Понятие товара является одним из центральных в системе \ppybrand{}. Под этим понятием
подразумеваются любые материальные и нематериальные активы предприятия, кроме, возможно, денег,
да и то только по тому, что для учета денежных активов в системе существует модуль бухгалтерского учета.

Товаром можно считать любую продукцию, которая производится или реализуется на
предприятии и может быть учтена количественно, а также основные фонды, услуги,
электроэнергию и т.д.

Формирование справочника товаров является одним из главных моментов в работе с системой.
От того насколько удобно будет организован справочник товаров, зависит подчас
вся дальнейшая работа.

Часть товаров, подлежащих учету, вводится в ходе настройки системы.

Товары, не вошедшие в справочник при внедрении системы, можно легко ввести в дальнейшей работе.

\section{Характеристики товара}

\ppypictsc{Schema-Goods}{Схема взаимосвязей объектов семейства справочника товаров}{0.5}

Любой товар характеризуется достаточно обширным набором атрибутов. Некоторые из них
являются обязательными (то есть, товар должен иметь четко заданное значение такого атрибута).
Другие - опциональные. Многие атрибуты товаров являются сложными: ссылаются на
какие-то объекты данных либо представлены списочными структурами.

На рисунке представлена схема взаимодействия основных объектов данных семейства
справочника товаров с самим товаром. Подчеркнем то, что схема охватывает далеко
не полный список атрибутов элемента справочника товаров.

Далее кратко описываются некоторые атрибуты товаров (в том числе, не показанные на схеме).

	\paragraph{Наименование}
	Полное наименование товара. Наименование должно быть уникальным. Это значит, что не
	должно быть двух товаров с полностью одинаковыми наименованиями.

	Атрибут обязательный.

	\paragraph{Группа товара}
	Определяет принадлежность товара к той или иной группе. Этот параметр позволяет
	разбить все множество товаров, учитываемых на предприятии, на группы для удобного
	поиска и отчетности.

	Далее мы подробно опишем товарные группы. Сейчас же заметим, что рассматриваемый
	атрибут является так называемой обыкновенной товарной группой.

	Атрибут обязательный.

	\paragraph{Производитель\label{loc-goodsattr-manuf}}
	Персоналия, относящаяся к зарезервированному виду \ppyrsrv{Производители},
	являющаяся изготовителем товара. Подчеркнем, что это именно производитель,
	а не поставщик товара.

	Система допускает в качестве производителя указывать специализированные персоналии,
	имеющие юридический статус \ppyrsrv{Страна}. Это - трюк, позволяющий упростить ввод товаров,
	для которых вашему предприятию необходимо определять только страну-производителя.

	Если персоналия-производитель не имеет статус \ppyrsrv{Страна}, то страна
	происхождения такого товара определяется из юридического адреса этой персоналии.

	\paragraph{Брэнд}
	Торговая марка товара. Принадлежность торговой марке очень часто важна
	для эффективного анализа данных об операциях по товарам.

	\paragraph{Штрихкод}
	Цифровой или алфавитно-цифровой код, идентифицирующий товар. Один товар может иметь любое
	количество штрихкодов, но каждый штрихкод является уникальным, это значит, что два разных
	товара не могут иметь один общий штрихкод.

	\paragraph{Единицы измерения}
	Этот параметр определяет единицы количественного учета товара.

	Товарная единица измерения предназначена для основного учета товара на предприятии.

	Физическая единица измерения и соотношение между товарной и физической единицами
	предназначены для учета товара в физических единицах.

	Например, в литрах для напитков, в килограммах для консервированного мяса и т.д.

	\paragraph{Тип товара}
	Используется для определения специфических характеристик учета товара.

	\paragraph{Налоговая группа}
	Параметр, определяющий схему налогообложения операций с товаром.

	\paragraph{Класс товара}
	Параметр, определяющий дополнительные описательные характеристики товара.

\section{Типы товаров\label{sec-goodstype}}

Тип товара характеризует особенности учета товаров, принадлежащих этому типу.
Эти особенности включают такие характеристики как типы сумм документов, в которых
учитываются все операции с товарами, принадлежность товаров к классу неограниченных ресурсов и пр.

Для просмотра и редактирования справочника типов товаров следует обратиться к пункту меню
\ppymenu{Справочники\rdir Товары\rdir Типы товара}.

\ppypict{dlg-goodstype}{Диалог редактирования типа товаров}

Диалог редактирования типа товаров приведен на рис.~\ref{pic-dlg-goodstype}.

Приведем список параметров типа товара с подробным описанием

\begin{description}
	\item[Наименование]
	Уникальное наименование, идентифицирующее тип товара.

	\item[Символ]
	Пустая либо уникальная строка, используемая для ссылки на запись из формул или из других приложений.

	\item[ИД]
	Справочное поле, отображающее значение идентификатора записи.

	\item[\dlgflag{Неограниченный ресурс}]
	Если этот признак установлен, то товар, относящийся к этому типу, может приходоваться и
	расходоваться в любых количествах. При этом учет остатков такого товара не ведется.

	Самым популярным примером такого типа товаров являются услуги. Ваше предприятие может,
	как пользоваться услугами других предприятий, так и само оказывать какие-либо услуги.
	При этом ведется только учет оборота услуг, то есть, сколько каких услуг и кому оказано.
	Другими примерами неограниченных ресурсов могут служить: электроэнергия, песок, добываемый в
	карьере, и т.д. Понятно, что эти виды ресурсов в принципе ограниченны, но так как невозможно
	учитывать их остатки, их следует отнести именно к этой категории.

	Кроме того, неограниченным ресурсом можно объявить товар, по которому вы просто не хотите
	вести учет остатков, хотя он и является ограниченным по своей природе.

	\item[\dlgflag{Автокомплектация}]
	Это - довольно редко используемый признак.

	Товар, относящийся к типу с установленным признаком
	автокомплектации и имеющий структуру, допускающую комплектацию (описание структур
	товара приведено ниже), будет создаваться по требованию одновременно с расходованием.

	Примером автокомплектуемых товаров могут служить блюда на предприятиях общественного питания.
	Когда клиент заказывает что-либо в ресторане, этого блюда, как правило, на остатках нет:
	его приходится готовить непосредственно перед подачей к столу.
	В этом случае в системе выписывается расход заказанного блюда, которое
	одновременно с этим комплектуется из необходимых ингредиентов.

	\ppynote{
		Несмотря на то, что эта опция по прежнему поддерживается, для реализации возможностей,
		предоставляемых ею, следует использовать новые, более развитые способы:
		драфт-документы	и автокомплектацию в кассовых сессиях.
	}

	\item[\dlgflag{Основные фонды}]
	Если этот признак установлен, система считает все товары, относящиеся к такому
	классу основными средствами предприятия.

	Учет основных средств в системе \ppybrand{} подробно рассматривается в гл.~\ref{ch-assets}.

	\item[\dlgflag{Авансовый сертификат}]
	Флаг предназначен для обозначения товаров, принадлежащих этому типу, как документы, приобретаемые
	покупателями с целью последующего предъявления для получения по ним реальных товаров и(или) услуг.
	Наиболее типичным представителем такого типа товаров являются подарочные сертификаты.

	Системе в некоторых случаях необходимо знать о том, что продаваемый товар относится к такому типу.
	Например, для правильного бухгалтерского учета и проведении операции продажи через кассовый аппарат.

	\item[Суммы цен поступления и реализации]
	Эти параметры определяют типы сумм, в которых учитываются операции с товаром
	в ценах поступления и реализации.

	Стандартный тип товара учитывается в стандартных же (зарезервированных) ценах
	поступления и реализации, имеющих символы соответственно Cost и Price.

	Если вы хотите, чтобы операции с какими-либо товарами учитывались на отдельных счетах в
	бухгалтерском учете, то вам следует воспользоваться этими параметрами.

	В качестве примера можно привести различие между сырьем и готовой продукцией
	на производственных предприятиях. Так как в бухгалтерии эти типы товаров
	учитываются на разных счетах, то у них должны быть разные суммы учета.

	\item[Признаки замены стандартных цен поступления и реализации]
	Эти параметры перекликаются с описанными выше. Если признак замены стоит,
	то товары, относящиеся к этому типу, будут учитываться только в заданных
	соответствующих суммах, а стандартные суммы цен поступления и (или)
	реализации не будут учитывать операции с товарами этого типа.
	Если же признак замены не стоит, то операции с товарами этого типа будут
	учитываться как в указанных суммах, так и в стандартных суммах.

	\item[\dlgflag{Не включать в номинальную сумму}]
	Если этот признак установлен, то в товарных документах товары, имеющие тип
	с таким свойством будут исключены из расчета номинальной суммы. Необходимость
	использования этого признака может быть обусловлена тем, что некоторые товары,
	хотя и включаются в содержание товарного документа, но не оплачиваются или
	оплачиваются каким-либо нестандартным способом.

	\item[\dlgflag{Допускается нулевая цена реализации}]
	По умолчанию, система запрещает приходовать товары с нулевой ценой реализации,
	поскольку это нарушает логичность учета. Если, все же, вам необходимо
	приходовать товары с учетной ценой реализации равной нулю, то такие товары
	следует связать с типом, у которого установлен флаг
	\dlgflag{Допускается нулевая цена реализации}.

	\item[\dlgflag{Не включать в расчет исходящего НДС}]
	Если флаг установлен, то строки товарных документов, относящихся к товарам этого типа
	не будут включаться в расчет исходящего НДС по документу.

	Подчеркнем, что речь идет именно об исходящем НДС, то есть,
	НДС в ценах поступления по документу будут включать товарные
	позиции на глядя на принадлежность товара типу с описываемым флагом.

	\item[\dlgflag{Штрихкод обязателен}]
	Флаг предписывает системе следить за тем, чтобы создаваемый или
	редактируемый товар, если принадлежит данному типу, обязательно
	содержал по крайней мере один штрихкод.

	Если данный флаг установлен для типа, имеющего идентификатор 1 (стандартный
	тип), то для всех товаров, не имеющих принадлежности типу, а также
	явно принадлежащих такому типу, система будет требовать ввода
	штрихкода.

	Обратите внимание на то, что рассматриваемый флаг функционально
	пересекается с опцией $+$ ограничения длин штрихкодов из
	конфигурации товаров (стр.~\pageref{sec-goods-cfg}). Однако действует только на товары
	заданного типа, в то время как опция $+$ действует абсолютно
	для всех товаров.

	\item[\dlgflag{Квази-неограниченный}]
	Флаг, предназначенный для специализированной обработки товаров данного типа как не лимитированных, не смотря
	на то, что в остальных аспектах они ведут себя как обычные товары.

	На момент ввода (версия 8.5.1) применяется для включения товаров такого типа в акт выполненных услуг.

	\item[\dlgflag{Применять фиксированные розничные цены}]
	На товары этого типа, имеющего такой признак, розничные цены могут дифференцироваться в зависимости от партии
	В России эта опция нужна для разрешения проблем с ценами на сигареты. При изменении максимальной розничной цены (МРЦ)
	ритейлеры вынуждены выбирать ту цену, которая отпечатана на пачке.

	\item[\dlgflag{Маркируемый}]
	Если флаг установлен, то товары, принадлежащие этому типу, трактуются как подлежащие индивидуальной маркировке.
	В частности, российской системой Честный Знак.
	\ppybrand{} использует эту информацию, например для того, чтобы отправлять на асинхронные кассовые модули
	соответствующую информацию.

	\item[\dlgflag{Сумма НДС в ценах поступления}]
	Здесь вы можете указать тип суммы, в которой будет рассчитываться НДС в ценах
	поступления.

	\item[\dlgcombo{Группа списания}]
	Используется только для товарных типов, имеющих признак \dlgflag{Основные фонды}. Группа списания определяет
	правила амортизации основных фондов, принадлежащих данному типу.

	\item[\dlgcombo{Ограничение товарных величин}]
	Определяет набор ограничений на включение товаров данного типа в товарные документы. Подробно ограничения
	товарных величин рассмотрены на стр.~\pageref{sec-goodsvalrestr}.

	\item[Толерантность к остатку]
\end{description}

Система предполагает, что товар, если не оговорено иное, относится к так
называемому стандартному типу.

Стандартный тип товара учитывается в стандартных суммах по ценам поступления и
реализации и является ограниченным ресурсом.

\section{Ограничения товарных величин\label{sec-goodsvalrestr}}

Объект данных ограничения товарных величин предназначен для управления включением товаров
в товарных документы. Рассматриваемый объект осуществляет такое управление применительно к выборке товаров,
имеющих тип, связанный с записью ограничений.

Ограничения товарных величин позволяют специфицировать следующие аспекты включения товаров в документ:
\begin{itemize}
	\item Минимальная цена реализации, определенная формулой
	\item Максимальная цена реализации, определенная формулой
	\item Набор аналитических статей, являющихся контрагентом или дополнительным объектом документа, для
	которых запрещена либо разрешена вставка в документ товаров, на которые распространяется действие  данного
	ограничения.

	Условие разрешения для какой-либо статьи автоматически устанавливает запрет на остальные статьи, которые не
	перечислены в наборе с таким же условием.
\end{itemize}

Доступ к списку ограничений товарных величин возможен через пункт меню \ppymenu{Справочники\rdir Товары\rdir Ограничения товарных величин}.

\ppypict{dlg-goodsvalrestr}{Диалог редактирования ограничений товарных величин}

Диалог редактирования записи ограничений приведен на рис.~\ref{pic-dlg-goodsvalrestr}.
Вот описание управляющих элементов этого диалога.

\begin{description}
	\item[Наименование] Уникальное наименование записи ограничений товарных величин.
	\item[Символ] Пустой или уникальный символ записи, используемый для ссылки на нее из формул
	или из других приложений.
	\item[Идентификатор] Справочное поле, отображающее значение идентификатора записи.
	\item[Формула нижней границы] Формула, определяющая нижнее ограничение на цену реализации товара.
	\item[Формула верхней границы] Формула, определяющая верхнее ограничение на цену реализации товара.
	\item[\dlgbutton{Проверить формулы}] Кнопка, позволяющая проверить правильность ввода формул нижнего и
	верхнего ограничений.
	\item[Список \qu{Ограничения для статей документов}]
	Список аналитических статей, которые, являясь основной или дополнительной статьей документа, накладывают
	ограничение на ввода товаров в такой документ.

	Каждая статья, включенная в список, может иметь один из четырех признаков:
	\begin{description}
		\item[Только для выбранного контрагента]
		Товары могут быть введены в документ, имеющий только выбранную основную статью (контрагента).
		Если в списке есть хоть одна запись с таким признаком, то для любой статьи, не включенной в список,
		действует неявный запрет на вставку товаров в документ.

		\item[Запрет для выбранного контрагента]
		Для выбранной статьи, установленной в документе в качестве основного контрагента, действует явный запрет
		на добавление в такой документ товаров, на которые распространяется данное ограничение.

		\item[Только для выбранной дополнительной статьи]
		Аналогично пункту \qu{Только для выбранного контрагента}, но действует для дополнительной статьи документа.

		\item[Запрет для выбранной дополнительной статьи]
		Аналогично пункту \qu{Запрет для выбранного контрагента}, но действует для дополнительной статьи документа.
	\end{description}

	\ppyexample{
		Допустим в вашем справочнике 33 аналитических статьи: А, Б, В,.., Я.
		Если в список добавлена статья В с признаком \qu{Только для выбранного контрагента} то товары, на
		которые распространяется данное ограничение нельзя будет добавить в документ, контрагентом которого
		является А, Б, Г и т.д. Но в документ с контрагентом В эти товары смогут попасть.

		Если в список вы добавите статью Б с таким же признаком, то для документов с контрагентами Б и В
		вставка товаров будет приемлемой в отличии от оставшихся 31 контрагента.
	}

	\item[\dlgbutton{Параметры управления отгрузкой...}]
\end{description}

\section{Налоговые группы\label{sec-goodstaxgroup}}

Многие операции с товарами облагаются налогами. Как сами налоги, так и их ставки,
а также способы расчета могут быть различными в зависимости от товаров и операций
с ними. Для классификации товаров по видам налогообложения в системе \ppybrand{}
используется понятие налоговой группы.

Для просмотра и редактирования налоговых групп товаров следует использовать пункт меню
\ppymenu{Справочники\rdir Товары\rdir Налоговые группы}.

Налоговая группа определяет ставки и порядок расчета налогов, которыми
облагаются операции с товарами. Кроме того, налоговая группа позволяет задать
различные значения и схемы расчета налогов в зависимости от даты документа и вида операции.

\ppypict{dlg-taxgrp}{Диалог редактирования налоговой группы}

На рис.~\ref{pic-dlg-taxgrp} изображен вид диалога редактирования налоговой группы.
Далее описаны параметры, которыми характеризуется налоговая группа.

\begin{description}
	\item[Наименование]
	Уникальное наименование налоговой группы, позволяющее отличать ее от других
	налоговых групп.

	Мы рекомендуем применять наименования, в которых отражаются ставки
	налогов, заданные группой.

	\item[Идент]
	Внутренний идентификатор налоговой группы.

	\item[Символ]
	Уникальный символ налоговой группы.

	Символ может быть пустым, если же это не так, то система следит за тем, чтобы ни одна
	другая налоговая группа не имела такого символа. Символ используется для идентификации
	налоговой группы при обмене данными между разделами либо с другими системами.

	\item[Ставка акциза (A)]
	Ставка акцизного сбора, которым облагаются операции с товаром, принадлежащим этой налоговой
	группе. Ставка акциза может быть указана как в процентах, так и в абсолютном выражении.
	В последнем случае после числа, обозначающего размер акцизного сбора, должен быть
	указан символ \$.

	Например, 12 означает, что товары облагаются 12\% акцизным сбором, а 12\$ означает,
	что товары облагаются акцизным сбором в размере 12 единиц базовой валюты
	(скажем, рублей) на каждую единицу товара.

	\item[Ставка НДС (V)]
	Ставка налога на добавленную стоимость, по которой облагаются операции с товарами,
	относящимися к этой налоговой группе. Эта ставка указывается в процентах.

	\item[Ставка налога с продаж (S)]
	Процентная ставка налога с продаж, которой облагаются продажи товаров этой
	налоговой группы.

	\item[Порядок расчета налогов]
	В зависимость от товаров, с которыми работает предприятие, и
	особенностей налогообложения в регионе может изменяться порядок
	исчисления налогов при операциях с товарами.

	В большинстве случаев и для большинства товаров порядок исчисления следующий:
	сумма операции за вычетом всех налогов облагается сначала акцизом,
	затем  полученная сумма облагается налогом на добавленную стоимость
	и, наконец, сумма, включающая уже и акциз и НДС, облагается налогом с продаж.

	Соответственно, такой порядок расчета налогов мы будем записывать так AVS
	(используя буквы латинского алфавита, приведенные в это таблице при описании
	соответствующих налогов).

	Этот порядок система \ppybrand{} использует по умолчанию, то есть если не указано иное.
	Если вы хотите изменить порядок расчета для какой-либо налоговой группы, то вам следует
	поменять соответствующим образом порядок следования символов в этой тройке.

	Иногда может применяться так называемый параллельный порядок исчисления %
	некоторых налогов, при этом за налогооблагаемую базу принимается одна и та же сумма
	при исчислении двух или более налогов. Для отражения такой ситуации в порядке исчисления
	символы, обозначающие налоги, рассчитываемые параллельно, берутся в квадратные скобки,
	например [AV]S.

	\item[Не распространять акциз на приходные операции]
	Установка этого флага приведет к тому, что ставка акциза не будет применяться к
	операциям типа \ppyrsrv{Приход товара}, даже если эта налоговая группа используется для расчета
	налогов по таким операциям.

	\item[\dlgflag{Расширенный список}]
	В расширенном списке налоговой группы перечисляются схемы налогообложения, зависящие от
	периода и вида операции. Элемент списка аналогичен заголовочному содержанию группы,
	но, кроме того, содержит поле ввода периода действия и комбо-бокс выбора операции.

	\item[\dlgbutton{Список}]
	Если флаг \dlgflag{Расширенный список} включен, то нажав на эту кнопку, вы увидите список
	налоговых схем, зависящих от периода и вида операции.
\end{description}

\subsection{Расширенный список налоговой группы}

На расширенном списке налоговой группы следует остановиться подробнее.
Часто возникает ситуация, когда налогообложение операции с товаром зависит не только от
самого товара, но и от того, когда эта операция произведена и, какая это собственно
операция (вид операции).

Так, при изменении законодательства, налогообложение одного и того же товара может измениться.
При этом как-то следует учитывать операции до даты изменения налогообложения и после.
В этом случае, система позволяет в расширенном списке указать схему налогообложения до даты
изменения с одними значениями налогов, а после - с другими.

Кроме того, система позволяет связать схему налогообложения с конкретным видом операции.
Такая схема будет применяться  только для операций, имеющих указанный вид, и
попадающих в указанный временной период.

\subsection{Правила выбора системой схемы налогообложения}

Для верного использования налоговых групп при организации учета необходимо знать, как система
выбирает схему налогообложения в каждом конкретном случае. Опишем здесь порядок выбора:

\begin{enumerate}
	\item Если запись о товаре содержит группу налогообложения, то используется она
	\item Иначе, если обыкновенная товарная группа, которой принадлежит товар,
	содержит группу налогообложения, то используется эта группа
	\item Иначе считается, что товар никакими налогами не облагается %
	\item Если выбрана не пустая налоговая группа, то система смотрит расширенный список этой группы
	\item Если в расширенном списке содержится схема, соответствующая виду операции
	и дате документа, то используется эта схема
	\item Иначе, если в расширенном списке содержится схема, соответствующая дате документа и
	с неопределенным видом операции, то используется эта схема
	\item Иначе, используется заголовочная схема налоговой группы
	\item Если налоговая группа не содержит расширенного списка, то система использует
	головную схему
	\item Для расчета входящих налогов (налогообложение лотов) используется только
	заголовочная схема и расширенные схемы, не ссылающиеся на какой-либо вид операции.
\end{enumerate}

\section{Группы товаров}

Для удобства классификации, выбора и получения отчетности весь справочник
товаров в системе \ppybrand{} разносится по товарным группам.

Система предусматривает три разновидности товарных групп:

\begin{itemize}
	\item обыкновенные
	\item альтернативные группы
	\item группы верхнего уровня
\end{itemize}

Обыкновенные группы являются основным способом группировки справочника товаров.
Каждый товар принадлежит одной и только одной обыкновенной группе. Другими словами,
если вы заводите новый товар, то система проследит, чтобы вы обязательно указали к
какой из обыкновенных групп он относиться.

Товар можно отнести к другой обыкновенной группе, но при этом из той группы,
к которой он относился до этого, он будет убран.

Из-за описанных особенностей обыкновенных групп часто возникают проблемы
с произвольной группировкой товаров для целей получение отчетности и других.
Для решения этих проблем предусмотрено понятие альтернативной группировки товаров.

Альтернативная товарная группа может содержать любое множество товаров,
при этом две и более альтернативные группы могут содержать один и тот же товар.

Кроме двух описанных разновидностей товарных групп существует третья,
имеющая вспомогательное значение. Это - группа верхнего уровня.

Группы верхнего уровня позволяют строить иерархическую (древовидную) структуру товарных групп.
Группа верхнего уровня сама не может содержать товаров.

Для просмотра и изменения справочника товарных групп используется пункт
меню \ppymenu{Справочники\rdir Товары\rdir Группы товаров}.

%topic(DLG_GOODSGROUP)

\subsection{Параметры обыкновенной товарной группы}

\ppypict{dlg-goodsgrp}{Диалог редактирования обыкновенной товарной группы}

В следующей таблице сведены параметры обыкновенных товарных групп,
вид диалога для редактирования которых показан на рис.~\ref{pic-dlg-goodsgrp}.

\begin{description}
	\item[Наименование]
	Уникальное имя товарной группы.

	Максимальная длина поля - 127 символов.

	\item[Код]
	Уникальный символьный или числовой код группы.
	Код группы может быть использован для формирования штрихкодов товаров, а так же для ссылки
	на эту группу из формул (например, для бизнес-показателей) и из внешних программ.

	Для выбора уникального двухзначного кода группы можно нажать клавишу \keyb{F2},
	когда каретка находится в этом поле.

	Максимальная длина поля - 14 символов.

	\item[\dlgcombo{Родительская группа}]
	Группа верхнего уровня, которой принадлежит товарная группа.
	Родительская группа может быть не определена, то есть товарная группа не обязательно
	должна принадлежать какой-либо группе верхнего уровня.

	\item[Ранг]

	\item[\dlgcombo{Торговая единица измерения}]
	Это вспомогательный параметр. Если торговая единица указана, то при создании новой
	записи товара, принадлежащего группе, в поле \qu{Торговая единица} будет появляться эта
	единица измерения. Такая возможность реализована для ускорения ввода и снижения количества
	вероятных ошибок.

	\item[\dlgcombo{Физическая единица измерения}]
	Параметр, аналогичный описанному выше. Влияет на поле \qu{Физическая единица измерения}
	вновь вводимых товаров, принадлежащих этой группе.

	\item[\dlgcombo{Тип товара}]
	Параметр, определяющий тип тех товаров, принадлежащих группе, для которых тип не задан явно.

	\ppynote {
		Будьте внимательны с этой особенностью. Если вы полагаетесь на наследование типа
		товара от группы, то четко определите регламент администрирования справочника товаров.

		В противном случае возможны значительные неприятности при переносе товара с не заданным
		явно типом между группами которые переопределят его тип.
	}

	\item[\dlgcombo{Налоговая группа}]
	По действию этот параметр аналогичен предыдущему: определяет схему налогообложения товаров,
	принадлежащих группе, для которых налоговая группа не указана явно.

	Вспомогательная кнопка \dlgbutton{*} справа от комбо-бокса \dlgcombo{Налоговая группа}
	позволяет просмотреть или изменить налоговую группу, указанную в комбо-боксе.

	\item[\dlgcombo{Класс товаров}]
	Товары, создаваемые с принадлежностью к группе с не пустым классом товаров, автоматически
	получают этот класс. Если группе назначается класс, то товары, которые уже принадлежат
	этой группе, этот класс не получают. Аналогично, если товар получает принадлежность
	группе, имеющей класс, то он не получает этот класс.

	\item[\dlgcombo{Шаблон штрихкода}]
	Здесь может быть указан шаблон штрихкода, используемый системой для автоматического
	назначения штрихкодов товарам, принадлежащим этой группе, и создаваемым по образцу
	уже существующего товара.

	Обратите внимание, что эта опция может быть использована только для тех товаров,
	которые должны иметь внутренние коды.
	Она не годится для товаров, штрихкод которых задается вне вашего предприятия (заводские коды).

	\item[\dlgcombo{Процессор по умолчанию}]
	Узко специализированный атрибут группы, обеспечивающий автоматическое
	создание технологии при вводе нового товара, принадлежащего этой группе.

	Подробнее о процессорах и технологиях см. главу~\ref{ch-manuf}.

	\item[\dlgcombo{Именованная структура по умолчанию}]
	Если здесь выбрана (именованная) товарная структура, то новые товары,
	относящиеся к этой группе, будут получать при создании эту структуру.

	\item[\dlgbutton{Котировки}]
	Позволяет увидеть и редактировать котировки, заданные непосредственно на группу.

	Подробно о товарных котировках рассказано в главе \qu{Котировки}
	(стр.~\pageref{sec-quot}).

	\item[\dlgbutton{Дополнительные поля}]
	Диалог, открывающийся при нажатии этой кнопки предоставляет возможность переопределить
	заголовки дополнительных полей товаров, принадлежащих данной группе.

	Те заголовки, которые не переопределены в группе, система получает из конфигурации
	товаров.
	\item[Предельное количество товаров]
\end{description}

%endtopic

\subsection{Альтернативные группы товаров}

Что делать, когда необходимо сгруппировать несколько товаров каким-то отличным от
постоянной группировки образом?
Ответ: прибегнуть к услугам альтернативной группировки.

Альтернативная группировка товаров дает возможность создать новую группу и отнести к ней любой
набор товаров. При этом каждый из этих товаров будет по-прежнему принадлежать той обыкновенной
группе, которой принадлежал и ранее. Более того, альтернативная группа позволяет
определить фильтр, в соответствии с которым, товары автоматически могут быть присвоены
группе, если соответствуют этому фильтру.

Альтернативную группу можно использовать аналогично обыкновенной. Например, можно получить отчет
по альтернативной группе, или в товарных документах выбирать товар, предварительно выбрав альтернативную группу.

Специализированными, но исключительно полезными применениями альтернативных групп
является определение групп товаров, загружаемых на электронные весы и формирование
прайс-листов.

\subsubsection{Создание альтернативной группы}

\ppypict{dlg-goodsgrp-alt}{Диалог редактирования альтернативной товарной группы}

Альтернативная группа может быть создана так же, как и обыкновенная.
Для этого в справочнике групп товаров нажмите кнопку \dlgbutton{Добавить} или
клавишу \keyb{Insert}. В появившемся на экране блоке переключателей выберите
\dlgradioi{Альтернативная группа}. Диалог новой альтернативной группы содержит поле
наименования, поле кода группы, комбо-бокс родительской группы и кнопку
\dlgbutton{Фильтр}. По этой кнопке вы можете задать фильтр принадлежности
товаров создаваемой альтернативной группе.

\subsubsection{Фильтр товаров в альтернативной группе}

Как быть, если необходимо иметь альтернативную группу, которой должны принадлежать
товары, отвечающие некоторым формальным критериям? Ответ: для этой группы следует
задать фильтр товаров.

Определение такого фильтра не только позволит быстро занести в новую альтернативную
группу требуемые товары, но и поддерживать специфицированные в фильтре отношения между
этой группой и новыми товарами.

Фильтр альтернативной товарной группы в точности совпадает с фильтром, используемым
в таблице товаров.

Фильтр сам по себе не обязывает соответствующий ему товар принадлежать альтернативной
группе, а лишь облегчает ее заполнение. Кроме того, альтернативной группе, имеющей
фильтр, могут принадлежать товары, которые и не соответствуют этому фильтру.

\subsubsection{Добавление и удаление товаров из альтернативной группы}

Для добавления товаров в альтернативную из справочника групп товаров, установив
указатель текущей группы на нужную альтернативную группу, нажмите кнопку
\dlgbutton{Товары} или клавиши \keyb{F11}. При этом на экране появится таблица товаров, относящихся к этой группе.

Нажмите клавишу \keyb{Insert}. На экране появится список выбора товаров. Установив
указатель на нужном товаре, нажмите клавишу \keyb{Enter} или дважды щелкните
мышью над этим товаром. В результате выбранный товар появится в таблице.

При этом список остается на экране, готовый для выбора нового товара.

Для того, что бы убрать этот список с экрана, нажмите клавишу \keyb{Escape}.

В нижней части списка выбора товара для вставки в альтернативную группу присутствует
кнопка \dlgbutton{Автозаполнение}. Эта кнопка предназначена для автоматического
заполнения группы товарами, соответствующими фильтру альтернативной группы.

Один товар не может быть дважды присвоен одной альтернативной группе. Если вы
попытаетесь внести в альтернативную группу товар, который уже ей принадлежит,
то система никак не отреагирует на это действие.

Для того чтобы отменить принадлежность товара альтернативной группе в таблице
просмотра товаров по этой группе нажмите клавишу \keyb{Delete}. При этом связь
между этим товаром и альтернативной группой исчезнет, хотя сам товар, естественно,
удален не будет.

Если вы удалите всю альтернативную группу, то будут разрушены и связи товаров,
принадлежащих этой группе с ней. Для удаления всех товаров из альтернативной группы
следует нажать клавиши \keyb{Ctrl-F8}.

При вводе нового товара система проверяет его на соответствие фильтрам альтернативных групп.
Если товар подходит под спецификацию одного или более таких фильтров, то система
предлагает автоматически добавить новый товар в соответствующие группы.

\subsubsection{Динамические альтернативные группы}

Обсуждавшаяся выше процедура вставки и удаления товаров из альтернативной группы в
некоторых случаях является недостатком в глазах пользователей.

Рассуждения здесь обычно следующие: коль скоро мы определили фильтр для альтернативной группы,
то почему мы должны постоянно поддерживать актуальность ее состава. То есть, из-за происходящих
время от времени изменений в справочнике товаров, какие-то товары должны выводится из состава группы,
а какие-то, наоборот, вносится туда.

Для решения этой задачи существует понятие динамической альтернативной группы. Ее отличие состоит в том,
что не существует жесткой привязки товара к такой группе. Система автоматически определяет набор принадлежащих
ей товаров, основываясь на условиях фильтрации, заданных для этой группы.

Что бы сделать альтернативную группу динамической просто включите флаг \dlgflag{Динамическая} в диалоге
редактирования группы.

\ppynote {
	Так как не существует жесткой привязки товара к динамической альтернативной группе,
	соответствие \qu{товар - альтернативная группа} не имеет своего номера.

	Это принципиально важно для загрузки электронных весов. По этому система запрещает делать
	динамическими группы, привязанные к весам.
}

\subsubsection{Эксклюзивные альтернативные группы}

Еще одна дополнительная возможность предоставляется так называемыми эксклюзивными альтернативными группами.
Это - альтернативные группы, принадлежащие группе верхнего уровня, для которой установлен признак
\dlgflag{Не пересекающиеся альтернативные группы}. Система следит за тем, чтобы две или более альтернативные
группы, входящие в группу верхнего уровня с таким признаком не содержали бы одинаковых товаров.

\section{Единицы измерения\label{sec-units}}

Наличие единиц измерения является необходимым условием при количественном учете товара.
В зависимости от вида единиц измерения принимается та или иная форма ведения учета.
Существующие единицы измерения можно классифицировать как:

\begin{itemize}
	\item Товарные единицы
	\item Физические единицы
	\item Единицы системы СИ
	\item Целочисленные единицы
\end{itemize}

Товарная единица является основной единицей учета товара.
Примерами товарных единиц измерения могут быть: штука, бутылка, килограмм.

Физические единицы служат для учета товаров в независящих от вида упаковки величинах.
Например: килограмм, литр, метр.

Некоторые единицы измерения стандартны и являются единицами системы СИ (кг, метр, сек).
Эти единицы измерения зарезервированы системой и установлены в базе данных изначально.

Обратите внимание на то, что некоторые единицы измерения могут относиться одновременно к
нескольким типам. Так, килограмм может использоваться и как товарная, и как физическая единица измерения.
Кроме того, килограмм является единицей СИ.

Целочисленными будем называть единицы, характеризующие товар как единое целое и неделимое.
Целочисленными единицами могут быть: пачка, упаковка, штука. Если товар имеет целочисленную единицу
измерения, то его нельзя оприходовать либо израсходовать в дробном количестве.

Перечень единиц измерения приводится в списке диалога \qu{Единицы измерения} при обращении к пункту
меню \ppymenu{Справочники\rdir Товары\rdir Единицы измерения}.

\ppypict{dlg-unit}{Диалог редактирования единицы измерения}

Чтобы ввести новую единицу измерения, нажмите кнопку \dlgbutton{Добавить} либо клавишу \keyb{Insert}.
В диалоге \qu{Единица измерения} введите название и сокращение новой единицы измерения.

Задайте признаки классификации, характеризующие единицу измерения.

\begin{description}
	\item[Наименование]
	Наименование единицы измерения. Это поле, во-первых, не должно быть пустым, а, во-вторых,
	должно содержать отличное от других единиц измерения значение.

	\item[Сокращение]
	Сокращенное наименование единицы измерения.
	Для физических единиц рекомендуется использовать стандартизованные международные сокращения.

	\item[Ид]
	Внутренний идентификатор единицы измерения.

	\item[Базовая единица и Соотношение]
	Если эта единица измерения может быть приведена к какой-либо стандартной единице посредством
	коэффициента пересчета, то здесь можно указать такую единицу, а в поле \qu{Соотношение} установить коэффициент.

	\ppynote{
		По состоянию на момент написания этой части документации (версия 5.9.0) система использует эту пару
		полей только для идентификации единиц измерения, производных от секунды (применяется в технологических
		сессиях для учета повременных технологий).
	}

	\item[\dlgflag{Товарная}]
	Если это признак установлен, то единица измерения может быть применена для товаров.

	\item[\dlgflag{Физическая}]
	Установка этого флага означает, что единица используется для измерения физических величин.

	Например: \qu{килограмм} или \qu{лошадиная сила} являются физическими величинами, в то время как
	\qu{штука}, \qu{бутылка} не являются (их фактическое значение может варьироваться).

	\item[\dlgflag{СИ}]
	Флаг применяется для пометки стандартных физических единиц измерения.

	\item[\dlgflag{Целочисленная}]
	Если этот признак включен, то система не позволяет оперировать дробными значениями количества
	товара, для которого установлена эта единица измерения.

	\item[Дробность]
	Это поле расширяет признак единицы \dlgflag{Целочисленная}. Значение этого
	поля определяет минимальную величину, кратную которой товара, измеряемый данной
	единицей может участвовать в операциях.

	\ppyexample{
		Если для единицы измерения \qu{Буханка} установить дробность 0.25,
		то товар, измеряемый этой единицей (скажем, хлеб) может быть
		продан только величинами, кратными $1/4$: 0.25, 0.5, 0.75, 1.0 и т.д.
	}

	\ppynote{
		Поле введено в версии 6.7.8 и пока имеет очень ограниченную область
		применения. А именно, для загрузки данных на асинхронные кассовые
		узлы.

		Однако, в дальнейших релизах планируется расширять его область использования.
	}
\end{description}

\section{Штрихкоды\label{barcode-review}}

Так как использования штрихкодов вызывают много вопросов, здесь мы обрисуем несколько важных моментов,
касающихся практического использования штриховой кодировки на предприятии.

Штрихкоды - это чисто цифровые или алфавитно-цифровые коды, с помощью которых особым образом маркируют товары.
Штрихкод уникальным образом идентифицирует конкретный товар, то есть, не существует двух различных наименований
товаров, имеющих один штрихкод. Под разными товарами здесь подразумеваются не только качественно различные товары,
но и один и тот же товар, расфасованный в упаковки разной емкости.

\ppynote{
	В действительности штрихкоды уникальны не всегда. Из-за ошибок или халатности некоторых производителей штриховая
	кодировка двух или более различных товаров может быть одинаковой. Такое случается весьма редко, но при достаточно
	большом ассортименте товара на предприятии этим нельзя пренебрегать.

	Однако в дальнейшем мы все же будем полагать, что штрихкоды уникальны.

	Проблемы коллизий, возникающих по вине производителей товаров, мы коснемся отдельно.
}

Существует несколько систем штриховой кодировки товаров. Наиболее широко используемыми в розничной торговле являются следующие:

\begin{itemize}
	\item EAN-8 (8-значный)
	\item EAN-13 (13-значный)
	\item UPC-A (8-значный)
	\item UPC-E (12-значный)
\end{itemize}

Эти четыре системы кодировки являются чисто цифровыми. Последняя цифра в штрихкоде каждой из этих кодировок -
контрольная. Она служит для проверки правильности считывания кода.

В зависимости от используемого оборудования и принятых на предприятии форм работы, можно либо указывать
контрольную цифру при вводе кода товара, либо нет. Но в любом случае нельзя смешивать эти две схемы.
То есть нельзя для некоторых товаров вводить штрихкод с контрольной цифрой, а для других - не вводить.
В конфигурации справочника товаров (стр.~\pageref{sec-goods-cfg}) определен флаг \dlgflag{Штрихкод содержит контрольную цифру}
указывающий системе вводите вы штрихкоды с контрольной цифрой или же без нее.

\ppynote{
	Мы рекомендуем применять ввод с контрольной цифрой.
}

Так как не все товары промаркированы производителем, возникает необходимость маркировать такие товары прямо
на предприятии. Система \ppybrand{} позволяет в таких случаях автоматически присваивать товару уникальный внутри
вашего предприятия, штрихкод. При этом следует иметь в виду, что присвоенный таким образом код некорректно
интерпретировать, как принадлежащий какой-либо системе кодировки, поскольку в большинстве случаев не может быть
и речи об уникальности подобного кода на пространстве, простирающемся за пределами вашего предприятия.

Разумеется, если вы используете описанный в предыдущем параграфе способ присвоения штрихкода товару, то должны
иметь и оборудование, с помощью которого можно было бы отпечатать этикетку с кодом.

Еще одна сложность возникает с весовыми товарами. Они чаще всего не маркированы, поскольку вес расфасовки
определяется непосредственно при реализации товара покупателю. Общепринятым решением этой проблемы
является маркировка по следующей системе:

\begin{itemize}
	\item первые две цифры кода являются префиксом весового товара (обычно это
	значения от 21 до 29, так как промышленных кодов с таким префиксом не должно существовать)
	\item далее идет пятизначный код товара (уникальный для товаров внутри предприятия,
	но не во всем мире)
	\item заканчивается такой код 5- или 6-значным обозначением веса расфасовки
\end{itemize}

\ppyexampletitle{Пример весового кода}{
	293700502350

	Здесь первые две цифры (29) являются префиксом весового товара.

	Следующие пять цифр (37005) идентифицируют товар.

	Последние пять цифр (02350) указывают вес упаковки - 0.235кг.
}

Обычно для маркировки весового товара используют электронные весы с принтером этикеток.
Система позволяет экспортировать информацию о подмножестве товаров на такие весы с тем, чтобы затем можно было быстро
и эффективно фасовать и маркировать товар. Подробнее об оборудовании, используемом для печати этикеток со штрихкодом
см. разделы, посвященные принтерам штрихкодов и электронным весам.

\subsection{Список штрихкодов\label{sec-barcodelist}}

Система позволяет присвоить одному товару любое количество штрихкодов. При этом каждый из таких кодов
остается уникальным в пределах базы данных (система не допустит ввода двух одинаковых кодов ни при каких обстоятельствах).

В связи с возможностью ведения списка штрихкодов для одного товара возникают следующие нюансы:

\begin{itemize}
	\item Управление несколькими штрихкодами для одного товара сложнее. В первую очередь это связано с тем,
	что ввод одного кода в карточке товара предельно прост, в то время как для ввода списка штрихкодов
	необходимо совершить несколько дополнительных действий.

	\item Во многих случаях система должна выбрать \ppyterm{единственных штрихкод}\label{term-singlebarcode} товара из списка.
	Чаще всего эта проблема возникает при отображении штрихкода, связанного с товаром, на экране или в отчетах.
	В такой ситуации действует правило приоритетного штрихкода. В соответствии с этим правилом, система
	выбирает единственный код по следующему алгоритму:
	\begin{itemize}
		\item Если у товара один штрихкод, то, очевидно, он и является приоритетным.
		\item Если список содержит более одного кода, и один из них - предпочтительный, то этот код и будет
		приоритетным (подробнее предпочтительный код описан ниже).
		\item Если у товара несколько штрихкодов, то система выбирает первый код из списка, с которым
		сопоставлено количество единиц 1.
		\item Если в списке нет ни одного кода, у которого количество единиц равно одному,
		то выбирается самый первый код из списка.
	\end{itemize}
\end{itemize}

Вы можете менять порядок следования штрихкодов в списке для того, чтобы сделать один из кодов приоритетным.

\subsubsection{Предпочтительный код}
Программа допускает установку на одном из штрихкодов опцию \qu{Предпочтительный}. Опция является эксклюзивной,
то есть, если на одном коде она устанавливается, то с другого (если до этого была на нем установлена) - снимается.

Предпочтительный код всегда является приоритетным и выделяется в диалоге товара зеленым цветом.

\subsubsection{Низкоприоритетные коды}

Еще одна очень специализированная опция позволяет сделать коды, соответствующие заданному шаблону,
низкоприоритетными (то есть, такие коды будут всегда оказываться в конце списка). Подробнее эта опция описана в
документе pp\_ini.txt, входящем в состав дистрибутива пакета (параметр BarcodeLowPriority в группе config].

\subsection{Выбор товаров по штрихкоду}

\ppyexample{
	\qu{0288822} - Сигареты Мальборо

	\qu{*460114} - Все товары, коды которых содержат \qu{460114}

	460114000001

	460114000122

	890460114001

	и т.д.
}

Во всех диалогах, где присутствуют комбинированные списки выбора товара (фильтр по лотам, фильтры карточки товара,
группировки товарных операций и т.д.), а также в таблице товарных строк документа товар можно выбрать по штрихкоду.

Для этого в диалоге, сделав поле выбора товара активным, необходимо нажать \keyb{F2} (в браузере товарных строк
документа - \keyb{F3}, цифровую клавишу или \keyb{*}). Вслед за этим на экране появится небольшое окно для ввода
штрихкода. В поле этого окна следует ввести искомый штрихкод полностью. Если требуется найти штрихкоды, содержащие
некоторую последовательность цифр, то перед этой последовательностью нужно ввести символ \keyb{*}.
Затем нажать \keyb{Enter} для поиска или \keyb{Escape}, для отмены поиска

Если был задан поиск по подстроке и существуют штрихкоды, содержащие указанную строку, то на экране появится список
найденных кодов с наименованиями товаров. Выберите интересующий вас товар и нажмите \keyb{Enter}.

\ppynote{
	Таким же образом, вы можете найти товар по его идентификатору. Для этого необходимо в окне
	ввода штрихкода для поиска первым символом поставить \#, а далее ввести значение идентификатора.
	Например, для поиска товара с идентификатором 10211 следует набрать \#10211.
}

\section{Структура штрихкодов\label{sec-barcodestruc}}

Штрихкод является уникальной характеристикой товара. Он содержит в себе информацию о товаре и его изготовителе
в зашифрованном виде.

\ppypict{dlg-barcodetemplate}{Диалог редактирования структуры штрихкода}

Система позволяет автоматически формировать штрихкоды на товары, опираясь на правила,
зафиксированные в структуре штрихкода. В зависимости от вида товара эти правила могут существенно отличаться.

Список типов внутренней кодировки можно получить при обращении к меню \ppymenu{Справочники\rdir Товары\rdir Структура штрихкодов}.

Чтобы ввести новый тип нажмите кнопку \dlgbutton{Добавить}. В диалоге \qu{Структура штрихкода}
(рис.~\ref{pic-dlg-barcodetemplate}) укажите наименование нового типа внутренней кодировки и шаблон
формирования штрихкода.

Шаблон штрихкода вводится в следующей форме:

$prefix format range suffix$

Далее приведено описание элементов формата.

\paragraph{$Prefix$}
Префикс кода, который может либо отсутствовать, либо принимать одно из следующих значений:
\begin{itemize}
	\item GRP и @GR - код группы товара. В случае использования такого префикса код группы должен быть цифровым.
	\item @WP - префикс кода весового товара, который берется из конфигурации справочника товаров).
	\item @CP - префикс кода весового счетного товара, который берется из конфигурации справочника товаров
	\footnote{Подробно о конфигурации справочника товаров см. стр.~\pageref{sec-goods-cfg}}.
\end{itemize}

\paragraph{$Format$}
Формат изменяемой части кода. Он может иметь следующий вид: \%d.

Здесь:

\% - обязательный символ, означающий начало форматной части.

d - длина изменяемой части кода.

\paragraph{$Range$}
Необязательный диапазон значений изменяемой части кода, имеющий вид [Min..Max]. Min - это минимальное
значение изменяемой части кода, а Max - соответственно, максимальное. Если эта часть шаблона отсутствует,
то диапазон значений изменяемой части кода принимает значение [1..10d-1].

\paragraph{$Suffix$}
Если после изменяемой части должен идти какой-либо фиксированный суффикс кода, то его следует указать
в конце шаблона.

Если суффикс является цифровым, то, чтобы система смогла отделить суффикс о цифровых символов предыдущих
частей шаблона, его следует предварить обратным слэшем (\textbackslash).

Например, шаблон \ppysyntax{\@WP\%04\textbackslash 0} будет генерировать коды с весовым префиксом впереди,
четырехзначным кодом и нулем в конце.

Если необходимо, чтобы в программа рассчитала контрольную цифру полученного штрихкода и
вставила его в конец сгенерированного кода, последним символом шаблона поставьте \textasciicircum.

\ppyexample{
	Шаблон \ppysyntax{\@GR\%3[101..899]} для товаров группы с кодом 34 будет генерировать следующую последовательность
	кодов: 34101, 34102, 34103 и т.д. до 34899 включительно.

	Шаблон \ppysyntax{\%3} будет генерировать последовательность: 001, 002, 003 и т.д. до 999 включительно.

	Шаблон \ppysyntax{\@WP\%5} будет генерировать последовательность (если положить, что префикс кода весового товара 29):
	2900001, 2900002, 2900003 и т.д. до 2999999 включительно.

	Шаблон \ppysyntax{201\%09\textasciicircum} будет генерировать последовательность
	2010000000014, 2010000000021, 2010000000038 и т.д.

	Обратите внимание что в приведенной последовательности последняя цифра является расчетным значением
	контрольной цифры, которую \ppybrand{} самостоятельно добавил в конец, так как мы добавили в шаблон
	штрихкода последним символом \textasciicircum.
}

\section{Классы товаров}

Понятие класса товаров определяет отраслевую специфику товаров.

Основой класса товаров является определение дополнительных свойств и размерностей.

Классы товаров не только предоставляют мощный механизм для классификации товарной номенклатуры,
но и обеспечивают средства для использования критериев этой классификации для тонкого управления учетом
на производстве и получения отчетности.

Основной принцип функционирования механизма классов товаров заключается в том, что для однородной группы
товаров определяется класс, в котором задаются до 4-х перечисляемых и до 4-х числовых характеристик товаров,
принадлежащих этому классу.

При создании нового товара, если он принадлежит какому-либо классу, то для этого товара
определяются значения заданных характеристик. Система же, самостоятельно, опираясь на правила, описанные в
классе этого товара, формирует необходимые атрибуты, благодаря чему в дальнейшем система работает с этим
товаром, как и с любым другим.

\ppyexampletitle{Приведем простой пример}{
Мебельная фабрика закупает для производства мебели листы ламинированной ДСП (древесно-стружечной плиты)
нескольких стандартных типоразмеров и расцветок.

Определим класс товара \qu{ДСП ламинированная} со следующими характеристиками:

\begin{itemize}
	\item цвет (перечисляемая характеристика)
	\item толщина
	\item ширина
	\item длина (числовые характеристики)
\end{itemize}

После того, как этот класс определен, каждый типоразмер и цвет ламинированной ДСП мы будем задавать,
вводя только указанные четыре характеристики, а система самостоятельно сформирует наименование товара,
его площадь и (или) массу.

Более того, когда нам понадобится отчет о закупках или о расходе на производство этих товаров,
мы сможем их видеть не только по отдельности, но и в разрезе любой характеристики (например,
использование ламинированной ДСП цвета \qu{бук}).

Но и это еще не все. Благодаря такой классификации, \ppybrand{} позволит нам сэкономить трудозатраты
на ввод структур изделий. Если, скажем, предприятие производит одинаковые модели столов, но при
этом цвет столов одной модели может различаться, то мы сформируем только одну структуру, указав
лишь системе, что она должна использовать тот же цвет ДСП, какой указан для конкретной серии
столов (разумеется, производимые столы также должны принадлежать к какому-либо классу, у которого
определена характеристика \qu{цвет} таким же образом как и у ламинированной ДСП).
}

\subsection{Как товар получает принадлежность классу?}

Мы решили вынести этот вопрос на обсуждения до того, как рассмотрим подробно создание и редактирование
классов товаров потому, что он (этот вопрос, то есть) важен для понимания атрибутов класса, а также
для уяснения потенциальных проблем, встающих перед пользователем, когда он работает с классифицированными товарами.

И так, существует три способа обеспечить принадлежность товара классу:

\begin{enumerate}
	\item У существующего товара в поле \qu{класс} просто выбрать класс, к которому этот товар должен относиться.
	Этот тривиальный способ чаще всего используется в тех случаях, когда решение классифицировать справочник
	товарной номенклатуры, было принято уже после того, как большая часть этого справочника была сформирована.
	Другой случай - выявление ошибочной принадлежности товара не тому классу, либо отсутствие принадлежности
	товару какому-нибудь классу вообще. Следует сообщить, что этот способ, хотя и вполне \qu{законен} по сути,
	и корректен с точки зрения функционирования системы, не является желательным, поскольку не обеспечивает
	достаточного уровня автоматизации работы персонала предприятия с номенклатурным справочником.
	В сущности, одно из серьезнейших достоинств классов товаров состоит в том, что эта технология позволяет
	снизить издержки на ввод товаров.

	\item При создании записи товара в контексте обыкновенной группы, у которой установлен товарный класс,
	новый товар автоматически получает этот класс. Здесь необходимо пояснить что подразумевается под выражением
	\qu{в контексте обыкновенной группы}: если вы создаете новую запись товара, нажав \keyb{Insert}, в списке товаров,
	сформированном  по такой группе, или создаете новый товар из таблицы товаров, построенной по фильтру,
	содержащему одну единственную обыкновенную группу. В таком случае, система автоматически считает,
	что новый товар принадлежит классу, заданному в группе и при необходимости вызывает соответствующий
	диалог (об этом - дальше).

	\item При создании товара в контексте, собственно, этого класса. Здесь произойдет то же, что и при
	создании товара в контексте группы, имеющей указание на класс. Плюс к тому, если этот класс имеет
	заданный атрибут \qu{Группа по умолчанию}, то новый товар автоматически получит принадлежность указанной
	обыкновенной группе.
\end{enumerate}

\subsection{Администрирование классов товаров}

\subsubsection{Диалог редактирования класса товаров}

\ppypictsc{dlg-goodsclass}{Диалог редактирования класса товаров}{0.5}

Список классов товаров доступен через пункт меню \ppymenu{Справочники\rdir Товары\rdir Классы товаров}.
Диалог редактирования класса показан на рисунке.

\begin{description}
	\item[Наименование]
	Наименование класса. Оно должно быть уникальным среди всех классов товаров.
	Максимальная длина строки наименования - 47 символов.

	\item[ИД]
	Внутренний идентификатор записи класса товаров. При создании нового класса,
	в подавляющем большинстве случаев, это поле следует оставлять нулевым (система
	самостоятельно присвоит этот идентификатор).

	При редактировании существующего класса это поле недоступно для изменения.

	\item[Формула для наименования товара]
	Система следит за тем, чтобы вы обязательно указали шаблон наименования для
	товарного класса. См. ниже.

	\item[Формула для аббревиатуры товара]
	Здесь можно ввести формулу для сокращенного наименования товара.
	Правила ввода формулы те же, что и для наименования.
	Это поле заполнять не обязательно: если этот шаблон отсутствует, то для сокращенного
	наименования система будет использовать формулу, определенную для полного
	наименования товара.

	\item[\dlgcombo{Торговая единица измерения}]
	Здесь следует выбрать торговую единицу измерения, которая будет автоматически
	присваиваться новым товарам этого класса.

	\item[\dlgcombo{Физическая единица измерения}]
	В этом поле можно выбрать физическую единицу измерения, которая должна будет
	присваиваться новым товарам этого класса.

	Это поле не обязательное.

	\item[Формула для соотношения физических единиц к торговым]
	Это поле предназначено для формулы, в соответствии с которой будет
	формироваться соотношение между торговыми и физическими единицами товара, принадлежащего классу.
	См ниже.

	Это поле обязательно к заполнению, только если вы указали физическую единицу
	измерения в этом диалоге.

	\item[\dlgcombo{Тип товара}]
	Это поле предназначено для указания товарного типа, к которому получит принадлежность
	вновь созданный товар, относящийся к этому классу.

	Это поле не обязательное.

	\item[\dlgcombo{Налоговая группа}]
	Если вы выберите в этом комбо-боксе налоговую группу, то товары, получающие при создании
	принадлежность этому классу, получат и эту налоговую группу.

	Это поле не обязательное.

	\item[\dlgcombo{Группа по умолчанию}]
	Если новый товар, принадлежащий классу создается вне контекста обыкновенной товарной группы,
	то он получит принадлежность группе, которая указана в этом комбо-боксе.

	Это поле не обязательное.

	\item[Формула коэффициента для расчета акциза]
	Это - очень специфичное поле. Оно предназначено для работы с товарами, акциз на которые
	рассчитывается исходя из параметров этого товара. Единственный на текущий момент реальный пример
	использования - алкогольная продукция в Российской Федерации, акциз на которую рассчитывается в
	зависимости от содержания чистого спирта.

	В этой формуле применяются те же правила ввода, что и для формулы соотношения физических единиц
	к торговым.

	Это поле не обязательное.

	\item[Формула емкости упаковки поставки]
	В этом поле можно ввести формулу для автоматического формирования значения емкости упаковки
	поставки товара (оно вводится обычно вручную по кнопке \dlgbutton{Дополнительно} в стандартом диалоге товара).
	Если вы укажете здесь формулу, то рассчитанное по ней значение будет автоматически
	присваиваться товару, принадлежащему этому классу.

	В этой формуле применяются те же правила ввода, что и для формулы соотношения физических единиц к торговым.

	Это поле не обязательное.

	\item[\dlgflag{Полный диалог редактирования товара}]
	Если этот флаг установлен, то для редактирования товара, принадлежащего классу, используется общий
	диалог. В противном случае, используется сокращенный диалог, в котором можно ввести только
	классификаторы товара.

	\item[\dlgflag{Дублирование комбинаций параметров}]
	Если этот флаг установлен, то система не допускает существования более одного товара,
	принадлежащего одному классу и имеющего один и тот же набор значений классификаторов.

	\item[\dlgflag{Запрет на ввод произвольных размерностей}]
	При установке этого флага, система будет запрещать ввод значений числовых
	классификаторов, не попадающих в список допустимый (см. пояснения относительно
	определения параметров размерностей класса товара).

	\item[\dlgflag{При печати не сливать строки разных партий}]
	Узко специализированный флаг, обеспечивающий раздельный вывод
	на печать в первичных документах строк, относящихся к одному товару, но к разным лотам.

	\item[Кнопки управления перечисляемыми классификаторами]
	Четыре группы управляющих элементов, определяющих перечисляемые классификаторы
	товара:
	\begin{itemize}
		\item \dlgbutton{Виды}
		\item \dlgbutton{Классификатор}
		\item \dlgbutton{Сорта}
		\item \dlgbutton{Классификатор 2}
	\end{itemize}

	Каждая группа состоит из флага и кнопки.
	Если флаг установлен, то система считает, что соответствующий классификатор
	используется. При этом кнопка позволяет редактировать свойства классификатора.

	\item[Кнопки управления числовыми классификаторами]
	Четыре группы управляющих элементов, определяющих количественные характеристики товара:
	\begin{itemize}
		\item Размерность X
		\item Размерность Y
		\item Размерность Z
		\item Размерность W
	\end{itemize}

	Каждая группа состоит из флага и кнопки.
	Включенный флаг означает, что товары этого класса содержат соответствующий
	классификатор. Кнопка позволяет редактировать параметры классификатора.

	\item[\dlgbutton{Обобщение}]
	Эта кнопка предоставляет доступ к диалогу редактирования параметров динамического
	обобщения, соответствующего классу товаров.

	Динамические обобщения обсуждаются ниже (стр.~\pageref{sec-gengoods}).

	\item[\dlgbutton{Формулы}]
	При нажатии этой кнопки вы увидите диалог редактирования формул класса.
	Эти формулы используются для облегчения расчетов величин, связанных с товарами,
	относящимися к данному классу.

	Подробно формулы класса товаров будут рассмотрены ниже.
\end{description}

Формула для соотношения физических единиц к торговым, кроме чисел может содержать следующие псевдопеременные:
\begin{itemize}
	\item \ppysyntax{X} - Значение размерности X товара
	\item \ppysyntax{Y} - Значение размерности Y товара
	\item \ppysyntax{Z} - Значение размерности Z товара
	\item \ppysyntax{W} - Значение размерности W товара
	\item \ppysyntax{Pi} - Число $\pi$ (3.1415926..)
\end{itemize}

\ppyexampletitle{Пример формулы}{
Масса диска с наружным диаметром x, внутренним диаметром y и плотностью w:\\
pi*(x*x - y*y)*w/4000000000
}

В поле \qu{Формула для наименования товара} необходимо указать шаблон для имени товара, который будет
использоваться системой для автоматического формирования этого имени в зависимости от классификаторов
товара.

В шаблоне можно использовать следующие псевдопеременные:
\begin{itemize}
	\item \ppysyntax{@GCNAME} - Наименование класса товаров
	\item \ppysyntax{@GCKIND} - Видовое свойство товара
	\item \ppysyntax{@GCGRADE} - Сортовое свойство товара
	\item \ppysyntax{@GCADDPROP} - Дополнительное свойство товара
	\item \ppysyntax{@GCADD2PROP} - Второе дополнительное свойство товара
	\item \ppysyntax{@GCDIMX} - Размерность X товара
	\item \ppysyntax{@GCDIMY} - Размерность Y товара
	\item \ppysyntax{@GCDIMZ} - Размерность Z товара
	\item \ppysyntax{@GCDIMW} - Размерность W товара
	\item \ppysyntax{@GRNAME} - Наименование группы, которой принадлежит товар.
	\ppynote{
		Будьте внимательны. Если наименование группы очень длинное, то полное наименование,
		сформированное по шаблону, может не вместиться в поле наименования товара.
	}
	\item \ppysyntax{@BRAND}  - Наименование брэнда товара
\end{itemize}

\ppyexampletitle{Пример шаблона наименования}{
	ДСП ламинированная @gcdimxx@gcdimyx@gcdimz @gcgrade
}

\subsubsection{Диалог редактирования перечисляемого классификатора}

\ppypict{dlg-goodsclass-prop}{Диалог редактирования перечисляемого классификатора}

Этот диалог, как следует из его заглавия, предназначен для управления перечисляемым
классификатором товара. Его вид показан на рис.~\ref{pic-dlg-goodsclass-prop}, а следующая таблица описывает
управляющие элементы.

\begin{description}
	\item[Наименование]
	Наименование свойства. Здесь может быть введен любой текст, который будет
	высвечиваться в диалоге ввода соответствующего свойства товара.

	\item[\dlgcombo{Объект}]
	В этом комбо-боксе необходимо выбрать объект, содержащий перечисляемые
	значения выбранного свойства. Если в списке нет объекта, содержащего
	необходимые для этого свойства записи, то кнопка \dlgbutton{Создать новый объект}
	поможет вам создать новый объект, в который вы сможете добавить необходимые
	элементы перечисления.

	В том случае, если вы пытаетесь заменить один объект на другой, система
	проверит нет ли товаров, связанных с этим классом и просмотрит свойства
	таких товаров.

	По возможности, система попытается заменить ссылки на старый объект ссылками
	на новый (она делает это по совпадению наименований записей перечисления).
	Если системе не удастся заменить все старые ссылки автоматически, то она выдаст
	соответствующее предупреждение.

	\item[\dlgbutton{Просмотр объектов}]
	Нажав эту кнопку, вы сможете увидеть список записей, соответствующих объекту,
	выбранному в комбо-боксе \dlgcombo{Объект}.

	\item[\dlgbutton{Создать новый объект}]
	Нажав эту кнопку, вы сможете создать новый динамический объект данных,
	соответствующий редактируемому свойству класса товаров.
	\ppynote{
		Прежде чем создавать новый объект, убедитесь, что среди существующих типов объектов нет того,
		который вам нужен. Если вы будете, при создании каждого нового свойства класса товаров,
		создавать новый динамический объект, то в конце концов обнаружите, что в базе данных
		существует множество однотипных динамических объектов.
	}
\end{description}

\subsubsection{Диалог редактирования числового классификатора}

\ppypict{dlg-goodsclass-dim}{Диалог редактирования числового классификатора}

Представленный на рис.~\ref{pic-dlg-goodsclass-dim} диалог позволяет управлять числовым классификатором
(размерностью) товара, относящегося к заданному классу.

Таблица перечисляет элементы этого диалога.

\begin{description}
	\item[Наименование]
	Наименование свойства класса. Это наименование будет высвечиваться рядом с полем ввода
	значения свойства конкретного товара.

	Мы настоятельно рекомендуем после наименования указывать единицу измерения, в которых
	пользователь должен вводить значение. Эта мера значительно снизит количество ошибок ввода.

	\item[Точность]
	Так как числовые характеристики хранятся в базе данных в виде числа с фиксированной точкой,
	необходимо указать точность представления значений этого свойства. Точность указывается как
	количество значащих цифр после десятичной точки.

	Рекомендуется, указывать точность с запасом на одну единицу, так как изменение точности
	представления значений является крайне трудоемкой операцией. В указанном на рисунке диалоге
	реальная используемая точность равна одному (толщины изделий представлены числами с не более
	чем одним знаком после точки), однако, с учетом запаса, применено значение 2.

	\ppynote {
		С версии 8.7.10 система автоматически пересчитывает товары, относящиеся к классу, если вы изменили
		точность представления какого-либо числового классификатора. В связи с этим, предыдущий абзац для
		версии 8.7.10 или больше, не актуален.
	}

	\item[Значения]
	Если ряд значений, которые могут быть использованы для этого свойства, ограничен,
	то вы можете перечислить эти значения в этом поле. Это, во-первых, облегчит выбор значений
	пользователями, а, во-вторых, позволит (при желании) жестко ограничить вводимые величины
	приведенным здесь рядом.

	Значения вводятся через запятую, пробелы не существенны.
\end{description}

\section{Склады}

В системе \ppybrand{} склад определяется как место хранения товаров. Таким образом,
складом может быть магазин, производственный цех, собственно склад или даже контейнер.
Важно лишь то, что по этому месту хранения в системе ведется полный количественный учет.

Склады могут быть объединены в группы. При этом они являются объектом данных с
опциональной иерархией. То есть в отличии, скажем, от товаров, склад не обязан
принадлежать какой-либо группе. В то же время, один и тот же склад не может на
прямую принадлежать двум и более группам.

Любой товар, поступая на предприятие, попадает на один из складов.
Любая операция с товаром привязана к какому-либо складу.

\ppypict{WarehouseObjects}{Иерархия складских объектов}

\subsection{Места хранения}

Самым нижним уровнем иерархии в системе объектов данных \ppyrsrv{Склады} являются \ppyrsrv{Места хранения}.

Учетные товарные документы не взаимодействуют прямо с местами хранения, с другой стороны, товары могут быть ассоциированы
с местами хранения, что позволяет вести анализ в этом разрезе.

\subsection{Список складов}

\ppypict{dlg-130}{Склады}

Получить список складов можно при обращении к пункту меню \ppymenu{Справочники\rdir Товары\rdir Склады}.
Вид диалога для работы со списком складов приведен на рис.~\ref{pic-dlg-130}.

\subsubsection{Действия в списке складов}

Список складов содержит несколько кнопок, позволяющих осуществить ряд функций над выбранным в списке объектом.

Здесь мы опишем эти функции.

\begin{description}
	\item[\dlgbutton{Редакт\dots}]
	Открывает диалог редактирования выбранного склада. Этот диалог описан ниже (стр.~\pageref{sec-loc-edit}).

	Функция доступна только при наличии у пользователя права модификации по
	объекту \ppyrsrv{Склады}.

	\item[\dlgbutton{Добавить\dots}]
	Открывает диалог создания новой записи склада.

	Функция доступна только при наличии у пользователя права создания по
	объекту \ppyrsrv{Склады}.

	\item[\dlgbutton{Удалить}]
	Удаляет запись, соответствующую выбранному складу из базы данных.
	Перед удалением запрашивается подтверждение.

	Если с выбранным складом связаны документы или какие-либо иные
	объекты данных, то удаление записи невозможно (система выдаст сообщение
	об ошибке, информирующее об этом).

	Функция доступна только при наличии у пользователя права удаления по
	объекту \ppyrsrv{Склады}.

	\item[\dlgbutton{Места хранения\dots}]
	Открывает список просмотра и редактирования мест хранения, соответствующих
	выбранному складу. Диалог мест хранение ниже.

	\item[\dlgbutton{Товарные ассоциации\dots}]
	Открывает таблицу просмотра и редактирования ассоциаций товар-склад.
	Эти ассоциации используются для идентификации местоположения товара,
	например, при списании драфт-документов (для компенсации дефицита товара
	на каком-либо складе за счет другого), а так же в иных ситуациях.

	\item[\dlgbutton{Передать\dots}]
	Передает выборку складов в другой раздел базы данных.

	Подробно синхронизация данных рассмотрена в главе~\ref{ch-dbxchg}.

	\item[\dlgbutton{События\dots}]
	Открывает таблицу просмотра системных событий по выбранному складу.

	\item[\dlgbutton{Закрыть}]
	Закрывает диалог списка складов.
\end{description}

\subsection{Редактирование склада\label{sec-loc-edit}}

\ppypict{dlg-015}{Диалог редактирования склада}

Диалог редактирования склада выглядит так, как показано на рис.~\ref{pic-dlg-015}.
Он содержит следующие управляющие элементы

\begin{description}
	\item[Наименование]
	Наименование склада. Это наименование должно отличаться от наименований других складов.

	\item[ИД]
	Уникальный неизменяемый идентификатор склада.

	\item[Символ]
	Специальное уникальное внутри организации обозначение склада, позволяющее системе
	точно сопоставить соответствие складов при обмене данными.

	Это поле может быть пустым.

	\item[\dlgcombo{Группа}]
	Как уже упоминалось выше, склады имеют опциональную иерархическую структуру.

	В этом комбо-боксе вы можете выбрать группу, к которой относится данный склад
	либо группа (в этом случае вы получите увеличение вложенности иерархии складов).

	\item[\dlgcombo{Владелец}]
	Не используется.

	\item[\dlgcombo{Ответственное лицо}]
	Материально-ответственное лицо, отвечающее за этот склад.
	Это персоналия, относящаяся к зарезервированному виду \ppyrsrv{Персонал}.

	\item[\dlgflag{Освобожден от НДС}]
	Если это флаг установлен, то документы, относящиеся к этому складу,
	считаются не облагаемыми налогом на добавленную стоимость.

	\item[\dlgflag{Сравниваемый}]
	Этот флаг обычно используют розничные сети для отчетности.
	Флаг устанавливается на склады, относящиеся к магазинам,
	открытым не менее года назад.

	\item[\dlgflag{Выравнивать цену реализации внутренних приходов}]
	Флаг модифицирует схему установки учетной цены реализации на
	складе-получателе при межскладских перемещениях товаров.

	\item[\dlgflag{Автоматическое наименование для складских объектов}]
	Если данных флаг установлен, то при редактировании складского объекта (зона, колонна, ячейка),
	принадлежащего этому складу, программа будет автоматически формировать
	полное имя объекта исходя из кода самого объекта и кодов родительских
	объектов.

	Если вы работаете с местами хранения, то скорее всего, этот флаг
	следует устанавливать для складов, которые сегментируются на внутренние объекты.

	\item[\dlgflag{Префикс склада в кодах складских объектов}]
	Флаг предписывает системе при автоматическом формировании полных наименований
	складских объектов (зона, колонна, ячейка) добавлять к ним префикс символа
	данного склада.

	\item[\dlgflag{Сквозная нумерация складских колонн}]
	Этот флаг предписывает системе формировать коды складских колонн
	сквозной нумерацией в пределах данного склада (то есть, нумерация колонн
	не будет привязываться к зонам, которым они принадлежат).

	\item[Поле адреса]
	Справочное поле, отображающее адрес склада.

	\item[\dlgbutton{Адрес...}]
	Кнопка, вызывающая диалог редактирования адреса этого склада.

	\item[\dlgbutton{Регистры...}]
	Открывает диалог редактирования списка регистров данного склада.

	\ppynote{
		Аналогичная кнопка имеется в диалоге редактирования адреса, открываемом при нажатии на \dlgbutton{Адрес...}.
		И та и эта кнопки отображают и позволяют редактировать один и тот же список регистров, привязанных к данному
		складу. В данном диалоге эта кнопка введена для удобства.
	}

	\item[\dlgbutton{Теги...}]
	Открывает диалог редактирования списка тегов, привязанных к данному складу.

	\ppynote{
		Такая же кнопка есть в диалоге редактирования адреса, открываемом при нажатии на \dlgbutton{Адрес...}.
		Обе кнопки отображают и позволяют редактировать один и тот же список тегов, привязанных к складу.
		Здесь эта кнопка введена для удобства.
	}
\end{description}
\subsection{Товарные ассоциации}
	 тут подробное описание товарных ассоциаций на складе
\subsection{Места хранения}

	 Диалог мест хранения и товарные ассоциации, которые аналогичны тем, что на складе

\section{Сертификаты качества\label{sec-qcert}}

Сертификат являются документальным подтверждением качества товара, дающим право на его продажу.
Система позволяет вводить данные о сертификатах, связывая любое поступление товара с каким-либо
сертификатом. В дальнейшем можно просматривать и распечатывать введенные сертификаты, а также
распечатывать как приложение к товарным документам список сертификатов качества, соответствующий
товарам, включенным в документ.

Еще раз отметим, что сертификаты связываются не с товарами, а с лотами. То есть два прихода одного
и того же товара могут иметь разные сертификаты.

Для того чтобы получить список введенных сертификатов, следует выбрать пункт меню
\ppymenu{Справочники\rdir Товары\rdir Сертификаты}.

Если требуется, вы можете ввести в фильтре следующие условия выборки сертификатов:

\begin{itemize}
	\item Период срока действия
	\item Период, соответствующий датам выдачи документа
	\item Название выдававшего органа
	\item Признак сертификатов, товары по которым еще есть на остатках
\end{itemize}

Определив фильтр, нажмите \dlgbutton{OK}. При этом появится таблица просмотра, в которой можно
добавлять новые и редактировать существующие сертификаты. Здесь же по каждому из
сертификатов можно посмотреть лоты, с ним связанные.
Для этого, установив курсор на сертификат, следует нажать клавишу \keyb{F3}.

Ввод нового сертификата можно осуществить либо в описанной таблице, либо в любом диалоге,
содержащем комбо-бокс \dlgcombo{Сертификат}. Нажатие клавиши Insert на строке браузера или на
развернутом списке комбо-бокса приведет к открытию диалога, показанного на рис.~\ref{pic-dlg-qcert}.

\ppypict{dlg-qcert}{Диалог редактирования сертификата качества}

Перечислим вводимые параметры сертификата качества

\begin{description}
	\item[Номер]
	Номер сертификата, идентифицирующий его. Обычно номер сертификата уникален,
	однако, не всегда. По этому, система не контролирует уникальность введенного номера.
	Искать же сертификаты в списках выбора и таблицах следует именно по номеру.

	\item[Код бланка]
	Графа, присутствующая во всех российских сертификатах. Назначение кода нами не выяснено,
	и, видимо, не имеет какого-либо значения.

	\item[Внутренний номер]
	Номер сертификата по внутренней классификации организации. Это может быть, например,
	номер папки, в которой хранится оригинал сертификата.

	\item[\dlgcombo{Выдавший орган}]
	Организация, выдающая сертификат на товар. Персоналии, соответствующие выдающим
	сертификаты органам, ведутся в системе под видом \ppyrsrv{Регистрирующие органы}.

	\item[Товар]
	Текстовое поле, которое заполнять нет необходимости. Как мы уже говорили, сертификаты
	в системе \ppybrand{} привязываются к лотам, которые в свою очередь привязаны к товарам,
	а, следовательно, всегда известно к каким товарам относится тот или иной сертификат.
	Однако в этом поле полезно бывает написать текст, характеризующий товар или товары к
	которым относится сертификат для последующего контроля привязки.

	Например, если вы напишите в поле \qu{Товар} сертификата \qu{Мясные консервы}, то, обнаружив,
	что этот сертификат привязан к лоту прихода вина, своевременно распознаете проблемную
	ситуацию.

	\item[Изготовитель]
	Текстовое поле, в котором следует указать производителя товара. Этот текст должен
	соответствовать тому, что написано в бланке сертификата.

	\item[Дата изготовления]
	Текстовое поле, соответствующее такой же графе в бланке сертификата.

	\item[Дата выдачи]
	Поле, в котором указывается дата выдачи сертификата сертифицирующим органом
	дистрибьютору товара.

	\item[До]
	Поле, в котором указывается дата, после которой сертификат считается просроченным.
	Это очень важное поле. Система позволяет выбирать сертификаты по этой дате
	для выяснения сертификатов, товары по которым продавать больше нельзя.

	\item[Другое]
	Текстовое поле, в котором может быть введена дополнительная информация по
	сертификации товара.

	Например, номер ветеринарного свидетельства на животноводческую продукцию.

	\item[\dlgflag{Пассивный}]
	Сертификаты с таким признаком не высвечиваются в списке выбора сертификатов.
	Необходимость в такой опции появляется тогда, когда справочник сертификатов
	становится слишком большим, что значительно увеличивает время поиска нужного
	номера сертификата.
\end{description}

Устанавливать и изменять привязку сертификатов к лотам и сами сертификаты можно в диалоге
ввода строки приходного документа, а также в таблице лотов по клавише \keyb{F4}.

\subsection{Просмотр лотов, не имеющих сертификатов}

Немного забегая вперед, скажем, что существует возможность увидеть те лоты, для которых не
задана привязка к сертификату. Такая возможность бывает важна в тех случаях, когда вы обязаны
для каждого лота иметь соответствующий сертификат, но не уверены, что это так.

Выберите пункт меню \ppymenu{Отчетность\rdir Лоты}. В фильтре укажите критерии отбора лотов и
установите флаг \dlgflag{Без сертификатов}.

Подробно анализ лотов рассмотрен в разделе, посвященном товарной отчетности.

\section{Таблица справочника товаров\label{sec-ppview-goods}}

Для работы со справочником товаров используется таблица товаров,
доступная через пункт меню \ppymenu{Справочники\rdir Товары\rdir Товары}.
Как в случае большинства таблиц, появление таблицы товаров предваряет фильтр.

%topic(DLG_GOODSFLT)

\subsection{Фильтр справочника товаров\label{sec-filt-goods}}

\ppypictsc{dlg-f-016}{Фильтр по товарам}{0.5}

Диалог фильтра по товарам изображен на рис.~\ref{pic-dlg-f-016}. Это - достаточно обширный
и сложный диалог, содержащий множество кнопок, открывающих доступ к дополнительным опциям
фильтрации и просмотра списка товаров. Подробно многие из этих дополнений обсуждаются ниже.

В следующей таблице перечислены и описаны управляющие элементы фильтра по товарам.

\begin{description}
	\item[\dlgcombo{Группа}]
	В этом комбо-боксе вы можете выбрать группу, которой должны соответствовать
	показываемые в таблице товары. Система позволяет выбирать здесь как обыкновенные группы,
	так и альтернативные и группы верхнего уровня.

	Если необходимо отобрать товары по нескольким группам, то нажмите кнопку
	\dlgbutton{Список\dots} и выберите эти группы в списке.

	\item[\dlgcombo{Производитель}]
	Если здесь выбран производитель, то в таблице будут отображены только те товары,
	которые относятся к этому производителю.

	\item[\dlgcombo{Брэнд}]
	Вы можете выбрать товары, относящиеся только к определенному брэнду,
	если укажите его здесь.

	Справа от комбо-бокса расположена кнопка \dlgbutton{\dots},
	позволяющая выбрать список брэндов, по которому следует фильтровать выборку товаров.

	\item[\dlgcombo{Владелец брэнда}]
	Выбрав здесь персоналию-владельца брэнда, вы ограничите выборку
	товаров только теми, у которых установлен брэнд, чьим владельцем
	является указанный вами.

	Обращаем внимание на то, что этот критерий может вступить в конфликт
	с предыдущим (Брэнд). Так, если выбран фильтрующий брэнд $A$,
	чьим владельцем является $X$, а в качестве фильтрующего владельца
	брэнда выбран $Y$, то выборка окажется пустой.

	Справа от комбо-бокса расположена кнопка \dlgbutton{\dots},
	позволяющая выбрать список владельцев брэндов, по которому следует фильтровать выборку.

	\item[\dlgcombo{Страна происхождения}]
	Позволяет выбрать товары только по указанной стране происхождения.

	Страна происхождения товара определяется юридическим адресом производителя либо
	самим производителем, если он имеет статус \ppyrsrv{Государство}.

	\item[\dlgcombo{Торговая единица}]
	Выбрав здесь единицу измерения, вы заставите системы показать вам только те
	товары, торговая единица измерения которых соответствует заданной.

	Эта опция может быть полезна для отбора весовых товаров.
	В этом случае, в комбо-боксе, следует выбрать \qu{Килограмм}.

	\item[\dlgcombo{Физическая единица}]
	Аналогично предыдущему полю, но отбирает по физической единице измерения.

	\item[\dlgflag{Целочисленные единицы}]
	Если этот флаг включен, и торговая единица измерения не установлена, то будут
	отобраны только те товары, единица измерения которых имеет признак \dlgflag{Целочисленная}.

	\item[\dlgflag{Нецелочисленные единицы}]
	Этот флаг прямо противоположен предыдущему. При его установке, выбираются только
	те товары, единица измерения которых не имеет признака \dlgflag{Целочисленная}.

	\item[\dlgcombo{Тип товара}]
	При выборе здесь какого-либо типа товаров, система будет отбирать только те товары,
	у которых установлен именно этот тип.

	Обратим внимание на то, что при этом не учитывается наследование типа от группы.
	То есть, если группа, которой принадлежит товар, имеет такой тип,
	а сам товар - нет, то такой товар в выборку не попадет.

	\item[\dlgflag{Без типа товара}]
	При установке этого флага, будут выбраны только товары, не имеющие определенного типа.

	\item[\dlgcombo{Налоговая группа} и \dlgbutton{Ставка НДС}]
	Указав конкретную налоговую группу, вы предписываете системе выбирать только товары,
	имеющие такую же налоговую группу.

	Так же, как и в случае с типом товара, не учитывается наследование налоговой группы
	от товарной группе, к которой относится товар.

	Система предоставляет вам возможность выбрать товары с определенной ставкой
	НДС, независимо от того, какой налоговой группой эта ставка представлена.
	Для этого нажмите кнопку \dlgbutton{Ставка НДС} и в появившемся диалоге укажите значение искомой
	ставки НДС и, если необходимо, период в течении которого эта ставка действительна для
	отбираемых товаров.

	\item[\dlgflag{Без налоговой группы}]
	Установка этого флага приведет к тому, что в выборку товаров, соответствующую
	фильтру, попадут только те номенклатурные позиции, для которых не определена
	налоговая группа.

	Обратим внимание на то, что учитывается также наследование налоговых групп
	от родительской группы товара. То есть, если непосредственно для товара
	налоговая группа не задана, но у родительской группы этого товара установлена
	налоговая группа, то такой товар в выборку с установленным флагом не
	попадет.

	\item[Имя содержит строку]
	Здесь можно ввести строку, которую должны содержать наименования выбранных товаров.
	Поиск ведется без учета регистра. То есть, результат отбора по подстрокам
	\qu{ПИВО} и \qu{Пиво} будет одинаковым.

	Более сложные правила ввода этой строки описаны ниже.

	\item[Список штрихкодов]
	Критерий позволяет определить список штрихкодов или фрагментов штрихкодов, которые должны содержать товары,
	попавшие в выборку.

	Элементы списка отделяются друг от друга запятыми.

	Каждый элемент списка может быть либо полным штрикодом, либо префиксом, либо произвольной частью штрихкода.
	Префикс и полный штрихкод вводятся одинаково - набор символов, с которых начинаются штрихкоды товаров.
	Произвольный фрагмент штрихкода предваряется символом *.

	\ppyexample{
		460,0319,*7614

		В соответствии с показанной строкой будут отобраны товары, чьи штрихкоды начинаются с 460 или 0319, а так же
		те, чьи штрихкоды содержат подстроку 7614.
	}

	\item[Длины штрихкодов]
	В этом поле можно указать длины штрихкодов отбираемых товаров.

	Например \qu{7, 12}.

	Указав \qu{0}, вы найдете все товары, для которых нет штрихкода.

	\item[\dlgflag{Не показывать пассивные}]
	Флаг препятствует попаданию в выборку товаров с установленным признаком
	\dlgflag{Пассивный}.

	При инициализации фильтра этот флаг устанавливается автоматически.

	\item[\dlgflag{Только то, что ЕСТЬ в матрицах}]
	Если в базе данных определена товарная матрица, то включение этого флага
	приведет к тому, что в выборку попадут только те товары, которые принадлежат
	товарной матрице.

	\ppynote{
		Этот флаг тесно \qu{сотрудничает} с комбо-боксом \dlgcombo{Склад} в дополнительных
		опциях фильтра товаров (стр.~\pageref{f-goods-warehouse}).

		Если склад для фильтра не определен, то учитывается матрица \qu{для всех складов},
		в противном случае фильтруются товары, принадлежащие матрице выбранного склада.
	}

	\item[\dlgflag{Только то, чего НЕТ в матрицах}]
	Этот флаг - противоположность предыдущему. То есть, если данный флаг установлен,
	то в выборку попадут только те товары, которые не принадлежат товарной
	матрице по складу, определенному в дополнительных опциях фильтра.

	\item[\dlgflag{Только с картинками}]
	При установке этого флага в таблице будут отображаться только товары,
	к которым прикреплены изображения.

	\item[\dlgflag{Только с флагом 'Независимый учет в физических единицах'}]
	Если опция включена, то в выборку попадут только те товары, у которых установлен флаг
	\dlgflag{Независимый учет в физических единицах}.

	\item[\dlgflag{Товары, не соответствующие фильтру}]
	Установка этого признака повлечет за собой отрицание фильтра. То есть, будут отобраны
	только те товары, которые не соответствуют параметрам фильтрации.

	\item[\dlgcombo{Сортировка}]
	Комбо-бокс позволяет выбрать один из предопределенных порядков сортировки выборки:
	\begin{itemize}
		\item По наименованию
		\item По сокращению
		\item По группе и наименованию
		\item По группе и сокращению
		\item По штрихкоду
		\item По брэнду и наименованию
		\item По штрихкоду и наименованию
	\end{itemize}

	\item[\dlgbutton{Опции просмотра}]
	См. ниже.

	\item[\dlgbutton{Расширение}]
	Кнопка позволяет установить или изменить критерии фильтрации товаров по классификаторам.

	\item[\dlgbutton{Дополнительно\dots}]
	См. ниже.

	\item[\dlgbutton{События\dots}]
	Позволяет установить критерии отбора товаров в соответствии с системными
	событиями, происходившими с товарами.

	Подробно системные события и, в частности диалог, отображаемый по этой кнопке,
	описаны на стр.~\pageref{sec-sj}.

	\item[\dlgbutton{Теги\dots}]
	Эта кнопка открывает диалог редактирования критериев отбора товаров по тегам.

	Подробно о редактировании фильтров тегов рассказано на стр.~\pageref{sec-tagv-filt}.
\end{description}

\subsubsection{Расширенные правила ввода строки фильтрации наименований товаров}

Кроме простой подстроки поиска в поле \qu{Имя содержит строку} в диалоге фильтра
товаров, система может обработать дополнительные опции, расширяющие возможности отбора товаров:

\begin{itemize}
	\item Нечеткий поиск - поставив впереди строки знак восклицания (!)
	вы найдете все товары, наименования которых содержит почти такую же строку,
	как та, что вы ввели.

	Например, если вы введете здесь !БОНДЮЭЛЬ, то система найдет товары, содержащие
	строки \qu{БОНДЮЭЛЬ}, \qu{БОНДУЭЛЬ}, \qu{БОНДЮЭЛ} и т.д.

	В случае если в начале строки поиска должен быть знак восклицания, но это не
	должно означать нечеткого поиска, то символ следует продублировать (!!).

	\item Связка \symbol{124}\symbol{124} (ИЛИ) - если вы хотите выбрать товары, которые содержат одну из
	подстрок, то объедините эти подстроки союзом \symbol{124}\symbol{124}.

	Пример: Бондюэль\symbol{124}\symbol{124}Зеленый Великан

		В результате такого ввода будут найдены
		товары, наименование которых содержат либо \qu{Бондюэль} либо \qu{Зеленый Великан}.

	\item Связка \symbol{38}\symbol{38} (И) - если необходимо найти товары, имя которых одновременно содержит
	две и более подстрок, то соедините эти подстроки союзом \symbol{38}\symbol{38}.

	Пример: Dove\symbol{38}\symbol{38}мыло

		В результате такого ввода будут найдены
		товары, наименование которых содержат одновременно и \qu{Dove} и \qu{мыло}.
\end{itemize}

\ppynote{
	При использовании связок \symbol{38}\symbol{38} и \symbol{124}\symbol{124} важно помнить, что пробелы до и после связки
	являются значимыми.
}

\ppynote{
	Замечание для продвинутых пользователей
	При использовании нечеткого поиска вы можете регулировать величину ошибки сравнения.
	Ошибка сравнения измеряется числом от нуля до 100 (чем больше число, тем точнее
	результат сравнения. 100 - означает полное равенство, 0 - абсолютно не похожие строки).

	По умолчанию, сравнение использует порог 75. То есть, если величина ошибки меньше этого
	значения, то товар не попадет в выборку. Указав после восклицательного знака в круглых
	скобках минимальное значение ошибки, вы сможете изменить результаты поиска.

	Например \qu{!(60)БОНДЮЭЛЬ}.
}

%topic(DLG_GFLTADVOPT)

\subsubsection{Дополнительные опции фильтра справочника товаров}

\ppypict{dlg-f-goods-ext1}{Диалог дополнительных опций фильтра справочника товаров}

Диалог, в котором задаются дополнительные опции фильтра справочника товаров,
показан на рис.~\ref{pic-dlg-f-goods-ext1}. Далее перечисляются его управляющие элементы.

\begin{description}
	\item[Период поступления товаров]
	Если здесь введен период, то в таблице будут отображены только те товары,
	которые пришли на склад в течение указанного периода (см. ниже \dlgcombo{Склад}).

	\item[\dlgcombo{Поставщик}]
	Выбор поставщика в этом комбо-боксе позволяет выбрать только те товары,
	которые когда-либо приходили от него.

	\item[\dlgcombo{Склад}\label{f-goods-warehouse}]
	Этот комбо-бокс позволяет выбрать только те товары, которые поступали на
	указанный здесь склад.

	\item[\dlgflag{Товары, которых не было до периода поступления}]
	Если этот флажок включен, то система включит в выборку только те товары,
	которые никогда ранее периода, указанного выше, не поступали на выбранный склад.

	\item[\dlgflag{Плюс то, что на остатке}]
	Данный флаг связан с периодом поступления, описанным выше. Если флаг включен,
	то в дополнение к тем товарам, которые определяются периодом поступления,
	в выборку будут включены позиции, текущий остаток которых больше нуля (даже
	если даты лотов этих позиций не удовлетворяют критерию периода поступления).

	\item[\dlgflag{Только то, что на остатке}]
	Установка флага приведет к отбору только тех товаров, которые есть
	на текущем остатке на складе, указанного в комбо-боксе, описанном выше.

	Если склад не выбран, то будут показаны те товары, которые есть на
	текущем остатке хотя бы одного из складов, зарегистрированных в
	справочнике базы данных.

	\item[\dlgradioc{Фильтр по признаку товаров}]
	Позволяют определить дополнительную фильтрацию по флагам товаров.
	\begin{description}
		\item[\dlgradioi{Не использовать}]
		Данная фильтрация не применяется.

		\item[\dlgradioi{Только пассивные}]
		В выборку будут включены только те номенклатурные позиции,
		которые имеют флаг \dlgflag{Пассивный}. Обратите внимание на то,
		что эта опция может конфликтовать с признаком \dlgflag{Не показывать пассивные}
		в заголовочном диалоге фильтра товаров.

		\item[\dlgradioi{Только обобщенные}]
		Эта позиция переключателя приведет к тому, что в выборку попадут только
		обобщенные товары.

		\item[\dlgradioi{Только с ценой без налогов}]
		Ограничит выборку товарами, имеющими признак \dlgflag{Цена реализации без налогов}.

		\item[\dlgradioi{Только без скидки}]
		Ограничит выборку товарами, у которых установлен флаг \dlgflag{Без скидки}.

	\end{description}
\end{description}

%topic(DLG_GDSFVOPT)

\subsubsection{Опции просмотра фильтра по товарам}

\ppypict{dlg-f-goods-ext2}{Диалог опций просмотра товаров}

Диалог опций просмотра списка товаров (рис.~\ref{pic-dlg-f-goods-ext2}) позволяет
определить дополнительный правила отображения таблицы товаров.

\begin{description}
	\item[\dlgflag{Показывать штрихкоды}]
	Если этот флаг установлен, то в таблице будут показаны штрихкоды по каждому
	товару (если есть).

	При этом, если один товар имеет более одного штрихкода, то этому товару будет
	соответствовать количество строк в таблице, равное количеству кодов.

	\item[\dlgflag{Показывать грузовые параметры}]
	Установка этого флага приведет к появлению в таблице колонок, соответствующих
	грузовым параметрам товаров:
	\begin{itemize}
		\item Масса брутто одной упаковки поставки
		\item Габаритные размеры одной упаковки поставки
		\item Минимальный запас
		\item Емкость упаковки поставки
	\end{itemize}

	\item[\dlgflag{Показывать признак наличия структуры}]
	Установив этот флаг, вы предпишите системе показывать в таблице колонку описания структуры.
	Для обозначения категорий структур используются следующие мнемонические символы:
	\begin{description}
		\item[E] обозначает существование привязанной к товару структуры
		\item[C] структура допускает комплектацию
		\item[D] структура допускает разукомплектацию
		\item[P] частичная структура
		\item[S] подстановочная структура
		\item[G] структура подарка
		\item[F] составная структура. Строка признаков структуры будет содержать
		символы, характеризующие каждую из дочерних структур.
	\end{description}
	При этом товары, у которых нет структуры, отображаться не будут
	(если не установлен следующий флаг).

	\item[Показывать товары без структуры]
	Этот флаг можно установить только если установлен предыдущий флаг.
	При этом будут показаны товары, не имеющие никакой структуры.

	\item[\dlgflag{Показывать коды по статьям}]
	Этот флаг предписывает системе показывать артикулы товаров, связанные
	одновременно и с аналитическими статьями.

	\item[\dlgflag{Собственные артикулы}]
	Если этот флаг установлен, то будут показаны товары с артикулами,
	не связанными с конкретной статьей (так называемые, собственные артикулы).

	\item[\dlgcombo{Таблица статей}]
	Вспомогательный комбо-бокс, позволяющий определить таблицу статей, из которой
	вы хотите выбрать аналитическую статью для просмотра и редактирования артикулов
	ей соответствующих.

	\item[Статья]
	Статья, по которой будут показаны артикулы товаров.

	Заметим что выбор статьи для просмотра артикулов значительно
	облегчает установку новых артикулов по товарам для выбранного контрагента:
	для этого в таблице товаров реализована специальная команда.
\end{description}

%endtopic

\subsection{Действия в таблице справочника товаров}

	\paragraph{Редактировать}\indent\keyb{Enter}
	Редактирование выбранного товара

	\paragraph{Добавить}\indent\keyb{Insert}
	Открывает диалог создания новой записи товара.

	Если в фильтре, по которому получена выборка, установлена одна обыкновенная группа,
	то в диалоге инициализируются поля, соответствующие этой группе: сама группа,
	торговая единица измерения, физическая единица измерения.

	\paragraph{Добавить по образцу}\indent\keyb{Alt-F2}
	Создание записи о новом товаре на основании выбранного товара.
	Это - очень удобная опция для случаев, когда вам необходимо ввести
	несколько похожих товаров.

	\paragraph{Удалить}\indent\keyb{Delete}
	Удаление выбранного товара.
	\ppynote{
		Если товар уже оприходован или ссылка на него существует в каких-либо
		иных объектах, система не позволит вам его удалить.
	}

	\paragraph{Удаление всей выборки/перенос в другую группу}\indent\keyb{Ctrl-F8}
	Позволяет осуществить одну из следующих операций над всей выборкой товаров:
	\begin{itemize}
		\item Переместить всю выборку в какую-либо одну обыкновенную группу
		\item Массово изменить классификаторы
		\item Удалить всю выборку. Если в фильтре определена не
		динамическая альтернативная группа, то товары будут убраны только из нее,
		но не удалены полностью. В других случаях система попытается полностью
		удалить товары, принадлежащие выборке, если это возможно (ни какие иные
		объекты на эти товары не ссылаются).
	\end{itemize}

	Возможность осуществить эту операцию регламентируется флагом доступа
	\dlgflag{Массовое изменение товаров} в правах по объекту \ppyrsrv{Товары}. Кроме того,
	если вы не имеете права на удаление товаров, то и
	соответствующая функция будет не доступна.

	Более подробно эта функция описана ниже.

	\paragraph{Объединение товаров}\indent\keyb{Ctrl-U}
	Открывает диалог объединения текущего товара в таблице с каким-либо другим,
	который вы должны будете выбрать в этом диалоге.

	\paragraph{Положить в корзину}\indent\keyb{Ctrl-F4}
	Добавляет выбранный товар в корзину.

	\paragraph{Добавить из корзины}\indent\keyb{Ctrl-F5}
	Если в фильтре задана одна не динамическая альтернативная группа,
	то эта функция позволит привязать к ней все товары, содержащиеся в корзине,
	которую вы выберите в диалоге, появившемся при вызове этой функции.

	\paragraph{Просмотр лотов по текущему товару}\indent\keyb{F3}
	Показывает на экране таблицу лотов, соответствующих выбранному товару.

	\paragraph{Структура товара}\indent\keyb{F4}
	Быстрый просмотр и редактирование структуры выбранного товара. Использование
	этой функции позволяет ускорить работу по редактированию структуры товара
	(стандартный путь для выполнения этой работы: открыть диалог
	редактирования товара и нажать там кнопку [Структура…]).

	\paragraph{Дополнительные поля товара}\indent\keyb{F5}
	Быстрый просмотр и редактирование дополнительных полей товара.
	Стандартный путь для выполнения этой работы: открыть диалог редактирования товара
	и нажать там кнопку [Дополнительно…].

	\paragraph{Коды по статьям}\indent\keyb{F6}
	Вызывает диалог редактирования артикулов товаров, связанных со статьями
	аналитического учета (например, поставщиками, покупателями и т.д.).

	В этом диалоге также может быть установлен так называемый собственный
	артикул (код товара, не ассоциированный ни с какой статьей).

	Если опции фильтрации таблицы товаров заданы с условием показа
	кодов по конкретной статье, то вместо диалога списка кодов будет
	выведен диалог ввода (редактирования) артикула по заданной в фильтре
	статье. Этот трюк реализован для того, чтобы ускорить ввод артикулов
	по определенному поставщику или покупателю.

	\paragraph{Перенести коды на другую статью}\indent\keyb{Ctrl-F6}
	Функция доступна только в том случае, если в фильтре выбрана опция просмотра
	\dlgflag{Показывать коды по статьям} и выбрана статья, коды по которой следует
	показывать. Кроме того, для выполнения функции необходимо, чтобы пользователь
	имел право на массовое изменение товаров.

	При вызове функции система открывает диалог, в котором предлагает выбрать
	статью, на которую должны быть перенесены товарные коды по статье, указанной
	в фильтре. В результате выполнения действия все коды по статье из фильтра
	переместятся на статью, выбранную в диалоге.

	Важно обратить внимание на то, что при переносе перебираются товары не по всем
	критериям фильтрации текущей выборки. Применяется только фильтрация по единственной
	группе. То есть, если в фильтре не выбрана группа либо выбрано более одной группы,
	то будет осуществлен перенос кодов по всем товарам, имеющим код, связанный со статье,
	выбранной в фильтре.

	Если при переносе программа обнаружила наличие у принимающей статьи код, совпадающий
	с тем, что будет перенесен, то будет автоматически сгенерировано новое значение
	переносимого кода.

	\paragraph{Котировки}\indent\keyb{Ctrl-Q}
	Просмотр и редактирование котировок выбранного товара.

	\paragraph{Контрактные цены поставщика}\indent\keyb{Ctrl-W}
	Дает возможность просмотреть и редактировать контрактные цены на товар по поставщикам.

	\paragraph{Товарная матрица}\indent\keyb{Ctrl-M}
	Открывает диалог, в котором показана принадлежность выбранного товара
	товарной матрице.

	\paragraph{Членство в агрегациях}\indent\keyb{Ctrl-I}
	Выводит на экран диалог со списком агрегаций (обобщенных товаров, структур,
	альтернативных групп), в которые входит выбранный товар.

	Для не динамических альтернативных группы вы можете изменять номер, с которым товар
	входит в эту группу (это бывает нужно в случаях, когда альтернативная группа
	загружается на весы и вы хотите изменить номер PLU, с которым товар попадает на эти весы).

	\paragraph{Обобщение}\indent\keyb{F11}
	Просмотр элементов обобщенного товара. Работает только для товаров, у которых установлен
	признак \dlgflag{Обобщение}.

	\paragraph{Технологии}\indent\keyb{Ctrl-T}
	Показывает таблицу технологий, определенных для выбранного товара.

	\paragraph{Техн сессии}\indent\keyb{Ctrl-S}
	Показывает таблицу технологических сессий, в которых участвует выбранный товар.

	\paragraph{Печать списка}\indent\keyb{F7}
	Печать списка товаров.

	Стандартная форма отчета: \ppyrsrv{GoodsView}.

	\paragraph{Печать ценника}\indent\keyb{Ctrl-F7}
	Позволяет отпечатать специализированную форму ценника по выбранному товару.
	Система предусматривает две предустановленные формы ценников для этого случая:
	большой и маленький, что и предлагает выбрать при запуске этой функции.

	Стандартная форма отчета:
	\begin{description}
		\item[Малый ценник] \ppyrsrv{PLabelSmall}.
		\item[Большой ценник] \ppyrsrv{PLabelBig}.
	\end{description}

	\paragraph{Печать этикеток}\indent\keyb{Ctrl-L}
	Позволяет отпечатать товарную этикетку на принтере штрихкодов.
	Подробности см. на стр.~\pageref{sec-bcprinter}.

	\paragraph{Просмотр событий по товару}\indent\keyb{Ctrl-J}
	При выборе этой функции на экране появится таблица со списком системных событий
	по выбранному товару.

	\paragraph{Передать выборку товаров}\indent\keyb{Ctrl-H}
	Передача выборки товаров в другой раздел базы данных.
	Подробности смотрите в главе, посвященной разделению базы данных.

	\paragraph{Итог}\indent\keyb{F9}
	Показывает количество товаров в выборке.

	\paragraph{Замена наименований}\indent\keyb{Ctrl-F9}
	Служебная функция замены наименований товаров. Это бывает необходимо при
	реорганизации справочника товаров.

	Возможность вызова этого действия регламентируется флагом
	\dlgflag{Массовое изменение товаров} в правах доступа по объекту \ppyrsrv{Товар}.

	См. ниже

	\paragraph{Изменение флагов по выборке}\indent\keyb{Shift-F3}
	Позволяет установить или снять по всем товарам в выборке один из следующих признаков:
	\begin{itemize}
		\item \dlgflag{Без скидки}
		\item \dlgflag{Пассивный товар}
		\item \dlgflag{Цена реализации без налогов}
		\item \dlgflag{Требует сертификации}
	\end{itemize}

	Возможность вызова этого действия регламентируется флагом
	\dlgflag{Массовое изменение товаров} в правах доступа по объекту \ppyrsrv{Товар}.

	\paragraph{Проверка и восстановление товаров}\indent\keyb{Ctrl-R}

	\paragraph{Фильтр}\indent\keyb{Ctrl-V}
	Позволяет изменить фильтр просмотра товаров.

\subsubsection{Замена наименований}

Функция замены наименований позволяет произвести замену подстрок, содержащихся в наименованиях
или (и) сокращениях товаров, содержащихся в выборке. Предварительно на экране появляется диалог
с запросом строки поиска и строки замены, а также переключателя, в котором вы должны указать что
собственно, собираетесь обрабатывать: наименование, сокращения или и то и другое.
Если вы оставляете строку поиска пустой, то замена будет осуществлена по всей выборке.

В поле замены допускаются специальные символы для подстановки в измененную строку
наименования (сокращения):

\begin{description}
	\item[\ppysyntax{\#}] Подставляется найденный фрагмент. Если строка поиска пустая, то вместо
	этого символа будет подставлено полное наименование.
	\item[\ppysyntax{@grname}] Подставляется наименование группы товаров
	\item[\ppysyntax{@phpu}] Соотношение \qu{Физические единицы / Торговые единицы}
	\item[\ppysyntax{@gcname}] Наименование класса товаров
	\item[\ppysyntax{@gckind}] Наименование вида из расширения товара
	\item[\ppysyntax{@gcgrade}] Наименование сорта из расширения товара
	\item[\ppysyntax{@gcaddprop}] Наименование классификатора из расширения товара
	\item[\ppysyntax{@gcadd2prop}] Наименование дополнительного классификатора из расширения товара
	\item[\ppysyntax{@gcdimx}] Размерность X из расширения товара
	\item[\ppysyntax{@gcdimy}] Размерность Y из расширения товара
	\item[\ppysyntax{@gcdimz}] Размерность Z из расширения товара
	\item[\ppysyntax{@gcdimw}] Размерность W из расширения товара
\end{description}

\ppyexample{
	Найти \qu{СИМЕНС} Заменить \qu{Siemens}

	Найти \qu{} (пусто) Заменить \qu{@grname \#} - заменить наименование товара на тоже наименование,
	перед которым будет стоять название группы.
}

\subsubsection{Массовые изменения товаров}

\ppypict{dlg-088}{Диалог массового изменения товаров}

Система предоставляет сервис массового изменения некоторых параметров товаров либо
удаления всей выборки товаров.

Функция доступна только в том случае, если в правах пользователя по объекту \ppyrsrv{Товар}
установлен флаг \dlgflag{Массовое изменение товаров}.

Для того, чтобы воспользоваться этой функцией, в таблице товаров нажмите клавиши \keyb{Ctrl-F8}.
На экране появится диалог, показанный на рис.~\ref{pic-dlg-088}.

Вот описание управляющих элементов этого диалога.

\begin{description}
	\item[\dlgradioi{Переместить всю выборку в группу}]
	Все товары из выборки будут перемещены в обыкновенную группу,
	выбранную в комбо-боксе \dlgcombo{Группа}.

	\item[\dlgradioi{Изменить классификаторы товаров}]
	Опция позволяет изменить значения классификаторов товаров.

	В случае выбора этой функции следует нажать кнопку \dlgbutton{Классификаторы}
	для выбора класса и значений классификаторов, которые следует
	установить у товаров.

	\ppypictsc{dlg-087}{Диалог выбора классификаторов товара для изменения}{0.4}

	Диалог выбора классификаторов, которые следует изменить показан на рис.~\ref{pic-dlg-087}.
	В первую очередь, в этом диалоге следует выбрать товарный класс, которому должны
	соответствовать значения изменяемых классификаторов.

	После того, как класс будет выбран, появится возможность указать значения классификаторов,
	которые должны быть установлены у все товаров выборки, относящихся к указанному классу.

	Обращаем внимание на то, что изменены будут только те товары выборки,
	которые принадлежат выбранному классу.

	\item[\dlgradioi{Изменить налоговую группу выборки}]

	\item[\dlgradioi{Удалить всю выборку товаров}]
	Система попытается удалить все товары из выборки.
	Если в фильтре задана альтернативная группа, то товары будут просто
	отвязаны от этой группы, в противном случае будет предпринята попытка
	\qu{физически} удалить товары из базы данных.
	При этом, если с товаром связаны какие-либо иные объекты данных
	(товарные операции, товарные структуры и т.д.), то такой товар удален не будет.

	\item[\dlgradioi{Действия по флагам}]

	\item[\dlgradioi{Действия по правилу}]

	\item[\dlgradioi{Изменить минимальный остаток}]

	\item[\dlgradioi{Разбить товары с множественными штрихкодами}]

	\item[\dlgradioi{Объединить товары с \#-наименованиями}]

	\item[\dlgcombo{Группа}]
	Комбо-бокс выбора группы, в которую следует перенести все товары
	из выборки (если задано действие \dlgradioi{Переместить всю выборку в группу}).

	\item[Правило]

	\item[Блок флагов, сопутствующих варианту \dlgradioi{Действия по флагам}]

\end{description}

%topic(DLG_GOODS)

\section{Диалог ввода и редактирования товара}

\ppypict{dlg-goods}{Диалог редактирования товара}

Ввод нового товара осуществляется в диалоге ввода и редактирования товара.

Доступ к диалогу возможен несколькими способами. Во-первых, из таблицы \qu{Товары},
который открывается посредством фильтра по товарам, при обращении к разделу
\ppymenu{Справочники\rdir Товары\rdir Товары}.

В этом случае, находясь в таблице, следует нажать клавишу \keyb{Insert}. Указанный способ доступа к диалогу
хорош при первоначальном заполнении справочника товаров. Однако в ходе основной работы с документами,
так вводить новые товары становится неудобно - приходится прерывать работу, закрывать текущие диалоги,
а  затем, через некоторое время  их вновь открывать.

Новый товар можно ввести иначе: из любого доступного диалога, содержащего комбо-бокс \dlgcombo{Товар}.
Если нажать клавишу \keyb{Insert}, находясь на развернутом списке указанного комбо-бокса,
откроется диалог ввода и корректировки товара.

Внешний вид диалога показан на рис.~\ref{pic-dlg-goods}. Далее перечисляются его управляющие элементы.

\begin{description}
	\item[Наименование]
	Здесь вводится полное наименование товара. Это наименование должно быть уникальным,
	и, кроме того, его следует выбирать таким образом, чтобы максимально полно идентифицировать товар.
	Раздел \qu{Правила ввода наименований товаров} дает соответствующие рекомендации.

	\item[Сокращение]
	Сокращение позволяет указать текст, позволяющий идентифицировать товар в контексте
	товарной группы. Сокращенные наименования отображаются в списках выбора товаров.
	При переходе из поля \qu{Наименование} в поле \qu{Сокращение} табуляцией или мышью,
	если поле \qu{Сокращение} пустое, в него полностью копируется наименование.
	Таким образом, вам остается только подредактировать сокращение или оставить, как есть.

	\item[\dlgcombo{Группа}]
	Обыкновенная группа, которой принадлежит товар. Это поле обязательно должно быть заполнено.

	\item[\dlgcombo{Производитель}]
	Персоналия - производитель товара (относится к виду персоналий \ppyrsrv{Производители}).

	Если вы хотите задавать в качестве производителя товара государство, на территории которого
	товар произведен, то используйте персоналии со специальным статусом \ppyrsrv{Страна}.

	Если производителем является обычная персоналия (предприятие или физическое лицо),
	то система \qu{узнает} государство-производитель по юридическому адресу этой персоналии.

	\item[\dlgcombo{Брэнд}]
	Торговая марка товара. Выбор значения в этом комбо-боксе не обязателен с точки зрения
	функционирования системы. Целесообразность и правила его заполнения целиком
	определяется принятой на вашем предприятии политикой управления номенклатурой.

	\item[\dlgcombo{Торговая единица}]
	Торговая единица измерения товара. Как-то: штука, пачка, бутылка, кг и т.д.
	Этот параметр обязательный.

	\item[\dlgcombo{Физическая единица}]
	Если торговая единица измерения не является физической (килограммом, литром и т.д.),
	то вы можете указать физическую единицу, соответствующую товару и соотношение, означающее
	содержание физических единиц в торговой.

	Например, одна упаковка сыра Хохланд весит 0.400 кг. Тогда торговая единица этого сыра -
	штука, физическая - кг, соотношение - 0.400.

	Другой пример. Бутылка пива Хайнекен емкостью 0.65 литра. Здесь торговая единица - бутылка,
	физическая литр, соотношение - 0.65.

	\item[Соотношение физ ед / торг ед]
	Если для товара указана физическая единица, то это поле обязательно должно быть заполнено.

	\item[Штрихкод]
	Введите здесь цифровое обозначение штрихкода. Ввод списка штрихкодов, а так же
	автоматическое формирование кодов описано ниже (стр.~\pageref{sec-goods-edit-barcodelist}).

	\item[\dlgcombo{Тип товара}]
	Здесь, если необходимо, следует выбрать тип товара. Если это поле остается не заполненным,
	то тип товара наследуется из группы товара.

	\item[\dlgcombo{Налоговая группа}]
	Налоговая группа, как и тип товара, если не указана, то наследуется из группы товара.
	Это значит, что если в товаре вы оставляете это поле пустым, то соответствующее значение
	будет заимствовано из товарной группы. В случае, когда налоговая группа должна
	отличаться от той, что присвоена соответствующей группе, ее можно изменить, указав здесь.

	Под этим комбо-боксом выводится строка, информирующая о том, какая налоговая группа
	установлена в родительской группе товара.

	\item[\dlgcombo{Класс товара}]
	Класс, которому принадлежит товар. Подробно классы товаров были рассмотрены выше.

	\item[\dlgflag{Обобщенный}]
	Флаг \dlgflag{Обобщенный} устанавливается в состояние \qu{включен}, если вводимый товар
	объединяет под своим названием несколько однотипных товаров.

	Например, товар - \qu{Кетчуп Балтимор}, может обозначать \qu{Кетчуп Балтимор Пулковский},
	\qu{Кетчуп Балтимор Острый} и т.д.

	Этот признак может быть установлен только на вновь вводимый товар.
	Изменять его в существующем товаре нельзя.

	\item[\dlgflag{Без скидки}]
	Если этот признак установлен, то в товарных документах, при указании скидки в
	процентах на весь документ, на строки, содержащие такой товар, скидка распространяться не будет.
	Естественно, при этом общая сумма скидки в процентном отношении будет меньше той, что вы указали.

	\item[\dlgflag{Цена реализации без налогов}]
	Если этот флажок включен, то система считает, что на приходы этого товара цены реализации
	указаны без всех налогов (НДС, налога с продаж, акциза). Эта опция может быть полезна в редких
	случаях, при работе с подакцизными товарами.

	Внимание!
	Ни в коем случае не меняйте установку этого признака, если твердо не уверены в том, что вам
	это необходимо.

	Если на вашем предприятии вообще не следует использовать этот флаг, то установите признак
	\dlgflag{Запрет на установку флага 'Цена без налогов'} в конфигурации справочника товаров.

	\item[\dlgflag{Пассивный товар}]
	Если этот признак установлен, то этот товар не будет показываться в списках выбора товара.
	Обычно этот флаг применяют к товарам, который не планируется использовать сейчас и в будущем,
	но по которому были операции в прошлом.

	Обратим внимание на статус этого флага. Признак \dlgflag{пассивный} не является запрещающим.
	То есть, система не применяет жестких методов ограничения использования товара, имеющего
	этот флаг, но лишь не показывает его в списках выбора. При этом у пользователя остается возможность видеть
	такой товар в отчетах, выбирать его по штрихкоду, использовать его в корзинах и т.д.

	\item[\dlgflag{Независимый учет в физических единицах}]
	Этот признак позволяет организовать специализированный учет по товару таким образом,
	что операционное количество в товарных документах и технологических сессиях для такого
	товара вводится независимо в торговых и физических единицах.

	Примерами использования этого флага могут служить животные на выращивании - поголовье и
	масса животных не находятся в прямой зависимости друг от друга, по этому, приходится учитывать
	поголовье в \qu{головах} и живом весе.

	\item[\dlgbutton{Структура\dots}]
	Позволяет редактировать структуру товара.

	\item[\dlgbutton{Коды по статьям}]
	Вызывает диалог редактирования артикулов выбранного товара,
	связанных со статьями аналитического учета (например, поставщиками,
	покупателями и т.д.).

	В этом диалоге также может быть установлен так называемый собственный
	артикул (код товара, не ассоциированный ни с какой статьей).

	Если с редактируемым товаром связан собственный артикул, то он
	отображается под этой кнопкой.

	\item[\dlgbutton{Расширение}]
	Эта кнопка позволяет редактировать характеристики товара, определенные классом, к которому
	относится этот товар. Если товар не принадлежит ни какому классу, то эта кнопка заблокирована.

	\item[\dlgbutton{Агрегации}]
	Нажав эту кнопку, вы сможете увидеть к каким альтернативным группам, структурам и обобщениям
	принадлежит этот товар. Кроме того, в этом диалоге можно изменять принадлежность товара агрегациям.

	\item[\dlgbutton{Котировки...}]
	Информационная кнопка. Позволяет увидеть и (или) отредактировать котировки по товару.

	\item[\dlgbutton{Матрица...}]
	Информационная кнопка, открывающая диалог просмотра и редактирования товарной матрицы
	для этого товара.

	\item[\dlgbutton{Контрактн цены...}]
	Информационная кнопка, позволяющая увидеть и, возможно, изменить контрактные цены
	по поставщикам и складам для товара.

	\ppynote{
		Котировки, матрицу и контрактные цены можно просматривать только для существующего (не нового) товара.
		Кроме того, редактирование значений в открываемых по этим кнопкам диалогах осуществляется независимо от
		диалога товара. То есть, если вы изменили котировку, но в диалоге товара нажали \dlgbutton{Отмена}, то
		изменение котировки, в отличии от изменений товара, все равно сохранится.
	}

	\item[\dlgbutton{Теги}]
	Кнопка открывает диалог редактирования тегов товара.

	Список типов тегов, принадлежащих товарам, администрируется через пункт
	меню \ppymenu{Справочники\rdir Товары\rdir Теги товаров}.

	\item[Фотография]
	Вы можете прикрепить к товару фотографию. Для этого нажмите кнопку с изображением желтой папки,
	расположенную ниже области размещения фотографии. При этом система предложит вам выбрать файл изображения,
	который будет прикреплен к записи товара.

	После того, как вы прикрепили изображение к товару и нажали \dlgbutton{ОК}, оно будет сохранено в
	каталоге базы данных, то есть не будет зависеть от оригинального файла, который вы выбирали
	в качестве образца (оригинальный файл, естественно, остается там же где и был).

	Для того, того, чтобы прикрепить к товару изображение из буфера обмена, необходимо нажать
	третью кнопку под областью изображения товара.

	Кнопка с красным крестиком позволяет удалить связанное с товаром изображение.

	\item[Идентификатор товара]
	В правом нижнем углу диалога редактирования товара показывается внутренний идентификатор
	этого товара. Значение редактировать, естественно, нельзя. Оно приводится только для справки.

	\item[\dlgbutton{Дополнительно\dots}]
	Позволяет редактировать дополнительные характеристики товара.
\end{description}

\subsection{Дополнительные функции ввода штрихкодов товара\label{sec-goods-edit-barcodelist}}

Если на товаре установлено несколько штрихкодов, например, в ситуации, когда собственно
товар имеет один штрихкод, а упаковка товаров другой, используется кнопка \dlgbutton{*}
справа от поля \qu{штрихкод} в диалоге редактирования товара.
Ее нажатие приведет к открытию списка штрихкодов. Строка списка состоит из цифрового
обозначения штрихкода и числа, характеризующего емкость упаковки в торговых единицах.

Ввести новый штрихкод можно при помощи клавиши \keyb{Insert}.

Система автоматически проверяет уникальность введенных штрихкодов. Это значит, что если
вы попытаетесь присвоить товару штрихкод, который ранее был определен для другого товара,
то получите сообщение об ошибке. С этим моментом связана одна трудность: система воспринимает
штрихкоды как символьные строки, поэтому два почти одинаковых кода, один из которых
отличается от другого лишь ведущими нулями, система воспринимает как различающиеся.
При этом кассовые терминалы, в которые экспортируются данные, могут воспринять их как одинаковые.
Для решения этой проблемы можно использовать опцию в конфигурации справочника товаров, о чем
будет рассказано ниже.

На случай, когда товар не имеет заводского штрихкода, система предусматривает возможность
автоматического формирования уникального штрихкода. Для этого, находясь в поле \qu{Штрихкод},
следует нажать клавишу \keyb{F2}. При этом на экране появится список, предлагающий выбрать один
из заданных в настройках типов внутренней кодировки.
Выберите из списка тот тип, который необходим, и нажмите \keyb{Enter}: поле будет заполнено
новым штрихкодом.

Настройка типов внутренней кодировки описана в секции \qu{Структура штрихкода} (стр.~\pageref{sec-barcodestruc}).

%topic(DLG_GOODSVAD)

\subsection{Диалог редактирования дополнительных параметров товара\label{sec-goodsvad}}

\ppypictsc{dlg-goodsvad}{Диалог редактирования дополнительных параметров товара}{0.5}

Вид этого диалога показан на рис.~\ref{pic-dlg-goodsvad}. Далее мы перечислим управляющие
элементы этого диалога.

\begin{description}
	\item[Дополнительные поля описания товара]
	Текстовые строки (до 127 символов каждая), содержащие описательные характеристики товара.
	Эти характеристики могут быть распечатаны на товарной этикетке либо использованы в прайс-листе.

	\begin{itemize}
		\item Условия хранения и срок годности (параметр A)
		\item Стандарт (параметр B)
		\item Состав (параметр C)
		\item Энергетическая ценность (параметр D)
		\item Способ использования (приготовления) (параметр E)
	\end{itemize}

	Приведенные здесь заголовки полей могут быть переопределены в конфигурации справочника товаров.

	Вы видите на рисунке пример переопределенных заголовков для полей A и B.

	\item[Наименование для печати ценников]
	Если здесь введена строка, то она будет подставляться вместо
	наименования товара при печати ценника.

	Для облегчения ввода этого поля можно использовать клавишу \keyb{F2}.
	При нажатии этой клавиши, когда поле является текущим и пустым, в него копируется наименование товара.

	\item[Емкость упаковки поставки]
	Количество торговых единиц, содержащихся в одной упаковке (поддоне),
	используемой при оптовых поставках товара.

	\item[Масса брутто одной упаковки поставки]
	Масса в килограммах одной упаковки (поддона). Если емкость упаковки не указана, то система считает,
	что это поле определяет массу брутто одной торговой единицы.

	\item[Габариты упаковки поставки]
	Ширина, длина и высота одной упаковки (поддона) в миллиметрах. Если габаритные размеры заданы,
	система может посчитать общий объем накладной.

	\item[Параметры упаковки на паллете]
	Три параметра, определяющих укладку товара на паллете. Емкость слоя и количество слоев дифференцируются в
	зависимости от типа паллета. То есть, для нескольких разных типов паллетов вы можете указать различные
	параметры упаковки.
	\begin{description}
		\item[\dlgcombo{Тип паллета}]
		Тип паллета.

		\item[Емкость слоя паллета]
		Количество торговых единиц товара, умещающихся на одном слое паллета.

		\item[Количество слоев на паллете]
		Максимальное количество слоев, в которое можно уложить товар на данном типе паллета.
	\end{description}

	\item[Срок годности, дней]
	Параметр определяет срок годности по умолчанию. На текущий момент этот параметр
	используется для загрузки информации о товаре на весы.

	\item[Мин количество для отгрузки]

	\item[\dlgflag{Кратность}]

	\item[Список минимальных остатков товара]
	Этот список позволяет определить дифференцированные по складам значения минимального
	запаса товара.

	Величина, заданная в строке \qu{Все склады}, применяется для тех складов, для которых
	нет явно определенного значения. То есть, если вы хотите задать минимальный запас,
	который распространялся бы на любой из складов, то указывайте его в этой строке.

	Если же для какого-либо склада будет явно указан минимальный запас, то для этого
	склада будет применяться оно.

\end{description}

%endtopic

\section{Инструменты для подбора товаров}

Учитывая то, что при работе с системой приходится часто выбирать товар, а так же
то, что в базе данных может содержаться значительное количество записей товаров,
из которых надо выбирать, в \ppybrand() для этого предусмотрен ряд специализированных
средств.

Здесь мы рассмотрим инструменты подбора товаров и особенности работы с ними.

\subsection{Стандартный метод выбора товара в диалогах}

\ppypict{dlg-goodssel-std}{Элемент диалога для выбора товара}

Стандартным средством выбора товара в диалогах является пара полей (рис.~\ref{pic-dlg-goodssel-std})
для выбора группы и товара. В зависимости от назначения конкретного диалога
поведение этой пары может несколько различаться, а также сопровождаться дополнительными
управляющими элементами.

Вот характерные особенности стандартного инструмента выбора товара:

\begin{itemize}
	\item Выбор группы в верхнем комбо-боксе ограничивает список
	выбора товара в нижнем комбо-боксе этой группой.

	\item Если группа не выбрана, то в списке товаров отображаются все
	товары, доступные в справочнике (с некоторыми нюансами, описанными ниже).

	\item В обоих комбо-боксах доступна функция подбора товара по штрихкоду
	(описан ниже). При вводе существующего кода, в нижнем комбо-боксе
	отобразится наименование найденного товара, а в верхнем - наименование
	обыкновенной товарной группы, которой принадлежит этот товар.

	\item Если в конфигурации справочника товаров установлен флаг
	\dlgflag{Не показывать пассивные товары в списках}, то в списке выбора
	товара не будут отображаться те элементы справочника, которые имеют
	признак \dlgflag{Пассивный}.

	\item Список выбора товаров может быть ограничен только теми записями,
	которые есть на текущем учетном остатке. Для примера, такое ограничение
	действует при вводе строки расхода товара в товарном документе.

	Указанное ограничение действует следующим образом: система показывает
	только те товарные позиции, для которых в специализированной таблице
	текущих товарных остатков есть запись с положительным значением
	остатка по \emph{заданному складу}.

	Обращаем внимание на два следующих важных момента:
	\begin{itemize}
		\item В рассмотрение принимается именно текущий остаток. То есть,
		скажем, вводя документ задним числом, вы можете увидеть позицию,
		но система не разрешит вам провести транзакцию с товаром из-за того,
		что на дату документа товар был не доступен.
		\item Под \emph{заданным складом} подразумевается склад, определяемый
		системой из контекста текущего действия пользователя. Так для документа,
		это, как правило, склад, к которому относится документа. В кассовых
		сессиях - склад, которому принадлежит кассовый узел. И т.д. Если
		нет возможности из контекста определить склад, то система
		использует текущий.
	\end{itemize}

	\item Список выбора товаров может быть ограничен товарной матрицей.
\end{itemize}

\subsection{Выбор товара по коду}

\ppypict{dlg-goodssel-code}{Диалог ввода кода товара}

При нажатии клавиши \keyb{F2} в (нераскрытом) комбо-боксе товара
либо в списке расширенного диалога выбора товара появляется небольшой
диалог (рис.~\ref{pic-dlg-goodssel-code}) поиска товара по штрихкоду.

Этот диалог предоставляет следующие возможности:

\begin{description}
	\item[Простой выбор по штрихкоду]
	Просто введите искомый штрихкод и нажмите \keyb{Enter} (или \dlgbutton{OK}).

	\item[Выбор по коду товара, сопоставленному с аналитической статьей]
	Если выбор товара происходит в контексте, связанном с аналитической статьей
	(например, в строках товарного документа), то, не найдя товар по введенному
	штрихкоду, система пытается найти код товара, сопоставленный со статьей.

	Допустим, вы создаете или редактируете документ прихода товара от
	поставщика. Если вы примените поиск по штрихкоду в строках этого документа
	и в поле ввода кода укажете код товара, соответствующий поставщику, определенному
	в заголовке документа, то система найдет (если он есть) товар по этому коду.

	\item[Множественный выбор по штрихкоду]
	Введите символ * и вслед за ним часть штрихкода (например, *4601212).
	Если в базе данных есть хотя бы один код, содержащий введенную после
	звездочки последовательность (не обязательно с начала кода),
	то на экране отобразится список товаров, чьи штрихкоды подходят
	под заданное требование.

	\item[Выбор по идентификатору товара]
	Для выбора товара по идентификатору следует в поле ввода диалога набрать
	символ \# и вслед за ним значение идентификатора (например, \#73298) и
	нажать \keyb{Enter} (или \dlgbutton{OK}).
\end{description}

Поведение программы в случае, если заданный в этом диалоге код не найден,
зависит от окружения, в котором применяется данная функция.

\subsection{Выбор товара по строке, содержащейся в наименовании}

В строках товарных документов, а также в кассовой панели
допускается подбор товаров по строке, содержащейся в наименовании.

В документах для этого следует использовать клавишу \keyb{F4}, а
в кассовй панели ввести строку в поле ввода данных и нажать \keyb{F2}.

\ppynote{
	Если справочник товаров в вашей базе содержит значительное количество
	номенклатурных единиц (более 50000), то такой поиск может занять
	продолжительное время и, кроме того, сильно нагрузит сервер базы данных.

	Решением этой проблемы может быть использование серверного компонента
	системы \ppybrand{}, который значительно оптимизирует операцию поиска
	товаров по подстроке.
}

\subsection{Расширенный диалог выбора товара}

\ppypict{dlg-goodssel-ext}{Расширенный диалог выбора товара}

Из-за того, что к функции подбора товара предъявляются исключительно высокие
требования в плане производительности сотрудников предприятия, стандартный метод
выбора товара не может удовлетворить потребности пользователей.

С целью оптимизации работы система предоставляет так называемый расширенный диалог
выбора товара (рис.~\ref{pic-dlg-goodssel-ext}).

\subsubsection{Общий принцип использования диалога}

Расширенный диалог выбора товаров используется следующим образом:

\subsubsection{Описание диалога}

Диалог содержит следующие управляющие элементы:

\begin{description}
	\item[Список товаров]
	Основная часть диалога. Здесь отображаются товары, доступные для выбора.

	\item[\dlgcombo{Бренд}]
	Этот комбо-бокс видим только в том случае, если в конфигурации справочника
	товаров установлен флаг \dlgflag{В расширенном диалоге ввода использовать бренд}.

	При выборе здесь какой-либо торговой марки список товаров будет ограничен
	только теми, которые относятся к ней.

	\item[\dlgcombo{Группа}]
	В этом комбо-боксе можно выбрать группу, ограничивающую список товаров.

	Если выбраны и группа и бренд, то список товаров будет ограничен обоими
	критериями, что часто приводит к пустой выборке.

	\item[Количество]
	Если диалог применяется в контексте товарных документов, товарных корзин
	или в ином, предполагающем ввод количества, то в этом поле можно
	указать значение, которое будет устанавливаться при каждом выборе товара.

	\item[\dlgflag{Упаковок}]
	Этот флаг используется в связке с полем \qu{Количество}. Если флаг установлен,
	то система интерпретирует величину в поле количества как число упаковок
	выбранного товара. Если для выбранного товара емкость упаковки не определена,
	то флаг игнорируется.

	\item[\dlgbutton{Серийный номер}]
\end{description}

\section{Рекомендуемые правила формирования наименований товаров}

Общий формат наименований товаров можно представить следующим образом:
\newline\ppysyntax{[Вид товара] [Торговая марка] [Модификация] [Числовые характеристики] [Емкость упаковки|Вес упаковки]}

Здесь:
\begin{description}
	\item[Вид товара] обобщенное определение товара. Например: сигареты, сок, дрель, линолеум.
	\item[Торговая марка] имя, определяющее брэнд, торговую марку, производителя или что-либо
	иное, идентифицирующее происхождение товара. Например: сигареты мальборо, сок J7,
	дрель блэк-энд-декер, линолеум N-ский линолеумный завод. Если товар не имеет явно выраженного
	брэнда, то следует использовать краткое или полное наименование производителя или
	наименование города, где произведен продукт и т.д.

	Следите за тем, чтобы не вводились наименования товаров без торговой марки, поскольку в этом
	случае значительно усложняется идентификация товаров по наименованиям, что влечет за собой
	проблему путаницы и пересортицы товаров на складе, а так же ошибки в сборе отгрузочных накладных.
	\item[Модификация] дополнительная характеристика товара, идентифицирующая его внутри одного
	брэнда. Например: сигареты мальборо лайтс, сок J7 яблоко, дрель блэк-энд-декер аккумуляторная,
	линолеум N-ский линолеумный завод утепленный. Модификация может включать в себя несколько
	дополнительных определений, в том числе алфавитно-цифровую маркировку продукта производителя.
	\item[Числовые характеристики] необходимы, если продуктовый ряд в брэнде нуждается в
	дополнительной числовой идентификации. Например, крепость алкогольного напитка, мощность дрели,
	плотность линолеума и т.д.
	\item[Емкость или вес упаковки] характеристика, необходимая для продуктов питания,
	бытовой химии и многих других категорий товаров.

	Например: сок J7 яблоко 1.0, водка гжелка 40\% 0.500, бальзам после бритья FLORENA ромашка 0.100.

	Для весового товара вместо числа следует вводить сокращение \qu{ВЕС} в конце наименования.
\end{description}

При формировании товаров придерживайтесь следующий правил:

\begin{itemize}
	\item Крайне важно придерживаться одной системы при вводе наименований товаров. Так, например,
	разделитель десятичных разрядов во всех наименованиях должен быть либо точкой, либо запятой,
	но ни в коем случае не смесь, то есть, не должна встречаться ситуация, когда у одного товара
	десятичный разделитель это точка, у другого - запятая.
	\item Обязательно определитесь с регистром букв, в котором вы заводите наименования товаров.
	Здесь может быть несколько вариантов:
	\begin{enumerate}
		\item Все буквы прописные (СОК J7 ЯБЛОКО 1.0)
		\item Все буквы строчные (сок j7 яблоко 1.0)
		\item Первая буква в наименовании прописная, остальные строчные (Сок j7 яблоко 1.0)
	\end{enumerate}

	Варианты, когда все буквы в одном регистре предпочтительней, поскольку это увеличивает
	производительность операторов, занимающихся вводом наименований товаров.
	\item Определитесь с написанием иностранных слов (чаще всего это наименование брэндов).
	Если вы будете писать их латинскими буквами, то наименования будут выглядеть привлекательней,
	однако при этом значительно снижается производительность операторов и увеличивается вероятность
	ошибки. Русскую транскрипцию иностранных наименований вводить проще, но при этом могут
	возникнуть трудности в идентификации товаров вашими покупателями по накладным.
	\item Не желательно применять сокращения в виде товара и торговой марке. В случае
	использования сокращений, они должны быть максимально унифицированы.
	Например \qu{бальзам п/бритья} означает \qu{бальзам после бритья} и никакие другие
	сокращения для этого использоваться не должны.
	\item Не следует менять местами различные компоненты наименования товара. Скажем,
	наличие в справочнике товаров двух следующих наименований недопустимо:
	\newline\qu{сок J7 яблоко 1.0}
	\newline\qu{J7 сок апельсин 1.0}
\end{itemize}

\ppyexampletitle{В завершении, приведем примеры наименований товаров}{
	\newline ЧАЙ АХМАД АНГЛИЙСКИЙ №1 0.100
	\newline ЧАЙ АХМАД ЗЕЛЕНЫЙ С ЖАСМИНОМ 0.100
	\newline СЫР ГАУДА УКР 1С ВЕС
	\newline СОСИСКИ ЧЕРКИЗ МОЛОЧНЫЕ ВС ВЕС
	\newline КОЛБАСА ПМК ДОКТОРСКАЯ ВС ВЕС
	\newline ДЕЗОДОРАНТ ФЛОРЕНА МУЖ СПРЕЙ 0.150
	\newline ГЕЛЬ ДЛЯ ДУША ХЕРБИНА СЕНСИТИВ 0.400
	\newline ДРЕЛЬ БОШ АККУМ GSR 0601916588
}

\section{Обобщенные товары\label{sec-gengoods}}

Обобщенные товары позволяют организовать дополнительный уровень классификации товаров.
Как правило, обобщенный товар объединяет относительно небольшое количество номенклатурных позиций,
схожих по большинству признаков.

\ppyexample{
	Обобщенный товар \qu{Горошек зеленый консервированный} объединяет все, имеющиеся в справочнике
	наименования, подходящие под это определение, скажем, \qu{ГОРОШЕК ЗЕЛЕНЫЙ АЛАДДИН С/Б 0,680},
	\qu{ГОРОШЕК ЗЕЛЕНЫЙ ВЕНГЕРСКИЙ ГУСАР 0,550} и т.д.
}

Система предоставляет следующие возможности использования обобщенных товаров:
\begin{itemize}
	\item Группировка товарных отчетов, позволяющая избежать излишней детализации
	\item Использование одной структуры, привязанной к обобщенному товару, для всего
	семейства товаров, входящих в это обобщение
	\item Формирование производственных планов: в производственном плане вместо
	подробного перечисления товарных позиций (которых, кстати, может еще не быть в
	справочнике) можно указать обобщение. Соответственно, система будет рассчитывать
	выполнение производственного плана по обобщению.
	\item Подстановка вместо дефицитного товара любого другого товара, принадлежащего
	обобщению, при списании драфт-документов, кассовых и технологических сессий.
\end{itemize}

\ppynote{
	Начиная с версии 5.0.0, для этой цели следует использовать  подстановочные структуры
	товаров, поскольку подстановочные структуры предоставляют большую управляемость замещения.
}

Важным свойством товарных обобщений является то, что один товар не может входить более
чем в одно обобщение. Это гарантирует непротиворечивость приведенных выше применений
обобщений.

Система не допускает никаких учетных операций с обобщенными товарами.

\paragraph{Синхронизация обобщенных товаров}

Обобщенные товары, как и обычные, могут быть переданы из одного раздела базы данных
в другой. Важная особенность состоит в том, что между разделами не
передается информация о принадлежности обыкновенных товаров обобщенным. Обоснованием
для такого поведения системы является частая необходимость иметь разное содержание
одного и того же обобщения в различных разделах.

\subsection{Статические и динамические обобщения товаров}

В зависимости от того, как система определяет принадлежность того или иного товара обобщению,
обобщения делятся на статические и динамические.

\paragraph{Статическое обобщение}
предполагает наличие жесткой связки от обычного товара к обобщению, которая устанавливается вручную
пользователем.

\paragraph{Динамическое обобщение}
предполагает неявную привязку обычного товара к обобщению, основанную на параметрах товара.
Динамическое обобщение доступно только для товаров, принадлежащих одному классу. При этом
для класса должна быть определена маска параметров, согласно которой система определяет,
что несколько товаров, у которых параметры, соответствующие маске эквиваленты, принадлежат
обобщению, которое относится к тому же классу, и имеет те же значения параметров по маске.

Ограничения спецификации для статических и динамических обобщений инвариантны.
То есть, с точки зрения поведения товара, принадлежащего обобщению, система не делает различий
между статическим и динамическим обобщением. Если, скажем, некоторый товар принадлежит
статическому обобщению X, то система не будет пытаться рассматривать его как члена динамического
обобщения Y. И наоборот, если товар принадлежит динамическому обобщению Y, система не допустить,
чтобы пользователь создал статическую привязку этого товара обобщению X.

\subsection{Создание обобщенного товара}

Обобщенный товар может быть создан точно также как и любой другой, но у него, при создании,
необходимо установить признак \dlgflag{Обобщенный}.

Изменять признак \dlgflag{Обобщенный} у уже существующего товара нельзя.

\ppynote{
	Из последнего правила есть одно исключение. В ранних версиях системы содержалась ошибка,
	позволяющая оприходовать обобщенный товар. Для исправления этой ситуации, пользователю
	MASTER система позволяет снять признак \dlgflag{Обобщенный} для товара, к которому привязан
	хотя бы один лот.
}

Для установки флага \dlgflag{Обобщенный} у товара, принадлежащего классу, который предполагает
сокращенный диалог товара, в сокращенном диалоге нажмите кнопку \dlgbutton{Полный диалог товара}.

\subsection{Выборка обобщенных товаров по фильтру}

Если вы хотите увидеть все обобщенные товары, определенные в вашей базе данных, то в фильтре по
товарам (меню \ppymenu{Справочники\rdir Товары\rdir Товары}) нажмите кнопку \dlgbutton{Дополнительно}
и в появившемся диалоге установите переключатель \dlgradioc{Фильтр по признаку товара} в положение
\dlgradioi{Только обобщенные}. При этом все остальные критерии фильтрации учитываются.

\subsection{Просмотр товаров, принадлежащих обобщению}

Для работы со списком товаров, включенных в обобщение, в таблице на выбранном обобщенном
товаре нажмите \keyb{F11} (контекстное меню \ppymenu{Обобщение}).
В ответ на это откроется новая таблица, содержащая позиции, принадлежащие
обобщенному товару.

\subsection{Статическая привязка товара к обобщению}

Для привязки какой-либо товарной позиции к обобщению, в таблице
товаров, принадлежащих обобщению (см.выше) следует выбрать
функцию контекстного меню \ppymenu{Добавить} (\keyb{Insert}). На экране
появится список товаров, из которого вы можете выбрать те, которые
должны войти в обобщение.

Кроме единичной вставки товаров в обобщение существует возможность добавить все товары
из корзины. Для этого выберите функцию контекстного меню \ppymenu{Добавить из корзины}
(\keyb{Ctrl-F5}).

\section{Структура товара\label{sec-goodsstruc}}

Товарные структуры предоставляют мощные механизмы управления взаимосвязью
между различными товарами. Основными сферами применения товарных структур являются:
\begin{itemize}
	\item Учет производства продукции и расчет потребности в материалах
	\item Модификация (сборка и разборка) товаров при продаже
	\item Управление компенсацией учетного дефицита каких-либо товаров
	при производстве и розничной продаже
	\item Облегчение процесса выписки документов, содержащий товары,
	к которым неявно прилагаются какие-либо иные товары (частичные структуры).
	\item Организация маркетинговых акций, состоящих в выдаче покупателям подарков
	за приобретение некоторой комбинации товаров.
\end{itemize}

Для просмотра и редактирования структуры составного товара предназначена кнопка
\dlgbutton{Структура} в диалоге ввода или редактирования товара, либо клавиша \keyb{F4}
в таблице товаров.

\subsection{Виды товарных структур}

Товарная структура является общей технологией, реализующей поддержку множеству
функций системы. Для классификации функционального назначения структуры
определяется понятия вида структуры. Одна структура может принадлежать только
одному виду. При этом, благодаря множественным структурам, товар может иметь
несколько структур, относящимся к различным видам.

Существуют следующие виды товарных структур:

\begin{description}
	\item[Структура комплектации/декомплектации]
	Определяет компоненты, из которых состоит товар, либо на которые
	он может быть разложен.

	\item[Частичная]
	Определяет дополняющие компоненты товара.

	\item[Подстановочная]
	Определят набор товаров, которыми может быть замещен
	товар-владелец структуры. Например, при компенсации
	дефицита товара.

	\item[Подарочная]
	Определяет список товаров, продажа которых в заданном
	соотношении приводит к предоставлению подарка покупателю.

	\item[Комплекс]
	Определяет список товаров, составляющих комплексно
	продаваемое номенклатурное наименование.

\end{description}

%topic{DLG_GSTRUC}

\subsection{Диалог структуры товара}

\ppypictsc{dlg-goodsstruc}{Диалог редактирования товарной структуры}{0.5}

Диалог (рис.\ref{pic-dlg-goodsstruc}) состоит из следующих управляющих элементов:

\begin{description}
	\item[Наименование структуры]
	Для именованной структуры здесь отображается наименование этой структуры.
	Для анонимной структуры (принадлежащей только одному товару) это поле пустое.

	Если вы хотите присвоить товару именованную структуру, то нажмите
	кнопку \dlgbutton{Выбрать} справа от этого поля.

	\item[Наименование товара]
	Справочное поле, отображающее наименование товара, которому
	принадлежит редактируемая структура.

	\item[ИД]
	Не редактируемое поле, отображающее идентификатор данной структуры.

	\item[\dlgcombo{Вариабельный объект}]
	Специальная опция позволяет системе идентифицировать
	принадлежность классифицированному товару, не взирая на
	различие в вариабельном объекте.

	\item[Список компонентов]
	Отображает компоненты структуры. В списке присутствуют следующие
	колонки:
	\begin{description}
		\item[Компонент]
		Наименование товара, являющегося компонентом этой структуры.
		\item[Количество]
		Количество компонента, соответствующего одной торговой единицы
		товара, которому принадлежит структура.

		Если для структуры указан общий делитель (см. ниже),
		то данное количество компонента соответствует количеству товара,
		равного общему делителю.

		Количество компонента в составном товаре может быть указано либо в абсолютных единицах,
		либо в процентном соотношении. Программа допускает ввод количества компонента на
		единицу составного товара в виде простой дроби. Для этого необходимо ввести в
		соответствующем поле числитель и знаменатель дроби, разделенные символом '/'.
		Например: 17 / 20.

		\item[Нетто]
		Нетто-количество компонента, соответствующее общему делителю
		товара, к которому относится структура.

		\item[Цена]
		Справочное значение цены реализации компонента из последнего
		лота текущего склада.

		\item[Сумма]
		Сумма, рассчитываемая как произведение цены реализации компонента
		из последнего лота текущего склада и количества компонента, деленное
		на общий делитель структуры.

		\item[Признак наличия внутренней структуры]
		Если в этой колонке отображается символ R, то компонент содержит
		собственную структуру.
	\end{description}
	\item[\dlgbutton{Редактировать}]
	Открывает диалог редактирования выбранного компонента.

	\item[\dlgbutton{Добавить}]
	Открывает диалог выбора товара для создания нового компонента
	структуры. После выбора товара открывается диалог
	редактирования нового компонента.

	\item[\dlgbutton{По образцу}]
	Позволяет скопировать все компоненты выбранной структуры
	в текущую структуру.

	Вы увидите диалог, в котором можно выбрать товар и структуру,
	принадлежащую этому товару.

	При копировании компонентов из структуры-образца все компоненты,
	которые уже есть в текущей структуре, будут удалены (система
	предварительно запросит дополнительное подтверждение для этого).

	\item[\dlgbutton{Удалить}]
	Удаляет выбранный компонент структуры.

	\item[\dlgbutton{Подструктура}]
	Если диалог отображает сложную структуру (состоящую из нескольких
	структур), то эта кнопка открывает выбранную внутреннюю структуру.

	\item[\dlgbutton{Вверх}]
	Позволяет переместить выбранный компонент на одну строку вверх.
	Данная функция имеет смысл лишь для некоторых типов структур
	(например, для подстановочной).

	\item[\dlgbutton{Вниз}]
	Позволяет переместить выбранный компонент на одну строку вниз.
	Данная функция имеет смысл лишь для некоторых типов структур
	(например, для подстановочной).

	\item[\dlgbutton{Расширить}]
	Преобразует простую структуру в сложную, то есть, состоящую
	из нескольких подструктур.

	\item[\dlgbutton{Печать}]
	Отправляет данные о структуре на печать.

	\item[Общий делитель]
	По умолчанию, количество единиц компонента задается на одну единицу
	товара, которому принадлежит структура.

	Данное поле позволяет переопределить это правило. То есть, количество
	единиц компонентов будет задаваться для введенного в этом поле
	количества торговых единиц основного товара.

	\item[Период действия]
	Ограничивает период действия структуры.
	Обратите внимание на то, что если вам необходимо иметь на один товар
	несколько структур с различными периодами действия, то придется использовать
	сложные структуры.

	\item[\dlgradioc{Вид структуры}]
	Переключатель задает функциональное назначение структуры. Виды структур
	подробно описаны выше.

	\begin{description}
		\item[\dlgradioi{Не определен}] применяется тогда, когда структура не должна использоваться.
		\item[\dlgradioi{Комплектация/декомплектация}] структура определяет состав товара для сборки из компонентов либо разборки.
		\item[\dlgradioi{Частичная структура}] применяется для автоматического дополнения состава товарного документа.
		позициями, которые подразумеваются теми товарами, которые уже входят в этот документ.
		\item[\dlgradioi{Подстановка}] структура, обеспечивающая замену товара-владельца структуры
		на один из компонентов, перечисленных в ней.
		\item[\dlgradioi{Подарок}] такая структура позволяет определять сложные схемы маркетинговой стимуляции покупателей
		в зависимости от содержания кассового чека.
		\item[\dlgradioi{Комплекс}] специализированный тип структуры, используемый для продажи нескольких наименований
		товаров при выборе товара-владельца структуры в кассовой панели ppybrand().
	\end{description}

	\item[\dlgflag{Допускается комплектация}]
	Данная структура может быть использована для комплектации товара.

	Флаг доступен только для структур видов \dlgradioi{Комплектация/декомплектация} и
	\dlgradioi{Частичная}.

	\item[\dlgflag{Допускается разукомплектация}]
	Данная структура может быть использована для разукомплектации товара.

	Флаг доступен только для структур видов \dlgradioi{Комплектация/декомплектация} и
	\dlgradioi{Частичная}.

	\item[\dlgflag{Выход без НДС}]
	Флаг актуален только для структур комплектации. Если он установлен, то
	производимый товар (владелец структуры) будет оприходован с ценой поступления,
	заданной без НДС и с соответствующим флагом в лоте.

	\item[\dlgflag{Предупреждать о потенциальном подарке}]
	Флаг доступен только для структур видов \dlgradioi{Подарок}.

	Если он установлен, то в кассовой панели, при выборе какого-либо
	компонента подарка, система выводит окно извещения о том, сколько
	и чего осталось купить для получения подарка.

	Данная опция отрабатывает только в некоторых схемах начисления подарков.

	\item[\dlgflag{Перекрывающий подарок}]

	\item[\dlgflag{POS-модификатор}]
	Эта опция доступна для частичных структур и используется для определения сепциальных
	категорий структур, определяющих список модификаторов для кассовой панели.

	Структура с таким признаком может быть привязана как к обыкновенному товару,
	так и к обобщенному.
\end{description}

%endtopic

%topic{DLG_GSITEM}

\subsection{Диалог компонента структуры}

\ppypictsc{dlg-goodsstruc-item}{Диалог компонента товарной структуры}{0.5}

Вид диалога показан на рис.~\ref{pic-dlg-goodsstruc-item}. Он содержит следующие
управляющие элементы:

\begin{description}
	\item[\dlgcombo{Товарная группа}]
	Комбо-бокс выбора товарной группы для облегчения выбора товара. При редактировании
	компонента структуры, поле отображает группу, которой принадлежит товар.

	\item[\dlgcombo{Товар}]
	Товар, определяющий данный компонент структуры.

	\item[Количество]
	Группа управляющих элементов, включающая собственно поле ввода количества и
	несколько уточняющих элементов.

	По умолчанию, количество товара в компоненте структуры задается абсолютным значением
	торговых единиц.

	\ppynote{
		Дальнейшие объяснения предполагают, что в структуре не задан общий делитель.
		То есть, все расчеты ведутся на одну единицу товара, которому принадлежит
		структура.
	}

	\item[Нетто-количество]
	В этом поле может быть указано нетто-количество товара, содержащееся в компоненте
	структуры. Данное значение в учете не участвует, но применяется как справочное,
	а также может быть выведено в печатной форме.

	\item[\dlgradioi{В торговых единицах}]
	Если установлено это значение переключателя, то поле \qu{Количество} указывает
	сколько торговых единиц выбранного товара приходится на единицу товара,
	которому соответствует структура.

	\item[\dlgradioi{В физических единицах}]
	При этом выборе положения переключателя товар компонента будет
	пересчитываться из физических единиц в торговые, а именно,
	количество будет делиться на соотношение физических единиц к
	торговым, заданное в карточке товара.

	Например, если в качестве номенклатурной единицы компонента заданы
	помидоры в банках по 2кг на банку (торговые единицы - банка, физические -
	килограмм, соотношение физических единиц к торговым - 2), а
	в поле количество указано 0.5, то на единицу товара которому соответствует структура
	будет приходиться 0.5 * 1 / 2 = 0.25 банки.

	\item[\dlgradioi{В процентах}]
	Если включена эта опция, то значение количества просто делится на 100.

	\item[\dlgradioi{Количество - 1, цена - процент}]

	\item[\dlgflag{Отбрасывать дробную часть}]
	Этот флаг предписывает системе при расчете общего количества компонента отбрасывать дробную часть от результата.

	\item[\dlgflag{Автосписание в техн сессиях}]
	Если флаг установлен, то этот компонент может быть автоматически
	внесен в строки технологической сессии, сформированной по
	технологии, связанной с данной структурой.

	\item[\dlgflag{Основной компонент структуры}]
	Этот флаг \qu{помечает} компонент который в отчетах
	будет рассматриваться как основной.

	\item[\dlgflag{Отнимать у владельца частичной структуры}]
	Флаг актуален только для компонентов частичных структуры.
	Если он установлен, то при распределении частичной структуры
	по товарному документу, количество, равное распределенному
	количеству торговых единиц товара этого компонента, будет
	вычитаться из количества торговых единиц позиции, которой
	принадлежит структура.

	\item[\dlgflag{Подарок для идентичных позиций}]

	\item[\dlgflag{Запрашивать лот при расходе в документах}]

	\item[Символ]
	Это поле может быть либо пустым, либо содержать уникальную
	в пределах данной структуры строку, позволяющую идентифицировать
	компонент в формулах.

	\item[Формула]
	Здесь может быть введена формула, используемая для расчета
	количества этого компонента при автоматическом списании компонентов
	структуры в технологических сессиях.

	\item[Цена (справочно)]
	Справочное значение цены товара, взятое из последнего лото активного склада.

	\item[\dlgbutton{Лоты\dots}]
	Кнопка позволяет открыть таблицу лотов по товару компонента.
\end{description}

%endtopic

\subsection{Частичные структуры товара\label{sec-goodsstruc-part}}

В ряде случаев бывает полезным хранить для товара не полную структуру, описывающую все
компоненты товара, а лишь часть компонентов. Программа может использовать эту информацию
для быстрого подсчета и вставки в товарные документы компонентов уже вставленных в документ
товаров.

\ppyexample{
	При оптовой торговле пивом покупателям вместе с собственно пивом отпускаются бутылки и ящики.
	Ассортимент пива может быть весьма большим, притом, что ящики и бутылки, используемые как
	тара под пиво, имеют очень ограниченный ассортимент. Выписывая такой товар, приходится,
	вбив все, что требует покупатель, еще подсчитать и вбить общее количество бутылок и ящиков,
	отпускаемых этому покупателю.

	Если для каждого наименования пива будет существовать частичная структура, описывающая то
	какую бутылку, какие и какого объема ящики используются этим наименованием, то, вбив в
	накладную только требуемые сорта пива, а затем нажать одну клавишу, то все бутылки и ящики,
	необходимые для отгрузки товара автоматически попадут в накладную.
}

Для того чтобы сделать структуру частичной достаточно установить флажок
\dlgflag{Частичная структура} в диалоге.

\subsection{Подарочные структуры товара}

Специальная разновидность товарных структур предназначена
для определения комбинации товаров, при продаже которых через
кассовую панель \ppybrand{}, покупателю бы выдавался подарок.

Принцип организации такой структуры следующий: структура
привязывается к товару, который выдается в качестве подарка,
а компонентами структуры являются товары, за покупку которых
этот подарок назначается.

\ppyexampletitle{Пример 1}{
	За покупку трех бутылок пива \qu{Пенное 0.5л}
	выдается в подарок товар \qu{Кружка Пиво Пенное}.

	Для того, чтобы система \qu{знала} об этом необходимо
	завести структуру для товара \qu{Кружка Пиво Пенное}
	с флагом \dlgflag{Подарок}, а в качестве компонента
	этой структуры ввести единственный товар \qu{Пиво Пенное 0.5л}
	с количеством 3 (за три бутылки - один подарок).
}

\ppyexampletitle{Пример 2}{
	За покупку одной надувной лодки \qu{Альбатрос} и
	лодочного мотора \qu{Дуновение 2} выдается в подарок
	спиннинговое удилище \qu{Громовержец}.

	Для этого к товару \qu{Спиннинговое удилище Громовержец}
	необходимо привязать структуру вида \dlgradioi{Подарок}
	в качестве компонентов которой указать:
	\begin{itemize}
		\item \qu{Лодка надувная Альбатрос} - 1шт.
		\item \qu{Мотор лодочный Дуновение 2} - 1шт.
	\end{itemize}
}

Если подарок должен выдаваться за покупку любого товара из
некоторой выборки, тогда следует создать обобщенный товар
и внести в него всю выборку товаров, за покупку которых
назначается подарок и в качестве компонента подарочной
структуры указать это обобщение.

\ppyexampletitle{Пример 3}{
	За покупку любых трех бутылок одного из следующий наименований пива:
	\qu{Пенное 0.5л}, \qu{Богатырское 0.5л}, \qu{Забористое 0.5л}
	выдается в подарок товар \qu{Кружка Любитель Пива I-й гильдии}.

	В этом случае заводим обобщенный товар \qu{Пиво для любителей I-й гильдии}
	в качестве членов которого указываем товары:
	\begin{itemize}
		\item \qu{Пиво Пенное 0.5л}
		\item \qu{Пиво Богатырское 0.5л}
		\item \qu{Пиво Забористое 0.5л}
	\end{itemize}

	Товару \qu{Кружка Любитель Пива I-й гильдии} присваиваем структуру
	вида \dlgradioi{Подарок} и в качестве компонента этой структуры
	вводим обобщенный товар \qu{Пиво для любителей I-й гильдии}
	с количеством 3.
}

Выдача подарка может быть обусловлена, кроме набора проданных номенклатурных
наименований, минимальной суммой, на которую осуществлена продажа.

Для этого диалог структуры, если в нем установлен вид \dlgradioi{Подарок},
открывается поле \qu{Суммовое ограничение для подарка}. Если это поле
содержит значение, большее нуля, то система назначает подарок только в том
случае, если выполняются описанные выше ограничения и, в дополнение к этому,
общая сумма товаров, входящих в чек и перечисленных в структуре, превышает
это суммовое ограничение. Количество единиц подарка определяется в этом
случае как целая часть от деления суммы продажи (компонентов структуры) на
суммовое ограничение.

\ppyexampletitle{Пример 4}{
	Для демонстрации суммового ограничения подарка модифицируем предыдущий пример.

	За покупку одного из следующий наименований пива:
	\qu{Пенное 0.5л}, \qu{Богатырское 0.5л}, \qu{Забористое 0.5л}
	на сумму не менее 200 рублей выдается в подарок товар \qu{Кружка Любитель Пива I-й гильдии}.

	В этом случае заводим обобщенный товар \qu{Пиво для любителей I-й гильдии}
	в качестве членов которого указываем товары:
	\begin{itemize}
		\item \qu{Пиво Пенное 0.5л}
		\item \qu{Пиво Богатырское 0.5л}
		\item \qu{Пиво Забористое 0.5л}
	\end{itemize}

	Товару \qu{Кружка Любитель Пива I-й гильдии} присваиваем структуру
	с флагом \dlgflag{Подарок} и в качестве компонента этой структуры
	вводим обобщенный товар \qu{Пиво для любителей I-й гильдии}
	с количеством 1. Устанавливаем суммовое ограничение 200.
}

Еще один специализированный вид стимулирования продаж, который можно реализовать
с помощью подарочных структур - назначение льготных цен на товары, если они
продаются в заданной комбинации. Для этого диалог структуры, если в нем установлен
флаг \dlgflag{Подарок}, содержит комбо-бокс \dlgcombo{Подарочная котировка}.
Если здесь выбран какой-либо вид котировки, то вместо вставки в чек подарка
система присвоит товарам, составляющим заданную структурой комбинацию, цены в
соответствии с этим видом котировки. Обратим внимание на приоритетность этого
типа подарка: если структура содержит вид подарочной котировки, то будет
применена именно описанная схема (то есть товар, владеющий подарочной структурой
в чек добавлен не будет).

Дополнительную информацию об использовании подарочных структур
можно найти на стр.~\pageref{sec-chkpan-gift}.

\subsection{Анализ товарных структур}

Для просмотра выборки товарных структур необходимо обратиться к пункту меню \ppymenu{Справочники/Товары/Товарные стуктуры}.

\section{Администрирование товаров}

\subsection{Особенности товаров как объектов данных}

\subsubsection{Блокировка товаров}

Товары относятся к категории объектов, доступ к редактированию которых
блокируется во избежании ситуации, когда пользователь модифицирует
запись о товаре в то время, как другой пользователь изменил эту запись
после открытия диалога редактирования первым пользователем.

\subsubsection{Системные события по товарам}

Далее перечисляются системные события, фиксируемые в системном журнале и
свойственные товарам.

\begin{description}
	\item[Объект создан] Формируется при успешном создании товара.

	\item[Объект изменен] Формируется при успешном изменении товара.
	Заметим, что на момент написания этих строк (версия 6.2.4) система
	\qu{не умеет} распознавать фактическое отсутствие изменений при
	подтверждении пользователем редактирования в диалоге товара.
	Это означает, что если пользователь открывает диалог
	редактирования товара и, ничего не изменив в нем, нажимает
	\dlgbutton{ОК}, то событие \ppyrsrv{Объект изменен} для этого
	товара все равно будет сформировано.

	\item[Объект удален] Формируется при успешном удалении записи товара.

	\item[Объект объединен]
	Формируется при успешном объединении двух товаров.

	\item[Изменена налоговая группа у товара]
	Принадлежность товара налоговой группе является важным фактором
	учета. В связи с этим существует специальный регламент прав доступа
	на изменение принадлежности товара налоговой группа, а так же данное
	событие, позволяющее отследить факт изменения налоговой групп товара
	либо целой товарной группы.

	\item[Снят признак <Без скидки> с товара]
	Специализированное событие, используемой системой для собственных нужд
	(для правильной загрузки данных в кассовые модули, связанные с асинхронным
	кассовым узлом).

	\item[Автозаполнение альтернативной группы]
	Событие фиксируется если была вызвана функция автозаполнения альтернативной
	товарной группы по фильтру.

	\item[Удаление всех товаров из альт группы]
	Событие фиксируется при вызове функции полной очистки альтернативной товарной
	группы.

	\item[Изменен номер PLU в альтернативной группе]

	\item[Изменена товарная котировка]
	Было изменено значение котировки для товара.

	\item[Изменен элемент товарной матрицы]
	Это событие сопутствует событию \ppyrsrv{Изменена товарная котировка} если
	измененное значение котировки относится к товарной матрице.

	\item[Изменено ограничение на количество элементов матрицы]
	Это событие сопутствует событию \ppyrsrv{Изменена товарная котировка} если
	измененное значение котировки относится к ограничению товарной матрицы.

	\item[Изменена контрактная цена поставщика]
	Это событие сопутствует событию \ppyrsrv{Изменена товарная котировка} если
	измененное значение котировки является контрактной ценой поставщика.

	\item[Создан товар в группе, принадлежащей матрице]
	Специализированное событие, обусловленное необходимостью
	актуализировать внутренних кэш товарной матрицы при создании
	товара, которых явно матрице не принадлежит, но входит в нее
	на основании принадлежности группе, которая принадлежит матрице.

	Для конечного пользователя данное событие едва ли представляет ценность.
\end{description}

\subsection{Права доступа к товарам}

Управление правами пользователей на работу со справочником товаров реализуется через диалог
редактирования групп и пользователей (меню \ppymenu{Админ\rdir Группы и пользователи}),
либо через конфигурацию по группам и пользователям (меню \ppymenu{Админ\rdir Конфигурация по группам и пользователям}).

Перечислим флаги прав доступа к справочнику товаров и их особенности

\begin{description}
	\item[\dlgflag{Просмотр}]
	Разрешение на просмотр элементов справочника товаров. Отключение этого флага
	полностью лишит пользователя видеть какие-либо товары в базе данных.

	\item[\dlgflag{Создание}]
	Отключение этого флага лишит пользователя возможности создавать новые элементы
	справочника товаров.

	\ppynote{
		Если пользователь не имеет права создавать элементы справочника товаров,
		то он не должен принимать товарные документы из других разделов базы данных,
		поскольку при этом вероятен неполный прием документов.
	}

	\item[\dlgflag{Модификация}]
	Право на изменение элементов справочника товаров. Если вы лишаете пользователя этого
	права, то он не сможет изменить ни наименование товара, ни штрихкод, ни какие-либо
	иные атрибуты товара.

	Отсутствие права на модификацию товара не отменяет прав на изменение связанных с
	товаром объектов. Например, товарных групп или торговых марок (права по этим и
	другим объектам регламентируются отдельно).

	\item[\dlgflag{Удаление}]
	Право на удаление элементов справочника товаров.

	Здесь следует отметить, что если товар используется в каких-либо документах,
	то система в любом случае не разрешит его удалить, независимо от наличия такого
	права у пользователя.

	\item[\dlgflag{Админ}]
	Флаг, позволяющий изменять права доступа по товару у групп и пользователей.

	\item[\dlgflag{Массовое изменение котировок}]
	Флаг, дающий право на использование функции массового изменения котировок
	(см. раздел, посвященный товарным котировкам).

	\item[\dlgflag{Изменение принадлежности к налоговой группе}]
	Отсутствие этого права не позволяет пользователю изменить принадлежность
	товара или товарной группы к налоговой группе, при этом пользователь не
	лишается возможности создавать или изменять элемент справочника товаров.
	Более того, имея возможность создать запись товара, пользователь, лишенный
	права на изменение принадлежности товара налоговой группе, может создать товар,
	присвоив ему налоговую группу, но после сохранения, изменить этот атрибут
	уже не сможет.

	\item[\dlgflag{Объединение товаров}]
	Если этот флаг установлен, то пользователь имеет возможность объединять товары.

	Если при объединении товаров необходимо удалить товар, ссылки по которому были
	перенесены на другой товар (обычно так и происходит), то пользователю
	понадобится право на удаление товаров.

	\item[\dlgflag{Массовое изменение товаров}]
	Если это право отсутствует, то пользователь не имеет права на следующие операции:
	\begin{itemize}
		\item изменение флагов по выборке товаров
		\item изменение наименований по выборке товаров
		\item перенос выборки товаров из одной группы в другую
	\end{itemize}
	Право на массовое изменение товаров означает не больше того, что сказано выше.
	То есть, наличие такого права не переопределяет права на создание, изменение
	или удаление элементов справочника товаров.
\end{description}

%topic(DLG_GDSCFG)

\subsection{Конфигурация справочника товаров\label{sec-goods-cfg}}

\ppypictsc{dlg-016}{Диалог редактирования конфигурации товаров}{0.5}

Для настройки ряда параметров справочника товаров в системе предусмотрен диалог конфигурации,
доступный через пункт меню \ppymenu{Админ\rdir Прочие конфигурации\rdir Конфигурация справочника товаров\dots}.

Право просмотра и редактирования этой конфигурации регламентируется списком
доступных конфигурации, определенном для пользователя или группы пользователей.

В следующей таблице мы перечислим параметры конфигурации и объясним их смысл.
Обратим внимание на критичность некоторых из параметров в конфигурации справочника товаров.
При изменении конфигурации следует придерживаться правила грибника: \qu{Не знаешь - не трогай},
то есть, вы должны точно знать для чего меняете тот или иной параметр.

\begin{description}
	\item[Длины штрихкодов]
	Строка, содержащая перечисление допустимых длин штрихкодов с запятой в качестве
	разделителя. Система запретит ввод кодов, длины которых не соответствуют перечисленным
	значениям. Если в этой строке ничего нет, то система не ограничивает ввод штрихкодов по длинам.

	Если среди перечисленных значений содержится символ + (плюс), то система запретит ввод товара,
	у которого нет ни одного кода.

	Этот параметр не влияет на уже введенные в базу данных коды.

	\item[Минимальная длина кода, уникальная между разделами]
	Указанное этим параметром значение определяет минимальную длину штрихкодов, на которые
	система может полагаться как на критерий идентичности товаров, хранящихся в разных разделах
	базы данных.

	Для иллюстрации смысла этого параметра приведем следующий пример (допустим, значение параметра 7):
	В разделе А есть запись о товаре \qu{Кофе Чибо} с кодом 400606785066, а в разделе Б есть запись
	о товаре \qu{Кофе Чибо Эксклюзив 0.200} с кодом 400606785066. При передаче данных из раздела Б
	в раздел А система сравнит коды указанных товаров и, решив, что это один и тот же товар,
	синхронизирует их правильно.

	Далее, в разделе А есть запись о товаре \qu{Тушенка Московская 0.500} 32002, а в разделе Б запись
	о товаре \qu{Скумбрия в масле 0.200} тоже с кодом 32002. Хотя оба кода одинаковы, при приеме
	данных из раздела Б в раздел А система не станет считать эти товары идентичными, поскольку длина
	кода меньше, чем указан рассматриваемым параметром (7).

	\item[Префикс кода весового товара]
	Если этот префикс указан, то система использует его при экспорте данных в электронные весы с
	печатью штрихкодов, а также для контроля ввода.

	\item[Префикс кода весового счетного товара]
	Товары, имеющие в штрихкоде указанный префикс, идентифицируются системой как подлежащие
	загрузке на электронные весы с признаком счетного, а не весового товара.

	Данная опция поддерживается не для всех типов электронных весов.

	\item[Порог загрузки отсутствующих товаров на кассы, дней]
	Этот параметр используется для оптимизации загрузки данных на асинхронные кассовые узлы.
	Смысл его применения заключается в том, чтобы снизить количество записей товаров,
	экспортируемых в стороннюю программу, управляющую кассовыми машинами.

	Действует параметр следующим образом: если его значение больше нуля, то товары,
	которых нет на текущем остатке и которые последний раз приходили от поставщиков
	более, чем указанное количество дней назад, не экспортируются.

	Если товар присутствует на складе, к которому относится кассовый узел,
	то система не применяет данный параметр.

	Если ваша база данных содержит значительный справочник товаров (70000 наименований и
	более) и вы сталкиваетесь со значительными временными издержками при
	загрузке данных в кассовый модуль, то попробуйте дать рассматриваемому
	параметру значение 180.

	Отрицательным побочным эффектом низкого значения может быть то, что
	товары, которых нет на учетном остатке, но присутствуют в торговом зале фактически,
	нельзя будет продать через кассу (кассовый модуль просто не найдет его в
	своей базе данных).

	\item[\dlgflag{Убирать ведущие нули в штрихкоде}]
	Если этот флаг установлен, то система будет автоматически убирать ведущие нули во
	введенных штрихкодах. Это бывает необходимо в тех случаях, когда используемое оборудование
	воспринимает штрихкоды не как символьные строки, а как числа. В этом случае может получиться так,
	что коды вроде 32002 и 0032002 системой воспринимаются как различные, а оборудованием как
	одно и тоже.

	При установке этого флага система выдаст запрос на проверку и удаление ведущих нулей в штрихкодах
	по всей базе данных.

	\item[\dlgflag{Разрешать ввод весового префикса}]
	Если этот флаг установлен, то система не будет противиться вводу штрихкодов, начало которых
	совпадает с весовым префиксом. В противном случае система не разрешит вводить такие коды.

	\item[\dlgflag{Штрихкод содержит контрольную цифру}]
	Установка этого флага означает, что все штрихкоды, которые вы вводите в базу данных,
	содержат последнюю контрольную цифру.

	\item[\dlgflag{В штрихкоде допускаются не цифровые символы}]
	По умолчанию система не позволяет вводить штрихкоды, содержащие символы отличные от цифр.
	Если такое ограничение мешает работать, то можно установить этот флаг.

	\item[\dlgflag{Запрет на установку флага 'Цены без налогов'}]
	Если этот признак включен, то в диалоге редактирования товара нельзя будет установить флаг
	\qu{Цены без налогов}. За исключением редких случаев, следует включать этот признак так как
	неоправданная установка упомянутого флага товара может привести к неприятностям, которые трудно устранять.

	\item[\dlgflag{На весы вместо штрихкода загружать ИД товара}]
	Установите этот признак, если работаете с кассовыми аппаратами, управляемыми драйвером
	\trademark{Petrovich} (\trademark{Ладога-Ф}, \trademark{Электроника-92-Аквариус}).

	\item[\dlgflag{Розничная цена - по самому последнему лоту}]
	Стандартное правило идентификации розничной цены на товар состоит в нахождении последнего
	открытого лота на складе, для которого определяется цена. Если на заданном складе нет
	ни одного открытого лота, то система берет цену самого последнего лота товара на этом складе.
	Если же на заданном складе никогда не было ни одного лота товара, то система берет цену
	самого последнего лота на любом из складов.

	Установка этого флага переопределяет первую часть правила. То есть, если на заданном
	складе есть хоть один лот товара, то цена определяется по самому последнему из найденных
	лотов, независимо от того, открыт он или закрыт.

	У обоих вариантов есть свои плюсы и минусы:
	\begin{itemize}
		\item при использовании стандартного правила возникают ситуации, когда из-за того,
		что последний открытый лот, наконец, закончился, цена на товар внезапно
		изменяется из-за того, что более ранний открытый лот имеет учетную цену реализации
		отличную от только что закончившегося лота.
		\item при использовании правила, модифицированного обсуждаемым флагом, цены более
		стабильны, однако переоценка лотов может не привести к изменению розничной цены
		товара, поскольку эта цена определялась по закрытому лоту, который переоценить
		невозможно.
	\end{itemize}

	Подробности управления ценообразованием описаны в специальном разделе.

	\item[\dlgflag{Не показывать пассивные товары в списках}]
	Если этот флаг установлен, то в списках выбора не будут показаны товары,
	имеющие признак \dlgflag{Пассивный}.

	Установка этого флага предполагает четкую организацию системы администрирования
	справочника товаров. Так как, если признак пассивности установлен на товар
	неправомерно, то у персонала, пытающегося использовать этот товар,
	возникнут значительные трудности.

	\item[\dlgflag{Автоматически добавлять товар в альт группу}]
	По умолчанию, если вновь созданная запись товара подходит для вставки в одну
	или более альтернативных групп (не динамических), согласно их фильтрам, то система выдает пользователю
	предложение сделать это. Если вы хотите, чтобы система безусловно добавляла товар
	в такие группы без всяких предупреждений, то установите этот флаг.

	\item[При объединении товаров переносить штрихкоды]
	Если этот флаг установлен, то при объединении двух товаров, штрихкоды из удаляемого
	товара автоматически переносятся в тот товар, который остается.
	Кроме того, переносятся и коды товаров, ассоциированные со статьями.

	Если флаг выключен, то при объединении товаров штрихкоды и коды по статьям удаляемого
	товара исчезают вместе с ним.

	\item[\dlgflag{Использовать префиксы штрихкодов, заданные для весов}]
	Это - защитный флаг, при его установке включается техника применения весовых префиксов штрихкодов,
	заданных для отдельных весовых устройств.

	Данная техника необходима при работе с некоторыми типами весов (например, Bizerba).

	\item[\dlgflag{В расширенном диалоге ввода использовать бренд}]
	Расширенный диалог выбора товара при установке этого флага будет содержать
	дополнительный комбо-бокс \dlgcombo{Бренд}, позволяющий подбирать
	товары по торговой марке.

	\item[\dlgflag{Автоматически присваивать признак предпочтительного кода}]
	Флаг предписывает системе при сохранении товара, если в товаре ни один из штрихкодов не имеет
	признака \ppyrsrv{Предпочтительный} автоматически присваивать такой признак одному из штрихкодов.

	Не устанавливайте этот флаг, если не применяете концепцию предпочтительных штрихкодов в работе.

	\item[\dlgflag{Запрет на удаление из матрицы товара в открытом заказе}]
	Если флаг установлен, по программа будет блокировать возможность отзыва у товара
	принадлежности матрице, если существуют не закрытые драфт-документы заказа
	товара поставщику.

	\item[\dlgflag{В строках товарных струтур показывать цену реализации}]

	\item[\dlgflag{Не принимать изменения налоговых групп из других разделов}]
	Этот флаг позволяет избежать изменения налоговых групп товаров и товарных групп
	при приеме изменений товаров (товарных групп) из других разделов.

	Такая возможность бывает критически важна при необходимости избежать рассогласований
	ставок налогообложения операций с товарами (особенно, НДС). Для иллюстрации негативных
	явлений, которых можно избежать приведем следующий пример:

	Центральный офис торговой сети ведет бухгалтерский учет, принимая данные из
	магазинов и складов предприятия. Справочник товаров, в основной своей массе,
	администрируется распределенно в магазинах и на складах, поэтому установка запрета
	приема изменения товаров в центральном офисе невозможна. Однако принадлежность
	товаров налоговым группам администрируется централизованно в офисе. В таком
	варианте установка обсуждаемого флага гарантирует то, что никакие изменения товаров
	в других разделах базы данных предприятия не повлияют на расстановку налоговых
	групп в центральном офисе.

	\item[\dlgflag{Принимать изменения структур}]
	Если этот флаг не установлен, то в данный раздел базы данных не будут
	приниматься изменения существующих товарных структур, однако новые
	структуры акцептируются разделом независимо от данного флага.

	\item[\dlgflag{Отправлять содержимое обобщенных товаров}]

	\item[\dlgflag{Передавать альтернативные группы с содержимым}]

	\item[\dlgflag{Передавать прикрепленные файлы}]

	\item[\dlgcombo{Единица измерения по умолчанию}]
	Указанная здесь единица измерения будет использоваться системой при импорте данных,
	и в некоторых иных специальных случаях.

	\item[\dlgcombo{Товарная группа по умолчанию}]
	Вы можете здесь установить товарную группу, которой будет присваивать новый товар,
	для которого система не может определить принадлежность группы из контекста.

	Например: если вы создаете новый товар из таблицы товаров, сформированной по единственной
	обыкновенной группе, то программа автоматически присвоит этот товар группе из фильтра.
	Если же фильтр товаров не позволяет выбрать единственную обыкновенную группу как родительскую
	для нового товара, то в диалоге будет установлена группа по умолчанию из конфигурации (если задана).

	\item[\dlgcombo{Тип пакета по умолчанию}]
	Тип товарного пакета, который следует использовать по умолчанию при импорте данных
	и в других специальных случаях.

	\item[\dlgcombo{Группа основных средств}]
	Это поле позволяет выбрать группу товаров, в которой перечислены основные средства
	предприятия. Таки образом упрощается работа с основными средствами.

	\item[\dlgcombo{Товарная матрица}]
	Если ваше предприятие использует либо планирует использовать товарную матрицу,
	то в этом комбо-боксе следует указать вид котировки, соответствующий товарной матрице.
	\ppynote{
		Вид котировки товарной матрицы является очень специфичным. Вы не в коем случае не
		должны здесь выбирать вид котировки, который использовался для назначения \qu{настоящих}
		товарных котировок. Для товарной матрицы необходимо создавать отдельный вид котировки!
	}

	\item[\dlgflag{Игнорировать матрицу для групп-папок}]

	\item[\dlgcombo{Ограничение товарной матрицы}]
	Специальный вид котировки, позволяющий администрировать ограничения по количеству
	элементов в товарной матрице, ассоциированные с обыкновенными товарными группами
	либо группами верхнего уровня.

	\ppynote{
		Если вы не используете ограничения товарной матрицы, то оставьте это поле пустым.
		В противном случае вы рискуете столкнуться с замедлением работы системы.
	}

	\item[Нумерация собственных артикулов]
	Параметры автоматического формирования собственных артикулов на товары.
	Представлены двумя полями: шаблон нумерации и счетчик. Поле \qu{Счетчик} доступно только
	для просмотра. Оно содержит текущее значение последовательности нумерации
	(следующий собственный артикул будет включать значение счетчика, превышающее
	это на единицу).

	Шаблон нумерации определяет формат артикула. % @todo Написать отдельную секцию по шаблонам нумерации

	\item[\dlgbutton{Дополнительные поля\dots}]
	Вызывает диалог, в котором можно переопределить стандартные наименования
	дополнительных текстовых полей товаров.

	\item[\dlgbutton{Фильтр индикаторов тегов\dots}]
	Фильтр товарных тегов, определяющий цветовую индикацию наименований товаров в следующих таблицах:
	\begin{itemize}
		\item Товары
		\item Остатки товаров
		\item Статистика по товарам (анализ продаж)
		\item Расчет заказа поставщику
	\end{itemize}
	Если тег товара в таблице соответствует одному из критериев, то  нижний левый угол ячейки с наименованием
	этого товара окрашивается выбранным в фильтре цветом.

	Следует иметь в виду, что если теги товара удовлетворяют более чем одному критерию из списка, то
	применяется цвет первого из них (в порядке следования сверху-вниз).

	Подробно о редактировании фильтров тегов рассказано на стр.~\pageref{sec-tagv-filt}.
\end{description}

%endtopic

\section{Товарные котировки\label{sec-quot}}

Технология товарных котировок реализует механизм управления различными величинами,
связанными одновременно с товарами и набором иных объектов. Последняя часть (набор иных
объектов) является ключевым свойством котировок, отличающих их от других атрибутов товаров.

Фактически, кроме собственно товара, котировка может быть связана со следующими типами
объектов данных:

\begin{itemize}
	\item Складом
	\item Статьей аналитического учета
	\item Валютой
\end{itemize}

В зависимости от назначения величин, управляемых котировками, они делятся на
следующие категории:

\begin{itemize}
	\item Ценовые котировки (или просто котировки)
	\item Контрактные цены поставщиков
	\item Товарная матрица
	\item Ограничения товарной матрицы
	\item Поправочные коэффициенты прогноза продаж
\end{itemize}

Точное назначение и область использования котировки определяется видом котировки.
Посредством вида котировка может быть связана с видом операции и для нее может
быть ограничен период действия (сейчас действительно только для так называемых
розничных котировок).

Еще одним исключительно важным свойством котировок является их
иерархическая область действия относительно иерархии товарных групп
и товаров. А именно, значение котировки, определенное для некоторой
товарной группы, действительно для всех товаров, подчиненных этой группе
если для этих товаров не задано собственного значения данного вида котировки.

Следующий рисунок демонстрирует схему взаимосвязи объектов, участвующих в работе котировок.

\ppypict{Schema-Quot}{Схема взаимосвязей котировок}

\subsection{Вид котировки}

Вид котировки определяет базовые свойства семейства котировок. Каждая котировка,
ассоциирована ли она с товаром или группой товаров, обязательно относиться к какому-либо
виду котировки.

Список видов котировок доступен через пункт
меню \ppymenu{Справочники\rdir Товары\rdir Виды котировок товаров}.

Вид котировки содержит следующие важные поля:
\begin{itemize}
	\item Наименование
	\item Ассоциированный вид операции
	\item Признак \dlgflag{Не использовать в документах}
	\item Процент наценки
\end{itemize}

Ассоциированный вид операции определяет, к каким видам операций применим этот вид
котировки. В качестве вида операции можно указать обобщенную операцию, в этом случае
котировка будет применима ко всем операциям, содержащимся в обобщении. Если ассоциированный
вид операции не указан, то система будет считать, что котировка применима к любой операции.

Здесь следует привести существенное соображение:
при попытке применить котировку к операции в документе, система в первую очередь перебирает
виды котировок, имеющие ассоциированную операцию, соответствующую той, для которой
осуществляется выбор. Если не найдено ни одного подходящего вида котировки, то система
использует первый встретившийся (с минимальным значением идентификатора) вид котировки,
для которого не указан ассоциированный вид операции и не установлен признак
\dlgflag{Не использовать в документах}.

\subsubsection{Диалог редактирования вида котировки}

\ppypict{dlg-quotkind}{Диалог редактирования вида котировки}

Список видов котировок доступен через пункт меню \ppymenu{Справочники\rdir Товары\rdir Виды котировок товаров}.
Рассмотрим подробно диалог редактирования вида котировки, изображенный на рис.~\ref{pic-dlg-quotkind}.
Он содержит следующие управляющие элементы:

\begin{description}
	\item[Наименование]
	Наименование вида котировки. Система следит за тем, чтобы это наименование
	отличалось от наименований других видов котировок.

	\item[Символ]
	Уникальный символьный код вида котировки. Система использует этот символ
	для контекстной синхронизации видов котировок между разделами, а так же
	для ссылки на вид котировки при импорте данных из внешних источников.

	Рекомендуется для символа вида котировки использовать латинские буквы и цифры.

	\item[ИД]
	Уникальный неизменяемый идентификатор вида котировки. Это поле доступно
	для редактирования только при заведении новой записи, но в этом случае, как правило,
	следует оставлять значение этого поля равным нулю - система самостоятельно присвоит
	значение.

	\item[\dlgcombo{Вид операции}]
	Вид операции, с которым ассоциирован этот вид котировки. В качестве вида операции
	может быть указана как обыкновенная, так и обобщенная операция. В последнем случае,
	вид котировки будет ассоциирован с каждой из операций, принадлежащих обобщению.

	В товарных документах котировки этого вида будут применяться только к тем документам,
	которые имеют вид операции, согласующийся с выбранным здесь значением. Если здесь вид
	операции не указан, то, если вид котировки не является специальным (контрактная цена,
	товарная матрица) и не установлен флаг \dlgflag{Не использовать в документах}, котировки
	этого вида будут применяться ко всем товарным документам, где это необходимо.

	\item[\dlgcombo{Таблица статей}]
	Таблица статей определяет группу статей аналитического учета, используемую для привязки
	котировок этого вида к контрагентам.

	Если этот комбо-бокс пустой, то котировку можно связывать со статьями таблицы покупателей
	(определяется в \ppymenu{Админ\rdir Настройки\rdir \dlgbutton{Операции}\rdir Таблица покупателей}).

	\item[Ранг котировки]
	В этом поле можно указать числовое значение, определяющее приоритет
	использования котировок этого вида в сравнении с котировками других видов.

	Чем выше значение ранга, тем выше приоритет этого вида котировки. Необходимость в
	ранжировании может возникнуть тогда, когда два и более видов котировок могут
	использоваться в одном и том же случае.

	\item[Скидка]
	При использовании вида котировок в документе, если для выбранных условий отсутствует
	котировка и в этом поле указано значение, то к учетной цене реализации оно применяется как
	скидка (допускается отрицательное значение, интерпретируемое как наценка).

	\item[\dlgflag{Не использовать в документах}]
	Если этот флаг установлен, то котировки этого вида не будут применяться к строкам
	товарных документов.

	\item[\dlgflag{Для доп цены по документу в качестве базы использовать учетную цену реализации}]
	Если этот флаг установлен и котировки этого вида используются для формирования дополнительной
	цены по документу, то при расчете дополнительной цены за базу расчета принимается учетная цена реализации.
	Если же флаг не установлен, то за базу принимается чистая цена реализации (учетная цена
	реализации минус скидка).

	Под дополнительной ценой по документу подразумевается специфическая функция системы,
	позволяющая печатать в накладной или другой печатной форме документа, на ряду с обычными
	в этом случае величинами, дополнительную динамически рассчитываемую цену.
	Эта цена рассчитывается на основе какого-либо вида котировки, заданного в документе.

	\item[\dlgflag{Розничная котировка}]
	Если этот флаг установлен, то вид котировки используется для формирования розничных
	цен на товары. Эти цены применяются в розничных магазинах для загрузки на кассы и весы.

	Для вида розничной котировки может быть задан период действия и
	время действия (рекламные акции на товары, специальные скидки и т.д.).

	Обращаем внимание на то, что некоторые варианты формирования розничных цен
	поддерживаются не всеми кассовыми модулями, равно как и \ppybrand{} не обязательно
	поддерживает загрузку всех возможных комбинаций на любые кассовые модули.

	\item[\dlgbutton{Ограничения...}]
	Вызывает диалог редактирования ограничений для применения данного
	вида котировки. Подробно этот диалог описан ниже.

\end{description}

\ppypict{dlg-quotkind-restr}{Диалог редактирования ограничений вида котировки}

На рис.~\ref{pic-dlg-quotkind-restr} изображен диалог ограничений для вида котировки.
Заметим, что эти ограничения применимы не во всех случаях использования котировок.
В диалоге присутствуют следующие управляющие элементы:

\begin{description}
	\item[Период действия]
	Используется только для розничных видов котировок и котировок, привязанных к сериям персональных карт.

	Если указан период действия, то котировки этого вида действуют только в течении указанного периода.

	\item[Время действия]
	Используется только для розничных видов котировок и котировок, привязанных к сериям персональных карт.

	Если указан период времени действия, то котировки этого вида действуют только с начального часа до конечного
	часа (включительно).

	\item[Дни недели]
	Используется только для розничных видов котировок и котировок, привязанных к сериям персональных карт.

	Определяет дни недели, в которые могут применяться котировки этого вида.

	Заметим, что если в группе переключателей не включен ни один, то
	это интерпретируется как отсутствие ограничений по дням недели.

	\item[Диапазон суммы покупки]
	Этот параметр применяется только для котировок, ассоциированных с
	подарочными товарными структурами.

	Если сумма покупки, попадающей под определение применения подарочной
	котировки, соответствует этому диапазону, то котировка применяется. В противном случае - нет.

\end{description}

\subsubsection{Базовая котировка}

Существует специальный зарезервированный вид котировки, имеющий идентификатор 1.
Система предполагает его наличие, даже если в базе данных нет элемента,
соответствующего этому идентификатору.

Базовая котировка используется, во-первых, для формирования цен при внутреннем
перемещении товаров между складами, и, во-вторых, для ведения цен на не лимитируемые
товары, поскольку для таких товаров не создаются лоты, и, соответственно нигде не
фиксируется учетная цена реализации.

Одновременно с этим, базовая котировка может использоваться наряду с остальными
видами котировок, однако мы не рекомендуем ассоциировать базовый вид котировки
с каким-либо видом операции и устанавливать для него признак
\dlgflag{Не использовать в документах}.

\subsection{Способы назначения котировок}

Котировка на товар или группу товаров может быть задана либо в абсолютном, либо в относительном
выражении. Абсолютное значение котировки - это просто цена, которая будет использоваться,
например, при продаже товара.

Заметим, что абсолютное значение котировки может быть специальным образом установлено
равным нулю.

Относительная котировка может принадлежать одному из следующих типов (латинская буква в
обозначении типа используется при вводе значения в диалогах системы):
\begin{description}
	\item[C] Наценка в процентах к базовой цене поступления.
	\item[P] Наценка в процентах к базовой цене реализации.
	\item[D] Наценка к в процентах к разнице между базовыми ценами реализации и поступления.
		В этом случае общая цена рассчитывается по следующей формуле:
		$$
			quot = (price - cost) \cdot \frac{v}{100}
		$$
		где:
			\begin{description}
				\item[$price$] базовая цена реализации
				\item[$cost$] базовая цена поступления %
				\item[$v$] значение наценки.
			\end{description}
	\item[Q] Наценка в процентах к базовой котировке.
\end{description}

Если вы хотите получить скидку вместо наценки, то задайте отрицательную величину.
\ppyexampletitle{Примеры указания относительных котировок}{
	\begin{description}
		\item[3.5C] Базовая цена поступления плюс 3.5 процента.
		\item[-2P] Базовая цена реализации со скидкой 2 процента.
		\item[-20D] Скидка величиной 20 процентов от общей наценки.
		\item[7Q] Значение базовой котировки, увеличенное на 7 процентов.
	\end{description}
}

\ppyexampletitle{Пример расчета значения котировки, заданной по типу $D$}{
	\newline Базовая цена поступления ($cost$): 60 руб.
	\newline Базовая цена реализации ($price$): 100 руб.
	\newline Результирующая цена ($quot$):
	$$ 100+(100-60) \cdot \frac{-20}{100} = 92 $$
}

\subsection{Редактирование котировок\label{sec-dlg-quot}}

\ppypict{dlg-quot}{Диалог редактирования котировок}

Для установки и изменения котировок по товару следует в таблице товаров
(меню \ppymenu{Справочники\rdir Товары\rdir Товары}) на товаре, для которого необходимо
установить котировки нажать клавиши \keyb{Ctrl-Q}.

Кроме того, котировки по товару доступны из диалога редактирования строки товарного
документа и из таблицы котировок, которая рассмотрена ниже.

Диалог редактирования котировок показан на рис.~\ref{pic-dlg-quot}.

Этот диалог содержит следующие элементы

\begin{itemize}
	\item Наименование товара (группы товаров), к которому относятся редактируемые котировки
	\item Комбо-бокс \dlgcombo{Валюта}
	\item Комбо-бокс \dlgcombo{Клиент}
	\item Список складов
	\item Справочные значения цен из последнего лота выбранного товара в нижней части диалога
	\item Блок котировок, занимающий большую часть диалога и состоящий из:
	\begin{itemize}
		\item Колонки наименований видов котировок. Как минимум, в этой колонке будет
		присутствовать базовая котировка
		\item Колонки значений котировок, соответствующих выбранным:
		складу, валюте и клиенту
		\item Справочная колонка, показывающая окончательные значения цен, вычисленные,
		исходя из цен по последнему лоту, и с учетом котировок, установленных на родительские
		группы товара.
	\end{itemize}
	\item Кнопка \dlgbutton{Лоты}, позволяющая просмотреть лоты по товару
	\item Кнопка \dlgbutton{На группу}, дающая возможность увидеть котировки, установленные
	для родительской группы.
\end{itemize}

Для облегчения ввода значений котировок, вы можете в любом поле ввода нажать
клавишу \keyb{F2}, в результате чего на экране появится диалог-помощник, облегчающий
задачу вспоминания нужной буквы в мнемонике котировки (см. ниже).

Нажатие клавиши \keyb{F3}, позволяет просмотреть запись вида котировки.

\subsubsection{Диалог редактирования значения котировки}

\ppypict{dlg-quotval}{Диалог редактирования значения котировки}

Здесь присутствуют следующие управляющие элементы:

\begin{description}
	\item[\dlgradioc{Переключатель варианта значения}]
	Позволяет выбрать способ задания значения котировки. Большая часть этих вариантов
	рассмотрена выше. Здесь мы обратим внимание лишь на опцию \dlgradioi{Заблокированная котировка},
	которая предоставляет способ блокировки продажи товара при условиях, когда такое
	значение применяется.
	\begin{description}
		\item[\dlgradioi{Абсолютное значение}]
		\item[\dlgradioi{Наценка к базовой цене поступления}]
		\item[\dlgradioi{Наценка к базовой цене реализации}]
		\item[\dlgradioi{Наценка к разнице между ценой реализации и ценой поступления}]
		\item[\dlgradioi{Заблокированная котировка}]
		\item[\dlgradioi{Наценка к базовой котировке}]
	\end{description}
	\item[Значение]
	В этом поле указывается собственно числовое значение котировки.

	\item[\dlgflag{Ноль}]
	Включение флага позволяет определить явное нулевое значение котировки
	(если это флаг не установлен, то ноль означает отсутствие значения котировки).

	\item[Период]

	\item[Количество]
	Специальная опция, позволяющая ограничить применение значения количеством
	товара, не меньшим, чем указанное здесь. Следует заметить, что на текущий момент
	существует очень небольшое число функций системы, использующих данную опцию.
	Главным образом, это ограничение применяется в кассовой панели.
\end{description}

\subsubsection{Редактирование котировок на группу товаров}

Для редактирования общих котировок на товарную группу обратитесь к пункту меню
\ppymenu{Справочники\rdir Товары\rdir Группы товаров}. В списке выберите нужную группу
и нажмите кнопку \dlgbutton{Котировки}.

\ppynote{
	Вы можете устанавливать котировки только на обыкновенные группы и на группы-папки,
	но не на альтернативные группы.
}

\subsection{Таблица котировок}

Для удобства администрирования котировок, в системе \ppybrand{} предусмотрена таблица
котировок, позволяющая просматривать, печатать и редактировать котировки с применением
фильтрации.

Для доступа к таблице котировок выберите пункт меню \ppymenu{Справочники\rdir Товары\rdir Котировки}.

\ppynote{
	Таблица котировок имеет ограничение по максимальному числу видов котировок,
	которое может быть в ней отображено. Начиная с версии 6.6.11 этот максимум равен 32,
	до версии 6.6.11 он был равен 16.
}

%topic(DLG_QUOTFLT)

\subsubsection{Фильтр таблицы котировок}

\ppypict{dlg-034}{Диалог фильтра котировок}

Параметры фильтрации таблицы котировок можно задать в фильтре, внешний вид которого показан на рис.~\ref{pic-dlg-034}.
Параметры следующие:

\begin{description}
	\item[\dlgcombo{Вид котировки}]
	Если здесь выбран вид котировки, то таблица будет содержать только котировки,
	относящиеся к этому виду.

	\item[\dlgcombo{Валюта}]
	Для просмотра котировок, номинированных в конкретной валюте, выберите в этом
	комбо-боксе нужную валюту.

	\item[\dlgcombo{Склад} и признак \dlgflag{Котировка для всех складов}]
	Учитывая, что котировка может быть задана как для отдельных складов, так и
	для всех одновременно, вы можете отфильтровать только те котировки, которые
	заданы для определенного склада.

	Если вы отметите флаг \dlgflag{Котировка для всех складов}, то в таблице будут
	показаны только котировки, определенные как \ppyrsrv{Для всех складов}.

	Справа от комбо-бокса расположена кнопка \dlgbutton{Список}, позволяющая выбрать
	список складов, по которым должен строиться отчет.

	\item[\dlgradioc{Тип котировок}] Используется для выбора категории котировок, по
	которой следует получить отчет.

	\begin{description}
		\item[\dlgradioi{Обычные котировки}]
		Ограничивает отчет (и выбор комбо-бокса \dlgcombo{Вид котировки}) обыкновенными
		видами котировок.

		\item[\dlgradioi{Контрактные цены по поставщикам}]
		Ограничивает отчет контрактными ценами поставщиков и котировками допусков
		контрактных цен.

		Если общее соглашение с поставщиками не определяет видов котировок,
		применяемых для учета контрактных цен, то это положение переключателя заблокировано.

		\item[\dlgradioi{Товарная матрица}]
		Предполагает формирование отчета по элементам товарной матрицы. При выборе
		данной позиции, комбо-бокс \dlgcombo{Вид котировки} автоматически получает
		соответствующий вид котировки.

		Если конфигурация товаров не определяет вид котировки для учета товарной
		матрицы, то позиция переключателя заблокирована.

		\item[\dlgradioi{Ограничение по товарной матрице}]
		Используется для формирования отчета по элементам ограничений товарной
		матрицы. При выборе данной позиции, комбо-бокс \dlgcombo{Вид котировки}
		автоматически получает соответствующий вид котировки.

		Если конфигурация товаров не определяет вид котировки для учета ограничений
		товарной матрицы, то позиция переключателя заблокирована.

		\item[\dlgradioi{Поправочный коэффициент для прогноза продаж}]
		Ограничивает отчет значениями поправочных коэффициентов расчета прогноза
		продаж.

		Если конфигурация прогноза продаж не определяет вид котировки для учета
		таких коэффициентов, то позиция переключателя заблокирована.
	\end{description}

	\item[\dlgcombo{Клиент}]
	Позволяет увидеть только котировки определенные для выбранного клиента (для обыкновенных
	котировок).

	Для соглашений с поставщиками в этом комбо-боксе может быть выбран поставщик.

	Для остальных категорий котировок управляющий элемент заблокирован.

	\item[\dlgcombo{Группа товаров} и \dlgcombo{Товар}]
	Оба эти комбо-бокса позволяют ограничить выборку котировок только выбранным
	товаром или группой товаров.

	Справа от комбо-бокса \dlgcombo{Группа товаров} находится кнопка \dlgbutton{Фильтр},
	позволяющая применить расширенную фильтрацию товаров для отчета.

	\item[Диапазон значений]
	Если в этом поле указать диапазон значений, то будут отфильтрованы только
	те котировки, величина которых находится в заданном диапазоне.

	\item[Дата действия]
	Выбор здесь конкретной даты приведет к тому, что в результирующей таблице будут отображаться только значения, актуальные на эту дату.

	В этом поле можно использовать шаблон даты (см. стр.~\pageref{sec-input-tamplatedate}).

	\ppynote{
		Дата действия применима только к котировкам 2-го поколений (QUOT-II).
	}

	\item[Период установки]
	Только для QUOT-II.

	Если период не пустой, то будут отображаться только те значения, которые были установлены в заданный период. В противном
	случае показываются только текущие актуальные значения.

	\item[\dlgflag{Только товары, не имеющие котировки}]
	Если флаг установлен, то будут показаны только те товарные позиции, для которых котировка выбранного вида не задана.

	\item[\dlgflag{Показывать товары, не имеющие котировки}]
	При выборе этого флага в таблице будут показаны товары, для которых заданная котировка не установлена (наряду с товарами, имеющими котировку).

	\item[\dlgflag{Кросстаб}]
	Флаг доступен в том случае, если в комбо-боксе \dlgcombo{Вид котировки}
	выбран какой-либо элемент. В этом случае, при включенном флаге, на экран
	будет выводиться кросс-табулированный отчет каждая колонка которого (за исключением
	первых - титульных) соответствует одному складу.

	\item[\dlgradioc{Дифференциация по товарам/группам}]
	Блок радио-кнопок, позволяющий отобразить значения, которые привязаны только к товарам, либо только к товарным группам.
	\begin{description}
		\item[\dlgradioi{Нет}] Будут отображаться значение котировок не зависимо от того, к товару или группе они привязаны.
		\item[\dlgradioi{Только для товаров}] Выборка будет содержать только значения котировок, привязанных к товарам.
		\item[\dlgradioi{Только для товарных групп}] Выборка будет содержать только значения котировок, привязанных к товарным группам.
	\end{description}

	\item[\dlgcombo{Подстановка товара}]
	Комбо-бокс, позволяющий получить агрегированный отчет по товарных кластерам, в котором
	будут указаны не сами значения котировок и общее количество значений, соответствующих
	каждому товарному кластеру, определенному подстановкой (например, количество значений
	товарной матрицы по каждому бренду).

	При детализации элемента такого отчета открывается суботчет, содержащий уже значения
	котировок по товарному кластеру в контексте иных атрибутов выбранного элемента таблицы.

\end{description}

%endtopic

\subsubsection{Действия в таблице котировок}

	\paragraph{Редактировать котировки по товару}\indent\keyb{Enter}
	Вызывает диалог редактирования котировок по товару, соответствующему текущей строке таблицы.

	\paragraph{Редактировать котировки, выбрав товар}\indent\keyb{Insert}
	Позволяет редактировать котировки аналогично предыдущему пункту, но товар, котировки
	которого редактируются, предварительно выбирается из списка.

	Эта опция позволяет редактировать котировки по товару,
	которого нет в текущей таблице.

	\paragraph{Удалить все котировки по выбранному товару}\indent\keyb{Delete}
	Удаляет все котировки, соответствующие товару в текущей строке таблице,
	предварительно запросив подтверждение.

	\paragraph{Товар}\indent\keyb{F2}
	Вызывает диалог просмотра и редактирования товара из текущей строки таблицы.

	\paragraph{Лоты по товару}\indent\keyb{F3}
	Показывает все (и открытые и закрытые) лоты по товару из текущей строки
	таблицы. Если в текущей строке определен склад, то лоты будут показаны
	только по этому складу.

	\paragraph{Вид котировки}\indent\keyb{F4}
	Для того чтобы просмотреть информацию о виде котировки, выделите ячейку
	в колонке, соответствующей виду котировки, который хотите редактировать.
	Затем вызовите эту функцию.

	\paragraph{Динамика}\indent\keyb{Ctrl-T}
	Только для QUOT-II.

	Отображает таблицу с историей изменений значения котировки в выбранной строке таблицы.

	\paragraph{Просмотр значения котировки}\indent\keyb{Ctrl-F3}
	Специальная функция, отображающая системную информацию о значении котировки, на котором
	в момент вызова находится курсор таблицы.

	\paragraph{Итог по выборке}\indent\keyb{F9}
	Отображает количество элементов в выборке.

	\paragraph{Печать}\indent\keyb{F7}
	Печать отчета по таблице котировок.

	Стандартная форма отчета:
	\begin{description}
		\item[При фильтрации по одному или нескольким складам] \ppyrsrv{QuotList\_Loc}.
		\item[При фильтрации по контрагенту] \ppyrsrv{QuotList\_Obj}.
		\item[В остальных случаях] \ppyrsrv{QuotList}.
	\end{description}

	\paragraph{Передача товаров в другой раздел}\indent\keyb{Ctrl-H}
	Позволяет передать в другой раздел базы данных товары, представленные в
	таблице (само собой, вместе с товарами, в другой раздел будут переданы
	и котировки).

	\paragraph{Ремонт котировок}\indent\keyb{Ctrl-R}
	Запускает процедуру проверки и корректировки значений котировок.
	Может понадобиться в редких случаях при сбоях базы данных.

\subsection{Функция изменения котировок\label{sec-quotupd}}

Функция изменения котировок позволяет провести массовое изменение значений котировок по
различным критериям.

Массовому изменению можно подвергнуть как обыкновенные котировки, так и специализированные:
контрактные цены поставщиков и товарную матрицу.

Существуют следующие варианты массового изменения котировок:

\begin{description}
	\item[По лотам] для каждого товара значение котировки извлекается из
	последнего лота этого товара.
	\item[По последней переоценке] изменяются только котировки по тем
	товарам, которые были переоценены последним документом переоценки.
	Из этого же документа извлекаются новые значения котировок.
	\item[По проценту изменения] значения котировок изменятся на заданный
	процент. Например, +10 или -5. Этот вариант не применим к тем котировка,
	значения которых указаны в относительных величинах.
	\item[По явно заданному значению] в этом случае явно указанное значение
	(хоть абсолютное, хоть относительное) будет проставлено для всех товаров
	и котировок, удовлетворяющих условиям функции.
\end{description}

Для использования этой функции обратитесь к пункту меню \ppymenu{Операции\rdir Изменение котировок}.

Операция требует от пользователя следующих прав:

\begin{itemize}
	\item Права на изменение котировок для объекта данных \ppyrsrv{Виды котировок}.
	\item Права на массовое изменение котировок для объекта данных \ppyrsrv{Товары}.
\end{itemize}

\ppypict{dlg-quotupd}{Диалог установки параметров изменения котировок}

Диалог параметров показан на рис.~\ref{pic-dlg-quotupd}.

\begin{description}
	\item[Переключатель категории котировок]
	Позволяет выбрать категорию, к которой относится подвергаемая массовому
	изменения котировка.

	Положение этого переключателя определяет содержимое списка
	комбо-бокса \dlgcombo{Вид котировки} (см.ниже).

	Возможны следующие варианты:
	\begin{description}
		\item[\dlgradioi{Котировки}]
		\item[\dlgradioi{Контрактные цены}]
		\item[\dlgradioi{Товарная матрица}]
		\item[\dlgradioi{Поправочный коэффициент прогноза продаж}]
	\end{description}

	\item[\dlgcombo{Вид котировки}]
	Здесь необходимо выбрать вид, к которому относятся котировки,
	предназначенные к изменению.

	\item[\dlgcombo{Склад}]
	Выбрав склад, вы ограничите изменение только котировками, относящимися к этому складу.

	\item[\dlgflag{По всем складам}]
	Важный флаг!

	Если он установлен, то изменение будет осуществлено по \emph{каждому} из складов, к которым у пользователя есть доступ.

	Описанный случай следует отличать от нулевого склада (этот флаг не установлен и склад не выбран). В случае с нулевым складом
	изменения коснуться только котировок \ppyrsrv{Для всех складов}. То есть, тех, для которых склад не определен и которые, следовательно,
	применимы в том случае, если для конкретного склада не определено значение котировки.

	\item[\dlgcombo{Группа товаров}]
	Если выбрана товарная группа, то изменения будут применены только к котировкам, определенным для товаров и товарных групп,
	подчиненным этой группе.

	\item[\dlgcombo{Клиент}]
	Вы можете выбрать здесь контрагента, чьи котировки желаете изменить.

	Заметим, что список этого комбо-бокса заполняется статьями, относящимися к таблице покупателей, определенной в конфигурации.
	Если выбрана категория котировок \dlgradioi{Контрактные цены}, то список будет заполнен статьями поставщиков
	(таблица также определена в конфигурации).

	Справа от комбо-бокса находится кнопка, позволяющая выбрать несколько контрагентов, для которых
	должны быть изменены значения котировок.

	\item[\dlgradioi{По лотам}]
	Этот переключатель определяет формирование значений котировок
	по \emph{самым последним} лотам товаров (не зависимо от текущей системной или
	операционной даты).

	\item[\dlgradioi{По последней переоценке}]
	Выбор этого положения переключателя приведет к формированию
	значений котировок по \emph{самому последнему} документу переоценки для
	склада, заданного в фильтре (если склад не определен, то по любому из
	складов).

	\item[\dlgradioi{По проценту изменения}]
	Вариант изменения котировок, позволяющий явно задать процентную
	величину, на которую должны измениться значения котировок.

	Эта величина указывается в поле \qu{Новое значение котировки}.
	Положительное значение приведет к увеличению котировки, а отрицательное -
	к уменьшению.

	Данный вариант применим только к существующим котировкам.

	\item[\dlgradioi{Новое значение котировки}]
	Самый простой из вариантов пересчета - позволяет явно указать значение,
	которое должно быть присвоено котировкам.

	Само значение определяется в поле \qu{Значение котировки}.

	\item[\dlgradioi{Формула}]
	Предоставляет возможность определять новые значения котировок по специальной
	формуле, определенной в поле \qu{Значение котировки}.

	Язык описания формул описан в отдельной главе (см. стр.~\pageref{ch-lang-formula}).

	\item[\dlgradioi{По образцу}]
	Изменяет котировки на основании значений других котировок, вид и
	принадлежность складу которых заданы в дополнительных опциях
	этого диалога.

	\ppynote{
		Обратите внимание на то, что при выборе этого варианта дополнительные
		опции используются не так, как в иных случаях. Если включен способ
		назначения котировок, отличный от \dlgradioi{По образцу}, то вид котировки,
		склад и значение в дополнительных параметрах используются как ограничение,
		а не как значение.
	}

	\item[\dlgradioi{Удалить}]

	\item[Значение котировки]
	Поле ввода процента изменения либо абсолютного значения изменяемых
	котировок. В последнем случае можно воспользоваться кнопкой
	помощи, находящейся справа от этого поля (соответствующую функцию
	можно вызвать также клавишей \keyb{F2}, когда курсор находится в
	этом поле).

	\item[\dlgradioi{Только для существующих}]
	Переключатель, предписывающий системе устанавливать новые
	значения котировок только для тех, которые уже существуют в базе данных.
	Так, если по выбранному складу и товару X не существует котировки, то
	в этом случае ничего и не произойдет.

	\item[\dlgradioi{Добавить если не существует}]
	Это положение переключателя предписывает системе создавать котировку,
	ели она для заданных условий отсутствует.

	\item[\dlgradioi{Только если не существует}]
	При этом варианте существующие котировки не меняются, но если для заданных
	условий котировка не существует, то она создается и ей присваивается значение,
	определяемое параметрами этого фильтра.

	\item[\dlgbutton{Дополнительно}]
	Открывает дополнительный диалог, в котором вы можете установить специальный
	критерий для изменения котировок, состоящий в указании вида, склада и
	текущего значения котировок, которые следует менять.

	\item[\dlgflag{Предупреждать об изменение абсолютных котировок на относительные}]
	Дополнительная опция, позволяющая избежать ситуации, когда абсолютное
	значение котировки будет неоправданно изменено на относительное.

	Приведем пример ситуации, когда это может быть важно: для некоторой части
	номенклатуры у вас в базе данных определены абсолютные значения котировок
	(по-просту говоря, явно заданные цены). Для некоторой части товаров вы хотите
	задать котировки в относительном выражении (скажем, наценку к ценам поступления).
	При этом, опасаясь затронуть явно указанные цены, вы можете установить
	обсуждаемый флаг для того, чтобы система предупредила вас об этом.
\end{description}

\section{Товарные корзины\label{sec-goodsbasket}}

\ppypictsc{Schema-GoodsBasketUsage}{Схема использования товарных корзин}{0.6}

Товарная корзина является вспомогательным инструментом, позволяющим хранить выборку
товаров, каждый из которых связан с определенной количественной и весовой величинами.
Пользователи могут формировать корзины как вручную, так и из товарных отчетов.
Во многих случаях система предоставляет функционал по массовому заполнению корзин из
товарных отчетов или документов.
В то же время, существуют средства для переноса товарных позиций из корзин в товарные
документы либо в другие корзины.
И, наконец, корзина может быть просто распечатана либо передана в другой раздел базы данных.

Все это делает товарные корзины исключительно полезным средством
увеличения производительности работы в системе.

Следует сказать, что товарные корзины не являются учетными объектами.
То есть, они не влияют непосредственно на состояние товарных остатков предприятия.
Это означает, что пользователи могут свободно оперировать корзинами, не опасаясь
повлиять на состояние учета предприятия.

\subsection{Атрибуты товарной корзины}

Товарная корзина состоит из заголовка и строк.
Заголовок корзины содержит:
\begin{itemize}
	\item Наименование
	\item Поставщика (опционально)
	\item Признак сортировки по наименованию товара
	\item Признак корзины по умолчанию
\end{itemize}

Каждая строка корзины содержит следующие атрибуты:
\begin{itemize}
	\item Товар
	\item Количество
	\item Цена
	\item Срок годности
\end{itemize}

Обращаем внимание, что в корзине, в отличии от товарных документов, хранится только одна цена.
Пользователь сам решает как интерпретировать это значение.

\subsection{Блокировка товарной корзины}

В многопользовательской среде одну и ту же товарную корзину могут использовать несколько пользователей.
Для того, чтобы избежать конфликтов, связанных с одновременным редактированием одной корзины несколькими
людьми, при открытии корзины для редактирования, она блокируется. То есть, больше ни один сеанс системы
(даже созданный этим же пользователем) не сможет открыть корзину для редактирования до тех пор, пока она
не будет закрыта. При попытке открыть заблокированную корзину система выдает сообщение об этом с
информацией о том, кто ее в настоящее время редактирует.

\subsection{Приватная корзина}

Очень часто корзина используется как временный контейнер выборки товаров
для формирования товарного документа или какой-либо иной цели, ограниченной
только данным пользователем и небольшим промежутком времени.

Если к этому добавить крайне высокие требования к времени отклика системы при
использовании корзины, то мы приходим к тому, что хотелось бы иметь корзину,
которая в течении всего сеанса работы принадлежала бы только этому сеансу и
одновременно при каждом изменении не \qu{моталась} бы между рабочей станцией и базой данных,
нагружая сервер базы данных и замедляя работу ее владельца.

В ответ на вышесказанное, система \ppybrand{} предоставляет сервис \ppyrsrv{приватной}
корзины. Принципиально, с точки зрения пользователя, приватная корзина ни чем не
отличается от любой другой. Различие лишь в том, что как только пользователь объявил
корзину приватной, она блокируется и становится \qu{собственностью} текущего сеанса
системы. Кроме сеанса, которому принадлежит приватная корзина, ни один другой сеанс
(в том числе, и открытый этим же пользователем на этой же машине) не может получить
к ней доступ.

В тоже время, текущий сеанс может распоряжаться своей приватной корзиной так же
как и любой другой. В дополнение к этому, приватная корзина становится предпочтительной
в функциях добавления элементов в корзину и прочих.

При изменениях приватной корзины (за исключением изменения статуса приватности) корзина
не сохраняется в базе данных. Это - очень важная особенность. Она несет в себе два
следствия:

\begin{itemize}
	\item Все изменения приватной корзины осуществляются крайне быстро, поскольку
	при этом не происходит взаимодействия с сервером базы данных.
	\item При аварийном завершении сеанса, все изменения в корзине, сделанные с
	момента объявления ее приватной будут потеряны.

	Если сеанс завершился корректным выходом из программы, то приватная корзина будет
	автоматически сохранена.
\end{itemize}

\subsubsection{Использование приватной корзины}

Для того, чтобы сделать корзину приватной достаточно установить флаг \dlgflag{Приватная}
в диалоге заголовка корзины, либо в диалоге добавления товара в корзину.

Для того, чтобы снять у корзины статус приватной, необходимо отключить этот же
флаг.

В каждый момент рабочий сеанс системы может владеть только одной приватной корзиной.
Это значит, что когда вы делаете какую-то корзину приватной и в это время сеанс
уже владел иной приватной корзиной, предыдущая автоматически потеряет этот статус
и ее изменения будут сохранены в базе данных.

Если сеанс владеет приватной корзиной, то в строке состояния рабочего окна системы
отображается значок этой корзины. Двойной щелчок по этому значку откроет диалог
редактирования приватной корзины.

\subsection{Диалог редактирования товарной корзины}

\ppypict{dlg-goodsbasket}{Диалог редактирования товарной корзины}

Доступ к товарным корзинам возможен из многих точек пользовательского интерфейса системы.
Для администрирования списка корзин штатным средством является пункт меню
\ppymenu{Справочники\rdir Товары\rdir Товарные корзины}.

В этом списке показываются все корзины, зарегистрированные в системе. Здесь же вы можете
создать новую корзину, изменить либо удалить существующую. Так же, находясь в этом списке,
можно отправить корзину в другой раздел базы данных.

Диалог редактирования содержимого товарной корзины показан на рис.~\ref{pic-dlg-goodsbasket}.
Этот диалог может быть представлен в двух несколько различающихся модификациях:
\begin{itemize}
	\item Диалог, используемый непосредственно для редактирования выбранной
	корзины.

	Будем называть этот вариант 1-й режим.
	\item Диалог для просмотра выбранной корзины. Этот вариант несколько урезан по
	сравнению с предыдущим: он не позволяет менять наименование и флаги корзины.

	Будем называть этот вариант 2-й режим.
\end{itemize}

В таблице перечислены управляющие элементы этого диалога.

\begin{description}
	\item[Наименование корзины]
	Строка наименования.

	В режиме просмотра выбранной корзины это поле не доступно для редактирования.

	\item[\dlgcombo{Поставщик}]
	Опциональное поле, позволяющее ассоциировать с корзиной поставщика.

	\item[\dlgflag{Приватная}]
	Установка этого флага делает корзину приватной.
	Подробно приватные корзины рассмотрены выше.

	Флаг не видим, если корзина открыта во 2-м режиме.

	\item[\dlgflag{Текущая корзина}]
	Установленный флаг придает корзине статус текущей. То есть, если вы пытаетесь
	добавит из отчета строку в корзину, то такая корзина будет выбираться с
	приоритетом.

	Флаг не видим, если корзина открыта во 2-м режиме.

	\item[\dlgflag{Сортировать элементы}]
	Если этот флаг включен, то элементы корзины будут сортироваться по
	наименованиям товаров.

	Если вы работаете с корзинами большого объема, то установка флага может
	повлечь за собой значительное замедление.

	Флаг не видим, если корзина открыта во 2-м режиме.

	\item[Список строк]
	В списке строк корзины выделяются 4 колонки.
	Ниже списка расположены информационные поля, отображающие итоговые значения
	по строкам корзины:
	\begin{itemize}
		\item Количество строк
		\item Сумма (просуммированная одноименная колонка)
		\item Масса брутто (актуально если на вашем предприятии для товаров
		указывается масса брутто)
		\item Объем в кубометрах (актуально если на вашем предприятии для товаров
		указываются  габаритные размеры)
	\end{itemize}
	В этом списке доступна специализированная функция массового изменения всех цен на
	заданную процентную величину. Для того, чтобы воспользоваться этой опцией нажмите
	клавишу \keyb{F2}.

	\item[\dlgbutton{Редактировать} \dlgbutton{Добавить} \dlgbutton{Удалить}]
	Позволяют, соответственно, изменить добавить и удалить строку корзины.

	\item[\dlgbutton{Добавить из корзины}]
	Позволяет вставить в корзину строки из любой другой корзины.

	\item[\dlgbutton{Очистить}]
	Удаляет (после подтверждения предварительного предупреждения) все строки корзины.

	\item[\dlgbutton{Печать}]
	Отправляет корзину на печать (либо, при желании пользователя,
	экспортирует ее в файл или приложение).

	Непосредственно перед стандартным диалогом печати, вы увидите диалог,
	в котором запрашиваются дополнительные условия печати:
	\begin{itemize}
		\item Печатать ли с группировкой или нет
		\item Не печатать цены
	\end{itemize}
\end{description}

\subsection{Диалог строки товарной корзины}

\ppypict{dlg-gbitem}{Элемент товарной корзины}

Диалог элемента корзины может быть представлен в двух режимах:
\begin{itemize}
	\item Редактирование элемента непосредственно из корзины.

	В этом режиме не допускается смена корзины-владельца строки.
	В равной мере, в этом режиме не допускается изменение существенных
	атрибутов корзины (таких как признак \dlgflag{Приватная}).

	\item Добавление нового элемента в корзину с возможностью
	выбора корзины, отличной от изначально предложенной.

	Этот режим применяется при вызове функции добавления в корзину
	новой строки (например, из товарного отчета), при этом система
	не знает точно, в какую корзину пользователь хочет добавить строку,
	следовательно, диалог допускает выбор корзины и изменение некоторых
	атрибутов корзины.
\end{itemize}

Вид диалога товарной корзины показан на рис.~\ref{pic-dlg-gbitem}. Далее
перечисляются компоненты этого диалога.

\begin{description}
	\item[\dlgcombo{Корзина}]
	Комбо-бокс, указывающий на корзину, которой принадлежит строка.
	Если диалог строки открыт из конкретной корзины, то этот комбо-бокс
	не доступен для изменения. Если же диалог строки открыт как функция вставки
	строки корзины из отчета либо документа, то этот комбо-бокс открыт
	для выбора любой (не заблокированной) корзины.

	\item[\dlgcombo{Поставщик}]
	Один из атрибутов корзины, который может быть изменен в ее строке.

	\item[\dlgflag{Приватная}]
	Установка этого флага делает корзину приватной.
	Подробно приватные корзины рассмотрены выше.

	\item[\dlgcombo{Группа}]
	Вспомогательный комбо-бокс, традиционно используемый для облегчения выбора товара.

	\item[\dlgcombo{Товар}]
	Товар, определяющий содержимое строки корзины. В этом комбо-боксе обязательно должен быть выбран товар,
	в противном случае система сообщит об ошибке при нажатии кнопки \dlgbutton{OK}.

	\item[Емкость паллеты]

	\item[Емкость упаковки]

	\item[Количество упаковок]

	\item[Количество]

	\item[Цена]

	\item[Срок годности]

	\item[Сумма корзины]

	\item[Элементов в корзине]
	Справочное поле, отображающее текущее количество строк в корзине.

	\item[Масса брутто, кг]
	Справочное поле, отображающее суммарную массу брутто товаров,
	внесенных в корзину.

	Обратите внимание на то, что это значение корректно только в том случае,
	если запись каждого товара, содержащегося в корзине, определяет массу
	брутто упаковки поставки (либо торговой единицы).

	\item[Объем корзины (кбм)]
	Суммарный объем (в кубических метрах) товаров, содержащихся в корзине.

	Так же, как в случае массы брутто, это поле отображает корректное
	значение только тогда, когда для каждого товара определены габариты
	упаковки поставки.

	\item[\dlgbutton{Котировки}]
	Кнопка, позволяющая увидеть значения котировок для товара,
	содержащегося в элементе корзины.

	\item[\dlgbutton{Прогноз}]
	Не используется.

	\item[\dlgbutton{Показать корзину}]
	Вызывает диалог просмотра и редактирования корзины.

\end{description}

\chapter{Бухгалтерские справочники\label{ch-ref-acc}}

Бухгалтерские справочники обеспечивают работу подсистемы учета бухгалтерских операций.
К числу этих справочников относятся:

\begin{itemize}
   \item План счетов
   \item Таблицы аналитического учета
   \item Статьи аналитического учета
   \item Валюты
   \item Типы валютных курсов
   \item Валютные курсы
\end{itemize}
\section{План счетов}

План счетов - это список балансовых счетов бухгалтерского учета. В \ppybrand{} план счетов содержит
информацию о бухгалтерских счетах первого и второго порядков. Характеристиками счета являются:

\begin{itemize}
   \item Номер счета
   \item Номер субсчета (для счетов второго порядка)
   \item Наименование
   \item Признак активности (активный, пассивный или активно-пассивный)
   \item Связанная со счетом таблица аналитического учета
   \item Ограничения на остаток счета (овердрафт и максимум)
\end{itemize}

\ppypict{dlg-account-w}{Диалог ввода и редактирования бухгалтерского счета}

Поясним понятия, связанные с ограничениями остатка счета. Основное их назначение - проверка
корректности ввода документов, влияющих на план счетов. Как известно, активные счета всегда
должны иметь дебетовое сальдо, а пассивные - кредитовое. Для активно-пассивных счетов
возможны как дебетовые, так и кредитовые остатки. Чтобы лучше управлять ограничениями на
остатки по счетам, введены две дополнительные характеристики счета - это овердрафт и максимум.

При помощи овердрафта устанавливается  предельно допустимое минимальное значение остатка по
счету. Если значение овердрафта больше нуля, то сальдо по счету может пересекать ноль
(для активного счета в сторону кредита, для пассивного - в сторону дебета) на величину
овердрафта.

Отрицательный овердрафт не допускает приближение остатка по счету к нулю на величину,
меньшую абсолютного значения овердрафта (хороший пример - это нижний лимит кассы).

Максимум ограничивает остаток по счету со стороны, противоположной овердрафту. Значение
максимума для активного счета ограничивает максимальное значение дебетового остатка
(пример - верхний лимит кассы), для пассивного счета - максимальное значение кредитового
остатка. Отрицательное значение максимума счета лишено смысла, а потому система запрещает
ввод его величин ниже нуля.

С точки зрения рассмотренных параметров активно-пассивный счет ведет себя так же, как и
активный.

Если Вы не хотите усложнять свою жизнь описанными ограничениями, то просто оставляйте
эти два поля для всех счетов пустыми.

Просмотр плана счетов осуществляется в таблице при обращении к пункту меню
\ppymenu{Справочники\rdir Бухгалтерия\rdir План счетов}.
Таблица плана счетов состоит из следующих колонок:
\begin{itemize}
	\item Код счета
	\item Номер счета
	\item Номер субсчета
	\item Вид (активность счета)
	\item Наименование
	\item Аналитическая таблица
\end{itemize}

Для того чтобы просмотреть и (или) откорректировать счет, установите на него курсор и
нажмите \keyb{Enter}.

Чтобы удалить строку из плана, воспользуйтесь клавишей \keyb{Delete}.

\ppynote{
	При попытке удалить счет, по которому были сделаны проводки, система выдаст
	сообщение об ошибке.
}

Ввод нового счета можно осуществить непосредственно из таблицы, а также из любого
комбо-бокса, содержащего список  бухгалтерских счетов. Для этого следует, находясь на
любой строке плана счетов, нажать клавишу \keyb{Insert}. В диалоге \qu{Бухгалтерский счет}
введите номер счета, номер субсчета, установите вид активности, введите наименование счета,
укажите связанную со счетом аналитическую таблицу, если требуется задайте значения
овердрафта и максимума.

\subsection{Управление доступом к счетам}

Система предоставляет сервис по ограничению доступа к счетам для разных
пользователей или групп.

Механизм ограничения состоит в том, что для любого пользователя может быть
определен список счетов с признаком \qu{доступен/не доступен}. Кроме
перечисления конкретных счетов, в списке может быть указан \qu{пустой}
элемент, определяющий доступность всех счетов, не перечисленных в списке.

\ppyexample{
	Пользователю ИВАН вы хотите дать возможность работать только
	со счетом 50.2, но ни с каким иным. В этом случае, вы в списке доступности
	счетов указываете счет 50.2 как доступный, и создаете запись \qu{Остальные}
	с признаком \qu{Не доступен}.

	Пользователю МАРЬЯ вы желаете предоставить доступ ко всем счетам, кроме
	счета 70. В этом случае запись \qu{Остальные} имеет признак \qu{Доступен},
	а запись, соответствующая счету 70 - признак \qu{Не доступен}.
}

Администрирование списков доступности счетов осуществляется в диалоге
прав доступа пользователя или группы по кнопке \dlgbutton{Доступные счета\dots}.
Либо в диалоге конфигурации по группам и пользователям с выбранным
элементом редактирования \qu{Доступные счета} (\ppymenu{Админ\rdir Конфигурация по группам и пользователям}).

\subsubsection{Как действуют списки ограничения доступа к счетам?}

Прежде всего определим правила по которым рассматриваемые ограничения должны
работать.

\begin{itemize}
	\item Пользователь должен иметь возможность видеть и проводки и анализ
	счета, к которому имеет доступ.
	\item Пользователь не имеет возможности видеть анализ счета и проводки
	по счету, к которому не имеет доступа.
	\item Если счет, к которому пользователь имеет доступ, корреспондирует
	в какой либо проводке со счетом, к которому пользователь доступа не имеет,
	то сама проводка видна, но корреспондирующий счет не виден.
	\item Пользователь не имеет права ввести общую бухгалтерскую проводку,
	если в ней фигурирует недоступный для него счет.

	\item Ограничения доступности счетов не влияют на ввод бухгалтерских и товарных
	документов, которые автоматически формируют проводки на основе заданных в
	виде операции правил.

	Это - достаточно спорное с точки зрения логики правило, однако
	его необходимо принять из-за того, что в противном случае работа
	большинства сотрудников, занимающихся вводом документов будет блокирована.
\end{itemize}

Теперь перейдем к результатам.

\begin{itemize}
	\item В списках выбора счета пользователь не видит счетов, к которым он
	не имеет доступа.
	\item Анализ счета не допускает работу по счету, который не доступен пользователю.
	\item Если в анализе доступного счета присутствуют проводки, в которых
	этот счет корреспондирует с недоступным, то система не показывает номер
	корреспондирующего счета и его статью.
	\item Если анализ счета группируется по корреспондирующему счету (субсчету, статье),
	то проводки по всем недоступным для пользователя счетам сворачиваются в
	одну общую позицию. То есть, итоговая сумма будет видна, но ее анализ
	по недоступным счетам невозможен.
	\item При просмотре бухгалтерских проводок, проводки, в которых оба
	корреспондирующих счета не доступны, не видны.
	\item Проводки, в которых хотя бы один из корреспондирующих счетов
	доступен, видны, но при отсутствии прав доступа к другому счету, система
	не позволяет увидеть что это за счет.
\end{itemize}

\section{Другие категории счетов}

Кроме балансовых счетов, предполагающих корреспонденцию в проводках, система предоставляет ряд
иных категорий счетов:

\begin{itemize}
   \item Забалансовые счета
   \item Бухгалтерские регистры
   \item Группирующие счета
\end{itemize}

\subsection{Забалансовые счета}

Полностью соответствуют сути одноименных счетов в Российских Правилах Бухгалтерского Учета.
Между забалансовыми счетами отсутствует корреспонденция в проводках.
Каждая проводка проводиться по одному счету с суммой большей или меньшей нуля в зависимости
от того, увеличивается остаток на счете либо уменьшается.
Так же как и балансовые, счета этой категории могут иметь привязанную таблицу аналитического
учета и быть многовалютными.

\subsection{Бухгалтерские регистры}

Бухгалтерские регистры во многом аналогичны забалансовым счетам. С одним небольшим исключением:
они практически никак не регламентируются. Вы можете использовать бухгалтерские регистры
как свободные счета без корреспонденции.

\subsection{Группирующие счета}

Специальная категория счетов, предназначенная исключительно для максимального удобства
при анализе операций по счетам.

Группирующий счет представляет собой свободную сборку из произвольного количества балансовых,
забалансовых либо регистровых счетов. Вы сами можете сгруппировать в них учетные счета так,
чтобы получать наиболее удобные отчеты.

\ppyexample{
	Если вы регулярно анализируете денежные средства, находящиеся одновременно и в кассе
	в виде наличных денег и на расчетных счетах, то можете создать группирующий счет с
	именем, скажем, \qu{Денежные средства} и объединить в нем счет кассы (50) и расчетные
	счета (51).
}

\section{Таблицы аналитического учета}

Таблицы аналитического учета (далее мы сокращенно будем называть их аналитическими таблицами)
служат для хранения пронумерованных наборов статей аналитического учета. Благодаря
существованию аналитических таблиц можно к разным бухгалтерским счетам присоединять один
набор статей аналитического учета. Кроме того, аналитические таблицы позволяют определить
специфические характеристики наборов аналитических статей и ассоциировать их с другими
объектами данных, предоставляемыми системой \ppybrand{}.

При обращении к пункту меню \ppymenu{Справочники\rdir Бухгалтерия\rdir Аналитические таблицы},
открывается диалог, содержащий список наименований существующих таблиц аналитического учета
и группу кнопок.

Для того чтобы просмотреть или откорректировать наименование таблицы,  установите на нее
курсор и нажмите кнопку \dlgbutton{Редакт}.

Нажатие кнопки \dlgbutton{Статьи} или клавиши \keyb{F11} на строке списка наименований
приведет к открытию таблицы просмотра, ввода и редактирования статей выбранной таблицы.

Кнопка \dlgbutton{Добавить} открывает диалог ввода названия новой таблицы аналитического
учета

\subsection{Ассоциации таблиц аналитического учета}

Таблица аналитического учета определяет тип объекта, с записями которого связаны
статьи, относящиеся к этой таблице. Возможны следующие варианты ассоциаций:

\begin{description}
	\item[Нет] статьи этой таблицы не будут связаны ни с какими иными объектами данных.
	\item[Персоналии] статьи этой таблицы будут связаны с персоналиями. Это - один из
	наиболее часто встречающихся вариантов. Если аналитические статьи связаны с персоналиями,
	то система позволяет значительно расширить анализ данных по документам, ссылающимся на
	такие статьи. Для уточнения вида персоналий, к которому относятся статьи этой таблицы
	необходимо определить группу ассоциации таблицы.
	\item[Склады] статьи этой таблицы будут ссылаться на склады. Таблицы такого типа
	позволяют определять контрагентов в документах, ассоциированных со складами. Например,
	товарный документ внутренней передачи обычно в качестве контрагента имеет статью, связанную
	со складом.
	\item[Бухгалтерские счета] не часто используемый тип ассоциации, позволяющий определять
	в качестве статьи документов бухгалтерские счета. Это бывает полезным в тех случаях, когда
	бухгалтерская проводка по документу должна проходить по счету, соответствующему выбору,
	сделанному оператором при вводе документа.

	Несмотря на то, что этот тип ассоциации полезен, а иногда и необходим, мы рекомендуем для
	увеличения гибкости настройки проводок по видам операций использовать технологию алиасов
	счетов, предоставляющую гораздо более мощную функциональность.
\end{description}

\ppynote{
	Если таблица имеет статьи, связанные с другими объектами данных,
	то система не допускает изменения типа или группы связанных объектов.

	Если бы это было не так, то возникала бы высокая вероятность
	нарушения целостности ссылок между аналитическими статьями
	и объектами, с которыми они связанны.
}

\subsection{Диалог редактирования таблицы статей аналитического учета}

\ppypict{dlg-accsheet}{Таблица аналитических статей}

Внешний вид диалога показан на рис.~\ref{pic-dlg-accsheet}. Далее следует описание
управляющих элементов этого диалога.

\begin{description}
	\item[Наименование]
	Уникальное среди всех таблиц наименование. Система следит за тем, чтобы
	пользователь не мог ввести наименование новой таблицы такое, которое
	совпадает с наименованием уже существующей таблицы статей.

	\item[Символ]
	Короткое обозначение таблицы статей, используемое для ссылок из формул
	и внешних систем.

	В качестве символа рекомендуется использовать односложные (без пробелов)
	мнемоники, набранные латинскими буквами.

	Если символ здесь указан, то он обязательно должен быть уникальным
	среди других символов таблиц аналитического учета.

	\item[Ассоциированный объект]
	Выбор ассоциированного объекта позволяет связать статьи,
	принадлежащие этой таблице с другими объектами базы данных.

	Возможные варианты ассоциированных объектов описаны выше.

	\item[\dlgcombo{Группа ассоциации}]
	На текущий момент это поле используется только в том случае, если выбран тип связанного
	объекта - персоналии. Тогда в этом поле указывается вид персоналий, с которыми связываются
	аналитические статьи этой таблицы.

	\item[\dlgcombo{Тип регистра для поиска}]
	Если эта таблица использует персоналии как тип связанного объекта, то указание здесь типа
	регистрационного документа позволяет быстро находить нужную статью в комбо-боксах,
	предлагающих выбрать статью, относящуюся к этой таблице.

	Для использования этой опции необходимо нажать клавишу \keyb{F2} в поле комбо-бокса (список
	выбора не следует открывать). Система предложит ввести номер регистрационного документа, и,
	если персоналия с таким номером существует, реализует ее выбор.

	\item[\dlgflag{Создавать статью при создании объекта}]
	Если этот флаг установлен, то при создании объекта, с которым может быть связана статья
	аналитического учета, соответствующая этой таблице, такая статья будет создана автоматически.

	Если вы выбираете тип связанного объекта \ppyrsrv{Персоналии} или \ppyrsrv{Склады}, то
	этот флаг автоматически включается (вы, естественно, в праве его отключить, но
	это усложняет ввод новых статей, относящихся к этой таблице).

	\item[\dlgflag{Использует подстановку алиасов счетов}]
	Если этот флаг установлен, то в диалоге редактирования статьи аналитического учета,
	соответствующей этой таблице, будет виден список, в котором можно ввести соответствие
	статьи одному или более алиасу счетов.

	\item[\dlgradioc{Использование соглашений}]
	Здесь возможен один из следующих вариантов:
	\begin{description}
		\item[\dlgradioi{Не использует}] статьи этой таблицы не связываются с записями соглашений
		\item[\dlgradioi{Соглашения с покупателями}] если выбран этот вариант, то с каждой статьей может быть
		связано (не обязательно) соглашение с покупателем.
		\item[\dlgradioi{Соглашения с поставщиками}] если выбран этот вариант, то с каждой статье может быть
		связано (не обязательно) соглашение с поставщиком.
	\end{description}

	Если переключатель установлен в положении \dlgradioi{Не использует}, но данная таблица
	прописана в конфигурации, как таблица покупателей, то для ее статей все равно
	можно будет определять соглашения (это - унаследованное от старых версий системы
	поведение).
\end{description}

\ppyexample{
	\begin{itemize}
		\item Таблица \qu{Склады}, используемая для детализации бухгалтерских операций по
		местам хранения товаров, ссылается на справочник складов.

		\item Таблица \qu{Поставщики}, используемая для детализации расчетов с поставщиками
		товаров, может ссылаться на персоналии, при этом группой ассоциации будет вид
		персоналий \ppyrsrv{Поставщики}.

		\item Примером не ассоциированной может быть таблица \qu{Статьи расходов}.
		Статьи такой таблицы - это просто перечисление видов расходов, скажем:
		\begin{itemize}
			\item канцелярские расходы
			\item представительские расходы
			\item и т.д.
		\end{itemize}
	\end{itemize}
}

\section{Статьи аналитического учета\label{sec-ref-article}}

\ppypict{dlg-124}{Статья аналитического учета}

Статьи аналитического учета являются одним из наиболее важных объектов организации учета на предприятии.

Статьи служат для унифицированного представления разнородных типов объектов в бухгалтерском
и товарном документообороте предприятия.

Далее мы опишем диалог редактирования аналитической статьи. Его внешний вид показан на рис.~\ref{pic-dlg-124},
а таблица перечисляет и объясняет назначение каждого из управляющих элементов этого диалога.

\begin{description}
	\item[Таблица]
	Справочное поле, в котором указывается наименование таблицы, к которой относится данная статья
	аналитического учета.
	Изменение принадлежности статьи к таблице системой не допускается.

	\item[Номер]
	Номер статьи. Как правило, при создании новой статьи, система автоматически присваивает ей номер.
	Необходимость изменять его значение может возникнуть только в крайне редких случаях.

	\item[Наименование]
	Наименование статьи. Если статья привязана к какому-либо объекту данных, то наименование
	она наследует от него. В этом случае поле наименование заблокировано для изменения.
	Если же таблица, к которой принадлежит статья, не  предполагает связь с какими-либо объектами,
	то наименование статьи устанавливается и модифицируется пользователем.

	\item[Идентификатор]
	Справочное поле, отображающее значение идентификатора редактируемой статьи. Для новой записи
	это значение нулевое.

	\item[Уровень доступа]
	Не используется.

	\item[\dlgflag{Закрыта}]
	Если у статьи установлен этот признак, то в списках выбора такая статья не отображается.

	\item[\dlgflag{Стоп}]
	Специализированный флаг, запрещающий выбирать такую статью в качестве контрагента в новых
	документах, вид операции которых относится к одному из типов: расход товара, товарный заказ,
	драфт-расход.

	При выборе такой статьи в диалоге документа на экран выдается сообщение (программа не позволяет
	оставить такую статью контрагентом - то есть, описываемый флаг является блокирующим, а не
	уведомительным).

	\item[\dlgbutton{Соглашение}]
	Кнопка, предоставляющая доступ к соглашению с клиентом, либо поставщиком (в зависимости от
	того, как настроена соответствующая таблица статей).
	Справа от кнопки находится цветной индикатор, указывающий, есть ли у данной статьи соглашение
	или нет. Если цвет индикатора красный, то к статье соглашение не привязано, если же цвет зеленый,
	то - привязано.

	\item[\dlgbutton{Очистить соглашение}]
	Нажатие этой кнопки приведет к удалению соглашения, связанного со статьей.
	\ppynote{
		Соглашение удаляется независимо от того, нажмете вы после этого на кнопку
		\dlgbutton{ОК} в диалоге статьи или нет. По этому, перед удалением
		программа запрашивает строгое подтверждение для этого действия.
	}

	Кнопка доступна только если для статьи существует соглашение и пользователь
	имеет право на изменение соглашений.

	\item[\dlgbutton{Связный объект}]
	Если аналитическая статья связана с каким-либо объектом, то нажатие этой кнопки позволит
	посмотреть и изменить этот объект.
\end{description}

%topic(DLG_CLIAGT)

\section{Соглашения с клиентами\label{sec-cliagt}}

\ppypict{dlg-126}{Соглашение с клиентом}

Соглашения с клиентами используются для определения условий отгрузки клиентам товаров и услуг.

Для того, чтобы со статьями можно было ассоциировать клиентские соглашения, необходимо
в таблице, которой принадлежат эти статьи установить признак \dlgradioc{Использование соглашений}
в значение \dlgradioi{Соглашения с покупателями}. Из этого правила есть исключение: если таблица
аналитических статей динамически квалифицируется системой как таблица покупателей (на
основании общих настроек в базе данных), то система разрешит ассоциировать со статьями этой
таблицы клиентские соглашения. Если с некоторой аналитической статьей не связано клиентское
соглашение, то система, при необходимости (например, при работе с документами) будет извлекать
некоторые атрибуты соглашения из общей записи соглашений, которая доступна через пункт меню
\ppymenu{Админ\rdir Соглашения с клиентами и поставщиками\rdir Соглашение с клиентами}.

Диалог редактирования клиентского соглашения показан на рис.~\ref{pic-dlg-126}.
Заметим, что на этом рисунке изображен диалог частных соглашений с клиентами (по конкретной статье). Диалог
общего соглашения отличается тем, что вместо комбо-бокса \dlgcombo{Дополнительный объект}
в нем присутствует комбо-бокс \dlgcombo{Таблица доп. объектов} и исключены некоторые информационные элементы.

В следующей таблице перечислены управляющие элементы этого диалога и их назначение.

\begin{description}
	\item[Клиент]
	Справочное поле, отображающее наименование аналитической статьи, к которой относится
	соглашение.

	\item[Номер соглашения]
 	Произвольный текстовый номер соглашения. Система не следит за нумерацией и уникальностью
	этого поля.

	\item[Начало действия]
	Дата, с которой соглашение начинает действовать.

	\item[Срок действия]
	Дата, до которой условия соглашения действительны.

	\item[Кредитный лимит]
	Максимальная сумма долга клиента. Если текущая сумма долга клиента превышает эту величину
	(при условии, что величина больше нуля), то при попытке ввода документа отгрузки клиенту,
	программа выдает предупреждение.

	\item[Кредитный лимит на X дней]
	Информационное поле, отображаемое только в том случае, если в конфигурации статистики дебиторов установлено
	значение периода дополнительной величины кредитного лимита (см. стр.~\pageref{sec-debtstat-cfg}).

	\item[Текущий долг]
	Справочное поле, показывающее текущую величину долга клиента перед предприятием.

	\item[\dlgcombo{База для расчета срока оплаты}]
	Комбо-бокс, позволяющий выбрать фактор, который определяет дату, от которой отсчитывается дата
	платежа по долговому документу, контрагентом в котором является данная аналитическая статья.

	Возможны следующие варианты:
	\begin{description}
		\item[Дата документа] Вариант по умолчанию - срок опраты определяется как основная дата документа
		плюс количество дней, заданных атрибутом \qu{Срок оплаты (дней)}.
		\item[Дата счет-фактуры] Дата, заданная в атрибутах расширения документа как дата счет-фактуры.
		\item[Дата отправления (фрахт)] Дата отправления груза, заданная в атрибутах фрахта по документу.
		\item[Дата прибытия (фрахт)] Дата прибытия груза, заданная в атрибутах фрахта по документу.
		\item[На выбор один из тэгов документа, имеющих тип \ppyrsrv{Дата} или \ppyrsrv{Метка времени}]
	\end{description}

	\ppynote{
		Если здесь задан атрибут, значение которого не определено для документа, то применяется правило по умолчанию: то есть,
		дата оплаты отсчитывается от основной даты документа.
	}
	\ppynote{
		Не пустое соглашение для конкретного контрагента в любом случае переопределяет аналогичный параметр заданный
		в общем соглашении с клиентами.

		То есть, если, например, в общем соглашении задана база расчета срока оплаты как \qu{Дата прибытия (фрахт)}, а
		статья, по которой выписывается документ имеет собственное соглашение, гда тот же параметр имеет значение
		по умолчанию, то для такого документа будет применено последнее (\qu{Дата документа}).
	}

	\item[Скидка (\%)]
	Если в этом поле установлена величина, отличная от нуля, то при выборе контрагента в
	товарном документе, система установить это значение скидки на весь документ.

	\item[Макс скидка (\%)]
	На текущий момент это значение системой не используется.

	\item[Дата, до которой процессинг должников не меняет параметры соглашения \label{item-cliagt-LockPrcBefore}]
	Это поле тесно увязано с модулем расчета рейтингов дебиторов и процессингом
	должников.

	Если вы запускаете процессинг должников с опцией расчета рейтингов дебиторов
	с одновременной автоматической установкой кредитных лимитов в соглашения,
	то указываемая здесь дата позволяет блокировать автоматическое обновление
	кредитного лимита для данного соглашения вплоть до этой даты.

	То есть, если 31 августа 2008 запускается процессинг должников с установкой
	кредитных лимитов, а здесь указана дата 1 сентября 2008, то какой бы
	кредитный лимит не был рассчитан для этой статьи, в соглашение он не
	попадет.

	Если же расчет осуществлен 10 сентября 2008, то рассчитанный лимит
	будет установлен в соглашении.

	Подробнее о рейтингах дебиторов рассказано на стр.~\pageref{sec-debtorstat}.

	\item[Срок оплаты (дней)]
	Если значение, установленное здесь больше нуля, то при выборе соответствующего контрагента
	в новом документе, система установит дату оплаты равной дате базы для расчета срока оплаты (см. выше) плюс указанное в этом
	поле количество календарных дней.

	\item[\dlgcombo{Агент по умолчанию}]
	При вводе документа по контрагенту, которому соответствует это соглашение, система
	автоматически установит в документе выбранного здесь контрагента.
	Обращаем внимание, что если поле агента в документе уже заполнено, то при выборе другого
	контрагента, система не изменит текущее значение агента даже если в соглашении с новым
	контрагентом указан иной агент по умолчанию.

	\item[\dlgcombo{Вид котировки}]
	Если здесь установлен вид котировки, то в документах по контрагенту, которому
	соответствует это соглашение, для ценообразования будет применяться именно этот
	вид котировки.

	Этот же вид котировки используется для установки цен при экспорте данных для системы
	мобильной торговли StyloPalm.

	\item[\dlgcombo{Таблица доп. объектов} (Общее соглашение)]
	Если в этом комбо-боксе выбрана таблица аналитического учета, то
	в частных соглашениях с клиентами можно будет определять статью аналитического
	учета, которая будет автоматически устанавливаться в новых документах
	по контрагенту (см. ниже).

	\item[\dlgcombo{Дополнительный объект} (Частное соглашение)]
	Этот комбо-бокс активен только в том случае, если в общих соглашениях с
	покупателями установлена таблица дополнительных объектов (см. выше).

	Если дополнительный объект в соглашении определен, то при выборе
	контрагента в новом документе система, обнаружив эту установку в соглашении
	попытается установить дополнительный объект по документу равным тому,
	что здесь указано.

	Слово \qu{попытается} означает, что установка дополнительного объекта
	в соответствии с соглашением возможна только тогда, когда вид операции,
	к которому относится документ определяет таблицу статей дополнительного
	объекта равной той, что установлена в общих соглашениях с клиентами.

	Кроме того, система ни станет менять значение дополнительного объекта
	по документу, если он уже там установлен.

	\item[Лимит возвратов]
	Два элемента, определяющие предельный лимит возвратов от клиента
	в процентах от оборота этого клиента за период.
	\begin{description}
		\item[\dlgcombo{Период}]
		Здесь может быть выбран период, за который
		рассчитывается предельная доля возвратов к оборотам.

		\item[\dlgcombo{Максимальная доля}]
		Максимальное процентное отношение суммы возвратов от клиента к
		суммарным продажам за период указанный в соответствующем поле.
		Значение может быть введено с точность до одного знака после
		десятичной точки.
	\end{description}

	Обратим внимание на то, что лимит возвратов наследуется от общего
	соглашения с клиентами. То есть, если для конкретного клиента существует
	соглашение, но оно содержит пустые значения периода и максимальной доли
	возвратов, то будут использованы параметры лимита возвратов из общего
	соглашения (конечно, если они там определены).

	\item[\dlgflag{Не рассчитывать долг в документах}]
	Специализированный флаг, позволяющий избежать расчета долга по контрагенту,
	к которому относится данное соглашение, при выборе его в документе.

	Надобность в такой опции возникает исключительно редко и связана с
	тем, что контрагент используется в качестве \qu{заглушки} для большого
	числа документов. В этом случае, при вводе каждого из таких документов,
	если данный флаг не установлен, возникает значительная задержка
	из-за расчета долга по всем предыдущим документам этого контрагента.

	\item[\dlgflag{В документы добавлять только товары, имеющие код по статье}]
	Если этот флаг установлен, то в товарные документы, основной статьей
	которых является статья-владелец данного соглашения, нельзя добавить
	строку, соответствующую товару, который не имеет кода, связанного с
	данной статьей.

	Подробно об ограничениях на добавление товара в товарный документ
	рассказано на стр.~\pageref{sec-goodsbill-restrictions}.

	\item[\dlgbutton{Долговые ограничения}]
	Кнопка открывает список долговых ограничений, ассоциированных с долговыми
	размерностями. Тему долговых размерностей мы раскроем ниже.

	\item[\dlgbutton{Документы}]
	Кнопка, позволяющая увидеть документы по контрагенту, которому соответствует данное
	соглашение.

\end{description}

%endtopic

\subsection{Долговые размерности}

Выше, обсуждая аналитические статьи и соглашения с покупателям, мы увидели, что менеджмент
предприятия имеет различные инструменты для управления дебиторской задолженностью, а именно:
кредитный лимит, признак STOP, срок оплаты.

В случае, если необходимо диверсифицировать ограничения дебиторской задолженности одного
клиента, этих инструментов может оказаться не достаточно.

\ppyexampletitle{Приведем пример}{
	На вашем предприятии организована командная система продаж при которой
	каждая команда торговых представителей, отвечая за свою товарную группу,
	пересекается с другими командами при работе с одними и теми же клиентами.

	Так как команды финансово заинтересованы в максимизации продаж по своему
	направлению, то возникают внутренние противоречия в случаях, когда одна
	команда выбрала кредитный лимит клиента, не позволив, таким образом,
	другим командам продать свой товар этому же клиенту.
}

Для регулировки конфликтов, аналогичных примеру, кредитные лимиты и признаки STOP
могут быть дифференцированы для каждого клиента по, так называемым, долговым размерностям.

То есть, система предоставляет механизм формирования списка долговых размерностей,
с каждой из которых может быть связан собственный кредитный лимит и признак STOP
для любого из клиентов.

\ppynote{
	Следует обратить внимание на то, что использование долговых размерностей
	несет в себе риски значительного усложнения администрирования данных о клиентах.

	Кроме того, общая сложность системы управления дебиторской задолженностью в этом
	случае увеличивается.
}

\section{Соглашения с поставщиками\label{sec-supplagt}}

Суть соглашений с поставщиками аналогична соглашениям с клиентами. Различия - только в
деталях.

Также, как и для соглашений с клиентами, существует базовая запись для соглашений с
поставщиками. Она доступна через меню
\ppymenu{Админ\rdir Соглашения с клиентами и поставщиками\rdir Соглашение с поставщиками}.

Нам придется рассмотреть общее соглашение с поставщиками отдельно от соглашений, определенных
для конкретных поставщиков из-за того, что, в отличии от клиентских соглашений, здесь эти два
варианта значительно отличаются.

\subsection{Общее соглашение с поставщиками}

\ppypict{dlg-127}{Опции соглашения с поставщиком}

Общее соглашение с поставщиками определяет ряд конфигурационных параметров, необходимых для
использования специфических функций системы, касающихся менеджмента взаимодействия с поставщиками
товаров и услуг. Далее перечисляются эти параметры и дается краткое их описание.
Более подробно об использовании упомянутых функций системы рассказано в соответствующих разделах
настоящего руководства.

\begin{description}

	\item[\dlgcombo{Вид операции закупки}]
	Вид операции, относящийся к типу драфт-приход, и используемый для автоматического формирования
	документов закупки из отчета, строящегося на основе статистики продаж.

	\item[\dlgcombo{Вид котировки цен поставщиков}]
	Вид котировки, применяемый для установки контрактных цен по поставщикам.

	\item[\dlgcombo{Вид котировки верхней границы}]
	Вид котировки, используемый для ограничения верхнего процентного отклонения фактической цены
	поступления товара от контрактной цены.

	\item[\dlgcombo{Вид котировки нижней границы}]
	Вид котировки, используемый для ограничения нижнего процентного отклонения фактической цены
	поступления товара от контрактной цены.

	\item[\dlgradioc{При не корректной цене}]
	Этот переключатель определяет реакцию системы на отклонение фактической цены поступления
	товара от контрактной цены на величину, превышающую допустимые пределы, заданные описанными
	выше видами котировок.
	Здесь возможен один из трех вариантов:
	\begin{description}
		\item[\dlgradioi{Запрещать использование}] программа не позволяет ввести строку приходного товарного
		документа, в которой существует недопустимое отклонение от контрактной цены
		\item[\dlgradioi{Выдавать предупреждение}] программа выдаст сообщение об отклонении фактической цены
		поступления от контрактной, но не будет препятствовать вводу такой строки.
		\item[\dlgradioi{Ничего не делать}] система будет игнорировать недопустимые отклонения фактических
		цен поступления от контрактных.
	\end{description}

	\item[\dlgcombo{Тип отношения поставщик - менеджер}]
 	Зарезервированное поле. Его применение пока не реализовано.

	\item[\dlgflag{Ограничивать контрактными ценами документ закупки}]
	Если флаг установлен, то ограничения по контрактным ценам применяется не только к учетным документам прихода
	товара от поставщика, но и к документам закупки (относящимся к виду операции, заданному здесь же в dlgcombo{Вид операции закупки}).
\end{description}

\ppynote{
	Большинство параметров общего соглашения с поставщиками извлекается из базы данных во время авторизации сеанса и
	сохраняется в течении всего времени жизни сеанса. Таким образом, изменение этих параметров вступают в силу только
	для рабочих сеансов, авторизованных после внесения изменений.
}

\subsection{Частное соглашение с поставщиком}

Частное соглашение с поставщиком доступно для редактирования либо из диалога
статьи аналитического учета, к которой это соглашение привязано, либо из
таблицы статей.

Право редактирования (но не просмотра) соглашения с поставщиком, так же,
как и соглашения с клиентом, регламентируется опцией \dlgflag{Изменение соглашений}
в правах доступа по объекту \ppyrsrv{Статьи аналитического учета}.

\ppypict{dlg-ar-supplagt}{Диалог редактирования соглашения с поставщиком}

Диалог редактирования частного соглашения с поставщиком изображен на
рис.~\ref{pic-dlg-ar-supplagt}.

Вот описание его управляющих элементов:

\begin{description}
	\item[Поставщик]
	Справочное поле, отображающее наименование аналитической статьи, к которой относится
	соглашение.

	\item[Начало действия]
	Дата, с которой соглашение начинает действовать.

	\item[Срок действия]
	Дата, до которой условия соглашения действительны.

	\item[Срок оплаты (дней)]
	Если значение, установленное здесь больше нуля, то при выборе соответствующего контрагента
	в новом документе, система установит дату оплаты равной дате документа плюс указанное в этом
	поле количество календарных дней.

	Если для поставщика нет соглашения, либо в этом поле стоит нулевое значение,
	то применяется значение из общего соглашения с поставщиками.

	\item[Срок доставки (дней)]
	Поле зарезервировано для использования при автоматическом заказе
	товаров поставщику.

	\item[Max возврат (\%)]
	Поле не используется (зарезервировано для будущих применений).

	\item[\dlgcombo{Агент по умолчанию}]
	При вводе документа по контрагенту, которому соответствует это соглашение, система
	автоматически установит в документе выбранного здесь контрагента.

	Обращаем внимание, что если поле агента в документе уже заполнено, то при выборе другого
	контрагента, система не изменит текущее значение агента даже если в соглашении с новым
	контрагентом указан иной агент по умолчанию.

	\item[\dlgflag{В документы добавлять только товары, имеющие код по статье}]
	Если этот флаг установлен, то в товарные документы, основной статьей
	которых является статья-владелец данного соглашения, нельзя добавить
	строку, соответствующую товару, который не имеет кода, связанного с
	данной статьей.

	Подробно об ограничениях на добавление товара в товарный документ
	рассказано на стр.~\pageref{sec-goodsbill-restrictions}.

	\item[\dlgflag{Уменьшать себестоимость при распределении частичных структур}]
	Узкоспециализированный флаг, регулирующий особенности включения в
	документ прихода от поставщика частичных структур, некоторые компоненты
	которых уменьшают количество основного товара (например, при автоматическом
	учете отбраковки поступающих от поставщика товаров).

	Если этот флаг установлен, то себестоимость уменьшенного количества
	приходящего товара не компенсируется себестоимостью распределенных
	компонент частичной структуры.

	\item[\dlgflag{Автозаказ}]
	Если флаг установлен, то процедура автоматического расчета заказов поставщикам будет
	рассматривать данного поставщика как кандидата для формирования документа заказа. Если же флаг не установлен,
	то даже при полностью заданных параметрах автозаказа, для этого поставщика не будут создаваться документы заказа.

	\item{Список параметров автозаказа}
	Список позволяет сформулировать одно или более правил создания автоматического заказа поставщику. Каждый элемент списка
	содержит три ключевый атрибута:
	\begin{itemize}
		\item Склад
		\item Товарная группа
		\item Менеджер (зарезервировано на будущее)
	\end{itemize}
	Комбинация ключевых атрибутов уникальна для конкретного соглашения. То есть, нельзя ввести два и более правила, имеющих
	одинаковый набор этих атрибутов.

	В дополнение к ключевым, элементы списка содержат параметры, необходимые для правильного и соевременного создания документов
	заказа поставщику.

	Редактирование элементов списка мы обсудим ниже.

	\item[\dlgbutton{Опции обмена\dots}]
	Эта кнопка открывает диалог редактирования опций автоматического обмена
	данными с поставщиком.

	На текущий момент функции, использующие эти опции, находятся в разработке.

	\item[\dlgbutton{Документы\dots}]
	Кнопка, позволяющая увидеть документы по контрагенту, которому соответствует данное
	соглашение.
\end{description}

\section{Таблица просмотра статей аналитического учета\label{sec-brw-ar}}

Для доступа к таблице статей аналитического учета следует выбрать пункт меню
\ppymenu{Справочники\rdir Бухгалтерия\rdir Аналитические статьи}.

Альтернативный вариант - выбрать пункт меню
\ppymenu{Справочники\rdir Бухгалтерия\rdir Аналитические таблицы} и на требуемой
таблице нажать кнопку \dlgbutton{Статьи}.

\subsection{Фильтр таблицы просмотра статей аналитического учета}

\ppypict{dlg-f-article}{Фильтр по аналитическим статьям}

Диалог фильтра по аналитическим статьям показан на рис.~\ref{pic-dlg-f-article}.
В следующей таблице сведена информация об управляющих элементах этого диалога.

\begin{description}
	\item[\dlgcombo{Таблица аналитических статей}]
	В этом комбо-боксе следует выбрать таблицу, которой должны
	соответствовать отображаемые статьи.

	Если вы ничего не выберете здесь, то после подтверждения ввода
	фильтра увидите сообщение о том, что необходимо это сделать.

	\item[\dlgradioc{Закрыта}]
	Позволяет отфильтровать список статей по признаку \dlgflag{Закрыта}
	аналитической статьи:
	\begin{description}
		\item[\dlgradioi{Все равно}] Таблица будет игнорировать указанный признак.
		\item[\dlgradioi{Снят}] Показывает только те статьи, которые не имеют
		признака \dlgflag{Закрыта}.
		\item[\dlgradioi{Установлен}] Показывает только статьи с признаком
		\dlgflag{Закрыта}.
	\end{description}

	\item[\dlgradioc{Стоп}]
	Позволяет отфильтровать список статей по признаку \dlgflag{Стоп}
	аналитической статьи:
	\begin{description}
		\item[\dlgradioi{Все равно}] Таблица игнорирует признак \dlgflag{Стоп}.
		\item[\dlgradioi{Снят}] В таблице будут отображаться только те статьи,
		для которых указанный признак не установлен.
		\item[\dlgradioi{Установлен}] Система при выводе списка статей будет
		показывать только те из них, для которых признак \dlgflag{Стоп} включен.
	\end{description}

	\item[\dlgflag{Показывать соглашения}]
	Если флаг включен, то в таблице будут отображаться поля,
	соответствующие соглашениям с клиентами (поставщиками), связанным
	со статьями.

	Эта опция значительно упрощает администрирование соглашений.

	\item[\dlgflag{Проверять корректность статей}]
	Специальная опция при включении которой система перед тем, как
	показать статьи по выбранным критериям, проверит каждую из них
	на непротиворечивость и выдаст колонку с диагностическими сообщениями
	для тех статей, в которых обнаружены проблемы.

	Необходимость в этом флаге может возникнуть лишь в крайних
	случаях, когда существуют подозрения на предмет некорректности
	ссылок статей на связанные объекты.

	Заметим, что обсуждаемая функция не пытается самостоятельно
	что-либо менять в базе данных. Таким образом, ее использование
	абсолютно безопасно.

	\item[\dlgradioc{Сортировка}]
	Дает возможность выбрать один из следующих вариантов сортировки статей:
	\begin{description}
		\item[\dlgradioi{По наименованию аналитической статьи}]
		\item[\dlgradioi{По номеру аналитической статьи}]
		\item[\dlgradioi{По идентификатору аналитической статьи}]
	\end{description}
\end{description}

\ppypict{brw-028}{Таблица статей аналитического учета}

\subsection{Действия в таблице аналитических статей}

	\paragraph{Редактировать}\indent\keyb{Enter}
	Вызывает диалог редактирования статьи.

	Функция доступна только если пользователю предоставлено право
	\dlgflag{Модификация} по объекту \ppyrsrv{Статьи аналитического учета}.

	\paragraph{Добавить}\indent\keyb{Insert}
	Вызывает диалог для создания новой статьи.

	Если таблица, к которой относится статья, задает связь с
	какими либо объектами данных, то предварительно система
	просмотрит список таких объектов с целью найти какой либо
	из них, не связанный ни с какой статьей этой таблицы.

	Если такой объект обнаружен, то пользователю будет предложено
	создать новую статью и ассоциировать ее с найденным объектом.

	Функция доступна только если пользователю предоставлено право
	\dlgflag{Создание} по объекту \ppyrsrv{Статьи аналитического учета}.

	\paragraph{Создать группирующую папку}\indent\keyb{Ctrl-A}
	Экспериментальная функция. Не рекомендуется использовать.

	\paragraph{Удалить}\indent\keyb{Delete}
	Пытается удалить выбранную статью (после того, как пользователь подтвердит
	свой выбор этой функции).

	Если существуют документы или какие-то иные объекты, ссылающиеся на
	выбранную статью, то система не сможет удалить статью и выдаст сообщение
	об ошибке.

	Функция доступна только если пользователю предоставлено право
	\dlgflag{Удаление} по объекту \ppyrsrv{Статьи аналитического учета}.

	\paragraph{Массовое изменение выборки}\indent\keyb{Ctrl-F8}
	Реализует массовое удаление все выборки сатей либо массовое изменение некоторых параметров
	для всех статей выборки.

	Подробности этой функции описаны ниже (см.~\pageref{sec-armassupdparam}).

	\paragraph{Связный объект}\indent\keyb{F2}
	Открывает диалог редактирования связанного объекта. Если статья связана с
	персоналией, то откроется диалог редактирования персоналии, если - со складом,
	то откроется диалог редактирования склада.

	Если статья не связана с каким-либо объектом, то ничего не произойдет.

	Функция доступна только если пользователю предоставлено право
	\dlgflag{Модификация} по соответствующему объекту данных.

	\paragraph{Документы по статье}\indent\keyb{F3}
	Показывает таблицу документов, в которых контрагентом значится %
	выбранная статья.

	На показанную выборку документов влияют ограничения прав доступа
	по периоду доступа к документам и по доступным видам операций.

	\paragraph{Соглашение}\indent\keyb{F4}
	При выборе этой команды на экране появится диалог редактирования %
	соглашения с клиентом/поставщиком (в зависимости от настройки
	таблицы аналитических статей, к которой относится выбранная статья).

	Функция доступна только если пользователю предоставлено право
	\dlgflag{Изменение соглашений} по объекту \ppyrsrv{Статьи аналитического учета}.

	\paragraph{Котировки}\indent\keyb{Ctrl-Q}
	Показывает товарные котировки, соответствующие выбранной статье.

	Если таблица статей предполагает использование соглашений с поставщиками,
	то система покажет контрактные цены по выбранной статей.

	\paragraph{Товары, связанные со статьей кодом}\indent\keyb{F5}
	Открывает таблицу товаров, которые имеют код, связанный с выбранной
	аналитической статьей.

	Подробное описание таблицы товаров см. на стр.~\pageref{sec-ppview-goods}.

	\paragraph{Системный журнал}\indent\keyb{Ctrl-J}
	Показывает системные события по выбранной статье.

	\paragraph{Передать выборка статей}\indent\keyb{Ctrl-H}
	Передает выборку, представленную в таблице, в другой раздел базы данных.

	\paragraph{Печать}\indent\keyb{F7}
	Отправляет статьи из выборки, представленной в таблице, на печать.

	Здесь используются следующие стандартные формы отчетов:
	\begin{description}
		\item[ArtclViewWCliAgt] Если выбран просмотр статей с соглашениями и
		для выбранной таблицы статей применяются соглашения с покупателями.
		\item[ArtclViewWSpplAgt] Если выбран просмотр статей с соглашениями и
		для выбранной таблицы статей применяются соглашения с поставщиками.
		\item[ArtclView] Во всех остальных случаях.
	\end{description}

	\paragraph{Фильтр}\indent\keyb{Ctrl-V}
	Позволяет изменить фильтр просмотра статей.

\subsubsection{Массовое изменение выборки статей\label{sec-armassupdparam}}

\ppypict{dlg-armassupdparam}{Диалог массового изменения выборки статей}

Массовое изменение выборки статей позволяет либо удалить всю выборку, либо изменить некоторые ее параметры.
Диалог, предшествующий выполнению функции, изображен на рис.~\ref{pic-dlg-armassupdparam}.

\begin{description}
	\item[\dlgradioc{Действие}]
	Селектор, позволяющий выбрать конкретное действие. Это либо \dlgradioi{Изменить параметры выборки} либо
	\dlgradioi{Удалить всю выборку}.

	\item[\dlgflag{Создавать соглашение, если нет}]
	Если флаг установлен, то при изменении выборки, если какой-либо изменяемый параметр относится к соглашению,
	и статья не имеет соответствующего соглашения, то такое соглашение для статьи будет создано.

	Если флаг не установлен, то параметры, относящиеся к соглашениям, меняются лишь для тех статей, которые
	уже имеют соглашение.

	\item[Срок оплаты, дней]
	Параметр для изменения. Относится к соглашению с поставщиком либо с покупателем.

	Срок оплаты за отгруженный (поставленный) товар (услугу) в днях.

	\item[Срок доставки, дней]
	Параметр для изменения. Относится к соглашению с поставщиком.

	Срок доставки заказанного товара в днях.
\end{description}

Для выполнения функции пользователь должен иметь права на массовое изменение выборки статей.
Кроме того, для выполнения массового удаления пользователь должен иметь права на удаление статей, а при
выполнении массового изменения - на изменение статей.

\section{Процессинг должников\label{sec-debtrate}}

Функция процессинга должников предназначена для автоматической массовой обработки
списка статей аналитического учета с целью изменения или проверки каких-либо
из их параметров.

Функция работает начиная с релиза системы 5.9.9 и поддерживает на текущий
момент вариант автоматической установки и снятия признака СТОП в зависимости
от наличия просроченной задолженности.

Доступ к функции осуществляется посредством меню \ppymenu{Админ\rdir Разное\rdir Процессинг должников}.

Кроме этого, функция может быть адресована для выполнения по расписанию JobServer'у.

\subsection{Как это работает?}

Процессинг должников работает следующим образом:

система просматривает все статьи по выбранной таблице статей и для каждой рассчитывает
сумму долга и максимальное значение просроченности платежа в днях.

Просроченным считается документ, не оплаченный полностью до даты оплаты, указанной
в этом документе. Количество дней просроченности считается до текущей системной даты.

Если просроченность превышает заданную в параметрах величину гандикапа, то система
проверяет нет ли у контрагента незачтенных платежей.

Если величина незачтенных платежей меньше величины долга, то на статью должника
устанавливается признак СТОП. В противном случае (если нет просроченности, превышающей
гандикап или сумма незачтенных платежей равна либо превышает сумму долга) признак СТОП
снимается со статьи (если он для нее установлен).

В параметрах процессинга может быть установлен флаг, согласно которому фактическое
изменение признака СТОП не происходит, но лишь выдается сообщение о том, что это следует
сделать.

\subsection{Как получить информацию о том, что процесс сделал?}

Если функция запускается в ручном режиме (через меню, но не средствами JobServer'а), то
во время ее работы на экране в журнале сообщений появляется информация о ходе процесса.

По завершению работы все сообщения сбрасываются в текстовый файл LOG/PPINFO.LOG.

Если процессинг запускается сервером, то информация доступна только посредством
последующего просмотра этого файла.

При изменении признака \ppyrsrv{СТОП} в системный журнал заносятся события:
\begin{itemize}
	\item На аналитическую статью установлен флаг \ppyrsrv{СТОП}.
	\item С аналитической статьи снят флаг \ppyrsrv{СТОП}.
\end{itemize}

Таким образом, в системном журнале вы сможете увидеть на какие статьи признак
СТОП был установлен, а с каких снят.

\subsection{Параметры запуска процессинга должников\label{loc-debtrate-param}}

\ppypict{dlg-debtrate}{Диалог редактирования параметров процессинга должников}

Диалог параметров запуска процессинга должников показан на рис.~\ref{pic-dlg-debtrate}.
Здесь присутствуют следующие управляющие элементы:

\begin{description}
	\item[\dlgcombo{Таблица статей}]
	Таблица аналитического учета, по статьям которой следует проводить процессинг.

	По умолчанию система устанавливает сюда таблицу покупателей, извлекаемую
	из общей конфигурации.

	\item[Гандикап (дней)]
	Количество дней просроченности платежа, которое система будет считать допустимым.
	То есть, если у клиента есть документ с просроченной оплатой (на текущий день) в
	3 дня и обсуждаемый параметр равен трем дням, то будет считаться, что у клиента
	задолженность находится в допустимых рамках.

	\item[\dlgflag{Только отчет}]
	Если этот флаг установлен, то система не будет устанавливать или снимать признак
	СТОП для статей, но лишь выдавать сообщения в журнал.

	Этот флаг установлен по умолчанию.

	\item[\dlgflag{Информировать об отсутствии клиентского соглашения}]
	Если этот флаг включен, то в журнал сообщений будет выводиться информация о
	том, что для какой-либо статьи не определено клиентское соглашение.

	\item[\dlgflag{Учитывать максимальный кредит по соглашению}]
	Установка этого флага приведет к тому, что для дебиторов, которые не имеют
	просроченной задолженности (с учетом гандикапа, естественно), но имеют общую
	сумму задолженности, превышающую максимальный кредит, определенный в соглашении,
	будет включаться признак СТОП.

	Заметим, что в рассмотрение принимается только частное соглашение с кредитором (если
	оно есть). Сумма максимального кредита, определенная в общем соглашении с покупателями
	не учитывается.

	\item[\dlgflag{Собрать статистику по дебиторам}]
	Флаг предписывает системе собрать статистику платежей по дебиторам
	для расчета и анализа рейтингов дебиторов.

	Подробно тема рейтингов дебиторов описана в специальном разделе (стр.~\pageref{sec-debtorstat}).

	\item[\dlgflag{Собрать статистику по агентам}]
	Эта опция действительна только для расчета статистики по дебиторам.
	Если флаг включен, то будет собрана статистика
	по торговым агентам.

	Так как эта статистка агрегированная (суммирует данные по множеству
	документов, относящихся к разным дебиторам), то рейтинги и кредитные
	лимиты по агентам не рассчитываются.

	\item[\dlgflag{Установить кредитный лимит в соглашениях}]
	Как и предыдущая, эта опция действительна только для расчета
	статистики по дебиторам.

	Установка переключателя приведет к тому, что система занесет
	рассчитанные кредитные лимиты в соглашения по клиентам.

	Здесь есть следующие нюансы:
	\begin{itemize}
		\item Кредитные лимиты заносятся только в существующие соглашения.
		То есть, если аналитическая статья до запуска процессинга не имела
		собственного соглашения, то и кредитный лимит для нее установлен не
		будет.
		\item Если в этом диалоге установлен флаг \dlgflag{Только отчет},
		то в базе данных ничего изменено не будет, но программа выдаст
		подробный отчет (в окне и файле журнала), в котором будет
		сообщено как, где и почему следует установить кредитные лимиты
		(такой отчет создается и при \qu{физической} установке
		лимитов, но только в нем не присутствует слово \qu{следует}).
		\item Автоматическая установка кредитного лимита для конкретной
		статьи может быть временно заблокирована указанием даты,
		до которой такая блокировка действует в соглашении с клиентом
		(см. стр.~\pageref{item-cliagt-LockPrcBefore}).
	\end{itemize}

	\item[\dlgflag{Изменять лимит по долговым размерностям}]
	Эта и следующие три опции относятся к технике разделения кредитных лимитов и
	STOP-признаков по долговым размерностям.

	Если данный флаг включен, то функция процессинга будет автоматически
	рассчитывать и устанавливать кредитные лимиты по долговым размерностям
	клиентов. Обратим внимание на то, что без установки флага \dlgflag{Создавать лимит и STOP по долговым размерностям}
	описанного ниже, данная опция обеспечивает расчет и установку лимита только
	для элементов размерностей, которые уже существуют в клиентском соглашении.

	\item[\dlgflag{Создавать лимит и STOP по долговым размерностям}]
	Если флаг установлен, то, при расчете кредитных лимитов и признаков STOP
	по долговым размерностям клиента, процессинг будет создавать соответствующие
	размерности в соглашении с клиентом, если это необходимо.

	\item[\dlgflag{Изменять STOP по долговым размерностям}]
	Этот флаг предписывает процессингу должником пересматривать признаки STOP,
	ассоциированные с долговыми размерностями клиентских соглашений.

	\item[\dlgflag{Проецировать общий STOP на долговые размерности}]
	Специальная опция, обеспечивающая автоматическую проекцию признака STOP
	из записи аналитической статьи на долговую размерность клиентского соглашения.

	Суть этого флага будет понятна из дальнейших объяснений.
\end{description}

\chapter{Операционные справочники\label{ch-ref-oper}}

Операционные справочники содержат наборы правил обработки данных, вводимых пользователем в
разделе \qu{Операции}.

Все наборы правил классифицированы и объединены в группы, называемые типы операций.
Примерами типов операций могут служить: бухгалтерская проводка, приход
товара, расход товара.

В свою очередь каждый тип операций является основой для формирования  более простых
наборов правил, носящих название вида операций. Примерами видов операций относящихся
к типу расход товара, можно назвать отпуск за наличный расчет, отпуск покупателю,
отпуск товара на сырье.

\section{Типы операций}

Как уже было сказано, типы операций являются основой для формирования видов операций. Все
типы операций в системе зарезервированы. Не следует добавлять новые или удалять существующие
записи в справочнике типов операций, поскольку система \qu{понимает} только изначально
установленные значения. Приведем список и краткую характеристику этих типов операций.

\paragraph{Бухгалтерская проводка}
	Является основой для определения бухгалтерских видов операций. Сюда включаются общие
	бухгалтерские проводки, расширенные бухгалтерские документы, платежные поручения,
	авансовые отчеты и пр.

	Подтипы:
	\begin{description}
		\item[Стандарт] общая или расширенная бухгалтерская проводка
		\item[Авансовый отчет] многострочный документ авансового отчета
		\item[Регистровая проводка] общая бухгалтерская проводка по регистровым счетам
		\item[Доверенность] документ доверенности на получение товарно-материальных ценностей.
		\item[Инвентаризация задолженности] многострочный документ инвентаризации дебиторской
		(кредиторской) задолженности.
		\item[Списание по счетам] документ, позволяющий автоматически сформировать
		бухгалтерские проводки списания по счетам, осуществляемого в конце отчетного периода.

		В синтаксисе формул шаблонов проводок такой операции могут присутствовать
		элементы определителей счетов DL200.
	\end{description}

\paragraph{Приход товара}
	Тип, используемый как основа приходных товарных операций.

	Подтипы:
	\begin{description}
		\item[Стандарт] общий документ товарного прихода
		\item[Приобретение основных средств] документ прихода основных средств.
	\end{description}

\paragraph{Расход товара}
	Обычно операции, имеющие этот тип, используются для различных способов продажи и списания
	товаров. Важным способом использования этого типа являются операции внутренней передачи
	товаров между складами.

\paragraph{Возврат товара}
	Виды операции с этим типом обычно ссылаются на связанную операцию прихода или расхода
	товара. В зависимости от того, кто возвращает кому товар: вы поставщику либо клиент вам.

	Внутренние перемещения товаров не должны иметь этот тип.

\paragraph{Оплата}
	Операции этого типа, как и в предыдущем случае, имеют ссылку на товарную либо бухгалтерскую
	операцию, которую следует оплачивать. Документы, относящиеся к операциям этого типа предназначены
	для оплаты документов с отсрочкой платежа.

\paragraph{Драфт-операции}
	Класс, включающий три типа:
	\begin{itemize}
		\item Драфт-приход
		\item Драфт-расход
		\item Драфт-транзит
	\end{itemize}

	Операции, относящиеся к этому классу, позволяют вводить товарные документы, которые
	никак не отражаются на текущем учете (не изменяют товарных остатков и не формируют
	бухгалтерских проводок). Драфт-документы могут быть преобразованы в настоящие (учетные)
	документы, относящиеся к типам операций \ppyrsrv{Приход товара} и \ppyrsrv{Расход товара}.

	\begin{enumerate}
		\item Драфт-приход отражает поступление товара на склад.
		\item Драфт-расход отражает расход товара со склада.
		\item Драфт-транзит - специальный тип, предназначенный для хранения в базе данных документов,
		не относящихся к учету предприятия или предприятий, за которые отвечает эта база данных.

		Основное назначение документов типа драфт-транзит - управление документооборотом сторонних
		предприятий.
	\end{enumerate}

	Подтипы:
	\begin{description}
		\item[Стандарт] общие драфт-документы
		\item[План закупок] специализированные документы торговых планов. Это могут быть как
		планы закупок, так и планы продаж. В отличии от общих драфт документов, торговые планы
		нельзя списывать. Вместо списания таких документов система рассчитывает сравнительное
		фактическое выполнение торгового плана.
	\end{description}

\paragraph{Переоценка}
	Этот тип служит для определения видов операций переоценки, изменяющих цены лотов.

	Благодаря операциям переоценки можно избежать проблем, связанных с расхождением
	отчетных данных за различные периоды деятельности предприятия.

	Подтипы:
	\begin{description}
		\item[Стандарт] общий документ переоценки
		\item[Ввод основных средств в эксплуатацию] согласно наименованию, этот подтип
		позволяет определить вид операции ввода основных средств в эксплуатацию.

		Использование таких документов необходимо, если на вашем предприятии
		применяются основные средства, ввод в эксплуатацию которых отстает по времени
		от их поступления.
	\end{description}

\paragraph{Модификация товаров}
	Операции типа модификации являются гибридом приходных и расходных операций. Их основное
	назначение - комплектация, декомплектация и другие преобразования одних товаров в другие.

	Подтипы:
	\begin{description}
		\item[Стандарт] общий документ модификации товаров
		\item[Модификация основных средств] обычно (но не только), рекомплектация основных
		средств.
	\end{description}

\paragraph{Корректирующий документ}
	Тип операций, к котором относятся документы корректировки приходов. Корректирующие
	документы являются довольно сложной комбинацией переоценки и движения товаров.
	Любой корректирующий документ обязательно должен быть связан с соответствующим
	документа товарного прихода, который он корректирует.

\paragraph{Заказы}
	Этот тип предназначен для определения операций заказа товаров клиентами.

\paragraph{Инвентаризация}
	Тип, определяющий операции инвентаризации, предназначенные для ввода результатов пересчета
	остатков товаров и списания различий между фактическими и учетными значениями этих
	остатков.

\paragraph{Начисление}
	Документы начисления предназначены для фиксации факта возникновения платежных обязательств
	дебиторов перед вашим предприятием либо вашего предприятия перед кредиторами.

	Как правило, документы этого типа должны требовать оплату.

	Система позволяет организовать автоматическое начисление по некоторым специально настроенным
	документам.

\paragraph{Обобщение}
	Обобщение не является в полном смысле слова операцией. Этот тип позволяет создавать
	операции-контейнеры, объединяющие несколько операций для получения отчетности и прочих
	целей.

\paragraph{Подтверждение}
	Специализированный тип операций, служащий для создания документов подтверждения отгрузки
	или приема товарных документов.

	Характерным примером использования этого типа операций может служить деятельность
	связанная с продажей товаров по которым могут возникать значительные расхождения во
	мнении между поставщиком и покупателем по составу и качеству переданной спецификации,
	как то: лесопродукции или другого сырьевого сортимента.

	Документы подтверждения обычно привязываются к соответствующим документам отгрузки или
	приемки товаров.

\paragraph{Пулы документов}
	Документы этого типа используются для объединения каких-либо иных документов. При этом пул
	документов можно использовать аналогично любому другому документу. По нему ведутся итоговые
	суммы, его можно оплачивать, печатать и т.д. Одновременно, документы, объединенные в пул
	продолжают существовать сами собой.

	Виды операций, имеющие этот тип характеризуются рядом параметров и ограничений, позволяющими
	четко специфицировать характер документов, объединяемых таким пулом.

\section{Виды операций\label{sec-oprkind}}

Вид операции определяет семейство конкретизированных хозяйственных транзакций предприятия.

\subsection{Таблица видов операций}

Перечень определенных в базе данных видов операций доступен через пункт
меню \ppymenu{Справочники\rdir Операции\rdir Виды операций}.

\subsubsection{Фильтр таблицы видов операций}

\ppypict{dlg-f-oprkind}{Диалог фильтра видов операций}

Диалог фильтра таблицы видов операций показан на рис.~\ref{pic-dlg-f-oprkind}.
Вот описание управляющих элементов этого диалога:

\begin{description}
	\item[\dlgcombo{Тип операции}]
	Позволяет отобрать в списке только виды операций, относящиеся к заданному типу.

	\item[\dlgcombo{Таблица объектов}]
	Ограничивает выборку видов операций только теми, чья основная таблица
	объектов равна заданной в этом комбо-боксе.

	\item[\dlgflag{Пассивные}]
	Установка этого флага предписывает системе показывать только пассивные операции.

	\item[\dlgflag{Зачетные}]
	При установке этого флага в выборку попадут только операции, имеющие признак
	\dlgflag{Зачетная}.

	\item[\dlgflag{Доходные}]
	Ограничит выборку только теми видами операций, которые имеют признак
	\dlgflag{Доходная}.

	\item[\dlgflag{Требующие оплаты}]
	Предписывает системе показывать только те виды операций, для которых
	установлен флаг \dlgflag{Требует платежного документа}.

	\item[\dlgflag{Использовать ранг при сортировке}]
	Если этот флаг установлен, то при сортировке списка будет учитываться ранг операции.
	То есть, сначала операции в таблице сортируются по рангу, а затем по критерию,
	заданному в блоке \dlgradioc{Сортировать по}.

	Флаг по умолчанию установлен.

	\item[\dlgradioc{Сортировать по}]
	Определяет порядок сортировки списка видов операций.

\end{description}

\subsubsection{Действия в таблице видов операций}

\paragraph{Редактировать}\indent\keyb{Enter}
Открывает диалог редактирования для выбранного вида операции.

\paragraph{Добавить}\indent\keyb{Insert}
Открывает диалог создания нового вида операции. Непосредственно
пред появлением диалога редактирования у
пользователя запрашивается к какому типу должна относится новая операция.

\paragraph{Удалить}\indent\keyb{Delete}
Удаляет выбранную запись вида операции.

\paragraph{Добавить по образцу}\indent\keyb{Alt-F2}
Позволяет создать новый вид операции по образцу выбранного.

\paragraph{Связанные операции}\indent\keyb{Alt-F3}
Открывает таблицу просмотра видов операций, связанных с текущей.

\paragraph{Документы по операции}\indent\keyb{F3}
Открывает таблицу просмотра документов по выбранному виду операции.
Все опции фильтрации документов пусты кроме вида операции.

\paragraph{Печать}\indent\keyb{F7}
Отправляет список операций на печать либо на экспорт.

Стандартная форма отчета: \ppyrsrv{OprKindList}.

\paragraph{Фильтр}\indent\keyb{Ctrl-V}
Позволяет изменить опции фильтрации текущей выборки.

\subsection{Диалог редактирования вида операции}

\ppypict{dlg-oprkind-w}{Вид операции}

Вид типичного диалога редактирования вида операции показан на рис.~\ref{pic-dlg-oprkind-w}.
Обратим внимание на то, что для некоторых типов операций диалог редактирования может
значительно отличаться от приведенного (например, для операций инвентаризации).

Далее подробно описываются различные атрибуты видов операций.

\begin{description}
	\item[Наименование]
	Наименование операции представляет из себя строку, отражающую смысл операции, понятный тем,
	кто эту операцию использует. Название  должно быть уникальным. В системе не может быть
	двух и более видов операций с одним и тем же названием

	\item[Символ]
	Символьный код вида операции, используемый для ссылки на документы этого вида
	из формул, через внешние интерфейсы и т.д.

	\item[Тип операции]
	Тип операции выбирается при добавлении нового вида операции и не может быть изменен в
	дальнейшем.

	Данных атрибут определяет поведение документов этого вида. Каждый вид операции принадлежит
	одному и только одному типу.

	\item[Идентификатор операции]
	Этот параметр доступен только для просмотра. Для уже существующей операции его нельзя
	изменить. Идентификатор используется системой для внутренних целей.

	\item[Шаблон кодировки и счетчик]
	Эти два параметра определяют способ нумерации документов, принадлежащих данному виду
	операции. Шаблон кодировки - это строка следующего вида:

	$prefix\%number$

	где $prefix$ символьный префикс номера документа, а $\%number$ -
	это шаблон нумерации ($number$ - число знаков в цифровой части номера, если это значение
	начинается с нуля, то номер документа будет выравниваться до заданного числа символов
	нулями). Проще всего продемонстрировать использование шаблона на примерах.

	\ppyexampletitle{Примеры шаблонов нумерации документов}{
		\begin{description}
			\item[ПР\%05] результирующие номера документов будут иметь вид: ПР00001, ПР00234 и т.д.
			\item[\%6] результирующие номера будут иметь вид:  000001, 000234 и т.д.
			\item[Б/Н] все результирующие номера будут иметь вид Б/Н.
		\end{description}
	}

	Счетчик кодировки увеличивается на единицу с каждым новым документом. Если вы хотите,
	чтобы порядок нумерации изменился, то есть начался бы с иного чем в данный момент номера,
	то установите счетчик в значение на единицу меньшее, чем то, которое должно присутствовать
	в следующем вводимом документе.

	\ppynote{
		Сплошной порядок нумерации документов может быть нарушен в том случае, когда уже
		введенный документ был удален, либо тогда, когда в сети один человек начал новый документ,
		вслед за ним новый документ того же вида операции начал другой человек, и, затем, первый
		отказался от ввода документа.
	}

	Вы можете обнулить все счетчики по всем операциям через пункт меню \ppymenu{Справочники\rdir
	Операции\rdir Сбросить счетчики операций}.

	\item[Таблица объектов]
	Параметр, определяющий таблицу аналитических статей, связанную с видом операции.

	Так, например, для операции прихода товара от поставщика такой таблицей будет
	\ppyrsrv{Поставщики}.

	Для операции оплаты от покупателя через расчетный счет таблицей объектов может быть таблица
	банков.

	Таблица объектов - очень важный параметр. Он является определяющим для целого ряда
	признаков документа. Если операция принадлежит типу \ppyrsrv{Расход товара}, а в качестве
	таблицы объектов при этом задана таблица складов, то такая операция становится межскладским
	перемещением товара, очень сильно отличающимся, скажем, от отпуска товара покупателю,
	который также принадлежит типу \ppyrsrv{Расход товара}.

	\item[Дополнительная таблица объектов]
	Дополнительная таблица объектов позволяет вводить в документах дополнительную статью
	аналитического учета. Эта возможность требуется не часто и определяется специфическими
	потребностями на конкретном предприятии. В большинстве случаев это поле следует оставлять
	пустым.

	\item[Связанная операция]
	Данный параметр имеет существенное значение лишь для некоторых типов операций, а именно,
	для возврата товара, оплаты, начисления и др.

	Документы, относящиеся к этим типам, привязываются к документам, имеющим вид
	связанной операции.

	Например, оплата от покупателя может быть привязана к отпуску товаров покупателю.

	Еще один пример: если вид операции \qu{Возврат} ссылается на вид \qu{Приход товара},
	это значит, что при возврате конкретного товара, документы возврата будут содержать ссылки
	на приходные документы, оформленные при оприходовании этого товара.

	\item[\dlgcombo{Статус новых документов}]
	Если здесь выбрано какое-либо значение, то новые документы, принадлежащие этому
	виду операции, будут получать такой статус.

	Если поле оставить пустым, то новые документы будут получать статус, определенный в
	конфигурации документов.

	Подробнее о статусах документов см. стр.~\pageref{sec-billstatus}

	\item{\dlgflag{Пассивная операция}}
	Если флаг включен, то вид операции не будет отображаться в списках выбора. В остальных
	аспектах объект ведет себя так же как и операции, не имеющие такого флага.

	\item{\dlgflag{Зачетная операция}}
	Опция, позволяющая определить документы этого вида как зачетные. Флаг работает вместе
	с кнопкой \dlgbutton{Зачет}. Подробно настройка зачетных операций описана на стр.~\pageref{sec-op-reckon-config}.

	\item[Список опций]
	При нажатии кнопки \dlgbutton{Опции} перед вами откроется диалог установки дополнительных
	атрибутов вида операции. Диалог содержит группу переключателей, группу флажков, строку
	наименования дополнительного объекта и строку примечаний.

	При помощи переключателей задается вид номинальной суммы проходящей по документу. В системе
	предусмотрены три варианта установки номинальной суммы: в ценах поступления, в ценах
	реализации и явно не определена.

	Если задается сумма в ценах поступления, это значит, что вводимая в документе сумма отражает
	цену поступления товара.

	Соответственно сумма в ценах реализации будет отражать в документе цену реализации товара.
	По умолчанию системой устанавливается номинальная сумма - явно не определенная. Это означает,
	что система самостоятельно по косвенным признакам устанавливает номинальную сумму.
	Рекомендуется в товарных документах всегда явно указывать вид номинальной суммы.
	При помощи флажков можно задать дополнительные атрибуты вида операции.

	Далее подробно описывается каждая из опций. После наименования опции следует список типов
	операций, для которых эта опция применима и лишь за тем приводится описание.

	\begin{description}
		\item[\dlgflag{Требует платежного документа}]
		Этот флаг указывает, требуют ли документы такого вида оплаты. Если да, то по этим документам
		учитывается сумма оплаты и долга. Если этот флаг установлен, то следует завести один или
		несколько связанных видов операции с типом \ppyrsrv{Оплата}.

		\begin{itemize}
			\item Бухгалтерская проводка
			\item Драфт-приход
			\item Драфт-расход
			\item Товарный заказ
			\item Оплата (начисление по ренте)
			\item Переоценка
			\item Приход товара
			\item Расход товара
		\end{itemize}

		\item[\dlgflag{Доходная операция}]
		Если этот флаг установлен, то документ такого вида учитывается при получении отчетности
		как доходный. То есть, если документ расходует товар, то разница между суммами реализации
		и поступления считается положительным доходом. Если в результате операции товар приходуется,
		то доход отрицательный. Система умеет рассчитывать доходность операций по оплате (если
		операция оплачиваемая). В этом случае доход считается исходя из оплаченной суммы.

		\begin{itemize}
				\item	Бухгалтерская проводка
				\item Оплата (начисление по ренте)
				\item Драфт-расход
				\item Драфт-приход
				\item Расход товара
				\item Приход товара
				\item Переоценка
				\item Модификация
				\item Возврат
		\end{itemize}

		\item[\dlgflag{Продажа по заказу}]
		Данных флаг, если установлен, то дает возможность продавать этой операцией товар в зачет
		сделанных предварительно заказов.

		\begin{itemize}
				\item Расход товара
				\item Приход товара
		\end{itemize}

		\item[\dlgflag{Суммировать НДС и акцизы}]
		Если этот флаг установлен, то по каждому документу этого вида будут рассчитываться
		дополнительно суммы НДС и акциза. Данная возможность бывает необходима когда требуется
		настроить бухгалтерские проводки по операции таким образом, чтобы учитывались суммы НДС
		и акциза.

		Не следует устанавливать этот флаг, если нет такой необходимости, поскольку это влечет
		замедление при работе с документами.

		\begin{itemize}
			\item Возврат
			\item Товарный заказ
			\item Модификация
			\item Переоценка
			\item Приход товара
			\item Расход товара
			\item Драфт-приход
			\item Драфт-расход
		\end{itemize}

		\item[\dlgflag{Расширенная бухгалтерская проводка}]
		Этот флаг имеет значение только для операций типа \ppyrsrv{Бухгалтерская проводка}. Подробно
		обычные и расширенные бухгалтерские проводки описаны в разделе \qu{Бухгалтерские документы}.

		\begin{itemize}
			\item Бухгалтерская проводка
		\end{itemize}

		\item[\dlgflag{Договор ренты}]
		Установка этого флага позволяет дополнительно вводить в документ условия начисления %
		регулярных платежей. Такая возможность бывает необходима в случае, если вы сдаете или берете
		в аренду оборудование, помещение, находитесь на абонементном обслуживании, либо сами
		предоставляете таковое своим клиентам.

		Кроме того, условия ренты предоставляют сервис для автоматического расчета
		процентных начислений за пользование кредитом.

		\begin{itemize}
			\item Бухгалтерская проводка
			\item Расход товара
			\item Приход товара
			\item Товарный заказ
		\end{itemize}

		\item[\dlgflag{Авто WL}]
		Этот флаг определяет автоматическую установку WL-метки на новый
		документ, относящийся к этому виду операции.

		Возможности для ручного управления меткой при этом остаются в
		полном объеме.

		\begin{itemize}
			\item Бухгалтерская проводка
			\item Оплата (начисление по ренте)
			\item Драфт-приход
			\item Драфт-расход
			\item Переоценка
			\item Расход товара
			\item Приход товара
			\item Модификация
			\item Товарный заказ
			\item Возврат
		\end{itemize}

		\item[\dlgflag{Банковский платежный документ}]
		Если этот признак вида операции включен, то в документы, относящиеся к
		такому виду можно вводить информацию о платежном поручении или требовании.

		Чаще всего опция используется в специализированных видах операций, которые
		так и называются \qu{Платежное поручение}.

		\begin{itemize}
			\item Бухгалтерская проводка
			\item Оплата
		\end{itemize}

		\item[\dlgflag{Транзитная валютная операция}]
		Флаг, устанавливаемый для бухгалтерской операции, отражающей перемещение
		денежных активов между счетами с различными валютами.

		\begin{itemize}
			\item Бухгалтерская проводка
		\end{itemize}

		\item[\dlgflag{Забалансовая проводка}]
		Опция устанавливается для общих бухгалтерских проводок, в которых
		участвуют забалансовые счета либо бухгалтерские регистры (то есть,
		речь идет о проводках без корреспонденции счетов).

		\begin{itemize}
			\item Бухгалтерская проводка
		\end{itemize}

		\item[\dlgflag{Допускает строки расширения}]
		Флаг применяется для специализированных видов операций, предполагающих
		ввод множества строк на один документ.

		Основное использование - авансовые отчеты и документы доверенности.
		Соответственно, обычно операции с этим признаком имеют подтип \ppyrsrv{Авансовый отчет}
		либо \ppyrsrv{Доверенность}.

		\begin{itemize}
			\item Бухгалтерская проводка
		\end{itemize}

		\item[\dlgflag{Присоединение файлов}\label{par-opkind-attachfile-option}]
		Если этот признак установлен, то система предоставляет возможность
		привязки к документу файлов.

		К любому документу в этом случае может быть привязано любое число
		произвольных файлов.

		\begin{itemize}
			\item Бухгалтерская проводка
			\item Оплата (начисление по ренте)
			\item Драфт-расход
			\item Драфт-приход
			\item Расход товара
			\item Приход товара
			\item Переоценка
			\item Модификация
			\item Товарный заказ
			\item Возврат
		\end{itemize}

		\item[\dlgflag{Ввод информации по фрахту}]
		Флаг делает доступной кнопку \dlgbutton{Фрахт} в диалоге документа.

		В результате с документом могут быть связаны атрибуты, определяющие
		условия транспортировки товаров.

		Кроме того, документы, принадлежащие виду операции с этим признаком
		включаются в отчет по фрахту (см.~\pageref{sec-rep-freight}).

		\begin{itemize}
			\item Драфт-расход
			\item Драфт-приход
			\item Расход товара
			\item Приход товара
			\item Товарный заказ
			\item Возврат
		\end{itemize}

		\item[\dlgflag{Не изменять товарные остатки}]
		Очень специфический признак. Товарные документы, относящиеся к виду операции,
		никак не отражаются на состоянии товарных остатков.

		Одно из немногих возможных применений флага - учет долгов контрагентов, выраженных
		не в денежных единицах, а в товарных. Например, учет возвратной тары, отгруженной
		покупателям вместе с товаром.

		\ppynote{
			Ни в коем случае не устанавливайте этот флаг, если не уверены, что
			это необходимо.

			Более того, состояние этого флага нельзя менять для видов операций,
			по которым уже есть документы. Иначе вы столкнетесь со сложностями
			с этими документами.
		}

		\begin{itemize}
			\item Расход товара
			\item Приход товара
			\item Возврат
		\end{itemize}

		\item[\dlgflag{Ввод расширенной информации}]
		Игнорируется: устаревший флаг.

		\begin{itemize}
			\item Драфт-расход
			\item Драфт-приход
			\item Расход товара
			\item Товарный заказ
			\item Модификация
		\end{itemize}

		\item[\dlgflag{Не рассчитывать заказ в строках документа}]
		Эта опция предписывает системе на рассчитывать величину заказа товара в диалоге строки документа, относящегося к данному виду операции.
		Основное назначение опции - устранить задержку, возникающую при таком расчете. Целесообразность установки этого флага может быть
		обусловлена наличием значительного количества не закрытых заказов не некоторым товарных позициям.

		\begin{itemize}
			\item Драфт-расход
			\item Расход товара
			\item Товарный заказ
			\item Модификация
		\end{itemize}

		\item[\dlgflag{Выбирать только оставшиеся товары}]
		По умолчанию, при работе с документом товарного заказа, пользователь
		может отбирать товар не зависимо от того есть этот товар на текущем
		остатке или нет.

		Включение этой опции приведет к тому, что в списке выбора товаров
		при добавлении новых строк в документ, будут показаны только те номенклатурные
		позиции, которые есть на текущем остатке на складе, которому принадлежит
		вводимый документ.

		\begin{itemize}
			\item Товарный заказ
		\end{itemize}

		\item[\dlgflag{Резервирующий заказ}]
		Флаг, предписывающий системе ограничивать продажу товаров, остаток которых
		ниже, чем необходимо для удовлетворения открытых заказов с этим признаком.

		\begin{itemize}
			\item Товарный заказ
		\end{itemize}

		\item[\dlgflag{Заказ по складу}]
		Этот флаг следует установить в виде операции заказа, если
		документы этой операции используются для учета заказов, поступающих
		не от внешних покупателей, от от складов собственной организации.

		\begin{itemize}
			\item Товарный заказ
		\end{itemize}

		\item[\dlgflag{Считать отрицательной оплатой}]
		Опция предназначена для указания системе, что документ, относящийся к
		этому виду операции увеличивает сумму долга по тому документу, к
		которому привязан.

		Если выражаться проще, то речь здесь идет о схеме начислений
		сложных процентов (\qu{проценты-на-проценты}). Если этот вид операции
		является процентным начислением по ренте, то такое начисление увеличит
		сумму основного долга и следующее начисление учтет это увеличение.

		\begin{itemize}
			\item Оплата (начисление по ренте)
		\end{itemize}

		\item[\dlgflag{Только для формирования пакетов}]
		Специальный флаг.

		\begin{itemize}
			\item Расход товара
		\end{itemize}

		\item[\dlgflag{Требует расценки}]
		Признак определяет возможность (при некоторых условиях и необходимость)
		расценки цен реализации при вводе документа, относящегося к этому виду
		операции.

		\begin{itemize}
			\item Приход товара
			\item Драфт-приход
		\end{itemize}

		\item[\dlgflag{Ограничивать товарной матрицей}]

		Включение этой опции приведет к тому, что в товарные документы,
		относящиеся к этому виду операции невозможно будет вручную
		вставить товар, не относящийся к товарной матрице.

		При использовании расширенного списка выбора товара в строках
		таких документов, в списке будут отображаться только те товары,
		которые принадлежат товарной матрице, соответствующей складу,
		по которому осуществляется операция.

		Указанные ограничения коснутся только тех пользователей,
		чья конфигураций имеет установленный признак \dlgflag{Применять
		товарную матрицу}.

		\ppynote{
			Для внутренней передачи складом, по которому выбор товара
			ограничивается товарной матрицей является склад-получатель.
		}

		\begin{itemize}
			\item Драфт-расход
			\item Драфт-приход
			\item Расход товара
			\item Приход товара
			\item Товарный заказ
			\item Возврат
		\end{itemize}
	\end{description}

	\item[Дополнительный флаги]

		\item[\dlgflag{Допускать распределение частичных структур}]

		Не используется.

		\begin{itemize}
			\item Драфт-расход
			\item Драфт-приход
			\item Расход товара
			\item Приход товара
			\item Товарный заказ
			\item Возврат
		\end{itemize}

		\item[\dlgflag{Ограничивать цена реализации}]

		Если этот флаг установлен, то при вводе цены реализации в строке документа, принадлежащего
		данному виду операции, система будет следить за тем, чтобы цена не нарушала
		ценовых ограничений, определенных типом товара.

		\begin{itemize}
			\item Драфт-расход
			\item Драфт-приход
			\item Расход товара
			\item Приход товара
			\item Товарный заказ
			\item Возврат
		\end{itemize}

		\item[\dlgflag{Не привязанный возврат от покупателя}]

		Специальный признак, указывающий на то, что данная операция является не привязанным
		возвратом от покупателя. На текущий момент используется только для расчета
		лимита возвратов. То есть, если данный флаг установлен, то система считает документы,
		принадлежащие этому виду операций возвратами от покупателя.

		\begin{itemize}
			\item Приход товара
		\end{itemize}

		\item[\dlgflag{Игнорировать признак STOP у контрагента}]

		Если флаг установлен, то система не препятствует созданию документа с контрагентом,
		соответствующая аналитическая статья которого имеет установленный признак STOP.
		Подробнее о статьях аналитического учета см. стр.~\pageref{sec-ref-article}.

		\begin{itemize}
			\item Товарный заказ
			\item Драфт-расход
			\item Расход товара
		\end{itemize}

		\item[\dlgflag{Допускается отклонение документа}]
		Опция позволяет установить признак документа \ppyrsrv{Отклонен}, который используется
		для информирования контрагента, эмитировавшего документ, о том, что мы не согласны
		с этим документом. Обычно такая информация отправляется контрагенту по каналам EDI (в том числе
		через систему ЕГАИС).

		\item[\dlgflag{Автоматически генерировать UUID документа}]
		Если флаг установлен, то каждый создаваемый документ, принадлежащий этому виду операции,
		автоматически получате зарезервированный тег с уникальным значением UUID.
		Опция нужна в том случае, если при электронном обмене документами необходимо
		иметь твердый уникальный идентификатор.

		Флаг следует ставить после консультаций со специалистом, который осуществляет поддержку
		системы у вас. В общем случае, это флаг не нужен.

	\item[Подтип вида операции]

	Для некоторых типов операций в диалоге опций операции есть переключатель \dlgradioc{Подтип}. В
	зависимости от конкретного типа операции эти подтипы могут быть различными. Подтип
	позволяет задать специфические свойства документам, принадлежащим этому виду операции.

	Например, подтип \dlgradioi{Авансовый отчет} для бухгалтерского документа определяет значительно
	отличающуюся от обычных бухгалтерских документов форму и содержание документов авансовых
	отчетов.

	\item[Наименование дополнительного объекта]
	Используется в том случае, когда для вида операции задан таблица аналитических статей,
	определяющая дополнительный объект документа. Наименование дополнительного объекта служит
	ярлыком, выводимом в диалоге документа.

	\item[Строка примечания]
	Позволяет задать шаблон текста примечания, который будет всегда появляться во вновь
	создаваемых документах этого вида. Такая возможность бывает полезна, когда вы в каких-либо
	документах указываете всегда один и тот же, либо похожий текст примечания. Шаблон примечания
	может содержать псевдопеременные, отображающие некоторые параметры основного или связанного
	документа. Приведем таблицу этих псевдопеременных.

	\begin{description}
		\item[$@BILLNO$] Номер документа.
		\item[$@DATE$] Дата документа.
		\item[$@DUEDATE$] Дата исполнения документа.
		\item[$@INVOICENO$] Номер счет-фактуры, сопоставленный с документом. Если
		расширение документа не содержит номера счет-фактуры, то вместо этой пвсевдопеременной
		подставляется номер документа ($@BILLNO$).
		\item[$@INVOICEDATE$] Дата счет-фактуры, сопоставленная с документом. Если
		расширение документа не содержит даты либо содержит недопустимую дату, то
		переменная замещается основной датой документа ($@DATE$).
		\item[$@PAYDATE$] Срок платежа по документу.
		\item[$@AMOUNT$] Номинальная сумма документа.
		\item[$@LOCATION$] Наименование склада, которому принадлежит документ.
		\item[$@LOCCODE$] Код склада, к которому относится документ.
		\item[$@OBJECT$] Наименование основного контрагента документа.
		\item[$@BILLOBJ2$] Наименование дополнительного объекта документа.
		\item[$@PAYER$] Наименование плательщика по документу.
		\item[$@AGENT$] Наименование агента, с которым связан документ.
		\item[$@BILLMEMO$] Примечание к документу. Используйте эту псевдопеременную только вместе с префиксом $@LINK$.
		В противном случае программа попытается подставить примечание документа само в себя, что
		может породить довольно причудливый результат.
		\item[$@LINK$] Префикс, указывающий на то, что псевдопеременная относится к связанному документу. Этот
		префикс отделяется от основной псевдопеременной точкой.

		Например: $@LINK.BILLNO$ означает номер связанного документа.

		\item[$@RCKN$]
		Префикс, указывающий на то, что псевдопеременная относится к зачетному документу. Этот
		префикс отделяется от основной псевдопеременной точкой.

		Например: $@RCKN.BILLNO$ означает номер зачетного (платежного) документа.

		\item[$@TSESS$]
		Это ключевое слово может служить одновременно и как пвсевдопеременная и как префикс
		другой пвсевдопеременной.

		В качестве пвсевдопеременной оно означает текстовое наименование технологической сессии,
		которую списывает этот документ. Наименование состоит из наименования процессора,
		которому принадлежит технологическая сессия, номер, дату и время начала.

		Если это слово используется в качестве префикса, то далее за ней может следовать одна
		из следующих пвсевдопеременных: $@MEMO$, $@PRC$, $@TECH$.

		\item[$@CSESS$]
		Ключевое слово, позволяющее сослаться на кассовую сессию, которую списывает данный документ (если,
		конечно, он является одним из документов списания кассовой сессии).

		Аналогично $@TSESS$ эта псевдопеременная может работать как самостоятельно, так и в качестве
		префикса для доступа к атрибутам списываемой документом кассовой сессии.

		При автономном использовании переменная превращается в строку описания кассовой сессии, состояющу
		из даты, номера сессии, номера и наименования кассового узла.
		Например: 31/05/2018 - 804 - 1004 - кассы торгового зала

		Если после этого ключевого слова следует точка и другая псевдопеременная, то системы пытается
		разрешить это псевдопеременную в контексте кассовой смены. На текущий момент доступны следующие
		такие символы: $@POSNODE$.

		Пример: $@tsess.posnode$ - замещается наименованием кассового узла, к которому относится
		списываемая данным документом кассовая сессия.

		\item[$@POSNODE$]
		В контексте кассовой сессии этот символ замещается наименованием кассового узла.

		\item[$@MEMO$]
		В контексте $@TSESS.MEMO$ вместо этой переменной подставляется примечание к технологической
		сессии, которую списывает данный документ.
		В контексте документа эта пвседопеременная действует так же, как и $@BILLMEMO$.

		\item[$@PRC$]
		В контексте $@TSESS.PRC$ вместо этой пвсевдопеременной система подставит наименование
		процессора, которому принадлежит списываемая этим документом технологическая сессия.

		\item[$@TECH$]
		В контексте $@TSESS.TECH$ вместо этой пвсевдопеременной система подставит код технологии,
		которую использует списываемая этим документом технологическая сессия.

		\item[$@AGTCODE$]
		Номер соглашения с контрагентом по документу.

		\item[$@AGTDATE$]
		Дата начала действия соглашения с контрагентом по документу.

		\item[$@AGTEXPIRY$]
		Дата истечения срока действия соглашения с контрагентом по документу.

		\item[$@DLVRLOCID$]
		Идентификатор адреса доставки, установленного во фрахте документа.

		\item[$@DLVRLOCTAG.tagsymb$]
		Строковое значение тега с символом $tagsymb$ адреса доставки, установленного во фрахте документа.
		Например: @dlvrloctag.edicode выведет строку, содержащуюся в теге с символом \qu{edicode} адреса доставки документа.

		\item[$@DLVRLOCCODE$]
		Код адреса доставки, установленного во фрахте документа.

		\item[$@FGDATE$]
		Сплошное представление (без разделителей) основной даты документа в
		формате DDMMYYYY (две цифры дня месяца, две цифры номера месяца, четыре цифры года).

		\item[$@PPSYM_FGDUEDATE$]
		Сплошное представление (без разделителей) даты исполнения документа в
		формате DDMMYYYY (две цифры дня месяца, две цифры номера месяца, четыре цифры года).

		\item[$@INN$]
		Номер зарезервированного регистра кода ИНН главной организации (в контексте конкретного документа).

		\item[$@KPP$]
		Номер зарезервированного регистра кода КПП для главной организации (в контексте конкретного документа).

		\item[$@OBJINN$]
		Номер зарезервированного регистра кода ИНН контрагента по документу (если соответствующая аналитическая
		статья связана с персоналией).

		\item[$@OBJKPP$]
		Номер зарезервированного регистра кода КПП контрагента по документу (если соответствующая аналитическая
		статья связана с персоналией).
	\end{description}

	\ppyexample{
		Покажем образец использования псевдопеременных в шаблоне примечания по документу на примере
		вида операции \qu{Оплата через кассу}, связанного с операцией \qu{Отпуск покупателю}.

		При печати приходного кассового ордера по оплате часто бывает необходимо в корешке ордера
		печатать основание прихода денег. Для этого в шаблоне примечания по операции \qu{Оплата
		через кассу} введем следующую строку:

		\ppysyntax{Оплата за товар по документу №@LINK.BILLNO от @LINK.DATE}

		При вводе оплаты по документу, скажем, №00321 от 23.02.2007 сам документ оплаты будет иметь
		следующую строку примечания:

		Оплата за товар по документу №00321 от 23/02/07
	}
	\item[Ограничения комплементарности товаров в документе]
	Ограничение комплементарности в документах модификации предполагает разрешение на вставку в документ строк, соответствующих только
	двум товарам. Причем, один из товаров расходуется, а другой - приходуется. В дополнение к этому, на строки такого документа налагаются
	дополнительные условия верификации, обусловленные опциями, определенными в этом блоке флагов.

	Ограничение включается в том случае, если для вида операции определен один из следующих флагов:

	\begin{description}
			\item[\dlgflag{Принадлежность общей обыкновенной группе}]
			Оба товара в документе должны принадлежать одной обыкновенной группе. Например, если \qu{Сок вишневый} и \qu{Сок яблочный} принадлежат одной группе \qu{Сок},
			то могут быть выбраны для вставки в документ.
			\item[\dlgflag{Соответствие подстановочной структуре}]
			Каждому товару соответствует определенный набор товаров, на которые он может быть заменен. Например, "`Сок вишневый 1л"' не может быть заменен на "`Сок вишневый 0.5 л"'.
			\item[\dlgflag{Равное количество входа и выхода}]
			Количество товаров на входе должно быть равно количеству товаров на выходе.
	\end{description}


	\item[Опции печати документов]
	Кнопка \dlgbutton{Опции печати} открывает диалог задания формы печати документа. Диалог
	содержит группу радио кнопок, группу флажков, а также поле ввода имени печатной формы.

	Далее следуют подробные пояснения по каждой опции.

	\begin{description}
		\item[Как печатать]
		\item[Печать без номера документа]
		Без комментариев

		\item[Печатать колонки НДС]
		Если установлен этот флажок, то накладная по товарному документу будет содержать колонки
		с расчетом НДС и акцизов.

		\item[Товар в сертификатах]
		Список сертификатов к товарному документу будет содержать наименования товаров к которым
		относятся сертификаты. Обычно этого не требуется если список сертификатов является неотъемлемой
		частью накладной. Однако в некоторых случаях эта опция бывает полезна.

		\item[Главная организация сокращенно]
		Без комментариев

		\item[Печать цен на выбор]
		Этот флажок позволяет обойти жесткий выбор цен, в которых печатается
		товарный документ. Если этот флажок установлен, то перед печатью накладной будет предложено
		в каких ценах следует ее печатать.

		\item[Не печатать скидку]
		В товарных накладных обычно, если указана скидка на товар, информация
		об этом печатается. Если установить этот флажок, то, соответственно печататься она не будет.

		\item[Входящая счет-фактура на предоплату]

		\item[Объединять идентичные позиции]

		\item[Товарные строки в кассовом чеке]

		\item[Подставлять ExtObject вместо Object]

		\item[Печатать списка штрихкодов]

		\item[Печать сертификатов]
		Если этот флажок установлен, то будет предложено отпечатать список сертификатов качества,
		соответствующих товарам, присутствующим в документе.

		\item[Сортировка товарных строк]
		Определяет способ сортировки товарных строк в печатной форме документа:
		\begin{description}
			\item[По умолчанию]
			\item[По товару]
			\item[По группе и товару]
			\item[По штрихкоду товара]
			\item[По поставщику]
			\item[По складу]
			\item[По месту хранения и группе]
		\end{description}

		\item[Что печатать]
		Определяет набор форм, которые должны печататься для документов этого вида:
		\begin{description}
			\item[Сертификаты]
			\item[Счет-фактуру]
			Этот флажок позволяет отпечатать наряду с накладной по товарному документу также
			счет-фактуру.

			\item[Кассовый ордер]
			При установленном флажке программа предлагает наряду с накладной товарного документа
			отпечатать и кассовый ордер (приходный если товар расходуется и расходный если товар
			приходуется). Чаще всего эта опция бывает нужна тогда, когда товар продается за наличный
			расчет и покупатель одновременно с получением накладной на товар выплачивает за него наличные
			деньги.
			\item[Товарно-транспортную накладную]
			\item[Кассовый чек]
			\item[Акт выполненных работ]
			\item[Ценник]
			\item[План платежей]
		\end{description}

		\item[Печать цен в документе]
		Этот переключатель регламентирует выбор цены, которая печатается в накладных
		(или в других первичных печатных формах, производных от накладных) по товарным
		документам, принадлежащим данному виду операции.
		\begin{description}
			\item[Явно не определено]
			Если переключатель находится в этом положении программа самостоятельно примет
			решение о том, в каких ценах печатать документ.

			Мы настоятельно рекомендуем не использовать этот вариант, а выбрать
			что-то более определенное (см. ниже).
			\item[Цены поступления]
			В накладных будут печататься цены поступления документа.
			\item[Цены реализации]
			В накладных будут печататься цены реализации документа.
			\item[Поступления и реализации]
			При печать накладных будет применяться специализированная форма, в которой
			отображаются одновременно колонки цен поступления и цен реализации.
		\end{description}

		\item[Печатная форма]
	\end{description}

	\item[Дополнительные суммы]
	Система позволяет наряду с основной  суммой отражать в документе и другие суммы (например,
	НДС, скидка). Нажатие кнопки \dlgbutton{Доп. суммы\dots} открывает диалог \qu{Выбор доп. сумм
	операции}. Диалог содержит два списка и группу кнопок переноса.
	В правом списке перечислены все возможные виды дополнительных сумм. В левый заносятся те
	из них, которые в свою очередь должны быть отражены в документе.

	Полный  список дополнительных сумм приведен в справочнике системы  при обращении к пункту
	меню \ppymenu{Справочники\rdir Операции\rdir Типы сумм документа}.

\end{description}

\subsection{Шаблон бухгалтерских проводок\label{sec-accturntemplate}}

\ppypict{dlg-attmpl}{Шаблон бухгалтерской проводки}

Шаблон бухгалтерской проводки представляет собой правило формирование бухгалтерской операции
по данным документа.

Если вид операции имеет шаблоны проводок, то при вводе документа относящегося к данному
виду операций, система автоматически сформирует и заполнит соответствующие бухгалтерские
документы.

\ppyexample{
	При поступлении товара вводятся документы используя вид операции \qu{Приход товара}. Так
	как вид операции имеет шаблон бухгалтерских проводок, система не только сформирует товарные
	приходные документы, но одновременно с ними создаст и заполнит бухгалтерские документа, в
	которых будут расписаны все проводки по счетам согласно указанному шаблону.
}

Шаблон содержит следующие компоненты:

\begin{itemize}
	\item Счет и статья по дебету
	\item Счет и статья по кредиту
	\item Определители подстановки объектов
	\item Формула суммы
	\item Период действия %
	\item Флаги
\end{itemize}

\subsubsection{Счета проводок}

Каждая строка списка содержит номер дебетуемого счета, номер кредитуемого счета и флажки
фиксирования счетов.

Ввод новой строки шаблона или редактирование существующей ведется в диалоге после нажатия
соответственно кнопок \dlgbutton{Добавить} и \dlgbutton{Редакт}, расположенных под списком.
Для удаления строк используется кнопка \dlgbutton{Удалить}.

Фиксирование счета предназначено для того,  чтобы четко обозначить системе счет или статью
проведения суммы. Не зафиксированный счет или статья системой игнорируется, суммы проводятся
по счетам на усмотрение системы.

\subsubsection{Определители подстановки объектов}

Определители подстановки объектов необходимы для того, чтобы система могла
точно установить аналитические статьи (реже, счета), которые должны участвовать
в бухгалтерской проводке.

Так, возвращаясь к приведенному выше примеру с поступлением товара от поставщика,
очевидно, что формируя шаблон, вы не можете точно знать от какого поставщика и на
какой склад будет поступать товар так как эти значения меняются от документа к документу.
В то же время, бухгалтерские проводки, формируемые по таким документам должны включать
в себя соответствующую аналитику.

Вот что происходит, когда система формирует бухгалтерскую проводку по документу на
основе шаблона:
\begin{itemize}
	\item Извлекается из шаблона счет по дебету.
	\item Если этот счет в шаблоне не имеет признака зафиксированной статьи,
	но при этом сам счет ссылается на таблицу аналитического учета, то
	система смотрит на определители подстановки.
	\item Если один из определителей имеет не пустое значение в контексте документа,
	то соответствующая статья и становиться аналитической статьей счета,
	участвующего в проводке.

	Определители перечисляются в порядке указанном при настройке.
	\item Для счета по кредиту (если используется корреспонденция счетов) происходит
	тоже самое.
\end{itemize}

Определители подстановки задаются в диалоге шаблона проводки с помощью
специальных пвсевдопеременных. Вот все возможные их варианты:

\begin{description}
	\item[LOCATION] Статья, соответствующая складу, которому принадлежит документ.
	Для вычисления соответствия склад>>статья система использует таблицу позиций
	из конфигурации системы (см.~\ref{sec-config}).

	Возможные варианты ввода: $LOCATION$ $LOC$
	\item[OBJECT] Статья, соответствующая основному контрагенту документа.

	Возможные варианты ввода: $OBJECT$ $OBJ$
	\item[PAYER] Плательщик по документу. Используется статья, указанная в
	дополнении к документу как плательщик. Система не пытается подставить
	ничего другого (если только в списке после $PAYER$ не следует какой-то
	иной определитель).
	\item[AGENT] Агент по документу. Используется статья, указанная в
	дополнении к документу как агент.
	\item[BILLOBJ2] Дополнительная статья по документу.

	Возможные варианты ввода: $BILLOBJ2$ $OBJ2$ $EXTOBJ$
	\item[ALACC] Специальный определитель, используемый в многострочных
	бухгалтерских документах и соответствующий счету, указанному в
	строке документа.
	Эта подстановка может использоваться только для счетов.

	Чаще всего применяется для шаблонов проводок по строкам
	расширения авансовых отчетов.
	\item[ALAR] Специальный определитель, используемый в многострочных
	бухгалтерских документах и соответствующий аналитической статье,
	указанной в строке документа.

	Чаще всего применяется для шаблонов проводок по строкам
	расширения авансовых отчетов.
\end{description}

Кроме, собственно, определителей в шаблоне проводок могут
использоваться модификаторы. Целью таких модификаторов
является уточнение документа, из которого следует извлекать
статью или счет. Допустимы следующие модификаторы:

\begin{description}
	\item[LINK] Использование этого модификатора означает,
	что статья (счет), соответствующая определителю должна
	извлекаться из документа, связанного с тем, по которому
	формируется проводка.
	\item[RCKN] Этот модификатор означает, что статья (счет)
	должна извлекаться из документа, для которого данный документ
	является зачитывающим (то есть, из зачетного документа).
\end{description}

Ввод модификаторов предваряется точкой, после которой следует
определитель.

\ppyexample{
	\newline $OBJECT$ - контрагент данного документа
	\newline $LINK.OBJECT$ - контрагент из документа, связанного с данным
	\newline $RCKN.AGENT$ - агент из документа, который зачитывается данным документом
	\newline $LOCATION$ - склад к которому относится данный документ
	\newline $PAYER,OBJECT$ - плательщик по данному документу. Если плательщик не
	определен, то контрагент.
}

\subsubsection{Формула суммы проводки\label{loc-opkind-att-formula}}

В поле \qu{Сумма} вводится формула  для расчета суммы проводки. Операциями в этой формуле
могут быть четыре базовых арифметических действия: сложение (+), вычитание (-), умножение
(*) и деление (/). Операндами могут быть любые действительные числа, символы сумм документов
и символы формул, введенных в разделе справочника формул.

Для того, чтобы сослаться на сумму связанного документа, перед символом этой суммы следует
поставить префикс $LINK.$, для ссылки на зачетный документ (из зачитывающих оплат),
следует использовать префикс $RCKN.$.

\ppyexample{
	Для ссылки на сумму товарного документа в ценах поступления из оплаты необходимо ввести
	строку $LINK.COST$.
}

Для ссылки на сумму строки расширения бухгалтерского документа (например, в случае авансового
отчета) используется символ $ALAMT$.

\subsubsection{Период действия шаблона}

Поле \qu{Период действия} позволяет определить период актуальности шаблона. Если дата
документа не попадает в заданный здесь период, то проводка по шаблону не генерируется.

\subsubsection{Флаги шаблона проводки}

Флаги определяют специфику формирования бухгалтерской проводки по шаблону.

\begin{description}
	\item[\dlgflag{Не проводить отрицательную сумму}]
	Если этот флажок включен, то проводка, получившаяся в результате подстановки данных
	конкретного документа в этот шаблон и имеющая отрицательную сумму, проведена не будет.
	Обычно этот флажок бывает полезен тогда, когда в зависимости от знака суммы, проводка
	должна проводится по разным счетам.

	\item[\dlgflag{Инвертировать счета при отрицательной сумме}]
	Если сумма проводки получается отрицательной, то счета дебета и кредита будут поменяны
	местами.

	\item[\dlgflag{Привести к базовой валюте}]
	Этот флаг используется в валютных бухгалтерских проводках и предназначен в основном для
	проводки курсовых и суммовых разниц. Подробнее эта тема описана в разделе, посвященном
	валютной бухгалтерии.

	\item[\dlgflag{Округлять сумму проводки до целых}]
	Если этот флаг установлен, сумма проводки будет округляться до целых денежных единиц до
	ближайшего (0.5 - вверх). Эта опция бывает нужна в очень редких случаях, когда правила
	учета операции предусматривают такое округление.

	\item[\dlgflag{Пассивный шаблон}]
	Шаблоны, для которых установлен этот флаг, игнорируются при формировании проводок по документу.

	\item[\dlgflag{По строкам расширения бух. документа}]
	Этот признак используется в многострочных бухгалтерских операциях, например в авансовом
	отчете. Если он установлен, то система сформирует проводку, соответствующую шаблону для каждой
	строки расширения документа.
	Для авансового отчета, чтобы в проводку подставлялся счет из строк отчета, необходимо
	дебетовый или кредитовый счет шаблона оставить незаполненным с установкой признака
	\dlgflag{Фиксировать счет}, а в поле \qu{Объект для подстановки} указать символы ALACC,ALAR.
	Это будет означать, что на место незаполненного счета будет подставляться счет и статья из
	строки авансового отчета.

	\item[\dlgflag{Не проводить, если нет подстановки для алиаса}]
	Если в шаблоне проводки используются алиасы счетов, то, если системе не удалось выбрать
	подстановку для алиасов из аналитических статей, ассоциированных с документом, выдается
	сообщение об ошибке и документ не проводится.
	Если вы хотите, чтобы в такой ситуации проводка, соответствующая этому шаблону не генерировалась,
	то установите указанный флаг.
\end{description}

\section{Обобщенные виды операции}

\ppyexample{
	Если вы хотите увидеть и проанализировать реестр документов сразу по операциям \qu{Приход
	товара от поставщика} и \qu{Возврат товара поставщику}, то можно создать операцию-обобщение,
	объединяющую в себе два перечисленных вида операций. Допустим, вы ее назовете \qu{Операции
	с поставщиками}. Затем, перед просмотром товарных документов в фильтре следует выбрать вид
	операции \qu{Операции с поставщиками}.В результате на экране появится реестр всех приходов
	и возвратов поставщику (конечно, с учетом всех остальных параметров фильтра).
}

Система \ppybrand{} предоставляет возможность создавать операции-обобщения, которые не являются
полноценными видами операций, но служат для того, чтобы можно было получать отчеты и
просматривать документы по нескольким выбранным обычным (товарным или бухгалтерским) видам
операций одновременно.

\subsection{Создание и изменение обобщенных видов операций}

Действия по созданию, изменению и удалению обобщенных видов операций аналогичны тому, как
это делается для всех остальных видов операций. Основное отличие заключается в форме
диалога редактирования. Для того, чтобы создать новый обобщенный вид операции, необходимо
в списке просмотра видов операций нажать клавишу \keyb{Insert} или кнопку \dlgbutton{Добавить}.
В появившемся списке типов операций выбрать \ppyrsrv{Обобщение}. На экране появится диалог, в
котором необходимо ввести наименование новой операции и список тех видов операций, которые
этот (новый) вид обобщает.

\ppynote{
	Естественно, вы не сможете в списке обобщаемых операций выбрать обобщенную же
	операцию. Такая \qu{тавтология} системой не допускается.
}

\section{Типы сумм документов\label{sec-amounttype}}

Любой из документов может содержать произвольное количество сумм. Одновременно, чтобы
значения этих сумм можно было эффективно использовать для получения отчетов и
для получения порожденных величин (бухгалтерских проводок, расчета заработной платы,
вычисления бизнес-показателей и т.д.), суммы, связанные с документом должны быть
хорошо структурированы.

Атрибутами каждой суммы документа являются:
\begin{itemize}
	\item Тип суммы
	\item Валюта
	\item Значение суммы
\end{itemize}

Настоящая секция определяет наиболее сложный из перечисленных атрибутов - тип суммы.
В действительности описываемый объект данных применяется не только в документах, но
еще и в так называемых штатных начисления, о которых речь пойдет ниже (стр.~\pageref{sec-salcharge}).

\subsection{Классификация сумм документов}

Условно типы сумм можно разбить не несколько категорий:

\begin{itemize}
	\item Зарезервированные
	\item Замещающие
	\item Налоговые
	\item Комплементарные
	\item Формулы
	\item Штатные
\end{itemize}

Заметим, что эти категории могут пересекаться.

Опишем каждую из категорий.

\subsubsection{Зарезервированные типы сумм}

Для того, чтобы система могла без специальных настроек рассчитать итоговые
значения по сложным (например, товарным) документам, она должна иметь в своем
распоряжении минимальный набор типов, с которыми могут быть сопоставлены
эти значения.

Вот список всех зарезервированных сумм:

\begin{description}
	\item[Номинальная сумма документа (Amount)] титульная сумма документа.
	\item[Стандартная сумма в ценах поступления (Cost)] сумма товарных строк документа в
	терминах себестоимости.
	\item[Стандартная сумма в ценах реализации (Price)] сумма товарных строк документа в
	терминах учетной цены реализации.
	\item[Скидка (Discount)] сумма общей скидки по документу (разница между суммой в
	учетных ценах реализации и фактической ценой, по которой товары отгружены покупателю
	либо каким-либо иным образом израсходованы).
	\item[Сумма оплаты на текущий момент (Paym)] общая сумма оплат по документу. Значение
	этого типа определено только для документов, относящихся к видам операций, требующим оплаты.
	\item[Скидка в процентах (PctDis)] значение скидки
	по документу в процентах.
	\item[НДС (VAT)] сумма НДС по документу в терминах номинальной суммы. Приведем пусть
	и не до конца точный, но характерных пример: для документов отгрузки покупателю этому
	типу будет соответствовать сумма НДС к уплате, а для документов прихода товара от
	поставщиков - сумма НДС к зачету.
	\item[Акциз (Excise)] сумма акциза по документу.
	\item[НДС в ценах поступления (CVat)] уточняющий тип суммы, рассчитываемый как
	сумма НДС по документу в терминах себестоимости.
	\item[НДС в ценах реализации (PVat)] аналогично предыдущему типу, но в терминах
	цен реализации.
	\item[Скидка суммой на весь док (заданная пользователем) (ManDis)] значение
	общей скидки на документ.
	\item[Сумма выплат по ренте за период (RentPrd)] специализированный тип,
	по которому дублируется значение периодического платежа из договора ренты,
	связанного с документом.
	\item[Налог с продаж (SalesTax)] сумма налога с продаж, которым
	облагается транзакция, отраженная документом.
	\item[Валютный курс относительно базовой валюты (CRate)] учетный валютный курс,
	связанный с документом. Соответствующая этому типу величина фиксируется только
	для валютных документов и определяет, в первую очередь, курс, по которому
	ведутся бухгалтерские проводки по документу. Обратим внимание на то, что эта величина
	в общем случае не может рассматриваться в качестве курса для взаиморасчетов с
	контрагентом по документу.
	\item[Акциз в ценах поступления (CExcise)] сумма акциза по документу,
	рассчитанная в терминах цен поступления.
	\item[Транзитный валютный курс (TCRate)] специализированный тип, отражающий
	величину валютного курса в транзитном валютном документе (конвертация валют).
	\item[Фиксированная сумма оплаты (FixPaym)] специальный тип, фиксирующий сумму
	оплат по документу, которых (как отдельных документов) в базе данных нет.

	Сумма такого типа может появиться в документе в результате усечения базы
	данных, либо в консолидирующем разделе базы данных.
	\item[Сумма, агрегированная по чековым строкам кассовой сессии] не используется.
	\item[Сумма не проведенных излишков по чековым строкам кассовой сессии] не используется.
	\item[Сумма налога с продаж в ценах поступления (CSTax)] сумма налога с продаж по документу
	в терминах себестоимости.
	\item[Сумма вводимых в эксплуатацию основных средств (AssetExpl)] сумма этого типа
	рассчитывается для документов поступления основных средств либо в документах
	ввода основных средств в эксплуатацию.
	\item[Сумма системного пула документов (проецируется на внутренние документы пула) (PoolAmount)]
	тип, проецирующий сумму технологической сессии на внутренний документ пула
	списания технологической сессии.
\end{description}

\subsubsection{Замещающие суммы}

Суммы, применяемые в отчетах для группировки сумм, относящихся к разным типам, но
отражающих сопоставимые величины.

Замещающие типы сумм позволяют свести к общему значению суммы документов (либо
товарных строк) в ценах поступления, ценах реализации и суммовую скидку.

Смысл замещающих сумм станет понятнее если ознакомиться с концепцией товарных типов,
которые могут переопределять для разных категорий товаров стандартные суммы
поступления, реализации и скидки.

\subsubsection{Налоговые суммы}

Главное назначение налоговых сумм - раздельный учет товарных операций по различным
ставкам налогообложения.

Например, благодаря налоговым суммам, проводки по товарному документу могут
быть сгенерированы раздельно для двух ставок НДС.

\subsubsection{Комплементарные типы сумм}

Концепция комплементарных сумм дает возможность правильного учета суммовых величин в
документах модификации товаров. Суть проблемы, из-за которой эта концепция появилась,
состоит в том, что для товаров не стандартного типа сложно учесть соответствие вход-выход
для приходных и расходных строк документа модификации. Если для зарезервированных (стандартных)
сумм система автоматически балансирует суммы в ценах поступления и вычисляет разницу по остальным суммам, то для не стандартных типов она этого сделать не может. По этому,
в редких случаях, приходится прибегать к помощи комплементарных сумм.

\subsubsection{Формулы}

Начиная с релиза 5.9.12 в системе появилась возможность определения типов сумм,
величины которых рассчитываются автоматически при проведении или изменении документа
на основе формулы.

Чтобы достичь указанного эффекта, следует задать сумму с формулой и для требуемого вида
операции вставить в список дополнительных сумм этот тип. Далее, при проведении документа,
соответствующего такому виду операции, система автоматически рассчитает по формуле сумму.

\subsubsection{Штатные типы сумм}

Штатные типы сумм применяются при начислении заработной платы сотрудникам. Такие типы
сопоставляются обычно не с документами, а со штатными должностями и назначениями. Кроме того,
суммы штатных типов могут быть ассоциированы с персоналиями-работодателями
для определения редко изменяемых (и, возможно, зависящих от периода начисления) величин.

\subsection{Администрирование типов сумм}

Список всех доступных сумм можно увидеть в списке диалога, открывающегося при выборе
пункта меню \ppymenu{Справочники\rdir Операции\rdir Типы сумм документов}.

В этом диалоге вы можете выполнить следующие действия:

\begin{itemize}
	\item Создать новый тип суммы.
	\item Изменить существующий.
	\item Удалить существующий тип.
	\item Передать все типы сумм в другой раздел базы данных.
	\item Сформировать файл CHARRY для всех типов сумм с целью переноса в другую
	(независимую от текущей) базу данных.
	\item Просмотреть системные события по выбранному типу сумм.
\end{itemize}

\subsubsection{Диалог редактирования типа сумм документов}

\ppypictsc{dlg-amttype-w}{Тип суммы документа}{0.5}

Ввод новой суммы или редактирование существующей осуществляется в диалоге, показанном на рис.~\ref{pic-dlg-amttype-w}.
Далее перечислены управляющие элементы этого диалога.

\begin{description}
	\item[Наименование]
	Наименование суммы, позволяющее отличить ее от остальных.

	\item[Идентификатор]
	Внутренний код типа суммы. Не может быть изменен.

	\item[Символ]
	Слово, идентифицирующее сумму и позволяющее вставлять ее для вычисления в формулы.
	Для написания символов обычно используется латинский алфавит.

	\item[\dlgflag{Если отсутствует, то ошибка}]
	Если этот признак установлен, то система проверяет каждый документ на наличие
	в нем такой суммы. Если ее в документе 	нет, то выдается сообщение об ошибке.

	\item[\dlgflag{Ручная сумма}]
	Система позволяет вводить такую сумму в документ вручную. При этом, такие
	суммы не пересчитываются автоматически.

	\item[\dlgflag{Штатная сумма}]
	Суммы с этим признаком используются для расчета заработной платы и
	могут быть ассоциированы с персоналиями, штатными должностями и штатными
	назначениями (см. главу~\ref{ch-staff}).

	\item[\dlgflag{Формула}]

	Этим флагом отмечаются специальные типы сумм, значение которых
	рассчитывается по формуле непосредственно перед проведением или
	изменением документа.

	Кроме собственно флага, необходимо в поле \qu{Формула} (см. ниже)
	ввести строку формулы, по которой будет рассчитываться значение
	суммы.

	Суммы, содержащие этот флаг, не могут иметь признаки \dlgflag{Ручная сумма}
	и \dlgflag{Распределенная себестоимость}.

	\item[\dlgflag{Распределенная себестоимость}]

	Флаг определяет, так называемую, дистрибутивную сумму, значение которой распределяется на
	себестоимость всех строк приходного товарного документа.

	Особенности этого распределения задается опциями, доступными по кнопке
	\dlgbutton{Распределение себестоимости\dots} (см. ниже).

	\item[Формула]
	Это поле доступно в том случае, если установлен флаг \dlgflag{Формула}.

	\item[\dlgbutton{Распределение себестоимости\dots}]
	Если установлен флаг \dlgflag{Распределенная себестоимость}, то кнопка открывает
	диалог параметров распределения суммы на себестоимость позиций
	приходного товарного документа.

	\ppypict{dlg-costdistrparam}{}

	Диалог показан на рис.~\ref{pic-dlg-costdistrparam}.

	В этом диалоге можно выбрать параметр пропорциональности разноски суммы на себестоимость,
	а также, при необходимости, установить признак отрицательного значения себестоимости.

	Возможны следующие варианты параметра пропорциональности:
	\begin{description}
		\item[Себестоимость] Сумма распределяется пропорционально
		общей себестоимости строки документа (естественно, без учета
		дополнительной величины, формируемой данным распределением).

		\item[Учетная цена реализации] Сумма распределяется пропорционально
		цене реализации строки, помноженной на количество.

		\item[Количество] Распределение осуществляется в пропорции,
		определенной количеством торговых единиц, заданных в строке.

		\item[Физическое количество] Сумма распределяется пропорционально
		физическому количеству строки документа.

		При выборе этого варианта следует учитывать два важных обстоятельства:
		\begin{enumerate}
			\item при нулевом значении физического количества на
			строку придется и нулевая же дополнительная себестоимость.
			\item если товары, содержащиеся в разных строках документа,
			имеют разные и, тем более, несоизмеримые физические единицы,
			то результат распределения может оказаться неадекватным
			ожиданиям.
		\end{enumerate}

		\item[Масса брутто] Строки документа получают дополнительную
		себестоимость, пропорциональную массе брутто, определенной
		как масса брутто единицы товара, умноженная на количество,
		заданное в этих строках.

		Подробно администрирование массы брутто товаров описано
		на стр.~\pageref{sec-goodsvad}.

		Если система не может определить массу брутто для строки,
		то на эту строку ложится нулевая дополнительная себестоимость.

		\item[Габаритный объем] Сумма распределяется пропорционально
		физическому объему товара, к которому относится строка документа.

		Физический объем рассчитывается по габаритным размерам товарной
		упаковки, пропорционально количеству товара, заданному в строке.

		Подробно администрирование габаритных размеров товаров описано
		на стр.~\pageref{sec-goodsvad}.

		Если система не может определить габаритный объем для строки,
		то на эту строку ложится нулевая дополнительная себестоимость.
	\end{description}

	Флаг \dlgflag{Уменьшает себестоимость} предписывает системе
	не увеличивать, а уменьшать итоговую себестоимость товарных
	позиций приходного документа. Этот вариант может применяться,
	например, для учета бонусов от поставщика.

	\item[\dlgradioc{Замещающая сумма}]
	Очень специфичная опция, обеспечивающая инициализацию
	обобщенных сумм документа при выводе их на печать или на
	экспорт.

	Структура данных DL600 Bill содержит три
	специальных поля: \ppyrsrv{GenCostSum}, \ppyrsrv{GenPriceSum}, \ppyrsrv{GenDiscount}.

	Эти поля суммируют зарезервированные суммы, соответственно,
	\ppyrsrv{COST}, \ppyrsrv{PRICE}, \ppyrsrv{DISCOUNT}.
	В дополнение к этому, указанные поля суммируют и замещающие суммы,
	определенные рассматриваемой опцией.

	Практический смысл опции состоит в том, чтобы получить
	значения, обобщающие соответствующие суммы, \qu{разбитые}
	принадлежностью товаров к разным типам, переопределяющим
	учетные типы сумм.

	\begin{description}
		\item[\dlgradioi{Нет}]
		\item[\dlgradioi{Для суммы в ценах поступления (Cost)}]
		\item[\dlgradioi{Для суммы в ценах реализации (Price)}]
		\item[\dlgradioi{Для суммы скидки (Discount)}]
	\end{description}

	\item[\dlgradioc{Вид суммы}]
	Переключатель, призванный установить узкоспециализированные
	типы сумм документов.

	\begin{description}
		\item[\dlgradioi{Обыкновенная}]
		\item[\dlgradioi{Налоговая}]
		\item[\dlgradioi{Входящая комплементарная}]
		\item[\dlgradioi{Исходящая комплементарная}]
	\end{description}

	\item[\dlgcombo{Вид налога}]
	Комбо-бокс доступен только для налоговых сумм (см. выше \dlgradioi{Налоговая}).
	Он позволяет выбрать вид налога, ассоциированного с данным типом суммы.

	\item[Ставка налога, \%]
	Так же как и \dlgcombo{Вид налога}, это поле применяется только
	для налоговых сумм.

	Определяет ставку налогообложения, сопоставленную данному
	типу суммы.

	\item[\dlgcombo{Комплементарная сумма}]

%	\dlgflag{Налоговая сумма} &
%	Признак суммы, используемой для ввода и (или) расчета налогов %раздельно
%	по величинам ставок. Если этот флаг установлен, то следует %выбрать тип
%	налога и ставку налога, соответствующего данной сумме.	\eor
\end{description}

\section{Счетчики операций\label{sec-opcounter}}

\ppypict{dlg-opcounter}{Счетчик операций}

Счетчики операций предназначены для формирования нумерации документов. Мы встречались с
этим понятием, когда разбирали настройки видов операций. Каждый вид операции имеет счетчик.
Отдельный справочник счетчиков операций перечисляет так называемые именованные счетчики.
То есть, те, которые могут быть присвоены более чем одной операции. В противоположность
именованным, не именованные счетчики являются \qu{собственностью} одной операции. Именованные
счетчики операций используются в случаях, когда необходимо однообразно нумеровать документы,
относящиеся к разным видам операций.

Например, имея в арсенале две операции: \qu{Отпуск покупателю на реализацию} и
\qu{Отпуск покупателя за наличный расчет}, вы можете присвоить им один счетчик,
скажем \qu{Счетчик отгрузок покупателю}, тем самым добившись сплошной нумерации
всех документов, относящихся к обеим операциям.

Рисунок и таблица демонстрируют и поясняют поля именованного счетчика операций.

\begin{description}
	\item[Наименование]
	Наименование счетчика.

	\item[Шаблон номера документа]
	Строка, определяющая формат номера документа. Правила ввода шаблона приведены в описании
	настройки видов операций.

	\item[Идент]
	Внутренний идентификатор счетчика.

	\item[Счетчик]
	Значение счетчика. Номер следующего вводимого документа будет содержать в своем составе
	это значение, увеличенное на единицу.

	\item[\dlgflag{Не увеличивать номер при вводе документов}]
	Если этот флажок включен, то значение счетчика не будет увеличиваться при создании новых
	документов. При этом задача слежения за правильной нумерацией ложится на вас.

	\item[\dlgflag{Дифференцировать счетчик по складам}]
	Установка флага приведет к тому, что документы, чья нумерация определяется данным
	счетчиком, будут иметь эту нумерацию раздельно по каждому складу.

	Кнопка \dlgbutton{Дифф счетчика} показывает значения счетчиков для каждого
	из складов (с возможностью изменения).
\end{description}

\chapter{Текущие параметры системы\label{ch-curstate}}

Прежде чем мы перейдем к описанию документов и работы с ними, необходимо остановиться на
небольшом разделе данных, характеризующих текущее состояние системы. Эти данные определяют
общий фон работы пользователя с системой в данный момент времени. Кроме того, система поддерживает
ряд наборов данных, необходимых для ускорения расчетов.

\section{Текущее состояние}

Наиболее существенными параметрами, определяющими текущее состояние системы, являются:

	\paragraph{Главная организация}
	Это ваша организация, учет деятельности которой вы ведете в системе. Главная организация
	является объектом персоналий, имеющим вид \ppyrsrv{Главная организация}.

	Подробно особенности управления информацией о главной организации описаны на стр.~\pageref{sec-mainorg}.

	\paragraph{Путь к базе данных}
	Системный путь доступа к базе данных. Например: H:/PPY/DAT
	Путь к базе данных определяется при входе в систему и не может быть изменен во время
	текущего сеанса работы.

	\paragraph{Текущий раздел базы данных}
	О разделах базы данных речь пойдет в одной из последующих глав. Если ваша база данных
	не является распределенной, то текущего раздела видимо не будет.

	\paragraph{Пользователь}
	Задав при входе в систему свое пользовательское имя и введя правильный пароль, вы тем
	самым идентифицировали себя как пользователя в системе. Во время всего сеанса работы
	система хранит условный код, по которому определяются ваши права доступа и целый ряд
	параметров, именуемых конфигурацией.

	\paragraph{Текущая дата}
	Этот параметр также как и имя пользователя задается при входе в систему. Текущая дата
	определяет то каким числом по умолчанию будут вводится новые документы и какие периоды
	задавать в фильтрах. Кроме того, текущая дата служит для привязки некоторых прав доступа.
	Все это не значит, что ваши действия каким-то образом ограничиваются текущей датой.
	Так, вы можете вводить документы любой датой (если это не запрещают права доступа),
	текущая дата лишь служит для облегчения ввода большинства документов, поскольку чаще
	всего вводятся именно документы текущим числом.

	\paragraph{Текущий склад}
	Любой документ, который вы вводите, автоматически привязывается к текущему складу. Кроме
	того, вы можете изменять или удалять только те документы, которые относятся к текущему
	складу. Для изменения текущего склада необходимо выбрать пункт меню \ppymenu{Операции\rdir Выбор склада}.

	Текущий склад устанавливается автоматически в следующих ситуациях:
	\begin{itemize}
		\item При входе в базу данных текущим устанавливается склад, определенный как
		активная позиция в конфигурации пользователя (группы).
		\item При открытии таблицы документов, если в фильтре определен единственный
		склад, то он становится текущим (если в фильтре задан список складов либо не задан
		ни какой, то текущий склад не меняется).
		\item При вводе нового документа после выбора вида операции и склада в диалоге,
		предшествующем непосредственно диалогу редактирования нового документа.

		После завершения операции ввода нового документа (неважно, с проведением либо нет)
		восстанавливается текущий склад, который был до этого.
		\item При открытии кассовой панели для ввода чеков.

		В этом случае текущим складом становится тот, к которому привязан кассовый узел,
		соответствующий открываемой кассовой панели.

		После завершения работы с кассовой панелью восстанавливается предшествующее
		операции значение текущего склада.
	\end{itemize}

	\paragraph{Текущий лот}
	Лот который принимает участие в товарной операции является текущим. Система автоматически
	назначает лот текущим согласно заданному в конфигурации порядку реализации товара.

	\paragraph{Базовая валюта}
	Основная валюта учета. Как правило, базовой валютой является национальная валюта того
	государства, на территории которого ведет свою деятельность предприятие.

	\paragraph{Базовый тип валютного курса}
	В системе \ppybrand{} можно вести любое количество различных валютных курсов одновременно. Однако,
	для целей учета должен быть выбран тип валютного курса, определяющий отношение различных
	валют к базовой при проведении операций. Как правило, базовым типом валютного курса является
	курс государственного банка страны, на территории которой ведет свою деятельность предприятие.

Для того, чтобы посмотреть параметры, определяющие текущее состояние системы, следует выбрать
пункт меню \ppymenu{Справочники\rdir Текущее состояние} либо дважды щелкнуть мышью в левой части
строки состояния. При этом на экране появится диалог, показывающий какие значения имеют текущие параметры.

\section{Текущие товарные остатки}

Для быстрого извлечения списка товаров с ненулевым текущим остатком система \ppybrand{} использует
специальную таблицу текущих товарных остатков.

Эта таблица всегда автоматически поддерживается в актуальном состоянии и какие либо действия по
ее пересчету требуются крайне редко. Функция восстановления этой таблицы описана на стр.~\pageref{c-currest}.

\section{Текущие остатки по лотам}

При значительном товарном ассортименте и (или) большом количестве складов, с которыми
работает предприятие могут возникнуть задержки при расчете товарных остатков на заданную
дату. Так как расчет остатков является исключительно часто используемой функцией, а с течением
времени данная проблема \qu{склонна} усугубляться, необходимы средства для радикального
ускорения расчетов с одновременным снижением нагрузки на сервер базы данных.

Это средство - индексация остатков по лотам, по другому называемая текущими остатками по лотам.
Суть этой индексации в том, что система строит специальную таблицу, в которой отражаются остатки
по каждому лоту и на каждый день его жизненного цикла. Под жизненным циклом лота подразумевается период
от даты лота до последней операции по нему. С учетом того, что лотов обычно очень много, а жизненный
цикл каждого может варьироваться до нескольких лет, таблица текущих остатков может оказаться очень
большой (несколько десятков гигабайт).

Функция индексации остатков по лотам введена в систему начиная с версии 6.6.11. Для того чтобы
начать ее использовать следует предпринять следующие шаги:

\begin{description}
	\item[Сформировать таблицу для всех существующих лотов]
	Для этого необходимо зайти в систему с именем \ppyrsrv{SYSTEM} и паролем,
	закрепленным за пользователем \ppyrsrv{MASTER}.

	Выбрать пункт меню \ppymenu{Правка\rdir Пересчет текущих остатков по лотам}.

	Помните, что если ваша база данных используется давно и содержит большое
	число лотов, то расчет может занять очень много времени (до суток), а результат
	его работы выльется в увеличение размера базы данных на несколько гигабайт или
	даже десятков гигабайт. Более того, функция пересчета интенсивно нагружает
	сервер базы данных. В связи с изложенным, настоятельно рекомендуем запускать
	эту функцию на выходных, когда работа пользователей менее критична, чем в будни.

	\item[Установить базу данных в состояние постоянной актуализации индекса]
	Сразу после завершения работы функции пересчета текущих остатков по лотам (но
	ни в коем случае не до ее запуска) необходимо в системных параметрах общих настроек
	установить (см. стр.~\pageref{sec-commcfg-sys}) переключатель \dlgradioc{Применение текущих остатков по лотам}
	в положение \dlgradioi{Поддерживать в актуальном состоянии}. В результате этого
	система будет актуализировать состояние текущих остатков по лотам одновременно
	с проведением, изменение и удалением товарных документов.

	Помните, что эта актуализация начнет работать только для тех сеансов,
	которые были запущены после установки режима.

	\item[После небольшого периода наблюдения включить режим использования индекса]
	Необходимость в периоде наблюдения определяется тем фактом, что функция индексации
	и применения текущих остатков по лотам является достаточно сложной и может содержать
	дефекты, не выявленные на этапе разработки и тестирования.

	Через 6 месяцев после выхода релиза 6.6.11 (то есть, с июня 2011 года) в периоде
	наблюдения необходимости нет.

	Далее, установите переключатель \dlgradioc{Применение текущих остатков по лотам}
	системных параметров общих настроек в положение \dlgradioi{Использовать при расчетах} -
	индексация начнет использоваться системой.
\end{description}

\chapter{Документы\label{ch-bill}}

Понятие документа лежит в основе концептуальной схемы построения системы автоматизированного
учета с помощью \ppybrand{}. Любая учетная операция, будь то обычная бухгалтерская проводка,
отгрузка товара покупателю, и т.п. представлена документом. Несмотря на то, что в зависимости
от конкретного характера операции, документы могут значительно отличаться друг от друга,
существует ряд общих черт, объединяющих все документы. Эти же общие черты объединяют и
способы работы с документами.  Приведем наиболее существенные свойства, объединяющие все
документы в системе:

\begin{itemize}
		\item	Каждый документ принадлежит какому-либо виду операции. Вид операции определяет
		структуру и свойства документа.
		\item	Документ имеет дату и номер. Эти базовые свойства идентифицируют документ среди
		ему подобных.
		\item	Документ может иметь контрагента. Контрагентом является лицо или организация, с
		которой ваше предприятие взаимодействует при совершении операции, отражением которой
		является документ. Наличие контрагента не является необходимым свойством документа,
		но в большинстве случаев документ лишен смысла без определения того, кто является его
		контрагентом.
		\item	Документ прямо или косвенно влияет на отражение состояния предприятия.
\end{itemize}

\section{Категории документов}

Для того чтобы было проще ориентироваться среди огромного множества документов,
накапливаемого в базе данных предприятия, мы будем делить их на категории. Каждой из
категорий соответствует пункт в меню системы, а также пиктограмма на панели инструментов.

Таких категорий всего шесть:

\paragraph{Бухгалтерские документы}
Документы, вводимые в бухгалтерии предприятия и влияющие, как правило, только на состояние
бухгалтерского баланса предприятия.

Такая краткая характеристика этой категории, не отражает,
к сожалению, всего многообразия применений бухгалтерских документов. В последующих разделах
мы подробно рассмотрим все аспекты работы с бухгалтерскими документами.

Все бухгалтерские документы принадлежат операциям типа \ppyrsrv{Бухгалтерская проводка}

\paragraph{Товарные документы}
Товарные документы, как следует из названия, участвуют в учете материальных операций
предприятия. Это - наиболее сложная с точки зрения использования категория документов.
Сюда включаются документы прихода материальных ценностей, их перемещения между складами
предприятия, отгрузки товаров клиентам, переоценка, модификация товаров и пр.

Товарные документы могут принадлежать операциям типа

\begin{itemize}
	\item Приход товара
	\item Расход товара
	\item Переоценка
	\item Модификация
	\item Подтверждение
	\item Оплата
\end{itemize}

Последний тип относится к данной категории по историческим причинам.
Большинство товарных документов автоматически генерирует бухгалтерские проводки, в
соответствии с видом операции и составом документа.

\paragraph{Товарные заказы}
Документы этой категории относятся к видам операций, принадлежащим типу \ppyrsrv{Товарный заказ}.
Их основное назначение - учет поступления заказов на товары и отслеживание исполнения %
заказов. Сами по себе, эти документы, не влияют ни на товарный, ни на бухгалтерский учет
предприятия, но позволяют автоматизировать систему учета поступивших заказов и объемы
закупа или производства на будущие периоды.

\paragraph{Инвентаризация}
Немногочисленная категория, объединяющая документы инвентаризации материальных ценностей
предприятия. Целью существования документов инвентаризации является ускорение ввода и
списания результатов ревизии на складах предприятия.

Дополнительный вариант использования документов этой категории - инвентаризация остатков
товаров у клиентов. Для этого предназначен специальный подтип вида операции инвентаризации -
\qu{инвентаризация по клиентам}.

\paragraph{Драфт-документы}
Категория драфт-документов предназначена для предварительного ввода товарных документов,
без отражения этого ввода на текущем состоянии учета на предприятии. Драфт-документы могут
быть списаны, то есть, превращены в полноценные товарные документы в соответствии с заданной
схемой списания.

Вот наиболее важные сферы применения драфт-документов:

\begin{itemize}

	\item Предварительный ввод документов в тех случаях, когда необходимо
	организовать такую схему обработки документов, что в течении какого-то
	периода (скажем, дня) ввод осуществляется без контроля остатков и без
	проведения бухгалтерских проводок. В конце же периода эти документы
	списываются в учетные.

	При списании уже выявляются и устраняются (корректируются) рассогласования.

	Такая схема находит применение в производстве, ресторанном бизнесе и т.д.

	\item Документы закупки. Сотрудники предприятия, ответственные за снабжение
	вводят драфт-документы, отражающие факт заказа товаров у поставщиков.

	Эти документы могут быть созданы как вручную, так и автоматически на основе
	автоматического расчета заказа поставщику.

	Когда заказанные товары фактически поступают от поставщика, вводится %
	документ прихода, привязанный к драфт-документу закупки. В дальнейшем
	документ прихода может быть сравнен с документом закупки с целью выяснения %
	рассогласований.

	Кроме того, система предоставляет функции расчета остатков с учетом будущих
	приходов на основе таких драфт-документов.

	\item Документы планов продаж и закупок. Специальный подтип в видах операций
	драфт-прихода и драфт-расхода позволяет настроить виды операций, ответственные
	за ввод документов планирования продаж и покупок.

	Такие документы не списываются, но на их основе можно проводить план-фактный
	анализ операций за плановый период с детализацией по товарам, группам товаров,
	поставщикам, торговым агентам и т.д.

	\item Система может автоматически формировать драфт-документы на основе
	дефицита по кассовым либо технологическим сессиям.

	Затем эти документы могут быть списаны по достаточно сложным правилам
	либо с целью автоматической генерации учетных документов производства,
	либо для расчета планов закупок по MRP-таблицам, построенным на основании
	таких драфт-документов.

\end{itemize}

\paragraph{Пулы документов}
Пул документа - это \qu{жесткое} объединение нескольких документов с целью получения итоговых значений
либо выполнения групповых операций над ними.
Пулы документов делятся на два подкласса:

\begin{itemize}
	\item зарезервированные системные пулы, объединяющие документы, по признакам, определяемых
	системой. Например, пул документов списания кассовой сессии.
	\item Собственно документы - владельцы пулов. Такие документы объединяют произвольные
	(на усмотрение пользователя) наборы других документов.
\end{itemize}

\section{Концепции}

В этом разделе мы остановимся на общих понятиях, используемых при описании документов.
Как правило, любое из этих понятий применимо ко всем категориям документов.

\subsection{Дата документа}

Учетная дата документа. Дата документа определяет местоположение во времени самого документа
и связанных с ним атрибутов и других объектов. Так бухгалтерские проводки, генерируемые
документом, проводятся этой датой равно как и товарные операции учитываются общей датой
документа.
Изменение даты документа, хотя и реализуется системой, но только в пределах логической
непротиворечивости. Например, если вы попытаетесь перенести приходный документ, по которому
были расходы той же датой, на день вперед, то система не позволит этого сделать.

\subsection{Номер документа}

Произвольная строка длиной до 23 символов, определяющая место документа в документообороте
предприятия.

Входящие документы (например, приход товара, оплата от покупателя) обычно
получают номер, присвоенный этому документу его эмитентом. Исходящие и внутренние документы,
как правило, получают номер, согласующийся с внутренним реестром.

Для автоматической генерации номеров документов в системе предусмотрены так называемые
операционные счетчики. При создании нового документа, ему автоматически присваивается номер,
заданный шаблоном с использованием этого счетчика. Вслед за этим, счетчик увеличивается на
единицу и готов для формирования следующего документа.

Подробнее операционные счетчики описаны в гл.~\ref{ch-ref-oper}.

При назначении номера нового документа возникает три существенных вопроса, связанных с
требованием непрерывности нумерации:

\begin{enumerate}
	\item Что происходит когда новый документ не проводится?
	\item Что происходит со счетчиком при удалении документа?
	\item Что происходит со счетчиком когда пользователь вручную меняет номер документа?
\end{enumerate}

Ответы на все три вопроса неутешительные.

Только в случае с отказом от проведения документа система имеет возможность (да и то не всегда)
как-то бороться за непрерывность нумерации. Делает она вот что: после отказа пользователя
от проведения документа (напомним, что ради этого документа счетчик уже был увеличен),
система проверяет, не изменял ли кто-либо счетчик с момента его увеличения. Если нет, то
значение счетчика возвращается к первоначальному состоянию. Если же кто-то из пользователей
успел создать новый документ, пока первый пользователь решал вопрос о том, нужен ему этот
документ или нет, то сделать уже ничего нельзя: счетчик \qu{убежал} вперед и изменять его
автоматически уже нельзя.

При удалении документа в нумерации остается \qu{дырка}.

При ручном изменении номера документа молчаливо предполагается, что пользователь лучше
системы знает какой номер должен быть у документа (при этом операционный счетчик все равно
уже увеличен).

Наконец необходимо сказать о том, что пользователь, имеющий соответствующие права доступа,
может изменить операционный счетчик вручную.

\subsection{Вид операции}

Виды операций подробно рассматриваются в разделе \qu{Операционные справочники}. Этот атрибут
является основным фактором, определяющем \qu{поведение} документа. Система не предполагает
существование зарезервированных видов операций, но обрабатывает документ так, как определяется
параметрами вида операции, к которому этот документ относится.

Учитывая вышесказанное, система ни при каких обстоятельствах не разрешает изменение вида
операции созданного документа.

\subsection{Склад}

Любой документ должен относиться к какому-либо складу. В контексте общего описания документов,
понятие склада отражает не только место, где хранятся товары, но, возможно, и как подразделение
предприятия (особенно это верно для бухгалтерских документов).

Для товарных документов склад является критической характеристикой. В следствии этого
система не допускает изменения склада в товарных документах. С другой стороны, в бухгалтерских
документах изменение принадлежности к складу допускается.

\subsection{Номинальная сумма}

Титульная сумма документа. Хотя документ может иметь произвольное число различных сумм, одна
из них (либо алгебраическое выражение, рассчитанное по документу) принимается за номинальную
сумму.

Для некоторых категорий документов номинальная сумма имеет принципиальное значение, для
других - нет.

В действительности, существуют два важных применения номинальной суммы:

\begin{enumerate}
	\item В документах, требующих оплату (долговых), номинальная сумма отражает величину,
	которая должна быть оплачена. Симметрично, номинальная сумма документов оплаты
	сопоставляется с номинальной суммой долговых документов.
	\item Номинальная сумма всегда отображается в таблице документов и диалогах документов.
	То есть, выступает в роли \qu{витринной} величины документа.
\end{enumerate}

В остальных аспектах номинальная сумма не более, чем \qu{одна из}.

\subsection{Статус}

Статусы документов являются настраиваемыми признаками документов. Главное назначение
статусов - ограничение возможных действий над документами по мере их прохождения по
маршруту обработки в организационной схеме документооборота предприятия.

Подробно настройка и использование статусов документов описаны на стр.~\pageref{sec-billstatus}.

\subsection{Контрагент}

Статья аналитического учета, с которой связан документ. Чаще всего смысл этого атрибута хорошо
отражается термином \ppyterm{контрагент}. Особенно это характерно для документов, посредством которых
предприятие взаимодействует с внешним миром: приходы товаров от поставщиков, оказание услуг
клиентам и т.д.

С другой стороны, очень часто контрагентом может быть либо аналитическая статья, ассоциированная
со складом (внутреннее перемещение товаров), либо что-то еще (пример: причина списания в документе
потерь). В некоторых случаях документ вообще может не иметь контрагента (здесь характерным примером
может служить документы розничной продажи).

Таблица аналитических статей, из которых выбирается контрагент документа определяется видом
операции, к которому относится документ.

\subsection{Дополнительный объект}

В некоторых случаях единственного контрагента по документу не хватает для правильного учета
операции. В этом случае вид операции можно настроить так, чтобы в документе, наряду с основным
контрагентом, можно было выбрать дополнительную аналитическую статью.
Дополнительный объект документа, будучи во многом аналогичен основному контрагенту, имеет
несколько отличий:

\begin{itemize}
	\item Фильтрация отчетов по дополнительному контрагенту, хотя есть почти везде,
	технически реализуется медленней
	\item Учет оплат по документу с привязкой к дополнительному объекту возможен,
	но требует дополнительных настроек
\end{itemize}

Так же как в случае с основным контрагентом, с дополнительным объектом могут быть связаны
бухгалтерские проводки, генерируемые по документу.

В качестве примера использования дополнительного объекта можно привести операцию оплаты
через банк. При этом часто основным контрагентом является получатель платежа (или плательщик),
а дополнительным объектом - аналитическая статья, соответствующая банку, через который
проходит платеж (если ваше предприятие имеет счета в нескольких банках).

\subsection{Агент}

Еще одна аналитическая статья, которая может быть ассоциирована с документов. Номинальное смысловое значение агента
вполне передается названием - это, обычно, персоналия, являющаяся посредником в операции.

Таблица, которой принадлежат статьи агентов по документам идентифицируется системой следующий образом:
это первая таблица (с наименьшим значением идентификатора), которая связана с персоналиями, принадлежащими зарезервированному
виду \ppyrsrv{Агенты} (идентификатор этого вида - 8).

Специфический смысл имеют агенты, привязанные к приходным товарным документам. Они становятся, кроме всего прочего, агентами
поставщика. Так как последующие после прихода операции привязаны к лотам, то можно отследить продажи и прочие операции
с товарами из этих лотов в разрезе агента, с которым ассоциирован приходных документ.

Система \ppybrand{} имеет развитую инфраструктуру для анализа данных в разрезе агентов поставщиков. Фильтрация и подстановка
по агенту поставщика имеется в большинстве товарных отчетов.

\subsection{Прикрепленные файлы}

Существует возможность привязки произвольного числа файлов к документу.
Эта опция доступна для тех документов, которые относятся к виду операции,
в котором установлен флаг \dlgflag{Присоединение файлов} (стр.~\pageref{par-opkind-attachfile-option}).

\subsection{Дополнительные примечания}

Начиная с версии 6.0.1 в системе \ppybrand{} появилась технология привязки дополнительных
примечаний к документам.

От обычного примечания, являющегося неотъемлемым атрибутом документа, дополнительные
примечания имеют следующие отличительные свойства:

\begin{itemize}
	\item Дополнительных примечаний может быть несколько на один документ.
	\item Создание и редактирование дополнительного примечания не
	ограничивается правами доступа на редактирование документа. Таким образом,
	пользователь, не имеющий прав на изменение некоторого документа, может
	привязать к нему дополнительное примечание.
\end{itemize}

\section{Статусы документов\label{sec-billstatus}}

Статус является настраиваемой перечисляемой характеристикой документа. Список статусов
определяется в процессе конфигурации базы данных. Следовательно, может существовать
произвольное количество возможных статусов документа.

Документ может либо не иметь статуса, либо иметь один статус. Статус документа не является
учетным атрибутом (то есть, он не влияет на то, каким образом документ изменяет состояние
бухгалтерского баланса предприятия, либо состояние складских запасов). Основное его
назначение - регламентация особенностей поведения документов.

В системе определены набор признаков статусов документов, обеспечивающий основную функциональность.
Большая часть этих признаков - ограничивающие, то есть, блокирующие возможность осуществить некоторую
операцию с документом если она имеет такой статус и, возможно, не удовлетворяет некоторыми условиям.

Некоторые признаки требуют обязательного заполнения некоторых атрибутов документа.

Далее, в описании диалога редактирования записи статуса, приведены подробные комментарии относительно
каждого признака.

Вероятнее всего, с течением времени набор правил поведения документа, определяемых статусом,
будет увеличиваться.

\subsection{Справочник статусов документов}

Список статусов документов доступен через пункт меню \ppymenu{Справочники\rdir Операции\rdir Статусы документов}.

Статусы отображаются в виде диалога со списком. Кроме, собственно, списка, здесь присутствуют
типичные для таких диалогов кнопки \dlgbutton{Редакт}, \dlgbutton{Добавить}, \dlgbutton{Удалить},
\dlgbutton{События} и \dlgbutton{Закрыть}.

%topic(DLG_BILLSTATUS)

\subsection{Диалог редактирования статуса документов}

\ppypict{dlg-billstatus}{Диалог редактирования статуса документов}

Вид диалога редактирования записи статуса приведен на рис.~\ref{pic-dlg-billstatus}.
Далее описываются управляющие элементы этого диалога:

\begin{description}
	\item[Наименование]
	Уникальное в пределах справочника наименование статуса.

	\item[Символ]
	Это поле либо пустое либо содержит уникальный символ статуса.

	\item[ИД]
	Справочное поле, отображающее идентификатор статуса.

	\item[Ранг]
	Ранг статуса определяет его положение среди остальных записей справочника.
	Наиболее важным использованием этого атрибута является ограничение
	на изменение статуса документа на статус с меньшим рангом.

	\item[\dlgflag{Документы нельзя модифицировать}]
	Документу, имеющие этот статус нельзя модифицировать.

	\ppynote{
		Существует технологическое исключение для этого флага: при списании кассовой сессии система
		пытается скорректировать сумму одного из документов таким образом, чтобы итоговое значение сумм
		документов списания точно совпадало с суммой кассовой сессии. Для этого один из документов
		может быть модифицирован сразу вслед за проведением. На эту модификацию ограничение
		статуса не распространяется.

		Подробности см. на стр.~\pageref{csess-adjwroff}.
	}

	\item[\dlgflag{Документы нельзя удалять}]
	Документы с этим статусом нельзя удалять.

	\item[\dlgflag{Документы нельзя передавать в другой раздел}]
	При попытке передачи в другой раздел документа со статусом, имеющим
	этот признак, система выдаст сообщение о том, что данных документ
	не передан.

	Назначение этого флага - запретить передачу документов, которые
	еще не готовы окончательно.

	\item[\dlgflag{Связанные документы нельзя изменять}]
	Этот флаг запрещает создание, изменение и удаление документов,
	связанных с документом, имеющим данный статус.

	Под связанными документами подразумеваются как документы,
	имеющие прямую ссылку на данный документ (оплаты, связанные возвраты и т.д.),
	так и имеющие членство в платежном или операционном пуле данного документа.

	\item[\dlgflag{Нельзя менять на статус с меньшим рангом}]
	Статус документов не может быть изменен на статус, имеющий ранг, значение
	которого меньше ранга данного статуса.

	Смысл этого флага - обеспечить необратимость изменения статусов во
	избежании обхода других ограничений статуса.

	Для примера приведем следующую характерную ситуацию:
	\begin{itemize}
		\item Пользователь пытается изменить документ
		\item Система сообщает в ответ на это, что статус не допускает изменение документа
		\item Пользователь меняет статус этого документа на тот, который допускает изменение,
		и изменяет документ
		\item Наконец, пользователь, возвращает статус документа в исходное состояние.
	\end{itemize}

	Для исключения такого и аналогичных сценарием и необходим обсуждаемый признак.
	Он позволяет настроить систему статусов документов таким образом, чтобы
	некоторые изменения статусов были необратимыми.

	\item[\dlgflag{Не проводить проводки по документу}]
	Этот флаг блокирует формирование бухгалтерских проводок по документу.

	Здесь необходимы пояснения относительно механизма работы.
	Опция завязана на специальный признак документа \dlgflag{Без бухгалтерских проводок}.
	При изменении статуса документа система идентифицирует факт изменения флага
	\dlgflag{Не проводить проводки по документу} между старым и новым статусом.
	Если этот признак был и остался либо не был и не появился, то никаких действий
	в связи с ним не осуществляется (независимо от того, установлен у документа
	флаг \dlgflag{Без бухгалтерских проводок} или нет).

	Если между старым и новым статусом состояние рассматриваемого флага изменилось,
	то программа сравнит требование флага с состоянием документа и установит, снимет,
	либо оставит как есть признак документа \dlgflag{Без бухгалтерских проводок}.

	Важно заметить, что обсуждаемый флаг появился на много позже, чем соответствующий
	признак документа. В специальных случаях пользователи практикуют флаг \dlgflag{Без бухгалтерских проводок}
	документа. Приведенные пояснения призваны четко обозначить взаимосвязь этих
	признаков для того, чтобы избежать неожиданностей.

	Приведем гипотетический сценарий (в хронологическом порядке), чреватый конфликтом:
	\begin{itemize}
		\item Документ имеет статус без флага \dlgflag{Не проводить проводки по документу}
		и в нем не установлен признак \dlgflag{Без бухгалтерских проводок}: документ имеет
		бухгалтерские проводки.
		\item Пользователь $A$ устанавливает в документе признак \dlgflag{Без бухгалтерских проводок}:
		документ теряет бухгалтерские проводки.
		\item Пользователь $B$ меняет статус документа на тот, который блокирует проводки по документу:
		документ остается без бухгалтерских проводок.
		\item Пользователь $C$ меняет статус документа на тот, который не блокирует проводки по документу:
		для документа формируются бухгалтерские проводки.
	\end{itemize}
	В описанной ситуации пользователи $B$ и $C$ сделали свою работу и результат вполне
	адекватен их ожиданиям. Однако, для пользователя $A$ состояние базы данных на момент
	завершения сценария совершенно неожиданно, поскольку он рассчитывал, что документ не имеет
	бухгалтерских проводок.

	Несмотря на то, что ручное использование флага \dlgflag{Без бухгалтерских проводок}
	практикуется редко, следует помнить о потенциальной опасности приведенного сценария.

	\item[\dlgflag{Не учитывать как оплату}]
	Действие флага распространяется на документы, относящиеся к типам:

	\begin{itemize}
		\item \ppyrsrv{Оплата}.
		\item \ppyrsrv{Возврат товара}.
		\item \ppyrsrv{Начисление ренты} при установленном признаке
		\dlgflag{Считать отрицательной оплатой}.
	\end{itemize}

	Если документ указанных типов получает статус с рассматриваемым флагом,
	то он не будет учитываться как оплата по документу, к которому привязан.

	Смысл использования флага заключается в том, чтобы до некоторых пор (до
	момента присвоения статуса без такого флага) документ считался бы не учтенным.
	К примеру, в период времени между отправкой платежа и подтверждением его
	получения кредитором. Либо, в отрезок времени между выпиской доверенности на
	получения платежа агентов у дебитора и сдачей агентом полученных денег в
	кассу предприятия.

	\ppynote{
		Будьте внимательны: изменение этого флага у статуса, с которым уже
		связаны какие-либо документы может привести к серьезным нарушениям в
		учете дебиторской и кредиторской задолженности.
	}

	\item[\dlgflag{Разместить документ по складским ячейкам}]

	\item[\dlgflag{Документ готов для отправки EDI-подтверждения}]
	Если флаг установлен, то система допускает отправку документа по каналам EDI, в ЕГАИС или
	ВЕТИС (Меркурий).

	Важно и обратное: если документа не имеет статуса с установленным флагом, то оправка его
	в ЕГАИС, ВЕТИС или по каналу EDI не возможна.

	\item[\dlgflag{Строгая проверка ценовых ограничений}]
	Включенный флаг предписывает системе при установке такого статуса проверять все строки документа
	на соответствие цен реализации ограничениям, определенным для товарных типов.

	Подробнее об ограничениях товарных величин см. стр.~\pageref{sec-goodsvalrestr}.

	\item[Флаги обязательных к заполнению атрибутов документа]

	Эти флаги определяют атрибуты, которые не могут быть пустыми
	для документов, имеющих данный статус.

	\begin{description}
		\item[\dlgflag{Агент}] С документом, имеющим этот статус, должен быть обязательно связан агент.
		\item[\dlgflag{Плательщик}] Документ должен содержать не пустой атрибут \qu{Плательщик}.
		\item[\dlgflag{Адрес доставки}] В параметрах фрахта документа должно быть обязательно инициализировано поле \qu{Адрес доставки}.
		\item[\dlgflag{Порт загрузки}] Порт загрузки во фрахте документа должен быть не пустым.
		\item[\dlgflag{Порт разгрузки}] Порт разгрузки во фрахте документа должен быть не пустым.
		\item[\dlgflag{Дата отправления}] Фрахт должен содержать дату отправления.
		\item[\dlgflag{Дата прибытия}] Фрахт должен содержать дату прибытия на конечный пункт.
		\item[\dlgflag{Транспортное средство}] Во фрахте документа должно быть определено транспортное средство.
		\item[\dlgflag{Стоимость фрахта}] Фрахт должен содержать значение стоимости транспортировки больше нуля.
		\item[\dlgflag{Капитан (водитель) транспорта}] Во фрахте документа необходимо заполнить поле капитана (водителя) транспортного средства.
		\item[\dlgflag{Транспортный брокер}] Необходимо указать транспортного брокера во фрахте документа.
		\item[\dlgflag{Контрагент по документу}]
		Флаг ограничивает возможность сохранения документа, если для вида
		операции, которому принадлежит документ определена основная таблица
		статей, но соответствующая статья (контрагент) в документе не выбрана.
		\item[\dlgflag{Дополнительный объект}]
		Если вид операции, к которой относится документ, определяет таблицу статей дополнительного объекта документа,
		то такой документ, имеющий статус с данным флагом, не может содержать пустое поле дополнительного объекта.
		\item[\dlgflag{Дата исполнения}]
		Флаг предписывает каждому документу с таким статусом иметь не пустую дату исполнения.
		\item[\dlgflag{Номер документа}]
		Документ, имеющий пустой номер, не может быть сохранен с данным статусом.
	\end{description}

	Флаги, относящиеся к фрахту:
	\begin{itemize}
		\item \dlgflag{Адрес доставки},
		\item \dlgflag{Порт загрузки},
		\item \dlgflag{Порт разгрузки},
		\item \dlgflag{Дата отправления},
		\item \dlgflag{Дата прибытия},
		\item \dlgflag{Транспортное средство},
		\item \dlgflag{Стоимость фрахта},
		\item \dlgflag{Капитан (водитель) транспорта},
		\item \dlgflag{Транспортный брокер}
	\end{itemize}
	действуют на документы только с теми видами операций, у которых задан флаг \dlgflag{Ввод информации по фрахту}.
	Подробно о вводе параметров фрахта документа  см. стр.~\pageref{sec-billfreight}.

	\item[\dlgcombo{Счетчик}]
	В этом комбо-боксе может быть выбран счетчик операций. Целью такого
	выбора является изменение номера документа при присвоении ему
	данного статуса.

	Важно иметь в виду следующие правила, по которым используется этот
	счетчик при назначении номера документу:
	\begin{itemize}
		\item Если статус со счетчиком присваивается документу при
		его создании (определен в виде операций как статус нового документа),
		то используется именно этот счетчик, а не тот, который указан в
		виде операции.

		\item При изменении статуса номер документа меняется только в том
		случае, если либо новый статус отличается от старого, либо счетчик
		нового статуса отличается от счетчика предыдущего статуса или от
		счетчика, указанного в виде операции, которой принадлежит документ.

		\item Если, при изменении статуса, старый статус имел свой счетчик, а
		новый не имеет такового, то номер документа не меняется.

		\item При изменении самого статуса таким образом, что в нем меняется счетчик,
		никаких изменений в существующих документах, имеющих этот статус, не происходит.
	\end{itemize}

	\item[\dlgcombo{Допустимый вид операции}]
	Вы можете ограничить использование некоторого статуса только документами,
	относящимися к одной или нескольким видам операций. Для этого в рассматриваемом
	комбо-боксе выберите либо обыкновенный вид операции, либо обобщенную операцию,
	определяющую набор обыкновенных видов, для которых возможно присвоение этого статуса.

	\ppynote{
		Будьте внимательны: существует возможность коллизии между статусом новых
		документов, установленным в записи вида операции и набором допустимых операций
		в записи самого статуса (то, что мы сейчас обсуждаем).

		Если статус новых документов в виде операции содержит ограничение на допустимые
		виды операций, в которое не входит этот вид операции, то будет невозможно
		создать новый документ такого вида. При этом будет выдано сообщение об ошибке:
		\qu{Статус документа 'наименование-статуса', определенный для новых документов, не разрешено устанавливать для этого вида операции}.
	}

	\item[Цвет]
	Группа управляющих элементов, позволяющих выбрать цвет, ассоциированный с этим статусом. Если
	выбран какой-либо цвет, то в таблице документов в строках, соответствующих документам с этим статусом,
	ячейка \qu{Статус} будет окрашиваться в этот цвет.
\end{description}

%endtopic

\subsection{Применение статусов документов}

Вопрос использования статусов следует разбить на три части:

\begin{itemize}
	\item Какой статус получает новый документ?
	\item Как изменить статус документа?
	\item Как изменить статус множества документов?
\end{itemize}

Причина для столь необычного разбора изменения одного из атрибутов
документа заключается в его своеобразии: статус документа не может
быть установлен либо изменен непосредственно в диалоге документа,
поскольку является административным атрибутом, не влияющим на
объективные особенности документа (каковыми, например, могут быть
названы контрагент, дата и пр.).

И так:

\subsubsection{Какой статус получает новый документ?}

При создании нового документа статус ему присваивается автоматически,
либо не присваивается вовсе.

Система извлекает статус нового документа из вида операции, которому
принадлежит этот документ, или, если в виде операции статус нового документа
не задан, то из конфигурации документов.

Если ни вид операции, ни конфигурация документов не содержат информации о
статусе нового документа, то созданный документ остается с неопределенным
статусом.

\subsubsection{Как изменить статус документа?\label{loc-billstatus-chg}}

Статус одного документа может быть изменен в таблице реестра документов
(стр.~\pageref{loc-billlist-chgstatus}).

Возможность изменения статуса регламентируется правом доступа
по объекту \ppyrsrv{Документы} \dlgflag{Изменение статуса документов}.

\ppypict{dlg-billstatus-chg}{Диалог изменения статуса документа}

Вид диалога изменения статуса документа приведен на рис.~\ref{pic-dlg-billstatus-chg}.

Элементы списка статусов в этом диалоге отсортированы по рангу и наименованию.
То есть, статусы с меньшим рангом предшествуют тем, что имеют большее значение ранга.
Статусы с одинаковым рангом сортируются по наименованию.

\subsubsection{Как изменить статус множества документов?}

Иногда возникает необходимость изменить статусы выборки из нескольких
документов. Это можно сделать с помощью функции изменения флагов
в таблице реестра документов (стр.~\pageref{loc-billlist-chgflags}).

Эта служебная функция предоставляет сервис для изменения системных флагов
документов и статуса выборки документов.

\subsection{Прочие аспекты использования статусов документов}

Важно отметить, что функционал статусов документов не дублирует регламент прав доступа
к документам. А именно:

\begin{itemize}
	\item Ограничение, связанное со статусом, распространяется на конкретный документ,
	в то время как ограничения прав доступа действуют абсолютно на все документы.
	\item Ограничения статуса распространяются на всех пользователей, но права доступа,
	напротив, разделены между пользователями.
	\item Список возможных ограничений, связанных со статусом, значительно отличается от
	аналогичного списка регламентов прав доступа.
\end{itemize}

\subsubsection{Важность прав доступа к объекту \qu{Статусы документов}}

Существуют два способа обойти ограничения по работе с документами, обусловленные
статусами:

\begin{enumerate}
	\item Изменить статус документа.
	\item Изменить запись статуса, к которому относится документ.
\end{enumerate}

Первый способ поддается регламенту благодаря рангу статуса, опции
\dlgflag{Нельзя менять на статус с меньшим рангом} и флагу \dlgflag{Изменение статуса документов}
в правах доступа к документам.

Чтобы исключить второй метод обхода ограничений статуса следует тщательно
следить за правами доступа пользователей к записям статусов документов.

\subsubsection{Статусы документов в системном журнале}

При изменении статуса документа в системный журнал заносится специализированное
событие \qu{Изменен статус документа}.

\section{Реестр документов\label{sec-billlist}}

Реестр документов - это таблица со списком документов, отобранных по фильтру. Все основные
действия с отдельными документами и группами документов осуществляются в реестре документов.
Таким образом, реестр документов одновременно предоставляет средства и для ввода, и
для анализа операций предприятия. Для входа в реестр документов следует выбрать пункт меню,
соответствующий требуемой категории документов (группа меню \ppymenu{Операции}) и заполнить фильтр,
определяющий отбираемые документы и способ просмотра.

%topic(DLG_BILLFLT)

\subsection{Фильтр реестра документов}

\ppypict{dlg-f-003}{Фильтр по товарным документам}

Фильтр по документам имеет вид, показанный на рис.~\ref{pic-dlg-f-003}.
Практически все категории документов используют аналогичные фильтры.
Следующая таблица описывает поля фильтра документов.

\begin{description}
	\item[Период]
	Период, в который должны попадать даты выбираемых документов. Обычно система по умолчанию
	устанавливает текущую операционную дату. Если период не указан, то выбираются документы за
	весь период ведения учета в системе (если администратор ввел для вас ограничение на период
	доступа к документам, то вы не сможете увидеть документы выходящие за этот период).

	Здесь допускается ввод шаблонизированного периода.

	\item[Период даты исполнения]
	Период, в который должны попадать даты исполнения документов, входящих в выборку.

	Здесь допускается ввод шаблонизированного периода.

	\item[\dlgcombo{Вид операции}]
	Указав вид операции, можно сузить выборку документов только теми, которые относятся к
	выбранному виду. Если не указана операция, то отбираются документы, соответствующие
	любым операциям выбранной категории документов.
	Если категория документов содержит только одну операцию, то система автоматически
	вставит ее в это поле.

	Допускается выбор обобщенных видов операций.

	\item[\dlgcombo{Контрагент}]
	Контрагент может быть выбран только в том случае, если выбран вид операции.
	Указание конкретного контрагента позволяет увидеть документы, соответствующие только ему.

	\item[\dlgradioc{Сортировать по}]
	Позволяет выбрать порядок сортировки документов в таблице по:

	\begin{itemize}
		\item Дате - сортирует по выборку по дате
		\item Номеру - сортирует выборку по строке номера документа (в лексикографическом порядке)
		\item Контрагенту - сортирует выборку по наименованию контрагента (документы
		относящиеся к одному контрагенту сортируются по дате).
	\end{itemize}

	\item[\dlgcombo{Дополнительный объект}]
	Это поле, так же как и предыдущее, может быть использовано только тогда, когда явно указан
	вид операции выбираемых документов.

	\item[\dlgcombo{Склад}]
	В комбо-боксе \dlgcombo{Склад} может быть выбран склад, к которому должны относиться показываемые
	документы. Система автоматически вставляет сюда текущий склад.

	Кнопка \dlgbutton{Список} справа от этого комбо-бокса позволяет выбрать список складов, по которым
	система должна отобрать документы.

	Система допускает выбор только того (тех) складов, на которые у пользователя есть права
	доступа.

	\item[Сумма]
	В некоторых случаях требуется отобрать только те документы, номинальная сумма которых
	находится в строго определенном диапазоне. Поле \qu{Сумма} как раз и позволяет задать этот
	диапазон. Нижняя и верхняя граница диапазона должны быть разделены двумя точками.

	Например \qu{12300..12500}.

	\item[\dlgcombo{Статус}]
	Выбрав в этом комбо-боксе один из доступных статусов документов, вы ограничите 	выборку
	только теми документами, у которых установлен соответствующий статус.

	\item[\dlgflag{Показывать долги}]
	При работе с долговыми документами часто необходимо видеть долг контрагента (или перед
	контрагентом) по каждому выводимому документу. Для этого следует включить этот флажок.

	\item[\dlgflag{Только не оплаченные}]
	При включении этого флажка в реестре будут выведены только те документы, которые имеют
	ненулевую сумму долга.

	\item[\dlgflag{Только не отгруженные}]
	Этот флаг доступен только для товарных документов. Если он включен, то будут показаны
	документы, имеющие признак \dlgflag{Отгружен}.

	\item[\dlgflag{Только отгруженные}]
	Так же, как и предыдущий, этот флаг доступен только для товарных документов.
	Если он включен, то в выборку попадут только документы, не имеющие признака \dlgflag{Отгружен}.

	\item[\dlgflag{Только открытые}]
	Данные флаг применим для документов заказов и драфт-документов (на рисунке не показан).
	Если он включен, то выборка включает только документы, не имеющие признак \dlgflag{Закрыт}
	(для документов заказов) или \dlgflag{Списан} (для драфт-документов).

	\item[\dlgcombo{Валюта}]
	При работе с валютными документами этот комбо-бокс позволяет отобрать только документы,
	номинированные в выбранной валюте. Если валюта в этом поле не указана, то реестр покажет
	только документы, номинированные в базовой валюте.

	\item[\dlgflag{Все валюты}]
	При включенном значении этого флажка реестр выведет документы, номинированные в любой
	валюте. При этом таблица будет содержать колонку с символом валюты, соответствующей каждому
	из документов.

	\item[\dlgflag{Новый документ по фильтру}]
	Этот признак относится к действиям, а не к критериям выбора документов. Если вам необходимо
	ввести много однотипных документов, то укажите в фильтре параметры вводимых документов, и
	установите флаг \dlgflag{Новый документ по фильтру}. В этом случае каждый новый документ,
	будет изначально получать некоторые характеристики, соответствующие фильтру (дату, вид
	операции, контрагента, дополнительный объект и склад).

	\item[\dlgflag{Показывать только собственные документы}]
	Если этот флаг установлен, то в таблице будут показаны только те документы, которые были
	созданы под той же учетной записью, под которой вы работаете в текущий момент.
	Этот флаг является частичным представлением критериев, доступных по кнопке \dlgbutton{Период
	создания/изменения}.

	\item[\dlgflag{Показывать документы без агента}]
	Этот флаг позволяет отобрать только те документы, в которых не установлен агент.

	\item[\dlgbutton{Теги}]
	Открывает внутренний фильтр по тегам документов. Подробно фильтр тегов рассмотрен на стр.~\pageref{sec-tagv-filt}.

	\item[\dlgbutton{События}]
	При нажатии на эту кнопку появляется диалог, в котором вы можете выбрать специальные
	критерии отбора документов, основанные на системных событиях, соответствующих документам.
	Эти критерии включают в себя:
	\begin{itemize}
		\item Период наступления событий
		\item Пользователь, под чьим именем зарегистрированы события
		\item Типы событий
	\end{itemize}
	Например, с помощью этой опции, вы можете отобрать документы измененные пользователем
	USER001 с 1/06/2007 по 10/06/2007.

	Подробно о системных событиях см. стр.~\pageref{sec-sj}.

	\item[\dlgbutton{Расширение}]
	По этой кнопке доступен диалог ввода дополнительных параметров отбора документов в реестре.

	\item[\dlgbutton{Опции просмотра}]
	Кнопка отрывает диалог, в котором можно задать дополнительные опции просмотра данных в таблице.

	На текущий момент доступны опции, позволяющие отображать дополнительные столбцы в таблице:
	\begin{description}
		\item[\dlgflag{Дата отгрузки (фрахт)}] Выводит столбец даты отгрузки из фрахта документа. Столбец
		появляется после даты документа или (если задана соответствующая опция, описанная ниже) после
		даты исполнения.
		\item[\dlgflag{Дата прибытия (фрахт)}] Выводит столбец даты прибытия из фрахта документа. Столбец
		появляется после даты отгрузки или на месте, описанном выше.
		\item[\dlgflag{Дата исполнения}] Выводит колонку, в которой отображается дата исполнения документа.
		Колонка появляется после столбца даты документа.
		\item[\dlgflag{Агент}] Выводите колонку с наименованием агента по документа.
		Колонка отображается следующей по порядку после колонки контрагента.
		\item[\dlgflag{Адрес доставки}] Выводите колонку адресом доставки документа
		из фрахта.
	\end{description}
\end{description}

%topic(DLG_BILLEXTFLT)

\subsubsection{Расширение фильтра по документам\label{sec-billfilt-ext}}

\ppypict{dlg-f-billext}{Диалог расширения фильтра документов}

В расширение фильтра по документам вынесены некоторые редко используемые критерии отбора
документов. Диалог расширения показан на рис.~\ref{pic-dlg-f-billext}.

\begin{description}
	\item[\dlgcombo{Плательщик}]
	В этом комбо-боксе вы можете указать плательщика. При этом будут отобраны только те
	документы, в которых плательщик соответствует выбранному.

	\item[\dlgcombo{Агент}]
	Комбо-бокс \dlgcombo{Агенты} позволяет отобрать документы, которые выписаны через выбранного
	агента. Это может понадобиться в тех случаях, когда ваше предприятие реализует свою
	продукцию через торговых агентов.

	Если вы хотите отобрать только те документы, в которых агент не указан, то
	установите флаг \dlgflag{Показывать документы без агента} в заголовочном
	диалоге фильтра (см.выше).

	\item[\dlgcombo{Пользователь, создавший документ}]
	Выбрав в этом комбо-боксе пользователя, вы предпишите системе показывать только те
	документы, которые были созданы этим пользователем.
	Обратите внимание на то, что речь идет о пользователе, создавшем документ. Изменить
	документ при наличии прав доступа может любой другой пользователь.

	Кроме собственно пользователя, здесь может быть выбрана группа, тогда документы
	будут фильтроваться по критерию принадлежности пользователя, создавшего документ,
	выбранной группе.

	\item[Период даты исполнения]
	Если здесь задан не пустой период, то выборка будет содержать только
	те документы, дата исполнения которых попадает в этот период.

	Критерий может быть полезен для работы с драфт-документами и товарными
	заказами. В других категориях документов редко используется дата исполнения.

	Здесь допускается ввод шаблонизированного периода.

	\item[\dlgradioc{Переключатель налога с продаж}]
	С помощью этого переключателя вы можете выбрать документы по критерию установленного
	либо снятого признака обложения документа налогом с продаж.

	\item[\dlgradioc{Переключатель 'Отклонен'}]
	Переключатель позволяет ограничить выборку документов только теми, у которых установлен или
	снят признак 'Отклонен'.

	По умолчанию, документы отображаются не зависимо от этого признака (позиция \dlgradioi{Все равно}).

	\item[\dlgradioc{Переключатель 'Статус EDI RECADV'}]
	Дает возможность фильтровать выборку документов по состоянию ответа от получателя на отправленный
	по каналу EDI или ЕГАИС документ.

	Возможные варианты:
	\begin{description}
		\item[Все равно] Не обращать внимание на состояние ответа от получателя.
		\item[Принят] Показывает только те документы, на которые от получателя получен ответ "Принят".
		\item[Частично принят] Показывает только те документы, на которые от получателя получен акт
		рассогласования по некоторым позициям.
		\item[Отклонен]	Показывает только те документы, которые получатель полностью отклонил.
		\item[Не определен]	В выборку попадают только документы с не определенным состоянием ответа
		от получателя.
	\end{description}
	\item[\dlgradioc{Переключатель 'Статус подтверждения на EDI RECADV'}]
	Позволяет фильтровать выборку по состоянию вашего подтверждения на ответ от получателя на
	отправленный до каналу EDI или ЕГАИС документ.

	\begin{description}
		\item[Все равно] Не обращать внимание на состояние ответа от получателя.
		\item[Принят] Показывает только те документы, для которых вы приняли ответ от получателя.
		\item[Отклонен] Показывает только те документы, для которых вы отклонили ответ от получателя.
		\item[Не определен]	Показывает документы, для которых состояние вашего ответа на
		подтверждение от получателя не определено.
	\end{description}
\end{description}

%endtopic

\ppynote{
	Очень часто пользователи, особенно начинающие, допускают следующую ошибку: вводят новый
	документ, параметры которого не соответствуют фильтру, по которому отбираются видимые в
	текущий момент документы. При этом они, конечно, не могут сразу увидеть документ, который
	ввели, из-за чего думают, что документ вообще не был проведен.

	То, что документ не виден в текущей выборке реестра документов, не означает, что он вообще
	не существует.
}

\ppyadmin{
	Обратите внимание на флаг \dlgflag{Предупреждать о вводе документа не соответствующего фильтру} в
	конфигурации документов.
}

\subsubsection{Особенности фильтра по документам}

Следует обратить внимание на различие между пользователем, создавшим документ и пользователем во
встроенном фильтре по системному журналу. Эти фильтрующие критерии не являются взаимозаменяемыми
(однако, могут конфликтовать друг с другом).

Одним из атрибутов документа является пользователь, который его создал. То есть, выбирая в расширении
фильтра пользователя, создавшего документ, вы фильтруете реестр документов по этому атрибуту.

С другой стороны, при создании и любых изменениях документа, в системном журнале
формируются записи событий. Фильтрация по периоду создания/изменения как раз и
предполагает отбор документов по этим записям. Таким образом, вы можете отфильтровать
документы, созданные пользователем $X$ и измененные пользователем $Y$.
Если же вы попытаетесь отфильтровать документы по пользователю $X$, создавшему документ,
и пользователю $Y$, фигурирующему в системном событии \ppyrsrv{Добавлен документ}, то,
несмотря на значительное время, требуемое системе для вычисления результата выборки,
она будет пустая. Это - случай явного конфликта критериев.

Специальный аспект производительности выборки документов с фильтрацией по
агенту или плательщику обсуждается в описании общих настроек системы на стр.\pageref{loc-commcfg-sys-01}.

\subsection{Таблица документов\label{sec-ppview-bill}}

\ppypictsc{brw-011}{Товарные документы}{0.6}

После того, как вы заполнили фильтр по документам и нажали кнопку \dlgbutton{ОК}, система
покажет на экране таблицу, в которой можно видеть все документы, соответствующие фильтру.
Эта таблица, в зависимости от условий отбора может иметь несколько различных видов. Типичный
вид таблицы документов показан на рис.~\ref{pic-brw-011}.

\subsubsection{Цветовое выделение элементов таблицы}

В этой таблице применяются следующие особенности цветового выделения элементов:

\begin{itemize}
	\item Колонка ИД

		\begin{description}
			\item[голубой угол (Dodgerblue)]
			Только для пользователя \ppyrsrv{Master}. Если документ принят из другого раздела
			функцией синхронизации и полностью синхронизирован (включая синхронизацию лотов).
		\end{description}
	\item Колонка Номер документа

		\begin{description}
			\item[Вся ячейка синяя (Blue)] Документ имеет признак \qu{Отгружен}.
			\item[Угол лимонного цвета (Lime)] Документ принят с BHT-терминала.
			\item[Левый нижний угол пользовательского цвета] Документ имеет тег, удовлетворяющий условиям
			отображения цвета, заданным в конфигурации документов. Подробнее см. стр.~\pageref{sec-bill-cfg}.
		\end{description}
	\item Колонка Примечание

		\begin{description}
			\item[темно-зеленый угол (Darkgreen)] Документ имеет одно или более расширенных примечаний.
		\end{description}

	\item Колонка Контрагент

		\begin{description}
			\item[коралловый угол (Coral)] Контрагент по документу имеет признак \ppyrsrv{STOP}.
		\end{description}

	\item Колонка Статус

		\begin{description}
			\item[серый угол (Grey)] Только для драфт-документов. Документ имеет признак \qu{Отклонен}.
			\item[оранжевый угол (Orange)] Только для драфт-документов. Документ списан.
			% \item[оранжевый угол (Orange)] Только для драфт-документов. Документ списан.
			\item[желтый кружок (Yellow)] Документ имеет статус с признаком \qu{Готов для отправки по каналу EDI}
			и одновременно тег \ppyrsrv{EDIACKBILL}. В применении к ЕГАИС это означает, что документ был успешно
			достален до УТМ (но не до ЕГАИС).

			\item[оранжевый кружок (Orange)] Документ имеет статус с признаком \qu{Готов для отправки по каналу EDI}
			и одновременно имеет тег \ppyrsrv{EDIIDENTBILL}. В применении к ЕГАИС это означает, что документ
			был доставлен до сервера ЕГАИС, который, в свою очередь, присвоил ему собственный номер.

			\item[зеленый кружок (Green)] Для отправляемых по каналу EDI документов это означает, что
			в ответ от контрагента было получено подтверждение приемки товара.

			Если вы получили это документ по каналу EDI, то такой цветовой индикатор означает, что вы
			подтвердили приемку этого документа.

			\item[светло-зеленый кружок (Lightgreen)] Для отправляемых по каналу EDI документов это означает, что
			в ответ от контрагента было получено подтверждение частичной приемки товара.

			Если вы получили это документ по каналу EDI, то такой цветовой индикатор означает, что вы
			частично подтвердили приемку этого документа.

			\item[коричневый кружок (Brown)] Для отправляемых по каналу EDI документов это означает, что
			в ответ от контрагента был получен отказ в приемки документа.

			Если вы получили это документ по каналу EDI, то такой цветовой индикатор означает, что вы
			отказались принимать этого документа.
		\end{description}
\end{itemize}

\subsubsection{Автоматическое обновление таблицы}
Таблица документов относится к группе автоматически обновляемых. То есть, каждые
несколько секунд программа обновляет видимую область таблицы для того, чтобы
в ней отобразились изменения, сделанные другими пользователями.

\subsection{Действия над документами и реестрами документов}

Следующая таблица перечисляет действия, которые могут быть выполнены над отдельными документами
и всем реестром документов в таблице реестра документов.

	\paragraph{Редактировать документ}\indent\keyb{Enter}
	Это действие подразумевает открытие диалога редактирования текущего документа. Внешний
	вид этого зависит от вида операции, к которой относится документ.
	Если у вас нет прав доступа на редактирование выбранного документа, то система сообщит
	об этом.

	\paragraph{Добавить документ}\indent\keyb{Insert}
	При обращении к этой команде вы сможете создать новый документ. Как правило, перед
	непосредственным вводом нового документа, система запрашивает вид операции, к которому
	должен относиться документ.

	\paragraph{Добавить документ по образцу}\indent\keyb{Alt-F2}
	Создание документа по образцу позволяет быстро создать аналог выбранного документа.
	При этом в новый документ копируется вид операции, склад, дата и контрагент выбранного
	документа. В зависимости от вида операции, к которой принадлежит текущий документ, может
	появится диалог, уточняющий это действие. Например, при выборе создания документа по
	образцу заказа система предлагает либо создать аналогичный заказ или создать документ
	отгрузки товара покупателю по выбранному заказу.

	Создание документов по образцу заказа и приходного товарного документа имеют ряд
	специальных опций и особенностей, описанных ниже.

	Подробно о создании документа по образцу заказа см. стр.~\pageref{loc-addbillbysample-order}.

	\paragraph{Удалить документ}\indent\keyb{Delete}
	Так как удаление документа является необратимым (документ нельзя после этого восстановить),
	система предварительно запрашивает подтверждение на это действие.

	Не всякий документ может быть удален, так как некоторые из них имеют зависимые документы,
	логическая целостность которых может быть нарушена при его удалении.

	Например, если оприходованный товар уже продавался, то удалить такой приход невозможно
	до тех пор, пока не будут удалены все документы расхода товаров,
	поступивших по этому документу.

	\paragraph{Удаление всей выборки}\indent\keyb{Ctrl-F8}
	Очень опасное действие. При его реализации все документы текущей выборки будут полностью
	удалены из базы данных.

	По этой причине система выдает особо строгое предупреждение после
	того, как вы обратитесь к этой команде. Кроме того, права доступа специально
	регламентируют возможность удаления выборки документов для конкретных пользователей.

	Если какие-либо документы из выборки не могут быть удалены по причине возможного
	нарушения целостности остальных объектов данных, то они остаются не удаленными,
	однако, когда программа встречает такой документ, она не прерывает выполнения,
	а продолжает попытки удалить следующие документы.

	\paragraph{Расширение данных документа}\indent\keyb{F4}
	Эта функция позволяет редактировать некоторые параметры документа, не
	открывая документ полностью.

	Вот список полей, которые доступны для просмотра и редактирования при
	обращении к этой функции:
	\begin{itemize}
		\item Дата оплаты
		\item Плательщик
		\item Агент
		\item Котировка для дополнительной цены
		\item Номер счета-фактуры
		\item Дата счета-фактуры
	\end{itemize}

	\paragraph{Фрахт документа}\indent\keyb{Ctrl-F4}
	Функция дает возможность изменить параметры фрахта, независимо от остальной
	части выбранного документа.

	Доступность функции регламентируется флагом прав доступа \dlgflag{Модификация фрахта}
	по объекту \ppyrsrv{Документы}. Подробно о правах доступа к документам см. стр.~\pageref{sec-billrt}.

	\paragraph{Добавить документ по карте}\indent\keyb{F2}
	Специализированная функция, позволяющая ускорить ввод документов, привязанных к персональной карте.

	После вызова этой функции появится диалог, в котором можно ввести
	номер карты, а затем - диалог, в котором выбирается вид операции и, возможно,
	проверяется пароль по введенной карте.

	Вид операции можно выбрать из списка, в котором отображаются только те
	виды, которые сопоставлены с таблицами аналитических статей, имеющих
	статью, соответствующую персоналии, связанной с выбранной картой.
	То есть, система поддерживает следующую цепочку отношений:

	\indent Выбранная персональная карта
	\newline$\gggtr$ \indent\indent персоналия, связанная с картой
	\newline$\gggtr$ \indent\indent\indent список аналитических статей, связанных с персоналией
	\newline$\gggtr$ \indent\indent\indent\indent таблицы аналитического учета, соответствующие этим статьям
	\newline$\gggtr$ \indent\indent\indent\indent виды операций, с которыми связаны эти таблицы аналитического учета.

	При выборе вида операции и нажатии \dlgbutton{ОК} откроется диалог редактирования нового
	документа, в котором уже будет установлен контрагент и, если в выбранной карте определена
	процентная скидка, то и скидка на весь документ.

	\paragraph{Просмотр товарных строк документа}\indent\keyb{F3}
	Быстрый просмотр позволяет просмотреть строки товарных документов без возможности
	редактирования документа.

	\paragraph{Проводки по документу}\indent\keyb{Ctrl-A}
	Используя эту команду, вы можете увидеть (только для просмотра, не для редактирования)
	список бухгалтерских проводок, соответствующих выбранному документу.

	\paragraph{Изменение статуса документа}\indent\keyb{Ctrl-F6}\label{loc-billlist-chgstatus}
	Вызывает диалог изменения статуса документа.

	Эта функция доступна только в том случае, если пользователю назначено
	право \dlgflag{Изменение статуса документа}.

	Дополнительные подробности об изменении статуса документа вы можете найти
	на стр.~\pageref{loc-billstatus-chg}.

	\paragraph{Просмотр системной информации по документу}\indent\keyb{Ctrl-F3}
	Специальная функция, позволяющая увидеть некоторые системные параметры выбранного документа.

	Право использования этой функции регламентируется флагом \dlgflag{Системная информация}
	в правах доступа к документам.

	\paragraph{Просмотр событий по документу}\indent\keyb{Ctrl-J}
	С помощью этой функции можно увидеть историю операций над выбранным документом. Для более
	подробной информации обратитесь к разделу, посвященному системному журналу.

	\paragraph{Изменить флаги}\indent\keyb{Shift-F3}\label{loc-billlist-chgflags}
	Специальная функция, позволяющая изменить системные признаки для всей выборки документов.
	Ни в коем случае не используйте это действие, не проконсультировавшись с лицом или фирмой,
	сопровождающей систему на вашем предприятии.

	Право доступа к этой функции регламентируется флагом \dlgflag{Массовое изменение выборки}
	в правах доступа к документам.

	\paragraph{Пометить}\indent\keyb{F8}
	Устанавливает WL-метку на документ. Для документов, имеющих такую метку, первым символом
	номера следует '!' (знак восклицания).

	Если выбранный документ уже имеет WL-метку, то вызов этой функции снимает ее.

	Право применения этой функции определяется флагом \dlgflag{Использование WL}
	в правах доступа к документам.

	\paragraph{Оплаты по документу}\indent\keyb{F5}
	Это действие приводит к появлению таблицы просмотра и редактирование оплат и возвратов
	текущего документа.

	\paragraph{Зачеты по документу}\indent\keyb{F6}
	Это действие приводит к появлению таблицы просмотра и редактирование зачитывающих документов для текущего документа.

	\paragraph{Начисление по ренте}\indent\keyb{Shift-F5}
	При вызове этой функции система покажет документы начисления ренты по выбранному документу.

	\paragraph{Возврат по документу}\indent\keyb{Ctrl-F5}
	Для категории товарных документов. Это действие позволяет создать документ возврата товара
	отгруженного или оприходованного выбранным документом.

	\paragraph{Зачет платежного документа}\indent\keyb{Ctrl-P}
	Команда позволяет зачесть платежный документ, проведя привязанные к нему оплаты долговых
	документов. При прямом зачете, если вид операции позволяет, можно зачесть долговые
	документы другого контрагента (так называемый, тройной взаимозачет).

	\paragraph{Зачет долгового документа}\indent\keyb{Ctrl-E}
	Это действие позволяет автоматически оплатить долговой документ, если существуют зачетные документы по этому же контрагенту.

	\paragraph{Сравнение документов}\indent\keyb{Ctrl-C}
	Функция применима к списанным драфт-документам, документам списания драфт-документов,
	а также для документов подтверждений.

	При вызове функции система определяет для выбранного документа парный и, если
	такой существует, выводит таблицу сравнения товарных строк этих двух документов.

	\paragraph{Вид  операции}\indent\keyb{Ctrl-Q}
	Открывает диалог редактирования вида операции, к которому относится выбранный
	документ.

	\paragraph{Объединение документов}\indent\keyb{Ctrl-U}
	Это действие возможно при выполнении следующих условий:
	\begin{itemize}
		\item В фильтре, по которому построена выборка, определен вид операции.
		\item В фильтре, по которому построена выборка, определен контрагент, либо, выбранный вид операции не предусматривает контрагента,
		либо этот вид операции - инвентаризация.
		\item Пользователь имеет права на объединение документов.
	\end{itemize}

	Функция объединяет всю выборку документов в один - самый первый документ выборки.

	Данная операция является потенциально опасной, поскольку ее результат не может быть
	отменен (разобрать полученный единственный документ автоматически не возможно).
	Именно по этому в правах доступа по документам предусмотрен отдельный пункт,
	регламентирующий возможность ее выполнения, и по этой же причине система
	запрашивает дополнительное подтверждение от пользователя.

	\paragraph{Анализ товарных операций}\indent\keyb{Ctrl-T}
	Формирует отчет анализа товарных операций по всей выборке документов.

	Подробно об анализе товарных операций см. стр.~\pageref{sec-trfranlz}.

	\paragraph{Привязать документ к заказу}\indent\keyb{Ctrl-Y}
	Если выбранный документ относится к виду операции с опцией
	\dlgflag{Отгрузка по заказу}, то вызов этой команды приведет к тому,
	что на экране появится таблица со списком открытых документов
	заказа по тому же контрагенту, что и у выбранного документа.
	Вы сможете выбрать из этой таблицы любой заказа и тогда система
	свяжет отгрузку с этим документом заказа.

	\paragraph{Печать текущего документа}\indent\keyb{F7}
	В зависимости от вида операции, к которой относится выбранный документ, это действие
	позволяет распечатать форму первичной отчетности, соответствующую документу. Например,
	для товарного документа, это может быть накладная или счет-фактура, для бухгалтерского -
	кассовый ордер, авансовый отчет и пр. Если возможен выбор, то система выдаст диалог,
	позволяющий вам выбрать ту форму которая необходима в данный момент.

	\paragraph{Печать выборки документов}\indent\keyb{Alt-F7}
	Вывод на печать списка всех документов из реестра. Форма вывода на печать зависит от
	параметров отбора документов, заданных в фильтре.

	\paragraph{Печать информации о выборке документов}\indent\keyb{Shift-F7}

	\paragraph{Печать чека на POS-принтер}\indent\keyb{Ctrl-Z}\label{ppvbill-posprint}

	Функция позволяет отпечатать кассовый чек, соответствующий выбранному документу,
	на фискальном регистраторе. Физически в базе данных не создается кассового чека
	для этого документа. На фискальный регистратор отправляется образ документа
	в виде чека.

	Функция бывает нужна в тех случаях, когда вы выписываете документ, предусматривающий
	наличную оплату, и должны отпечатать по нему фискальный чек.

	Естественно, если для вашего предприятия такие операции являются правилом, а не
	редкой необходимостью, то правильнее использовать специализированные инструменты,
	предоставляемые системой (панель чеков, кассовые сессии и т.д.).

	Технически, при обращении к этой функции происходит следующее:
	\begin{itemize}
		\item Система пытается идентифицировать кассовый узел, к которому следует
		обратиться за сервисом печати чеков. Для этого такой кассовый узел должен
		быть определен в конфигурации документов, либо задан в командной строке
		при запуске сеанса опцией $BILLCASH$. Второй вариант является приоритетным.
		То есть, если задана опция командной строки и определен кассовый узел по
		умолчанию, то для печати чека применяется тот кассовый узел, который задан
		в командной строке.
		\item Если для вида операции, которому принадлежит документ не установлена
		опция печати \dlgflag{Печатать чек по документу}, то печать не осуществляется.
		\item Если по документу уже был отпечатан чек, то новый чек система не
		отправит на фискальный регистратор. Здесь есть одно исключение: если вы
		авторизовались в базе данных с именем master, то повторная печать возможна,
		но с предварительным подтверждением.
		\item Для товарных и драфт-документов если в опциях печати вида операции
		установлен флаг \dlgflag{Печатать чек по документу с товарными строками},
		то на фискальный регистратор отправляются вся товарные строки документа.

		В противном случае - только итоговые суммы по документу.
		\item Если печать чека по документу успешно завершилась, то документу
		присваивается специальный флаг \dlgflag{Отпечатан чек} и в системный
		журнал заносится событие \ppyrsrv{По документу отпечатан кассовый чек}
		(объектом этого события выступает сам документ, а дополнительное значение
		равно идентификатору кассового узла, который предоставлял сервис печати
		чека).
	\end{itemize}

	\paragraph{Печать нулевого чека}\indent\keyb{Alt-Minus}

	\paragraph{Печать всех документов}\indent\keyb{Ctrl-S}
	Вызывает функцию печати первичных отчетов по всей выборке документов.

	\paragraph{Печать чека}\indent\keyb{Ctrl-F7}

	\paragraph{Итоги по выборке}\indent\keyb{F9}
	См. ниже

	\paragraph{Расчет НДС по выборке}\indent\keyb{Ctrl-F9}
	Расчет НДС по выборке представляет довольно редко используемую опцию, позволяющую получить
	детальный отчет по суммам НДС, начисляемых и зачитываемых текущей выборкой документов.
	Для правильного расчета этих сумм вы должны соответствующим образом выбрать условия
	фильтрации документов.

	\paragraph{Передать выборку документов}\indent\keyb{Ctrl-H}
	Эта функция нужна тогда, когда вы хотите передать всю выборку документов в другой раздел
	базы данных.

	\paragraph{Передать документы Charry}\indent\keyb{Ctrl-B}

	\paragraph{Экспорт документов}\indent\keyb{Ctrl-R}

	\paragraph{Экспорт в ЕГАИС}\indent\keyb{Ctrl-F10}

	\paragraph{Экспорт платежных поручений}\indent\keyb{Ctrl-L}\label{loc-viewbill-clibnkexp}
	Экспортирует все платежные поручения, привязанные к документам выборки в файл
	для передачи в систему клиент-банк. Естественно, если каким либо документам
	выборки не сопоставлены платежные поручения, то для этих документов
	ничего не происходит.

	После вызова функции, если существует более одной конфигурации экспорта,
	появляется диалог, позволяющий выбрать конкретную конфигурацию.

	В случае, если существует только одна такая конфигурация, то диалог
	выбора не появляется, но сразу запускается процедура экспорта.

	Если же не настроено ни одной конфигурации, то выдается соответствующее
	сообщение об ошибке.

	Подробно о настройке экспорта в системы клиент/банк см. стр.~\pageref{sec-clibnk}.

	\paragraph{Обновить список}\indent\keyb{Ctrl-V}
	Обновление выборки документов просто приводит выборку в соответствие с изменившейся
	ситуацией. Так, если вы хотите увидеть документы, которые появились в базе данных после
	того, как вы нажали кнопку \dlgbutton{ОК} в фильтре по документам (например в результате работы
	операторов или приема данных из другого раздела), то выберите эту команду.

	\paragraph{Редактирование примечаний}\indent\keyb{Ctrl-M}
	Эта функция позволяет создавать и редактировать дополнительные примечания к
	выбранному документу.

	Если на момент обращения к функции с документом не было связано ни
	одного дополнительного примечания, то появится окно с полем ввода
	нового примечания.

	Если же с документом уже было связано хотя бы одно примечание,
	то открывается диалог списка примечаний для редактирования,
	создания или удаления примечаний.

	Документы, к которым привязаны дополнительные примечания, выделяются в
	таблице окрашенным левым верхним углом в колонке \qu{Примечание}.

	При наведении курсора мыши на эту ячейку открывается небольшое
	окно, в котором помещается текст дополнительных примечаний.

	\paragraph{Редактировать документ подтверждения}\indent\keyb{Ctrl-K}

	\paragraph{Удалить документ подтверждения}\indent\keyb{Ctrl-D}

\subsubsection{Итоги по документам}

\ppypict{dlg-029}{Диалог итогов по выборке документов}

Расчет итогов позволяет увидеть обширную итоговую по выборке документов. Вид
панели итогов реестра документов показан на рис.~\ref{pic-dlg-029}.
Здесь представлены следующие элементы:

\begin{itemize}
	\item Общее количество
	\item Номинальную сумму документов реестра
	\item Сумма долга по всем документам реестра (имеет смысл только при соответствующей
	выборке документов).
	\item Список сумм документов выборки.
\end{itemize}

Кнопка \dlgbutton{Печать\dots} позволяет отправить на печать итоговые данные.

Стандартная форма отчета итогов: BillTotal.

\section{Администрирование документов}

Поскольку документы - это центральное понятие в системе \ppybrand{}, то и настройка и
администрирование документов является обширным и сложным разделом. Здесь мы рассмотрим
темы прав доступа к документам, параметров настройки документов, а также опишем особенности
документов как объектов данных.

Следует заметить, что существенную роль в использовании документов играет правильная настройка
видов операций и других справочников, имеющих прямое или косвенное отношение к документам.

\subsection{Особенности документов как объектов данных}

\subsubsection{Блокировка документов}

При открытии документа для редактирования каким-либо из пользователей этот документ
блокируется системой для того, чтобы другие пользователи не могли открыть этот же
документ для редактирования. Целью такой блокировки является не допущение конфликтной
ситуации, при которой пользователь изменяет документ состояние которого в базе данных
уже изменилось.

\subsubsection{Системные события по документам}

Типы событий, вносимых в системный журнал, при операциях с документами отличаются от
аналогичных для остальных типов объектов данных. Перечислим и кратко опишем
все возможные типы таких системных событий.

\begin{description}
	\item[Документ создан (3)]
	Формируется при успешном проведении нового документа.

	Этот тип события аналогичен \ppyrsrv{Объект создан}, используемому
	для остальных типов объектов данных.

	\item[Документ изменен (4)]
	Формируется при успешном сохранении в базе данных
	изменений существующего документа.

	Дополнительный идентификатор события определяет
	ссылку на запись версии документа до изменения (при условии,
	что функция истории документов включена).

	Этот тип события аналогичен \ppyrsrv{Объект изменен}, используемому
	для остальных типов объектов данных.

	\item[Документ удален (5)]
	Формируется при успешном удалении документа.

	Дополнительный идентификатор события определяет
	ссылку на запись версии документа до изменения (при условии,
	что функция истории документов включена).

	Этот тип события аналогичен \ppyrsrv{Объект удален}, используемому
	для остальных типов объектов данных.

	\item[Документ отпечатан (6)]
	Не используется.

	\item[Изменена привязка персональной карты (20)]
	Этот тип события информирует о том, что при изменении документа
	была изменена привязка его к персональной карте.

	Дополнительный идентификатор события определяет ссылку на
	персональную карту, которая была связана с документом до его изменения.

	\item[Изменен статус документа (22)]
	Формируется при изменении статуса документа.

	Дополнительный идентификатор определяет значение статуса,
	который документ имел до изменения.

	\item[Документ исправлен функцией восстановления (36)]
	Единственный случай формирования такого события - автоматическая корректировка
	оплат с висящей ссылкой на долговой документ
	(\ppymenu{Админ\rdir Корректировка\rdir Поиск оплат без связанного документа}).

	\item[Списание инвентаризации (37)]
	Документ инвентаризации был успешно списан.

	\item[Откат списания инвентаризации (38)]
	Был осуществлен успешный откат списания инвентаризации.

	\item[Загрузка инвентаризации из терминала (39)]
	Документ инвентаризации был принят с терминала сбора данных.

	\item[Объединение инвентаризаций (40)]
	Формируется при успешном объединении нескольких документов инвентаризации
	в один.

	\item[По документу отпечатан кассовый чек (47)]
	Формируется при печати кассового чека через синхронный кассовый узел
	(обычно на фискальный регистратор).

	\item[Изменено расширенное примечание по объекту (48)]
	Формируется при создании или изменении расширенного примечания к документу.

	\item[Изменено расширение документа (49)]
	Событие возникает при успешном изменении расширения документа в обход
	основной части документа.

	Это событие может инициироваться при одиночном или массовом
	изменении расширенных атрибутов документа из таблицы документов, если
	при этом основная часть документа не модифицируется. Например в случае,
	если вы меняете только агента по документу.

	\item[Создан документ инвентаризации (52)]
	Так как инвентаризация является обособленным типом документов, то
	для нее существует отдельное событие, фиксируемое при создании нового
	документа инвентаризации.

	\item[Изменен фрахт документа (54)]
	Событие возникает при успешном изменении фрахта документа в обход остальных
	частей документа. При этом дополнительное значение события равно нулю.

	Если был изменен (установлен либо снят) признак документа \qu{Отгружен}, то так же создается событие
	\ppyrsrv{Изменен фрахт документа}, но с дополнительным параметром равным 1.

	\item[Изменен контрагент по документу (55)]
	Событие возникает при изменении существующего документа, если при этом
	был изменен основной объект документа (контрагент).

\end{description}

\subsubsection{Синхронизация документов между разделами базы данных}

Документы, будучи сложными объектами данных, обладают значительным числом особенностей
при синхронизации между разделами базы данных.

\paragraph{Документы не имеют правил контекстной синхронизации}
Это значит, что система при приеме нового документа из другого раздела не
пытается синхронизировать его с каким-либо из существующих документов иначе
как по таблице синхронизации.

Практически, это означает, что нельзя одновременно завести один и тот же по сути
документ в разных разделах и надеяться на то, что при синхронизации система как-то
сумеет узнать, что эти документы - суть одно и то же.

Естественно, системная синхронизация остается в силе. То есть, однажды принятый
документ не будет дублироваться при последующих приемах этого же документа.

%\paragraph{Изменения в строках товарных документов не передаются}
%Это - наиболее \qu{шокирующая} особенность. Означает она то, что передав товарный
%документ в другой раздел и изменив его после этого, вы не сможете рассчитывать на
%успешную передачу сделанных изменений. Единственный способ все-таки обеспечить
%принимающий раздел актуальной копией документа - удалить документ в том разделе
%и принять снова уже измененный вариант документа. Однако, это меру можно рассматривать
%только как аварийную, но не как способ регулярной работы.
%
%Обратим внимание на то, что описанная особенность касается только учетных
%товарных документов. То есть, относящихся к следующим типам операций:
%
%\begin{itemize}
	%\item \ppyrsrv{Приход товара}
	%\item \ppyrsrv{Расход товара}
	%\item \ppyrsrv{Переоценка}
	%\item \ppyrsrv{Модификация товара}
	%\item \ppyrsrv{Возврат}
	%\item \ppyrsrv{Заказ}
	%\item \ppyrsrv{Инвентаризация}
%\end{itemize}
%
%Изменения строк драфт-документов передаются.
%
%\paragraph{Изменения некоторых атрибутов товарных документов принимаются}
%
%Вот список атрибутов товарных документов, изменения которых принимаются:
%\begin{itemize}
	%\item Все атрибуты расширения документа:
	%\begin{itemize}
		%\item Плательщик
		%\item Агент по документу
		%\item Номер счета-фактуры
		%\item Дата счета-фактуры
		%\item Номер платежного документа
		%\item Дата платежного документа
		%\item Вид дополнительной котировки по документу
	%\end{itemize}
	%\item Параметры фрахта
	%\item Признак отгрузки документа
	%\item Дополнительный объект документа
	%\item Ручные суммы документа
	%\item Статус документа
%\end{itemize}
%
%Уточним, что изменения приведенных атрибутов
%принимаются для документов, принадлежащих следующим типам операций
%
%\begin{itemize}
	%\item \ppyrsrv{Приход товара}
	%\item \ppyrsrv{Расход товара}
	%\item \ppyrsrv{Модификация товара}
%\end{itemize}
%
%Для типов операций, не вошедших в этот список, но включенных в список
%предыдущего параграфа (например \ppyrsrv{Инвентаризация}) никакие изменения не принимаются.

\paragraph{Передача изменений товарных документов}
Начиная с версии 8.0.3 \ppybrand{} научился принимать изменения товарных документов. Тем не менее, это сопряжено с рядом
условий:
\begin{itemize}
	\item Все лоты, к которым привязаны строки передаваемых документов должны быть синхронизированы (речь идет о лотах, которые
	документ не генерирует сам, но использует).

	Для того, чтобы система синхронизировала лоты необходимо, как минимум, установить флаг \dlgflag{Синхронизировать лоты} в
	системных параметрах общих настроек (стр.~\pageref{sec-commcfg-sys}).

	\item Документ, подлежащий изменению, должен быть полностью синхронизирован. Это значит, что при предшествующем приеме,
	система смогла сформировать точно такой же, с точностью до строки, документ, какой был передан.

	В качестве примера ситуации при которой документ может быть не полностью синхронизирован можно привести вариант, когда строка исходного
	документа была принята двумя строками из-за того, что в синхронизированном лоте был не достаточный остаток для списания и пришлось
	использовать другой лот.

	\item Из предыдущего пункта следует, что товарных документ, сформированный любым способом, отличным от акцепта из другого
	раздела, точно не будет изменен при синхронизации, поскольку признак \qu{Полностью синхронизирован} устанавливается только при приеме
	в процессе синхронизации.

	Возможно, в дальнейшем, это правило будет пересмотрено.
\end{itemize}

\paragraph{Отдельное замечание по поводу изменения признака \dlgflag{Отгружен} при передаче документа}

До версии 6.9.7 этот признак безусловно передавался. Начиная с версии 6.9.7 при акцепте
изменения документа, данный флаг устанавливается, если в разделе-приемнике он не был
установлен (в разделе-отправителе - установлен). Если же в разделе-приемнике флаг \dlgflag{Отгружен}
уже установлен, то отсутствие флага в документе, пришедшем из другого раздела, не приведет к
снятию флага в существующем документе.

\paragraph{Прием товарных документов из другого раздела сопряжен с риском дефицита остатков}
Если учетные остатки между разделом-отправителем и разделом получателем по складу,
к которому относится принимаемый товарный документ, расходятся, то возникает вероятность
невозможности приема полного расходного документа из-за того, что остаток какого-либо товара
будет недостаточен.

Существует несколько способов избежать либо решить проблему дефицита при приеме
товарных документов:

\begin{itemize}
	\item Самое простое (и правильное) это - обеспечить хронологическую организацию
	работы. То есть, избегать правки уже переданных документов и обмениваться документами
	\qu{день-в-день}.

	\item При возникновении дефицита оперативно находить и устранять расхождение
	в остатках между разделами.

	\item Система позволяет принять неполные документы. Это - крайне не желательный
	способ, приводящий к еще большему усугублению расхождений учета между разделами.
	К тому же он приводит к несоответствию в документообороте.

	Использование этого метода регламентируется флагом \dlgflag{Не принимать неполные документы}
	в конфигурации обмена данными (см. стр.~\pageref{sec-dbxchg-cfg}).

	\item Еще один метод \qu{грубой силы} заключается в том, чтобы заставить систему
	оприходовать товары, которых не хватает для приема расходных документов.
	Этот способ, так же, как и предыдущий является нежелательным. Хотя он и не приводит
	к расхождению в суммах и структуре принимаемых документов, но формирует фиктивные остатки,
	от которых очень сложно избавляться.

	Заметим, что существует область использования функции доприходования дефицита,
	которая рассматривает эту функцию как штатную, а не как аварийную. Речь идет
	о специализированном разделе базы данных, в который нарочито принимаются только
	расходные документы, а приход формируется автоматически.
\end{itemize}

\subsection{Права доступа к документам\label{sec-billrt}}

Система \ppybrand{} включает следующие способы ограничения прав доступа к документам:

\begin{description}
	\item[Период доступа к документам на чтение]
	Период, в который попадают даты документов, которые пользователь может видеть.

	\item[Период доступа к документам на изменение]
	Период, в который попадают даты документов, которые пользователь может изменять.
	Естественно, период доступа \qu{на изменение} не может выходить за пределы периода
	доступа \qu{на чтение}. Другими словами, если вы не можете видеть документ, то и не можете
	его изменять.

	\item[\dlgradioc{Доступ к документам по критерию создателя}]
	Функция, позволяющая ограничить просмотр документов только теми, которые созданы
	самим пользователем, либо, как один из вариантов, любым пользователем из группы,
	которой принадлежит данный пользователь.

	Заметим, что это ограничение является \qu{не строгим}. То есть, фактически оно
	действует только на таблицу реестра документов, ограничивая список просматриваемых
	документов теми, которые удовлетворяют рассматриваемому критерию.

	Например, просматривая оплаты по документу, пользователь сможет видеть те документы оплаты,
	которые созданы не им. В равной степени, отчеты, извлекающие данные из содержимого документов
	не будут ограничиваться для этого пользователя в соответствии с рассматриваемым признаком.

	\item[Список доступных видов операций]
	Список доступных операций - это набор операций, к которым относятся документы, видимые
	для пользователя. Если список пуст, то система считает, что пользователь может видеть
	документы по всем видам операций.

	\item[Список доступных складов]
	Список доступных складов регламентирует склады, документы по которым пользователь
	может видеть и изменять. Пустой список доступных складов означает отсутствие ограничений
	по складам.

	\item[Базовые опции доступа к документам]
	Базовые признаки доступа к документам включают: просмотр, создание, модификация, удаление,
	администрирование. Это стандартные признаки, регламентируемые для любых объектов.

	\item[Расширенные опции прав доступа к документам]
	Блок прав доступа к документам содержит большое количество расширенных
	опций регламента доступа к различным функциям управления документами.
	\begin{description}
		\item[Кассовые чеки]
		Предоставляет право просматривать и изменять кассовые чеки.

		\item[Закрытие кассовой сессии]
		Предоставляет право закрывать кассовые сессии.

		\item[Открытие кассовой сессии]
		Предоставляет право открывать кассовые сессии.

		\item[Системная информация]
		Установленный признак позволяет пользователю просматривать и изменять системную
		информацию по документу.

		\item[Модификация даты]
		Дает право на изменение даты документа.

		\item[Модификация товара]
		Дает право на изменение товара в строке товарного документа. В случае приходных товарных
		операций такое изменение влечет за собой модификацию всех товарных документов, которые
		содержат строки, относящиеся к лоту, созданному изменяемой строкой. Это - очень длительная
		операция, влияющая на большое количество параметров учета.

		\item[Модификация контрагента]
		Дает право изменять контрагента в документах.

		\item[Модификация фрахта]
		Данный флаг регламентирует возможность изменения данных фрахта в документе.
		Флаг имеет ряд нюансов, о которых следует упомянуть:
		\begin{itemize}
			\item Если пользователь не имеет прав на изменение документа, но имеет право на
			изменение фрахта, то ему доступна возможность изменить фрахт из таблицы документов
			либо из отчета по фрахту, независимо от остальной части документа.

			Одновременно с этим, при такой ситуации, во фрахте нельзя изменить значение стоимости
			фрахта, поскольку эта сумма может влиять на состояние учета.

			\item Если статус документа не допускает его редактирования, то даже  рассматриваемый
			флаг не даст возможности изменить данные фрахта.
		\end{itemize}

		\item[Использование WL]
		Предоставляет возможность устанавливать и снимать WL-признак на документах.

		\item[Доступ к ценам поступления]
		Отсутствие этого признака запрещает пользователю каким-либо образом видеть цены
		поступления документов, а также их суммированные и агрегированные значения, в том
		числе и в отчетах (например в отчете об остатках товаров или лотах).

		\item[Массовое изменение выборки]
		Дает право на выполнение удаления всей выборки документов, а также массового
		изменения атрибутов выборки документов.

		Необходимость в регламентировании этих действий продиктована их необратимостью
		и потенциально возможными значительными отрицательными последствиями.

		\item[Объединение выборки документов]
		Дает право на выполнение операции объединения выборки документов в один документ.
		Так же, как и в случае полного удаления выборки документов, это действие необратимо и несет
		в себе потенциальную опасность для целостности данных.

		\item[Изменение статуса документов]
		Позволяет изменять статус документа.

		\item[Отмена котировки в строке документа]
		Опция допускает отмену установки котировки на строку товарного документа.

		Фактически, этот флаг нужен для блокировки возможности некоторым пользователям
		отменять автоматически установленную котировку.

		Заметим, что опция сказывается только на возможности ручной отмены котировки.
		Все автоматически осуществляемые функции (какими-бы они не были) не подконтрольны
		этому флагу.

		\item[Установка скидки на весь документ]
		Отсутствие данного флага блокирует возможность пользователя установить скидку на
		весь документ в заголовочном диалоге документа.

		Аналогично предыдущей опции, этот флаг не влияет на работу автоматических функций.

		Например, при создании нового документа отгрузки покупателю, в соглашении с которым
		оговорена общая скидка, эта скидка будет установлена в документе не смотря на наличие
		или отсутствие данного флага, однако, пользователь, не имеющий права на установку
		общей скидки не сможет изменить автоматически установленное значение.

		\item[Модификация синхронизированного документа]
		Отсутствие данного флага блокирует возможность изменения товарных строк документа,
		который уже синхронизирован с другими разделами базы данных.
		Основное назначение этого регламента - минимизировать вероятность изменения документов,
		образы которых присутствуют в других разделах (такие изменения не могут быть переданы
		в другой раздел).

		При этом система не ограничивает изменение большинства атрибутов заголовка документа,
		поскольку такие изменения другими разделами принимаются.

	\end{description}
	%См. ниже.
\end{description}

%Расширенные признаки доступа к документам

Изменить права доступа по документам можно в пункте меню \ppymenu{Админ\rdir Группы и пользователи} для
конкретных пользователей или для групп. Более подробно администрирование прав доступа
описано в главе \ref{sec-config}.

%topic(DLG_BILLCFG)

\subsection{Конфигурация документов\label{sec-bill-cfg}}

Опции конфигурации документов доступны через меню \ppymenu{Админ\rdir Прочие конфигурации\rdir Конфигурация документов}.

\ppypictsc{dlg-cfg-bill}{Конфигурация документов}{0.5}

\begin{description}
	\item[\dlgcombo{Регистр, используемый для выбора контрагента}]
	При вводе документа в поле \qu{Контрагент} вы можете нажать клавишу \keyb{F2}
	и ввести код контрагента для поиска.

	Порядок обработки системой введенного кода следующий:

	\begin{enumerate}
		\item Система определяет таблицу аналитического учета, определенной для вида операции,
		к которой относится документ. Если в этой таблице определен тип регистра для поиска
		контрагента, то используется этот тип регистра.
		\item Если по алгоритму, определенному первым пунктом тип регистра не определен,
		система использует значение из описываемого поля как тип регистра для поиска контрагента.
		\item Если в результате прохождения первых двух шагов система смогла выяснить
		тип регистрационного документа, используемого для поиска контрагента,
		то ищет персоналию с введенным значением регистрационного номера и связанную
		с аналитической статьей, относящейся к таблице объектов вида операции,
		к которой относится документ.

		Если такая персоналия найдена, то соответствующая ей статья становится контрагентом
		документа.
	\end{enumerate}

	\item[\dlgcombo{Статус новых документов}]
	Если здесь указан один из статусов документов, то любой новый документ, относящийся к
	виду операции, который не переопределяет данных признак, получает такой
	статус. Если это поле пусто, то новые документы создаются с неопределенным статусом.

	Подробнее о статусах документов см. стр.~\pageref{sec-billstatus}.

	\item[\dlgflag{Подтверждать WL}]
	Если флаг установлен, то при нажатии клавиши \keyb{F8} на документе в таблице документов, система
	будет запрашивать подтверждение на изменение признака WL для выбранного документа.
	Если флаг не установлен, то признак WL изменяется без предупреждения.
	Если права доступа по документам пользователя запрещают использование признака WL, то попытка
	изменить этот признак ни к чему не приведет.

	\item[\dlgflag{Допускать переоценку цен поступления без поставщика}]
	По умолчанию, переоценка цен поступления в документах переоценки допустима только в том
	случае, если в документе указан контрагент (поставщик). Более того, вы не сможете переоценить
	цены поступления лотов, пришедших от поставщика, отличного от того, который указан в
	качестве контрагента документа переоценки.

	В том случае (возникновение которого представляется нам маловероятным), вам надо переоценивать
	цены поступления без явного указания поставщика и без ограничения по поставщикам лотов,
	установите этот флаг.

	\item[\dlgflag{Предупреждать о наличии у клиентов просроченной задолженности}]
	Если этот флаг включен, при выборе контрагента в документе отгрузки или заказа, система
	будет проверять текущий долг по выбранному клиенту, и, если этот долг является просроченным,
	выдает предупреждение.
	Обратите внимание на то, что система при этом не блокирует выбор контрагента, а лишь
	предупреждает оператора. Для жесткой блокировки выбора задолжавшего клиента следует
	использовать признак аналитической статьи \dlgflag{Стоп}.

	\item[\dlgflag{Предупреждать об отсутствии или просроченности соглашения}]
	Если этот флаг установлен, то при выборе контрагента в документе, программа идентифицирует
	соглашение с этим контрагентом, и, если соглашения нет, либо срок его действия меньше,
	чем дата документа, выдает сообщение.
	Опция работает только для аналитических статей, ассоциированных с таблицами, требующими
	соглашения с клиентом (но не действует для таблиц, требующих соглашения с поставщиком).

	\item[\dlgflag{Выставлять признак отличия последней ЦП от введенной}]
	Установка этого флага приведет к тому, что при вводе строки документа, приходующего товар,
	если введенная цена поступления отличается от цены поступления по последнему лоту, справа от
	цены поступления высветится символ \qu{Р}.
	Это обычно используется для того, чтобы оператор, вводивший документ, мог вовремя среагировать
	на изменение цены поставщики.

	\item[\dlgflag{Предупреждать о вводе документа, не соответствующего фильтру}]
	Для того, что бы предотвратить популярное у начинающих пользователей заблуждение, что введенный
	ими документ бесследно исчез из-за того что он не виден в таблице документов по причине
	несоответствия этого документа условиям фильтрации, установите этот флаг.
	В этом случае, если введенный документ не соответствует фильтру просмотра документов,
	пользователь увидит на экране сообщение об этом.

	\item[\dlgflag{Разрешить множественную печать первичных документов}]
	Включение этого флага позволяет одним действием отправить на печать сразу несколько вариантов
	первичных форм по документу. Например, пользователь сможет в одно действие отправить на
	печать счет-фактуру, накладную и сведения о сертификатах.

	У множественной печати есть и отрицательные стороны: во-первых, невозможен предварительный
	просмотр - печать идет сразу на принтер, во-вторых, количество копий может быть задано только
	для всех форм одновременно. То есть, при множественной печати нельзя отправить на печать одну
	копию накладной и две копии счета-фактуры: либо по два экземпляра, либо по одному.

	Вы можете переопределить эту опцию для конкретного рабочего места с помощью функции настройки
	интерфейса (см. стр.~\pageref{sec-cfg-ui}).

	\item[\dlgflag{При подборе по штрихкоду - автоматическое количество 1 единица}]
	При выборе товара в строках товарных документов по штрихкоду, вновь созданная строка
	содержит, по умолчанию, ноль в поле количества.

	Если особенности ведения учета таковы, что операции над товарами чаще всего совершаются
	в количестве одной штуки (сувениры, компакт-диски, редкие книги и т.д.), то установка
	этого флага позволит значительно ускорить обработку документов, так как при сканировании
	штрихкода в поле количества товара автоматически будет появляться единица.
	Примерный сценарий отгрузки штучной продукции:

	\begin{enumerate}
		\item В строках расходного документа оператор сканирует штрихкод на товаре
		\item Система распознает штрихкод, открывает диалог редактирования
		новой строки, в котором уже указана одна единица
		\item Оператор нажимает \keyb{Enter} для проведения строки и
		возвращается к первому пункту сценария
	\end{enumerate}

	\item[\dlgflag{Не предупреждать о дублировании товара в строках документа}]
	Аналогично предыдущему флагу, этот флаг предназначен для ускорения ввода документов
	при идентификации товаров по штрихкодам.

	Если этот флаг не установлен, то при выборе товара, который уже есть в документе, система
	выдает сообщение об этом и в зависимости от ответа пользователя, либо дает ему возможность
	продолжить ввод строки, либо переводит указатель текущей строки на первую сверху строку
	с выбранным товаром.
	Если это сообщение мешает вам быстро вводить строки накладной, то установите обсуждаемый
	флаг.

	\item[\dlgflag{Печатать в ценниках цену из котировки по акции}]

	\item[\dlgflag{Автоматически генерировать серийный номер}]
	Если этот флаг установлен, то в приходных строках товарных документах поле \qu{Серийный номер}
	автоматически заполняется уникальным серийным номером.
	Если эта опция не установлена, то для генерации серийного номера необходимо, находясь в
	этом поле, нажать клавишу \keyb{F2}.
	Если шаблон серийного номера не определен, то такой номер генерироваться не будет.

	\item[\dlgflag{При комплектации ЦР на исходящие позиции - по базовой котировке}]
	При включении этого флага, в приходных строках документов модификации цена реализации
	будет формироваться из базовой котировки, если такая котировка определена.

	Если флаг не установлен или не определена базовая котировка для выбранного товара по
	складу документа, то для вычисления цены реализации применяется правило последнего лота.
	Подробнее см. \qu{Особенности товарного учета в системе Papyrus} в этом разделе.

	\item[\dlgflag{Выделять цветом отгруженные документы}]
	Если флаг включен, то в таблице товарных документов отмечаются цветом те документы, которые
	имеют признак \dlgflag{Отгружен}.

	\item[\dlgflag{Допускается переопределять котировку из соглашения}]
	Данная опция относится к товарным документам. Главным образом - к расходным.

	При установке котировки в строке документа, система
	ищет подходящие котировки и, если их более одной, то предлагает выбор.

	В случае, когда соглашение с контрагентом предопределяет вид котировки,
	то система считает, что именно он и должен быть применен. Следовательно,
	у пользователя и не запрашивается вид котировки.

	Если обсуждаемый флаг установлен, то даже при наличии заданного в соглашении
	с контрагентом вида котировки, если существует выбор более чем из одной
	допустимой котировки (включая ту, что определена в соглашении), система
	запросит у пользователя вид котировки для применения.

	Наоборот, при отсутствии этого флага, из скольких бы видов котировок
	нельзя было бы сделать выбор, безусловно применяется вид котировки из соглашения.

	\item[\dlgflag{Проверять зарезервированные остатки товаров}]
	Если этот флаг не установлен, то система не станет проверять резерв по резервирующим
	заказам при вводе документов отгрузки.

	Этот флаг является страхующим, и в нормальном режиме должен быть установлен.

	\item[\dlgflag{Цена из заказа имеет низкий приоритет}]

	\item[\dlgflag{Дополнительная статья по документу как главная организация}]
	Узкоспециализированный флаг. Установленный флаг влияет только на документы,
	относящиеся к видам операций, в который определен дополнительная таблица
	объектов, причем, эта таблица должна ссылаться на персоналии зарезервированного
	вида \ppyrsrv{Главная организация}.

	Если флаг установлен, то при обработке документа, подпадающего под обозначенные выше условия,
	система извлекает главную организацию не из текущего состояния сеанса, а из дополнительной
	статьи по документу.

	В подавляющем большинстве случаев, этот флаг не следует устанавливать (вместе с тем,
	следует сказать, что навредить неправомерной установкой этого флага крайне сложно из-за
	большого количества условий, необходимых для его действительного применения программой).

	\item[\dlgflag{Принимать изменения товарных документов из других разделов}]
	Если этот флаг включен, то система будет принимать изменения товарных документов, пришедших из других
	разделов распределенной базы данных.

	До версии 8.0.3 \ppybrand{} не умел принимать такие изменения.

	\item[\dlgflag{Передавать прикрепленные файлы}]
	Опция сейчас не используется.

	\item[\dlgflag{Не наследовать сертификат в приходе товара}]
	Флаг блокирует функцию наследования сертификата из последнего лота в диалоге строки товарного документа.

	Необходимость в установке флага может возникнуть в больших базах данных, оперирующих значительным числом
	лотов и не использующих при этом сертификаты, связанные с лотами. В этом случае попытки системы найти последний лот
	с сертификатом для его наследования, может вызывать заметные задержки и увеличение нагрузки на сервер базы данных.

	\item[\dlgflag{Возвраты наследуют фрахт из основного документа}]
	Если флаг установлен, то при создании нового документа возврата, этот документ получает запись фрахта, унаследованную
	от документа, к которому он привязан. Правила наследования следующие:
	\begin{itemize}
		\item Дата отправления обнуляется.
		\item Дата прибытия обнуляется.
		\item Стоимость фрахта обнуляется.
		\item Транспорт обнуляется.
		\item Капитан (водитель) обнуляется.
		\item Порт отправления и порт отгрузки (если хотя бы один из них не пустой) меняются местами.
	\end{itemize}

	Кроме всего перечисленного, вид операции возврата должен иметь признак \dlgflag{Ввод информации по фрахту}.

	\item[Показывать коды в строках документов]
	Задает варианты отображения кода товара и (или) серийного номера в строках товарных документов.
	\begin{description}
		\item[\dlgflag{Штрихкод}] Если флаг установлен, то в колонке, следующей за наименование товара будет
		отображаться штрихкод этого товара.

		Если товар имеет несколько штрихкодов, то отображается единственный, определяемый по правилу, описанному на стр.~\pageref{sec-barcodelist}.

		\item[\dlgflag{Серийный номер}] Если данный флаг включен, то в колонке, следующей за наименованием товара
		или штрихкодом (если установлен флаг, определенный выше) отображается серийный номер лота, которому соответствует товарная строка документа.
	\end{description}

	На быстродействии работы оба флага практически не сказываются, поскольку при отображении и штрихкода и серийного
	номера интенсивно используется технология кэширование.

	\item[\dlgradioc{Подстановка дефицитного товара}]
	Подстановка дефицитного товара широко используется в учете производства, а также в розничной
	торговле.

	Традиционная технология предполагает использование в качестве подстановочных позиций членов
	товарного обобщения, которому принадлежит дефицитный товар. Для использования этой технологии,
	переключатель должен находится в первом положении.

	Более новая технология подстановки дефицита опирается на так называемые подстановочные
	структуры товаров. Такой подход предоставляет большую  управляемость механизму подстановки,
	однако, унаследованные базы данных из-за привычки и большого объема унаследованных данных
	и конфигураций не могут быстро перестроиться на его использование.

	Для использования этой технологии следует установить положение обсуждаемого
	переключателя во второе положение.

	Если вы хотите заблокировать использование технологии подстановки дефицитных товаров, то
	установите переключатель в третье положение.

	\item[Шаблон генерации серийного номера лота]
	Шаблон в соответствии с которым формируются новые серийные номера. Формат шаблона такой
	же, как и шаблон номера документов, описанный в разделе, посвященном операционным
	справочникам.

	Если это поле пусто, то система не будет автоматически генерировать серийные номера.

	\item[Счетчик для генерации серийного номера лота]
	Это поле содержит значение, используемое для формирования следующего серийного номера
	лота (инвентарного номера объекта основных средств).
	Это значение увеличивается на единицу при каждом формировании системой серийного
	номера лота.
	\ppynote{
		Категорически не рекомендуется изменять, особенно в меньшую сторону, это значение,
		поскольку такие действия могут привести к появлению не уникальных серийных номеров.
	}

	\item[Шаблон генерации инвентарного номера]
	Назначение этого поля аналогично предыдущему, только этот шаблон используется для
	генерации инвентарных номеров основных средств.

	\item[Суффикс уникальности серийного номера]
	Весьма специализированная опция, необходимая для обеспечения внутренней уникальности серийных номеров
	лотов относительно одного и того же товара. Обычно применяется в автоматизации аптек для того,
	что бы приходящие из-вне (от поставщиков) серийные номера для одного товара номинально отличались,
	но при этом можно было бы сопоставить их с оригинальным значением.

	Правила определения суффикса следующие: сначала идет фиксированная строка длиной от одного до пяти символов,
	которая будет прикрепляться в хвосте не уникального серийного номера а затем цифра,
	обозначающая длину переменной числовой части суффикса серии.

	Например: UQ4
	\newline Такое определение предписывает системе добавлять к не уникальной серии суффиксы UQ0001, UQ0002, UQ003 и т.д.

	\item[\dlgbutton{Дополнительно}]
	Кнопка открывает диалог дополнительный параметров конфигурации. Детально диалог описан ниже.

	\item[\dlgbutton{Расчет скидки}]
	Вызывает диалог конфигурации распределения общей скидки по строкам товарного документа.
	Подробности см. на стр.~\pageref{loc-bill-cfg-dis}.

	\item[\dlgbutton{Расценка}]
	Вызывает диалог конфигурации расценки документов. Подробности см. на стр.~\pageref{loc-bill-cfg-pricing}.

	\item[\dlgbutton{Фильтр индикаторов тегов}]
	Фильтр тегов документов, определяющий цветовую индикацию номеров документов в таблицах.

	Если тег документа в таблице соответствует одному из критериев, то  нижний левый угол ячейки с номером
	этого документа окрашивается выбранным в фильтре цветом.

	Следует иметь в виду, что если теги документа удовлетворяют более чем одному критерию из списка, то
	применяется цвет первого из них (в порядке следования сверху-вниз).

	Подробно о редактировании фильтров тегов рассказано на стр.~\pageref{sec-tagv-filt}.

	\item[\dlgbutton{Фильтр индикаторов тегов лотов}]
	Фильтр тегов лотов, определяющий цветовую индикацию лотов в таблицах. Правила определения фильтра
	аналогичны тем, что действуют для \dlgbutton{фильтра индикаторов тегов}.
\end{description}

\subsubsection{Дополнительные параметры конфигурации документов}

\ppypict{dlg-cfg-bill-ext}{Диалог дополнительных параметров конфигурации документов}

В этом диалоге можно просмотреть и модифицировать несколько дополнительных опций конфигурации документов:

\begin{description}
	\item[\dlgcombo{Кассовый узел для печати чеков по документам}]
	Здесь может быть указан синхронный кассовый узел, информация из которого используется для
	печати кассового чека по документу из таблицы документов по клавише \keyb{Ctrl-Z}.
	Если это поле пустое, то печать чеков по документу таким образом недоступна.
	\item[\dlgcombo{Регистр договора с контрагентом}]
	Здесь может быть определен тип регистрационного документа, определяющего параметры договора с контрагентом.

	\item[\dlgcombo{Тег лота 'Страна происхождения'}]
	Если в этом комбо-боксе выбран тег, используемый для хранения значения страны происхождения товара, поступившего
	с лотом, то в диалог редактирования строки приходного документа будет включен комбо-бокс для выбора страны происхождения.
	Эта опция позволяет сэкономить усилия при вводе документов.

	\item[Дата начала расчета долгов контрагентов]
	Здесь может быть указана дата, с которой следует начина обзор документов для расчета общего долга по контрагенту.
	Как правило, в этом нет необходимости, однако, если вы ведете учет в базе данных достаточно долго (несколько лет) и
	количество документов значительно, ограничение указанной датой расчета позволит ускорить работу и снизит общую
	нагрузку на сервер базы данных.

	\ppynote{
		Будьте внимательны: если в этом поле будет указана дата слишком близко стоящая к текущему дню, то по некотором
		контрагентам возможно занижение рассчитанной суммы долга по сравнению с реальной.

		Параметр не влияет на расчет отчета \qu{Долговая ведомость}. Его использование ограничено справочными расчетами,
		вызываемыми при открытии документов и соглашений с контрагентами.
	}

	\item[Папка для добавления файлов]
\end{description}

\subsubsection{Метод расчета общей скидки по документу\label{loc-bill-cfg-dis}}

\ppypict{dlg-121}{Метод расчета общий скидки по документу}

Диалог редактирования опций расчете общей скидки по документу показан
на рис.~\ref{pic-dlg-121}.

\begin{description}
	\item[\dlgradioc{Метод расчета скидки}]
	Этот переключатель определяет алгоритм разноски общей скидки
	по строкам документа.
	\begin{description}
		\item[\dlgradioi{Простой}]
		\item[\dlgradioi{Регрессивный}]
		\item[\dlgradioi{Регрессивный с унификацией}]
	\end{description}

	\item[Точность округления]

	\item[Дата, начиная с которой использовать переключение]
\end{description}

\subsubsection{Конфигурация расценки документов\label{loc-bill-cfg-pricing}}

\ppypict{dlg-122}{Конфигурация расценки документов}

Опции расценки документов позволяют настроить автоматическую и
полуавтоматическую расценку приходных документов.

Эти опции будут применяться либо при ручном вызове функции
расценки, либо автоматически (если установлен признак
\dlgflag{Автоматическая котировка} в конфигурации пользователя).

Вид диалога опций расценки документов приведен на рис.~\ref{pic-dlg-122}.
Далее следуют пояснения относительно управляющих элементов этого диалога.

\begin{description}
	\item[\dlgcombo{Вид котировки}]
	Вид котировки, используемый для расценки приходных документов.

	\item[\dlgradioc{Округление}]
	Переключатель, определяющий направление округления результирующего значения цены.
	\begin{description}
		\item[\dlgradioi{До ближайшего}] округление осуществляется до
		ближайшего значения по финансовому правилу.
		\item[\dlgradioi{В меньшую сторону}] результат становится равным
		наименьшему значению, удовлетворяющему критериям округления.
		\item[\dlgradioi{В большую сторону}] результат становится равным
		наибольшему значению, удовлетворяющему критериям округления.
	\end{description}

	\item[\dlgflag{По НДС}]
	Если этот флаг установлен, то результирующая цена будет
	кратна ставке НДС для товара.

	\item[\dlgflag{Запрет на изменение параметров при расценке}]
	Включение этого флага приведет к тому, что при ручном вызове
	функции расценки по документу программа не будет предлагать
	выбор параметров расценки, а автоматически применить параметры,
	указанные в этом диалоге.

	Флаг действует только в том случае, если указан вид котировки
	для расценки.

	\item[\dlgflag{В относительной расценке использовать контрактную цену поставщика}]
	Переключатель позволяет несколько изменить правило формирования учетной
	цены реализации при расценке таки образом, что расценочная котировка,
	заданная процентной величиной относительно учетной цены поступления,
	будет применяться относительно контрактной цене поставщика. Если же
	для расцениваемой номенклатурной позиции не задана контрактная цена, то
	будет использован традиционный алгоритм расчета относительно учетной
	цены поступления.

	Контрактная цена в контексте расцениваемой строки приходного документа
	определяется по общему правилу извлечения котировок: сначала система
	пытается найти контрактную котировку по складу, которому принадлежит
	документ и по поставщику, являющемуся контрагентом по документу.
	Если такого значения нет, то условие поиска ослабляется до склада
	верхнего уровня или \qu{для всех складов}. Аналогично, может быть
	использовано значение контрактной котировки, заданной для всех
	поставщиков (без явного указания статьи).

\end{description}

%endtopic

\chapter{Бухгалтерские документы\label{ch-bill-acc}}

Категория бухгалтерских документов включает в себя обширное множество видов документов,
отличительной чертой которых является принадлежность к типу операций \ppyrsrv{Бухгалтерская проводка}.
С точки зрения учета бухгалтерские документы выделены в отдельную категорию, поскольку не
влияют на состояние материальных активов предприятия, но воздействуют исключительно на баланс.
В эту категорию попадают:

\begin{itemize}
	\item Общие бухгалтерские проводки (простое перемещение средств со счета на счет)
	\item Расширенные бухгалтерские документы
	\item Платежные поручения
	\item Платежные требования
	\item Авансовые отчеты
	\item Доверенности
	\item Документы валютной переоценки
\end{itemize}
Далее мы рассмотрим средства просмотра, ввода и анализа бухгалтерских документов.

\section{Опись проводок}

Опись проводок это - реестр бухгалтерских проводок. В системе \ppybrand{} опись проводок
предоставляет множество форм вывода и группировки бухгалтерских операций как для добавления
и редактирования, так и для анализа данных.
В описи проводок можно видеть проводки, сформированные не только бухгалтерскими, но и любыми
другими категориями документов.
Опись проводок доступна при обращении к пункту меню \ppymenu{Операции\rdir Опись проводок}.

\subsection {Фильтр описи проводок}

\ppypict{dlg-f-accturn-w}{Фильтр по бухгалтерским проводкам}

Следующая таблица перечисляет и поясняет смысл и назначение элементов фильтра описи проводок
(рис.~\ref{pic-dlg-f-accturn-w}).

\begin{description}
	\item[\dlgflag{Только опись ввода}]
	Указывает, что вы хотите вводить новые бухгалтерские проводки и видеть при этом только их.
	Другими словами, при использовании этого флага на экране видны только бухгалтерские проводки,
	введенные непосредственно в таблице, появившейся после этого фильтра, но не до его открытия
	или после закрытия. Если этот флаг установлен, то все остальные поля фильтра теряют смысл.

	\item[Период]
	Период, за который вы хотели бы видеть проводки в таблице. Если администратор системы
	ограничил ваши права по периоду доступа к документам, то на период, введенный вами здесь,
	наложится период ограничения доступа.

	\item[\dlgcombo{Вид операции}]
	Здесь вы можете выбрать вид операции, которому должны соответствовать просматриваемые
	проводки. Если вы оставите этот комбо-бокс пустым, то система при выводе проводок не
	будет обращать внимание на вид операции документа, которому соответствуют проводки (если
	администратор не ограничил для вас список доступных видов операций).

	\item[Сумма]
	В этом поле можно ввести диапазон значений, в который должны попадать суммы проводок.
	Диапазон вводится обычным для системы образом: нижняя граница..верхняя граница.
	Пример: 10000.. покажет проводки, сумма которых больше или равна 10000.

	\item[\dlgcombo{Валюта}]
	Этот комбо-бокс позволяет выбрать валюту, проводки по которой вам необходимо выбрать.
	Если валюта здесь не указана, то в зависимости от флага \dlgflag{Все валюты}
	будут показаны либо проводки по всем валютам, либо только проводки в базовой валюте.

	\item[\dlgflag{Все валюты}]
	Как упоминалось чуть выше, если этот флаг установлен, то система выведет проводки не
	зависимо от того, в какой валюте они номинированы. Если флаг не установлен, то, если
	валюта не указана, будут показаны только проводки в базовой валюте, если же указана,
	то в указанной валюте.

	\item[\dlgradioc{Группировка}]
	Группа радио-кнопок, позволяющая выбрать способ группировки проводок. Перечислим
	возможные варианты:

	\begin{description}
		\item[\dlgradioi{Не группировать}] проводки выводятся, как есть, без группировки.
		\item[\dlgradioi{По счетам}] проводки группируются по счетам первого порядка.
		\item[\dlgradioi{По субсчетам}] проводки группируются по субсчетам (счетам второго порядка)
		\item[\dlgradioi{По субконто}] группировка осуществляется по терминальным счетам (субконто).
	\end{description}
	Если выбран один из последних трех вариантов группировки, то вы увидите итоговые
	проводки, с указанием счетов дебета, кредита и общей суммы.

	\item[Параметры циклического отчета]
	Эти параметры имеют смысл только в том случае, когда указан какой-либо из способов
	группировки. В этом случае система выдаст сгруппированный отчет для каждого из
	указанного количества циклов.

\end{description}

\subsection {Таблица описи проводок}

После того как в фильтре будут определены необходимые условия, опись проводок отображается
в таблице. Простая опись (без группировки), показана на рисунке и представляет из себя таблицу,
каждая строка которой содержит дату проведения операции, номер документа,  номера счетов по
дебету и по кредиту, сумму проводящуюся по счетам и примечание к документу.

\ppypict{Brw-accturn}{Таблица описи проводок}

\subsubsection{Действия в таблице описи проводок}

	\paragraph{Редактировать документ}\indent\keyb{Enter}
	Редактировать документ, к которому относится текущая проводка.
	Если таблица содержит сгруппированные данные, то это действие приведет к появлению на
	экране таблицы деталировки выбранной строки группировки.

	\paragraph{Добавить}\indent\keyb{Insert}
	Создать новый бухгалтерский документ

	\paragraph{Добавить по образцу}\indent\keyb{Alt-F2}
	Создать общую проводку по образцу выбранной.

	\paragraph{Удалить}\indent\keyb{Delete}
	Удалить выбранный документ.
	В описи проводок можно удалять только бухгалтерские документы. Если проводка была
	сформирована документом, относящимся к какой-либо иной категории, то удалить его
	здесь не удастся.

	\paragraph{Печатать ордера}\indent\keyb{F7}
	Печать первичного документа по выбранной бухгалтерской проводке. Это может быть
	приходный или расходный кассовый ордер, объявление о взносе наличности в банк и пр.

	\paragraph{Печать описи}\indent\keyb{Alt-F7}
	Распечатать всю опись проводок.

	\paragraph{Итог}\indent\keyb{F9}
	По этой команде можно увидеть итоговые значения описи проводок:
	общее количество проводок и суммы по каждой валюте.

\section{Ввод и редактирование бухгалтерских документов}

В этом подразделе мы подробно рассмотрим порядок ввода и редактирования различных видов
бухгалтерских документов.

\subsection{Диалог ввода и редактирования общей бухгалтерской проводки}

\ppypict{dlg-accturn}{Диалог ввода  и корректировки общей бухгалтерской проводки}

Диалог ввода  и корректировки общей бухгалтерской проводки имеет вид, показанный
на рис.~\ref{pic-dlg-accturn}.

\begin{description}
	\item[Номер документа]
	Номер документа проводки. При вводе нового документа, система, как правило, формирует
	этот номер автоматически в соответствии со счетчиком, прикрепленным к виду операции,
	к которой относится документ.
	Вы можете изменить номер документа на тот, который должен быть. При этом счетчик не
	изменится. Для изменения значения счетчика можно нажать клавишу \keyb{F2}
	когда поле номера выделено.

	\item[Дата]
	Дата документа. При вводе нового документа система автоматически устанавливает здесь
	текущую операционную дату. Вы можете изменить дату документа, установив здесь то
	значение, которое необходимо.
	\ppynote{
		Дата документа должна попадать в определенный для вас администратором системы период
		доступа к документам, иначе система не позволит провести такой документ.
		Кроме того, администратор системы может урезать право на изменение даты документа.
		В этом случае поле даты редактируемого (не нового) документа  будет недоступно для
		изменения.
	}

	\item[Дебет]
	Группа управляющих элементов, предназначенных для ввода и корректировки счета и статьи
	дебетуемой части проводки.

	\item[Счет]
	Номер и наименование счета, по дебету которого должна пройти бухгалтерская проводка.
	В этом поле вводят номер бухгалтерского счета в формате счет.субсчет (например 62.2).
	Если вы хотите выбрать счет из списка, то нажмите в этом поле клавишу
	\keyb{\textdownarrow} или щелкните кнопку со стрелкой справа от
	поля наименования счета.

	\item[Статья]
	Номер и наименование аналитической статьи (субконто) дебетуемого счета, по которому
	должна пройти проводка. Если к выбранному дебетуемому счету привязана таблица аналитических
	статей, то здесь можно ввести номер статьи или выбрать статью из списка, нажав клавишу
	\keyb{\textdownarrow}, либо щелкнув стрелку справа от поля наименования статьи.
	Если вы знаете номера и счета и статьи дебетуемой части проводки, то можете ввести их
	сразу в поле 'Счет' в форме счет.субсчет.статья (например 62.2.119 или 60.0.38).

	\item[Кредит]
	Группа управляющих элементов, предназначенных для ввода и корректировки счета и статьи
	кредитуемой части проводки. Правила ввода здесь аналогичны описанным для дебетовой части.

	\item[Сумма]
	В этом поле следует ввести сумму проводки. Значение суммы может быть как положительным
	так и отрицательным.

	\item[\dlgcombo{Валюта}]
	В случае валютной проводки здесь следует выбрать валюту. Выбор валюты будет ограничен
	введенными счетами по дебету и кредиту. То есть, в этом комбо-боксе можно выбрать только
	те валюты, по которым одновременно ведется учет и на дебетуемом и на кредитуемом счетах.

	\item[Курс]
	Если вы вводите валютную проводку, то в этом поле следует указать курс пересчета выбранной
	валюты в базовую. Система автоматически вставляет здесь наиболее близкий к дате документа
	курс из справочника валютных курсов.

	\ppynote{
		Так как система позволяет вести более одного типа валютных курсов, то необходимо пояснить,
		что в этом поле указывается так называемый базовый валютный курс ( в России - курс ЦБ РФ),
		определенный в конфигурации.
	}

	\item[Базовая сумма]
	Это - справочное поле, в котором система показывает сумму документа в базовой валюте,
	пересчитанную в соответствии в введенным курсом.

	\item[Примечание]
	В этом поле вы можете ввести любое текстовое пояснение к документу.

	\item[Индикатор статуса]
	В правом нижнем углу диалога отображается строка наименования статуса документа.
	Если документ не имеет статуса, то выводится строка \qu{Статус не определен}.
\end{description}

\subsection{Диалог ввода и редактирования расширенной бухгалтерской проводки}

\ppypict{dlg-013}{Выдача денег под отчет}

Диалог ввода и редактирования расширенного бухгалтерского документа выглядит так,
как показано на рис.~\ref{pic-dlg-013}.

Чтобы провести расширенный бухгалтерский документ достаточно определить только номер
документа, дату, аналитическую статью и сумму. Проводки по счетам будут сгенерированы
системой согласно шаблону проводок выбранного вида операции.

Далее детализируются управляющие элементы этого диалога.

\begin{description}
	\item[Номер документа]
	Номер документа проводки. При вводе нового документа, система, как правило, формирует
	этот номер автоматически в соответствии со счетчиком, прикрепленным к виду операции к
	которой относится документ.

	Вы можете изменить номер документа на тот, который должен быть. При этом счетчик не
	изменится. Для изменения значения счетчика можно нажать клавишу  \keyb{F2} когда поле
	номера выделено.

	\item[\dlgcombo{Подразделение}]
	Склад, к которому относится документ. В отличие от товарных документов, бухгалтерские
	допускают изменение склада.

	\item[Дата]
	Дата документа. При вводе нового документа система автоматически устанавливает здесь
	текущую операционную дату. Вы можете изменить дату документа, установив здесь то
	значение, которое необходимо.
	\ppynote{
		Дата документа должна попадать в определенный для вас администратором системы
		период доступа к документам, иначе система не позволит провести такой документ.
		Кроме того, администратор системы может урезать право на изменение даты документа. В этом
		случае поле даты редактируемого (не нового) документа  будет недоступно для изменения.
	}

	\item[\dlgcombo{Статья}]
	Аналитическая статья, соответствующая вводимому документу. Это может быть контрагент
	операции, статья расходов, подотчетное лицо и пр. Эта статья выбирается из таблицы
	аналитического учета, заданной в виде операции как \qu{Таблица объектов}.
	Если в списке статей отсутствует та, которая вам нужна, вы можете создать новую статью,
	нажав  \keyb{Insert} в открытом списке или выбрав опцию \qu{Добавить} из контекстного меню списка
	(оно доступно по нажатию правой кнопки мыши на открытом списке).

	Как правило, при формировании проводок по документу выбранная здесь статья подставляется
	в один или несколько шаблонов для формирования бухгалтерских проводок по документу.

	\item[\dlgcombo{Дополнительная статья}]
	Если выбранный вид операции предполагает это, то в документе может быть указана дополнительная
	статья.

	Аналитическая таблица, которой соответствует выбираемая статья определяется параметром
	\qu{Доп таблица объектов} вида операции, к которому относится документ. Кроме того, в опциях
	вида операции задается титул этой статьи (параметр \qu{Наименование дополнительного объекта}).
	Так же как основная статья документа, дополнительная статья может подставляться в шаблоны
	проводок.

	\item[Сумма]
	В этом поле следует ввести номинальную сумму документа. Значение суммы может быть как
	положительным, так и отрицательным.

	\item[\dlgcombo{Валюта}]
	В случае валютной проводки здесь следует выбрать валюту. Выбор валюты будет ограничен
	введенными счетами по дебету и кредиту. То есть, в этом комбо-боксе можно выбрать
	только те валюты, по которым одновременно ведется учет и на дебетуемом и на кредитуемом
	счетах.

	\item[Курс]
	Если вы вводите валютную проводку, то в этом поле следует указать курс пересчета
	выбранной валюты в базовую. Система автоматически вставляет здесь наиболее близкий
	к дате документа курс из справочника валютных курсов.
	\ppynote{
		Так как система позволяет вести более одного типа валютных курсов, то необходимо пояснить,
		что в этом поле указывается так называемый базовый валютный курс ( в России - курс ЦБ РФ),
		определенный в конфигурации.
	}

	\item[Базовая сумма]
	Это - справочное поле, в котором система показывает сумму документа в базовой валюте,
	пересчитанную в соответствии в введенным курсом.

	\item[\dlgbutton{Суммы}]
	Эта кнопка дает возможность ввести дополнительные суммы документа, при условии, что набор
	таких сумм определен видом операции. Документ может содержать любое количество
	дополнительных сумм.

	Если вид операции не предполагает задание дополнительных сумм, то эта кнопка будет закрыта
	для доступа.

	\item[\dlgbutton{Налоги}]
	Специализированный способ ввода налоговых сумм документа. Налоговые суммы определяются в
	справочнике \qu{Типы сумм документа}.

	\item[\dlgbutton{Платежное поручение}]
	Если опции вида операции, к которому относится документ содержат признак \dlgflag{Банковский
	платежный документ}, то нажав эту кнопку, вы можете заполнить платежное поручение,
	для передачи его в банк.

	\item[\dlgbutton{Дополнительно}]

	\item[Дата оплаты]
	Если вид операции, к которому относится документ определяет необходимость оплат по документам,
	то в этом поле можно установить дату срока платежа.

	\item[Примечание]
	В этом поле вы можете ввести любое текстовое пояснение к документу. Если для вида операции
	определен шаблон примечания, то система автоматически сформирует строку для этого поля если
	вы оставите ее пустой.
\end{description}

\subsection{Ввод платежного поручения}

\ppypict{dlg-bnkorder}{Банковское платежное поручение}

Для ввода платежного поручения или платежного требования из документа в диалоге редактирования
документа необходимо нажать кнопку \dlgbutton{Платежное поручение}. Вслед за этим на экране
появится диалог редактирования параметров платежного поручения (рис.~\ref{pic-dlg-bnkorder}).
Этот диалог содержит следующие управляющие элементы:

\begin{description}
	\item[Переключатель выбора между платежным поручением и платежным требованием]
	Этим переключателем вы задаете то, какой банковский документ хотите ввести: платежное
	поручение или платежное требование. Как правило, в коммерческих организациях редко приходится
	печатать платежные требования, поэтому, по умолчанию система устанавливает платежное
	поручение.

	\item[Дата платежа]
	Дата платежа, которая будет выведена в документе платежного поручения. Изначально система
	автоматически выставит здесь дату документа.

	\item[Номер документа]
	Номер платежного поручения (требования). Изначально система автоматически заполняет это
	поле значением из документа. Вы можете изменить это значение.

	\item[Очередность платежа]
	Очередность платежа определяется характером платежного документа. По умолчанию, система
	устанавливает значение 6. Вы можете ввести то значение, которое считаете нужным.

	\item[Способ платежа]
	Способ платежа определяется вашими требованиями к платежному документу и вашим банком.

	\item[Переключатель условия акцептирования]
	Этот переключатель используется только для платежного требования и указывает на то,
	требуется ли банку подтверждение от клиента для списания означенной суммы со счета
	клиента.

	\item[Плательщик и его реквизиты]
	Реквизиты плательщика. Для платежного поручения система автоматически устанавливает
	здесь реквизиты главной организации. Приведем краткие инструкции по заполнению этих полей.
	\begin{description}
		\item[\dlgcombo{Вид персоналии}] Так как в базе данных персоналий может быть очень много записей,
		то для ускорения поиска нужного плательщика вам следует выбрать к какому
		виду он принадлежит. Обычно плательщик - это главная организация, однако
		возможны и другие варианты (например, если вы печатаете платежное поручение
		для какой-либо иной организации).
		\item[\dlgcombo{Плательщик}] В этом комбо-боксе следует выбрать самого плательщика. Если в справочнике
		персоналий нужная вам запись отсутствует, то добавьте ее, нажав клавишу \keyb{Insert}
		в открытом списке.
		\item[\dlgcombo{Счет}] После того, как вы выбрали персоналию-плательщика, система пытается подставить
		в это поле один из банковских счетов этой персоналии. Если для персоналии не указано
		ни одного счета, то вы должны задать его, нажав клавишу \keyb{Insert} в открытом списке
		этого комбо-бокса.

		При наличии у плательщика более одного счета, можно выбрать именно тот, который нужен.
		\item[Банк] Это поле справочное, заполняется при выборе счета, и служит только
		для визуальной верификации правильности выбранного счета плательщика.
	\end{description}

	\item[Получатель платежа и его реквизиты]
	Реквизиты получателя платежа. Это - набор полей, правила заполнения которых аналогичны
	тем, что описаны для плательщика.
	Если статья документа соответствует персоналии, то система автоматически подставляет в
	качестве плательщика персоналию, соответствующую выбранной статье.

	\item[\dlgbutton{Перестановка}]
	Эта кнопка позволяет поменять местами плательщика с получателем платежа. Она бывает нужна
	редко, но иногда позволяет сэкономить время.

	\item[Сумма платежа]
	В этом поле следует ввести общую сумму платежа. Система по умолчанию подставляет сюда
	номинальную сумму документа. Вы должны, при необходимости, изменить это значение.

	\item[Ставка НДС]
	Ставка НДС в процентах, которой облагается сумма платежа.

	\item[Сумма НДС]
	Сумма НДС, включенная в сумму платежа. Указав ставку НДС, сойдите с поля \qu{Ставка НДС}
	клавишей \keyb{Tab} и система сама посчитает значение суммы НДС и подставит его в это поле.
\end{description}

\subsection{Ввод дополнительных сумм документа}

\ppypict{dlg-billamounts}{Суммы документа}

Если вид операции, к которому относится вводимый документ, предполагает задание дополнительных
сумм, то, нажав кнопку \dlgbutton{Суммы}, вы увидите диалог, аналогичный показанному на рис.~\ref{pic-dlg-billamounts}.

В этом диалоге можно добавлять, редактировать и удалять дополнительные суммы документа.

При первом открытии этого диалога, система показывает список типов сумм, которые могут
быть введены и их значения, равные нулю. Для изменения какой-либо суммы щелкните дважды
мышкой по наименованию суммы и в появившемся диалоге измените значение на то, которое
должно быть.

\subsection{Ввод налоговых сумм документа}

Налоговые суммы - это специализированные типы сумм, отражающие величины налогов, которыми
облагается документ, раздельно по каждой ставке. Особенности настройки налоговых типов сумм
описаны в разделе, посвященном настройке операций.

\ppypict{dlg-030}{Налоги по документу}

Для редактирования налоговых сумм в диалоге документа предусмотрена
кнопка \dlgbutton{Налоги}, нажав на которую, вы увидите диалог,
подобный показанному на рис.~\ref{pic-dlg-030}.

Обратите внимание на то, что в полях ввода следует указывать именно значение суммы налога.
Вам следует быть внимательными при вводе этих величин, поскольку они должны согласовываться
с основными суммами документа. Так, например, если общая сумма документа составляет 1180
рублей, то значения налогов могут быть (не единственный вариант): НДС 10\% - 50, НДС 20\% - 100,
Налог с продаж 5\% - 30.

Для облегчения расчета значений сумм НДС можно в полях, соответствующих ставкам НДС, нажать
клавишу \keyb{F2}. При этом система рассчитает сумму НДС, исходя из общей суммы документа,
указанной в поле \qu{Номинальная сумма док}.

Справочное поле в нижней части диалога автоматически рассчитывает значение общей суммы по
введенных величинам налогов, позволяя контролировать правильность ввода.

\subsection{Ввод авансового отчета}

\ppypict{dlg-advrepbill}{Авансовый отчет}

\ppyadmin{
	Для того, чтобы настроить вид операции, соответствующий авансовому отчету:
	\begin{itemize}
		\item в опциях вида операции установить переключатель \dlgradioc{Подтип}
		в положение \dlgradioi{Авансовый отчет}
		\item включить признак \dlgflag{Допускает строки расширения}
		\item установить ту таблицу объектов операции, которая соответствует
		подотчетным лицам предприятия
		\item установить в параметрах настройки счет расчетов с подотчетными лицами
		(меню \ppymenu{Админ\rdir Настройки})
		\item в общем случае, желательно, что бы счет расчетов с подотчетными лицами
		имел бы прикрепленную таблицу статей, соответствующую той, которая указана в
		настройке вида операции авансового отчета
	\end{itemize}
}

Авансовый отчет является специализированной формой бухгалтерского документа, он относится к
группе так называемых многострочных бухгалтерских документов.
Поля \qu{Номер документа}, \qu{Дата} и \qu{Примечание} заполняются также, как и для других
документов. Остальные поля описаны в следующей таблице.

\begin{description}
	\item[\dlgcombo{Подотчетное лицо}]
	В списке этого комбо-бокса необходимо выбрать статью, соответствующую подотчетному лицу,
	которое сдает авансовый отчет. Если такой статьи нет, то ее следует завести.

	\item[Остаток от предыдущего аванса]
	Сумма, которую предприятие должно подотчетному лицу на момент выдачи денег, за которую
	оно отчитывается этим авансовым отчетом. Если подотчетное лицо должно было предприятию,
	то следует указать отрицательное значение.
	При нажатии кнопки \dlgbutton{*} справа от поля или клавиши \keyb{F2}, когда поле
	является выделенным, система автоматически посчитает остаток от предыдущего аванса
	подотчетного лица, исходя из анализа его счета.

	\item[\dlgbutton{Анализ счета}]
	Нажатие этой кнопки позволяет просмотреть анализ счета выбранного подотчетного лица.

	\item[Группа полей \qu{Получено}]
	Эта группа состоит из пары наборов полей ввода, позволяющих указать когда, откуда и какие
	суммы были получены, по которым составляется настоящий авансовый отчет. Поля \qu{От кого}
	содержат короткое текстовое описание источника получения денег (например, \qu{из кассы}).

	\item[Группа полей \qu{Итого}]
	Поля этой группы справочные. Они рассчитываются автоматически. Значение \qu{Получено} суммирует
	величины поля \qu{Остаток от предыдущего аванса} и полей суммы из группы \qu{Получено}. Значение
	\qu{Потрачено} суммирует величины полей \qu{Сумма} строк документа.
	Значение \qu{Остаток} является разностью между значениями \qu{Получено} и \qu{Потрачено}.

	\item[Группа полей \qu{Приложение}]
	Здесь можно указать сколько документов и листов прикладывается к авансовому отчету.
	Эта информация используется только для печати документа.

	\item[\dlgbutton{Суммы} и \dlgbutton{Налоги}]
	Назначение этих двух кнопок аналогично тому, как их используют во всех других документах.

	\item[\dlgbutton{Строки документа}]
	По нажатию этой кнопки появляется таблица просмотра и редактирования
	строк авансового отчета.

\end{description}

\subsubsection{Редактирование строк авансового отчета}

\ppypict{dlg-advrepitem}{Строка авансового отчета}

Авансовый отчет, кроме заголовочных данных содержит также строки, содержащие информацию о
потраченных суммах и оправдательных документах.
Для ввода, редактирования или удаления строк авансового отчета необходимо в диалоге
документа нажать кнопку \dlgbutton{Строки документа\dots}. При этом, на экране появится таблица, в
которой видны все строки авансового отчета.
Как и в большинстве других таблиц, для добавления новой строки следует нажать клавишу
\keyb{Insert}.

Диалог строки авансового отчета имеет вид, показанный на рис.~\ref{pic-dlg-advrepitem}.
Здесь:

\begin{description}
	\item[Дата]
	Дата совершения расходной операции. Как правило, эта дата совпадает с датой, указанной в
	оправдательном документе.

	\item[Номер документа]
	Номер оправдательного документа, подтверждающего расход.

	\item[\dlgcombo{Вид документа}]
	В этом комбо-боксе следует выбрать вид документа, подтверждающего сделанные расходы.
	Если справочник видов таких документов не содержит того вида, который вам нужен, то
	добавьте его, нажав клавишу \keyb{Insert} в открытом списке.

	\item[\dlgcombo{Счет}]
	Бухгалтерский счет, на который должны быть отнесены расходы, описанные этой строкой
	авансового отчета.

	\item[\dlgcombo{Статья}]
	Статья счета, на которую должны быть отнесены расходы, описанные этой строкой авансового
	отчета.

	\item[\dlgbutton{Редактировать}]
	Если со строкой авансового отчета не связан документ, то нажатие этой кнопки приведет к
	появлению диалога, предлагающего либо создать новый связанный со строкой документ, либо
	связать уже существующий.
	Если со строкой уже связан документ, то при нажатии этой кнопки указанный документ
	откроется для просмотра и редактирования.

	\item[\dlgbutton{Удалить}]
	Если со строкой авансового отчета связан документ, то нажатие этой кнопки приведет к
	появлению диалога, предлагающего либо удалить этот документ, либо разорвать связь
	между строкой авансового отчета и документом.

	\item[Сумма]
	Сумма расхода. Эта величина должна совпадать с суммой, указанной в подтверждающем
	документе.

	\item[Примечание]
	Произвольный текст для пояснений.
\end{description}

\ppyadmin{
	Для настройки шаблонов бухгалтерских проводок, генерируемых по каждой строке авансового
	отчета следует использовать следующие псевдопеременные:
	\newline $ALAMT$ - сумма строки авансового отчета
	\newline $ALACC$ - счет, указанный в строке авансового отчета
	\newline $ALAR$ - статья счета, указанного в строке авансового отчета
	Если проводка должна генерироваться на каждую строку документа, то в опциях шаблона проводки
	следует включить флаг \dlgflag{По строкам расширения бух документа}.
}

\subsubsection{Привязка документа к строке авансового отчета}

Вы, возможно, захотите связать со строкой авансового отчета какой-либо учетный документ.
Например, документ оплаты поставщику, поступления основных средств и т.д.
Возможность привязки документа к строке определяется настройкой вида отчетного документа,
указанного в этой строке. Если с этим видом отчетного документа связан вид операции учетного
документа, то нажав кнопку \dlgbutton{Редактировать} в блоке \qu{Связанный документ}, вы сможете либо
ввести новый документ, либо выбрать существующий по фильтру, определяемому видом операции
связанного документа (из вида отчетного документа), датой, введенной в строке авансового
отчета и складом, которому принадлежит авансовый отчет. Если в строке отчета указана статья,
то выбор документа для привязки также ограничивается этой статьей.

Кнопка \dlgbutton{Удалить} позволяет либо разорвать связь между строкой авансового отчета
и документом, либо полностью удалить связанный документ.
Если вы хотите вместо одного документа привязать другой, то сначала удалите связку
(или документ), а затем, привяжите другой документ.

\ppynote{
	При удалении авансового отчета документы, привязанные к строкам отчета не удаляются,
	поскольку не обязательно являются неотъемлемой частью авансового отчета.
	Будьте внимательны: если документ, привязанный к строке не имеет смысла без самого
	авансового отчета, то удалите его вручную.
}

\subsubsection{Настройка видов отчетных документов}

Виды отчетных документов, используемые в строках авансовых отчетов можно просматривать
и редактировать обратившись к пункту меню \ppymenu{Справочники\rdir Бухгалтерия\rdir Виды отчетных документов}.

Кроме наименования вида документа, запись содержит комбо-бокс выбора вида операции
привязанного документа и переключатель \dlgflag{Не проводить проводку, если есть связанный документ}.
Если этот флаг включен, то система не будет генерировать бухгалтерские проводки по строкам
авансового отчета, имеющим ссылку на такой вид отчетного документа и привязанным к учетным
документам (в этом случае предполагается, что учетный документ все необходимые
проводки создаст сам).

\section{Списание по счетам}

Специальные подтип бухгалтерских документов позволяет реализовать различные варианты
заключительных оборотов по бухгалтерским счетам в конце учетного периода.

Наиболее сложный момент в использовании технологии списания по счетам состоит
в настройке видов операций, применяемых для этого. Перечислим основные особенности
этих операций:

\begin{itemize}
	\item Вид операции, которому принадлежат документы списания по счетам, должен
	относится к типу \ppyrsrv{Бухгалтерская проводка} и подтипу \ppyrsrv{Списание по счетам}.
	\item Шаблоны проводок такого вида операции могут содержать определители счетов,
	характерные для языка описания данных DL200 (см. главу \ref{ch-dl200}).
	\item При необходимости осуществлять списание по всем статьям какого-либо
	счета, следует использовать специальные правила настройки, которые будут
	описаны ниже.
	\item Документ, относящийся к подтипу \ppyrsrv{Списание по счетам} имеет
	поле периода, в котором должен быть задан учетный период, применяемый к
	вычислению сумм по определителям счетов, заданным в	шаблоне проводки вида операции.
	\item Проводки по таким документам формируются так же, как и по всем остальным,
	датой самого документа (не по концу учетного периода). Таким образом, может
	возникнуть неоднозначная ситуация, когда заключительные обороты будут сформированы
	датой, значительно отличающейся от учетного периода, к которому они относятся.
	\item Проводки документов списания по счетам в общем случае не могут быть
	правильно перепроведены. Это - крайне важная особенность, о которой необходимо
	помнить при работе с такими документами. Связана она с тем, что суммы проводок
	формируются на основе данных по оборотам, которые сами эти проводки и изменяют.

	Например, документ списывает остаток на конец учетного периода по счету $X$ на счет $Y$.
	Дата списания - последний день периода. При перепроведении такого документа
	сумма списания изменится на ноль, поскольку до перепроведения этот документ
	сам же и обнулил остаток по счету $X$. При следующем перепроведении сумма
	проводки опять восстановит свое правильное значение.

	Видимо, хорошим методом нивелирования этой особенности будет установка на документы
	списания по счетам статуса, блокирующего изменение документа.
\end{itemize}

\chapter{Товарные документы\label{ch-bill-goods}}

К товарным относятся документы, связанные с материальным и количественным учетом товаров.
Любой товарный документ содержит список строк, которые мы будем именовать товарными строками
документа. Именно товарные строки составляют основное содержание товарного документа.
Каждая строка описывает товар, который принимал участие в операции, количество этого товара,
по каким ценам оно включено в операцию, а также ряд других характеристик, позволяющих задать
параметры учета товарной операции.
Работа с товарными документами подчиняется общим принципам работы с документами принятыми
в системе.

\section{Группы товарных документов}

Среди множества товарных документов следует выделить следующие категории:

\begin{itemize}
	\item приходные
	\item расходные
	\item модификацию
	\item переоценку
\end{itemize}

Приходные документы отражают поступление товара. В качестве контрагента в них
обычно выступает поставщик товара.

В расходных документах отражается расход товаров. В качестве контрагента здесь могут
выступать покупатель или получатель. Примерами расходных документов являются документы
розничной продажи, отпуска товара, отпуска по заказу, документы потерь, межскладской
передачи.

Упомянутая операция межскладского перемещения товаров стоит несколько обособленно в ряду
расходных документов. От прочих аналогичных операций ее отличает то, что она реализует
сдвоенное действие - расход товара с одного склада и одновременное приходование его на
другой. Таким образом, межскладская передача несет в себе признаки как расходной, так и
приходной товарной операции. Тем не менее, внутренняя передача все равно относится к
типу операции \ppyrsrv{Расход товара}.

Документы модификации отражают преобразование одного товара в другой и связанные с этим
изменения в количественном и материальном учете.

Переоценка изменяет ценовые параметры одной или нескольких партий товара.

\section{Особенности товарного учета в системе \ppybrand{}}

В этом подразделе мы опишем несколько принципиально важных, с точки зрения понимания дальнейшего
изложения, концепций.
Кроме того, целью подраздела является спецификация существенных принципов поведения системы.
Поэтому мы попытаемся подойти к изложению материала по возможности, с большей строгостью,
чем в других частях настоящего документа.

\subsection{Лоты}

Одним из важнейших понятий в модели товарного учета, реализуемой системой является лот.
Он представляет из себя единицу учета товара. Каждая товарная операция привязывается к
одному из лотов, расходуя, приходуя либо переоценивая товар, находящийся в нем. Лот
открывается при поступлении очередной партии товара. При расходе количество товара в лоте
уменьшается, при переоценке меняются учетные цены лота. Когда все количество товара, изначально
находящегося в лоте, израсходовано - лот закрывается. Система аккуратно отслеживает все
характеристики лота на предмет логической непротиворечивости при проведении любой товарной
операции.

Приведем список наиболее существенных характеристик лота

\paragraph{Дата образования} Дата поступления лота на склад.
\paragraph{Образующий документ} Документ, образовавший лот.
\paragraph{Товар} Товар, которому принадлежит лот.
\paragraph{Поставщик} Поставщик, от которого поступил лот.
\paragraph{Цена поступления} Учетная цена поступления лота.
\paragraph{Цена реализации} Учетная цена реализации.
\paragraph{Начальное количество} Начальное количество товара в лоте.
\paragraph{Текущий остаток} Количество товара в лоте, оставшееся после последней операции по нему.
\paragraph{Входная налоговая группа}
Группа налогообложения, которая определяет взаиморасчеты с поставщиком товара и расчет
НДС, идущего к зачету по лоту. Обычно входная налоговая группа отсутствует, что влечет
применение вместо нее налоговой группы, закрепленной за товаром, к которому относится
лот, однако, в некоторых случаях входная налоговая группа должна отличаться от той,
которая применяется при учете расходных операций по товару.

\ppyexampletitle{Пример 1}{
Вы торгуете товаром А исходя из того, что ставка НДС по нему составляет 20\%. Очередное
поступление этого товара от поставщика сопровождается счетом-фактурой, в которой он (товар)
облагается НДС со ставкой 10\%. При зачете НДС на товар в соответствии с этой счетом-фактурой
идет НДС 10\%, вы же, хоть и считаете, что товар облагается НДС 20\%, должны будете для
правильного расчета налогов установить на этот приход налоговую группу, содержащую ставку
НДС именно 10\%.
}

\ppyexampletitle{Пример 2}{
Вы получаете товар от поставщика, находящегося в другом регионе, налог с продаж в котором
отличается от вашего. Способ оплаты товара предполагает обложение налогом с продаж. В этом
случае также на помощь приходит входящая налоговая группа, в которой будет указана ставка
налога с продаж, соответствующая той, которой облагается рассматриваемая операция.
}

\paragraph{Сертификат} Сертификат, подтверждающий качественные характеристики товара, поступившего с этим лотом.
\paragraph{Срок годности} Срок годности товара, поступившего с лотом.
\paragraph{Серийный номер} Символьное обозначение лота. Для основных средств серийный номер имеет смысл
инвентарного номера объекта основных средств. Серийный номер может быть использован
для штрихового кодирования партий товаров.
\paragraph{Грузовая таможенная декларация (ГТД)}
Номер таможенной декларации, по которой импортный товар поступил на таможенную территорию
страны. По правилам ведения счетов-фактур и книги покупок, номер ГТД обязательно должен
быть отражен в этих документах, если продаваемый товар является импортным.
При оформлении счета-фактуры на продажу товара из лота, который имеет присвоенный номер
ГТД, этот номер автоматически будет печататься в соответствующей графе.

При перемещении товаров с одного склада на другой, на складе-получателе образуется лот,
порожденный от того, из которого был израсходован товар на складе-отправителе. При этом,
порожденный лот наследует базовые характеристики своего \qu{предка}, такие как: товар, поставщик,
цена поступления, входная налоговая группа, сертификат, срок годности, серийный номер, номер ГТД.

\subsection{Не лимитируемые товары}
Понятие не лимитируемого товара имеет принципиальное значение при учете услуг, а также
специфических товаров, остатки по которым не отслеживаются либо не могут быть отслежены по
каким-либо причинам (вода в водохранилище, песок в карьере и т.д.). Попробуем сформулировать
обобщенное правило: для не лимитируемого товара подсчитывается изменение, но не учитывается остаток.
Из-за таких особенностей, по не лимитируемым товарам не формируются лоты. Следовательно, для
таких товаров не существует учетных цен поступления и реализации, привязки сертификатов,
ГТД и прочих атрибутов, учитываемых лотами.
\ppynote{
	В версиях системы выше, чем 5.5.5, при соответствующей установке конфигурации, для
	не лимитируемых товаров создаются лоты заказов. Благодаря этому, система может подсчитать
	заказанное и отгруженное по заказу количество услуг.
}

\subsection{Учетные цены}

Учетные цены - это закрепленные за каждым лотом значения цен поступления и реализации. При
поступлении товара система требует ввода цены поступления и цены реализации - эти значения не
могут в дальнейшем меняться произвольно, а только в результате переоценки, оформленной документом.

Каждая товарная операция, привязанная к лоту, наследует от него учетные цены, благодаря чему
осуществляется точное слежение за суммовыми характеристиками всех товарных операций порознь
и в выборке. Понятие учетных цен является центральным моментом в реализации, так называемого,
принципа сходимости данных. Этот принцип подразумевает соответствие и непротиворечивость
между значениями, выдаваемыми системой в результате анализа данных. Например, сумма исходящих
товарных остатков на конец некоторого периода должна быть равна сумме приходных операций и
переоценок за период, минус расходные операции за период, плюс, входящие остатки на начало
периода. Другой важный пример - это требование соответствия между товарными остатками и
остатком по соответствующему бухгалтерскому счету (41).
Строгий подход к учетным ценам со стороны системы \ppybrand{} не ограничивает, вместе с тем,
свободы ценообразования, поскольку наряду с учетной ценой товара может существовать множество
котировок на товары, устанавливаемым по разным правилам.

Система допускает ввод пяти десятичных знаков в ценах поступления и реализации.
При этом суммы документов, а также суммы бухгалтерских проводок округляются до
двух знаков после десятичной точки.

\subsection{Правила ценообразования}

Из-за того, что  \ppybrand{} предоставляет множество инструментов для ценообразования, важно
понимать в каких условиях и как определяется цена на товар для продажи.
В первую очередь перечислим инструменты формирования цены реализации.
\begin{itemize}
	\item	Учетная цена реализации
	\item	Учетная цена поступления (эта величина может косвенно влиять на цену реализации через
	относительные котировки)
	\item	Котировки
	\item	Скидки по документу
	\item	Расценка приходного документа (правило формирования учетной цены реализации по лотам
	на основе котировок)
	\item	Документы товарного заказа (влияют на формирование цены продажи при отгрузке по этим
	заказам)
\end{itemize}
Далее, разграничим следующие два принципиально различных случая формирования цены реализации:
\begin{enumerate}
	\item	Цены в учетных документах отгрузки
	\item	Цены, загружаемые на асинхронные кассовые узлы и цены, применяемые в кассовой панели
\end{enumerate}

\subsubsection{Цены в учетных документах отгрузки}

	\paragraph{Базовое правило} для формирования цены реализации в документе отгрузки
	заключается в использовании учетной цены реализации из лота, к которому привязывается
	строка отгрузки. Таким образом, если в конфигурации установлен порядок списания FIFO,
	то применяется цена по первому (на дату документа) открытому лоту, если LIFO, то - по
	последнему на дату документа открытому лоту.

	Оговорка \qu{на дату документа} означает, что лоты, дата которых больше даты документа,
	не учитываются при выборе лота списания.
 	\paragraph{Принцип приоритета ручного ввода перед автоматическим} если в выбранном
	лоте не хватало остатка для расхода заданного количества товара и пользователь согласился
	на предложенное системой автоматическое использование других лотов, то цена для автоматически
	сформированных строк устанавливается та же, что и для строки, которая была введена вручную.
	\paragraph{Принцип приоритета договора} если строка расходного товарного документа
	вводится с привязкой к товарному заказу, выписанному на этого же контрагента, то цена продажи
	для этой строки автоматически становится равной разнице цены реализации и скидки в
	соответствующей строке заказа.
	\paragraph{Применение котировки} если пользователь применяет котировку к выбранной
	строке расходного товарного документа (вручную или автоматически), то система пытается
	найти наиболее подходящую условиям документа котировку и, если такая котировка найдена,
	цена реализации по этой строке становится равной найденной котировке. При этом, если
	котировка является относительной, то для расчета значения цены используются учетные цены
	лота, к которому привязана строка.

	Если подходящая котировка системой не найдена, то цена, установленная до попытки применить
	котировку фиксируется. Это значит, что ручное изменение цены в этой строке становится
	невозможным, если не применена операция освобождения цены.

	В случае, если подходящая котировка найдена, цена также фиксируется.
	\paragraph{Скидка на весь документ} если пользователь установил скидку на весь
	документ (в процентах или в абсолютном выражении), то эта скидка распределяется между
	строками документа в соответствии с алгоритмом, определяемым конфигурацией.

	\ppynote{
		При этом скидка применяется к строкам как с фиксированными, так и не фиксированными
		ценами. То есть, к ценам, установленным по котировкам, скидка также применяется.
	}
	\paragraph{Избирательность применения общей скидки на документ} единственной
	возможностью не применять общую скидку к каким либо строкам расходного товарного документа
	является установка у соответствующих товаров признака \dlgflag{Без скидки}.
	\paragraph{Принцип обратимости} применение общей скидки на документ обратимо. То
	есть, пользователь может произвольно изменять значение скидки на весь документ или вовсе
	отменять ее, при этом цены по каждой строке рассчитываются так, как будто скидка
	применяется в первый раз.
	\paragraph{Зависимость цены от алгоритма распределения общей скидки} система располагает
	несколькими алгоритмами распределения общей скидки по строкам документа. Описание этих
	алгоритмов приведено в приложении. Здесь же важно отметить, что выбор того или иного
	алгоритма может незначительно отразиться на конечной цене товара.
	\paragraph{Цена для нелимитированого товара} если в строке расходного товарного
	документа выбирается нелимитированый товар, то в качестве учетной цены реализации система
	использует наиболее подходящую базовую котировку этого товара. Если такая котировка не
	обнаружена, то система сообщает об этом пользователю и предлагает ввести эту котировку
	для выбранного товара.

\subsubsection{Цены, применяемые для автоматизированной розничной торговли}

Принципы определения цены реализации для розничной торговли значительно отличаются от
принципов, применяемых в учетных документах из-за целого ряда факторов, среди которых
следующие:
\begin{itemize}
 	\item Розничная продажа не отражается немедленно на учетных документах.
	\item Количество транзакций розничной продажи намного превышает количество оных при
	оптовых отгрузках (где обычно и применяют непосредственную выписку документов).
	\item Специфика розничной продажи предполагает частую смену цен реализации, а также
	применение различных скидок и ценовых акций для привлечения покупателей.
	\item Цены реализации товаров необходимо асинхронно загружать в кассовые модули от разных
	производителей, а так же в электронные весы и другие устройства, где они используются
	независимо от основной базы данных предприятия до следующей загрузки.
\end{itemize}
При все этом, инструменты ценообразования в системе \ppybrand{}, применяемые для розничной
торговли те же, что и при непосредственной выписке документов отгрузки.
Итак, определяем правила ценообразования для розничной торговли.

\paragraph{Базовое правило} для формирования цены реализации используется учетная цена
по последнему лоту. Здесь возможны два варианта определения последнего лота:
\begin{enumerate}
	\item последний открытый лот с датой прихода не больше текущей операционной даты. Этот
	вариант применяется системой, если в конфигурации справочника товаров флаг
	\dlgflag{Розничная цена - по самому последнему лоту} выключен.
	\item самый последний лот с датой прихода не больше текущей операционной даты. Этот
	вариант применяется системой, если в конфигурации справочника товаров флаг
	\dlgflag{Розничная цена - по самому последнему лоту} включен.
\end{enumerate}

\paragraph{Применение котировок для переопределения базового правила} если в записи
кассового узла установлен вид котировки, то для товаров, для которых существует
определенная котировка этого вида при заданных условиях (дата, склад) базовая цена
будет переопределена на значение этой котировки.

\section{Управление ограничениями\label{sec-goodsbill-restrictions}}

Система \ppybrand{} предоставляет ряд инструментов, управляющих
оганичениями на редактирование документов. Здесь речь идет не о регламенте, определяемом
правами доступа (этот аспект рассмотрен отдельно), а о функциональных правилах,
ограничивающих товарные документы в соответствии с особенностями бизнес-процессов на
предприятии.

Список существующих инструментов выглядит так:
\begin{description}
	\item[Товарная матрица] Специальная структура, связывающая номенклатурную единицу со складом,
	и определяющая возможность использования этой единицы в видах операций, для которых
	задано соответствующее ограничение.

	Товары, не принадлежащие матрице, не могут быть добавлены в документы, относящимся к
	видам операций, для которых задано соответствующее ограничение.

	Существует дополнительный механизм ослабления указанного ограничения за счет
	конфигурации учетных записей пользователей.

	Важной особенностью товарной матрицы является ее \qu{строгость}. То есть
	система не дает возможность обойти ограничение, накладываемое матрицей, иначе
	как административными мерами.

	\item[Контрактные цены] Это - средства ценового контроля прихода товаров от
	поставщиков. С различными комбинациями товар-склад-поставщик могут быть связаны
	значения контрактных цен и их допусков (верхних и нижних границ), которые
	ограничивают возможность ввода в документ прихода от поставщика товаров с
	ценами поступления, выходящими за пределы, заданные контрактными ценами.

	Система позволяет управлять степенью строгости этого инструмента.

	\item[Ограничения товарных величин]
	Новая технология контроля цен в документах. Описана ниже.

	\item[Специальные типы персональных регистрационных документов]
	Механизм, обеспечивающий возможность (невозможность) вставки в товарный
	документ номенклатурных позиций, принадлежащих товарной группе, указанной
	в типе регистрационного документа, в зависимости от того, есть
	у контрагента соответствующий регистр или нет.

	Подробно правила установки таких ограничений описаны в разделе,
	посвященном типам регистрационных документов (стр.~\pageref{sec-registertype}).

	\item[Товарные коды по статьям]
	Существует техника запрета на внесение в товарный документ номенклатурных
	позиций, которые не имеют кода, сопоставленного с основной статьей документа.

	Смысл применения этой техники может заключаться либо в запрете
	отгрузки покупателю товаров, которые не включены в предварительно
	оговоренный перечень, либо блокировки прихода от поставщика позиций,
	которые не были согласованы до этого (впрочем, для этого можно применять
	и контрактные цены - здесь выбор того или иного инструмента
	определяется спецификой договоренностей).

	Для того, чтобы описываемый запрет заработал необходимо в соглашении
	с клиентом или поставщиком установить флаг \dlgflag{В документы добавлять только товары, имеющие код по статье}.
	С этого момента, если пользователь попытается добавить в документ, связанный
	с таким контрагентом товар, не имеющий соответствующего кода, система
	выдаст сообщение об ошибке.

	Подробности о соглашениях с клиентами и поставщиками см. стр.~\pageref{sec-cliagt}.

\end{description}

\subsection{Ограничения товарных величин}

Этот механизм создавался как универсальный инструмент управления ограничениями
на ввод величин, связанных с товарами. В первую очередь, речь идет о ценах,
но в дальнейшем его применение может быть распространено и на другие ассоциированные
с товарами показатели.

\ppypict{Schema-GoodsValRestrict}{Объекты данных, используемые для ограничения товарных величин}

Схема взаимосвязи объектов данных, задействованная при проверке цены
на ограничения в товарных документах, приведена на рис.~\ref{pic-Schema-GoodsValRestrict}.

\section{Документы прихода}

Документы прихода товаров принадлежат к типу операций \ppyrsrv{Приход товара}.
Данная категория документов обеспечивает следующие бизнес-процессы предприятия:

\begin{itemize}
	\item Приход товара от поставщика.
	\item Формирование товарных излишков при проведении инвентаризации.
	\item Несвязанный межскладской приход.
	\item Несвязанный возврат товара от покупателей.
\end{itemize}

Главная особенность документов прихода состоит в генерации лотов. То есть,
каждая строка такого документа (за некоторыми исключениями) формирует запись
лота, который в дальнейшем может расходоваться, переоцениваться или
перемещаться на другие склады.

\subsection{Редактирование документов прихода}

Далее мы подробно разберем правила и особенности работы с документами товарного прихода.
Заметим, что здесь будут разъяснены методы и подходы, используемые так же и при работе
с другими категориями документов. Поэтому, в дальнейшем, рассказывая об иных
категориях документов, мы часто будем отсылать читателя к данному разделу.

\subsubsection{\qu{Шапка} документа прихода товара}

\ppypict{dlg-b-rcpt}{Диалог редактирования документа}

Диалог ввода и редактирования документа прихода товара показан на рис.~\ref{pic-dlg-b-rcpt}.
Далее перечислены все поля этого диалога и приведены необходимые пояснения.

\begin{description}
	\item[Номер документа]
	Здесь должен быть введен номер документа. Так как, чаще всего, приходные документы являются
	входящими для организации, то номер должен соответствовать номеру входящей накладной.
	Для нового документа номер устанавливается системой автоматически в согласии с операционным
	счетчиком, определенным для соответствующего вида операции.

	Пользователь может изменить автоматическую нумерацию, нажав в этом поле \keyb{F2} (он должен иметь
	права доступа на это действие).

	Если данный приход сопровождается счет-фактурой, имеющей номер, отличный от номера
	накладной, то номер счета-фактуры следует вводить в диалоге дополнительной
	информации по документу.

	\item[Дата]
	Дата поступления товара на склад. Отметим, что не всегда эта дата равна дате, указанной во
	входящей накладной (счете-фактуре) от поставщика.
	Здесь должна быть именно дата поступления товара на склад.
	Если дата счета-фактуры от поставщика отличается от введенного здесь значения, то эту дату
	следует ввести в поле \qu{Дата счета-фактуры} в дополнительной информации по документу.

	Право пользователя на изменение даты существующего документа регламентируется %
	флагом \dlgflag{Модификация даты} в правах по объекту \ppyrsrv{Документы}.

	\item[\dlgcombo{Поставщик}]
	Аналитическая статья, соответствующая поставщику товара.

	\ppynote{
		При вводе документа прихода товара обязательно следует указать поставщика до начала ввода
		товарных строк. Такое правило исходит оттого, что, формируя строки приходного документа,
		система устанавливает в соответствие каждому лоту поставщика, выбранного в шапке документа.

		Если вы приступите к вводу товарных строк, не выбрав поставщика, система предупредит вас
		о том, что ваши действия, возможно, не правильны.

		Это предупреждение можно проигнорировать, но в таком случае система будет обрабатывать
		строки документа несколько иначе, чем в штатном режиме).
	}

	\item[\dlgbutton{Соглашение...}]

	\item[Дополнительная статья документа (на рисунке не показана)]
	Если вид операции предусматривает ввод дополнительной статьи, то ниже поля \dlgcombo{Поставщик}
	будет виден комбо-бокс, подписанный так, как задано в опциях вида операции.

	Подробности настройки видов операций см. на стр.~\pageref{sec-oprkind}.

	\item[Сумма]
	Номинальная сумма документа. Обычно она рассчитывается по товарным строкам. Система не
	допускает ручного изменения этой величины.

	Методика расчета номинальной суммы документа определяется настройками вида операции,
	к которому принадлежит документ. Для документа прихода чаще всего номинальная сумма
	рассчитывается сложением сумм товарных строк в терминах цен поступления.

	\item[\dlgcombo{Валюта}]
	Если документ номинирован в валюте, отличной от базовой, то в этом комбо-боксе следует
	выбрать требуемую валюту.

	\item[Курс]
	При выборе валюты документа, в этом поле автоматически установится курс базовой валюты
	учета относительно выбранной валюты, если в системе ведется таблица валютных курсов.

	Пользователь имеет возможность установить здесь курс вручную.

	Для того, чтобы самостоятельно выбрать значение курса из таблицы валютных курсов, нажмите
	в этом поле клавишу \keyb{F2}.

	Обращаем внимание на то, какой тип курса должен использоваться при установке этого значения:
	речь идет о формальном курсе обмена, применяемом для учета валютных бухгалтерских операций.
	То есть, здесь не следует вводить курс применяемый вашим предприятием для взаимозачета с
	поставщиком (курс взаимозачетов - вопрос оплаты, а не учета прихода товаров или услуг).

	\item[Базовая сумма]
	Валютные документу учитываются параллельно и в указанной валюте документа и в базовой
	валюте.

	Если валюта установлена, то в этом поле будет показана номинальная сумма в базовой валюте
	предприятия.

	\item[\dlgbutton{Суммы}]
	Эта кнопка открывает доступ к диалогу редактирования сумм документа, соответствующих типам
	дополнительных сумм, заданных в виде операции.

	\item[\dlgflag{Цены включают налог с продаж}]
	Если действующее законодательство применяет налог с продаж и цены, указанные в накладной
	от поставщика включают налог с продаж, то следует установить этот флаг.

	\item[Дата оплаты]
	Срок оплаты по документу. Если для поставщика определено соглашение, в котором установлено
	количество дней отсрочки платежа, то, при вводе нового документа, в этом поле автоматически
	установится дата, равная дате документа плюс обозначенное количество дней.

	Если пользователь хочет сам установить срок оплаты по количеству дней от даты документа,
	то он может нажать клавишу \keyb{F2} в этом поле. Тогда на экране появится диалог, в котором можно
	установить количество дней и нажать \keyb{Enter}: система сама рассчитает дату оплаты, прибавив к
	дате документа введенное количество календарных дней.

	Если открыть существующий документ, то данное поле может оказаться окрашенным в
	коралловый цвет. Причиной такого окрашивания является то, что дата оплаты,
	установленная в поле не согласуется с соглашением с поставщиком.
	Это может и не быть ошибкой, но повод обратить внимание на указанное обстоятельства.

	\item[Поле статуса]
	Прямоугольник в правой части диалога выше строки примечания предназначен
	для отображения текущего статуса документа. Если статус документа не определен,
	то это поле пустое.

	Изменение статуса документа не возможно непосредственно в диалоге.
	Подробно статусы документов разобраны на стр.~\pageref{sec-billstatus}.

	\item[Примечание]
	Произвольная строка пояснения к документу.

	\item[\dlgbutton{Строки документа}]
	Нажатие на эту кнопку открывает таблицу товарных строк документа.
	Для ускорения ввода, вместо непосредственного использования этой кнопки, можно нажать
	клавишу \keyb{F11}.

	\item[\dlgbutton{Дополнительно}]
	По этой кнопке доступен диалог дополнительных полей документа, описанный ниже.

	\item[\dlgbutton{Фрахт}]
	Нажав на эту кнопку, вы сможете редактировать параметры доставки по накладной.
	Кнопка доступна только в том случае, если в опциях вида операции установлен флаг
	\dlgbutton{Ввод информации по фрахту}.

	Информация по фрахту будет описана ниже в этом разделе.

	\item[\dlgbutton{Теги...}]
\end{description}

\subsubsection{Диалог дополнительных параметров документа}

\ppypict{dlg-b-ext}{Диалог дополнительных параметров документа}

Диалог дополнительных параметров документа (рис.~\ref{pic-dlg-b-ext}) включает следующие
управляющие элементы:

\begin{description}
	\item[\dlgcombo{Плательщик}]
	Организация, которой вы будете оплачивать введенный документ. Как правило, это поле
	остается пустым, а это означает, что платить вы будете собственно поставщику товара.

	\item[\dlgcombo{Агент}]
	Агент, через которого заключена сделка купли-продажи. Система предлагает в списке
	этого комбо-бокса выбор аналитических статей, соответствующих таблице агентов.

	Заметим, что агент по документу прихода товара, кроме обычного, имеет дополнительный
	смысл, заключающийся в том, что он становиться агентом поставщика. При описании
	товарных отчетов мы не один раз встретимся с этим понятием.

	Например, вы можете поднять какой-либо отчет с фильтрацией по агенту поставщика.
	В этом случае система будет просматривать операции, привязанные к лотам, сформированным
	приходными документами, агентом по которым является указанная в этом поле аналитическая
	статья.

	\item[Номер счета-фактуры]
	Если счет-фактура на поступающий товар выписывается позже накладной и имеет номер, отличный
	от номера документа, то в этом поле следует указать фактический номер счета-фактуры. Это
	важно для бухгалтерского учета и правильного ведения книги покупок. Если поле пустое, то
	номер счета-фактуры полагается тот же, что и номер документа.

	\item[Дата счета-фактуры]
	Если дата счета-фактуры отличается от даты накладной, по которой получен товар, то в этом
	поле необходимо указать эту дату. Если поле пустое, то полагается дата счета-фактуры
	равной дате документа.

	\item[Номер платежного документа]
	Используется только для печати первичных форм по документу.
	Переносится в структуру DL600 \ppyrsrv{Bill} с именем PaymBillCode.

	\item[Дата платежного документа]
	Используется только для печати первичных форм по документу.
	Переносится в структуру DL600 \ppyrsrv{Bill} с именем PaymBillDate.

	%
	% @todo В приходных документах следующие поля не используются.
	% следует перенести описания либо в раздел, описывающий общие параметры
	% документа, либо в раздел, посвященных расходным документам.
	%
	\item[\dlgcombo{Котировка для дополнительной цены}]
	Специализированная поле. Применяется для печать дополнительной
	цены в первичных формах по документу.

	Один из вариантов использования следующий:
	если ваше предприятие осуществляет оптовую отгрузку товаров
	клиенту, имеющему сеть небольших магазинов либо киосков, то
	вы можете договориться с этим клиентом передавать товар в
	его магазины с отпечатанными розничными ценами, по которым
	эти магазины должны продавать товар.

	Цены магазинов клиента будут автоматически формироваться на
	основе котировок (принадлежащих виду указанному в рассматриваемом поле),
	заданных в вашей базе данных по этому клиенту.

	\ppynote{
		В приходных документах это поле не применяется.
	}

	\item[Номер персональной карты]
	Номер персональной карты, которая привязана к документу.

	Если с документом связана персональная карта, то номинальная сумма
	этого документа изменяет обороты по карте. Одновременно, скидка
	заданная картой применяется к документу.

	\ppynote{
		В приходных документах это поле не применяется.
	}

	\item[\dlgflag{Отгружен}]
	Признак, отражающий факт того, что товар по документу был отгружен
	покупателю.

	\ppynote{
		В приходных документах это поле не применяется.
	}
\end{description}

\subsubsection{Таблица товарных строк документа прихода}

\ppypictsc{brw-goodsbillitems}{Строки товарного документа}{0.6}

Таблица строк документа (рис.~\ref{pic-brw-goodsbillitems}) появляется в ответ
на нажатие кнопки \dlgbutton{Строки документа} в диалоге товарного документа,
либо при быстром просмотре строк из таблицы документов (см. стр.~\pageref{sec-ppview-bill}).

\paragraph{Колонки таблицы товарных строк документа}

Таблица обычно содержит следующие колонки:

\begin{description}
	\item[\#]
	Номер строки по порядку.

	\item[Товар]
	Наименование товара.

	\item[Код]
	В зависимости от конфигурации (стр.~\pageref{sec-bill-cfg}), эта колонка может содержать
	либо штрихкод товара, либо серийный номер лота, либо вовсе отсутствовать.

	\item[Количество]
	Количество товара поступившего на склад.

	\item[Цена поступления]
	Себестоимость одной торговой единицы. В самом распространенном варианте это -
	цена с НДС, указанная в накладной поставщика. Вариации мы рассмотрим отдельно.

	\item[Цена реализации]
	Учетная цена реализации одной торговой единицы товара.

	\item[Скидка]
	Разница между фактической и учетной ценами. В случае приходного
	документа это значение всегда нулевое.

	\item[Сумма]
	В зависимости от установки способа расчета номинальной суммы,
	в этой колонке отображается либо произведение цены поступления на
	количество, либо произведение чистой (цена минус скидка) цены реализации
	на количество.

\end{description}

\paragraph{Итоговая строка таблицы товарных строк документа}

Последняя строка таблицы товарных строк документа содержит итоговые значения:

\begin{description}
	\item[Товар]
	В последней строке этой колонки указывается общее количество строк документа.

	\item[Количество]
	Общее количество торговых единиц по всем строкам.

	\item[Цена поступления]
	Сумма произведений цен поступления на количество торговых единиц.

	\item[Цена реализации]
	Сумма произведений цен реализации (без учета скидки) на количество торговых единиц.

	\item[Скидка]
	Сумма произведений скидки по каждой строке на количество торговых единиц.

	\item[Сумма]
	Простая сумма значений всех строк этой колонки.

\end{description}

\paragraph{Цветовое выделение элементов таблицы}

В приходных товарных документах ячейки таблицы могут содержать
цветовую индикацию факта отличия цен поступления или реализации
от соответствующих цен предыдущего лота, относящегося к этому же
товару и складу:

\begin{itemize}
	\item Если цена отличается в большую сторону, то левый верхний угол соответствующей
	ячейки окрашивается в зеленый цвет.
	\item Если цена отличается в меньшую сторону, то левый верхний угол соответствующей
	ячейки окрашивается в красный цвет.
	\item Если на дату документа приходов этого товара на склад не было, то левый верхний
	угол ячейки количества окрашивается в синий цвет.
	\item Если цена реализации выходит за допустимые границы, определенные ограничениями
	товарных величин, то нижний левый угол соответствующей ячеки с ценой реализации окрашивается в
	серый цвет.
\end{itemize}

Также может существовать иная цветовая идентификация:
\begin{itemize}
	\item Если строка документа была принята из другого раздела и синхронизирована с ним по идентификатору лота, то нижний левый угол соответсвующей ячейки с количеством товара окрашивается в фиолетовый цвет.
	\item Если неправильно указан серийный номер, то левый верхний угол соответсвующей ячейки окрашивается в оранжевый цвет.
\end{itemize}



\paragraph{Действия в таблице товарных строк документа}

	\paragraph{Редактирование строки}\indent\keyb{Enter}
	По этой команде вызывается диалог редактирование текущей товарной строки документа

	\paragraph{Стандартное добавление строки}\indent\keyb{Insert}
	Стандартный метод ввода новой строки. Наиболее универсальный способ ввода товарных строк
	документа.

	\paragraph{Удаление строки}\indent\keyb{Delete}
	Удаление текущей строки.
	Если в конфигурации не указан признак \qu{Подтверждать удаление строки документа}, то
	система удалит строку, не требуя предварительного подтверждения.

	\paragraph{Расширенное добавление строки}\indent\keyb{F2}
	Способ ввода новых товарных строк, более, чем стандартный, приспособленный для ввода
	больших документов. При его использовании, на экране постоянно висит список товаров,
	выбирая из которого один за другим элементы, можно экономить несколько нажатий на
	клавиши, что очень актуально в условиях постоянной нехватки времени у операторов.

	\paragraph{Редактировать товар}\indent\keyb{Shift-F2}
	Просмотр и редактирование записи товара, соответствующего выбранной строке

	\paragraph{Партии по строке}\indent\keyb{Shift-F3}
	Просмотр лотов товара, соответствующего выбранной строке

	\paragraph{Поиск товара для добавления строки по штрихкоду}\indent\keyb{F3}
	Эта команда позволяет выбрать товар по штрихкоду. Использование штрихового кодирования
	значительно ускоряет ввод документов.
	Если вы не знаете штрихкода полностью, а лишь его часть, то можно ввести перед известной
	частью штрихкода звездочку. В ответ на это система выведет список штрихкодов, содержащих
	указанный фрагмент, например *46014, выдаст список сигарет, произведенных компанией
	Philip Morris в России, присутствующих в вашей базе данных.

	\paragraph{Поиск по наименованию}\indent\keyb{F4}
	При обращении к этой функции на экране появится диалог, в котором вы можете
	ввести строку поиска.

	В ответ на это на экране появится список товаров, наименования которых содержат
	указанную строку.

	Допускается ввод строки, начинающейся со знака восклицания (что означает
	нечеткий поиск).

	\ppynote{
		Если в вашей базе данных справочник товаров очень большой, то
		выбор требуемых наименований может занять значительное время.
	}

	\paragraph{Поиск товара для добавления строки по штрихкоду}\indent Клавиши 0..9,'*'
	Не обязательно нажимать \indent\keyb{F3} для выбора товара по штрихкоду.
	Достаточно просто нажать цифровую клавишу, или \indent\keyb{*}. При этом
	появится маленькое окно, в котором можно продолжить вводить штрихкод,
	соответствующий которому товар необходимо добавить в документ.
	Самым замечательным в таком вводе оказывается то, что штрихкод можно
	считать непосредственно сканером, подключенным к клавиатурному
	разъему компьютера. Система распознает это как ввод с клавиатуры.

	\paragraph{Добавить из заказа}\indent\keyb{F6}
	Эта возможность используется только в документах продажи при условии, что вид операции,
	к которой относится документ, имеет признак \dlgflag{Продажа по заказу}
	(см. опции вида операции).

	\paragraph{Добавить из корзины}\indent\keyb{F8}
	Используя эту команду, вы можете добавить в документ строки из товарной корзины. В ответ
	на команду, система попросит вас выбрать корзину, содержимое которой вы хотите добавить в
	документ, и, в ответ на выбор корзины, сформирует соответствующие строки.
	Очень удобно использовать такой метод вставки строк совместно с ручным терминалом сбора
	данных. Порядок работы при этом следующий:

	\begin{enumerate}
		\item	на складе товары, поступившие от поставщика, сканируются терминалом по штрихкодам,
		вводятся их количество и цены
		\item	введенные в терминал данные передаются в систему \ppybrand{}, которая формирует товарные
		корзины, в соответствие с этими данными
		\item	заводятся приходные документы, содержимое которых быстро заполняется из созданных
		товарных корзин
		\item	если необходимо, то автоматически сформированные строки правятся - вводятся цены
		реализации, сертификаты, номера ГТД и т.д.
	\end{enumerate}

	\paragraph{Добавить в корзину}\indent\keyb{Ctrl-F8}
	По этой команде все товарные строки из документа переносятся в выбранную корзину.
	Предварительно система высвечивает диалог, в котором вы сможете выбрать корзину и колонку
	цен, которые следует занести в корзину.

	\paragraph{Печать этикетки}\indent\keyb{Ctrl-L}
	Эта команда позволяет распечатать товарные этикетки по выбранной строке документа, либо
	по всем строкам. Этикетки выводятся на специализированный принтер штрихкодов.

	\paragraph{Печать первичных документов по всей выборке}\indent\keyb{Ctrl-S}
	Команда позволяет вызвать функцию печати первичных документов (накладных, счетов-фактур
	и т.д.) по всей выборке документов.
	Обратите внимание на то, что в этом случае опции экспорта и предварительного просмотра
	не доступны: система сразу отправляет все документы на принтер.

	\paragraph{Добавить пакет}\indent\keyb{F5}
	Функция создания пакета позволяет создать нумерованный товарный пакет, содержащий набор
	лотов. Функции работы с пакетами используется в очень немногочисленных секторах рынка,
	поэтому их мы рассмотрим в отдельном разделе.

	\paragraph{Содержимое пакета}\indent\keyb{Ctrl-F5}
	Дает возможность увидеть содержимое товарного пакета. Пакет раскрывается в таблицу,
	аналогичную таблице товарных строк документа.

	\paragraph{Альтернативная таблица}\indent\keyb{Ctrl-A}
	Открывает таблицу, в которой показаны дополнительные поля по строкам документа. Эти поля
	включают в себя следующие колонки:

	\begin{itemize}
		\item	Номер строки
		\item	Наименование товара
		\item	Налоговая группа
		\item	Ставка НДС
		\item	Сумма НДС
		\item	Признак \dlgflag{Цена поступления без НДС}
		\item	Признак \dlgflag{Цена реализации без налогов}
		\item	Срок реализации
	\end{itemize}
	Эта таблица открывается поверх основной таблицы строк документа, однако в ней также, как
	и в основной, доступны все операции со строками.
	После закрытия таблицы с дополнительными колонками, активной станет снова основная
	таблица.

	\paragraph{Автоматическое назначение цен реализации}\indent\keyb{Ctrl-B}\label{loc-bitmbrow-valuation}
	Функция быстрого назначения учетных цен реализации на введенные строки приходного
	документа.

	При вызове этой функции, система покажет на экране диалог, в котором пользователь
	может выбрать вид котировки, используемый для расценки, а также способ округления
	результирующих цен.

	Если вы собираетесь использовать эту функцию, то вам следует завести отдельный вид
	котировки и соответствующим образом администрировать котировки по товарам или группам
	товаров, соответствующие этому виду котировки. Правильнее всего использовать относительные
	котировки, заданные в привязке к ценам поступления.

	Будьте внимательны и избегайте применения значений котировок, используемых для расценки,
	заданных относительно цены реализации.

	\paragraph{Итоги по строкам}\indent\keyb{Ctrl-T}
	Показывает на экране диалог, содержащий итоговые значения по строкам документа
	Этот диалог показывает следующие величины:
	\begin{itemize}
		\item	Количество строк
		\item	Количество товарных позиций (если одна позиция введена более, чем одной строкой,
		то это значение будет отличаться от количества строк)
		\item	Общее количество торговых единиц всех товаров в документе
		\item	Общее количество физических единиц всех товаров в документе
		\item	Масса брутто по всем строкам документа
		\item	Общий объем по всем строкам документа
		\item	Список сумм документа
	\end{itemize}
	Обратите внимание на то, что масса брутто и общий объем рассчитываются исходя из
	грузовых параметров товаров, входящих в документ. Если для какого-то из товаров
	эти параметры не указаны, то результирующие значения могут быть значительно искажены.

\subsubsection{Диалог строки документа прихода товара}

\ppypictsc{dlg-ti-rcpt}{Поступление товара}{0.4}

При вводе или редактировании товарной строки документа прихода используется диалог,
показанный на рис.~\ref{pic-dlg-ti-rcpt}. В каждой конкретной сфере бизнеса, далеко
не все поля  этого диалога необходимы. В следующей таблице подробно рассмотрены все
поля, вам же, следует самостоятельно решать какие поля заполнять, а какие оставить
пустыми.

\begin{description}
	\item[\dlgcombo{Группа}]
	Группа (обыкновенная) которой принадлежит выбранный товар.

	\item[\dlgcombo{Товар}]
	Сокращенное наименование товара, поступающего от поставщика.

	\item[Емкость упаковки]
	Количество единиц товара, содержащегося в одной упаковке.
	Обратите внимание на то, что один и тот же товар может иметь более одного вида упаковки.

	Так, например, пачки сигарет упаковываются в блоки, а блоки - в коробки. Вы должны
	определиться, какой вид упаковки собираетесь использовать для учета.
	Как правило, емкость упаковки используют оптовые торговые предприятия. В розничной торговле
	поле емкости упаковки обычно опускают, хотя в некоторых случаях этот параметр и в розничной
	торговле мог бы применяться с большой пользой.

	Важно отметить, что емкость упаковки привязывается к лоту, а не товару. Это значит, что
	товар может приходить в упаковках разной емкости, и система аккуратно это учтет.
	Если раньше товар, который вы сейчас приходуете, уже приходил, то система автоматически
	заполнит поле емкости упаковки тем значением, которое было в последнем приходе. Вы в
	праве изменить это значение.

	\item[Количество упаковок]
	В этом поле можно ввести количество поступивших упаковок товара. Если емкость упаковки
	не задана, то, естественно, нет никакого смысла заполнять это поле.
	После ввода значения, перейдите на следующее поле, и система автоматически рассчитает и
	заполнит поле \qu{Всего единиц}.

	\item[Всего единиц]
	Здесь следует ввести количество единиц поступившего товара (если оно не было рассчитано
	в соответствии с емкостью и количеством упаковок). Как правило, если количество единиц
	равно нулю, программа не позволяет ввести такую строку в документ.
	Снизу от поля количества высвечивается количество физических единиц товара, соответствующих
	введенному количеству торговых единиц (при условии, что для товара задано соотношение
	Физические единицы/Торговые единицы).

	Если вы работаете с физическими единицами, то, вероятно, вам будет полезен следующий
	трюк: в поле \qu{Всего единиц} можно ввести непосредственно количество физических единиц
	товара, а затем нажать клавишу \keyb{F4} - по этой команде система пересчитает введенные
	физические единицы в торговые.

	\ppyexampletitle{Пример}{
		вы получили от поставщика 1500 кг сахарного песка в пачках по 0.800 кг
		(этот факт отражен в записи товара так: торговые единицы - пачка,
		физические единицы - кг, соотношение физические единицы / торговые единицы - 0.800).
		Введите в поле \qu{Всего единиц} 1500 и нажмите \keyb{F4} - в поле \qu{Всего единиц}
		отобразится значение 1875, а справа от него появится число 1500.
	}

	\item[Валютная цена поступления]
	В том случае, если вы установили валюту в заголовке документа, в этом поле следует ввести
	цену поступления единицы товара в выбранной валюте. При этом система пересчитает введенное
	значение на основе заданного в заголовке документа валютного курса, в цену, выраженную в
	базовой валюте, и поместит эту величину в поле \qu{Базовая цена поступления}. При этом само
	поле базовой цены закрыто для изменения.

	\item[Базовая цена поступления]
	Если документ не валютный (как обычно и бывает), то в этом поле вводится цена поступления
	единицы товара. Обратите внимание, что обычно здесь вводится значение цены, включающее
	акцизы и НДС. Это правило можно переопределить, если установить флаг \dlgflag{Без НДС}. В этом
	случае вводится цена за вычетом НДС.

	Вы можете ввести в этом поле сумму, включающую стоимость всего количества поступившего
	товара, а затем нажать F6: система поделит введенную сумму на значение в поле \qu{Всего единиц}
	и установит результат в поле цены. Будьте осторожны с этой опцией: сколько раз вы нажмете
	\keyb{F6}, столько раз система поделит содержимое на количество.

	\item[\dlgflag{Без НДС}]
	Установка этого флага означает, что в поле цены поступления задана цена, не включающая
	налог на добавленную стоимость товара. Система будет учитывать этот признак при расчете
	налогообложения операций с этим лотом, а так же при печати отчетов и документов.

	\item[Базовая котировка]
	Справочное поле, отображающее текущее значение базовой котировки товара
	для склада, к которому относится документ.

	\item[Цена реализации]
	В этом поле необходимо ввести учетную цену поступления одной торговой единицы товара.
	Как правило, это цена, по которой вы собираетесь продавать поступивший товар. Для
	предприятия, занимающегося оптовой торговлей - это наиболее типичная цена продажи товара,
	используемая в подавляющем большинстве операций. Если вы хотите иметь на один товар более
	одной цены (зависящие от способа оплаты, склада и т.д.), то вы сможете для этого использовать
	товарные котировки.
	В редких случаях может использоваться опция конфигурации, предусматривающая ввод цен
	реализации без всех налогов. В таком случае справа от поля цены реализации будет стоять
	символ '-' (тире). При этом вы должны ввести цену реализации без всех налогов (налога
	с продаж, НДС, акциза).

	\item[Налоговая группа]
	В этом поле можно выбрать входящую налоговую группу на лот (не на товар). Более подробно
	входящие налоговые группы были рассмотрены в разделе \qu{Особенности товарного учета в
	системе \ppybrand{}}.

	Обратите внимание на наименование налоговой группы, которой принадлежит товар, указанное
	выше этого поля. Как правило, если налоговая группа, которой соответствует значение НДС,
	указанное в счете-фактуре поставщика, не отличается от налоговой группы товара, то в этом
	поле ничего указывать не следует.

	\item[Годен до]
	Срок годности товара, поступившего вводимым лотом.

	\item[Сертификат]
	Сертификат качества, привязываемый к лоту. Работа с сертификатами качества будет описана
	ниже.

	\item[Грузовая таможенная декларация]
	Номер грузовой таможенной декларации (ГТД), по которой товар был импортирован в страну.
	Для товаров, произведенных на внутреннем рынке, это поле не заполняется. Нет необходимости
	заполнять это поле и в том случае, если товар не предназначен для перепродажи, сопровождаемой
	выпиской счетов-фактур.

	\item[Серийный номер]
	Серийный номер, идентифицирующий лот, который будет создан в соответствии с
	данной строкой документа.

	\item[\dlgbutton{Партия\dots}]
	Нажав на эту кнопку, вы можете увидеть список открытых лотов по выбранному товару. Это
	бывает полезно для справки о предыдущих ценах и движении товара, поступившего ранее.

	\item[\dlgbutton{Котировки\dots}]
	По этой кнопке становится доступен диалог редактирования товарных котировок - то есть
	дополнительных цен на этот товар, установленных для различных условий продажи и передачи.

	\item[\dlgbutton{Теги\dots}]
\end{description}

\paragraph{Расчет цены поступления или цены реализации строки по сумме}

Если вы знаете сумму, на которую поступил товар, но не знаете точно цену одной единицы, то
система поможет вам рассчитать цену исходя из суммы и количества. Для этого заполните поле
количества \qu{Всего единиц}, а в поле цены поступления (реализации) введите сумму. Затем
нажмите клавишу \keyb{F6}.
Система разделит введенную вами сумму на количество и занесет результат в поле цены.

\ppynote{
	Будьте внимательны! Если вы дважды нажмете \keyb{F6} в этом поле, то система
	дважды и разделит его значение на количество.
}

\paragraph{Расчет цены поступления или цены реализации по физическому количеству товара}

Если вы знаете цену на физическую единицу товара, то система может рассчитать соответствующую
ей цену одно торговой единицы. Для этого введите в поле цены поступления (реализации) цену
одной физической единицы товара и нажмите клавишу \keyb{F4}. Если для товара указано
соотношение физических единиц к торговым, то система умножит введенную вами величину на это
соотношение и занесет результат вместо нее.

\ppynote{
	Будьте внимательны! Если вы дважды нажмете \keyb{F4} в этом поле, то система дважды и
	умножит его значение на соотношение.
}

\ppypict{dlg-031}{Вычисление цены реализации}

\paragraph{Расчет цены реализации на основе цены поступления в диалоге строки товарного
документа}

Для расчета цены реализации при вводе строки товарного документа используется
специализированный диалог, вызываемый нажатием клавиши \keyb{F2} в поле \qu{Базовая цена
поступления} либо \qu{Цена реализации}. Внешний вид диалога показан на рисунке.
Непосредственно из диалога строки товарного документа система извлекает информацию о
товаре, налоговых параметрах прихода и товара, цены поступления, признак
\dlgflag{Цена поступления без НДС}.

Вам следует в поле \qu{Процент наценки} ввести процентную величину наценки на товар и нажать
\keyb{Enter} или перейти на другое поле. При этом в поле \qu{Цена реализации} высветится рассчитанное
значение цены товара. При следующем нажатии \keyb{Enter} или кнопки \dlgbutton{OK} диалог закроется, и
рассчитанная цена товара попадет в поле \qu{Цена реализации} диалога строки товарного документа.
Диалог вычисления цены реализации предоставляет несколько расширенных опций просмотра информации
о цене и ее расчета.

Поля \qu{Акциз} и \qu{НДС} показывают соответственно сумму акциза и сумму НДС, совместно с
величиной ставки НДС, которой облагается товар.

В группе управляющих элементов \qu{Округление} можно задать параметры округления вычисленной
цены. В поле ввода следует указать кратность округления.

\ppyexample{
	\begin{description}
		\item[0.01] округление до второго знака после запятой,
		\item[0.1] округление до первого знака после запятой,
		\item[0.05] округление до пяти сотых единиц основной валюты (в России - до 5 копеек).
	\end{description}
}

Установив флажок \dlgflag{По НДС}, вы заставите калькулятор выбрать такую цену, которая даст
безостаточное вычисление суммы НДС и цены без НДС. В этом случае поле кратности округления
не используется.

Переключатель направления округления позволяет выбрать в какую сторону должна смещаться
округленная цена от точно рассчитанной. Наиболее популярный вариант - до ближайшего
значения. В этом случае будет выбрано то значение, которое наиболее точно соответствует
введенному вами проценту наценки.

Выбранные вами значения процента наценки и округления сохраняются системой, благодаря
чему, при следующем вызове калькулятора, эти значения не надо будет вводить, и выбирать
заново.

\ppyadmin{
	Процент наценки и параметры округления сохраняются в ветке реестра HKEY\_CURRENT\_USER.
	То есть они распространяются только на данный компьютер и данного пользователя сети
	(не \ppybrand{}'а).
}

\paragraph{Алгоритм расчета цены реализации}

Для того, чтобы было понятно, как в точности работает калькулятор цены, приведем детальное
описание алгоритма расчета цены реализации по цене поступления товара и проценту наценки.
В калькуляторе используется только заголовочная схема налоговой группы (то есть, расширенные
схемы не используются). Подробнее о налоговых группах см. стр.~\pageref{sec-goodstaxgroup}.

\begin{enumerate}
	\item Если цена поступления задана без НДС (справа от поля \qu{Цена поступления}
	в этом случае появляется соответствующий текст), к величине этой цены
	прибавляется сумма НДС. Эта сумма рассчитывается исходя из приходной налоговой группы,
	указанной в диалоге строки приходного документа. Если приходная налоговая группа явно
	не указана, то используется налоговая группа, к которой относится товар.
	\item Вычисляется сумма акциза, которой облагается продажа товара.
	\item К цене поступления с НДС прибавляется сумма акциза
	\item Вычисляется предварительное значение цены реализации по формуле:

		$Price = CostWithVatAndExcise * (1 + VA / 100)$,

		где:
		\begin{description}
			\item[Price] - цена реализации
			\item[CostWithVatAndExcise] - цена поступления с НДС и налогом с продаж
			\item[VA] - процент наценки
		\end{description}
	\item Полученный результат округляется в соответствии с заданными параметрами.
	Правило округления при выборе выравнивания по НДС следующее:
	\begin{itemize}
		\item ставка НДС (в процентах) раскладывается на простые множители;
		\item сумма (ставка НДС в процентах плюс 100) также раскладывается на простые множители;
		\item общие для двух приведенных значений простые множители сокращаются
		\item оставшиеся простые множители для второго значения перемножаются.
		Результат, деленный на 100, является минимальным значением, на которое
		должна делиться цена реализации.
	\end{itemize}
	\item По полученному предыдущими шагами значению цены реализации
	вычисляются величины акциза и НДС для показа в соответствующих полях диалога
	\item Если установлен признак \dlgflag{Исключить налоги из цены}, то из
	значения цены вычитаются величины акциза и НДС.
\end{enumerate}

\subsection{Особенности изменения документа прихода товара}

При изменении документа прихода следует учитывать то, что вводимые изменения могут иметь
значительные последствия, и, кроме того, могут потребовать видимых затрат времени работы
компьютера. Более того, некоторые изменения таких документов просто невозможны. Все это
связано с тем, что для сохранения целостности учета, изменения приходного документа влекут
за собой изменения в документах, оперирующих товарами, поступивших по этому документу.

Так,при изменении цены поступления в одной строке приходного документа, автоматически
пересчитываются все документы продажи, использовавшие лот, соответствующий этой строке.

Если вы меняете сертификат в какой-либо строке приходного документа, то имейте в виду, что
это повлечет за собой изменение сертификатов по всем продажам, использующим изменяемый лот.

При изменении количества поступившего товара система проследит за тем, чтобы ни одна
последующая операция по измененному лоту не повлекла за собой переход остатка за нулевую
отметку, и, если это так, то запретит такое изменение.

Сменив в какой-нибудь строке документа прихода товар, вы измените его во всех документах
расхода, использующего модифицированный лот.

Изменение даты приходного документа проверяется системой так, чтобы ни одна из зависимых
операций не предшествовала бы приходу.

Например, если документ прихода датирован 31 января 2002 года, а первая зависимая операция по
нему совершена 5 февраля 2002 года, то изменение даты приходного документа допустимо
до 4 февраля 2002 года.

\subsection{Расценка приходного документа}

Для того, чтобы продажа и другие виды списания товаров осуществлялись по правильным ценам,
необходимо правильно расставить учетные цены реализации в документе прихода.
Процесс назначения таких цен в документе прихода товара мы будем называть расценкой.
Система предоставляет несколько различных вариантов расценки:
\begin{description}
	\item[Самый простой - ввод учетной цены реализации вручную] Собственно, это и расценкой
	назвать сложно, тем не менее отметим этот вариант.

	\item[Установка цены реализации в полуавтоматическом режиме] Этот способ аналогичен
	предыдущему с той лишь разницей, что система оказывает помощь пользователю посредством
	функции расчета цены реализации на основе цены поступления, описанной чуть выше (в описании
	диалога строки приходного документа).

	\item[Ручная расценка по котировке] Это - более развитая функция, позволяющая сразу расценить
	весь приходный документ, используя специализированные котировки, значения которых
	предварительно установлены менеджером, ответственным за реализацию ценовой политики
	предприятия.

	\item[Автоматическая расценка по котировке] То же, что и предыдущий вариант,
	но в отличие от него пользователю, который вводит документ, не приходится ничего делать - система
	автоматически устанавливает цены реализации в каждой вводимой строке приходного
	документа на основе предварительно заданных правил.
\end{description}

\subsubsection{Настройка расценки по котировке}

Для того, чтобы система могла осуществить расценку документа по котировке,
необходимо:

\begin{itemize}
	\item Создать вид котировки расценки документа.

	\item Определить этот вид котировки в конфигурации документов,
	как расценочную и, возможно, задать другие параметры расценки
	(см. стр.~\pageref{loc-bill-cfg-pricing}).

	\item Организовать администрирование значений расценочной
	котировки по товарам и складам.

	Наиболее простой способ установки расценочных котировок это -
	относительные к цене поступления значения по обыкновенным группам товаров
	для всех складов. Фактически, это - назначение традиционных коэффициентов
	наценки.

	Более сложные варианты подразумевают использование и абсолютных,
	и относительных значений с детализацией по товарам и отдельным складам
	или же группам складов.
\end{itemize}

\subsubsection{Использование расценки по котировке}

Для ручной расценки приходного документа по котировке, необходимо в
таблице строк документа выбрать команду \qu{Автоматическое назначение цен реализации}
или нажать \keyb{Ctrl-B} (стр.~\pageref{loc-bitmbrow-valuation}).

Если в конфигурации у пользователя установлен флаг \qu{Автокотировка}, то
расценка будет применяться автоматически при вводе или изменении любой строки
приходного документа.

\subsection{Распределение дополнительных затрат}

Система \ppybrand{} позволяет распределять общие суммы приходного документа
на себестоимость его товарных позиций.

Общий принцип работы распределения таков: если приходный документ содержит
суммы, относящиеся к типам, допускающим распределение себестоимости,
то значения этих сумм распределяются по ценам поступления строк документа.
При этом пропорции, в которых распределяются суммы, а так же знак
распределения (увеличение или уменьшение себестоимости) определяются опциями
каждого типа суммы документа.

Детально типы сумм документов рассмотрены в соответствующем разделе (стр.~\pageref{sec-amounttype}).

\subsubsection{Примеры использования распределения затрат}

Мы перечислим примеры, когда описываемый механизм может быть полезен
для учета на вашем предприятии:

\begin{itemize}
	\item Распределение транспортных расходов на себестоимость закупленных товаров.
	\item Учет бонусов от поставщика в себестоимости товаров, поступивших от него (отрицательное распределение).
	\item Включение стоимости специальных товарных позиций в себестоимость
	остальных строк приходного документа (в этом случае такие позиции должны
	относится к специализированному типу товаров, формирующему распределяемую
	сумму).
\end{itemize}

\subsubsection{Обратимость распределения дополнительных затрат}

Рассматриваемый механизм распределения затрат является обратимым. То есть,
система \qu{помнит} изначальную цену поступления каждой позиции документа,
которая была до распределения и, таким образом, при изменении (в том числе, обнулении)
распределяемой суммы происходит адекватное изменение цен поступления каждой
строки документа.

\subsubsection{Отображение распределенных затрат в таблице строк документа}

В таблице строк приходного документа, если к нему было применено распределение
сумм на себестоимость, отображается дополнительная колонка справа от
цены поступления, отображающая значение увеличения себестоимости (отрицательное
значение уменьшает себестоимость).

В то же время, открывая диалог редактирования строки приходного документа,
на которую пришлось распределение себестоимости, вы увидите в поле
\qu{Цена поступления} значение, не включающее это распределение. Сделано
это для того, чтобы редактировать изначальную цену поступления можно
было без оглядки на механизм распределение затрат.

\subsubsection{Дополнительные аспекты учета}

Важно заметить, что распределенная себестоимость влияет на сумму документа
в ценах поступления и, следовательно, может влиять на номинальную сумму.
Это - очень важно с точки зрения учета взаиморасчетов с поставщиком.
Если вы используете распределение себестоимости, то, возможно, придется %
определить формулу расчета номинальной суммы для вида операции так, чтобы
номинальная сумма правильно отражала величину вашего долга перед поставщиком.

\subsubsection{Системная блокировка функции распределения дополнительных затрат}

Так как функция распределения затрат по документу сравнительно новая, во избежании
ошибок и неправильного применения этого механизма, система предусматривает
метод защиты от его использования.

Для включения функции необходимо установить флаг \dlgflag{Использовать распределение себестоимости}
в системных параметрах общих настроек (стр.~\pageref{sec-commcfg-sys}).

\section{Документы расхода}

Документы расхода товаров принадлежат к типу операций \ppyrsrv{Расход товара}.
Данная категория документов обеспечивает следующие бизнес-процессы предприятия:

\begin{itemize}
	\item Продажа покупателю.
	\item Розничная продажа (продажа не именованным покупателям).
	\item Формирование товарных недостач при проведении инвентаризации.
	\item Несвязанный возврат товара поставщику.
	\item Внутренняя передача товаром со склада на склад.
\end{itemize}

Как явствует из названия, документы расхода используются для учета
расхода товаров со складов с той или иной целью (чаще всего, для получения прибыли
от продажи товаров).

\subsection{Внутренняя передача товаров}

Специальная подвид документов расхода реализует сложный механизм перемещения товаров с одного
склада на другой. Фактически такие документы осуществляют сдвоенную операцию для каждой строки: с
одной стороны, расходуют товар со склада-отправителя, с другой, приходуют то же количество на складе-получателе.

Система идентифицирует вид операции как внутреннюю передачу если он принадлежит типу \ppyrsrv{Расход товара}
и имеет таблицу аналитических статей, определенную как \ppyrsrv{Таблица складов} в конфигурации.

Складом-отправителем в документе внутренней передачи является склад, которому принадлежит документ, склад же,
связанный со статьей-контрагентом документа, является складом-получателем.

При перемещении лимитированного товара на складе-получателе формируется новый лот, связанный с лотом-источником
на складе-отправителе.

\subsubsection{Особенности передачи тегов лота при внутренней передачи товаров}
При внутреннем перемещении товара теги лота-источника переносятся на лот-получатель. Здесь есть несколько
особенностей:
\begin{itemize}
	\item После передачи порожденный лот на склада-получателе сам отвечает за те теги, которые он
	получил. Это значит, что изменение документа внутренней передачи не повлечет изменение тегов порожденных лотов.
	В равной степени, удаление тегов с оригинального лота не влечет за собой удаление тегов порожденного
	лота.
	\item Ряд типов зарезервированных тегов не передаются на склад-получатель.
	Это:
	\begin{enumerate}
		\item \ppyrsrv{ФСРАР код справки А}
		\item \ppyrsrv{ФСРАР код справки Б}.
		\item \ppyrsrv{ВЕТИС UUID лота}.
	\end{enumerate}

	Связано это со специальной логикой обработки внутренней передачи в контексте
	обмена данными с Российскими системами ЕГАИС и ВЕТИС (Меркурий).

	Из этого правила есть одно исключение: если в примечании к документу содержится подстрока \ppyrsrv{\#MIRROR-REFAB},
	то правило не срабатывает (в некоторых случаях необходимо перенести соответствующие значения на
	склад-получатель и эта \qu{секретная} опция позволяет решить такую проблему).
\end{itemize}

\subsection{Редактирование документов расхода}

В этом подразделе мы рассмотрим ввод документа продажи товара. Объяснение будет вестись на
примере так называемого, именованного документа отгрузки, то есть, отгрузки конкретному
покупателю, в противоположность анонимному документу, например розничной продаже. Анонимный
документ, на самом деле, проще, поскольку исключает такие элементы, как ввод контрагента и
срока оплаты.

\ppypict{dlg-b-sell}{Диалог \qu{шапки} документа расхода}

Примерный вид диалога редактирования \qu{шапки} расходного документа приведен
на рис.~\ref{pic-dlg-b-sell}.

Несмотря на ряд  отличий от прихода товара, элементы документа продажи в основном те же.
Поэтому, мы не будем повторяться, а оговорим лишь отличительные черты.

В правой части диалога находятся окно отображения статуса документа и окно, в котором может
быть показан номер персональной карты, с которой связан документ.

\subsubsection{Скидка по документу}

Если признак \dlgflag{На всю партию} не установлен, то поле скидки закрыто для изменения - здесь
отображается общая сумма скидки, отличающая реальную сумму продажи от суммы учетных цен
реализации строк документа.

Если же вы хотите дать клиенту скидку на весь документ, то сначала следует установить
признак \dlgflag{На всю партию} а затем указать значение скидки.
Скидка может быть задана либо в абсолютном выражении, либо в процентах. Если вы даете
клиенту общую скидку, скажем, 100 рублей, то просто введите в поле скидки это значение
(наценка указывается со знаком минус: -40). Для установки процентной скидки введите в этом
поле величину в процентах, а после нее введите знак \% или /.
Если вводимый документ должен облагаться налогом с продаж, то после общей скидки (если она
есть) следует поставить букву А (допускаются русские А, а и латинские A, a).

\ppynote{
	В действительности, установка признака А в поле скидки не обязательно означает  добавление
	к сумме документа налога с 	продаж. Этот так, если в настройках установлен признак
	\dlgflag{Цены заданы без налога с продаж}. Если же этот признак не установлен,
	то налог с продаж, наоборот, снимается с суммы документа. Кроме того, если в настройке
	установлен признак \dlgflag{Переключать налог с продаж не меняя цену}, то сумма документа
	вообще не будет изменяться, но в нем будет устанавливаться признак переключения налога с
	продаж, что повлечет соответствующие поправки в расчетах отчетов и форм.
}

\ppyexampletitle{Примеры указания скидок}{
	\begin{description}
		\item[100] Скидка на весь документ 100 рублей
		\item[-50] Наценка на весь документ 50 рублей
		\item[5\%] Скидка на весь документ 5\%
		\item[-3/] Наценка на весь документ 3\%
		\item[А] Документ облагается налогом с продаж (с документа снимается налог с продаж)
		\item[5\%А] Скидка на весь документ 5\% после чего документ
		облагается налогом с продаж (с документа снимается налог с продаж)
	\end{description}
}

\subsubsection{Диалог строки документа расхода товара}

\ppypict{dlg-ti-sell}{Диалог строки расходного товарного документа}

Внешний вид диалога показан на рис.~\ref{pic-dlg-ti-sell}. Ниже следует
описание управляющих элементов этого диалога, после чего мы
опишем существенные аспекты редактирования строки расходного документа.

\begin{description}
	\item[\dlgcombo{Группа}]
	Группа (обыкновенная) которой принадлежит выбранный товар.

	\item[\dlgcombo{Товар}]
	Сокращенное наименование товара, поступающего от поставщика.

	\item[Емкость упаковки]
	Количество единиц товара, содержащегося в одной упаковке.
	В расходном документе это поле не редактируемое. Значение,
	отображаемое здесь система извлекает из лота, к которому привязана
	данная строка.

	\item[Количество упаковок]
	В этом поле можно ввести количество поступивших упаковок товара. Если емкость упаковки
	не задана, то, естественно, нет никакого смысла заполнять это поле.
	После ввода значения, перейдите на следующее поле, и система автоматически рассчитает и
	заполнит поле \qu{Всего единиц}.

	\item[Всего единиц]
	Здесь следует ввести количество расходуемых единиц товара (если она не было рассчитано
	в соответствии с емкостью и количеством упаковок). Как правило, если количество единиц
	равно нулю, программа не позволяет ввести такую строку в документ.

	Если вы работаете с физическими единицами, то, вероятно, вам будет полезен следующий
	трюк: в поле \qu{Всего единиц} можно ввести непосредственно количество физических единиц
	товара, а затем нажать клавишу \keyb{F4} - по этой команде система пересчитает введенные
	физические единицы в торговые.

	Программа не позволяет израсходовать количество большее, чем есть на остатке
	по лоту, к которому привязана строка. В то же время, если вы укажете здесь
	величину, которая меньше или равна доступному остатку по всем лотам данного
	товара, то проведение такой строки возможно: после подтверждения ввода у
	пользователя будет запрошена необходимость использования других лотов и,
	если он ответит утвердительно, то в документ попадут несколько строк
	с одним и тем же товаром, суммарное количество в которых будет равно тому,
	что указано в данном поле.

	\item[Количество в физических единицах]
	В наиболее распространенном случае ниже поля \qu{Всего единиц}
	приводится справочное количество физических единиц товара,
	соответствующее торговым единицам, умноженным на соотношение
	заданное для товара.

	Если же товар содержит признак \dlgflag{Независимый учет в физических}
	единицах, то здесь появляется поле ввода, в котором необходимо указать
	количество расходуемых физических единиц.

	\item[Валютная цена реализации]
	В том случае, если вы установили валюту в заголовке документа, в этом поле следует ввести
	цену продажи единицы товара в выбранной валюте. При этом система пересчитает введенное
	значение на основе заданного в заголовке документа валютного курса, в цену, выраженную в
	базовой валюте, и поместит эту величину в поле \qu{Базовая цена реализации}. При этом само
	поле базовой цены закрыто для изменения.

	\item[Базовая цена реализации]

	\item[Скидка]

	\item[Наценка]
	Справочное поле, в котором показана процентная величина наценки
	в данной строке.

	Если пользователь не имеет доступа к ценам реализации, то
	это поле не выводится.

	\item[НДС]
	Справочно отображает суммы НДС, которым облагается данная строка.

	\item[Остаток]
	Отображает состояние товарного остатка, доступного для расхода
	этим документом (с учетом его даты).
	Подробно этот индикатор рассмотрен ниже.

	\item[Срок годности]
	Справочно отображает дату истечения срока годности, взятую из лота,
	к которому привязана данная строка.

	\item[Серийный номер]

	\item[\dlgbutton{Партия}]
	Кнопка, позволяющая увидеть и, если требуется, выбрать лот товара.

	\item[\dlgbutton{Сертификат}]
	Кнопка, нажатие на которую откроет диалог просмотра (редактирования)
	сертификата, соответствующего лота, к которому привязана данная строка
	документа.

	Подробно сертификаты разобраны в специальном разделе (стр.~\pageref{sec-qcert}).

	\item[\dlgbutton{Котировки}]
	Открывает диалог просмотра и редактирования котировок по товару,
	с которым связана строка.

	Этот диалог рассмотрен на стр.~\pageref{sec-dlg-quot}.
\end{description}

При вводе и редактировании строки документа продажи товара действуют практически те же
правила, что и в случае документа товарного прихода. Все немногочисленные различия связаны
с тем, что товар расходуется, а не приходуется. При расходовании товара уже нет надобности
указывать цену поступления, емкость упаковки, номер ГТД и сертификат. Все эти параметры
наследуются из лота, из которого товар расходуется.

При выборе товара система автоматически выбирает лот, из которого будет израсходована
партия отгружаемого товара, руководствуясь правилом LIFO (последний пришел - первым израсходован)
или FIFO (первым пришел - первым израсходован) в зависимости от настройки соответствующего параметра
конфигурации. Вы можете самостоятельно выбрать используемый лот, нажав кнопку \dlgbutton{Партия\dots}.

\ppypict{dlg-b-gexpend-restindicator}{}

Как уже упоминалось, система следит за тем, чтобы остаток товара ни по одному лоту
не становился меньше нуля. В нижней части диалога строки расходного документа отображается
доступный остаток на дату, которой соответствует вводимый или редактируемый документ. Общий
вид этого индикатора таков, как показано на рисунке справа. Здесь число перед скобками
показывает доступный остаток по выбранному лоту, остаток в скобках - общий доступный остаток
выбранного товара (если кроме выбранного лота есть и другие). После слова \qu{заказ} следует
количество товара, на которое есть незакрытые заказы от покупателей. Нажав кнопку
\dlgbutton{Заказы\dots} вы сможете увидеть лоты заказов, из которых сложилось заказанное
количество товара.

\subsection{Ввод и редактирование информации о фрахте документа\label{sec-billfreight}}

С документом (чаще всего, с расходным, но возможно и для иных категорий) может быть связана информация о фрахте.

Возможность ввода данных о фрахте определяется флагом \dlgflag{Ввод информации по фрахту}
в записи вида операции, к которой относится документ (см. стр.~\pageref{sec-oprkind}).

\ppypict{dlg-freight}{Диалог редактирования параметров фрахта документа}

Если в документе допускается ввод информации по фрахту, то заголовочный
диалог документа содержит незаблокированную кнопку \dlgbutton{Фрахт}. При нажатии на
нее появляется диалог, показанный на рис.~\ref{pic-dlg-freight}.

\begin{description}
	\item[\dlgradioc{Вид транспортного средства}]
	Здесь возможен один из двух вариантов:
	\dlgradioi{Автомобиль} или \dlgradioi{Торговое судно}.

	В новой записи фрахта по умолчанию устанавливается \dlgradioi{Автомобиль}.

	\item[Номер фрахта]
	Здесь следует (при необходимости) ввести номер документа фрахта.

	\item[\dlgcombo{Транспортное средство}]
	Комбо-бокс позволяет выбрать транспортное средство из справочника.

	Справочник транспортных средств администрируется через команду
	\ppymenu{Справочники\rdir Отраслевые справочники\rdir Транспорт}.

	\item[\dlgcombo{Капитан (водитель)}]
	В этом комбо-боксе может быть выбран водитель автомобиля или
	капитан судна.

	При выборе транспортного средства, если за ним закреплен
	водитель (капитан), то он автоматически проставляется здесь (что
	не исключает возможности выбрать иную персоналию).

	Список комбо-бокса заполняется персоналиями, относящимися к
	зарезервированному виду \ppyrsrv{Капитаны (водители)} (ИД=15).

	\item[\dlgcombo{Транспортный брокер}]
	Если договор фрахта заключается через посредника, то он может быть выбран в этом комбо-боксе.

	Список комбо-бокса заполняется персоналиями, относящимися к зарезервированному виду
	\ppyrsrv{Транспортные брокеры} (ИД=14).

	\item[\dlgcombo{Пункт погрузки}]
	Здесь может быть выбран населенный пункт, в котором должна быть осуществлена погрузка груза на транспорт.

	\item[Дата отправления]
	Поле, в котором может быть указана дата отправления транспорта
	с грузом.

	\item[\dlgcombo{Пункт разгрузки}]
	В этом комбо-боксе может быть выбран населенный пункт, в
	котором должна быть осуществлена разгрузка груза с транспорта.

	\item[Дата прибытия]
	Поле, в котором может быть указана планируемая дата доставки груза
	транспортом в пункт разгрузки.

	\item[\dlgcombo{Адрес доставки}]
	Комбо-бокс, в котором может быть выбран адрес доставки груза.

	Адрес выбирается из списка адресов доставки персоналии, связанной
	со статьей контрагента по документу.

	Кнопка \dlgbutton{*} справа от комбо-бокса позволяет редактировать
	список адресов доставки контрагента.

	\ppynote{
		Для операций, относящихся к типу \ppyrsrv{Драфт-приход}
		адрес доставки выбирается из списка складов.

		Связано это с тем, что операции такого типа часто
		используются для размещения вашего собственного заказа товара
		у поставщика. В этом случае, если склад, на который должен
		поступить груз отличается от склада, к которому относится документ,
		можно в адресе доставки выбрать тот склад, на который поставщику
		следует осуществить доставку.
	}

	\item[\dlgflag{Отгружен}]
	Флаг, который включается после того, как товар по накладной отгружен.
	Чаще всего используется для администрировании фрахтов из одноименной отчетной
	таблицы (см. стр.~\pageref{sec-rep-freight}).

	\item[Число оригиналов коносаментов]
	Это поле применяется для подготовки пакета документов на отгрузку
	транспортным судном и используется только для печати первичных документов.

	\item[Стоимость фрахта]
	Сумма транспортировки. Если она установлена, то дублируется в списке
	сумм документа с зарезервированным типом \ppyrsrv{Фрахт} (ИД=23).
\end{description}

\section{Документы модификации}

Документы модификации товаров принадлежат к типу операций \ppyrsrv{Модификация товара}. В базе
данных может быть сколько угодно видов операций, относящихся к этому типу.

Документы модификации являются учетными. То есть, они изменяют товарные остатки и, при
соответствующих настройках, состояние бухгалтерского баланса предприятия.

Главной характеристической особенностью документа модификации является то, что в нем
одновременно содержатся строки расхода и строки прихода товаров. Собственно, это и
определяет область применения таких документов: учет производства, учет пересортицы, учет
перехода товаров из одной категории в другую (для примера, в розничной торговле, переход
высокосортных фруктов в низкосортные из-за длительного хранения).

Отдельно, следует обратить внимание на специфическое использование модификации, именуемое
\ppyterm{рекомплектация}. При рекомплектации, один или несколько компонентов товара заменяются
другим (другими). Такая операция используется в производстве и торговле сложными
устройствами, а также исключительно важна в учете основных средств.

\subsection{Автоматизация формирования документов модификации}

Во многих случаях документы модификации формируются либо автоматически (на основании
кассовых или технологических сессий, драфт-документов и т.д.), либо полуавтоматически
(на основании одной введенной позиции и ее структуры остальные позиции вставляются системой).

\subsection{Формирование цен в документах модификации}

Из-за особенностей документов модификации, цены и суммы этих документов имеют своеобразные
правила формирования.

\paragraph{Цены поступления}
Для расходных позиций цены поступления берутся из лотов, которые расходуются этой операцией.
Для приходных позиций цены поступления рассчитываются исходя из требования балансировки
себестоимости расхода с себестоимостью прихода. В самом простом случае, когда в документе
есть только одна приходная позиция, ее цена поступления рассчитывается как суммы цен
реализации расходных позиций, помноженных на соответствующие количества и деленные на
количество производимого компонента.

$$
	C^{+}=\frac{\sum (C^{-}_{i}*Q^{-}_{i})}{Q^{+}}
$$

где:
\begin{description}
	\item[$C^{+}$] цена поступления производимого компонента
	\item[$Q^{+}$] количество производимого компонента
	\item[$C^{-}$] цена поступления $i$-го расходуемого компонента
	\item[$Q^{-}$] количество $i$-го расходуемого компонента.
\end{description}

В случае, если приходных позиций более одной, ситуация несколько усложняется. В этом случае
общая сумма себестоимости документа (расходных позиций) должна быть распределена между
производимыми компонентами в какой-либо \qu{справедливой} пропорции.

Система поступает следующим образом: распределяет общую себестоимость между производимыми
компонентами пропорционально учетным ценам реализации этих компонентов. Как следствие, цена
поступления компонента с неопределенной ценой реализации будет равна нулю, и, соответственно,
чем выше учетная цена реализации производимого компонента, тем большая часть общей
себестоимости по документу придется на этот компонент.

\paragraph{Цены реализации}
При вводе строки вручную, цена реализации формируется следующим образом:
\begin{itemize}
	\item 	Для расходной строки - наследуется учетная цена реализации лота, к которому
	привязывается эта строка. Если расходуемый товар является нелимитируемым, то применяется
	базовая котировка, заданная для этого товара.
	\item 	Для приходной строки - извлекается учетная цена реализации последнего (на дату
	документа) лота. Если поступающий товар нелимитируемый, то применяется базовая котировка,
	заданная для этого товара.
	В приходной строке пользователь может вручную изменить цену реализации.
	Специальная опция в конфигурации документов (При комплектации ЦР на исходящие позиции -
	по базовой котировке) заставляет систему при формировании цены реализации на приходные
	строки искать базовую котировку, соответствующую либо складу, к которому относится документ,
	либо всем складам. Если такая котировка найдена, то она принимается за цену реализации, в
	противном случае включается основное правило, описанное выше.
\end{itemize}

Для строк, формируемых автоматически (например, на основании структуры товара, которому
соответствует введенная перед этим строка), правила аналогичные.
\ppynote{
	Если система не смогла найти ни одного предшествующего лота для товара, приходная
	строка по которому генерируется автоматически, то цена реализации в этой строке будет
	равна нулю и пользователь должен самостоятельно установить правильное значение.
}

\subsubsection{Рекомплектация}

Рекомплектация является специализированной формой модификации, при которой некоторый лот
изменяет свой состав. То есть, если до рекомплектации лот A состоял из компонентов C и D,
то после рекомплектации он будет состоять из компонентов D и E. Кроме того, рекомплектация
(начиная с версии системы 5.5.5) допускается для лотов, которые не были скомплектованы до
этого.

Фактически, рекомплектация, представляет из себя довольно сложную комбинацию товарной
модификации и переоценки. То есть, после рекомплектации количество лота не меняется,
но могут измениться учетные цены.

Область применения рекомплектации - производство сложных изделий, учет прироста поголовья
в сельском хозяйстве и учет основных средств.

При использовании рекомплектации в учете прироста поголовья в животноводстве и рыбном
хозяйстве, рекомплектация меняет независимое количество физических единиц, соответствующих
тому же количеству лота (количество голов не меняется, но увеличивается вес).

\subsection{Ограничения комплементарности товаров в документе}

\ppypict{dlg-oprkind-w-opt}{Опции редактирования вида операции}
В опциях диалога редактирования вида операции "`Модификация товара"' для документа модификации можно ограничить выбираемые товары и их  количество, используя следующие позиции:
	\subsubsection{Принадлежность общей обыкновенной группе}
			Все выбранные товары должны быть из одной группы. Напрмер, "`Сок вишневый"' и "`Сок яблочный"' принадлежат одной группе "`Сок"', и, соответсвенно, могут быть выбраны на вход и выход.
	\subsubsection{Соответствие подстановочной структуре}
			Каждому товару соответствует определенный набор товаров, на которые он может быть заменен. Например, "`Сок вишневый 1л"' не может быть заменен на "`Сок вишневый 0.5 л"'.
	\subsubsection{Равное количество входа и выхода}
			Количество товаров на входе должно быть равно количеству товаров на выходе.

\section{Работа с товарными документами}

\subsection{Таблица товарных документов}

Для работы с товарными документами в меню программы предусмотрен пункт \ppymenu{Операции\rdir Товарные документы}.
Фильтр по товарным документам практически ничем не отличается от общей
формы фильтра документов. После заполнения необходимых полей фильтра, система выдает на
экран таблицу товарных документов.

\subsection{Ввод и редактирование товарных документов}

Так как категория товарных документов представлена значительным количеством разнообразных
типов, мы рассмотрим редактирование товарных документов на примере товарного прихода и
продажи товара покупателю, поскольку это наиболее часто используемые формы. Работа со
всеми остальными типами товарных документов во многом аналогична этим двум. Значительные
же отличия мы рассмотрим подробно отдельно.

\subsection{Возврат товара}

Возвраты товара могут быть от покупателя вашему предприятию или поставщику от вашего
предприятия. Как правило, возвраты привязываются к документу, по которому товар был
отгружен.

Для того, чтобы сделать возврат, привязанный к некоторому документу, следует выбрать этот
документ в таблице и нажать клавиши \keyb{Ctrl-F5}. Если к операции, к которой относится документ,
привязана операция возврата, то на экране появится диалог нового документа возврата.
Шапка этого диалога заполняется по обычным для товарного документа правилам.

В таблице строк документа для добавления позиций возврата нажмите клавишу \keyb{Insert} или \keyb{F2}
(в случае возврата, расширенный ввод строки товарного документа отсутствует). Вместо обычного
диалога строки товарного документа в верхней части окна программы появится таблица строк
документа отгрузки. В этой таблице выберите возвращаемые позиции клавишей \keyb{Enter} или
двойным щелчком мыши. Для переноса всех строк документа отгрузки в документ возврата нажмите
клавишу \keyb{F11}. При необходимости изменить возвращаемое количество по какому-либо из товаров,
откройте и отредактируйте соответствующую строку.

\ppynote{
	Система не позволяет возвращать большее количество товара, чем то, которое было отгружено.
	Кроме того, при возврате поставщику, система не позволяет возвращать  товар, который
	уже израсходован.
}

\paragraph{Особенности возврата по оплачиваемым документам}

Если документ отгрузки требует платежного документа, то возврат зачитывается как оплата.
При необходимости вернуть товар по документу, который полностью оплачен, следует провести
по этому документу отрицательную оплату на сумму возврата, что соответствует компенсации
покупателю или от поставщика за возвращенный товар.
Если документ оплачен зачитывающей оплатой, то ее можно просто удалить, а сделав возврат,
перезачесть документ вновь.

\paragraph{Возврат поставщику из лотов}

При формировании документа возврата товара поставщику бывает сложно искать документ прихода
возвращаемого товара. Для упрощения этой задачи, вы можете выбрать открытые лоты и из
таблицы лотов уже создать документ возврата, указывая не сам документ прихода, а лишь лот,
который хотите вернуть. Для этого:

\begin{enumerate}
	\item Выберите пункт меню \ppymenu{Отчетность\rdir Лоты}
	\item В фильтре по лотам укажите поставщика и, если необходимо, товар или группу товаров
	\item В таблице лотов, выбрав требуемую строку, нажмите на ней \keyb{Ctrl-F5}
\end{enumerate}

\subsubsection{Оплата товарного документа}

Товарные документы (как, впрочем, и бухгалтерские) могут быть оплачиваемыми. Это означает,
что факт оплаты отдаляется по времени от факта отгрузки либо поступления товара. Вид операции,
к которому относятся такие документы, имеет признак \dlgflag{Требует платежного документа} и
привязанные виды операций типа \ppyrsrv{Оплата}.

Оплачиваемыми могут быть такие операции как отгрузка покупателю, приход товара от поставщика.
Не оплачиваемыми обычно являются операции розничной продажи (покупатель расплачивается
непосредственно при получении товара), потери в результате боя или лома продукции, излишки,
возникающие в результате проведения инвентаризации.

Для просмотра оплат по документу и ввода новой оплаты либо исправления существующей, в таблице
документов, выбрав нужный документ, следует щелкнуть по пиктограмме {рисунок} или нажать
клавишу \keyb{F5}.

При этом в нижней части окна программы появится таблица оплат по выбранному документу.
Использование этой таблицы аналогично работе с обычной таблицей документов.
Для того, чтобы добавить новый документ оплаты нажмите клавишу \keyb{Insert}. Если к
операции, к которой относится оплачиваемый документ, привязано более одной операции оплаты,
то появится список, из которого следует выбрать именно ту операцию, которая вам нужна в
данном случае и нажать \keyb{Enter}. Новый документ оплаты похож на бухгалтерский документ. В
нем, как обычно, следует указать номер, дату, контрагента (в этом обычно нет необходимости,
поскольку контрагентом документа оплаты по умолчанию является контрагент оплачиваемого
документа), а также сумму оплаты и, возможно, примечание.

\ppynote{
	Вы можете быстро ввести всю сумму оставшегося долга по документу, нажав клавишу \keyb{F2},
	когда курсор находится в поле ввода суммы.
}

\subsection{Переоценка товаров}

Товарная переоценка требуется в тех случаях, когда необходимо изменить цену реализации или
цену поступления одного или нескольких товарных лотов.
Операцией переоценка отражается факт изменения цены поступления и (или) цены реализации
товара. В диалоге ввода товарного документа, если изменяется цена поступления, то следует
указать поставщика товара, в противном случае указывать поставщика не надо. Желательно в
поле примечания указать причину переоценки. Дата переоценки устанавливается системой
автоматически, но при необходимости может быть изменена.
В диалоге  ввода  товарной строки  введите наименование товара, новую цену поступления и
(или) реализации.

Старые цены после переоценки сохраняются и отображаются в полях диалога.
Переоценка товара ведется относительно текущего лота. Чтобы поменять лот, нажмите кнопку
\dlgbutton{Партия} и выберите требуемый лот.

В таблице товарных строк документа отображаются товары, прошедшие переоценку, их новые
цены поступления и реализации, а также  разница новой и старой цен реализации.
По результатам переоценки будут сгенерированы бухгалтерские проводки и автоматически
сформируются соответствующие бухгалтерские документы.

\ppynote{
	В документах переоценки суммы в ценах поступления и реализации рассчитываются как разность
	между новыми и старыми ценами (соответственно поступления и реализации).
}

После переоценки становится невозможным проведение операций задним числом, по старым ценам.

\subsection{Унификация цен}

Унификация цен предназначена для приведения учетных цен открытых лотов по одним и тем же товарам к общему значению и
для массового изменения учетных цен.

Если на складе имеются одинаковые товары, принадлежащие различным лотам и имеющим различные цены реализации,
то при помощи операции унификации можно выровнять эти цены до определенного значения. Кроме того, унификация позволяет осуществить массовую
переоценку товаров в соответствии с заданным правилом.

\subsubsection{Режимы унификации цен}

Возможны следующие базовые варианты унификации цен:

\begin{description}
	\item[Переоценка только последних лотов] В таком режиме переоцениваются только самые последние открытые лоты каждого товара, удовлетворяющего фильтру.
	\item[Унификация цен по всем лотам] Этот вариант предусматривает собственно унификацию цен для всех открытых лотов каждого из товаров, удовлетворяющего условиям фильтрации.
	\item[Переоценка всех лотов] Режим, позволяющий изменить учетные цены по всем открытым лотам товаров без обязательного требования унификации. То есть,
	каждый из лотов может поменять учетную цену, однако, после завершения процедуры для одного товара может существовать два или более открытых лотов с разными ценами.

	Этот момент принципиально отличает данный режим от предыдущего, который обеспечивает гарантированное однообразие цен для одного товара.
\end{description}

\subsubsection{Источник извлечения новых значений для унификации цен}

Важный вопрос, который необходимо осветить, это - источник извлечения нового значения учетной цены. Допускаются следующие варианты определения
новых значений цен:
\begin{description}
	\item[Цена из самого последнего лота] В этом варианте новым значением цены является учетная цена последнего открытого лота каждого товара.
	\item[Котировка] Новое значение цены извлекается из котировки товара.
	\item[Процентное изменение относительно текущего значения] Новое значение получается из текущего путем увеличения (уменьшения) его на заданную
	процентную величину.
	\item[Явно заданное новое значение] Возможна ситуация, когда необходимо учетные цены на выборку товаров массово установить в точно заданное
	значение. Такой режим также возможен.
\end{description}

\subsubsection{Другие аспекты процедуры унификации}

Как правило, процедура унификации цен применяется для изменения учетных цен реализации. Тем не менее, иногда возникает необходимость
массово изменить (унифицировать) учетные цены поступления по лотам некоторой выборки товаров.

Результатом работы функции унификации цен является документ товарной переоценки. Таким образом, функция обратима: то есть, после завершения
процедуры унификации, если вы ошиблись в параметрах, можно просто удалить созданный документ переоценки и все значению вернуться в прежнее
состояние.

\ppynote{
	По прошествии некоторого времени новые документа могут использовать переоцененные лоты - в этом случае удаление документа переоценки
	станет затруднительным.
}

\subsubsection{Использование унификации цен}

Операция унификации вынесена в отдельный раздел, доступ в который  открывается при обращении
к пункту меню \ppymenu{Операции\rdir Унификация цен}.

\ppypict{dlg-uniprice}{Унификация цен}

Диалог параметров унификации цен показан на рис.~\ref{pic-dlg-uniprice}. Далее перечислим управляющие элементы этого диалога и
опишем нюансы его использования.

\begin{description}
	\item[\dlgcombo{Вид операции}]
	Вид операции переоценки, которому будет принадлежать созданный документ.

	Обязательный параметр.

	\item[\dlgcombo{Склад}]
	Склад, по которому проводится унификация цен.

	Обязательный параметр.

	\item[\dlgcombo{Товарная группа}]
	Группа, ограничивающая выборку товаров, на которую должна распространяться унификация. Если группа не выбрана,
	то обрабатываются все товары.

	Кнопка \dlgbutton{Фильтр} справа от комбо-бокса позволяет выполнить сложную фильтрацию выборки товаров, подвергаемой
	обработке процедурой.

	\ppynote{
		Не следует применять сложную фильтрацию товаров для сохраняемой команды рабочего стола, поскольку применяемая
		в этом случае временная динамическая альтернативная группа не будет сохранена вместе с фильтром.

		При необходимости используйте динамические альтернативные группы, подготовленные предварительно.
	}

	\item[\dlgflag{Исключить эту группу}]
	Флаг реализует инверсию фильтрации по товарной группе. То есть, процедура применяется только к тем товарам, которые
	не включены в выбранную группу.

	\item[Старая цена]
	Если в этом поле указано не нулевое значение, то обработке подвергаются только те лоты, значение учетной цены реализации,
	которое равно введенной здесь величине.

	\item[Режим унификации]
		Блок радио-кнопок, определяющий режим унификации цен, обсуждавшийся выше.
		\begin{description}
			\item[\dlgradioi{Переоценить только последний лот}] Переоцениваются только самые последние лоты выборки товаров.
			\item[\dlgradioi{Унифицировать цены по всем лотам}]  Все открытые лоты каждого товара будут приведены к общему значению
			учетной цены.
			\item[\dlgradioi{Переоценить все лоты}] Учетная цена каждого лота конкретного товара может изменяться независимо от
			остальных лотов этого товара.
		\end{description}
	\item[\dlgcombo{По котировке}]
	Если выбрано вид котировки, то значения котировки товаров этого вида будут использованы как источник значений новых
	учетных цен лотов.

	\item[Наценка]
	Поле, в котором может быть задан процент наценки, новое абсолютное значение цены и признак переоценки цен поступления.

	Если задано просто число, то система трактует его как абсолютное значение новой учетной цены. Если последним символом
	введенной строки стоит один из следующих: $C$, $\$$, $\%$, $/$, то смысл значения меняется следующим образом:
	\begin{description}
		\item[$C$]  Введенное перед этим символом значение трактуется как процент наценки к учетной цене поступления лота.
		\ppynote{
			Допускается использовать строчную либо прописную латинскую $C$, либо русскую $C$.
		}

		Пример: 25.1C - новые учетные цены реализации будут рассчитаны как учетная цена поступления, умноженная на 1.251.

		\item[$\$$] Введенное до символа значение трактуется как абсолютное значение новый учетных цен.

		Пример: 40$\$$ - все учетные цены по выборке товаров станут равными 40.

		\item[$\%$ или $/$] Значение до символа интерпретируется как процент увеличения учетной цены реализации лотов (отрицательная
		величина - уменьшает цену на заданное число процентов).

		Пример: 7\% - все учетные цены реализации будут увеличены на 7 процентов.
	\end{description}

	\item[Округление]
		Группа параметров, определяющих округление результирующих цен.
		\begin{description}
			\item[Точность]
			В поле вводится число, устанавливающее границу округления, то есть до какого знака после десятичной точки
			допустимо округлять рассчитываемые значения.

			Например, точность 0.1 говорит о том, что значения следует округлять до одного знака после запятой, а точность 0.01 - до двух.

			\item[\dlgradioc{Направление округления}]
			Определяет в какую сторону будет осуществлено изменение расчетного значения при округлении.
		\end{description}
	\item[\dlgflag{Подтверждать каждое изменение}]
	Если флаг установлен, то при каждой попытке изменить цену лота на экране будет отображаться диалог \qu{Установка цены
	реализации}. Диалог содержит наименование товара и расчетную цену.

	Если требуется, здесь можно внести необходимые изменения. Кнопка \dlgbutton{Партия}, как обычно,
	открывает таблицу просмотра и выбора лотов товара. Выбор конкретного лота определяет новую
	цену реализации товаров, равную установленной на нем цене. По кнопке \dlgbutton{OK} система принимает
	новую цену, и переходит к следующему наименованию товара. По кнопке \dlgbutton{Отмена} система
	отказывается от изменения цены указанного товара и также переходит к следующему наименованию.
	Флажок \dlgflag{ОК для всех товаров} отключает пошаговый просмотр установки цены реализации.
\end{description}

\subsubsection{Команда рабочего стола для унификации цен}
Если вы часто вызываете процедуру унификации цен, то можно создать ярлык на рабочем столе для быстрого доступа к функции.

Соответствующая команда рабочего стола так и называется \qu{Унификация цен}.

\subsection{Модификация товаров}

Товарная модификация - это, в общем случае, преобразование одних товаров в другие. Для того
чтобы было понятнее, проще всего привести ряд ситуаций, когда модификация может быть использована:
\begin{itemize}
	\item Комплектация изделия из нескольких компонентов. Например: комплект мебели, компьютер.
	\item Изготовление салатов и других блюд из различных продуктов.
	\item Сборка новогодних подарков.
	\item Разборка комплекта мебели с целью продажи его по частям.
	\item Учет потери сортности товаров. Например: превращение качественных томатов в нестандартные.
\end{itemize}
Попросту говоря, модификация - это приход одних товаров и одновременно расход других товаров.
При модификации часто используются структуры товаров. Структура товара - это зафиксированный
состав товара, который может быть использован для быстрой комплектации или декомплектации
товара в документе модификации. Подробно структуры товаров рассмотрены в разделе, посвященном
справочнику товаров.
Виды операций, реализующих товарную модификацию, относятся к типу операций \ppyrsrv{Модификация товаров}.
Создание нового документа модификации реализуется так же, как и для других товарных документов.
Некоторые отличия проявляются во вводе товарных строк документа.

\ppyexample{
	Имеется один набор мягкой мебели \qu{Ариана}, состоящий из дивана и двух кресел.
	Цена поступления комплекта - 5000 руб.
	Цена реализации - 7500 руб.
	В ходе декомплектации у вас на складе вместо набора появляются
	Диван, цена поступления - 3000 руб., цена реализации - 3750 руб.
	2 кресла, цена поступления за 1 шт. - 1000 руб. , цена реализации. - 1250 руб.
	Вариант 1. Допустим сначала, что при определении товара не была расписана его структура. В
	справочнике товаров должны присутствовать, например в группе Мебель:
	Комплект мягкой мебели Ариана
	Кресло Ариана
	Диван Ариана
	После нажатия \keyb{Insert} в таблице товарных строк документа выберите строку меню
	\qu{Расход}.
	\newline В поле \qu{Группа} введите Мебель.
	\newline В поле \qu{Товар} - Комплект мягкой мебели Ариана.
	\newline В поле \qu{Всего единиц} - 2
	\newline Нажмите OK
	\newline В таблице товарных строк отобразится введенная в диалоге информация

	Напомним, что -2 в столбце {Количество} означает, что товар расходуется в ходе операции.
	В итоговой строке отображается разница в ценах между товаром расходуемым и товаром
	приходуемым.  Теперь еще раз нажмите \keyb{Insert} и выберите строку меню {Выход}
	\newline В поле \qu{Товар} введите - Кресло Ариана
	\newline В поле \qu{Всего единиц} - 4
	\newline В поле \qu{Цена поступления} - 1111.11
	\newline В поле \qu{Цена реализации} - 2000
	\newline Нажмите OK.
	В таблице появится еще одна строка

	Как можно заметить , цена поступления кресла в таблице отличается от требуемой. Это
	связано с тем, что цена поступления выходящего товара выравнивается исходя из цен
	поступления расходуемого товара. Еще раз нажмите клавишу \keyb{Insert} и выберите строку
	\qu{Выход}
	\newline В поле \qu{Товар} введите - Диван Ариана
	\newline В поле \qu{Всего единиц} - 2
	\newline В поле \qu{Цена поступления} - 2777.78
	\newline В поле \qu{Цена реализации} - 5000
	\newline Нажмите OK.
	Теперь браузер выглядит следующим образом:
}

Мы рассмотрели наиболее общий случай ввода документа модификации. Однако, тот же самый
результат можно получить и значительно быстрее.
Допустим, что при определении нашего комплекта мягкой мебели, была расписана его структура,
то есть, приведен перечень его составных частей и заданы условия их комплектации. Тогда,
после ввода первой строки расходуемого товара, автоматически сформируются и будут отображены
в таблице две другие строки приходуемого товара.

\section{Возвраты}

Возвратные документы, как отмечалось выше, являются отражением возвратных операций.
Ввод возвратного документа осуществляется нажатием клавиш \keyb{Ctrl-F5} на строке связанного
с ним документа в таблице товарных документов. Следует обратить внимание на то, что не
каждый документ допускает по отношению к себе проведения возвратных операций. Установление
связи между документами происходит в момент определения вида возвратной операции. Так,
например, если для операции \qu{Возврат поставщику} связанной операцией является \qu{Приход
товара от поставщика}, то проведение возвратной операции на соответствующем приходном документе
будет возможно. Если же  вы попытаетесь провести возврат на документе, который не является
связанным ни с одним из видов возвратных операций , система проигнорирует этот вызов.
Работа с возвратными документами несколько отличается от работы с остальными товарными
документами. Это вызвано, прежде всего, тем, что ведется одновременная обработка двух
документов.

Из связанного документа в возвратный автоматически заносятся данные о контрагенте (поставщике
или покупателе), если таковой имеется. Кроме того, ввод товарной строки документа возврата
осуществляется посредством выбора ее из таблицы товарных строк связанного документа. Поясним,
как это происходит. Если, находясь в таблице товарных строк возвратного документа,  нажать
клавишу \keyb{Insert}, откроется таблица товарных строк связанного документа. Выбор требуемой
строки (нажатие \keyb{Enter}) в таблице связанного документа автоматически перенесет ее в
таблицу возвратного документа. Чтобы выбрать все строки из связанного документа нажмите
\keyb{Ctrl-Enter}. При этом, хотя в таблице связанного документа выбранные строки исчезают,
но фактического удаления их из товарного документа не происходит. Вы можете убедиться в этом,
открыв соответствующий документ. Для того, чтобы закрыть таблицу связанного документа, нажмите
\keyb{Escape}.

Чтобы откорректировать количество возвращаемого товара, следует в таблице возвратного документа
выбрать требуемую строку, и в диалоге корректировки товарной строки в соответствующем поле
ввести количество возвращаемого товара.

После ввода всех требуемых товарных строк и закрытия таблицы, в диалоге ввода возвратного
документа отобразится общая сумма возврата, проходящая по документу.

\section{Зачетные оплаты}

Система предоставляет дополнительный сервис, именуемый зачетными оплатами, позволяющий
проводить оплаты и взаимозачеты с покупателями и поставщиками общими документами, таким
образом, что система автоматически разносит привязки оплат по долговым документам.
Суть технологии зачетных оплат сводится к тому, что два документа (долговой и платежный)
могут частично или полностью погашать долг друг друга с помощью одного или более документов
зачитывающих оплат. Таким образом, платежный документ может зачесть один или много долговых
документов, а долговой документ может быть зачтен одним либо несколькими платежными
документами.

Более того, оба документа (платежный и долговой) могут одновременно быть и своими
противоположностями. То есть, платежный документ может быть одновременно долговым, а долговой
одновременно платежным. Самый типичный пример такого положения - это взаимозачеты. Другими
словами, технология зачетных оплат позволяет легко реализовать взаимозачеты бартером с
поставщиком или покупателем.

Другой популярный пример использования зачетных оплат - не привязанная оплата. То есть,
скажем, при поступлении денег от покупателя, вы не разносите оплаты в привязке к каждому
документу отгрузки этому покупателю, а вводите один документ платежа от покупателя, а
система самостоятельно (возможно, под вашим контролем) разнесет этот платеж на документы
отгрузки.

Следует определить несколько важных терминов, используемых при объяснении использования
технологии зачетов. Мы попробуем это сделать как можно более формально для того, чтобы
избежать недоразумений и двойных толкований в дальнейшем.

\ppypict{schema-reckon}{}

\paragraph{Долговой документ}

Документ, который требует оплаты, и может быть оплачен через схему зачета.

\paragraph{Зачетный документ}

Документ, который непосредственно формирует средства для погашения долга по долговому
документу.

\paragraph{Зачитывающий документ}

Документ, являющийся посредником между зачетным и долговым документов. Зачитывающий документ
всегда относится к типу операции \ppyrsrv{Оплата}.

\paragraph{Прямой зачет}

Этот термин означает формирование зачитывающих оплат на основе зачетного документа. При этом
система перебирает долговые документы, относящиеся к видам операций, связанных с оплатами,
перечисленными в списке зачитывающих оплат в опциях зачетной операции, и по контрагенту,
указанному в зачетному документе.

\paragraph{Обратный зачет}

При обратном зачете зачитывающие оплаты формируются на основе долгового документа. При этом
система перебирает зачетные виды операций, которые могут зачесть этот долговой документ, и по
контрагенту, указанному в долговом документе.
Для обратного зачета не доступны некоторые операции, которые можно осуществить для прямого
зачета.

\paragraph{Тройственный зачет}

Тройственный зачет предполагает, что документы плательщика зачитывают долговые документы,
относящиеся к должнику, отличному от плательщика. То есть, плательщик А платит за должника Б.

\paragraph{Зачет по персональному отношению}

Форма автоматизации тройственного зачета. Схему зачета можно настроить таким образом, чтобы
система автоматически идентифицировала связь между разными контрагентами на основе
персонального отношения.

\ppyexample{
	Предприятие А закупает у вашего предприятия товар, а предприятие Б является его
	головной организацией и осуществляет платежи по долгам предприятия А. В этом случае, между
	персоналиями (с которыми связаны соответствующие аналитические статьи) А и Б можно установить
	персональное отношение, и таким образом заставить систему автоматически зачитывать платежи,
	поступившие от Б на документы отгрузки клиенту А.
}

Обратим внимание на два важных пункта:

\begin{enumerate}
	\item Зачет по персональному отношению осуществляется в направлении, обратном отношению.
	То есть, персональное отношение направлено от А к Б, а зачет производится от платежа,
	поступившего от Б к документу, зарегистрированному на А (то есть, от Б к А).
	\item Существует зарезервированный тип персонального отношения, обычно имеющий название
	\ppyrsrv{Филиал} и символ $AFFIL$ (система его распознает по идентификатору 1), который
	автоматически используется для зачета.
\end{enumerate}

\subsection{Настройка зачетных оплат\label{sec-op-reckon-config}}

Этот параграф в большей мере адресован администраторам системы.
Настройка зачетов сводится к правильной установке зачетной операции.
Для того, чтобы вид операции сделать зачетным, необходимо в диалоге редактирования этого
вида операции установить флаг \dlgflag{Зачетная операция}. Сразу после установки этого флага
станет доступна кнопка \dlgbutton{Зачет\dots}, где вы можете указать параметры зачетной операции.
Диалог настройки этих параметров показан на рисунке.
Перечислим управляющие элементы этого диалога

\ppypict{dlg-017}{Вид операций - зачеты}

\begin{description}
	\item[Список зачитывающих операций]
	В этом списке перечислены виды операций, используемых данной зачетной операций как
	зачитывающие. В списке могут быть только виды операций, относящиеся к типу \ppyrsrv{Оплата}.

	\item[\dlgbutton{Добавить}]
	Позволяет добавить операцию в список зачитывающих оплат.

	\item[\dlgbutton{Удалить}]
	Позволяет удалить операцию из списка зачитывающих.

	\item[\dlgbutton{Создать}]
	Позволяет создать новый вид операции и сразу вставить его в список зачитывающих.

	\item[\dlgbutton{Изменить}]
	Позволяет просмотреть и, возможно, модифицировать выбранную зачитывающую оплату.
	Период зачета платежных документов	Здесь можно указать период, в который должны
	попадать долговые документы, подлежащие зачету.
	Как правило, этот период задают не в абсолютных датах, а относительно даты зачетного
	документа. Для этого используется символ @. Так, для предоплаты следует указывать
	период зачета \qu{@..}, что означает, что система должна зачитывать документы этого вида
	только на документы, дата которых больше или равна дате самого зачетного документа.
	Другими словами, предоплата не будет зачитывать документы, которые были отгружены до нее.
	Подробно ввод шаблонизированных дат описан на стр.~\pageref{sec-input-tamplatedate}.

	\item[\dlgflag{Автоматически зачитывать платежные документы}]
	Если это флаг установлен, то при ручном проведении или изменении платежного (зачетного)
	документа система автоматически будет искать долговые документы, которые могут быть
	зачтены этим документом. Если такие документы будут найдены, то в зависимости от установки
	флага \dlgflag{Подтверждать зачет платежных документов}, система либо запросит подтверждение на
	зачет, либо \qu{молчаливо} зачтет в хронологическом порядке все документы, на сколько хватит
	суммы проведенного документа.

	\item[\dlgflag{Подтверждать зачет платежных документов}]
	Если этот флаг установлен, то перед зачетом платежного документа система выдаст на экран
	диалог, в котором будут представлены документы, которые могут быть зачтены этим документом,
	а так же опции зачета. Пользователь сможет не только подтвердить или отклонить зачет, но и
	выбрать документы, которые следует зачесть.

	\item[\dlgflag{Автоматически зачитывать долговые документы}]
	Установка этого флага требует от системы автоматической проверки возможности зачета
	долгового документа при его проведении или изменении.
	Когда долговой документ проводится, система просматривает наличие платежных документов,
	которые могут зачесть этот документ, и если такие документы есть, то в зависимости от
	установки флага \dlgflag{Подтверждать зачет долговых документов}, система либо
	запросит подтверждение на зачет, либо зачтет этот документ существующими платежными
	документами в хронологическом порядке.

	\item[\dlgflag{Подтверждать зачет долговых документов}]
	Установка этого флага предписывает системе перед зачетом долговых документов запрашивать
	подтверждение пользователя. Как и в случае с платежными документами, подтверждение
	содержит список зачетных документов, которые могут \qu{закрыть} выбранный долговой документ
	и позволяет не только отклонить или подтвердить зачет, но и выбрать зачетные документы,
	которые следует использовать для оплаты данного долгового документа.

	\item[\dlgflag{Зачитывать только по общему складу}]
	Если этот флаг установлен, то система будет производить взаимные зачеты только тех
	документов, которые принадлежат одному и тому же складу. Другими словами, если долговой
	документ относится к складу №1, а платежный - к складу №2, то эти два документа друг на
	друга не зачитываются.

	\item[\dlgflag{Зачитывать по дополнительному объекту}]
	При установке этого флага, зачет платежных документов будет осуществляться по дополнительному
	объекту документа. В противном случае (что является типичным вариантом) соответствие между
	платежными и долговыми документами определяется на базе основной статьи аналитического
	учета документа.
	Эта опция может потребоваться для организации регулярного \qu{тройственного зачета}, когда
	платежные документы этого вида операции всегда зачитывают долги контрагентов, относящихся
	к другой таблице аналитического учета.

	Эта опция работает только для прямого зачета.

	\item[\dlgflag{Зачитывать только по общему дополнительному объекту}]
	Если этот флаг установлен, то система будет зачитывать документы друг на друга только при
	совпадении дополнительного объекта.

	Например, если документ отгрузки содержит дополнительную статью \qu{А}, в то время, как
	платежный документ от того же контрагента содержит дополнительную статью \qu{Б}, то такой
	платеж не будет зачтен на описанную отгрузку.

	\item[\dlgflag{Запрашивать альтернативную статью для зачета}]
	Установка этого флага повлечет за собой то, что при прямом зачете, система запросит
	статью, на которую следует перенести сумму платежа. То есть, вы сможете выбрать контрагента,
	долги которого следует \qu{закрыть} этим платежом.
	Эта опция может потребоваться для организации эпизодического \qu{тройственного зачета}.
	Опция работает только для прямого зачета.

	\item[\dlgflag{Зачитывать только по общему дополнительному объекту}]
	Если эта опция включена, то зачет будет осуществляться только на те долговые документы,
	которые имеют ту же дополнительную статью, что и зачетный документ.
	Таким образом, если существует долговой документ от контрагента A и платежный документ
	от контрагента A, то зачет между ними будет осуществлен только в том случае, если
	дополнительные объекты у этих документов совпадают (если в обоих документах дополнительные
	объекты пустые, то условие считается выполненным - зачет проходит).

	\item[\dlgflag{Операция зачетная только при отрицательной номинальной сумме документа}]
	При установленном флаге документ, принадлежащий этому виду операции, будет трактоваться как зачетный только
	в том случае, если его номинальная сумма меньше нуля. При этом для зачета будет применяться
	модуль номинальной суммы (то есть величина суммы без знака минус).
	Опция может быть актуальной для некоторых специальных операций. Например, корректировка
	документа либо бухгалтерские документы, которые должны вести себя в контексте
	зачета по-разному в зависимости от знака суммы.

	\item[\dlgcombo{Персональное отношение для коллективного зачета}]
	В этом комбо-боксе можно указать тип персонального отношения, в соответствии с которым
	система автоматически будет идентифицировать пары плательщик-дебитор для зачета.
\end{description}

\section{Товарные заказы}

Товарные заказы - это документы, в которых ведется учет товаров затребованных покупателем.
В товарном заказе можно проследить заказанные покупателем товары, а также суммы, на которые
сделан заказ.

В системе товарные заказы вынесены в отдельный раздел. Это связано, прежде всего, с тем, что
заказы не являются в чистом виде товарными документами, они не изменяют ни материальное,
ни количественное состояние предприятия.  Работа с заказами ведется как с обычными товарными
документами при помощи фильтра, таблицы и диалогов.

\subsection{Общие принципы организации товарных заказов в системе}

\ppypict{schema-orderbill}{}

Заказы от покупателей являются достаточно сложными объектами. Главная причина этого -
требование организации связи между заказами и отгрузками в отношении многие-ко-многим.
То есть, с одним документом заказа может быть связано более одного документа отгрузки,
равно как один документ отгрузки может обрабатывать более одного документа заказа.
Схема таких связей показана на рис.~\ref{pic-schema-orderbill}.

Фактически, строки товарных заказов представлены специализированными лотами, к каждому
из которых косвенно привязываются строки документов отгрузки. При этом происходит \qu{расход}
товарного заказа, то есть, его учет.

С точки зрения пользователя это выливается в то, что если вы хотите, чтобы отгрузка учла
заказ, она должна быть явно связана с этим заказом. Ниже мы объясним как это реализуется
на практике.

\subsubsection{Учет заказов на не лимитируемые товары}

При работе с заказами на услуги и прочие нелимитированные номенклатурные позиции
возникает следующая логическое несоответствие: основной особенностью нелимитированных
товаров является то, что остатки по ним не учитываются. То есть, система не создает
лоты для таких товаров. С другой стороны, при получении заказа на нелимитированный товар
ваше предприятие должно иметь возможность количество предоставленных в рамках этого
заказа товара (услуг).

Разрешается указанное противоречие специальной опцией, которая предписывает системе
при создании документа заказа формировать лоты по нелимитированным товарам.
Опция устанавливается в диалоге системных параметров общих параметров системы:
меню \ppymenu{Админ\rdir Настройки}\rdir \dlgbutton{Системные параметры}\rdir \dlgflag{Генерировать лоты по заказам не лимитируемого товара}.

После установке этого флага система будет учитывать количество оказанных в рамках
заказа услуг и других нелимитированных позиций.

\ppynote{
	Опция вступает в силу только для сеансов, запущенных после установки
	описанного флага.
}

\subsection{Работа с товарными заказами}

Для работы с товарными заказами необходимо завести операцию, имеющую тип товарный заказ.
При обращении к пункту меню \ppymenu{Операции\rdir Товарные заказы}, открывается фильтр по
товарным заказам, где указываются операция, покупатель, а если требуется, то и плательщик
заказа.

\ppypict{dlg-f-005}{Фильтр по товарным заказам}

\begin{description}
	\item[Период]

	\item[Сортировать по]

	\begin{itemize}
		\item Дате
		\item Номеру
		\item Контрагенту
	\end{itemize}

	\item[\dlgcombo{Вид операции}]

	\item[\dlgcombo{Контрагент}]

	\item[\dlgcombo{Дополнительный объект}]

	\item[\dlgcombo{Склад}]

	\item[\dlgbutton{Список...}]

	\item[Сумма]

	\item[\dlgcombo{Статус}]

	\item[\dlgflag{Показывать долги}]

	\item[\dlgflag{Только неоплаченные}]

	\item[\dlgflag{Только открытые}]

	\item[\dlgflag{Новый документ по фильтру}]

	\item[\dlgflag{Показывать только собственные документы}]

	\item[\dlgflag{Показывать документы без агента}]

	\item[\dlgcombo{Валюта}]

	\item[\dlgflag{Все валюты}]

	\item[\dlgbutton{События}]

	\item[\dlgbutton{Расширение}]

	\item[\dlgbutton{Опции просмотра}]

\end{description}

После введения необходимых условий, открывается таблица товарных заказов. При открытии
некоторого заказа открывается таблица товарных строк данного заказа, в котором отражаются
затребованные введенные товары в соответствующем количестве и по указанной цене. Отпуск
заказанных товаров подтверждается соответствующими товарными документами, ввод которых
осуществляется в таблице товарных документов.

\ppypictsc{Brw-007}{Товарные заказы}{0.4}

Большое значение при работе с товарными заказами имеет подтверждающий документ. Он
характеризует количество принятого покупателем товара. Подтверждающий  документ вводится
из таблицы соответствующих товарных документов, отпущенных по заказам покупателей,
нажатием клавиш  \keyb{Ctrl-K}. Удаление подтверждающего документа - нажатием  \keyb{Ctrl-D}.
Необходимо заметить, что при существующем товарном заказе количество заказанного отпущенного
покупателю товара  не всегда совпадает с количеством принятого по заказу покупателем товара.
В этом случае и оказывается важным значение подтверждающего документа.

\subsubsection{Создание документов по образцу документа заказа\label{loc-addbillbysample-order}}

Таблица реестра документов предоставляет унифицированный сервис создания документов
по образцу выбранного документа.

В случае с товарными заказами эта функция имеет ряд расширений и опций, требующих
отдельных пояснений.

\ppypict{dlg-addbillbysample-order}{Диалог создания документа по образцу товарного заказа}

При вызове функции появляется диалог (рис.~\ref{pic-dlg-addbillbysample-order}),
в котором можно выбрать один из следующий вариантов:

\begin{description}
	\item[Стандартный документ по образцу] Программа создаст новый документ,
	принадлежащий тому же виду операции, что и документ образца. Кроме того,
	все основные атрибуты образца будут перенесены в созданный документ:
	\begin{itemize}
		\item Дата
		\item Склад
		\item Контрагент
		\item Дополнительный объект
		\item Примечание
	\end{itemize}
	Номер нового документа будет сформирован независимо от образца (штатной
	процедурой генерации номера документа по счетчику).

	Строки нового документа не заполняются.

	\item[Сформировать отгрузку по заказу] Системой будет создан новый документ,
	относящийся к выбранному в диалоге виду операции. При этом выбор предлагается из
	числа тех видов операций расхода, которые имеют признак \dlgflag{Продажа по заказу}.

	Документ отгрузки наследует от базового заказа следующие атрибуты:
	\begin{itemize}
		\item Номер документа.

		Это поле копируется в создаваемый документ отгрузки из документа заказа
		в том случае, если в диалоге установлен флаг \dlgflag{Копировать номер документа}.

		Обратим внимание на то, что значение данного флага сохраняется в реестре
		операционной системы для текущего пользователя в соответствии с комбинацией
		(Действие-Вид операции). Таким образом, если при следующем вызове функции
		создания документа отгрузки по образцу документа заказа, вы выберите ту же
		операцию, то значение флага будет то же самое.

		\item Контрагент
		\item Дополнительный объект
		\item Агент
		\item Примечание
	\end{itemize}

	Строки документа отгрузки автоматически не заполняются, однако при
	добавлении в него строк	по заказу, сразу высвечивается таблица
	строк документа заказа-образца из которой вы можете сразу перенести
	все не отгруженные строки, по которым есть достаточный остаток на
	складе.

	При формировании отгрузки по заказу необходимо выбрать вид операции
	и склад (который может отличаться от того, которому принадлежит
	документ образца).

	\item[Сформировать драфт-расход] Создается документ, относящийся к
	виду операции типа драфт-расход. Этот вид операции необходимо выбрать
	в диалоге.

	Новый документ наследует от заказа следующие атрибуты:
	\begin{itemize}
		\item Контрагент
		\item Дополнительный объект
		\item Агент
		\item Примечание
	\end{itemize}

	Склад создаваемого документа определяется выбором пользователя.
	Дата и номер устанавливаются так же, как и для независимо создаваемого драфт-документа.

	Все строки из документа заказа копируются в драфт-документ. При этом цена реализации
	по каждой строке устанавливается равной чистой цене реализации (с учетом скидки) в
	исходном документе заказа, а цена поступления не инициализируется.

	\item[Сформировать драфт-приход]
	Эта опция ориентирована на создание документа заказа поставщику на основании
	документа заказа от покупателю. По этому, в отличии от предыдущего варианта
	здесь при копировании строк количество проставляется равным не отгруженному
	количеству из соответствующей строки исходного документа заказа.

	Если какая-либо из строк заказа полностью отгружена покупателю, то
	такая строка не переносится в новый драфт-документ.
\end{description}

Назначение других управляющих элементов этого диалога следующее:

\begin{description}
	\item[\dlgcombo{Вид операции}]
	\item[\dlgcombo{Склад}]
	\item[\dlgcombo{Вид котировки}]
	\item[\dlgflag{Копировать номер документа}]
	\item[\dlgflag{Неинтерактивный режим}]
	Если этот флаг включен, то функция будет выполнена без возможности ручного редактирования
	результирующего документа. То есть, документ (или документы) по образцу будут созданы автоматически.
	\item[\dlgflag{Для всей выборки документов}]
	Опция доступна только в том случае, если функция была вызвана из таблицы заказов с фильтром,
	в котором выбран единственный вид операции.

	Если флаг установлен, то функция будет выполнена для всех документов выборки.

	\item[\dlgflag{Оприходовать весь заказанный товар}]
	Специальная опция. Предназначена для бизнес-процессов, при которых весь товар, находящийся в заказе,
	должен быть принять на склад и сразу же израсходован созданным здесь же документом расхода.

	В общем случае применять эту опцию не следует.

	\item[Дата] Дата создаваемого документа. Если поле пустое, то дата будет выбрана автоматически.
\end{description}

\section{Пулы документов}

Пул документов - это своеобразный контейнер, позволяющий объединять несколько различных
документов в одном. При этом каждый из объединяемых документов продолжает существовать сам
по себе.

Пулы документов бывают двух типов:
\begin{itemize}
	\item Свободные
	\item Встроенные
\end{itemize}

\subsection{Свободные пулы}

Свободный пул сам по себе является документом, относящимся к типу операции \ppyrsrv{Пул документов}.
Вы можете настроить любое количество видов операций, относящихся к этому типу.

Документы пулов доступны по меню \ppymenu{Операции\rdir Пулы документов}. Фильтр пулов аналогичен
фильтру по другим категориям документов.

Создав новый документ пула, вы можете просматривать список принадлежащих ему документов
по клавише \keyb{F3}. В таблице элементов пула документов вы можете добавлять новые документы
в пул или присваивать ему существующие документы, а также редактировать документы,
принадлежащие этому пулу.

Наиболее популярным использованием свободных пулов является объединение документов отгрузки
для того, чтобы по нескольким документам печатать общие накладные и счета-фактуры.

\subsection{Встроенные пулы}

Встроенные пулы документов используются системой для ассоциации различных объектов с наборами
документов. Типичными примерами встроенных пулов документов являются кассовые и
технологические сессии, при списании которых создаются учетные документы, списанные
драфт-документы и др.

Принадлежность документов встроенным пулам управляется автоматически и пользователь не имеет
возможности влиять на это. Все, что можно сделать со встроенными пулами, это - просматривать
документы-члены пула и модифицировать или удалять документы пула.

\ppynote{
	Мы считаем своим долгом предупредить, что удаление или модификация документов, принадлежащих
	встроенным пулам крайне нежелательна, поскольку система рассчитывает характеристики объектов,
	владеющих пулами исходя из сумм документов, принадлежащих этим пулам.
}

\section{Драфт-документы}

Драфт-документы - это документы, которые прямо не отражаются на текущем учете, но позволяют
автоматически формировать на своей основе учетные документы.
Собственно, отсутствие прямого влияние на учет (состояние баланса предприятия или его
товарно-материальных остатках) является в равной степени и целью и основной отличительной
чертой драфт-документов.

\subsection{Настройка драфт-документов}

\ppypict{dlg-089}{Вид Драфт-операции}

Диалог вида операции драфт-документов приведен на рис.~\ref{pic-dlg-089}. Далее перечислены
управляющие элементы этого диалога.

\begin{description}
	\item[Наименование]
	Наименование вида операции.

	\item[Символ]
	Символ вида операции, применяемый для идентификации операции при импорте/экспорте,
	а так же для внешних приложений.

	\item[Тип операции]
	Справочное поле, показывающее к какому типу относится данный вид операции.
	Для драфт-документов это либо \ppyrsrv{Драфт-приход}, либо \ppyrsrv{Драфт-расход}.

	\item[Идент]
	Справочное поле, показывающее значение идентификатора вида операции.

	\item[Ранг]
	Параметр, определяющий порядок сортировки данной записи в списках.

	\item[\dlgcombo{Статус новых документов}]

	\item[\dlgflag{Пассивная операция}]
	Виды операций, имеющие этот признак, не отображаются в списках выбора.

	Не следует рассматривать этот флаг как инструмент управления правами
	пользователей. Его назначение скромнее - избавить сотрудников от
	созерцания в списках видов операций, которые им не требуются.

	Все документы, относящиеся к виду операции с этим флагом, видны
	в таблицах и учитываются в отчетах (естественно, при соответствующих
	условиях фильтрации).

	\item[\dlgcombo{Таблица объектов}]

	\item[\dlgcombo{Доп таблица объектов}]

	\item[\dlgcombo{Операция списания}]
	Вид операции списания документа. В случае, если эта операция имеет подтип \ppyrsrv{План закупок},
	вид операции списания определяет одну или несколько (по обобщению) видов операций, с
	документами которого сравнивается драфт-документ, принадлежащий данному виду операции.
	В остальных случаях вид операции списания определяет то, в документы какого вида будут
	конвертироваться драфт-документы, относящиеся к данной операции.

	\item[\dlgcombo{Контрагент операции списания}]
	Если вы хотите, чтобы документ списания имел одного и того же контрагента, то укажите
	его в этом комбо-боксе.

	\item[\dlgcombo{Операция комплектации дефицита}]
	Если при списании драфт-документа данного вида возникнет дефицит учетных остатков, то
	заданный вид операции комплектации дефицита позволит системе  автоматически сформировать
	требуемые остатки.

	\item[\dlgbutton{Опции...}]

	\item[\dlgbutton{Опции печати...}]

	\item[\dlgbutton{Доп суммы...}]

	\item[\dlgbutton{Счетчик...}]

	\item[\dlgflag{Формировать пустой документ}]
	Если этот флаг установлен, то при списании драфт-документа будет формироваться пустой
	(без товарных строк) учетный документ. Эта опция применяется в том случае, если, по
	установленным на вашем предприятии правилам, оператор должен самостоятельно заполнить
	содержание документа, чтобы затем иметь объективную картину сравнения исходного
	драфт-документа с результирующим документом.

	Для примера можно привести следующую схему бизнес-процесса:

	\begin{enumerate}
		\item Менеджер по закупкам формирует драфт-документа закупки и отправляет его поставщику
		\item Поставщик в соответствии с этим документом отгружает вам товары
		\item Оператор списывает драфт-документ, получая в результате пустой документ прихода, в
		который вводит поступившую от поставщика номенклатуру.
		\item Менеджер по закупкам сравнивает результат, введенный оператором, с документом закупки.
	\end{enumerate}

	\item[\dlgflag{Списывать элементы частичных структур}]
	При установленном флаге, система, после того, как сформирует товарный документ списания,
	просмотрит всю номенклатуру, добавленную в него на предмет того, ассоциированы ли с
	какими-либо из товаров частичные структуры. Если да, то в конец документа будут добавлены
	компоненты этих структур в количестве, согласованном с количеством соответствующих товарных
	позиций.

	Более подробно частичные структуры описаны в разделе, посвященном товарным структурам.

	\item[\dlgflag{Документ списания формировать текущей датой}]
	По умолчанию, документ списания формируется с то же датой, что и у драфт-документа. Если
	вы установите этот флаг, то документы списания 	будут формироваться с текущей системной
	датой.

	\item[\dlgflag{Не наследовать дату истечения срока годности при списании}]

	\item[\dlgflag{Допускается множественное списание}]

	\item[\dlgflag{Списывать строки драфт-прихода в модификацию отдельными документами}]

\end{description}

\subsection{Таблица драфт-документов}

Драфт-документы доступны через пункт меню \ppymenu{Операции\rdir Драфт-документы}.

Фильтр и таблица драфт-документов практически ни чем не отличаются от
того, что мы видели в случае с другими категориями документов (см.~\pageref{sec-billlist}).

Единственное существенное отличие в фильтре - это флаг \dlgflag{Только открытые}.
Снятие этого флага (по умолчанию он включен) приведет к тому, что в таблице будут
отображаться и списанные и не списанные драфт-документы.

\subsection{Ввод и редактирование драфт-документов}

\ppypict{dlg-091}{Диалог редактирования заголовка драфт-документа}

Диалог редактирования заголовочной части драфт-документа показан на рис.~\ref{pic-dlg-091}.
Далее приводится описание управляющих элементов этого диалога:

\begin{description}

	\item[Номер документа]

	\item[Дата]

	\item[Сумма]

	\item[Курс]

	\item[Валюта]

	\item[Базовая сумма]

	\item[Скидка]

	\item[На всю партию]

	\item[Примечание]

	\item[Строки документа]

	\item[Дополнение]

\end{description}

\subsection{Списание драфт-документов}

Списание драфт-документов представляет собой достаточно сложную технологию,
реализующую возможности списания одного или нескольких драфт-документов,
совмещенные с развитыми функциями компенсации дефицита.

Собственно, именно сервис компенсации дефицита является главным источником
трудностей при настройки списания драфт-документов.

Принципиально важно то, что существует два метода списания:

\begin{itemize}
	\item Простое списание одного либо нескольких драфт-документов
	\item Списание драфт-документов по правилам\footnote{Не путать с формированием
	драфт-документов по правилам}.
\end{itemize}

\subsubsection{Простое списание драфт-документов}

При простом списании происходит следующее:

\begin{itemize}
	\item Пользователь инициирует функцию списания драфт-документа
	в таблице документов.
	\item Если документ не списан, то система определяет вид операции
	списания из вида операции, к которому относится сам документ.

	Если вид операции списания не определен, то никаких действий не
	выполняется и дальше можно не читать.
	\item Система формирует новый документ списания со следующими
	атрибутами:
	\begin{itemize}
		\item Вид операции: рассматривался выше.
		\item Склад: тот же, что и в драфт-документе
		\item Дата: если в виде операции драфт-документа установлен флаг
		\dlgflag{Документ списания формировать текущей датой}, то
		текущая системная дата. В противном случае дата документа
		списания равна дате драфт-документа.
		\item Контрагент: если вид операции драфт-документа жестко определяет
		контрагента документа списания, то это он и будет.

		Если нет, но контрагент драфт-документа относится к той же таблице
		статей, что и таблица статей основного контрагента вида операции списания,
		то контрагентом в документе списания будет он же.

		В противном случае документ списания останется без контрагента.
		\item Дополнительный объект: если дополнительный объект драфт-документа
		относится к той же таблице аналитических статей, что и таблица
		статей дополнительного объекта вида операции списания, то
		дополнительный объект документа списания становится равным
		дополнительному объекту драфт-документа.
		\item План платежей: в случае, если для вида операции документа
		списания установлен флаг \dlgflag{Требует платежного документа} и
		существует соглашение (возможно, общее) для контрагента документа
		списания, в котором определен срок оплаты, то дата оплаты документа
		списания устанавливается равной дате документа списания плюс срок
		оплаты в днях.
		\item Примечание: полностью копируется из драфт-документа.
		\item Агент: если в драфт-документе установлен агент, то он копируется в
		документ списания.

		Если в драфт-документе агент не был установлен, но для контрагента
		документа списания существует соглашение, в котором определен
		агент, то этот агент устанавливается в документе списания (при этом не
		применяется общее соглашение).
		\item Поля фрахта: В случае, если вид операции списания драфт-документа
		определяет возможность установки параметров фрахта, и списываемый драфт
		документ имеет заполненные атрибуты фрахта (какие-либо), то
		вся информация о фрахте копируется из драфт-документа в документ списания.
	\end{itemize}
\end{itemize}

\subsubsection{Списание драфт-документов по правилам}

%\ppypict{dlg-092}{Списание драфт-документов}

%\begin{ppytable2}
%	Списать только текущий документ & \eor
%	Списать всю выборку & \eor
%\end{ppytable2}

\section{Сравнение документов}

Функция сравнения документов позволяет построчно анализировать различия двух
товарных или драфт-документов. Эта функция применяется при анализе списания драфт-документов,
для выявления различий между основным документом и документом подтверждения,
а так же для работы с историей изменения документов.

\subsection{Таблица сравнения документов}

\ppypictsc{brw-gbillcmp}{Таблица сравнения документов}{0.5}

Внешний вид таблицы показан на рис.~\ref{pic-brw-gbillcmp}.

Таблица содержит следующие столбцы:

\begin{description}
	\item[Товар]
	В этой колонке отображается наименование товара.
	\item[Штрихкод]
	Отображает штрихкод, соответствующий товару сравниваемой строки.
	\item[Количество]
	Группа колонок, отображающих информацию о количестве торговых единиц
	в строках сравниваемых документов и их различия.
	\begin{description}
		\item[Слева]
		Количество в левом документе.
		\item[Справа]
		Количество в правом документе.
		\item[+]
		Превышение количества в левом документе над количеством в правом.
		\item[-]
		Отрицательная разница между количеством в левом документе по сравнению с количеством в правом документе.
	\end{description}
	\item[Цена]
	Группа колонок, отображающая цены в строках сравниваемых документов и их различия.
	Для документов, где учетными ценами являются цены реализации показывается цена реализации,
	в противном случае - цена поступления.
	\begin{description}
		\item[Слева]
		Цена товара в документе слева.
		\item[Справа]
		Цена товара в документе справа.
		\item[+]
		Превышение цены в левом документе над ценой в правом.
		\item[-]
		Отрицательная разница между ценой в левом документе по сравнению с ценой в правом документе.
	\end{description}
\end{description}

\subsubsection{Действия в таблице сравнения документов}

В таблице доступны следующие функции:

\paragraph{Товар}
Открывает диалог редактирования товара, соответствующего текущей строке.

\paragraph{Положить в корзину}
Заносит в выбранную корзину товар из текущей строки. Количество, укладываемое
в корзину равно единице (естественно, в диалоге элемента корзины пользователь может
изменить это значение).

\paragraph{Положить в корзину различающиеся товары}
Заносит в выбранную корзину все строки с различающимися количествами.
Если текущей колонкой является та, в которой представлены положительные
отличия левого документа от правого (по количеству или цене), то в корзину
заносятся товары, где количество в левом документе превышает количество в правом.

В противном случае, в корзину попадают те товары, количество по которым в левом
документе меньше, чем в правом.

Количество торговых единиц, попадающих в корзину с соответствующими товарами
равно разнице между документами.

\paragraph{Печать}
Формирует отчет о сравнении документов.

Стандартная форма отчета: \ppyrsrv{GoodsBillCmp}.

\paragraph{Итог}
Открывает диалог с итоговой информацией о сравнении.

\paragraph{Фильтр}
Позволяет изменить фильтрацию отчета о сравнении документов.

\subsection{Фильтр сравнения документов}

\ppypict{dlg-f-gbillcmp}{}


\section{Учет сальдо по возвратной таре}

В процессе учета товарооборота иногда возникает проблема отслеживания отгрузок
и возвратов некоторых наименований товаров. Чаще всего речь идет о так называемой
возвратной таре.

При работе с возвратной тарой существуют следующие сложности:
\begin{itemize}
	\item Возвратная тара обычно не продается покупателю (приобретается у поставщика),
	но перемещается на условии обязательного возврата либо возмещения стоимости.
	\item Бухгалтерия предприятия чаще всего ведет учет возвратной тары на отдельных счетах.
	\item Возвратная тара является сопутствующей основному товару номенклатурной позицией.
	По этому, для оптимизации работы операторов, отвечающих за выписку документов,
	желательно, что бы система автоматически вводила тару в документ после
	внесения в него основного товара.
	\item Иногда важно отслеживать сальдо по возвратной таре в разрезе конкретных
	контрагентов с целью учета их задолженности перед вашим предприятием (либо
	задолженности вашего предприятия перед поставщиком).
	\item В контексте предыдущей проблемы возникает дополнительная: если кто-то
	из контрагентов утратил переданную ему на возвратной основе тару, необходимо
	иметь возможность компенсировать стоимость этой тары денежным платежом, но
	так, чтобы тем самым снизить количественное сальдо по соответствующему
	наименованию тары.
\end{itemize}

Теперь мы подробно разберем как каждый из перечисленных вопросов решается средствами
системы \ppybrand{}.

\subsection{Раздельный учет возвратной тары}

Здесь все достаточно просто: для того, чтобы движение тары, присутствующей в товарных
документах, велось на отдельных счетах и учитывалось отдельными суммами следует
создать тип товара, в котором определить те типы сумм
(в ценах поступления, в ценах реализации и, возможно, скидка), в которых учитывается тара
и присвоить этот тип как группе, содержащей номенклатурные позиции тары, так и
самим номенклатурным позициям (подробно типы товаров рассмотрены в специальном разделе на стр.~\pageref{sec-goodstype}).

Для того, чтобы суммы по таре правильно отражались в бухгалтерском балансе, необходимо
настроить шаблоны проводок по видам операций, в которых будет встречаться тара, с учетом
выбранных типов сумм.

\subsection{Автоматизация выписки возвратной тары}

Система предоставляет возможность быстро сформировать в товарном документе список тары,
которая сопутствует проданному (израсходованному) товару. Для этого следует использовать
так называемые частичные структуры.

В общих чертах принцип работы частичных структур состоит в том, что компоненты,
перечисленные в них, лишь дополняют товар, к которому прикреплена структура, но
не отражают его состав полностью. Подробно частичные структуры рассмотрены выше
(стр.~\pageref{sec-goodsstruc-part}).

Обратим внимание на то, что частичные структуры для описываемых здесь целей
часто можно определять как именованные. Таким образом можно избежать повторного
ввода одних и тех же структур.

Например, множество сортов разливного пива приходит от поставщика в
совершенно идентичных по типоразмеру и стоимости кегах. В таком случае нет
необходимости для каждого сорта пива создавать отдельную частичную структура.
Вместо этого создайте одну с именем, скажем, \qu{Пивной кег 30Л}, и присвойте
ее всем сортам разливного пива, которое приходит от поставщика в такой таре.

При выписке товарного документа, после того, как в него будут введены все
необходимые товары, нажмите клавишу \keyb{F9}. В ответ на это программа посчитает
все товары, к которым прикреплены частичные структуры и добавит в конец документа
строки, соответствующие сопутствующим номенклатурным позициям (если, конечно,
обнаружит такие товары).

\subsection{Отслеживание товарного сальдо по контрагентам}

Система \ppybrand{} \qu{умеет} подсчитывать товарное сальдо в разрезе пар товар-контрагент.
В целом, это - прозрачная для пользователя процедура. То есть, когда возникает необходимость
рассчитать сколько какого-то товара было отгружено покупателю и вычесть то, что от него
вернулось обратно (на заданную дату, естественно), программа это сделает.

С другой стороны, если обороты вашего предприятия по позициям, требующим
вычисления сальдо, значительны, то потребуется \qu{помочь} системе, иначе расчет
будет занимать заметное время. Помощь заключается в предварительной подготовке
специальной таблицы, хранящей остатки по парам товар-контрагент с определенной периодичностью.
Запуск этой функции выполняется из пункта меню \ppymenu{Админ\rdir Разное\rdir Расчет сальдо по товарам}.

\subsection{Компенсация утраченной тары деньгами}

\section{Печать документов}

Печать первичных документов является одной из наиболее востребованных функций
автоматизированной системы на предприятии. В связи с этим, мы выделили в отдельный раздел
описание различных аспектов настройки и использования такой печати.

\subsection{Возможности печати}

Система предоставляет возможность печати следующих типов первичных форм отчетности по
документам:

\begin{itemize}
	\item Товарная накладная
	\item Счет-фактура
	\item Товарно-транспортная накладная
	\item Список сертификатов к товарному документу
	\item Акт выполненных работ
	\item Ценники
	\item Приходный (расходный) кассовый ордер
	\item План погашения кредита
	\item Банковское платежное поручение
	\item Банковское платежное требование
\end{itemize}

Для специализированных документов реализованы такие формы:

\begin{itemize}
	\item Авансовый отчет (для специализированного документа)
	\item Доверенность (для специализированного документа)
	\item Первичные формы движения основных средств
	\item Документ о переоценке товаров
\end{itemize}

С учетом кастомизации отчетов, получается достаточно внушительный список
вариантов печати первичных документов.

В дополнение к приведенному списку, необходимо отметить следующие опции печати:
\begin{itemize}
	\item Множественная печать по товарным документам - одновременная отправка на принтер
	нескольких форм, Например, накладная, счет-фактура и список сертификатов.
	\item Массовая печать - одновременная отправка на принтер какой-либо одной формы по
	выборке документов.
\end{itemize}

В зависимости от категории документа, одна из первичных отчетных форм является основной.
Это означает, что при выборе пользователем действия \qu{Распечатать документ}, система
предполагает, что печатать надо именно основную форму (если допустимы варианты, то они
предлагаются в виде диалога.

Перечислим основные формы для различных категорий документов. После каждой категории в
этом перечислении следует краткая характеристика печатаемых форм, а далее следуют
мнемонические наименования форм, применяемых для печати (наименования отчетов).

	\paragraph{Оплата}
	Кассовый ордер
	\newline $CashRcvOrder$ $CashPayOrder$

	\paragraph{Оплата с возможностью печати счета-фактуры}
	Счет-фактура.
	Табличная часть документа включает товар для счета-фактуры на предоплату
	(см. настройки печати).
	\newline $Invoice$

	\paragraph{Пул документов}
	Список документов, находящихся в пуле либо общий документ, суммирующий
	товарные строки каждого из входящих в пул документов.

	\paragraph{Переоценка}
	Документ переоценки
	\newline $GRevalBill$ $GRevalBillP$

	\paragraph{Инвентаризация}
	Отчет об инвентаризации
	\newline $Invent$

	\paragraph{Бухгалтерский документ: подтип \ppyrsrv{Доверенность}}
	Доверенность
	\newline $Warrant$

	\paragraph{Бухгалтерский документ: подтип \ppyrsrv{Авансовый отчет}}
	Авансовый отчет
	\newline $AdvanceRep$

	\paragraph{Бухгалтерский документ с возможностью печати кассового ордера или
	с неформализованными опциями вариантов печати}
	Кассовый ордер
	\newline $CashRcvOrder$ $CashPayOrder$

	\paragraph{Бухгалтерский документ с возможностью печати счета-фактуры}
	Счет-фактура
	\newline $Invoice$

	\paragraph{Бухгалтерский документ с возможностью печати плана платежей}
	План платежей
	\newline $BillPayPlan$

	\paragraph{Модификация товаров}
	Документ модификации товаров
	\newline $GoodsBillModif$

	\paragraph{Товарный заказ}
	Товарный счет
	\newline $GoodsOrder$

	\paragraph{Приход товара или расход товара}
	Товарная накладная
	\newline $GoodsBill$ $GoodsBillVT$ $GoodsBillSuppl$ $GoodsBillVTSuppl$ $GoodsBillWpGGrp$

\subsection{Настройка печати}
%
% @todo Опции печати вида операции описаны в настройке видов операций
%
Основная масса функций настройки печати документов сосредоточена в опциях печати вида
операции, к которому относится тот или иной документ. Некоторые параметры (не зависящие
от конкретного вида операции) устанавливаются в конфигурации документов, рассмотренной
выше в этом разделе.

Для доступа к опциям печати вида операции откройте диалог редактирования требуемого вида
операции и нажмите кнопку \dlgbutton{Опции печати}. Вы увидите диалог, аналогичный
показанному на рис.~\ref{pic-dlg-096}.

Далее мы перечислим все управляющие элементы этого диалога.

\ppypict{dlg-096}{Опции печати документов}

\begin{description}
	\item[\dlgradioc{Печать цен в документе}]
	Этот блок радио-кнопок предназначен для выбора вида основной цены,
	печатаемой в накладных  по товарным документам.
	\begin{description}
		\item[\dlgradioi{Явно не определенно}]
		Если выбран этот вариант, то система самостоятельно пытается определить какие цены следует
		печатать. Мы не рекомендуем пользоваться этой опцией, поскольку это может привести к
		неопределенности (ваше мнение по поводу того, какие цены должны печататься может не совпасть
		с \qu{мнением} системы, что породит известные недоразумения).

		\item[\dlgradioi{Цены поступления}]
		При выборе этого варианта, в накладной будут печататься цены поступления.

		\item[\dlgradioi{Цены реализации}]
		При выборе этого варианта, в накладной будут печататься цены реализации.

		\item[\dlgradioi{Поступления и реализации}]
		При выборе этого варианта, будет выбрана форма накладной, в которой присутствуют колонки
		и для цен поступления и для цен реализации.
	\end{description}

	\item[Что печатать]
	Блок флажков, определяющий какие печатные формы доступны для документов
	этого вида.
	\begin{description}
		\item[\dlgflag{Сертификаты}]
		Если этот флажок установлен, то будет предложено отпечатать список сертификатов качества,
		соответствующих товарам, присутствующим в документе.

		\item[\dlgflag{Счет-фактуру}]
		Этот флажок позволяет отпечатать наряду с накладной по товарному документу также
		счет-фактуру.

		\item[\dlgflag{Кассовый ордер}]
		При установленном флажке программа предлагает наряду с накладной товарного документа
		отпечатать и кассовый ордер (приходный если товар расходуется и расходный если товар
		приходуется). Чаще всего эта опция бывает нужна тогда, когда товар продается за наличный
		расчет и покупатель одновременно с получением накладной на товар выплачивает за него
		наличные деньги.

		\item[\dlgflag{Товарно-транспортную накладную}]
		Если этот флаг установлен, то система будет предлагать печатать товарно-транспортную
		накладную.
		Так как товарно-транспортная накладная состоит из двух частей (лицевая и оборотная),
		то печать осуществляется в два приема.

		\item[\dlgflag{Кассовый чек}]
		Если вы установите эту опцию, то программа позволит печатать по документам этого вида
		кассовые чеки на фискальном регистраторе.
		Для реализации функции такой печати, кроме установки этой опции, необходимо в конфигурации
		документов установить кассовый узел, используемый для печати чеков по документам.\eor

		\item[\dlgflag{Акт выполненных работ}]
		Форма акта выполненных работ печатается на основе товарного документа, содержащего товары,
		относящиеся к типу не лимитируемых ресурсов.
		Соответственно, печатная форма будет содержать только те строки документа, которые
		относятся к таким товарам.

		\item[\dlgflag{Ценник}]
		Эту опцию следует включить для тех видов операций, по документам, соответствующих которым,
		вы хотите печатать ценники. Чаще всего это применимо к документам прихода товара (ценники
		печатаются после того, как товар оприходован на склад).

		\item[\dlgflag{План платежей}]
		Специальная форма, используемая для печати плана платежей по документу. Чаще всего она
		применяется в документах, сопутствующих выдаче кредита.
	\end{description}

	\item[Как печатать]
	Блок переключателей, определяющих некоторые особенности формирования
	первичных форм по документам.
	\begin{description}
		\item[\dlgflag{Печать без номера документа}]
		Без комментариев.

		\item[\dlgflag{Печатать колонки НДС}]
		Если установлен этот флажок, то накладная по товарному документу будет содержать колонки
		с расчетом НДС и акцизов.

		\item[\dlgflag{Товар в сертификатах}]
		Список сертификатов к товарному документу будет содержать наименования товаров к которым
		относятся сертификаты. Обычно этого не требуется если список сертификатов является
		неотъемлемой частью накладной. Однако в некоторых случаях эта опция бывает полезна.

		\item[\dlgflag{Главная организация сокращенно}]
		Без комментариев.

		\item[\dlgflag{Печать цен на выбор}]
		Этот флажок позволяет обойти жесткий выбор цен, в которых печатается товарный документ.
		Если этот флажок установлен, то перед печатью накладной будет предложено в каких ценах
		следует ее печатать.

		\item[\dlgflag{Не печатать скидку}]
		В товарных накладных обычно, если указана скидка на товар, информация об этом печатается.
		Если установить этот флажок, то, соответственно печататься она не будет.

		\item[\dlgflag{Входящая счет-фактура на предоплату}]

		\item[\dlgflag{Счет-фактура отрицательная}]

		\item[\dlgflag{Объединять идентичные позиции}]
		После установки этого флага строки товарного документа, совпадающие по определенному
		набору критериев, будут объединяться при печати.
		Критериями для объединения являются совпадения следующих атрибутов строк:
		\begin{itemize}
			\item	Товар
			\item	Емкость упаковки, соответствующая лотам, к которым привязаны строки
			\item	Сертификат, соответствующий лотам, к которым привязаны строки
		\end{itemize}

		\item[\dlgflag{Товарные строки в кассовом чеке}]
		Если по документу этого вида печатается кассовый чек на фискальном регистраторе и эта
		опция установлена, то кассовый чек будет содержать наименования товаров и соответствующие
		им количество и цену.
		В случае, если этот флаг выключен, чек будет содержать только заголовочную часть и итоговые
		значения по документу.

		\item[\dlgflag{Подставлять ExtObject вместо Object}]
		Установка этого флага приведет к тому, что в качестве контрагента по документу при печати
		будет использоваться дополнительная статья.
		Опция бывает нужна весьма редко.

		\item[\dlgflag{Печатать список штрихкодов}]
		Не используется.

		\item[\dlgflag{Печатать все сертификаты}]
		Если этот флаг включен, то список сертификатов по товарному документу будет печатать для
		каждого из товаров, входящего в документ, все сертификаты, которые привязаны к лотам,
		соответствующим этому товару и не имеющие признака \dlgflag{Пассивный}.
	\end{description}

	\item[\dlgradioc{Сортировка товарных строк}]
	Определяет порядок сортировки строк в отпечатанном товарном документе.

	\begin{description}
		\item[\dlgradioi{По умолчанию}]
		Порядок сортировки определяется местоположением строк в документе.
		\item[\dlgradioi{По товару}]
		Строки сортируются по наименованию товара.
		\item[\dlgradioi{По группе и товару}]
		Строки сортируются сначала по наименованию обыкновенной группы, которой принадлежит
		товар, а затем по наименованию товара.
		\item[\dlgradioi{По штрихкоду товара}]
		Строки сортируются по штрихкоду товара. Здесь имеется в виду один из кодов товара,
		выбираемых по правилу приоритетного штрихкода (см. раздел Товары).
		\item[\dlgradioi{По поставщику}]
		Строки сортируются по поставщику лота, которому соответствует каждая из строк.
		\item[\dlgradioi{По складу}]
		Строки сортируются по наименованию склада, соответствие с которым для каждой строки
		определяется из ассоциации товар-склад.
		\item[\dlgradioi{По месту хранения}]
		Строки сортируются по наименованию места хранения, соответствие с которым для каждой
		строки определяется из ассоциации товар-место хранения.
	\end{description}

	\item[Печатная форма]
	Вы можете определить для документов этого вида наименование основной печатной формы.
	Наименование задается как имя файла отчета без каталога и расширения. Например: если
	вы хотите, чтобы накладная по документам этого вида печаталась по форме, заданной в
	файле MyInvoiceForm.rpt, то укажите в этом поле MyInvoiceForm.
\end{description}

\subsection{Использование печати документов}

\subsubsection{Печать товарных документов}

\ppypict{dlg-097}{Что печатать?}

Отпечатать товарный документ можно, нажав клавишу \keyb{F7} в таблице документов либо
выбрав соответствующую команду в панели инструментов этой таблицы.
Как правило, после этого на экране появляется диалог, показанный на рисунке.
Здесь можно выбрать печатаемую форму документа. Формы, для которых не установлено
соответствие в опциях печати вида операции, не доступны для выбора.
Поля \qu{Организация} и \qu{Склад} - информационные. Они показывают текущую главную
организацию и текущий склад. Эта информация может быть важна, если на вашем предприятии
практикуется печать документов от разных юридических лиц.

\subsubsection{Одновременная отправка на принтер нескольких форм по одному документу}

Если в конфигурации документов установлен флаг \dlgflag{Разрешить множественную печать для
товарных документов}, то диалог, предваряющий печать, будет выглядеть несколько иначе:
вместо переключателя вида печатной формы будет присутствовать блок флагов, позволяющий
одновременно задать несколько форм.

Если вы выберите несколько форм и нажмете кнопку \dlgbutton{ОК}, то выбранные формы
сразу будут отправлены на принтер. Если же вы выберите только одну форму, то далее
процесс печати будет протекать по обычному сценарию: стандартный
диалог печати и действие, соответствующее вашему выбору.

Обратим внимание на то, что при выборе нескольких форм, невозможны предварительный просмотр,
экспорт и другие функции, доступные при стандартном сценарии печати.

\subsubsection{Печать первичных форм по выборке документов}

Еще одна специализированная функция системы позволяет отправить на печать одну из первичных
форм по всей выборке документов. Для того, что бы воспользоваться этой функцией, нажмите
\keyb{Ctrl-S} в таблице документов. При этом на экране появится диалог, предлагающий выбрать
вид формы. После выбора одной или нескольких форм и нажатия кнопки \dlgbutton{ОК}, первичные
формы по всей выборке документов будут отправлены на принтер.

\ppynote{
	Еще раз обратим ваше внимание, что система сразу отправляет данные на принтер по всей
	выборке документов, соответствующих текущему фильтру. Если вы ошибетесь в критериях
	выборки, то рискуете получить гору макулатуры. По этому, будьте внимательны.
}

\chapter{Книги продаж и покупок\label{ch-vatledger}}

\section{Что такое книги продаж и покупок}

Книги продаж и покупок - это форма отчетности, необходимая для предъявления в налоговые
органы с целью определения суммы НДС к уплате и к зачету.
Система Papyrus предоставляет возможность формировать книги продаж и покупок как в
автоматическом режиме, так и вручную.

Запись книги продаж (покупок), сделанная вручную, называются \ppyterm{несвязанной}.
Запись, занесенная автоматически и привязанная к какому-либо документу в этой же базе данных,
называется \ppyterm{связанной}.

Кроме того, записи, созданные автоматически, могут быть изменены вручную. При этом, чтобы
в дальнейшем система автоматически не изменила эту запись, она может быть зафиксирована.
Такую запись мы будем называть \ppyterm{фиксированной}.

\section{Записи книги продаж}

\ppypict{dlg-vatbook-sell}{Запись в книге продаж}

Вид диалога записи книги продаж показан на рис.~\ref{pic-dlg-vatbook-sell}.
Вот описание значений полей в этой записи:

\begin{description}
	\item[Дата]
	Дата выставления счета-фактуры на отгрузку покупателю товара или предоставление услуги.

	\item[Дата оплаты]
	Дата оплаты покупателем отгруженного товара или предоставленной услуги.

	\item[Номер]
	Номер счета-фактуры, которой соответствует данная запись книги продаж.

	\item[\dlgcombo{Покупатель}]
	Аналитическая статья покупателя, которому был отгружен товар или предоставлена услуга.

	\item[\dlgcombo{Склад}]
	Склад, к которому относится данная запись. Если запись сформирована автоматически
	на основании документа, то это поле получает значение склада, к которому
	относится тот документ.

	\item[Код налоговой операции]
	Код, идентифицирующий тип операции по классификации ФНС России. Если в этом поле код
	не определен, то система, при выгрузке электронной формы книги самостоятельно пытается определить
	этот код.

	\item[Общая сумма]
	Общая сумма счета-фактуры, которой соответствует данная запись (это поле не может быть
	заполнено непосредственно - оно рассчитывается по значениям сумм, облагаемых НДС).

	\item[Сумма без НДС]
	Несколько полей, в которых вводятся суммы (без НДС) счета-фактуры, облагаемые
	соответствующими ставками НДС.

	\item[Сумма НДС]
	Сумма НДС, соответствующая указанным слева ставке и сумме облагаемой базы.

	\item[\dlgflag{Фиксировать}]
	Этот флаг имеет смысл для связанных записей. Его установка запрещает программе изменять
	эту запись даже если соответствующий ей документ изменился. Это возможность требуется
	весьма редко.

	\item[\dlgflag{Исключить}]
	Признак, позволяющий сделать запись невидимой при просмотре и печати книги продаж.
	Этим флагом можно воспользоваться тогда, когда программа автоматически формирует запись
	по документу, которую не следует включать в окончательный вариант книги продаж.

	\item[\dlgbutton{Связанный документ}]
	Позволяет просмотреть документ, которому соответствует данная запись книги продаж.
\end{description}

\section{Записи книги покупок}

\ppypict{dlg-vatbook-buy}{Запись в книге покупок}

Запись книги покупок в основном аналогична записи книги продаж. Диалог показан на рис.~\ref{pic-dlg-vatbook-buy}.
В следующей таблице мы опишем лишь отличительные поля записи книги покупок.

\begin{description}
	\item[Дата поступления счета-фактуры]
	Дата, которая проставлена на счете-фактуре, соответствующей  приходу товара или
	предоставленной услуге.

	\item[Дата оплаты счета-фактуры]
	Дата перечисления платежа по счету-фактуре.

	\item[Дата поступления товара]
	Дата фактического прихода товара на склад или предоставления услуги.

	\item[\dlgflag{Свободно от НДС}]
	Этот признак выставляется на записи, соответствующие счетам фактурам, поступившим от
	поставщиков освобожденных от НДС.
\end{description}

\section{Таблица книги}

Для доступа к таблице книг продаж (покупок) следует выбрать пункт меню
\ppymenu{Операции\rdir Книга продаж/покупок}.

\subsection{Фильтр книги}

\ppypict{dlg-f-006}{Фильтр по книге продаж/покупок}

Показанный на рис.~\ref{pic-dlg-f-006} фильтр книги продаж (покупок) содержит следующие элементы:

\begin{description}
	\item[Переключатель типа книги]
	Переключатель, с помощью которого выбирается с какой именно книгой вы собираетесь работать.

	\item[Период]
	Период, в который должны попадать просматриваемые записи.

	\item[\dlgflag{По дате оплаты}]
	Если этот признак установлен, то под периодом, подразумевается период, в который
	должна попасть дата оплаты счета-фактуры, в противном случае программа будет считать,
	что введен период даты отгрузки.

	\item[\dlgcombo{Контрагент}]
	В этом поле может быть указан контрагент. В этом случае программа покажет только те
	записи книги продаж (покупок), которые относятся к этому контрагенту.

	\item[\dlgradioi{Связанные и несвязанные}]
	Смысл этого переключателя очевиден: \dlgradioi{только связанные} означает, что следует показывать
	только автоматически сформированные записи, \dlgradioi{только несвязанные} - показывать только записи,
	сделанные вручную. Первое значение переключателя позволяет игнорировать признак
	связанности.

	\item[\dlgcombo{Таблица статей дополнительно объекта}]
	Если вы собираетесь фильтровать записи книги по дополнительному объекту (см. следующее поле),
	то вам необходимо выбрать таблицу аналитических статей, которой должна соответствовать
	выбираемая вами фильтрующая дополнительная статья.

	Необходимость этого выбора обусловлена тем, что в книгу могут попадать записи из
	документов, в которых дополнительные статьи (если определены) могут принадлежать
	разным таблицам.

	\item[\dlgcombo{Дополнительный объект}]
	Этот комбо-бокс доступен только в том случае, если определено значение в
	\dlgcombo{Таблица статей дополнительно объекта} (см. выше).

	Выбранная здесь статья будет рассматриваться системой как ограничение,
	предписывающее выводить только те записи, в которым дополнительной
	статьей является выбранная здесь.

	\item[\dlgflag{Только с пустым доп. объектом}]
	Данный флаг коррелирует с двумя комбо-боксами, описанными выше. При включении
	этого флага в выборку, показанную в отчете попадут только те записи,
	в которых не определена дополнительная аналитическая статья.

	\item[\dlgflag{Показывать исключенные записи}]
	Некоторые записи книги продаж (покупок) могут иметь признак \dlgflag{Исключить}. Это означает,
	что запись в обычном режиме не видна и не печатается. Данный флаг позволяет переопределить
	это правило.
\end{description}

\ppypict{brw-012}{Таблица книги продаж}

Типичный вид таблицы книги показан на рис.~\ref{pic-brw-012}.

\subsection{Действия в таблице книги}

В таблице книги продаж (покупок) доступны следующие действия:

\paragraph{Редактировать}\indent\keyb{Enter}
Вызывает диалог редактирования выбранной записи книги.

\paragraph{Добавить строку}\indent\keyb{Insert}
Создает новую (несвязанную) запись. При этом на экране появляется диалог
редактирования новой записи, в котором поле даты инициализировано
текущей операционной датой, а остальные поля пустые.

\paragraph{Добавить по образцу}\indent\keyb{Alt-F2}
Создает новую запись по образцу выбранной.
Если запись, использованная в качестве образца была связана
с каким-либо документом, то и новая запись получит ссылку на тот же документа.

\paragraph{Удалить строку}\indent\keyb{Delete}
Удаляет (после подтверждения) текущую запись.

\paragraph{Удалить все строки по фильтру}\indent\keyb{Ctrl-F8}
Удаляет все записи, удовлетворяющие текущему фильтру.
Перед удалением появляется строгое предупреждение.

\paragraph{Экспорт}\indent\keyb{Ctrl-R}
Функция экспортирует книгу продаж или покупок в унифицированном формате XML, пригодном для отправки в
налоговую инспекцию Российской Федерации.

Формат файла полностью соответствует требованиям. Для того, чтобы были правильно  сформированы имена
файлов необходимо в записи персоналии, соответствующей главной организации, установить зарезервированный тег \qu{Идент получателя эл налоговых документов}
в значение кода налоговой инспекции, к ведению которой относится ваше предприятие.

О зарезервированных тегах см. стр.~\pageref{reservedobj-teg}.

\paragraph{Печать}\indent\keyb{F7}
Распечатать записи книги продаж (покупок) по фильтру.

\paragraph{Обновить}\indent\keyb{F8}
Эта функция позволяет автоматически сформировать записи книги
на основе конфигурации.

\paragraph{Итог}\indent\keyb{F9}
Показать итоговые значения выборки книги.

\paragraph{Фильтр}\indent\keyb{Ctrl-V}
Позволяет изменить условия фильтрации текущей таблицы.

\section{Конфигурация книги продаж (покупок)}

\ppypict{dlg-019}{Конфигурация книги продаж}

Для того, чтобы книга продаж (покупок) заполнялась автоматически необходимо
предварительно определить конфигурацию этой книги.

Конфигурация книги заключается в задании списка видов операций, в
соответствии с которыми программе следует заносить связанные записи в книгу,
а так же в определении некоторых опций заполнения.

Для доступа к опциям конфигурации следует выбрать пункт меню \ppymenu{Админ\rdir Прочие конфигурации\rdir Конфигурация книги продаж}
или \ppymenu{Админ\rdir Прочие конфигурации\rdir Конфигурация книги покупок}.

Диалог конфигурации выглядит так, как показано на рис.~\ref{pic-dlg-019}.

\begin{description}
	\item[\dlgcombo{Таблица статей}]
	В этом комбо-боксе указывается таблица аналитических статей, в которой находится
	большинство контрагентов по книге. При ручном добавлении записей в книгу, а также
	при отборе записей по фильтру, именно по этой таблице аналитических статей ведется
	выбор контрагента. При этом в списке операций могут содержаться операции, контрагенты
	которых относятся к другим таблицам аналитических статей.

	\item[Виды операций]
	Список видов операций, в соответствии с которым заполняется книга. Каждый элемент списка
	содержит собственно вид операции и дополнительные признаки:

	\begin{itemize}
		\item 	Исключенная операция - признак, предписывающий программе пропускать документы этой
	операции при заполнении книги. Установка этого признака может понадобиться в том случае,
	когда выбрана система учета \qu{По оплате} и какая-либо операция оплаты не должна быть
	включена в книгу.
		\item 	Отрицательная запись - признак, предписывающий программе изменять знак сумм записи
	книги для выбранной операции. Такая возможность может понадобиться, например, для
	формирования сторнирующих записей.
	\end{itemize}

	\item[\dlgradioc{Система учета}]
	Исключительно важный параметр, указывающий программе каким образом заполнять книгу. Если
	выбрана система учета по отгрузке, то в книгу добавляются записи, соответствующие
	документам, принадлежащих непосредственно тем операциям, которые перечислены в выше
	обозначенном списке.

	Если выбрана система учета \dlgradioi{По оплате}, то программа просматривает оплаты по документам,
	принадлежащим операциям перечисленным в списке. В случае если операция не имеет признака
	\dlgflag{Требует платежного документа}, то в книгу заносятся документы, соответствующие ей
	непосредственно.

	Система учета \dlgradioi{По отгрузке} проще. Если выбрана она, то в книгу попадают все документы по
	перечисленным в списке операциям (кроме тех, для которых установлен признак \dlgflag{Исключенная операция}).

	Система учета \dlgradioi{По умолчанию} предписывает программе использовать систему учета, прописанную
	в общих конфигурациях системы. Вообще говоря, не следует полагаться на эту опцию,
	правильнее выбрать конкретно либо \dlgradioi{По оплате} либо \dlgradioi{По отгрузке}.

	\item[\dlgradioc{Дата записи}]
	Переключатель, позволяющий задать правило формирования даты записи книги
	при автоматическом заполнении ее записей.

	Необходимость этого переключателя обусловлена различными толкованиями
	правила установки титульной даты записи книги продаж/покупок в случае,
	если дата счета-фактуры отличается от даты документа.

	Если в документе дата счета-фактуры не задана, либо не отличается от
	даты документа, то положение этого переключателя никак не скажется на
	записи книги, сформированной по этому документу. В противном случае
	вы можете задать один из следующих вариантов:
	\begin{description}
		\item[\dlgradioi{Основная дата документа}] Титульной датой записи всегда
		будет основная дата документа.
		\item[\dlgradioi{Дата счета-фактуры}] Если для документа определена дата
		счета-фактуры, то она будет титульной датой записи, соответствующей
		этому документу.
		\item[\dlgradioi{Наибольшая из двух}] Если дата счета фактуры позже, чем основная %
		дата документа, то титульной датой будет дата счета-фактуры, в противном
		случае - основная дата документа.
	\end{description}

	\item[\dlgradioc{Система учета на период}]
	Специальная опция, позволяющая решить проблему перехода с одной системы
	формирования книг на другую (например, если до конца предыдущего года вы
	формировали книгу по оплате, а с начала текущего - по отгрузке).

	При возникновении описанной ситуации, установить период, в течении которого
	действовала старая система учета и саму эту систему.

	\item[\dlgflag{Не сторнировать зачеты}]

	\item[\dlgflag{Книгу покупок печатать с ГТД}]
	По правилам ведения книг покупок (введенных с начала 2001 года) в графе \qu{Страна
	происхождения и ГТД} должны быть перечислены все присутствующие в счете-фактуре
	страны происхождения товаров и номера грузовых таможенных деклараций (ГТД). При
	установке этого флага система будет заполнять эту графу в соответствии с правилами,
	иначе графа будет оставаться пустой.
\end{description}

%\begin{Verbatim}[fontfamily=courier, fontsize=\small, frame=single]
%\end{Verbatim}

% \chapter{}
% \section{}
% \subsection{}
% \subsubsection{}
% \paragraph{}
% \subparagraph{}
%
%	\indent\keyb{
%
%
%\ppypict{brw-}{}
%
%
%
%~\ref{pic-dlg-009}
%
%
%\newline
%
% Длина строки - до 90 символов
% 1. Расставляем заголовки
% 2. Приводим в порядок списки
% 3. Замечания \ppynote{}
%    Замечание в таблице \ppynotewidth{0.6}{}
% 4. Примеры: \ppyexample{}
%    Пример с заголовком: \ppyexampletitle{заголовок примера}{}
% 5. Таблица описания диалогов и т.д. (2 колонки)
%    \begin{ppytable2} \end{ppytable2}
%			текст-колонки-1 &
%    	текст-колонки-2 \eor
%
%    	текст-колонки-1 &
%    	текст-колонки-2 %\eor
% 6. Таблица описания действий в КАД'ах (3 колонки. средняя - коды клавишь)
%    \begin{ppytable-cda-act} \end{ppytable-cda-act}
%    	текст-колонки-1 & код клавиши &
%    	текст-колонки-3 \eor
%
%    	текст-колонки-1 & код клавиши &
%    	текст-колонки-3 \eor  %
%
%
% 7. Установка символьных стилей:
%     Papyrus - \ppybrand{}
%     Клавиши - \keyb{}
%     Кнопки - \dlgbutton{}
%     Пункт меню - \ppymenu{Админ\rdir Процие конфигурации}
%     Кавычки - \qu{}
%			флаг - 	\dlgflag{
%     Слово "броузер" заменяем на "таблица"
%

\chapter{Основные средства\label{ch-assets}}

Учет основных средств в системе \ppybrand{} организован на базе товарных и бухгалтерских
операций.

Главными особенностями, выделяющими операции по основным средствам среди других товарных
операций, являются следующие:

\begin{itemize}
	\item Основные средства приходуются как правило по одной единице. Это обусловлено
	необходимостью раздельного учета каждой единицы основных средств (в том числе и
	посредством присвоения уникального инвентарного номера).
	\item Учетные цены операций с основными средствами трактуются иначе, чем в
	случае обыкновенных товарных операций.

	Именно, учетная цена поступления имеет смысл первоначальной стоимости объекта основных средств.

	Учетная цена реализации лота, относящегося к основному средству представляет
	остаточную стоимость объекта.
	\item Номенклатурные позиции, определяющие объекты основных средств, должны принадлежать
	товарному типу, имеющему признак \dlgflag{Основные фонды} (см. стр.~\pageref{sec-goodstype}).

	Операции по таким номенклатурным позициям учитываются и обрабатываются отчетами
	специальным образом.
\end{itemize}

\section{Настройка системы для работы с основными средствами}

Для правильного использования модуля основных средств необходимо произвести ряд настроек.
Эти настройки включают как специфичные для данного модуля действия, так
и общие, свойственные другим функциям системы.

\subsection{Настройка конфигурации}

\subsubsection{Создание группы основных средств}

Создайте товарную группу-папку, в которой будут формироваться остальные товарные группы
основных средств. И выберите эту группу в комбо-боксе \dlgcombo{Группа основных средств}
в конфигурации справочника товаров (см. стр.~\pageref{sec-goods-cfg}).

\subsubsection{Создание нумерации инвентарных номеров}

Каждый объект основных средств может иметь собственный инвентарный номер (аналог серийного
номера лота). Если вы хотите, чтобы система автоматически назначала новым объектам
основных средств инвентарные номера, то в конфигурации документов (стр.~\pageref{sec-bill-cfg}) установите
шаблон генерации инвентарного номера.

Если вы включите флаг \dlgflag{Автоматически генерировать серийный номер} в этой
конфигурации, то при вводе новой строки документа поступления основных средств
серийный номер будет создаваться по заданному шаблону автоматически. В противном
случае, пользователю придется нажать клавишу \keyb{F2} в поле инвентарного номера.

\subsection{Настройка видов операций}

\subsection{Группы списания основных средств}

\section{Операции с основными средствами}

\section{Амортизация основных средств}

\section{Отчет по основным средствам}

Отчет по основным средствам отображает информацию об основных средствах
предприятия и их суммовые характеристики в привязке к заданным периодам.

Вот основные показатели, выводимые в отчете:

\begin{itemize}
	\item Наименование объекта основных средств
	\item Инвентарные номер
	\item Дата поступления %
	\item Дата ввода в эксплуатацию
	\item Срок списания %
	\item Первоначальная стоимость
	\item Остаточная стоимость
	\item Сумма амортизации
\end{itemize}

Если фильтр отчета задает операционный период, то в дополнение к перечисленным
показателям, система выводит в отчете суммовые значения изменений в балансовой
стоимости и амортизации за операционный период, а также соответствующие значения на
начало операционного периода.

Для вызова отчета обратитесь к пункту меню \ppymenu{Отчетность\rdir Основные средства}.

\subsection{Фильтр отчета по основным средства}

\ppypict{dlg-f-assets}{Фильтр отчета по основным средствам}

Вид фильтра по основным средствам приведен на рис.~\ref{pic-dlg-f-assets}. Опишем
управляющие элементы этого диалога:

\begin{description}
	\item[Период поступления] Ограничивает отчет теми объектами основных средств, которые
	поступили на предприятие в указанный период.

	\item[Операционный период] Если этот период задан, то отчет будет содержать
	показатели изменения балансовой стоимости и начисленной амортизации в течении
	операционного периода.

	\item[\dlgcombo{Склад}] Ограничивает выборку только теми объектами основных
	средств, которые находятся (или последний раз находились до списания) на
	выбранном складе.

	\item[\dlgcombo{Группа}] Товарная группа, которой должны принадлежать
	выводимые в отчете объекты основных средств.

	По умолчанию в этом комбо-боксе система устанавливает товарную
	группу, определенную как группа основных средств в конфигурации
	справочника товаров (см. стр.~\pageref{sec-goods-cfg}).

	\item[Переключатель фильтрации по признаку списания] Данный блок
	радио-кнопок предоставляет возможность ограничить отчет только
	теми объектами основных средств, которые соответствуют одному из
	следующих вариантов:
	\begin{description}
		\item[\dlgradioi{Только не списанные}] Отображает объекты, которые
		еще не полностью амортизированы.
		\item[\dlgradioi{Списанные и не списанные}] Отображает объекты,
		независимо от того были они полностью амортизированы или нет.
		\item[\dlgradioi{Только списанные}] В отчет попадут только те
		объекты основных средств, которые были полностью амортизированы.
	\end{description}

	\item[Переключатель фильтрации по признаку ввода в эксплуатацию]
	Этот блок радио-кнопок позволяет отфильтровать отчет по признаку
	ввода объекта основных средств в эксплуатацию.

	В случае, если в фильтре определен операционный период, то при
	проверке признака ввода в эксплуатацию учитывается принадлежность
	даты ввода в эксплуатацию операционному периоду.

	Так, если переключатель требует отображать только объекты, введенные
	в эксплуатацию, и задан операционный период, то объект, введенный в
	эксплуатацию до или после операционного периода не попадет в отчет.

	\begin{description}
		\item[\dlgradioi{Не зависимо от ввода в эксплуатацию}] Отображает объекты, независимо
		от того, введены они в эксплуатацию или нет.
		\item[\dlgradioi{Только введенные в эксплуатацию}] Отображает только те объекты,
		которые были введены в эксплуатацию.
		\item[\dlgradioi{Только не введенные в эксплуатацию}] В отчет попадут только те
		объекты основных средств, которые не были введены в эксплуатацию.
	\end{description}

	\item[\dlgflag{Показывать закрытые}] Если этот флаг включен, то в отчет попадут
	объекты основных средств, которые выбыли из учета (например, были проданы либо
	списаны в потери).
\end{description}

\chapter{Рента\label{ch-rent}}

Понятие ренты в системе \ppybrand{} используется для определения и учета регулярных платежей.
Такие платежи могут быть как фиксированного размера (собственно, рента, коммунальные платежи,
страховые выплаты и т.д.), так и процентными. Процентная рента используется для учета платежей
по выданным и полученным кредитам.

\section{Правила начисления процентов}

В системе используется следующие правила расчета начисления процентных выплат:
\begin{itemize}
	\item	В году 360 дней. Это правило важно не только при расчете процентной ставки, но и
	при вычислении периода начисления в днях.
	\item	Процентная ставка указывается как простая годовая
	\item	При вычислении периода начисления дата изменения суммы кредита учитывается, а дата
	начисления не учитывается. Например, если кредит взят 1 июня, а полное погашение состоялось
	1 июля, то начисление рассчитывается за 30 дней (если бы дата гашения/начисления учитывалась,
	то начисление рассчитывалось бы за 31 день)
	\item	Каждая выплата (и положительная и отрицательная) по основной сумме кредита учитывается
	при начислении процентных платежей.
	\item	Начисление процентной ренты можно настроить так, чтобы сумма процентов
	прибавлялась к сумме основного долга. В этом случае вы получите \qu{сложное} начисление
	процентов, то есть, с течением времени проценты будут начисляться на проценты.
\end{itemize}

\ppyexampletitle{Пример расчета процентных выплат:}{
1 июня взят кредит в сумме 12000 рублей с процентными обязательствами в размере 12\% годовых.
С 1 июня до 30 июня никакого движения по кредитному счету не было (исключая первоначальную
выдачу кредита).
30 июня того же года производится начисление процентов.
Количество дней - 29 (день начисления не учитывается)
Процентная ставка за день - 0,12/360=0,0003333
Сумма, на которую осуществляется начисление - 12000 руб
Итого - 12000 * 0,12/360 * 29 = 116 руб
}

\chapter{Инвентаризация\label{ch-inventory}}

Инвентаризация в системе \ppybrand{} представляет собой специальную разновидность документа,
отражающего факт подсчета и сверки остатков товаров на складе.
Инвентаризация может быть использована в следующих целях:
\begin{itemize}
 	\item	Первоначальное занесение товарных остатков при запуске системы на предприятии
	\item	Периодическая полная ревизия остатков для выявления недостач и ошибок учета
	\item	Периодический или регулярный частичный подсчет остатков (обычно с использованием
	электронных инвентарных терминалов) для поддержки полноты и точности учета, а также
	своевременного обнаружения недостач
	\item	Регулярный подсчет остатков на складе для учета продаж за период, прошедший после
	предыдущей такой инвентаризации.
\end{itemize}
Перед тем как приступить к подробному описанию, определим несколько терминов, используемых
применительно к инвентаризации.

	\paragraph{Учетный остаток}
	Остаток товара на момент инвентаризации по данным учета.

	\paragraph{Фактический остаток}
	Остаток товара на момент инвентаризации по данным подсчета.

	\paragraph{Учетная цена}
	Цена товара на момент инвентаризации по данным учета.

	\paragraph{Инвентарная цена}
	При вводе инвентаризации с каждым товаром связывается некоторое значение
	цены. Система автоматически подставляет учетную цену, однако пользователь
	может установить иное значение. Таким образом, инвентарная цена - это цена
	сопоставленная с товаром в документе инвентаризации.

	\paragraph{Цена списания}
	Средняя цена, по которой проведено списание товара в документе инвентаризации.
	Это понятие необходимо для того, чтобы отразить отличие суммы фактического
	списания от цены, с которой товарная позиция фигурирует в строке инвентаризации,
	а так же, возможно, и от учетной цены этого товара.

	Отличие это возникает из-за того, что товар на остатке может присутствовать в
	виде нескольких лотов, цена по которым различна. При списании инвентаризации
	(главным образом, речь идет о списании недостач) может быть уменьшен остаток
	по лотам с разной ценой. В итоге сумма списания может отличаться и от суммы
	в терминах учетной цены, и от суммы в терминах инвентарной цены.

	Цена списания получается делением суммы списания на списанное количество.

	\paragraph{Рассогласование}
	Разница между фактическим и учетными остатками. Отрицательное рассогласование означает
	недостачу, положительное - излишек.

	\paragraph{Списание инвентаризации}
	Преобразование документа инвентаризации в товарные документы, отражающие рассогласования
	инвентаризации.

	\paragraph{Остаток по умолчанию}
	Фактический остаток товара, принимаемый при списании инвентаризации в том случае, если
	документ инвентаризации не содержит строки, указывающей остаток этого товара.


\section{Инвентаризация как документ\label{sec-invasdoc}}

Являясь документом, инвентаризация несет в себе множество черт, роднящих ее с обычными
товарными операциями. Соответственно, работа с инвентаризацией очень похожа на работу с
товарными документами.

Однако, отличает инвентаризацию от других товарных документов то, что она сама по себе не
влечет за собой изменение в состоянии складских запасов. Она лишь декларирует факт
соответствия или несоответствия учетных остатков фактическим. Именно это является главной
причиной всех специфических особенностей инвентаризации по сравнению с другими документами.

Документ инвентаризации состоит из заголовка и строк. Заголовок содержит обычные для любого
документа вид операции, номер документа, дату, склад, по которому проводится инвентаризация,
сумму и примечание. Строки инвентаризации содержат ссылку на товар, емкость упаковки,
фактическое количество товара, учетное количество, фактическую цену и учетную цену.
Может существовать несколько видов операций инвентаризации, каждая из которых принадлежит
зарезервированному типу операций \ppyrsrv{Инвентаризация}. Эти виды операций могут иметь
различные варианты параметров настройки. Перечислим и охарактеризуем основные параметры
видов операций инвентаризации.

	\paragraph{Вид операции списания недостач}
	Тот вид товарной операции, который будет использован при списании недостач, выявленных в ходе
	инвентаризации. Этот вид операции принадлежит типу \ppyrsrv{Расход товара}.

	\paragraph{Контрагент операции списания недостач}
	Этот необязательный параметр может быть использован для указания контрагента при списании
	недостач.

	\paragraph{Вид операции списания излишков}
	Вид товарной операции, который будет использован при списании излишков, выявленных в ходе
	инвентаризации. Этот вид операции принадлежит типу \ppyrsrv{Приход товара}.

	\paragraph{Контрагент операции списания излишков}
	Необязательный параметр, который может быть использован для указания контрагента при списании
	излишков.

	\paragraph{Номинальная сумма инвентаризации}
	Либо сумма в ценах поступления, либо в ценах реализации. Значение этого параметра зависит
	от того, в каких ценах ведется учет на вашем предприятии.

	\paragraph{Остаток товара по умолчанию}
	Этот параметр может принимать одно из двух значений: остаток по умолчанию равен нулю,
	либо остаток по умолчанию равен учетному.
	В первом случае, если в документе инвентаризации нет строки, соответствующей некоторому
	товару, то при списании инвентаризации будет считаться, что этого товара просто нет в наличии.
	Во втором случае, если документ инвентаризации не содержит строки, соответствующей некоторому
	товару, то остаток этого товара полагается равным учетному.

	\paragraph{Учетная цена товара}
	Так как инвентаризационный документ может содержать не более одной строки для одного товара,
	то возникает вопрос в определении учетной цены товара, если по этому товару существует
	несколько лотов.

	Этот параметр как раз и уточняет способ разрешения этого вопроса. Допускается три различных
	значения этого параметра: по последнему лоту (LIFO), по первому лоту (FIFO), и по среднему
	значению.

\section{Настройка операций инвентаризации}

\ppypict{dlg-op-inventory}{Вид операции (Инвентаризация)}

Как уже говорилось, документ инвентаризации имеет вид операции, принадлежащий типу
\ppyrsrv{Инвентаризация}. В системе могут быть определены один или более таких видов операций.

Вид заголовочного диалога редактирования вида операции инвентаризации приведен на
рис.~\ref{pic-dlg-op-inventory}.

В этом диалоге присутствуют базовые для вида операции атрибуты:
\begin{description}
	\item[Наименование]
	Наименование вида операции. Уникальная строка длиной не более 47 символов.

	\item[Символ]
	Уникальный среди всех видов операций текстовый символ, используемый
	для ссылки на этот вид операции из внешних приложений.
	Может быть пустым. Длина не более 19 символов.

	\item[ИД]
	Справочное поле со значением идентификатора вида операции.

	\item[\dlgcombo{Тип операции}]
	Недоступное для изменения поле с наименованием типа операции.
	Для обсуждаемого диалога здесь всегда будет \ppyrsrv{Инвентаризация}.

	\item[\dlgcombo{Таблица объектов}]
	Таблица аналитических статей, ассоциированная с документами этого
	вида операции.

	Чаще всего документы инвентаризации не имеют таблицы статей, но
	не всегда (например, здесь можно выбрать таблицу материально-ответственных лиц).

	\item[\dlgcombo{Доп таблица объектов}]

	\item[Уровень доступа]
	Не используется.

	\item[Счетчик операций]
	Два управляющих элемента, позволяющих определить нумерацию документов
	инвентаризации, относящихся к данному виду. Подробно счетчики операций рассмотрены
	на стр.~\pageref{sec-opcounter}.

	\item[\dlgbutton{Опции...}]
	Эта кнопка открывает диалог редактирования опций инвентаризации, подробно описанный ниже.
\end{description}

\subsection{Опции операции инвентаризации}

\ppypict{dlg-op-inventoryoptions}{Операция инвентаризации}

Диалог редактирования опций операции инвентаризации показан на рис.~\ref{pic-dlg-op-inventoryoptions}.
Далее перечислим управляющие элементы этого диалога.

\begin{description}
	\item[Списание недостач]
	Блок управляющих элементов, ответственных за формирование документа списание
	недостач по инвентаризации.
	\begin{description}
		\item[\dlgcombo{Вид операции}]
		Вид операции, который будет использован для создания документов списания недостач.
		Этот вид операции обязательно должен относиться к типу \ppyrsrv{Расход товара}.

		\item[\dlgcombo{Контрагент}]
		Если с выбранным видом операции списания недостач ассоциирована таблица
		аналитических статей, то здесь можно (и, вероятно, следует) выбрать
		контрагента, который будет привязан к документу списания.
	\end{description}

	\item[Списание излишков]
	Блок управляющих элементов, ответственных за формирование документа списание
	излишков по инвентаризации.
	\begin{description}
		\item[\dlgcombo{Вид операции}]
		Вид операции, который будет использован для создания документов списания излишков.
		Этот вид операции обязательно должен относиться к типу \ppyrsrv{Приход товара}.
		\item[\dlgcombo{Контрагент}]
		Если с выбранным видом операции списания излишков ассоциирована таблица
		аналитических статей, то здесь следует выбрать
		контрагента, который будет привязан к документу списания.

		Обратите внимание на то, что, в отличии от операции списания недостач,
		здесь в большинстве случаев следует указывать контрагента по той причине,
		что сформированные излишки создают лоты, которые должны иметь привязку к
		поставщику.
	\end{description}

	\item[\dlgradioc{Способ автозаполнения}]
	Определяет особенности автоматического заполнения документа инвентаризации.
	Эти варианты могут быть переопределены при непосредственном вызове функции автозаполнения.

		\begin{description}
			\item[\dlgradioi{Товары с ненулевым остатком}]

			\item[\dlgradioi{Все товары}]

			\item[\dlgradioi{Из предыдущей ревизии}]

		\end{description}
	\item[\dlgradioc{Учет цен товаров}]
	Определяет правило извлечения учетной цены.
		\begin{description}
			\item[\dlgradioi{По последнему лоту}]
			Цена будет браться из последнего лота товара на дату инвентаризации.
			\item[\dlgradioi{По первому лоту}]
			Цена будет браться из первого лота товара на дату инвентаризации.
			\item[\dlgradioi{По среднему}]
			Цена будет рассчитываться как средневзвешенное значение по всем открытым
			лотам.
		\end{description}

	\item[\dlgflag{В ценах поступления}]
	Важный флаг, оказывающий значительное влияние на результат инвентаризации.

	Если этот флаг установлен, то программа считает учетными ценами товаров цены
	поступления. В противном случае - цены реализации.

	\item[\dlgflag{Нулевой остаток по умолчанию}]
	Важный флаг, оказывающий значительное влияние на результат инвентаризации.

	Если флаг установлен, то система считает, что все товары, которые отсутствуют
	в документе, отсутствуют и на остатке. Таким образом, если вы не внесли
	какую-то товарную позицию в документ, весь учетный остаток по ней будет
	списан в потери.

	Если же флаг выключен, то остатки товаров, которые явно не перечислены в
	строках документа будут считаться равными учетным.

	Флаг следует включать тогда, когда вы проводите тотальную инвентаризацию
	склада. Если же проводится частичная инвентаризация по ограниченному набору
	наименований товаров, то флаг должен быть выключен (но вы должны явно указать
	остаток по каждой обследуемой позиции, даже если остаток по ней нулевой).

	\item[\dlgflag{Списание без скидки}]
	Устаревший флаг. Не влияет не результат списания.

	\item[\dlgflag{Использовать параметры упаковки}]
	Сервисный флаг, влияющий только на интерфейс ввода данных.

	Если флаг установлен, то при ручном вводе строки инвентаризации после
	выбора товара курсор будет переходить на поле ввода емкости упаковки.
	В противном случае - на поле ввода количества.

	\item[\dlgflag{Выбор товара по наименованию}]
	Сервисный флаг, влияющий только на интерфейс ввода данных.

	При включенном флаге окно списка подбора товаров отображает
	полные наименования товаров, а не сокращенные (как происходит в обычно).

	\item[\dlgflag{Использовать информацию о лотах с других складов}]
	Если флаг включен, то при списании излишков система будет искать информацию о ценах
	и прочие данные, привязанные к лотам, не только на складе, к которому
	относится документ инвентаризации. Естественно, если на этом складе нет ни одного
	лота списываемого товара.

	\item[\dlgflag{Инвентаризация по клиентам}]
	В разработке. Не использовать.

	\item[\dlgflag{Ускоренное добавление строк}]
	Сервисный флаг, влияющий только на интерфейс ввода данных.

	При установленном флаге, если применяется подбор товара по штрихкоду,
	то в поле количества автоматически устанавливается количество, ассоциированное
	со штрихкодом (чаще всего 1).

	Если товар был выбран по серийному номеру, то в поле количества будет
	автоматически установлен остаток по лоту, соответствующему найденному серийному номеру.

	Кроме того, если флаг установлен и выбирается товар, который уже присутствует
	в документе, система на запрашивает подтверждения выбора а считает, что так и
	должно быть.

	\item[\dlgflag{Инвентаризация основных средств}]
	Установленный флаг предписывает системе не допускать ввода в строки инвентаризации
	никаких иных товаров, кроме относящихся к типам основных средств.

	Наоборот, при выключенном флаге, не допускается выбор основных средств.

	\item[\dlgflag{Использовать серийные номера}]
	Важный флаг, оказывающий значительное влияние на результат инвентаризации.

	Если он включен, то строки инвентаризации привязываются к конкретным лотам
	по серийным номерам.

\end{description}

\section{Проведение инвентаризации}

Общая схема использования инвентаризации в системе следующая:
\begin{enumerate}
	\item	Печать инвентарной ведомости
	\item	Подсчет фактических остатков товаров
	\item	Создание документа или документов инвентаризации и ввод в него (в них) фактических
	остатков
	\item	Анализ и корректировка результатов инвентаризации
	\item	Списание рассогласований инвентаризации
	\item	В случае, если необходимо отменить последнее списание, система позволяет это сделать
	посредством функции \qu{Откат списания}
\end{enumerate}
В зависимости от цели, с которой используется инвентаризация, реальная схема может
отличаться от приведенной выше. Так, в случае ввода инвентаризации с целью внесения
первоначальных остатков товаров при запуске системы на предприятии, распечатать инвентарную
ведомость будет затруднительно, поскольку скорее всего не будет первоначальных данных о
товарах и их остатках на машинных носителях информации.

\subsection{Печать инвентарной ведомости}

Печать инвентарной ведомости предназначена для того, чтобы персонал предприятия мог при
подсчете фактических остатков товаров вносить их в готовые формы, удобные для последующего
ввода результатов в компьютер.
Для печати инвентарной ведомости следует использовать отчетность по остаткам товаров.
Подробно эта отчетность будет описана в одном из следующих разделов. Здесь же мы приведем
лишь пошаговую инструкцию по получению инвентарной ведомости:
\begin{enumerate}
	\item Зайдите в пункт меню \ppymenu{Отчетность\rdir Остатки товаров}
	\item В появившемся фильтре укажите дату, на которую назначена инвентаризация и склад,
	по которому она проводится. Кроме того, возможно следует указать способ расчета цен. Если
	на вашем предприятии небольшой ассортимент товаров и велика вероятность существования
	излишков по сравнению с учетными остатками, то можно отметить флажок \dlgflag{Нулевые остатки}. В
	случае обширного ассортимента установка этого флажка приведет к неоправданно длинной
	ведомости которую и печатать долго, с которой и работать не просто.
	\item Кнопкой \dlgbutton{ОК} подтвердите ввод фильтра. После расчета программа выведет на экран
	таблицу остатков товаров.
	\item Для печати нажмите клавишу \keyb{F7}. На экране появится диалог выбора способа печати. В
	группе переключателей выберите либо печать инвентарной ведомости с остатками либо без
	остатков в зависимости от того, хотите вы или нет, чтобы персонал, занимающийся подсчетом,
	видел учетные остатки. В группе флажков выберите требуемые параметры печати и нажмите кнопку
	\dlgbutton{ОК}.
	\item Далее на экране появится обычный диалог, предваряющий печать. Нажмите кнопку \dlgbutton{ОК} и
	отпечатайте ведомость инвентаризации.
\end{enumerate}
Возможно, вам понадобится несколько экземпляров инвентарной ведомости, если подсчет будут
вести несколько бригад.

\subsection{Подсчет фактических остатков}

При подсчете остатков на складе следует обратить особое внимание на правильную идентификацию
товаров счетными бригадами. Наибольшее значение этот момент имеет для предприятий с обширным
ассортиментом товаров. Если на вашем предприятии учет ведется с использованием штрихкодов,
то необходимо внимательно следить за тем, чтобы похожие товары, имеющие разные штрихкоды, не
были посчитаны вместе.

\subsection{Ввод результатов инвентаризации}

После подсчета остатков товаров и заполнения инвентарных ведомостей можно приступать к вводу
результатов инвентаризации в систему.
Все функции системы, связанные с инвентаризацией доступны через пункт меню
\ppymenu{Операции\rdir Инвентаризация}.

\subsubsection{Таблица документов инвентаризации}

Фильтр по инвентарным документам представляет из себя несколько усеченную версию обычного
фильтра по документам. Он содержит только поля ввода периода, вида операции и склада. Как
и в фильтре по другим документам, если склад не указан, то будут показаны инвентарные
документы по всем складам, однако ввод этих документов будет запрещен.

Таблица документов инвентаризации практически ничем не отличается от таблицы товарных
документов. Ввод нового, редактирование и удаление существующих документов осуществляется
по клавишам \keyb{Insert}, \keyb{Enter}, \keyb{Delete} соответственно.

\ppynote{
	Наиболее существенное отличие таблицы инвентарных документов заключается в том, что по
	клавише \keyb{F3} доступен не только просмотр строк инвентаризации, но и редактирование.
	Напомним, что в случае с товарными документами, такое редактирование запрещено системой.
}

\subsubsection{Диалог документа инвентаризации}

\ppypict{dlg-inventory}{Инвентаризация}

Диалог редактирования документа инвентаризации показан на рис.~\ref{pic-dlg-inventory}.
Далее перечислим управляющие элементы этого диалога.

\begin{description}
		\item[Номер документа]
		Строка номера документа инвентаризации длиной не более 23 символов.
		При создании нового документа номер ему присваивается автоматически по правилу,
		определенному в виде операции.

		\item[Дата]
		Дата документе. Значение этой даты определяет дату расчета учетных остатков по товарам,
		введенным в документ.
		\ppynote{
			Учетные остатки вычисляются на конец этой даты. То есть, учитывают все операции до
			этой даты включительно.
		}

		\item[\dlgcombo{Контрагент}]
		Контрагент, ассоциированный с данным документом. Чаще всего для документов инвентаризации не
		указывают контрагента, однако, в некоторых случаях это может быть полезным. Скажем, в качестве
		контрагента может выступать подотчетное лицо, либо сотрудник, поводивших инвентаризацию, и т.п.

		Аналитическая таблица, которой принадлежит статья контрагента, определяется видом операции.

		\item[Учётная сумма]
		Сумма учетных остатков на дату инвентаризации.

		\item[Фактическая сумма]
		Сумма фактических остатков, введенных в документ инвентаризации.

		\item[Дата начала расчета дефицита]

		\item[\dlgbutton{Списать}]
		Эта кнопка предназначена для списания введенных результатов инвентаризации

		\item[\dlgbutton{Откат списания}]
		Если после списания в документе обнаружены ошибки, которые необходимо исправить,
		то списание может быть отменено нажатием на эту кнопку.

		\ppynote{
			Откат списания документа инвентаризации может оказаться невозможным, если
			после списания были введены товарные документы, использующие остатки,
			сформированные излишками, возникшими по причине списания документа.
		}

		\item[\dlgcombo{Место хранения}]
		Не обязательный атрибут, указывающий какое именно место хранения
		было посчитано данным документом. В этом комбо-боксе можно выбрать только те места
		хранения, которые принадлежат складу, с которым ассоциирован документ.

		Система \ppybrand  позволяет анализировать выборку документов инвентаризации
		с группировкой и фильтрацией по месту хранения (как одному из атрибутов документа).

		\item[Примечание]
		Произвольный текст, поясняющий назначение или особенности документа.

		\item[\dlgflag{Выбирать товары, который на складе}]
		Вспомогательный флаг, позволяющий при вводе строк документа, ограничивать подбор товаров
		только теми, которые есть на текущем остатке склада.

		\item[\dlgbutton{Строки документа...}]
			Для ввода строк результатов инвентаризации нажмите на эту кнопку или
клавишу \keyb{F11}. Вслед за этим на экране появится таблица строк инвентаризации.

		\item[\dlgbutton{Строки по фильтру...}]
		Эта кнопка позволяет задать ограничения на вывод строк инвентаризации.
\end{description}

\ppynote{
	Существенным отличием диалога инвентаризации от диалога ввода товарных документов является
	то, что изменение строки в базе данных осуществляется  сразу после подтверждения ввода этой
	строки. В товарных документах все изменения вводятся в базу данных только после того, как
	будет подтверждено изменение всего документа.
}

\subsubsection{Подбор товара для ввода в документ инвентаризации}

В целом, функции подбора товара в документе инвентаризации аналогичны таким же
функциям в товарных документах. Есть несколько особенностей, о которых мы здесь
сообщим.

\paragraph{Стандартный подбор}

Этот вариант предполагает прямой выбор группы и товара в диалоге строки инвентаризации.
После выбора товара в новой строке документа некоторые поля заполняются автоматически:
\begin{itemize}
	\item В поле \qu{Емкость упаковки} заносится значение емкости упаковки
	из последнего лота.
	\item В поле \qu{Всего единиц} заносится остаток на складе, которому принадлежит
	документ инвентаризации, по состоянию на дату этого документа.

	Обращаем внимание на этот момент: не текущий остаток, а именно на дату
	документа инвентаризации.
	\item В поле \qu{Цена реализации} заносится цена учетная реализации товара
	из последнего лота на дату документа.

	Если в опциях вида операции инвентаризации установлен флаг \dlgflag{В ценах поступления},
	то в этом поле появится учетная цена поступления по последнему на дату документа лоту.
\end{itemize}

\paragraph{Подбор из расширенного товарного списка}

Этот метод аналогичен предыдущему с той разницей, что для выбора товара
применяется расширенный диалог. Соответственно, данный способ значительно удобнее
стандартного.

После выбора товара в диалоге строки документа поля изначально
заполняются точно также как и при стандартном способе подбора. Единственное
(возможное) отличие заключается в том, что если в диалоге расширенного
выбора товара указано количество, то именно оно и устанавливается в
соответствующем поле новой строки документа.

\paragraph{Подбор по штрихкоду}

Метод подбора товара по штрихкоду применяется обычно при вводе данных
со сканера штрихкодов либо при вводе штрихкодов товаров вручную.

Вы можете вводить штрихкод непосредственно в таблице строк без предварительного
нажатия какой либо специальной клавиши (в этом случае система распознает начало
ввода штрихкода по тому, что нажата цифровая клавиша), либо предварительно нажав
\keyb{F3}.

После ввода штрихкода и нажатия \keyb{Enter} происходит следующее:
\begin{itemize}
	\item Если товар с введенным штрихкодом уже есть в документе и в опциях
	вида операции инвентаризации не установлен флаг \dlgflag{Ускоренное добавление строк},
	то указатель текущей строки в таблице перемещается на товар с выбранным
	штрихкодом.

	Если флаг \dlgflag{Ускоренное добавление строк} в опциях вида операции
	установлен, то появляется диалог строки, в котором поле количества соответствует
	значению количества товара, сопоставленного с выбранным штрихкодом (чаще всего - единица).

	\item Если товара с введенным штрихкодом в документе нет и в опциях
	вида операции инвентаризации не установлен флаг \dlgflag{Ускоренное добавление строк},
	то открывается диалог ввода новой строки документа, в котором значения полей
	инициализированы так же, как и при стандартном способе подбора товара.

	Если же оговоренная опция вида операции установлена, то система ведет себя так же,
	как и в случае описанном выше (когда выбранный товар уже есть в документе).
\end{itemize}

\paragraph{Подбор по наименованию}

Этот способ дает возможность выбрать товар из списка наименований, содержащих
введенную вами строку.

Для использования такого способа необходимо в таблице строк документа инвентаризации
нажать \keyb{F4} и, в появившемся поле ввода, набрать интересующую вас строку.
После этого на экране появится диалог, аналогичный тому, что используется при расширенном
подборе товара, но содержать он будет только те наименования товаров, которые содержат
искомый текст.

\ppynote{
	При таком подборе товара не работает опция \dlgflag{Выбирать товары, которые есть на складе},
	задаваемая в заголовочном диалоге документа инвентаризации.
}

\subsubsection{Диалог строки инвентарного документа}

\ppypict{dlg-inventoryline}{Инвентаризация товара}

Описание управляющих элементов диалога строки инвентаризации (рис.~\ref{pic-dlg-inventoryline}):

\begin{description}
	\item[\dlgcombo{Товарная группа}]
	Обыкновенная товарная группа, которой принадлежит товар строки.

	\item[\dlgcombo{Товар}]
	Товар, которому соответствует данная строка инвентаризации.

	\item[Серийный номер]
	Если вид операции предполагает инвентаризацию по серийным номерам,
	то это поле открыто, и в нем может быть введен серийный номер лота,
	по которому осуществлен подсчет количества.

	Если в опциях вида операции флаг \dlgflag{Использовать серийные номера}
	не установлен, то это поле заблокировано.

	\item[Емкость упаковки]
	Емкость упаковки товара, используемое как атрибут лота.

	\item[Количество упаковок]
	Поле используется для ввода количества упаковок, которое
	затем пересчитывается в общее число торговых единиц перемножением
	на емкость упаковки (если задана).

	\item[Всего единиц]
	Количество единиц товара или серийного номера, которое
	посчитано в процессе инвентаризации.

	\item[Учетный остаток]
	Справочное поле, отображающее учетное количество товара
	на складе. Если поле серийного номера не пустое, то
	здесь отображается учетное количество в лотах, имеющих
	такой серийный номер.

	\item[Разница]
	Справочное поле, показывающее разницу между фактическим и учетным количеством.

	\item[Цена реализации]
	Инвентарная цена товара, соответствующего данной строке.
	Если опция \dlgflag{В ценах поступления} вида операции установлена,
	то данная величина трактуется системой как цена поступления.

	\item[Цена списания]
	Справочное поле, имеющее смысл только после списания документа
	инвентаризации. Здесь показывается цена списания строки.

	\item[\dlgbutton{Лоты}]
	Кнопка, позволяющая посмотреть лоты товара, которому соответствует
	даннаястрока.
\end{description}

\subsubsection{Важные особенности ввода строк инвентаризации}

При вводе строк инвентарного документа следует учитывать следующие моменты:
\begin{itemize}
	\item В документе инвентаризации не может быть более одной строчки для одного и того же товара.
	Когда вы вводите новую строку, система проверяет наличие другой строки для этого же товара.
	И, если такая существует, будет выдано замечание с предложением выбрать один из
	вариантов: добавить введенный остаток к уже занесенному в документ, заменить уже введенную
	строку на ту, которую вы пытаетесь провести, либо вообще отказаться от ввода новой строки.

	\ppynote{
		При установленном флаге \dlgflag{Ускоренное добавление строк} система автоматически (без
		запроса разрешения у пользователя) суммирует количество товара, введенное в новой строке
		с тем, что уже есть в существующей строке с таким же товаром.
	}

	\item Часть рассогласований по документу инвентаризации может быть уже списана. В этом случае
	строки, которые были учтены при списании не могут быть изменены или удалены. Таким образом,
	если товар А был уже учтен при списании, то вы в этом документе никак не сможете
	модифицировать фактический остаток этого товара.

	\item Учетная цена товара определяется исходя из правила, заданного в настройке вида операции
	инвентаризации. Это может быть одно из следующих  правил: по средневзвешенному значению,
	по последнему лоту, по первому лоту. Но здесь есть один нюанс, а именно, если учетный остаток
	товара равен нулю, то все эти правила лишаются всякого смысла, и учетная цена определяется
	по последнему лоту этого товара, который вообще когда-либо был на складе, а если и такого
	нет, то в системе вообще.

	\item Система никак не ограничивает число и структуру инвентарных документов на одну дату по одному
	и тому же складу. Наряду с известными достоинствами, это накладывает определенную
	ответственность на людей, планирующих и организующих инвентаризацию на предприятии. Здесь
	основная проблема в том, чтобы один и тот же товар не был бы занесен в два разных документа.
	В таком случае, при списании рассогласований, система дважды учтет один товар, что приведет
	к ошибкам в учете.
\end{itemize}

\section{Анализ выборки документов инвентаризации}

\subsection{Фильтр строк инвентаризации}

 \ppypict{dlg-f-invstr}{Фильтр строк инвентаризации}

Диалог фильтрации строк инвентаризации показан на рис.~\ref{pic-dlg-f-invstr}.
Далее перечислим управляющие элементы этого диалога.

\begin{description}
		\item[\dlgcombo{Группа}]
		В этом комбо-боксе может быть выбрана группа, которой должен принадлежать товар.
		\item[\dlgcombo{Товар}]
		\item[\dlgcombo{Место хранения}]
		Не обязательный атрибут, указывающий место хранения выбираемого товара. В этом комбо-боксе можно выбрать только те места хранения, которые принадлежат складу, с которым ассоциирован документ.
		\item[Характер рассогласований]
		Здесь предлагается выбор характера рассогласований между ценами товара в документе инвентаризации.
		\begin{description}
				\item[\dlgradioi{Не обращать внимание}]
				\item[\dlgradioi{Недостачи}]
				\item[\dlgradioi{Излишки}]
				\item[\dlgradioi{Любые рассогласования}]
		\end{description}

		\item[Сортировать по]
		Выбор сортровки товаров.
		\begin{description}
				\item[\dlgradioi{Умолчанию}]
				По умолчанию понимается сортировка по наименованию товара.
				\item[\dlgradioi{Товару}]
				\item[\dlgradioi{Дефициту}]
				\item[\dlgradioi{Разнице}]
		\end{description}

		\item[Диапазон рассогласований]
		Может быть представлен как в числовом виде, так и в процентном соотношении. \\
		Далее предлагается выбор состояния товаров в документе.
		\begin{description}
				\item[\dlgradioi{Списанные и не списанные}]
				\item[\dlgradioi{Только не списанные}]
				\item[\dlgradioi{Только списанные}]
		\end{description}

		\item[Подстановка]
		Подстановка позволяет сгруппировать объекты по заданному параметру.
		\begin{description}
				\item[\dlgcombo{Документ}]
				Параметр, по которому группируются товары.
				\item[\dlgcombo{Товар}]
				Дополнительные надстройки для выбранного параметра.

		\end{description}


\end{description}

\subsection{Детальное описание фильтра}

\section{Объединение документов инвентаризации}

Часто возникает необходимость раздельного ввода нескольких документов инвентаризации
с тем, чтобы затем списать их вместе, то есть, получить общий результат из нескольких
документов инвентаризации. Такая потребность появляется в случае проведения подсчетов
несколькими бригадами, в частности, при использовании ручных терминалов сбора данных,
каждый из которых сбрасывает результаты подсчетов в отдельный документ.

Система \ppybrand{} позволяет объединить произвольный набор документов инвентаризации
в один. Существенным необходимым условием возможности такого объединения является %
принадлежность всех объединяемых документов одному виду операции.

Для выполнения такого объединения выполните следующие несложные шаги:

\begin{enumerate}
	\item Выберите пункт меню \ppymenu{Операции\rdir Инвентаризация}.
	\item В фильтре по документам инвентаризации выберите период, к которому
	относятся объединяемые документы и вид операции.
	\ppynote{
		Если вид операции в фильтре не выбран, то функция объединения будет
		не доступна.
	}

	Если необходимы какие либо дополнительные критерии фильтрации, то укажите
	и их.
	Далее подтвердите ввод фильтра нажав \dlgbutton{ОК}.
	\item Все документы инвентаризации, которые вы видите в таблице могут быть
	теперь объединены в один. Фактически, объединение происходит так: все,
	начиная со второго, документы будут \qu{влиты} в первый документ.

	Для этого нажмите клавиши \keyb{Ctrl-U} или выберите команду
	в контекстном меню \ppymenu{Объединение документов}.
	\item На экране появится небольшой диалог с опциями объединения:
	\begin{description}
		\item[Что делать с совпадающими позициями] Этот переключатель
		регламентирует действия программы при обнаружении идентичных
		позиций в объединяемых документах. Наиболее типичным вариантом
		является первый (складывать количество товара). Остальные
		два варианта применяются в редких случаях.

		Например, вариант \qu{сигнализировать об ошибке} может быть
		использован тогда, когда вы хотите быть уверены, что ни одно
		из товарных наименований не было посчитано одновременно
		двумя счетными бригадами.

		\item[Удалить обработанные документы] Если этот флаг выключить
		(по умолчанию он включен), то ни один документ не будет удален.
		Если же флаг находится во включенном положении, то все документы,
		кроме первого документа выборки, будут удалены (так как все их
		содержимое влилось в первый документ).
	\end{description}
\end{enumerate}

Функция объединения документов инвентаризации будет не доступна, если
в правах доступа по объекту \ppyrsrv{Документы} не установлен флаг
\dlgflag{Объединение выборки документов}.

\section{Списание инвентаризации}

После того как завершен подсчет остатков и ввод их в систему необходимо списать
рассогласования.

Списание подразумевает под собой автоматическое формирование документов, отражающих различия
между учетными  и фактическими остатками. При этом, по недостачам формируются расходные, а
по излишкам - приходные документы. Конкретные особенности документов списания определяются
параметрами, заданными в виде операции инвентаризации.
Для того, чтобы осуществить списание инвентарного документа, необходимо в диалоге документа
нажать кнопку \dlgbutton{Списать}.

После успешного списания, вы можете зайти в товарные документы и увидеть документы,
образовавшиеся в результате этой операции. Их можно корректировать так же, как и любой другой
товарный документ, однако наиболее правильным будет сначала проверить результаты
инвентаризации, и лишь затем произвести списание и затем уже не изменять и не удалять
результирующие документы.

Если инвентаризация была поспешно и неверно списана, то это списание можно отменить, нажав
в диалоге инвентарного документа кнопку \dlgbutton{Откат списания}. При этом все документы
списания будут удалены, а строки инвентарного документа снова будут доступны для редактирования.

\ppynote{
	При попытке откатить списание инвентаризации \qu{задним числом}, то есть, спустя несколько
	дней после даты, которой помечен документ инвентаризации, вы можете столкнуться с невозможностью
	осуществить это действие из-за того, что излишки, сформированные при списании были израсходованы.

	Мы настоятельно рекомендуем не откатывать списание инвентаризации \qu{задним числом}, а
	вводить корректирующие документы той датой, когда были фактически выяснены
	ошибки в проведении инвентаризации.
}

\section{Печать результатов инвентаризации}

После списания документа инвентаризации как правило, следует вывести на печать результаты
проведения инвентаризации. Для этого следует открыть строки документа инвентаризации и
нажать в появившейся таблице клавишу \keyb{F7}. Внешний вид отчета показан на
рис.~\ref{pic-rpt-inventory}.

\ppypictsc{rpt-inventory}{}{0.4}

\section{Особенности работы с инвентаризацией}

При изменении даты документа инвентаризации система предлагает пересчитать учетные остатки
в соответствии с новой датой.
Если вы хотите заставить систему пересчитать учетные остатки без изменения даты документа,
то в строках инвентаризации необходимо нажать \keyb{Ctrl-R}.
В редких случаях возникает необходимость пересчитать фактические цены в соответствии с
учетными. Для этого следует нажать \keyb{Ctrl-P} в строках инвентаризации.

% @todo \section{Передача документов инвентаризации между разделами базы данных}

\chapter{Производство\label{ch-manuf}}

\section{Введение}

В этой главе подробно описаны методы учета производства в системе \ppybrand{}. Учитывая
сложность предмета, мы начнем с терминологии, используемой нами в этом разделе, затем
перейдем к общим принципам учета производства, далее, расскажем об объектах и справочниках,
используемых в учете, и, наконец, опишем процедуры учета.

\section{Терминология}

	\paragraph{Прямой учет производства}
	Учет производства продукции, при котором списание сырья и полуфабрикатов осуществляется
	по фактическому расходу. Прямой учет является более сложным, чем обратный с точки зрения
	настройки системы и подготовки справочных данных, однако, точность и оперативность
	учета несоизмеримо выше, чем при обратном учете.
	На практике прямой учет применяется в комбинации с обратным учетом, то есть, часть сырья и
	материалов  списывается по фактическим данным, а часть - по нормативам.

	\paragraph{Обратный учет производства}
	Такой учет подразумевает списание сырья и материалов на изготовление готовой продукции на
	основании данных об изготовлении или реализации готовых изделий. Для  правильного
	функционирования обратного учета необходимо, чтобы для каждого наименования продукции
	была задана структура с максимально точным указанием состава.
	В любом случае, обратный учет, будучи намного проще с точки организационных и финансовых
	затрат, дает менее точный результат учета функционирования производства.

	\paragraph{Технологическая сессия}
	Период работы процессора, в течение которого он производил какую-либо продукцию. Как
	правило, в течение одной сессии процессор производит одно наименование основной продукции,
	при этом может производиться побочная продукция и отходы, а также списываются сырье и
	полуфабрикаты.
	Атрибутами технологической сессии являются:

	\begin{itemize}
		\item 	Дата и время начала
		\item 	Дата и время завершения
		\item 	Статус
		\item 	Суперсессия
		\item 	Процессор
		\item 	Технология
		\item 	Основной контрагент
		\item 	Дополнительный контрагент
	\end{itemize}

	Технологическая сессия состоит из строк, каждая из которых отражает факт производства или
	расхода какого-либо количества продукции, сырья или полуфабрикатов. Каждую такую строку
	будем называть технологической транзакцией.

	\paragraph{Технологическая транзакция}
	Строка технологической сессии, отражающая факт расхода сырья или материалов или производства
	продукции.
	Атрибутами технологической транзакции являются:
	\begin{itemize}
		\item 	Технологическая сессия
		\item 	Товар
		\item 	Знак операции (расход, приход, без изменения остатка)
		\item 	Количество товара израсходованного или произведенного в процессе транзакции
		\item 	Дата и время
		\item 	Оператор
		\item 	Серийный номер произведенной или израсходованной партии товара
	\end{itemize}

	\paragraph{Технология}
	Способ производства или разделки какого-либо товара. Технология отражает способ производства
	некоторого товара на конкретном процессоре или группе процессоров.
	Технологию можно рассматривать как объект, связывающий воедино товар, его структуру и
	процессор, на котором эта структура реализуется как метод производства.
	Атрибутами технологии являются:
	\begin{itemize}
		\item 	Процессор (группа процессоров)
		\item 	Товар
		\item 	Структура товара
		\item 	Производительность (количество основного товара, обрабатываемого на процессоре по
		заданной технологии)
	\end{itemize}

	\paragraph{Технология перенастройки}
	Технология, определяющая время и расходы сырья (выход отходов) на перенастройку
	оборудования, если меняется вид производимой продукции.

	\paragraph{Основной товар технологической сессии}
	Заглавный товар технологии, по которой работает технологическая сессия.

	\paragraph{Процессор}
	Станок, человек, гостиничный номер и вообще любое нечто, что способно производить
	какую-либо продукцию (в том числе и услуги) за определенный период времени.

	\paragraph{Структура товара}
	В англоязычной литературе - BOM (Bill Of Material).
	Состав изделия. В системе \ppybrand{} структура товара может иметь смысл в качестве состава
	комплектации, состава декомплектации, а также возможны варианты так называемых частичных
	структур и структур замены.
	Один товар может иметь одну либо несколько (количество не ограничено) структур.

	\paragraph{Группа процессоров}

	\paragraph{MRP-таблица}

\section{Обзор объектов данных, участвующих в учете и управлении производством}

\ppypictsc{schema-manuf-obj-overview}{}{0.4}

Показанная на рисунке схема, демонстрирует связи и назначения основных объектов учета
производства, используемых в системе.

\section{Схема работы с технологическими сессиями}

\ppypictsc{schema-usage-tsess}{}{0.4}

Для того, чтобы яснее представить назначение различных объектов, применяемых в учете
производственных процессов, приведем схему типового алгоритма работы с этими объектами (рис.~\ref{pic-schema-usage-tsess}).

Далее следует описание этого алгоритма. Заметим, что приведенный алгоритм весьма
упрощен - он не учитывает работу с документами заказов, списание технологических сессий,
детализацию производства продукции и расхода сырья, а так же многие другие важные детали.

Главное его назначение - сделать дальнейшее описание менее абстрактным.

\begin{enumerate}
	\item На предприятие поступает требование на производство некоторого товара
	либо оказание услуги.
	\item Сотрудник, отвечающий за обработку заказов, выбирает процессор, который
	будет производить заказанный товар или предоставлять услугу.

	В реальности этот выбор может быть как весьма простым (свободный парикмахер,
	сидящий рядом), так и в значительной степени сложным (станок, производящий
	требуемую продукцию, будет определен с большой задержкой с момента
	поступления заказа и совсем другим сотрудником).
	\item Заказанная номенклатурная позиция должна быть подготовлена.
	Это означает, что:
	\begin{itemize}
		\item Эта позиция должна быть заведена в справочнике.
		\item Для этой позиции должна быть определена технология производства,
		сопоставляющая ее с процессором (группой процессоров).
	\end{itemize}
	\item Теперь можно создать технологическую сессию, которая зафиксирует
	факт плана производства и свяжет во едино заказанный товар, процессор, на
	котором он будет производиться и технологию, по которой это производство
	будет осуществлено.

	Кроме указанной связки, технологическая сессия сделает следующее:

	\begin{itemize}
		\item Забронирует время занятости процессора (пока только планируемое)
		\item Определит плановый объем производства
		\item Задаст дополнительные (и в разных случаях значительно различающиеся)
		характеристики работы. Как то: контрагента, бригаду, документ заказа и др.
	\end{itemize}

	Созданная технологическая сессия получает статус \ppyrsrv{Планируемая} либо
	\ppyrsrv{В ожидании}.

	\item Когда наступит момент, когда процессор начинает работу над производством
	продукта (услуги), технологическая сессия переводится в статус \ppyrsrv{Выполняется}.
	Одновременно с этим фиксируется фактическое время начала работы.

	\item Процессор закончил работу. Сессия переводится в статус \ppyrsrv{Закрыта}.
	Сейчас же системой фиксируется время завершения работы. Соответственно,
	процессор освобождается - то есть, он готов к работе над другим заказом.

	\item Закрытая технологическая сессия требует завершающих операций. Мы сейчас
	не станем на них останавливаться.

\end{enumerate}

\section{Процессоры}

\subsection{Понятие процессора}

Процессор является объектом, моделирующим нечто, что может производить товары или услуги,
с определенной (ограниченной) производительностью.

Принципиальной особенностью процессоров, является то, что их использование учитывается по
времени. Более того, система строго следит за тем, чтобы процессор использовался в каждый
момент времени только одним процессом (технологической сессией).
Под такое определение попадают в первую очередь станки и оборудование, используемые на
производстве, гостиничные номера, здания или предметы, сдаваемые в аренду, а также
сотрудники, выполняющие работы (впрочем, для этих целей \ppybrand{} предлагает так же функционал
управления проектами и задачами).

Процессоры могут объединяться в древовидную иерархию. При этом все узлы такой иерархии будут
представлены группами процессоров, а весь нижний уровень - простыми процессорами.

\subsection{Группа процессоров}

\ppypictsc{dlg-021}{Группа процессоров}{0.5}

Группа процессоров определяет основные характеристики поведения процессоров, принадлежащих
ей.

Параметры групп наследуются процессорами по иерархии. То есть, система выясняет параметры
процессора, проходя от него самого к его родительской группе, потом к родительской группе
этой группы (если она есть) и так далее. Если какой-либо параметр процессора не определен
на нижнем уровне, то процессор наследует этот параметр из более высокого уровня.
Например, предположим, существует следующая иерархия процессоров:

\indent Группа \qu{Все процессоры}
\newline\indent\indent Группа \qu{Процессоры Цеха №1}
\newline\indent\indent Процессор 3

При определении, скажем, операции списания для \qu{Процессора 3} система извлекает запись
этого процессора. Затем, видя, что он принадлежит группе \qu{Процессоры Цеха №1}, извлекает
запись этой группы и смотрит, определена ли для нее операция списания. Если нет, то ищет
родительскую группу, то есть, \qu{Все процессоры}. Если операция списания определена для
этой, последней в иерархии, группе, то считает, что \qu{Процессор 3} использует это операцию
списания.

Хотя система не требует, чтобы процессор обязательно принадлежал какой-либо группе, мы
настоятельно рекомендуем не заводить процессоры, не принадлежащие ни одной группе.

Группа процессоров имеет следующие атрибуты:

\begin{description}
	\item[Наименование]
	Наименование группы.
	Система следит за тем, чтобы две группы процессоров или два процессора не имели одинакового
	наименования, однако процессор и группа процессоров могут иметь одинаковые имена.

	\item[Идент]
	Уникальный неизменяемый идентификатор процессора. В этом диалоге он показывается для
	справки (пользователь не имеет возможности его изменять).

	\item[Символ]
	Уникальный символ группы, позволяющий пользователю быстро найти ее.

	\item[Группа]
	Родительская группа. Если это поле пустое, то группа будет находиться на самом верху
	иерархии процессоров.

	\item[Склад]
	Каждая группа процессоров должна принадлежать какому-либо складу. Это необходимо для того,
	чтобы система \qu{знала} по какому складу проводить документы списания сессий, принадлежащих
	процессорам этой группы, а также для того, чтобы правильно идентифицировать местоположение
	товарных позиций, используемых соответствующими процессорами.

	\item[Операция списания]
	Вид операции, используемый для формирования документов списания по технологическим сессиям,
	принадлежащим процессорам этой группы.

	\item[Статья списания]
	Если эта статья не пустая, то при списании технологических сессий, принадлежащих процессорам
	этой группы, в документы списания подставляется эта статья.

	\item[Стандартная продолжительность суперсессий]
	При создании технологических суперсессий, принадлежащих этой группе процессоров,
	система определяет время их окончания исходя из введенного пользователем времени
	начала сессии и указанной здесь продолжительности. Это облегчает ввод новых
	суперсессий, поскольку, они, как правило, характеризуют рабочие смены цехов и
	имеют одинаковую продолжительность.

	\item[\dlgflag{Синхронизировать режимы сессий по суперсессиям}]
	Если это флаг включен, то статусы сессий, относящихся к суперсессии, принадлежащей этой
	группе процессоров, будут изменяться в соответствии с изменениями статуса суперсессии.
	Подробнее статусы технологических сессий описаны в соответствующем разделе.

	\item[\dlgflag{Фиксировать исходящие остатки по сессиям}]
	Если этот флаг включен, то при списании технологической сессии, принадлежащей этой
	группе, система будет рассчитывать исходящие остатки по складу на момент списания и
	хранить их специальным образом в строках сессии.

	Использование технологии фиксации остатков по сессиям представляется спорным, и мы не
	рекомендуем использовать этот флаг.

	\item[\dlgflag{Не списывать сессии}]
	Если этот флаг установлен, то система не будет списывать сессии по процессорам этой
	группы. Обратите внимание, что если этот флаг установлен для группы, то не имеет значения,
	как установлен такой же флаг у процессоров, принадлежащих этой группе, или у групп,
	находящихся ниже по иерархии - все равно списание по сессиям этих процессоров будет
	заблокировано.

	Если же у группы этот флаг выключен, то списывать или не списывать сессии по процессорам
	определяется установками этого флага у нижестоящих групп или процессоров.

	\item[\dlgflag{Допускает переключение между процессорами в панели ввода}]
	Специализированный флаг, имеющий значение при использовании панели процессоров.

	Если этот флаг включен, то панель будет динамически переключаться между
	незанятыми процессорами данной группы при вводе очередной строки.

	\item[\dlgflag{Принимать дублирование серийного номера в сессии}]
	Если это флаг не установлен, то система не допустит ввода двух и более
	строк технологической сессии по процессорам этой группы если
	в строки содержат одинаковые серийные номера.

	При включении флага описанное ограничение снимается.

	\item[\dlgflag{Проводить документы списания при дефиците}]
	Если при списании технологической сессии обнаружился дефицит
	по каким либо товарным позициям и этот флаг установлен, то
	система все равно спишет сессию оставив в документах
	списания столько дефицитного товара, сколько есть на остатке.

	\item[\dlgflag{Дополнительный объект сессии списывать как агента}\label{loc-prcf-addedobjasagent}]
	Флаг доступен только тогда, когда вид операции списания этой
	группы процессоров не определяет дополнительную таблицу аналитических статей
	(см.~\pageref{sec-oprkind}).

	Если флаг включен и в базе данных определена таблице статей агентов,
	то в качестве дополнительного объекта по технологическим сессиям
	процессоров этой группы можно будет выбрать агента, который
	будет фигурировать в качестве одноименного атрибута документа
	списания сессии.

	В качестве примера использования этой опции можно привести следующий
	случай: диспетчеризация автотранспорта с оплатой вознаграждения диспетчерам
	по результатам работы. В этом случае процессорами являются автотранспортные
	средства, контрагентами по сессиям - клиенты, а дополнительным объектом
	- диспетчеры (выступающие агентами по документам списания).

	\item[\dlgradioc{Дата документа списания}]
	Этот переключатель определяет алгоритм установки даты документов списания технологических
	сессий. Это может быть существенным, если сессия может пересекать временную границу суток.

	\begin{description}
		\item[\dlgradioi{Начало сессии}] Документы списания будут иметь дату, равную дате начала
		соответствующих сессий.
		\item[\dlgradioi{Конец сессии}] Документы списания будут иметь дату, равную дате
		окончания соответствующих сессий.
	\end{description}

	\item[\dlgflag{Привязать к суперсессиям}]
	Если этот флаг включен, то дата документа списания будет привязываться не непосредственно
	к сессии, которую списывает этот документ, а к суперсессии, которой принадлежит сессия
	(если такая суперсессия есть).

	\item[\dlgradioc{Тип связного объекта}]

	Этот атрибут позволяет определить тип объектов данных, с которыми связаны
	процессоры данной группы.

	\begin{description}
		\item[\dlgradioi{Нет}] Процессоры этой группы не связаны ни с каким иным объектом данных
		\item[\dlgradioi{Персоналии}] Процессоры этой группы связаны с персоналиями.

		Необходимо уточнение вида персоналии в комбо-боксе \dlgcombo{Группа связных объектов}.
		\item[\dlgradioi{Автомобили}] Процессоры группы связаны с объектом данных
		\ppyrsrv{Транспортные средства} (подтип \ppyrsrv{Автомобили}).

		Полный список автомобилей доступен через пункт меню
		\ppymenu{Справочники\rdir Отраслевые справочники\rdir Транспорт}.

		Уточнение группы связанных объектов не требуется.
	\end{description}

	\item[\dlgcombo{Группа связных объектов}]
	Конкретизирует категорию объектов, с которыми связаны процессоры этой группы.

	На текущий момент этот комбо-бокс доступен (и обязателен к выбору не пустого
	значения) при связывании процессоров с типом объектов \ppyrsrv{Персоналии}.

	\item[\dlgcombo{Группа учета исходящих остатков}]
	Если установлен флаг \dlgflag{Фиксировать исходящие остатки по
	сессиям}, то этот комбо-бокс позволяет ограничить номенклатуру товаров, по которым
	рассчитываются остатки при списании технологических сессий.
\end{description}

\subsection{Процессор}

\ppypictsc{dlg-022}{Процессор}{0.5}

Процессор определяет собственно объект учета, в отличие от группы процессоров, объединяющей
процессоры и обеспечивающей их некоторыми общими атрибутами.
Диалог редактирования процессора показан на рис.~\ref{pic-dlg-022}.
Многие атрибуты процессор заимствует из группы, которой принадлежит, однако есть ряд
параметров, специфичных только для процессоров, но не групп.
В основном, это - атрибуты, определяющие поведение панели ввода процессора.
Следующая таблица описывает все  характеристики процессоров.

\begin{description}
	\item[Наименование]
	Наименование процессора.
	Система следит за тем, чтобы два и более процессоров не имели одинакового имени.

	\item[Идент]
	Поле \qu{только для чтения}. Показывает внутренний идентификатор процессора.

	При создании новой записи это значение нулевое.

	\item[Символ]
	Уникальный код процессора, позволяющий быстро находить его, а также создавать новые
	технологические сессии по этому процессору.

	\item[\dlgcombo{Связный объект}]
	Действительный заголовок этого комбо-бокса зависит от типа ассоциации группы,
	которой принадлежит данный процессор.

	Комбо-бокс позволяет выбрать объект, связанный с процессором. На приведенной иллюстрации
	диалога процессор связан с транспортным средством.

	\item[\dlgcombo{Группа}]
	Родительская группа процессора. Хотя система не требует обязательной принадлежности
	процессора какой-либо группе, настоятельно рекомендуется определять группу для каждого
	процессора.

	\item[\dlgcombo{Склад}]
	Каждый процессор должна принадлежать какому-либо складу. Это необходимо для того, чтобы
	система \qu{знала} по какому складу проводить документы списания технологических сессий,
	принадлежащих этому процессору, а также для того, чтобы правильно идентифицировать
	местоположение товарных позиций, используемых соответствующими процессорами.

	\item[\dlgcombo{Принтер}]
	Если по строкам технологических сессий, принадлежащих этому процессору, должны печататься
	этикетки на принтере штрихкодов, то в этом комбо-боксе необходимо выбрать принтер, который
	будет использоваться для этого.

	Принтер выбирается из множества, определенного в справочнике принтеров штрихкодов
	(меню \ppymenu{Справочники\rdir Оборудование\rdir Принтеры штрихкодов}.

	\item[\dlgflag{Не списывать сессии}]
	Если этот флаг установлен, то сессии по процессору не будут списываться.
	При попытке списания система будет выдавать уведомительное сообщение о том, что
	для этого процессора списание невозможно по причине установки данного
	признака.

	Установка этого флага для группы процессоров заблокирует возможность
	списания сессий по любому процессору этой группы и всех групп,
	являющихся дочерними по отношению к ней.

	\item[\dlgflag{Проводить документы списания при дефиците}]
	Установка этого признака приведет к тому, что сессии, принадлежащие
	данному процессору, либо процессорам этой группы, будут списываться не
	взирая на учетный дефицит товарных позиций, необходимых для такого списания.

	Мы не рекомендуем установку этого флага в штатном режиме поскольку это
	может привести к нарушению целостности учета (документа списания не будут
	содержать те номенклатурные позиции, которых не числится на учетном остатке
	в достаточном количестве).

	\item[\dlgflag{Пассивный}]
	Если этот флаг установлен процессор нельзя будет выбрать в списках. Однако
	все технологические сессии, привязанные к процессору остаются доступны
	в соответствующих отчетах.

	\item[\dlgflag{Печатать этикетку на каждую новую строку в панели}]
	Если этот флаг включен, то в панели процессора на каждую строку, имеющую знак \qu{Выход} (+),
	система будет печатать этикетку.

	\item[\dlgflag{Проводить строку сразу после выбора товара}]
	Обычный сценарий ввода строки технологической сессии в панели процессора состоит как
	минимум из трех шагов:
	\begin{enumerate}
		\item 	Выбор товара (по штрихкоду номенклатурного номера,
		либо по штрихкоду серии, либо вручную из списка)
		\item 	Ввод количества, соответствующего выбранному товару
		\item 	Подтверждение ввода с последующим проведение строки сессии
	\end{enumerate}
	Если обсуждаемый флаг включен, то сценарий может быть сокращен до двух шагов, а именно,
	пропускается второй шаг. В этом случае приходится полагаться на количество товара,
	устанавливаемое системой по умолчанию: при выборе товара по номенклатурному штрихкоду -
	это либо одна единица, либо одна упаковка; при выборе товара по серийному номеру -
	количество единиц, выпущенное под этим серийным номером.
	Преимуществом работы с такой настройки является значительное увеличение производительности
	за счет исключения лишнего нажатия клавиши на клавиатуре компьютере. Кроме того, если
	оператор использует сканер штрихкодов, то в процессе ввода ему не придется даже прикасаться
	к клавиатуре.

	\item[Количество экземпляров этикеток]
	Это поле позволяет указать, сколько экземпляров этикеток следует распечатать на принтере
	штрихкодов, при проведении строки.
	Если указанное здесь значение меньше двух или больше 999, то система считает, что надо
	печатать одну этикетку.
\end{description}

\subsection{Таблица процессоров}

\ppypict{brw-prc}{Таблица процессоров}

Таблица процессоров позволяет просматривать процессоры или группы процессоров и
редактировать элементы справочника.
Просмотр и редактирование справочника процессоров доступен через пункт меню
\ppymenu{Справочники\rdir Производство\rdir Процессоры}.
Внешний вид таблицы процессоров показан на рис.~\ref{pic-brw-prc}.

\subsubsection{Фильтр таблицы процессоров}

\ppypict{dlg-f-prc}{Фильтр процессоров}

Диалог фильтра, изображенный на рис.~\ref{pic-dlg-f-prc}, содержит следующие элементы:

\begin{description}
	\item[\dlgradioc{Группы - Процессоры}]
	Если вы выберите положение \dlgradioi{Группы}, то будут показаны только группы процессоров. При
	выборе \dlgradioi{Процессоры}, будут показаны только собственно процессоры.

	\item[\dlgcombo{Группа}]
	Выбрав здесь группу процессоров, вы укажете системе, что хотите видеть только те процессоры,
	которые имеют своим непосредственным \qu{предком} эту группу.
	Обратите внимание, что не будут показаны те процессоры, которые наследуются от выбранной
	группы посредством других групп.

	\item[\dlgcombo{Склад}]
	Если выбран какой-либо склад, то будут отфильтрованы процессоры, принадлежащие ему.
\end{description}

\subsubsection{Действия в таблице процессоров}

	\paragraph{Редактировать}\indent\keyb{Enter}
	Редактировать элемент справочника. В зависимости от того, просматриваете вы процессоры или
	группы процессоров, на экране появится диалог, соответствующий выбранному объекту.

	\paragraph{Добавить}\indent\keyb{Insert}
	Добавить новый процессор или группу процессоров.
	Если опции фильтра, по которому вы просматриваете таблицу, предполагают показ групп
	процессоров, то этим действием вы сможете создать новую группу процессоров.
	Если фильтр просмотра имеет установленную группу, то вновь создаваемая запись будет
	принадлежать этой группе.

	\paragraph{Удалить}\indent\keyb{Delete}
	Эта команда позволяет удалить текущую запись процессора или группы процессоров.
	Если в базе данных существуют ссылки на удаляемый объект, то такое удаление невозможно -
	система сообщит об этом.

	\paragraph{Детализация}\indent\keyb{F3}
	Если фильтр предполагает просмотр групп процессоров, то по этой команде система покажет
	список процессоров и групп, для которых текущая группа является родительской.

	\paragraph{Технологии}\indent\keyb{Ctrl-T}
	По этой команде вы можете увидеть таблицу технологий, привязанных к текущему процессору
	или группе процессоров.

	\paragraph{Сессии}\indent\keyb{Ctrl-S}
	Выбрав эту команду, вы увидите таблицу технологических сессий, относящихся к выбранному
	процессору или группе процессоров.

	\paragraph{Системный журнал}\indent\keyb{Ctrl-J}
	Стандартная для многих таблиц команда, позволяющая увидеть таблицу системных событий
	по текущему объекту.

	\paragraph{Печать}\indent\keyb{F7}
	Печать содержимого таблицы процессоров.

	\paragraph{Фильтр}\indent\keyb{Ctrl-V}
	Изменение условий фильтрации таблицы.

\section{Справочник технологий}

Технологии служат для связывания процессоров с производимыми либо обрабатываемыми товарами
через их структуры. Таким образом, технология - это способ каким производится или
обрабатывается некоторый товар.

\subsection{Технология}

\ppypict{dlg-023}{Технология}

Диалог редактирования технологии приведен на рис.~\ref{pic-dlg-023}. Следующая таблица
объясняет назначение управляющих элементов этого диалога.

\begin{description}
	\item[Код]
	Код технологии. Этот код должен быть уникальным.
	При создании новой технологии этот код генерируется автоматически. Для этого система
	использует внутренний счетчик, который увеличивается при каждой попытке получить новый
	код. Таким образом, автоматически присваиваемые коды уникальны.
	С другой стороны, вы можете самостоятельно присваивать коды технологиям, но при этом
	обязанность по соблюдению их уникальности ложится на вас.

	\item[ИД]

	%Группа процессоров &
	%\eor

	\item[\dlgcombo{Процессор}]
	Процессор, к которому привязана эта технология. Вы можете привязать технологию к целой
	группе процессоров. Для этого установите флаг \dlgflag{Группа процессоров}. Если этот флаг
	установлен, то в комбо-боксе система показывает список групп процессоров.
	Общая рекомендация такова, что технологии правильнее привязывать к группам процессоров.

	\item[\dlgcombo{Группа}]
	Вспомогательный комбо-бокс, облегчающий выбор основного товара технологии.

	\item[\dlgcombo{Товар}]
	Основной товар технологии. Это поле является обязательным.

	\item[\dlgcombo{Структура}]
	Если при производстве или обработке основного товара по этой технологии должна
	использоваться какая-либо структура этого товара, то ее следует выбрать в этом комбо-боксе.
	Вообще говоря, система не требует обязательного выбора структуры, однако, если обработка
	основного товара осуществляется в соответствии с какой-либо структурой, то вам следует
	проследить за тем, чтобы это поле не было пустым.

	С другой стороны, некоторые технологии в принципе не должны содержать структуру. Примером
	может быть технология использования гостиничных номеров или технологии, применяемые для
	автоматизации ввода перемещения изделий с одного склада на другой.

	Если к товару привязаны не именованные структуры, то в списке выбора структуры появляются
	строки вида BOM \#1, BOM \#2 и т.д. Именованные же структуры представлены в списке собственными
	наименованиями.

	\item[\dlgbutton{Структура}]
	Нажатие на эту кнопку приведет к появлению на экране диалога просмотра и
	редактирования структуры, выбранной в соответствующем комбо-боксе (см. выше).

	Если комбо-бокс \dlgcombo{Структура} пуст, то нажатие на эту кнопку ни к чему не приведет.

	\item[\dlgradioc{Переключатель знака основного товара}]
	Этот переключатель применяется для того, чтобы сообщить системе, что происходит с основным
	товаром при обработке его по этой технологии.

	Значение переключателя \dlgradioi{Расход} и \dlgradioi{Выход} очевидны.
	Вариант \dlgradioi{Использование} означает, что товар не расходуется и не приходуется. Как правило,
	этот вариант не применяется.

	\item[Производительность]
	Производительность процессора при использовании данной технологии в торговых единицах
	основного товара в секунду.

	Так как в большинстве случаев пользователи оперируют производительностью в единицах
	более крупных, чем секунда, в системе предусмотрен специальный калькулятор, позволяющий
	пересчитать производительность. Для использования этого калькулятора нажмите
	клавишу \keyb{F2} в поле производительности. На экране появится диалог, в котором можно
	выбрать единицу измерения времени и ввести производительность процессора по данной
	технологии в выбранной временной размерности. Если вы включите флаг
	\dlgflag{Время на одну единицу}, то система будет считать, что вы ввели время, требуемое
	на обработку одной единицы основного товара, и пересчитает его в размерность
	\qu{изделий в секунду}.

	Значения переключателя единицы измерения времени и флага \dlgflag{Время на одну единицы}
	система сохраняет в реестре компьютера для текущего пользователя.
	То есть, работая на этом же компьютере и под тем же именем пользователя, при следующем
	обращении к этому диалогу вы увидите те же значения этих переключателей.

	\item[Округление]
	Это поле используется как параметр округления (всегда в большую сторону) для количества
	основного товара технологии в технологической сессии, если этот товар измеряется в единицах
	времени, переводимых в секунды.

	Практический смысл это поле имеет для учета сдачи процессоров в наем на время. Как пример
	можно рассматривать гостиничные номера, аренду складских помещений и т.д.
	Если вы измеряете товар \qu{Сдача гостиничного номера} в сутках, а параметр округления
	установлен в 0,5, то система всегда будет округлять время, проведенное постояльцем в
	гостиничном номере до половины суток в большую сторону.

	\item[\dlgflag{Рекомплектация основного товара}]

	\item[\dlgflag{Учитывать планируемое время по строкам}]

	\item[Примечание]
	Любой текст, которым вы хотите как-то охарактеризовать или отметить эту технологию.
	Поле можно оставлять пустым.

	\item[Количество по умолчанию]
	Если здесь указано значение большее нуля, то при выборе этой технологии в
	диалоге технологической сессии планируемое количество автоматически будет
	устанавливаться равным этой величине.
\end{description}

\subsection{Технология перенастройки}

Несмотря на то, что технологии перенастройки рассматриваются как объекты, родственные
технологиям, они значительно отличаются, по сути, и в деталях от последних.
Основной принцип применения технологий перенастройки следующий: вы настраиваете набор
таких технологий, в каждой из которого определяете процессор или группу процессоров, к
которой она относится, а также правило идентификации перехода между производимой продукцией.
По существу, здесь все крутится вокруг этого перехода. Возможны следующие способы
определения правил переходов:

\begin{itemize}
	\item 	Явное задание товара, который будет производиться или товара который производился
	непосредственно перед этим
	\item 	Задание группы (возможно альтернативной) товаров, которые будут производиться или
	товаров, который производились до этого.
	\item 	Дополнительная маска перехода, определяемая классом рассматриваемой пары товаров.
	В этом случае система идентифицирует необходимость использования технологии перенастройки
	по тому, что изменился один или несколько параметров товаров, определяемых этой маской
	\item 	Формула условия перехода. Критерий по смыслу аналогичный маске перехода, но дающий
	дополнительную гибкость в определении перехода. Формула перехода позволяет, например,
	определить количественный критерий использования технологии перенастройки. Допустим, этом
	может быть диапазон изменения какого либо размера изделия.
\end{itemize}

Все эти варианты могут комбинироваться друг с другом.

После того, как определено правило перехода, задается время на перенастройку и структура
расхода/выхода, связанная с этой технологией.
Техника использования системой технологий перенастройки следующая:
Для выбранной технологической сессии определяется сессия, которая ей непосредственно
предшествовала.

Если основной товар технологий, используемых этими сессиями, изменился, то ранжируются
все технологии перенастройки, заданные непосредственно для этого процессора, а также для
всех групп по иерархии, которым он является дочерним процессором.
После этого просматриваются все выбранные технологии перенастройки и, если какая-либо из
них подходит по критерию перехода производимого товара, то она применяется.
Диалог редактирования технологии перенастройки приведен на рисунке.
Те поля, которые аналогичны описанным для диалога собственно технологий, мы здесь
рассматривать не будем, а сосредоточимся только на специфичных для перенастройки полях.

\ppypict{dlg-tooling}{Технология перенастройки}

\begin{description}
	\item[Код]

	\item[Ид]

	%\dlgflag{Группа процессоров} &
	%\eor

	\item[Процессор]

	\item[Товар, который будет производиться]

	\item[Предшествующий товар]

	\item[\dlgbutton{Структура издержек}]

	\item[\dlgbutton{Маска перехода}]

	\item[Формула условия перехода]

	\item[Продолжительность]

	\item[Примечание]
\end{description}

\subsection{Таблица технологий}

Таблица технологий показана на рис.~\ref{pic-brw-tech}.

Доступ к этой таблице возможен через пункт меню \ppymenu{Справочники\rdir Производство\rdir Технологии}.

Эта таблица позволяет просматривать список технологий по фильтру, а также добавлять,
редактировать и удалять записи технологий.

\ppypictsc{brw-tech}{}{0.4}

\subsubsection{Действия в таблице технологий}

	\paragraph{Редактировать}\indent\keyb{Enter}
	Редактировать текущую технологию

	\paragraph{Добавить}\indent\keyb{Insert}
	Добавить новую технологию.
	Если в параметрах фильтрации указаны процессор и (или) товар, то диалог новой технологии
	будет содержать эти процессор и товар.

	\paragraph{Добавить по образцу}\indent\keyb{Alt-F2}
	Создать новую технологию по образцу текущей.
	При вызове этой функции на экране появится диалог редактирования новой технологии, все
	поля которой идентичны полям текущей в таблице технологии, за исключением идентификатора
	и кода (код генерируется автоматически так же, как при простом создании новой технологии).

	\paragraph{Удалить}\indent\keyb{Delete}
	Удалить выбранную технологию.

	\paragraph{Товар}\indent\keyb{F2}
	Эта команда позволяет просматривать и редактировать товар, к которому привязана выбранная
	технология.

	\paragraph{Процессор}\indent\keyb{F4}
	Дает возможность просматривать и редактировать процессор, к которому привязана
	технология.

	\paragraph{Системный журнал}\indent\keyb{Ctrl-J}
	При выборе этой команды на экране появится таблица системных событий по выбранной
	технологии.

	\paragraph{Печать}\indent\keyb{F7}
	Печать списка технологий.

	\paragraph{Фильтр}\indent\keyb{Ctrl-V}
	Изменение условий фильтрации таблицы.

\section{Технологические сессии}

Технологические сессий являются объектами учета использования процессоров и выпуска
(переработки) продукции на процессорах.

Для учета собственно использования процессоров используются заголовки технологических
сессий, строки же этих сессий используются для учета расхода сырья и выхода продукции.
Более того, в некоторых случаях технологические сессии могут быть использовании только
ради учета перемещения товаров и услуг.

\subsection{Классификаторы технологических сессий}

Перед тем, как перейти к детальному описанию атрибутов технологических сессий и методам
работы с ними, определим некоторые не очевидные классификаторы технологических сессий.

\subsubsection{Категории технологических сессий}

Все технологические сессии делятся на следующие категории:

\begin{description}
	\item[Обыкновенные технологические сессии]
	Эти сессии несут основную функциональную нагрузку в системе. Они учитывают использование
	процессоров и производство продукции на процессоре.
	Обыкновенные технологические сессии могут быть привязаны только к процессорам, но не к
	группам процессоров.

	Система строго следит за тем, чтобы обыкновенные сессии, относящиеся к одному процессору,
	и не имеющие статуса \ppyrsrv{Отменена}, не пересекались по времени.

	\item[Сессии простоев процессоров]
	Специализированная категория сессий, используемая для учета простоев процессоров. Сессия
	простоя не использует технологию, она привязывается к процессору, и, как правило, содержит
	статью причины простоя и описание причины простоя.
	Сессии простоев могут пересекаться по времени с обыкновенными технологическими сессиями,
	но не могут пересекаться с другими сессиями простоев, относящимися к одному процессору.

	\item[Суперсессии]
	Суперсессии предназначены для логического объединения обыкновенных сессий и сессий простоев.
	Чаще всего, суперсессии относятся к группам процессоров и соответствуют производственным
	сменам или рабочим дням.
	Система строго следит за тем, чтобы суперсессии, относящиеся к одной группе процессоров
	или процессору, и не имеющие статуса \ppyrsrv{Отменена}, не пересекались по времени.

	\item[Производственные планы]
	Специализированная категория, предназначенная для ведения производственных планов и
	отслеживания их выполнения.

	Как правило, производственные планы привязываются к группам процессоров. Все остальные
	категории технологических сессий существуют независимо от производственных планов.
	При этом по любому производственному плану можно рассчитать отчет, показывающий
	фактическое его выполнение на основании технологических сессий, попадающих в сферу
	применимости плана по признакам принадлежности процессора группе процессоров и по
	периоду использования.

	Так же как и в случае остальных категорий сессий, система следит за отсутствием пересечения
	по времени между планами, относящимися к одной группе процессоров, но, скажем, обыкновенные
	сессии и производственные планы свободно могут пересекаться (и должны пересекаться, поскольку,
	обыкновенные сессии - суть выполнение плана).
\end{description}

\subsubsection{Статусы технологических сессий}

Каждая технологическая сессия имеет один из пяти статусов:
\begin{itemize}
 	\item Планируемая
	\item В ожидании
	\item В работе
	\item Закрыта
	\item Отменена
\end{itemize}
Опишем все эти статусы подробно

\begin{description}
	\item[Планируемые сессии]
	Как следует из названия, такие сессии запланированы на будущие периоды. Предполагается, что
	планируемая сессия не обязательно будет запущена в работу.
	В планируемую сессию нельзя добавлять строки.

	\item[Сессии в ожидании]
	Сессии с этим статусом аналогичны планируемым, с небольшим смысловым нюансом, состоящим
	в том, что вероятность запуска в работу этих сессий близка к 100 процентам.
	В сессию, находящуюся в состоянии ожидания нельзя добавлять строки.

	\item[Работающие сессии]
	Работающая сессия находится в состоянии выполнения.

	Система следит за тем, чтобы для одного процессора в состоянии выполнения находилось не
	более одной технологической сессии.

	В работающую сессию могут добавляться строки.

	\item[Закрытые сессии]
	Закрытая технологическая сессия - это та, работа которой закончилась. Для того, что бы
	запустить в работу новую технологическую сессию, необходимо текущую сессию, имеющую
	статус \ppyrsrv{В работе} завершить (перевести в статус \ppyrsrv{Закрыта}).

	В закрытую сессию можно добавлять новые строки или изменять (удалять) существующие.
	Хотя это выглядит нелогичным, в реальной жизни иногда приходится вносить корректировки
	после закрытия сессии.

	Списывать можно только сессии, имеющие этот статус.

	\item[Отмененные сессии]
	Отмена технологической сессии практически эквивалентна ее удалению.
	Отмененная сессия не проверяется на пересечение по времени с другими сессиями, ее нельзя
	списать. Невозможно также изменить статус отмененной сессии.
\end{description}

\subsubsection{Завершенность технологических сессий}

Каждая технологическая сессия имеет значение завершенности, идентифицирующее статус списания
этой сессии.
Возможны три значения этого параметра:
\begin{description}
	\item[10] сессия не списана
	\item[0] сессия списана
	\item[5] списание сессии было отменено (был сделан откат списания)
\end{description}

\subsection{Связь технологических сессий с кассовыми чеками\label{sec-tsess-link-ccheck}}

При использовании технологических сессий в сфере услуг (гостиничный бизнес,
косметические и медицинские кабинеты и т.д.) часто возникает необходимость
в печати кассовых чеков на основании технологических сессий.

В системе \ppybrand{} реализован механизм совместного использования технологических
сессий с кассовыми чеками. Суть его состоит в том, что пользователь может вызвать
диалог кассовой панели из таблицы или диалога технологических сессий. При этом
автоматически сформируется чек, на основе выбранной сессии, который может быть
откорректирован и проведен через кассовый аппарат.

Существуют следующие особенности этого механизма:

\begin{itemize}
	\item Кассовый чек может быть сформирован только по закрытой сессии.
	\item Для того, чтобы по технологической сессии можно было сформировать
	кассовый чек необходимо, что бы в базе данных была как минимум одна запись
	синхронного кассового узла, связанного с тем же складом, с которым связан
	процессор, которому принадлежит технологическая сессия.
	\item Кассовый чек, созданный на основе технологической сессии не может
	быть отложен.
	\item В строки кассового чека попадают только те строки технологической
	сессии, в которых признак движения установлен в значение \dlgradioi{расход}.
	\item Если в чек из сессии не попадает ни одной товарной позиции, то
	этот чек все равно считается действительным: пользователь может
	самостоятельно добавлять строки в чек.
	\item Если технологическая сессия привязана к персональной карте, то
	кассовый чек получит привязку к той же персональной карте.
	\item Если технологическая сессия относится к процессору, у которого
	установлен признак \dlgflag{Дополнительный объект сессии списывать как агента}
	(см.~\pageref{loc-prcf-addedobjasagent}) и в сессии определена
	дополнительная статья, то эта статья становится агентом и в чеке.

	Если в результате предыдущей проверки агент по чеку определен не был,
	но процессор сессии связан с персоналией, имеющей связку со статьей,
	относящейся к таблице агентов, то эта статья становится агентом
	в чеке. Смысл этого абзаца состоит в том, что сотрудник (процессор),
	выполнявший работу является агентом при выполнении этой работы.
	\item Если по технологической сессии однажды был сформирован и проведен
	кассовый чек, то сессия \qu{запоминает} этот чек и больше по такой
	сессии чек не может быть сформирован.
\end{itemize}

\subsection{Диалог редактирования технологической сессии}

\ppypict{dlg-024}{Технологическая сессия}

Диалог технологической сессии показан на рис.~\ref{pic-dlg-024}
\footnote{На рисунке изображен \qu{искусственный} диалог, специально
смоделированный таким образом, чтобы на нем были видны все кнопки, которые
при разных обстоятельствах могут быть не видимы.}.

Следующая таблица описывает атрибуты технологической сессии.

\begin{description}
	\item[Номер сессии]
	Порядковый номер сессии по процессору. Этот номер система устанавливает автоматически.

	\item[ИД]
	Автоматически генерируемый системой уникальный идентификатор сессии.

	\item[\dlgflag{Простой процессора}]
	Если этот флаг установлен, то сессия попадает в категорию \qu{Простоев процессоров}. Обратите
	внимание на то, что этот флаг можно менять только у вновь создаваемой сессии. Изменять
	значение этого флага для существующей сессии система не разрешает.
	При установке признака \dlgflag{Простой процессора} в диалоге блокируется выбор технологии, а в
	комбо-боксе \dlgcombo{Доп статья} появляется возможность выбрать причину простоя, если в конфигурации
	технологических сессий определена таблица статей причин простоев процессоров.

	\item[\dlgcombo{Процессор}]
	Комбо-бокс выбора процессора. При вводе обыкновенной технологической сессии или сессии
	простоя здесь можно выбрать только собственно процессор, но не группу.
	При вводе суперсессии в этом комбо-боксе можно выбрать только группу процессоров.
	Если выбранному процессору соответствует только одна технология, то она немедленно будет
	установлена в комбо-боксе \dlgcombo{Технология}.

	\item[\dlgcombo{Технология}]
	Комбо-бокс выбора технологии. Этот комбо-бокс перестраивается при изменении процессора
	таким образом, чтобы в списке выбора отображались только те технологии, которые доступны
	для выбранного процессора.

	При выборе технологии, в информационном поле ниже отображается наименование товара,
	связанного с этой технологией.

	В действительности, выбор технологии напрямую не очень удобен по той причине, что код
	технологии, как правило, мало информативен. Если на один процессор существует более
	двух-трех технологий, правильнее выбирать технологию по товару, как описано в следующем
	пункте.

	\item[Кнопка выбора технологии \dlgbutton{По товару\dots}]
	При нажатии на эту кнопку, на экране появится список товаров, соответствующих технологиям,
	доступным для выбранного процессора. Выбрав нужный товар, щелкните по нему дважды мышью
	или нажмите кнопку \dlgbutton{Добавить} в списке выбора. При этом если с выбранными товаром и
	процессором связана только одна технология (наиболее типичный случай), то она сразу появится
	в поле \dlgcombo{Технология}. Если же выбранный товар связан более чем с одной технологией, то ее
	придется выбрать вручную в соответствующем комбо-боксе.

%	\dlgbutton{Создать товар\dots} &
%	Эта кнопка видна только в том случае, если выбран процессор и существует
%	автотехнология для этого процессора либо для одной из его родительских групп.
%
%	При нажатии этой кнопки появляется диалог создания нового товара. Если
%	пользователь создал товар и по этому товара автоматически была создана
%	технология, то эта технология становится выбранной в комбо-боксе
%	\qu{Технология} (если он был пустым). \eor

	\item[\dlgcombo{Суперсессия}]
	Комбо-бокс, позволяющий выбрать суперсессию, которой относится редактируемая сессия. Как
	правило, вручную выбирать суперсессию не приходится, поскольку если модель учета на
	предприятии предполагает ведение суперсессий, то новые сессии заводятся непосредственно
	в области действия этих суперсессий, и это поле заполняется автоматически.
	Менять суперсессию тоже приходится лишь в аварийных ситуациях.

	\item[\dlgcombo{Контрагент}]
	Контрагент сессии. Аналитическая таблица выбора контрагента зависит от вида операции
	списания, связанной с группой которой принадлежит процессор, по которому заводится эта
	технологическая сессия.
	Если новая технологическая сессия принадлежит какой-либо суперсессии, то автоматически
	наследует контрагента от этой суперсессии. Это, однако, не запрещает изменить контрагента
	вручную.

	\item[\dlgcombo{Доп статья}]
	Если вид операции списания, заданной в группе, которой принадлежит процессор, с которым
	связана эта сессия, определят вторую таблицу аналитических статей, то в этом комбо-боксе
	вы можете выбрать статью.

	Для сессий простоев этот комбо-бокс имеет специальное правило поведения: если в конфигурации
	технологических сессий определена таблица статей причин простоев процессоров, то список
	комбо-бокса позволит выбрать одну из причин, перечисленных в этой таблице статей.

	\item[Время начала]
	Дата и время начала сессии.
	При создании новой сессии, которая привязана к суперсессии, дата и время начала сессии
	устанавливаются в дату и время суперсессии.
	Для того чтобы установить в поле \qu{Дата} текущую дату, когда это поле выбрано, нажмите в
	нем \keyb{F2}. Если вы нажмете \keyb{F2} в поле \qu{Время}, то дата установится в текущую
	системную дату, а время - в текущее системное время.

	\item[Время окончания]
	Дата и время окончания сессии.
	Для сессий в статусе \ppyrsrv{В ожидании} и \ppyrsrv{Планируемая} при задании плана производства, дата
	и время окончания устанавливается исходя из производительности процессора, определенной
	для выбранной технологии.
	Для того чтобы установить в поле \qu{Дата} текущую дату, когда это поле выбрано, нажмите в
	нем \keyb{F2}. Если вы нажмете \keyb{F2} в поле \qu{Время}, то дата установится в текущую
	системную дату, а время - в текущее системное время.

	\item[\dlgbutton{Доступность процессора}]
	Если, при попытке указать время начала и окончания сессии, система сообщает вам, что в
	указанное время процессор занят, то с помощью кнопки \dlgbutton{Доступность процессора}
	вы сможете выбрать время, когда процессор будет свободен.

	При нажатии этой кнопки на экране появляется список периодов времени, когда процессор
	свободен. В списке - три колонки:
	\begin{itemize}
		\item период доступности с указанием времени начала и времени конца;
		\item продолжительность периода;
		\item объем продукции, который сможет произвести процессор за
		это время по технологии, выбранной в диалоге технологической сессии.
	\end{itemize}
	Список отсортирован от самых последних периодов к самым ранним.

	Вы можете выбрать один из периодов доступности, нажав кнопку
	\dlgbutton{Выбрать} (при этом время начала и окончания сессии заполнятся автоматически)
	или просто, сверившись с этим списком, указать время начала и окончания сессии вручную.

	\item[Плановый объем производства]
	В этом поле следует указывать объем выпуска продукции, который запланирован на эту сессию.
	При вводе значения плана, система автоматически рассчитывает время, необходимое процессору
	на выпуск этой продукции и вносит его в поле \qu{Планируемое время работы}. Время работы
	рассчитывается по производительности процессора, установленной в технологии, с которой
	связана эта сессия.

	Если сессия находится в статусе \ppyrsrv{Планируемая} или \ppyrsrv{В ожидании},
	то при этом также меняется время окончания сессии.

	\item[Планируемое время работы]
	Как правило, вручную это поле заполнять нет необходимости, поскольку, значение для него
	рассчитывается исходя из планируемого объема производства.

	\item[Завершенность]
	Информационное поле, указывающее уровень завершенности сессии. Значение завершенности сессии
	изменяется автоматически при операциях списания сессий, поэтому, вручную его менять нельзя.

	\item[Карта]
	При учете с помощью технологических сессий услуг, вы можете предоставлять клиентам скидки
	по персональным картам.

	\item[Заказ]
	При по-заказном производстве технологическая сессия может быть привязана к строке заказа
	от покупателя. Для выбора заказа, нажмите кнопку \dlgbutton{Заказы}. Заметим, что выбор заказа
	возможен только в том случае, если в сессии указана технология, и, соответственно, система
	\qu{знает} заказы на какую позицию следует показывать для выбора.

	\item[Примечание]
	Любой текст, который каким-либо образом характеризует эту технологическую сессию.
	Существенное значение это поле приобретает для сессий простоев. Как правило, для простоев,
	кроме формализованной причины, выбираемой из списка, необходимо дополнительное описание.

	\item[\dlgbutton{Строки сессии\dots}]
	При нажатии на эту кнопку откроется таблица строк технологической сессии.

	Перед появление таблицы сессия сохраняется в базе данных.

	\item[\dlgbutton{Кассовый чек\dots}]
	Эта кнопка видна в диалоге только в том случае, если выполняются все условия,
	необходимые для того, чтобы по технологической сессии можно было сформировать
	кассовый чек (см. стр.~\pageref{sec-tsess-link-ccheck}).

	При нажатии на эту кнопку появляется кассовая панель, в которой можно
	отредактировать и провести кассовый чек, сформированный по сессии.

	Перед появление кассовой панели сессия сохраняется в базе данных.
\end{description}

\subsection{Таблица технологических сессий}

Таблица технологических сессий предназначена как для ввода данных по сессиям, так и для
анализа технологических сессий. Для входа в таблицу технологических сессий выберите пункт
меню \ppymenu{Производство\rdir Технологические сессии}.

\subsubsection{Фильтр технологических сессий}

\ppypict{dlg-f-tsess}{Фильтр технологических сессий}

\begin{description}

	\item[\dlgcombo{Процессор}]
	Если вы хотите увидеть сессии только по одному процессору, то выберите здесь этот процессор.
	Если хотите увидеть все сессии по группе процессоров, то установите флаг  \dlgflag{Группа
	процессоров} - в комбо-боксе  \dlgcombo{Процессор} можно будет выбрать группу процессоров.

	При фильтрации по группе процессоров есть следующая особенность:
	Если установлен флаг \dlgflag{Только суперсессии}, то в таблице будут показаны
	только суперсессии, привязанные непосредственно к выбранной группе процессоров.

	Если же флаг \dlgflag{Только суперсессии} не установлен, то будут показаны сессии, относящиеся ко
	всем процессорам, относящимся к выбранной группе по всем уровням иерархии. То есть, если
	выбранная группа сама содержит подгруппы, то сессии, относящиеся к процессорам, привязанным
	к этим подгруппам, будут показаны наряду с сессиями процессоров, непосредственно привязанных
	к выбранной группе.

	\item[\dlgcombo{Технология}]
	Если вы хотите ограничить выборку сессий какой-либо одной технологией, то выберите ее в
	этом комбо-боксе. Обратите внимание, что список выбора комбо-бокса предлагает только те
	технологии, которые связаны с выбранным выше процессором (группой процессоров).

	\item[\dlgbutton{По товару}]
	Кнопка позволяет выбрать технологию по основному товару, к которому
	относится технология.

	Нажатие на кнопку не приведет ни к какому результату, если в диалоге
	не выбран процессор или группа процессоров.

	\item[Статус]
	В этом блоке переключателей вы можете отключить те, которые соответствуют статусам сессий,
	которые вы хотите пропустить в выборке.

	\item[\dlgcombo{Контрагент}]
	Если вид операции списания выбранного процессора (группы процессоров) определяет таблицу
	аналитических статей, то в этом комбо-боксе вы можете отфильтровать выборку одной из
	статей.

	\item[\dlgcombo{Доп статья}]
	Если вид операции списания выбранного процессора (группы процессоров) определяет
	дополнительную таблицу аналитических статей, то в этом комбо-боксе вы можете отфильтровать
	выборку одной из статей.
	При установке переключателя фильтрации простоев в положение \dlgradioi{Только простои} в этом
	комбо-боксе можно выбрать причину простоя (если таблица причин простоев процессоров
	определена в конфигурации технологических сессий).

	\item[Период начала]
	Период, в который должна попадать дата начала показываемых сессий.

	\item[Время начала]
	Если нижняя граница периода начала определена, то время начала отсекает сессии, дата
	начала которых соответствует нижней границе периода начала, а время начала меньше
	указанного в этом поле значения.

	Смысл использования этого параметра фильтрации можно продемонстрировать на следующем примере:
	Предприятие работает круглосуточно. Смены - 12-часовые, начинающиеся в 8:00 и в 20:00. При
	попытке получить отчет по сменам за период в один месяц (для определенности, март 2005 года),
	укажем в поле \qu{Период начала} значение 3/2005. При этом в выборку попадут сессии, начавшиеся
	и закончившиеся ночью или ранним утром 1-го марта. Эти сессии учтены отчетом за предыдущий
	месяц. Поэтому, мы их должны отсечь. Для этого в поле время начала устанавливаем время
	8:00.

	\item[Период завершения]
	Период, в который должна попадать дата окончания показываемых сессий.

	\item[Время завершения]
	Если верхняя граница периода завершения определена, то время завершения (если не нулевое)
	отсекает сессии, дата окончания которых соответствует верхней границе периода завершения,
	а время окончания больше указанного в этом поле значения.
	Иллюстрация смысла использования этого поля аналогична той, что описана в строке,
	посвященной полю \qu{Время начала}.

	\item[\dlgflag{Только суперсессии}]
	Если это флаг установлен, то будут показаны только суперсессии.

	\item[Переключатель фильтрации простоев]
	Определим три возможные положения этого переключателя:

	\begin{description}
		\item[Показывать простои] - если выбран этот вариант, то в выборке будут показаны как
		обыкновенные сессии, так и простои (если, конечно не установлен флаг  \dlgflag{Только
		суперсессии}: простои не бывают суперсессиями).
		\item[Не показывать простои] - при этом положении переключателя сессии простоев будут
		исключены из выборки.
		\item[Только простои] - при этом положении вы увидите только простои.
	\end{description}
\end{description}

\ppypictsc{brw-tsess}{}{0.4}

Кроме перечисленных в таблице параметров фильтрации, существует ряд параметров,
устанавливаемых неявно в зависимости от контекста, в котором показываются технологические
сессии. Так, если вы запрашиваете просмотр сессий, принадлежащих заданной суперсессии, то
фильтр показываемых сессий содержит ссылку на выбранную суперсессию, хотя в диалоге фильтра
выбрать суперсессию невозможно.

\subsubsection{Действия в таблице технологических сессий}
	\paragraph{Редактировать}\indent\keyb{Enter}
	Просмотр и редактирование выбранной технологической сессии.

	\paragraph{Добавить}\indent\keyb{Insert}
	Создание новой технологической сессии.
	В зависимости от условий фильтра, в диалоге ввода новой сессии будут автоматически заполнены
	некоторые поля. Если вы находитесь в списке сессий, относящихся к какой-либо суперсессии,
	то будет заполнен комбо-бокс \dlgcombo{Суперсессия} и время начала будет соответствовать времени
	начала суперсессии.

	Если в фильтре определен процессор, то в диалоге новой сессии будет установлен этот
	процессор.

	\paragraph{Удалить}\indent\keyb{Delete}
	Удаление выбранной сессии. Возможность удаления технологических сессий регламентируется
	правами доступа.

	Если сессия списана, то система предложит выбрать одно из двух действий: откатить результаты
	списания или полностью удалить сессию. Откат результатов списания является обратимой
	операцией - сессию можно снова списать, а полное удаление сессии - необратимо.
	При удалении суперсессии удаляются также все сессии, являющиеся для нее дочерними.

	\paragraph{Строки сессии}\indent\keyb{F3}
	Если выбранная сессия является суперсессией, то по этому действию вы сможете увидеть
	обыкновенные сессии, относящиеся к выбранной суперсессии.
	Для обыкновенной сессии, по этой команде вы увидите строки выбранной сессии.

	\paragraph{Фиксированные остатки}\indent\keyb{F6}
	Просмотр фиксированных остатков по сессии.
	Судя по всему, технология фиксации остатков отомрет из-за чрезмерной сложности и
	неадекватности реальным потребностям предприятий.

	\paragraph{Процессор}\indent\keyb{F2}
	Просмотр карточки процессора, соответствующего выбранной сессии

	\paragraph{Технология}\indent\keyb{F4}
	Просмотр карточки технологии, соответствующей выбранной сессии

	\paragraph{Другие сессии процессора}\indent\keyb{Ctrl-S}
	По этой команде вы можете увидеть все сессии процессора, соответствующего выбранной сессии.
	Заметим, что в эту функцию встроена защита от рекурсии, то есть, по этой команде на экран
	будет также выведена таблица сессий, однако если вы и в ней попробуете выполнить такую
	команду, то это ни к чему не приведет.

	\paragraph{Анализ сессий}\indent\keyb{Ctrl-F3}
	Позволяет подробно проанализировать выбранную сессию или всю выборку сессий в различных
	ракурсах. Подробно анализ технологических сессий рассмотрен ниже.

	\paragraph{Рассчитать автоматическое списание}\indent\keyb{Ctrl-F8}
	По этой команде система формирует строки выбранной сессии, в соответствии с правилами,
	заданными в структуре основного товара сессии. То есть, в список строк автоматически
	добавляются те товарные позиции, которые входят в структуру, ассоциированную с
	технологией сессии и имеют в этой структуре признак \dlgflag{Автосписание в техн сессиях}.

	Заметим, что эта функция применима только к сессиям, имеющим статус \ppyrsrv{Закрыта}.
	Для сессий с другими статусами система выдаст соответствующее сообщение об ошибке.

	\paragraph{Списать сессию}\indent\keyb{Ctrl-W}
	Списание выбранной технологической сессии. Подробно списание технологических сессий
	будет рассмотрено ниже.

	\paragraph{Документы списания}\indent\keyb{F5}
	По этой команде вы можете увидеть документы списания выбранной технологической сессии,
	а также документы, добавленные в пул этой сессии вручную.

	\paragraph{Документы покрытия дефицита}\indent\keyb{Shift-F5}
	По этой команде вы можете увидеть документы покрытия дефицита, сформированные по
	результатам попытки списания сессии, окончившегося неудачей из-за дефицита каких-либо
	товарных позиций.

	\paragraph{Загрузка сессии в кассовую панель}\indent\keyb{F8}
	Эта функция актуальна только в том случае, если выполняются все условия,
	необходимые для того, чтобы по технологической сессии можно было сформировать
	кассовый чек (см. стр.~\pageref{sec-tsess-link-ccheck}).

	При вызове этой функции откроется диалог кассовой панели, в которую
	будет загружен чек, сформированный по выбранной технологической сессии.

	\paragraph{Системный журнал}\indent\keyb{Ctrl-J}
	Просмотр системных событий по выбранной технологической сессии.

	\paragraph{Печать}\indent\keyb{F7}
	Выводит на печать текущую сессию.

	Стандартная форма отчета: TSession.

	\paragraph{Печать выборки сессий}\indent\keyb{Alt-F7}
	Печать списка всех технологических сессий, попавших в выборку. Если в фильтре сессий
	переключатель фильтрации простоев установлен в положение \dlgradioi{Только простои}, то будет
	печататься специализированная форма по простоям процессоров.

	Стандартная форма отчета:
	\begin{itemize}
		\item Для обыкновенных сессий: TSessView.
		\item Для сессий простоев: TSessIdleView.
	\end{itemize}

	\paragraph{Итоги}\indent\keyb{F9}
	Просмотр итоговой информации по выборке сессий

	\paragraph{Фильтр}\indent\keyb{Ctrl-V}
	Изменение условий фильтрации.

	\paragraph{Проверка и восстановление сессий}\indent\keyb{Ctrl-R}
	Служебная функция. Применялась в ранних версиях системы для корректировки ошибок,
	выявленных в процессе пилотных запусков.

	Вызов этой команды без консультаций со специалистами, сопровождающими систему, не
	рекомендуется, однако вреда не принесет.

\section{Строки технологических сессий}

Строки технологических сессий несут в себе информацию о том, какой товар, в каком количестве
и когда был произведен или израсходован в ходе технологической сессии.
Система предоставляет три основных способа ввода строк технологических сессий:

\begin{description}
	\item[Стандартный] с помощью диалога, вызываемого из таблицы строк технологических
	сессий. Этот способ, как правило, используется при вводе данных о производстве в офисе
	или при корректировке данных
	\item[Панель процессора] упрощенный способ ввода, позволяющий быстро собирать данные
	непосредственно на месте производства. При этом такое рабочее место должно быть оборудовано
	компьютером с установленной на нем клиентской частью системы \ppybrand{}.
	\item[Терминал сбора данных] так же как и панель процессора, этот способ предназначен для
	сбора данных непосредственно на месте производства или перемещения товаров. Этот способ
	применяется тогда, когда рабочее место не может быть оборудовано компьютером или в том
	случае если сбор данных сопряжен с постоянным перемещением по большой территории.
\end{description}

\subsection{Таблица строк технологических сессий}

\ppypictsc{brw-tsessln}{}{0.5}

Основным средством просмотра и редактирования строк технологических сессий является таблица
технологических сессий.
Внешний вид этой таблицы показан на рисунке.
Колонки этой таблицы отражают следующую информацию:

\begin{description}
	\item[Знак] показывают является ли строка расходной или приходной. У расходной строки
	стоит знак - (минус), у приходной + (плюс).
	\item[Признак] если строка рассчитана и создана автоматически в результате автосписания,
	то для такой строки в этой колонке стоит символ A . Если строка появилась в результате
	автосписания на основе нормативов перенастройки оборудования, то для такой строки в этой
	колонке стоит символ T .
	\item[Товар] наименование товара, который был произведен или израсходован
	\item[Количество] количество торговых единиц товара, перемещенных в результате
	зафиксированной этой строкой операции.
	\item[Физических единиц] количество физических единиц, перемещенных в результате
	зафиксированной этой строкой операции. Если учет физических и торговых единиц по товару
	ведется раздельно, то здесь показывается независимо введенное количество физических единиц,
	в противном случае, величина в этой колонке равна произведению количества из предыдущей
	колонки на соотношение физических единиц к торговым, заданного для этого товара.
	\item[Цена] если конфигурация технологических сессий предполагает ценовой учет в строках
	сессий, то в этой колонке будет отражена цена одной торговой единицы товара.
	\item[Серийный номер] номер серии израсходованной или произведенной (оприходованной)
	партии товара.
	\item[Дата, время] момент формирования строки. Эти значения формируются автоматически
	при создании строки.
	\item[Оператор] оператор, который сформировал строку. Этим значением управлять
	невозможно - оно формируется автоматически при создании новой строки.
\end{description}

\subsubsection{Действия в таблице строк технологических сессий}

Таблица технологических сессий допускает следующие операции

	\paragraph{Редактировать}\indent\keyb{Enter}
	Редактирование выбранной строки

	\paragraph{Добавить}\indent\keyb{Insert}
	Добавление новой строки

	\paragraph{Удалить}\indent\keyb{Delete}
	Удаление выбранной строки

	\paragraph{Выбрать товар}\indent\keyb{F2}
	Расширенное добавление строки, предваряемое списком выбора товара. Если технологическая
	сессия привязана к технологии, которая, в свою очередь, ассоциирована с товарной
	структурой, то в списке выбора будут представлены только те позиции, которые определены
	в этой структуре. В противном случае, в списке можно выбрать любой товар.

	\paragraph{Рассчитать автоматическое списание}\indent\keyb{Ctrl-F8}
	Для закрытых и не списанных сессий, автоматически формирует строки по товарным позициям,
	которые не были указаны вручную, и для которых определены параметры автоматического
	списания. Кроме того, если для процессора, к которому привязана сессия, определены
	технологии перенастройки, то система пытается списать расходы на перенастройку.

	\paragraph{Лоты}\indent\keyb{F3}
	Просмотр лотов по товару, которому соответствует выбранная строка.

	\paragraph{Печать этикеток по строке}\indent\keyb{Ctrl-L}
	Вывод этикеток по выбранной строке на принтер штрихкодов.

	\paragraph{Печать}\indent\keyb{F7}
	Печать списка строк

	\paragraph{Итоги}\indent\keyb{F9}
	Показывает диалог итоговых значений по выборке строк.

\subsubsection{Диалог строки технологической сессии}

Перечислим поля этого диалога и доступные в нем операции.

\ppypict{dlg-tsessln}{Строка технологической сессии}

\begin{description}
	\item[Описатель технологической сессии в верхней части диалога]
	Указывает, к какой технологической сессии относится редактируемая (создаваемая) строка.
	\item[\dlgcombo{Группа}] Группа, к которой относится товар, учитываемый этой строкой.
	\item[\dlgcombo{Товар}] Товар, учитываемый этой строкой. Любая строка технологической сессии должна
	ссылаться не существующий товар.
	\item[Время операции] Дата и время регистрации операции. Эти значения особенно существенны для технологических
	сессий, учитываемых в реальном времени.
	При создании новой строки поля даты и времени заполняются автоматически значениями текущего момента.
	\item[Переключатель направления движения товара] Этот переключатель определяет направление движения товара
	в регистрируемой строкой операции.
	\begin{description}
		\item[\dlgradioi{Расход}] Выбор этого значения переключателя означает, что строка
		отражает расход компонента в процессе работы сессии.
		\item[\dlgradioi{Выход}] Отражает приход (производство) товара в течении сессии.
		\item[\dlgradioi{Использование}] Применяется тогда, когда строка отражает не перемещение товара, а
		его состояние (например, остаток).
	\end{description}

	При создании строки, после того как пользователь выбрал товар, система самостоятельно
	пытается определить наиболее вероятный знак операции и устанавливает этот переключатель в
	соответствии с этим.

	\item[\dlgflag{Остаток}]
	Используется в том случае, когда строка фиксирует остаток некоторого товара на конец сессии.
	Эта опция применяется для учета переходящих остатков между сессиями.

	\item[Количество]
	В этом поле указывается количество торговых единиц товара, участвующих в операции. Значение
	в этом поле не может быть отрицательным: знак операции целиком определяется переключателем
	\dlgradioc{Расход/Выход/Использование}.

	\item[Индикатор количества физических единиц]
	Если по товару нет (как обычно бывает) независимого учета в физических единицах, то справа
	от поля количества высвечивается наименование физической единицы измерения товара и количество
	физических единиц, пересчитанное из количества торговых единиц по соотношению, заданному в
	товаре.

	\item[Физическое количество (на рисунке не показано)]
	Если по товару ведется независимый учет в торговых и физических единицах, то в этом поле
	можно указать количество расходуемых или приходуемых физических единиц товара.

	\item[Серийный номер]
	В этом поле показывается серийный номер партии товара, расходуемой этой строкой или
	приходуемой. При производстве или приходовании продукции извне серийный номер генерируется
	автоматически по шаблону, определенному в конфигурации документов.
	Обратите внимание, что изменение этого поля заблокировано, так как при расходовании вы
	выбираете серийный номер до того как этот диалог покажется на экране, а при приходовании
	серийный номер, как уже говорилось, создается автоматически. Система не позволяет произвольно
	менять эту строку из-за риска возникновения несоответствия между серийным номером и товаром.
\end{description}

\section{Списание технологических сессий} % @construction

Процесс списания технологических сессий состоит в преобразовании этих сессий и
соответствующих им строк в учетные документы.

Технические аспекты списания сессий достаточно сложны поскольку содержат
множество нюансов настройки. С другой стороны, для конечного пользователя сам
процесс списания не содержит каких либо значительных трудностей.

\subsection{Технические особенности списания}

И так, рассмотрим некоторые технические особенности списания технологических
сессий:

\begin{itemize}
	\item Контрагентом документа списания будет контрагент технологической сессии
	\item Дополнительный объект технологической сессии становится одним из
	атрибутов документа списания по следующим правилам:
	\begin{itemize}
		\item Если вид операции списания определяет дополнительную таблицу
		аналитического учета, то дополнительный объект сессии становится дополнительным
		объектом документа списания.
		\item Если предыдущее условие не выполняется, но группа процессора,
		которому принадлежит сессия имеет установленный признак
		\dlgflag{Дополнительный объект сессии списывать как агента}
		(стр.~\pageref{loc-prcf-addedobjasagent}), то дополнительный
		объект сессии станет агентом по документу списания.
		\item Если технологическая сессия имеет признак \dlgflag{Простой процессора},
		и в конфигурации технологических сессий определена таблица статей
		причин простоев процессоров, то %@construction
	\end{itemize}
	\item На основе технологической сессии генерируется документ, принадлежащий
	виду операции, определенному в группе процессора, к которому относится эта сессия.
	\item Если документ относится к типу операции \ppyrsrv{Модификация товара}, то
	в него попадут строки сессии, имеющие знак операции '+' или '-'.
	\item Если документ относится к типу операции \ppyrsrv{Расход товара}, то
	в него попадут строки сессии, имеющие знак операции '-'.
	\item Если документ относится к типу операции \ppyrsrv{Приход товара}, то
	в него попадут строки сессии, имеющие знак операции '+'.
\end{itemize}

\section{Конфигурация технологических сессий}

\ppypict{dlg-083}{Конфигурация технологических сессий}

Для просмотра и (или) редактирования конфигурации технологических сессий выберите пункт
меню \ppymenu{Админ\rdir Прочие конфигурации\rdir Конфигурация технологических сессий}.

Права доступа к этой конфигурации регламентируются наличием соответствующего элемента в
списке доступных конфигураций в профиле пользователя или группы.

Вид диалога конфигурации показан на рис.~\ref{pic-dlg-083}. Следующая таблица перечисляет
и объясняет поведение управляющих элементов этого диалога.

\begin{description}
	\item[\dlgcombo{Таблица статей причин простоев процессов}]
	Если на вашем предприятии учитываются простои процессоров, то в этом комбо-боксе можно
	указать таблицу аналитических статей, характеризующих причины простоев процессоров.
	При этом система позволяет получать отчетность по простоям процессоров в разрезе этих
	аналитических статей.

	\item[\dlgcombo{Технология для повременных сессий по умолчанию}]

	\item[\dlgflag{Изменять время сессий при изменение статуса}]
	Если это флаг включен, то при ручном изменении статуса технологической сессии, время
	начала сессии будут изменяться в соответствии со следующими правилами:
	\begin{itemize}
		\item При начальной установке статуса \ppyrsrv{В работе} либо при переходе
		в такой статус из статусов \ppyrsrv{Планируемая} либо \ppyrsrv{В ожидании}
		время начала устанавливается в текущее, а время окончания рассчитывается как
		текущее время плюс планируемое время плюс время на перенастройку
		\item При переходе из статуса \ppyrsrv{В работе} в статус \ppyrsrv{Закрыта}
		время начала остается прежним, а время окончания устанавливается в
		значение текущего системного времени (если этот флаг не установлен и
		время окончания сессии нулевое, то оно все равно устанавливается в
		текущее время при таком изменении статуса).
	\end{itemize}

	\item[\dlgflag{Использовать цены в сессиях}]
	Если этот флаг включен, то система будет связывать с технологическими сессиями ценовые
	значения.

	Эта опция важна, если вы применяете технологические сессии для учета услуг, связанными с
	загрузкой людей, оборудования или помещений (например, в гостиничном бизнесе).

	\item[\dlgflag{Допускать ввод строк в ожидающих сессиях}]
	При включенном флаге система разрешает добавлять строки в технологические сессии,
	статус которых \ppyrsrv{Планируемая} или \ppyrsrv{В ожидании}.

	Необходимость в этом может возникнуть тогда, когда для не начавшегося еще
	процесса известен результат (по крайней мере, частично) расходов и приходов.

	\item[\dlgflag{Допускать ввод строк в списанных сессиях}]
	Этот флаг позволяет пользователям модифицировать строки сессии,
	которая уже списана.

	В общем случае не желательно устанавливать данных признак, поскольку
	модификация строк списанной сессии требует дополнительных действий
	по откату списания и новому списанию сессии. Если этого не сделать,
	то может возникнуть рассогласование между результатами списания сессии и
	ее содержимым.

	\item[\dlgflag{Выравнивать время по временной диаграмме}]
	Флаг, влияющий на поведение временной диаграммы занятости процессоров.
	Если флаг установлен, тогда при двойном щелчке в диаграмме с целью
	создания новой сессии время начала этой сессии будет округляться
	до ближайшего кванта диаграммы (см. параметр ниже).

	Для примера, если квант диаграммы 600 секунд (10 минут) и пользователь
	щелкнул мышью на участке, соответствующем, скажем, 15 часам 33 минутам и
	6 секундам, то откроется диалог новой сессии, в которой время начала будет
	равно 15:30:00.

	\item[\dlgflag{Изменять ручные строки при автозаполнении сессии}]

	\item[Минимальная продолжительность простоя (сек)]
	Опция, применяемая для учета простоев в панели процессора.
	Если зафиксированный простой по продолжительности меньше
	указанного здесь времени, то в базе данных не будет
	фиксироваться сессия простоя.

	\item[Расчетное время для повременных позиций]

	\item[Период округления для повременных позиций (сек)]

	\item[Период обновления таблиц сессий и строк (сек)]
	В этом поле может быть указано промежуток времени, через который
	происходит обновление таблицы технологических сессий
	и строк сессий для отображения изменений, внесенных другими
	пользователями системы.

	\item[Квант времени во временной диаграмме (сек)]
	Минимальная размерность шкалы времени во временной диаграмме
	занятости процессоров.

	\item[\dlgbutton{Цвета статусов...}]
	Кнопка открывает диалог, в котором можно выбрать цвет, соответствующий
	статусам технологических сессий, отображаемых на временной диаграмме.

	\item[\dlgbutton{Параметры авто-sms...}]
\end{description}

\section{Занятость процессоров}

Техника анализа занятости процессоров необходима, в первую очередь, для приема заявок от
потребителей на загрузку процессоров. Ярким примером использования этой техники является
гостиничный бизнес, где операторы у стойки расселяют постояльцев по номерам исходя из
наличия свободных номеров, а отдел бронирования резервирует номера на будущие периоды.

На производственных предприятиях отдел планирования загружает станки производственными
заказами также исходя из условий доступности этих станков на тот или иной период времени.
В системе \ppybrand{} анализ занятости (доступности) процессоров реализован в виде отдельной
таблицы, управляемой, как и большинство остальных таблиц, через фильтр.

\subsection{Фильтр занятости процессоров}
Для просмотразанятости процессоров выберите пункт
меню \ppymenu{Производство\rdir Занятость процессоров...}.

\ppypict{dlg-093}{Диалог фильтра занятости процессоров}
Диалог фильтра показан на рис.~\ref{pic-dlg-093}. Далее следует описание управляющих элементов
этого диалога.

\begin{description}
	\item[\dlgcombo{Процессор}]
	В этом комбо-боксе может быть выбран процессор либо группа процессоров,
	по которым следует отображать отчет.
	\item[Время начала] Дата и время начала анализируемого периода.
	\item[Время окончания] Дата и время окончания анализируемого периода.
	\item[Минимальная продолжительность периода]
	Если в этом поле задано не нулевое значение времени, то в отчет
	попадут только те отрезки занятости процессоров, продолжительность
	которых больше или равна этому времени.
	\item[\dlgflag{Свободные периоды}]
	При установленном флаге рассчитывается отчет, в котором отображаются промежутки
	между периодами занятости процессоров. Такой отчет может быть полезен для %
	нахождения отрезков времени, когда процессор или процессоры свободны.
	\item[\dlgflag{Показывать временную диаграмму}]
	Если этот флаг включен, то сразу вслед за таблицей занятости процессоров
	откроется временная диаграмма. Флаг применяется в том случае, если основная %
	работа с отчетом ведется с помощью временной диаграммы, а не таблицы.
\end{description}

\subsection{Таблица занятости процессоров}

\ppypict{Brw-023}{Таблица занятости процессоров}

\subsubsection{Действия в таблице занятости процессоров}
	\paragraph{Добавить сессии}\indent\keyb{Insert}	Вызывает диалог редактирования новой технологической сессии.
	\paragraph{Процессор}\indent\keyb{F2} Показывает диалог редактирования процессора, соответствующего выбранной технологической сессии.
	\paragraph{Все сессии процессора}\indent\keyb{Ctrl-S} Показывает таблицу всех сессий для процессора, соответствующего выбранной технологической сессии.
	\paragraph{Печать}\indent\keyb{F7}	 Позволяет отпечатать либо экспортировать отчет по занятости процессоров.
	\paragraph{Фильтр}\indent\keyb{Ctrl-V} Вызывает диалог фильтра текущей таблицы где вы можете изменить условия фильтрации.
	\paragraph{Занятые процессоры}\indent\keyb{Ctrl-T} Переключает режим просмотра таблицы между вариантами \qu{Занятые процессоры/Свободные процессоры}.
	\paragraph{Временная диаграмма}\indent\keyb{Ctrl-A} Открывает окно временной диаграммы занятости процессоров.
\subsection{Временная диаграмма занятости процессоров}

\ppypict{Brw-024}{STimeChunkBrowser}

На временной диаграмме слева перечислены имеющиеся процессоры, сверху указаны дата и
время.

Для создания новой технологической сессии на пересечение процессора, для которого
создается сессия и выбранного времени, двойным щелчком вызывается диалог редактирования
технологической сессии. Этот же диалог вызывается для редактирования уже созданных
технологических сессий.

Для изменения масштаба временной сетки  достаточно навести курсор, на линию указанную
стрелкой №1, при появлении двухсторонней стрелки нажмите левую клавишу мыши и, удерживая,
двигайте влево или вправо.

Для масштабирования поля процессора используются линии указанные стрелками  №2 и №3.Для
горизонтального масштабирования линию под стрелкой №2 двигайте вправо или влево, для
вертикального - линию над стрелкой №3 двигайте вверх или вниз.

Для изменения продолжительности технологической сессии используется крайняя линия этой
сессии, указанная стрелкой №4, двигая влево или вправо, в сессии меняется время работы.
Технологическую сессию можно передать другому процессору, для этого при наведении курсора
в верхний левый угол появляется четырехсторонняя стрелка, нажмите на нее и, удерживая,
перетаскивайте  в поле любого процессора.

При выведение курсора из рабочего поля, в поле с разметкой курсор превращается в календарь.
При двойном щелчке левой клавиши мыши откроется календарь, в котором можно указать дату для
быстрого перехода к ней. При нажатии на кнопку \dlgbutton{Сегодня}, временная диаграмма будет
начинаться с текущего времени,  при выборе иной даты осуществиться переход на 8 часов
указанной даты.

\section{Анализ технологических сессий}

Анализ технологических сессий предназначен для группировки данных строк технологических
сессий по различным критериям.
Вы можете получить анализ технологических сессий как по одной сессии, так и по выборке.
Кроме того, предусмотрена возможность анализа технологических сессий в привязке к
производственному плану.

Суть анализа состоит в том, что система собирает все строки сессий, участвующих в анализе,
группирует их по заданным критериям и сопоставляет количественные характеристики строк
сессий на уровне товарных позиций с запланированными величинами. В дополнение к этому,
система позволяет детализировать строки отчета, что дает еще один инструмент анализа
данных и поиска проблем.

\subsubsection{Вызов анализа технологических сессий}

Анализ технологических сессий может быть вызван либо из таблицы сессий, либо из таблицы
производственных планов.
В первом случае фактические величины сопоставляются с запланированными на уровне сессий,
а во втором, на уровне производственного плана.
В обоих случаях для вызова отчета используются клавиши  \keyb{Ctrl-F3}.

\subsubsection{Фильтр анализа технологических сессий}

\ppypict{dlg-f-015}{Фильтр анализа технологических сессий}

\begin{description}
	\item[\dlgradioc{Переключатель выборки сессий}]
	Определяет область охвата сессий отчетом:
	\begin{description}
		\item[Только по текущей сессии] Отчет будет строиться только
		по выбранной технологической сессии.
		\item[По всей выборке] Отчет будет строиться по всей выборке
		сессий, определенной фильтром.
	\end{description}

	\item[\dlgradioc{Переключатель дифференциации отчета по процессору}]
	Определяет вариант детализации отчета по процессору и связанным с ним атрибутам:
	\begin{description}
		\item[Нет] Отчет будет не детализируется по процессору.
		\item[Дифференц по процессорам] Отчет детализируется собственно по
		процессорам, к которым относятся технологические сессии, входящие в отчет.
		\item[Дифференц по группам процессоров] Отчет детализируется по
		группа процессоров (подразумевается самый нижний уровень
		группировки процессоров, то есть, непосредственная родительская %
		группа каждого из процессоров).
		\item[Дифференц по статьям] Отчет детализируется по товарам и
		основным статьям технологических сессий.
	\end{description}

	\item[\dlgradioc{Переключатель дифференциации отчета по основному товару}]
	Определяет вариант детализации отчета по основному товару сессии и связанным с ним атрибутам:
	\begin{description}
		\item[Нет] Отчет не дифференцируется по основному товару.
		\item[Дифференц по основному товару] Отчет детализируется по
		основному товару сессий.
		\item[Диффиренц по группе основного товара] Отчет
		детализируется по группе основного товара сессий.
		Под группой подразумевается непосредственная родительская группа,
		которой принадлежит товар.
	\end{description}

	\item[\dlgradioc{Переключатель дифференциации отчета по дате}]
	Определяет вариант детализации отчета по дате либо по суперсессии:
	\begin{description}
		\item[Нет] Отчет не дифференцируется по дате.
		\item[Диффиренц по дате] Отчет детализируется по дате технологических
		сессий.
		\item[Диффиренц по суперсессиям] Отчет детализируется по суперсесиям.
	\end{description}

	\item[\dlgflag{Общий итог по всем позициям}]
	Если этот флаг установлен, то отчет будет содержать в нижней своей
	части зону, в которой показаны итоговые значения по каждой товарной
	позиции, входящей в отчет.

	Таким образом, если отчет содержит одну позиции во множестве строк,
	итоговая зона просуммирует все эти строки.

	\item[\dlgflag{Только основные товары}]
	Если флаг установлен, то в отчет войдут только основные товары
	технологических сессий, по которым он строится.

	\item[\dlgflag{Показать Фиксированные остатки}]

	\item[\dlgflag{Проецировать план только на отработанный период}]

	\item[\dlgflag{Интерполировать план по статьям}]

	\item[\dlgflag{Рассчитывать доли компонентов}]

	\item[Подстановка товара]

	\item[Обобщать по группе неосновных товаров]

	\item[Ограничить группу неосновных товаров]

	\item[Ограничить все товары выбранной группой]

\end{description}

\section{Панель процессора}

\ppypictsc{dlg-094}{Панель операций процессора}{0.5}

Панель процессора предназначена для максимального упрощения ввода данных
по технологическим сессиям непосредственно на местах производства или
оказания услуг.

\begin{description}
	\item[Процессор]

	\item[Текущая сессия]

	\item[Основной товар]

	\item[Товар]

	\item[Серийный номер]

	\item[Упаковок]

	\item[Количество]

	\item[Знак]

	\item[Емкость упаковки]

	\item[Выбор товара по коду]

	\item[Выбор основного товара]

	\item[Печать последней этикетки]

	\item[Перевести процессор в состояние простоя]

	\item[Остановить текущую сессию]

	\item[Выход]

	\item[Количество торговых единиц]

	\item[Количество упаковок]

	\item[Всего]

	\item[Упаковок]

	\item[Единиц]
\end{description}

\chapter{Персональные карты\label{ch-scard}}

Система \ppybrand{} позволяет в полном объеме использовать достоинства дисконтных и
корпоративных кредитных карт при обслуживания клиентов вашего предприятия.
Поддерживается следующая функциональность для работы с картами:
\begin{itemize}
	\item	Ведение базы данных персональных карт раздельно по сериям выпуска
	\item	Автоматическое формирование справочника карт по заданному шаблону
	\item	Возможность наследования картами свойств серии
	\item	Автоматическое изменение параметров карт (процент скидки, принадлежность к серии)
	в зависимости от оборотов
	\item	Загрузка данных о картах в кассовые аппараты, работающие в режиме асинхронных
	кассовых сессий
	\item	Обработка карт через синхронные кассовые сессии
	\item	Ввод отгрузочных документов по картам
	\item	Анализ информации об операциях по картам
\end{itemize}

\section{Ведение базы данных карточек}

\subsection{Серии персональных карт}

Создание базы данных карточек начинается с формирования записи или записей о сериях карт.
Обычно серия ассоциируется с отдельным выпуском карт, но это не обязательно. Так, несколько
выпусков могут быть в одной серии, равно как и несколько серий могут содержать карточки из
одного выпуска.

\ppynote{
	Существенным свойством серий является то, что одна серия может объединять в себе
	одновременно только карты, принадлежащие одному типу (дисконтные, кредитные либо бонусные).
}

Для обращения к справочнику серий выберите пункт меню \ppymenu{Справочники\rdir Персоналии\rdir
Серии персональных карт}.

Диалог редактирования серии выглядит так, как показано на рис.~\ref{pic-dlg-111}.

%topic(DLG_SCARDSER)

\ppypict{dlg-111}{Диалог редактирования серии персональных карт}

\begin{description}
	\item[Наименование]
	Наименование серии. Это может быть любая строка, отличающаяся от наименований других
	серий.

	\item[Ид]
	Внутреннее поле, необходимое для идентификации серии внутри базы данных. Его нельзя
	изменять.

	\item[Шаблон нумерации]
	Специальная строка, используемая для автоматического формирования справочника карточек
	по серии. См. ниже.

	\item[\dlgradioc{Тип карт}]
		Определяет тип карт, входящих в серию.
		\ppynote{
			Не изменяйте этот признак, если карты, принадлежащие этой серии,
			уже находятся в обороте.
		}
		\begin{description}
			\item[\dlgradioi{Дисконтные карты}]
			Обыкновенные карты, предоставляющие право клиента на скидку.

			\item[\dlgradioi{Кредитные карты}]
			Карты, на которые могут начисляться средства с возможностью последующиго
			их использования владельцем для покупки товаров и услуг.

			Кредитные карты также могут предоставлять право на скидку.

			\item[\dlgradioi{Бонусные карты}]
			Эти карты похожи на кредитные, но с той разницей, что сумма на них
			начисляется периодически по результатам продаж.

			Бонусные карты также могут предоставлять право на скидку.

			\item[\dlgradioi{Группирующая серия}]
			Если переключатель установлен в это положение, то серия является папкой верхнего
			уровня, в которую могут быть включены иные серии.
		\end{description}

	\item[\dlgcombo{Вид котировки}]
	Если для серии карт задан вид котировки, то цена по картам, относящимся к этой серии
	определяется исходя из заданного вида котировки.
	Вместе с тем, что эта опция предоставляет вам обширные возможности по управлению схемами
	дисконтирования покупателей, обратите внимание на следующие моменты:
	\begin{enumerate}
		\item	Сама по себе техника управления ценами через котировки намного
		сложнее, чем простая процентная скидка. Поэтому вам следует очень внимательно
		подходить к вопросу назначения соответствующих котировок.
		\item	Не все кассовые модули допускают загрузку сложных схем
		ценообразования по дисконтным картам. Те же, которые предоставляют
		соответствующие сервисы могут иметь множество особенностей при работе с ними.
	\end{enumerate}

	Кнопка \dlgbutton{...} справа от этого комбо-бокса позволяет выбрать список
	видов котировок, которые могут быть применены для назначения цены.
	Если выбран список, то в конкретном случае применяется существующая котировка
	вид которой имеет максимальный ранг и ограничивающие условия которой позволяют
	ее применить.

	Флаг \dlgflag{Применять минимальное значение из списка котировок} меняет
	способ выбора цены таким образом, что конечное значение определяется минимумом
	по всем видам котировок из списка, которые удовлетворяют ограничивающим
	условиям.

	\item[\dlgcombo{Вид персоналии}]
	Вид персоналий, связываемых с картами, подчиненными этой серии.
	Если вид персоналии здесь не определен, то система считает, что владельцы
	карт этой серии относятся к зарезервированному виду \ppyrsrv{Покупатели}.

	\item[\dlgcombo{Товарная группа списания кредита}]
	Комбо-бокс доступен только для кредитных карт.

	Его назначение состоит в том, чтобы переопределить принцип
	начисления и списания кредита с суммового на количественный.

	Если в комбо-боксе задана товарная группа (допускается использование как
	обыкновенной так и альтернативной группы), то ваше предприятие выдает
	клиенту, вместе с начислением на карты этой серии, не денежный, а
	товарный кредит. То есть, позволяет приобрести определенное количество
	товаров из выбранной здесь группы.

	\ppyexample{
		Например, если вы продаете абонементы на пользование солярием и
		карты этой серии используются как эти абонементы, то выберите
		в комбо-боксе \dlgcombo{Товарная группа списания кредита} группу,
		в которую входят услуги солярия (быть может, в ней будет только
		один товар).

		Далее, начислив на карту 30 минут и отдав ее клиенту за какую-то
		сумму, вы тем самым продаете ему возможность провести в солярии
		в общем 30 минут.

		При продаже клиенту услуг солярия через кассовую панель администратор
		солярия будет учитывать его посещения, которые списываются с
		кредита. При этом, в общий чек могут быть включены любые другие товары
		и, коль скоро, они не входят в группу \qu{Услуги солярия}, то
		воздействовать на остаток по такой карте не будут.
	}

	\item[Дата выпуска]
	Дата выпуска серии. Это поле справочное и система не требует его обязательного
	заполнения.

	\item[Дата окончания действия]
	Дата, после которой карточки, наследующие параметры серии, теряют свое действие.

	\item[Скидка (\%)]
	Скидка для тех карточек, которые наследуют параметры от серии.

	\item[Максимальный кредит]
	Только для кредитных карт. Максимальное отрицательное сальдо на кредитной карте, до
	которого клиент еще может получить товар или услугу. Обычно это значение равно нулю.
	Если карта не наследует параметры серии, то в ней это значение может быть
	переопределено.

	\item[Время действия]

	\item[\dlgflag{Если для товара котировка не определена использовать скидку}]
	Флаг доступен только в случае, если в этом диалоге выбран вид котировки (см. выше).

	Если флаг включен, то при отсутствии на товар котировки заданного вида к
	его цене должна быть применена скидка по карте. Если флаг не включен, то
	товар продается по своей номинальной цене.

	На данный момент этот флаг актуален только для кассовой панели \ppybrand{}
	(на загрузку данных в асинхронные кассовые модули он никак не влияет).

	\item[\dlgflag{Карты синхронизированы с сервисом Universe-HTT}]
	Специальный флаг, синхронизирующий карты с глобальным сервисом Universe-HTT,
	что позволяет реализовать сложные бонусные и кредитные схемы, централизовать
	управление скидками, а также обеспечить совместное использование карт многими
	предприятиями.

	\item[\dlgflag{Запрет на доплату при недостатке кредита}]
	Флаг, используемый только для кредитных карт,запрещает принимать доплату за покупку,
	если на карте не достаточно средств (продажа в таком случае становится не возможной).

	\item[\dlgflag{Новые карты наследуют параметры от серии}]
	Если флаг установлен, то при создании новой карты она автоматически получает признак
	\dlgflag{Наследует параметры от серии} и наследует от серии следующие атрибуты:

	\begin{itemize}
		\item Дата выпуска
		\item Дата окончания действия
		\item Скидка
		\item Максимальный кредит
	\end{itemize}
	\item[\dlgflag{Передают скидку новым картам владельца}]
	Включенный флаг обеспечивает наследование новыми картами процента скидки, которые установлен
	для карт этого же владельца, принадлежащих данной серии.

	Для наследования скидки выбирается первая карта, удовлетворяющая следующим условиям:
	\begin{itemize}
		\item Карта принадлежит серии, имеющей флаг \dlgflag{Передают скидку новым картам владельца}
		\item Карта не закрыта
		\item Карта не \qu{заморожена}
		\item Карта действительна на текущую дату
	\end{itemize}
	\item[\dlgflag{Пассивная}]
	Если флаг включен, то эта серия не будет отображаться в большинстве списков выбора. Флаг
	следует устанавливать для тех серий, которые более не используются, но должны оставаться в
	базе данных для истории и отчетов.

	\item[\dlgbutton{Правило пересчета скидок...}]
	Открывает диалог редактирования правила пересчета процента скидки по картам,
	принадлежащим этой серии. Подробности см. на стр.~\pageref{sec-scardrule}.

	\item[\dlgbutton{Правило расчета скидки по сумме чека...}]

	\item[\dlgbutton{Правило расчета бонусов...}]

\end{description}

\subsubsection{Формат шаблона нумерации}

	$$ prefix \% number range check\_digit\_tag $$

	здесь:
	\begin{description}
		\item[$prefix$] Любая строка, предваряющая изменяемый номер карты.
		\item[$\% number$] Шаблон изменяемого номера. Содержит символ процента,
		за которым следует цифра от 1 до 9, обозначающая длину формируемого
		номера в десятичных знаках. Если необходимо выровнять номер слева нулями,
		то перед цифрой следует поставить символ 0. Пример: $\%05$.
		\item[$range$] Диапазон значений изменяемого номера, представленный в
		виде диапазона чисел разделенного двумя точками и обрамленного
		квадратными скобками. Например: $[1..400]$.

		Если диапазон номеров не указан, то система переберет все номера,
		умещающиеся в заданную спецификацию длины формируемого номера.
		\item[$check\_digit\_tag$] Необязательный признак
		добавления контрольной цифры в конец номера - символ \textasciicircum.
	\end{description}

\ppyexample{
	\newline \%06 - Формирует номера от 000001 до 999999
	\newline ABC\%09[1..400] - Формирует номера от ABC000000001 до ABC000000400
	\newline 000\%09[1..500]\textasciicircum - Формирует номера от 0000000000017 до
	0000000005005 (здесь последняя цифра - контрольная).
}

%endtopic

\subsection{Диалог редактирования параметров персональной карты}

\ppypict{dlg-scard}{Персональная карта}

Внешний вид диалога редактирования дисконтной карты показан на рис.~\ref{pic-dlg-scard}.
Далее описываются управляющие элементы этого диалога.

\begin{description}
	\item[\dlgcombo{Серия}]
	Комбо-бокс выбора серии, которой принадлежит карточка.
	Не рекомендуется изменять это поле для карточки, находящейся в обороте.

	\item[Номер]
	Номер карты. Этот номер должен быть уникальным внутри серии.
	Мы настоятельно рекомендуем поддерживать уникальность номеров карточек по всему справочнику,
	а не только внутри одной серии, так как кассовые модули, поставляемые сторонними
	разработчиками, как правило, предполагают это свойство карт.

	\item[Ид]
	Внутренний идентификатор карты.

	\item[\dlgcombo{Персоналия}]
	Персоналия-владелец карты.

	Вид, к которому относятся персоналии, перечисленные в списке этого комбо-бокса, определяется следующим
	образом:
	\begin{enumerate}
		\item Если в серии, к которой относится карта, определен вид персоналии, то используется этот вид.
		\item В случае, если предыдущее условие не выполняется, то используется вид персоналии, определенный
		в конфигурации персональных карт. Подробнее см.~\pageref{sec-scard-cfg}.
		\item Если невозможно определить вид персоналии-владельца из серии карты или из конфигурации,
		то в списке отображаются персоналии, относящиеся к зарезервированному виду \ppyrsrv{Покупатели}.
	\end{enumerate}

	\item[\dlgcombo{Товар для автосписания}]
	Специализированное поле, определяющее товар, который должен быть внесен в кассовый
	чек автоматически после ввода номера этой карты.

	Необходимость применения этого поля может быть обусловлено специфическим бизнесом,
	при котором покупателю, владеющему этой картой, продается один и тот же товар
	(или оказывается одна и та же услуга). В этом случае функция позволяет снизить время обслуживания.

	В качестве примера можно привести вариант использования карты как абонемента на обслуживание,
	скажем, в плавательном бассейне.

	Поле действует только в кассовой панели \ppybrand{} и не экспортируется в асинхронные
	кассовые модули.

	\item[Пароль]
	Если вы используете номера персональных карт в качестве основания для доставки товара на
	дом, или предоставляете информацию об оборотах по карточке по телефону, то для авторизации
	владельца, в этом поле можно ввести ключевое слово, которое он должен сообщить по телефону.

	\item[\dlgflag{Наследует параметры от серии}]
	Если этот признак установлен, то поля \qu{Дата выпуска}, \qu{Дата окончания действия},
	\qu{Скидка}, \qu{Максимальный кредит} наследуются из серии, которой принадлежит выбранная
	карта. Для изменения одного из этих параметров независимо от параметров серии, следует
	снять этот признак.

	\item[\dlgflag{Закрытая}]
	Если этот флаг установлен, то все операции по карточке запрещаются.

	\item[\dlgflag{Закрытая для службы доставки}]
	Установка этого флага запрещает создание документов, привязанных к такой карте.

	\item[\dlgflag{Запрет подарка}]
	Если флаг включен, то в кассовой панели \ppybrand{} по чеку, связанному с этой картой
	не будет автоматически начисляться подарок. Если в чеке подарок уже начислен, то
	после привязки карты, этот подарок отменяется.

	\item[\dlgflag{Требует активации}]
	Если этот флаг установлен, то это означает, что карта требует дополнительной активации.
	Суть активации заключается обычно в том, что после нее карта действительна в течении определенного
	периода.

	Параметры периода действия после активации описаны ниже.

	Обращаем внимание на то, что карта, требующая активации автоматически считается закрытой (соответственно,
	при установки данного флага устанавливается и блокируется от изменения флаг \dlgflag{Закрытая}. Снятие же флага
	\dlgflag{Требует активации} оставляет флаг \dlgflag{Закрытая} в установленно виде (но теперь его можно выключить).

	\item[\dlgflag{Автоактивация}]
	Некоторые бизнес-процессы требуют автоматической активации карты после ее первого использования. Для этого
	и предназначен данный флаг. Если он установлен, то система позволяет использовать требующую активации (и, следовательно,
	закрытую) карту но после первого же использования карта активируется.

	\ppynote{
		Обратим внимание на то, что для кредитных карт операция начисление средств не приводит к автоактивации.
	}

	\item[Период действия после активации]
	Два параметра, определяющих установку даты окончания срока действия при активации карты.
	\begin{description}
		\item[\dlgcombo{Период}]
		Один из предустановленных вариантов периода действия карты после активации:
		\begin{itemize}
			\item День
			\item Неделя
			\item Месяц
			\item Квартал
			\item Полугодие
			\item Год
		\end{itemize}

		\item[Количество периодов]
		Количество периодов, заданных в поле \dlgcombo{Период}. Если здесь стоит ноль, а
		тип периода определен, то система считает, что речь идет об одном периоде.
	\end{description}

	\item[Дата выпуска]
	Справочное поле, позволяющее указать дату выпуска карты.

	\item[Дата окончания действия]
	Если здесь указана дата, то после дня, ей соответствующего, карта теряет свою силу.

	\item[Время действия]
	В этом поле можно ввести диапазон времени суток, в течении которого
	данная карта действительна.

	Время действия появилось в версии 6.2.0 и применимо только при использовании
	карты для идентификации персоналии в персональном событии. То есть при
	работе с синхронными или асинхронными кассовыми узлами это поле не используется.

	Пример ввода: 10:30..12:30.

	\item[Скидка]
	Скидка в процентах, предоставляемая покупателю по этой карте.

	\item[Максимальный кредит]
	Для кредитных карт. Если остаток по карте становится меньше указанного здесь значения, то
	покупатель не имеет возможности расплатиться такой картой.

	\item[Телефон]
	Номер телефона, ассоциированный с картой.

	\dlgbutton[Verify]
	Кнопка, открывающая диалог верификации номера мобильного телефона по СМС.

	\item[Примечание]
	Произвольный текст примечания к карте длиной не более 251 символа.

\end{description}

\subsection{Справочник персональных карт}

Для обращения к справочнику карточек, необходимо выбрать пункт меню
\ppymenu{Справочники\rdir Персоналии\rdir Персональные карты}.

%topic(DLG_SCARDFLT)

\subsubsection{Фильтр справочника персональных карт}

\ppypict{dlg-f-scard}{Фильтр персональных карт}

Диалог редактирования фильтра по дисконтным картам показан на рис.~\ref{pic-dlg-f-scard}.

\begin{description}
	\item[\dlgcombo{Серия}]
	Серия, по которой вы хотите выбрать карты. Если здесь ничего не установлено, то выборка
	карт будет сделана по всем сериям.
	Если серия не выбрана, то некоторые функции работы с таблицей пластиковых карт не будут
	доступны.

	\item[Номер содержит строку]
	Если поле не пустое, то в выборку попадут только карты, содержащие в своем номере введенный фрагмент (не зависимо
	от того, в какой части номера - начале, середине или конце - находится этот фрагмент).

	\item[\dlgcombo{Организация}]
	В случае, если ваше предприятие обслуживает персонал других предприятий по картам, вы
	можете анализировать обороты по картам, которыми владеют сотрудники одного из таких
	предприятий, выбрав его в этом поле. В списке выбора этого комбо-бокса отображаются
	персоналии, принадлежащие зарезервированному виду \ppyrsrv{Работодатели}.
	Такая возможность полезна при работе с кредитными картами.

	\item[\dlgcombo{Персоналия}]
	Выбрав здесь персоналию-владельца карты, вы увидите только его карты.

	\item[\dlgflag{Без владельца}]
	Если флаг установлен, то в выборку попадут карты, в которых не установлен владелец.

	\item[Период даты выпуска]
	Если в этом поле задан период, то в отчет войдут только те карты, атрибут даты выпуска
	которых попадает в этот период.

	Карты, у которых дата выпуска не задана гарантированно не попадут в отчет,
	если данный период не пустой.

	\item[Период истечения срока действия]
	Позволяет отфильтровать карты, дата истечения срока действия которых,
	попадает в заданный период.

	Карты, у которых дата истечения срока действия не задана гарантированно не попадут в отчет,
	если данный период не пустой.

	\item[Период расчета оборотов]
	Введите здесь период, за который вы хотите рассчитать обороты по картам. Если период не
	указан, то обороты показываются за весь период использования каждой карты.

	\ppynote{
		При указании этого периода величины оборотов включают в себя продажи по чекам,
		привязанных к картам и продажи по документам отгрузки, привязанным к картам. Под
		документами отгрузки подразумеваются документы, имеющие виды операций, относящиеся к
		типу \ppyrsrv{Расход товара}. При этом, обороты, ведущие к расходу товара, имеют отрицательные
		значения, а обороты, ведущие к поступлению товара (как правило, возвраты по чекам),
		имеют положительные значения.
		Товарные заказы и все остальные операции, не принадлежащие типу \ppyrsrv{Расход товара} в оборотах
		не учитываются.
		Если период расчета оборотов не указан, то обороты, показанные в таблице, не учитывают
		обороты по документам, но лишь обороты по кассовым чекам.
	}

	\item[\dlgflag{С момента последнего изменения скидки}]
	Этот флаг - дополнение к предыдущему полю. Если он установлен, то обороты по картам
	рассчитываются, начиная со дня последнего изменения процента скидки по каждой из карт.
	Если признак \dlgflag{С последнего изменения скидки} установлен, то начальная дата
	периода расчета оборотов игнорируется.

	\item[Диапазон процента скидки]
	В этом поле можно указать границы, в которые должна попадать величина скидки по выбранным
	картам.

	Например: ..4 означает: все карты, скидка по которым не превышает 4 процентов;
	2..5 означает: карты, скидка по которым больше или равна 2 и меньше или равна 5 процентам.

	\item[Диапазон суммы оборотов]
	Если вы хотите увидеть только те карты, обороты по которым находятся в заданных вами границах,
	то укажите эти границы в этом поле.

	Пример: 10001.. означает: все карты обороты, по которым превышают 10000 рублей;
	15000..25000 означает: все карты, обороты по которым больше или равны 15000 и меньше
	или равны 25000 рублей.

	\item[\dlgradioc{Сортировка}] Блок радио-кнопок, позволяющий выбрать
	вариант сортировки записей в таблице. Здесь доступны следующие опции:
	\begin{description}
		\item[\dlgradioi{Коду}]
		\item[\dlgradioi{Скидке}]
		\item[\dlgradioi{Обороту}]
		\item[\dlgradioi{Владельцу}]
		\item[\dlgradioi{Сроку действия}] Сортирует выборку по дате истечения срока действия карт в порядке возрастания даты.
	\end{description}

	\item[\dlgflag{Только открытые}]
	Если этот флаг установлен, то из просмотра будут исключены карты, имеющие признак
	\dlgflag{Закрыта}.

	При включении этого флага флаг \dlgflag{Только закрытые} автоматически отключается (если был включен).

	\item[\dlgflag{Только закрытые}]
	Установка флага предписывает системе показывать только те карты, которые имеют признак \dlgflag{Закрыта}.

	При включении этого флага флаг \dlgflag{Только открытые} автоматически отключается (если был включен).

	\item[\dlgflag{Показывать детализацию адресов}]
	Включенный флаг предписывает системе извлекать адреса персоналий-владельцев карт
	и детализировать его (если это возможно) по компонентам: город, почтовый индекс, улица,
	дом, корпус, дополнительная информация.

	Если персоналия-владелец карты содержит фактический адрес, то в расчет принимается он,
	в противном случае - юридический адрес.

	\item[\dlgflag{Только с адресами}]
	Флаг доступен только если установлен флаг \dlgflag{Показывать детализацию адресов}. Включение
	данного флага приводит к тому, что в выборку попадут только те карты, для владецев которых
	задан фактический или юридический адрес.

	\item[\dlgbutton{События}]
	Кнопка, открывающая параметры фильтрации выборки карт по событиям системного журнала.

	\item[\dlgbutton{Исключить владельцев карт по фильтру}]
	Кнопка открывает диалог внутреннего фильтра карт, аналогичный описываемому здесь, что позволяет задать сложные критерии отбора, при которых из
	выборки будут исключены карты, чьи владельцы имеют иные карты, удовлетворяющие внутреннему фильтру.
\end{description}

%endtopic

\subsubsection{Действия в таблице персональных карт}

	\paragraph{Редактировать}\indent\keyb{Enter}
	Просмотр и изменение параметров выбранной карты

	\paragraph{Добавить}\indent\keyb{Insert}
	Добавить новую карту

	\paragraph{Удалить}\indent\keyb{Delete}
	Удалить выбранную карту

	\paragraph{Чеки}\indent\keyb{F3}
	Просмотр чеков по выбранной карте

	\paragraph{Операции по кредитной карте}\indent\keyb{F4}
	Только если в фильтре выбрана серия кредитных карт.
	Просмотр операций по кредитной карте

	\paragraph{Начисление по выборке}\indent\keyb{F6}
	Только если в фильтре выбрана серия кредитных карт.
	Начисление денег по всей выборке кредитных карт.

	\paragraph{Изменение скидки по выборке}\indent\keyb{Ctrl-D}
	Изменение скидки по всей выборке карт.
	\ppynote{
		Это ответственная операция. Ее невозможно также быстро откатить, как сделать. Кроме
		того, при использовании этой функции, с карточек, по которым изменяется процент скидки,
		снимается признак \dlgflag{Наследует параметры серии}.
	}

	\paragraph{Печать}\indent\keyb{F7}
	Печать выборки карточек.

	\paragraph{Пересчет оборотов}\indent\keyb{Ctrl-R}
	Служебная функция, позволяющая пересчитать обороты по карточкам. Это может понадобиться
	в крайне редких случаях.

	\paragraph{Просмотр событий по карточке}\indent\keyb{Ctrl-J}
	Позволяет увидеть список системных событий, связанных с выбранной карточкой.

	\paragraph{Передать выборку карточек}\indent\keyb{Ctrl-H}
	Передача выборки карточек в другой раздел базы данных.

	\paragraph{Автозаполнение}\indent\keyb{F8}
	Автоматическое формирование списка карточек с номерами, определенными шаблоном нумерации,
	который задан в серии.
	Эта функция доступна, только если в фильтре была задана конкретная серия карточек.
	\ppynote{
		Перед вызовом этой операции, внимательно проверьте правильность шаблона нумерации в
		серии карточек, поскольку откат этой операции не предусмотрен.

		Единственный (далеко не безопасный) способ относительно быстро вернуться к
		первоначальному состоянию состоит в вызове функции массового удаления выборки карт (см. ниже).
	}

	\paragraph{Удалить выборку}\indent\keyb{Ctrl-F8}

	Позволяет выполнить одно из следующих действий:

	\begin{itemize}
		\item Переместить всю выборку в какую либо серию.
		\item Удалить всю выборку карт.
	\end{itemize}

	Обе эти функции достаточно опасны по этому на экране появляется угрожающее
	предупреждение, а мы здесь, в свою очередь, еще раз напомним, что
	перед выполнением этой функции следует хорошенько подумать.

	При необходимости переместить выборку в какую-то серию в диалоге
	предупреждения требуется указать эту серию.

	\paragraph{Заменить в чеках}\indent\keyb{Ctrl-M}

	Позволяет перенести обороты с выбранной карты на какую-либо иную.
	Переносятся не только обороты по кассовым чекам, но и по документам,
	привязанным к выбранной карте.

	Функция не обратимая и влечет за собой существенные изменения в базе данных.
	По этому будьте осторожны с этой функцией.

	\paragraph{Обработать выборку}\indent\keyb{Ctrl-A}

	Функция реализует массовое изменение ряда параметров для всех карт выборки.

	\ppypict{dlg-scardmassupd}{Диалог обработки выборки карт}

	Диалог, предшествующий обработке показан на рис.~\ref{pic-dlg-scardmassupd}. Вот описание управляющих элементов
	этого диалога:
	\begin{description}
		\item[\dlgcombo{Перенести в серию}]
		Если в этом комбо-боксе выбрана серия, то все карты выборки будут перемещены в эту серию.

		\item[Изменить дату окончания действия]
		Дата окончания срока действия, которая будет установлена у всех карт выборки. Здесь можно использовать
		шаблон даты (см. стр.~\pageref{sec-input-tamplatedate}).
		\ppynote{
			Если здесь вводится шаблонизированная дата, то опорной датой для отсчета нового значения будет
			дата истечения срока действия карты на момент изменения, а не текущая системная дата, как это
			бывает в большинстве случаев при использовании шаблонов дат.

			Эта особенность введена в версии 9.6.3, до этого в качестве опорной применялась текущая
			системная дата.
		}

		\item[\dlgflag{Очистить дату окончания действия}]
		Если флаг установлен, то у всех карт выборки будет удалена дата окончания действия.

		\item[\dlgcombo{Товар для автосписания}]
		Непустое значение предписывает функции установить на всю выборку этот товар для автосписания.

		\item[Параметры изменения скидки по картам]
		Два элемента, управляющие установкой скидки по карте:
		\begin{description}
			\item[Скидка]
			Процентное значение скидки.
			\item[\dlgflag{Ноль}]
			Если флаг включен, то на всю выборку будет установлена нулевая скидка.
		\end{description}

		\item[Изменение флагов]
		Два блока флагов, позволяющие установить или, соответственно, снять выбранные флаги для всей выборки карт.

		\ppynote{
			Будьте внимательны: система не проверяет комбинации флагов на корректность. Если вы не уверены в
			понимании смысла того или иного флага, то проконсультируйтесь со специалистом поддержки системы.
		}

		\item[Период действия после активации]
		Два управляющих элемента, которые позволяют установить период действия для карт, требующих активации.

		\item[\dlgbutton{Фильтр...}]
		Эта кнопка используется для обработки выборки карт серверной задачей. При вызове функции из таблицы
		карт кнопка не доступна.
	\end{description}

	Функция доступна пользователям, имеющим установленную привилегию \dlgflag{Массовое изменение карт}.

	\paragraph{Изменить флаги}\indent\keyb{Shift-F3}

	Позволяет изменить некоторые системные флаги по всей выборке карт.
	Вот эти флаги:
	\begin{itemize}
		\item \dlgflag{Наследует параметры от серии}
		\item \dlgflag{Закрытая}
		\item \dlgflag{Закрытая для службы доставки}
	\end{itemize}

	\ppynote{
		Начиная с версии 7.7.3 эта функция упразднена. Вместо нее следует использовать
		функцию \qu{Обработать выборку}.
	}

	\paragraph{Переименовать дублирующиеся карточки}\indent\keyb{Ctrl-X}

	Эта функция предоставляет сервис для удаления дубликатов в номерах
	карт. Действие может понадобиться в том случае, если вы решили перейти
	со схемы уникальности номеров в пределах одной серии к схеме сквозной
	уникальности.

	В этом случае, перед установкой флага \dlgflag{Сквозная уникальность
	дисконтных карт} в системных параметрах общей конфигурации выполните
	рассматриваемую функцию.

\section{Правила изменения параметров персональных карт\label{sec-scardrule}}

Система \ppybrand{} предоставляет сервис для автоматического расчета скидки
по дисконтной карте в зависимости от оборотов. Для того, чтобы этой возможностью
можно было воспользоваться необходимо определить набор правил, в соответствии с
которыми должна быть установлена та или иная величина скидки (либо перенос в
какую-либо серию).

\subsection{Управление правилами}

\ppypict{dlg-115}{Правило расчета скидки по картам}

Правило расчета скидки состоит из заголовка, содержащего период расчета
оборотов и списка диапазонов оборотов. Каждому элементу этого списка
ставится в соответствие процент скидки по карте и (или) серия карт,
в которую карта должна быть перенесена в случае, если сумма оборотов
по ней удовлетворяют заданному диапазону.

Отметим некоторые сложности связанные с изменением принадлежности
карты серии при пересчете скидок. Если пересчет запущен по всем картам
всех серий, то в результате нелогично составленных правил карта может
в течении пересчета несколько раз изменить принадлежность серии.

Таким образом, результат может оказаться непредсказуемым. По этому,
если вы используете изменение серии карты, то будьте крайне внимательны
при составлении правил.

Существует одно ограничение для переноса карт между сериями: если в
соответствии с правилом карта должна быть перемещена между кредитной
и не кредитной сериями (не важно в какую сторону), то такое перемещение
не состоится. Причина очевидна: система не сможет гарантировать
адекватность поведения такой карты.

Еще один важный нюанс, который следует учитывать при использовании
функции автоматического пересчета скидок по картам, заключается в том,
что этот пересчет не затрагивает карты, наследующие параметры от серии.

\subsubsection{Редактирование правила}

Администрирование правил пересчета осуществляется для каждой серии дисконтных
карт по следующей последовательности действий:

\begin{enumerate}
	\item Откройте список серий персональных карт, выберите серию и нажмите кнопку \dlgbutton{Редактировать}.
	\item В диалоге редактирования серии карты нажмите кнопку \dlgbutton{Правило расчета скидок}.
	\item Вы увидите диалог, показанный на рис.~\ref{pic-dlg-115}.
\end{enumerate}

В диалоге присутствуют следующие управляющие элементы:

\begin{description}
	\item[\dlgcombo{Период расчета оборотов}]
	Здесь возможен один из вариантов:
	\begin{itemize}
		\item Пусто
		\item День
		\item Неделя
		\item Месяц
		\item Квартал
		\item Полугодие
		\item Год
	\end{itemize}
	Если вы ничего не выберите в этом комбо-боксе (\qu{Пусто}),
	то скидка будет устанавливаться в зависимости от оборотов
	за полный период учета операций по картам.

	Остальные варианты говорят сами за себя.

	Непосредственно при запуске функции пересчета скидок по картам указывается рассчитывать ли обороты за текущий
	либо за предыдущий период.

	\item[Список элементов правила]
	Это - многоколоночный список, в котором видны следующие
	графы:
	\begin{itemize}
		\item Диапазон оборотов
		\item Скидка, соответствующая этому диапазону
		\item Серия карт (возможно, не определена), в которую должна быть перемещена карта, если оборот по ней
		попадает в диапазон.
	\end{itemize}

	\item[\dlgbutton{Добавить}] При нажатии на эту кнопку открывается диалог создания нового элемента правила.
	\item[\dlgbutton{Редактировать}] Открывает диалог редактирования выбранного элемента.
	\item[\dlgbutton{Удалить}] Удаляет выбранный элемент правила.
\end{description}

\subsubsection{Редактирование элемента правила}

Диалог редактирования элемента правила состоит из трех полей:

\paragraph{Диапазон оборотов}
Здесь необходимо указать начальное и конечное значения диапазона
оборотов по картам, определяющего применение этого элемента.

Диапазон указывается включительный. То есть, если величина оборота по карте равна нижней или верхней границе
этого диапазона, то применяется именно этот элемент.

Нижняя и верхняя границы диапазона отделяются как обычно в \ppybrand{} двумя точками.

Один элемент в списке может иметь открытый слева диапазон (например, \qu{..10000})
и, аналогично, не более одного элемента может иметь открытый справа
диапазон (например, \qu{20000..}).

Система не допускает ввода двух элементов, диапазоны которых пересекаются.
Так, вы не сможете ввести в одно правило элементы с диапазонами
\qu{10000..20000} и \qu{15000..30000}.

\paragraph{Скидка, \%}
Значение скидки в процентах, которое будет установлено для карт,
сумма оборотов по которым соответствует этому элементу правила.

Величина скидки хранится в базе данных с точностью до двух знаков после
запятой (для примера, если вы введете 2.345, то эта величина будет округлена
до 2.35).

\paragraph{Серия, в которую должна перейти карта}
Если вы хотите, чтобы карта, при достижении заданного значения оборотов
была перенесена в другую серию, то выберите эту серию здесь.

\subsection{Использование параметров на основе правил}

\subsubsection{Ручной запуск процедуры изменений параметров карт}

\ppypict{dlg-114}{Установка скидки на карты}

Для запуска пересчета скидок выберите пункт меню
\ppymenu{Справочники\rdir Персоналии\rdir Пересчет скидок по картам}.

На экране откроется диалог (рис.~\ref{pic-dlg-114}).

\begin{description}
	\item[\dlgcombo{Серия персональных карт}]
	Если вы выберите здесь серию, то пересчет будет осуществлен только
	по картам этой серии. Если комбо-бокс оставлен пустым, то будут
	пересчитаны все карты, для серий которых определены правила пересчета.

	\item[Переключатель выбора периода расчета]
	Определяет период времени, за который рассчитываются обороты по картам:
	\begin{description}
		\item[\dlgradioi{Обороты рассчитывать за предыдущий период}] Обороты будут
		рассчитываться за текущий календарный период (определяемый
		системной датой).

		\item[\dlgradioi{Обороты рассчитывать за текущий период}] Обороты будут
		рассчитываться за предыдущий календарный период.

		Так, если в правиле пересчета определен квартал как период
		расчета оборотов, а сегодня 5 марта 2008 года, то обороты
		будут рассчитываться за 4-й квартал 2007 года.

		Если же сегодня 3 апреля 2008 года, то предыдущий период -
		1-й квартал 2008 года.
	\end{description}
\end{description}

\subsubsection{Автоматический запуск процедуры изменений параметров карт}
Если вы используете Papyrus JobServer, то можете создать задачу изменения параметров персональных карт.
Команда для запуска такой задачи называется \qu{Пересчет скидок по персональным картам}.

\section{Панель информации о карте}

В системе предусмотрена специальная интерактивная функция, позволяющая
просматривать подробную информацию о карте и осуществлять над ней ряд действий.

Эта функция может быть использована как автономно (например, в качестве специализированного
информационного киоска), так и в составе кассовой панели.

Для автономного вызова этой панели следует использовать команду рабочего стола
\ppyrsrv{Информация о дисконтной карте}.

В кассовой панели диалог вызывается в ответ на команду выбора карты, если в
опциях кассового узла установлен флаг \dlgflag{Расширенный режим выбора карты}.

\ppypictsc{dlg-scardinfo}{Панель информации о карте}{0.4}

Панель, показанная на рис.~\ref{pic-dlg-scardinfo}, состоит из следующих элементов:

\begin{description}
	\item[Поле ввода (в нижней части панели)]
	В этом поле вводится номер карты, либо иные данные, необходимые
	для выполнения заданной функции.

	\item[Список]
	Список, в котором отображается многострочная информация о карте, либо элементы выбора.

	На данный момент возможны четыре режима отображения в этом списке:

	\begin{itemize}
		\item Кассовые чеки по карте
		\item Операции начисления (списания) по кредитной карте
		\item Выбор карты по персоналии-владельцу
		\item Накопление списка кредитных карт, с которых необходимо
		перечислить средства на выбранную карту.
	\end{itemize}

	\item[Номер карты] Информационное поле, отображающее номер выбранной карты.
	\item[Имя владельца] Информационное поле, отображающее имя владельца выбранной карты.
	\item[Дополнительная информация о владельце]
	Информационное поле, отображающее дополнительную информацию о
	владельце карты:
	\begin{itemize}
		\item Возраст владельца (если для персоналии задан зарезервированный
		тег \ppyrsrv{Дата рождения}).
		\item Номер телефона владельца (если он определен в базе данных).
	\end{itemize}

	\item[Фотография владельца]
	Если с персоналией-владельцем карты ассоциирована фотография, то она
	будет отображаться в правой части панели.

	\item[Сальдо]
	Информационное поле, показывающее текущий остаток для кредитной карты.
	Если остаток больше нуля, то поле имеет зеленый цвет, если меньше - красный.
	Нулевой остаток отображается синим цветом.

	В режиме переноса средств это поле окрашивается цветом Magenta и отображает
	остаток, который получится после подтверждения переноса.

	\item[\dlgbutton{Очистить}]
	Кнопка, убирающая из панели выбранную карту. Это действие особенно востребовано
	при работе в кассовой панели для отмены выбора карты.

	\item[\dlgbutton{По владельцу}]
	Кнопка, позволяющая выбрать карту по строке, содержащейся в имени владельца.

	Для того, чтобы воспользоваться функцией, в поле ввода наберите любую подстроку
	имени и нажмите кнопку. В списке отобразятся все карты, имена владельцев которых
	содержат эту подстроку. Далее, можно выбрать требуемую карту.

	\item[\dlgbutton{Новая}] Эта кнопка позволяет создать новую карту. Подробно мы ее опишем ниже.

	\item[\dlgbutton{Чек}]
	В режиме отображения чеков по выбранной карте, эта кнопка открывает диалог
	просмотра подробной информации по любому из чеков, перечисленных в
	списке.

	\item[\dlgbutton{Операции}]
	Кнопка переключения режима отображения информации о карте. Для кредитных
	карт позволяет вместо чеков показать список операций начисления (списания).

	Для дисконтной карты эта кнопка не активна.

	\item[\dlgbutton{Перенос}]
	Специальная функция для кредитных карт, позволяющая перенести средства
	с одной или нескольких карт на выбранную.

	Пользователь должен иметь права доступа на добавление операций по картам
	для того, что бы воспользоваться этой функцией.

	\item[\dlgbutton{Закрыть}]
	Закрывает диалог информации о карте. При использовании из кассовой панели,
	выбранная карта становится текущей для чека.

	\item[\dlgbutton{Выполнить} (на рис. не видна)]
	Кнопка отображается только в режиме переноса средств для кредитной карты.
	После нажатия на эту кнопку осуществляется транзакция списания средств
	с выбранных карт и начисления их на текущую кредитную карту.
\end{description}

\section{Создание документа отгрузки по персональной карте}

Если вам необходимо выписать документ отгрузки покупателю, владеющему дисконтной картой,
то в реестре товарных документов нажмите клавишу \keyb{F2}.

При этом на экране появится диалог для ввода номера дисконтной карты. Введите номер
карты покупателя.

Если система найдет такую карту в справочнике, и в карте указан владелец, то система
выдаст еще один диалог, в котором будет указан номер и имя владельца карточки, а также
пароль, который необходимо назвать владельцу для своей авторизации, если ваше общение с
ним происходит по телефону (эта несложная авторизация является опцией, необходимость в
которой определяется администрацией вашего предприятия).

Далее, в этом диалоге, вам следует выбрать вид операции создаваемого документа.

Все остальные шаги по выписке документа осуществляется по стандартному сценарию.

Система зафиксирует привязку документа к дисконтной карте. Таким образом, созданный
документ будет учитываться при расчете оборотов по карте.

Если карта является кредитной, и остаток средств на карте меньше, чем сумма документа,
то система выдаст сообщение об ошибке при проведении документа.

\section{Администрирование персональных карт}

\subsection{Системные события по персональным картам}

Далее перечисляются системные события, фиксируемые в системном журнале и
свойственные персональным картам.

\begin{description}
	\item[Объект создан] Формируется при успешном создании карты.
	\item[Объект изменен] Формируется при успешном изменении карты.
	\item[Объект удален] Формируется при успешном удалении записи карты.
	\item[Изменена скидка по дисконтной карте]
	Формируется при изменении значения скидки по карте. Дополнительное значение события равно
	скидке, предшествовавшей изменению в сотых долях процента.
	\item[Операция по карте перемещена на другую карту]
	Формируется при переносе кредитной операции по карте на другую карту. Дополнительное значения события равно
	идентификатору карты, которой данная операция принадлежала до переноса.
	\item[Персональная карта активирована]
	Специализированное событие, создаваемое при активации карты.

	Событие введено в версии 8.1.8.

\end{description}

\subsection{Конфигурация персональных карт\label{sec-scard-cfg}}

\ppypict{dlg-cfg-scard}{Диалог конфигурации персональных карт}

Для вызова диалога конфигурации персональных карт выберите пункт меню
\ppymenu{Админ\rdir Прочие конфигурации\rdir Конфигурация персональных карт}.
При этом на экране появится диалог, изображенный на рис.~\ref{pic-dlg-cfg-scard}.

Далее следует описание управляющих элементов этого диалога:

\begin{description}
	\item[\dlgcombo{Вид персоналии владельцев карт}]
	По умолчанию владельцы дисконтных карт выбираются из списка персоналий,
	относящихся к зарезервированному виду \ppyrsrv{Покупатели}.

	Если по каким-либо причинам вы хотите переопределить это правило,
	то укажите в данном комбо-боксе тот вид персоналий, который необходимо.

	\ppynote{
		Не следует изменять этот параметр если в вашей базе данных уже
		существуют карты с привязанными владельцами.

		Если все-таки возникла необходимость в таком действии,
		то проконсультируйтесь со службой поддержки, обслуживающей ваше предприятие.

		Это значение может быть переопределено в серии карт. Вид персоналий владельцев
		карт в серии имеет больший приоритет, чем рассматриваемый параметр.
	}
	\item[\dlgcombo{Владелец карт по умолчанию}]
	Специализированное поле, используемое при загрузке данных на
	асинхронные кассовые узлы.

	Если при загрузке данных во внешний кассовый модуль с какой-либо
	дисконтной картой не связан владелец и в конфигурации определено
	данное поле, то выгружен будет идентификатор и наименование этой персоналии.

	Владелец по умолчанию должен относиться к тому же виду персоналий,
	что и остальные владельцы дисконтных карт.

	\item[\dlgcombo{Серия дисконтных карт по умолчанию}]
	Этот параметр используется системой для автоматизации создания новых карт.

	\item[\dlgcombo{Серия кредитных карт по умолчанию}]
	Так же как и предыдущий, этот параметр используется для автоматизации
	создания новых кредитных карт.

	\item[Товар для начисления на кредитную карту]
	Эта группа объединяет два комбо-бокса для выбора специального товара,
	используемого для начисления средств на кредитную карту из кассовой панели.

	Выбранный здесь товар должен иметь штрихкод для того, чтобы
	оператор POS-узла мог осуществить операцию начисления средств на карту.

	\item[\dlgcombo{Тип суммы для начисления по документу}]
	Здесь может быть выбран тип суммы, значение которой в документе будет
	начисляться на кредитную карту, с которой связан документ (если таковая существует).

	\item[\dlgflag{Принимать изменение владельца карты в диспетчерском разделе}]
	Специальная опция, позволяющая смягчить ограничение на прием изменений
	дисконтных карт в диспетчерском разделе. При установке этого флага
	в диспетчерском разделе будет приниматься изменение персоналии, связанной
	с дисконтной картой, но ни какие иные атрибуты более этого меняться не будут.

	\item[\dlgflag{Не применять бонусные карты}]

	\item[\dlgflag{Проверять просроченную задолженность по документам}]

\end{description}

Права доступа к конфигурации дисконтных карт регламентируются наличием
соответствующего элемента в списке доступных конфигураций пользователя.

\subsection{Права доступа к картам}

\ppypict{dlg-rt-scard}{Диалог редактирования прав доступа к картам}

Диалог, показанный на рис.~\ref{pic-dlg-rt-scard}, доступен из списка прав
доступа по объектам.

Система регламентирует следующие права доступа к картам:

\begin{description}
	\item[\dlgflag{Просмотр}] Разрешает просмотр карт.
	\item[\dlgflag{Создание}] Разрешает создание новой карты.
	\item[\dlgflag{Модификация}] Разрешает изменение существующей карты.
	\item[\dlgflag{Удаление}] Разрешает удаление карты.
	\item[\dlgflag{Админ}] Позволяет модифицировать права доступа к картам.
	\item[\dlgflag{Просмотр операций}] Разрешает просмотр операций по кредитным картам.
	\item[\dlgflag{Добавление операций}] Разрешает ввод новой операции по кредитной карте.
	\item[\dlgflag{Удаление операций}] Разрешает удаление операции по кредитной карте.
	\item[\dlgflag{Изменение привязок}]
	Отсутствие данного права блокирует возможность изменения карты
	в документе или чеке, а так же запрещает выполнение функции массового
	переноса чеков и документов с одной карты на другую.
	\item[\dlgflag{Массовое изменение карт}]
	Данный флаг регламентирует возможность массового изменения параметров выборки карт.
	Если пользователь имеет права доступа на изменение карты, но не имеет описываемого права,
	то он сможет изменять карты только по-одной.

	Необходимость данного регламента обусловлена чувствительностью бизнеса к некоторым параметрам
	карт, и, следовательно, требованием дополнительной защиты от ошибочных действий персонала.

\end{description}

\subsection{Особенности синхронизации дисконтных карт}

\subsubsection{Контекстная синхронизация}

При приеме дисконтных карт из других разделов применяется контекстная синхронизация по
паре параметров: серия карты и номер карты.

Это означает, что если для принимаемой карты нет
системной синхронизации, то перед созданием новой записи система проверит
наличие аналогичной карты в принимающем разделе по указанной паре критериев.

\subsubsection{Передача карт вместе с чеками}
При передаче карт из одного раздела в другой возможны два варианта:
\begin{enumerate}
	\item Карта передается в другой раздел без связанных с ней чеков.
	\item Вместе с картой передаются и кассовые чеки, которые к ней привязаны.
\end{enumerate}

Зачем нужен второй вариант? Его главная задача - решить проблему расчета
оборотов по картам в разделе-получателе, если этот раздел не получает
из раздела-источника кассовых сессий с чеками. Таким образом, если из
раздела-отправителя в раздел-получатель кассовые сессии (они вбирают в
себя и чеки) передаются, то режим передачи чеков с картами не должен
использоваться. Более того, использование 2-го режима обмена при одновременной
передаче кассовых сессий приведет к неприятным последствиям,
заключающимся в дублировании чеков.

Для того, чтобы включить 1-й из рассмотренных режимов, необходимо
установить флаг \dlgflag{Передавать карточки без чеков} в конфигурации
оборудования (\ppymenu{Админ\rdir Прочие конфигурации\rdir Конфигурация оборудования}).
Соответственно, выбор 2-го режима заключается в отключении этого флага.

\subsubsection{Использование признака \dlgflag{диспетчерский раздел} в записи раздела базы данных}

Если дисконтная карта принимается в разделе, имеющем признак \dlgflag{диспетчерский},
то изменения карты в этом разделе применены не будут. Однако, карта, которой
нет в диспетчерском разделе, будет создана.

Смысл этой особенности заключается в том, чтобы реализовать концепцию централизованного
управления дисконтными и кредитными картами. То есть, все управляющие изменения дисконтных
карт (назначение скидок, присвоение владельцев, блокировка карт, координация начислений и т.д.)
осуществляются в диспетчерском разделе. При этом изменения, внесенные иными разделами не
попадут в диспетчерский раздел, что позволит избежать ошибок и недобросовестных действий.

Опциональным исключением из описанного правила может являться изменение
владельца дисконтной карты. Если в конфигурации дисконтных карт установлен флаг
\dlgflag{Принимать изменение владельца карты в диспетчерском разделе}, то владелец
дисконтной карты будет изменяться даже в диспетчерском разделе (флаг конфигурации
применим только для того раздела, в базе данных которого установлен).

\chapter{Персональные операции\label{ch-personevent}}

Концепция персональных операций является исключительно развитым инструментом,
обеспечивающим полный учет хронологии событий, происходящих с персоналиями, и,
одновременно, проекцию этих событий на состояние атрибутов персоналий. Речь здесь идет не
только о кадровом учете - технология персональных операций предоставляет сервис для
методологии CRM, учета предоставления специфических услуг (например, медицинских), ведения
учетных реестров и многого другого.

\section{Базовые сведения}

На самом простом уровне, персональные операции представляют собой хронологически
упорядоченный реестр записей, характеризующихся следующими атрибутами:

\begin{description}
	\item[Дата]
	\item[Время]
	\item[Вид персональной операции] параметр, определяющий суть события и задающий наиболее
	важные характеристики персональной операции. За этим атрибутом скрывается набор правил,
	определяющих особенности \qu{поведения} той или иной персональной операции.
	\item[Первичная персоналия] та персоналия, событие, произошедшее с которой, собственно
	и фиксируется.
	\item[Вторичная персоналия] опциональная персоналия, выступающая контрагентом первичной
	персоналии. Например, при устройстве на работу, контрагентом будет работодатель, при
	бракосочетании - супруг (супруга), при приеме пациента у врача - врач.
	\item[Подразделение] для кадровых событий, то подразделение, в которое поступает (которое
	оставляет) сотрудник.
	\item[Должность] для кадровых событий, должность на которую поступает сотрудник
	\item[Примечание] произвольный текст.
	\item[Регистр] персональный регистрационный документ, связанный с событием (например,
	приказ о приеме на работу, свидетельство о рождении и т.д.). Тип регистра должен быть
	определен в виде персональной операции.
	\item[Список персональных тегов, связанных с операцией] Список тегов, которые могут быть
	связаны с событием, определяется видом операции.
	\item[Фотография] позволяет связать какое-либо изображение с событием.
\end{description}

\subsection{Парные операции}

Понятие парных персональных операций позволяет организовать учет продолжительности
каких-либо событий. Например, нахождение сотрудника в отпуске фактически определяется
двумя событиями: выходом в отпуск и возвращением из отпуска. Рекламная компания определяется
событиями запуска и завершения. Такие примеры можно приводить бесконечно.
В системе \ppybrand{} для каждого вида персональной операции может быть задан вид парной ей
операции. При этом, будучи спаренной, операция может иметь один из следующих статусов:

\begin{description}
	\item[Открывающая парная] события этого вида предшествуют соответствующим
	им парным событиям.
	\item[Закрывающая парная] события этого вида являются заключительными
	в соответствующей паре.
	\item[Нуль-закрывающая парная] то же самое, что и закрывающая парная с той лишь разницей,
	что система не требует для события такого вида существования соответствующего
	ему открывающего события.
\end{description}

\subsection{Расширение персональной операции}

С персональными событием может быть связана дополнительная информация, содержанием которой
определяется так называемым расширением. На текущий момент, система допускает следующие
типы расширений:
\begin{description}
	\item[Список тегов] определяет типы тегов, значения которых пользователь может связать с
	каждой вводимой операцией этого вида.
	\item[Должность] предполагает, что пользователь может (и, вероятно, должен) указать
	должность, связанную с персональным событием. Это чаще всего применяется в событиях,
	отражающих кадровые перемещения персонала.
\end{description}

\subsection{Действия, связанные с персональной операцией}

Система позволяет настроить набор действий, которые будут сопутствовать созданию или
изменению персонального события. Типы таких действий зарезервированы. Вот их список
(в дальнейшем он будет расширяться):

	\paragraph{Присвоить персоналии вид}
	В результате выполнения операции персоналия получит (если еще не имеет) указанный
	дополнительным параметром вид.

	\paragraph{Отозвать вид у персоналии}
	Если персоналия принадлежит к виду, указанному дополнительным параметров этого действия,
	то она теряет принадлежность этому виду.

	\paragraph{Установить тег персоналии}
	Присваивает персоналии значение тега, соответствующее тому, которое определено в событии.
	Это действие доступно только в том случае, если вид операции определяет набор тегов,
	которые устанавливаются пользователем при вводе нового события.
	Дополнительным параметров действия выступает тип тега (система допускает выбор одного из
	теговых типов, определенных в расширении вида операции).
	Чтобы стал понятнее необходимый для этого действия набор условий, перечислим их по порядку:
	\begin{itemize}
		\item Расширение вида персональной операции должно иметь тип \ppyrsrv{Тег}
		\item В списке разрешенных тегов расширения вида персональной операции
		должен быть перечислен один или более типов тегов
		\item При выборе действия \ppyrsrv{Установить тег персоналии}, необходимо в
		дополнении выбрать один из этих тегов
	\end{itemize}
	При вводе события, пользователь укажет значение тега и оно автоматически присвоится персоналии.

	Если персональное событие создается или редактируется \qu{задним числом}, то система
	препроводит все действия по персоналии, которые помечены датами более поздними, чем это.
	Такая операция необходима для того, чтобы поддерживать актуальность текущих значений
	тегов.

	\paragraph{Снять тег у персоналии}
	Снимает тег у персоналии. Это действие доступно только в том случае, если вид операции
	определяет набор тегов, которые устанавливаются пользователем при вводе нового события.
	Дополнительным параметров действия выступает тип тега (система допускает выбор одного
	из теговых типов, определенных в расширении вида операции).

	\paragraph{Увеличить тег}
	Увеличивает значение тега, определенного в дополнении к действию, на единицу. Если
	персоналия не имеет такого тега, то он будет создан.
	Это действие срабатывает только для тегов, имеющих один из следующих типов:
	\begin{description}
		\item[Число] значение увеличивается ровно на 1.
		\item[Строка] если строка может быть преобразована в число, то это
		число увеличивается на единицу, в противном случае, строка становится равной \qu{1}.
		\item[Дата] к дате прибавляется один день. Если текущее значение тега
		не определенное, то ему присваивается текущая системная дата.
	\end{description}
	Для остальных типов тегов ничего не происходит.

	\paragraph{Уменьшить тег}
	Это действие почти эквивалентно предыдущему за исключением того, что значение тега не
	увеличивается, а уменьшается на единицу. Соответственно, в исключительных случаях
	происходит следующее:
	\begin{itemize}
		\item Строка не может быть преобразована к числу: значение становится равным \qu{-1}
		\item Дата не определена: тегу присваивается текущая системная дата.
	\end{itemize}

	\paragraph{Присвоить персоналии должность}
	Обычно, этот тип действия используется в событиях, связанными с кадровыми назначениями
	и перемещениями. Вид персональной операции должен использовать вид расширения \ppyrsrv{Должность}.
	В результате исполнения этого действия персоналия, к которой относится событие будет
	назначена на должность, заданную в событии.

	\paragraph{Отозвать должность у персоналии}
	Так же, как и предыдущий тип действия, этот применяется в операциях, связанных со штатными
	перемещениями персонала.

	В результате исполнения действия персоналия, к которой относится событие, будет снята с
	текущей должности. При этом снятие с должности осуществляется закрытием должностного
	назначения, а не удалением его. Дата события становится датой закрытия назначения.

	\paragraph{Присвоить персоналии регистр}
	Действие реализует присвоение персонального регистра, определенного в событии первичной
	либо вторичной персоналии.

	\paragraph{Отозвать у персоналии регистр}
	Действие реализует удаление персонального регистра, определенного в событии, у первичной
	либо вторичной персоналии.

	\paragraph{Запись в календаре}
	Для этого действия необходимо указать дополнительный параметр: штатный календарь. В
	результате исполнения действия в унаследованном календаре указанного типа для объекта
	\ppyrsrv{Персоналия} появится запись, соответствующая дате события.

	В качестве простого примера использования такого действия можно привести персональную
	операцию \qu{Выход на работу}. При вводе такого события в штатном календаре с именем, скажем,
	\qu{Рабочие дни} появится запись, соответствующая сотруднику, для которого введено это событие
	и дате, когда событие произошло.

	Подробно о штатных календарях см. стр.~\pageref{sec-staffcal}.

	\paragraph{Запись пропуска в календаре}
	То же, что и предыдущее действие, с той лишь разницей, что запись формируется с
	признаком \dlgflag{Пропуск}.

	\paragraph{Заполнить календарь от парной операции}
	Для этого действия необходимо указать дополнительный параметр: штатный календарь. Кроме
	того, действие доступно только для закрывающих и нуль-закрывающих парных видов операций.
	В результате исполнения действия в унаследованном календаре указанного типа для объекта
	\ppyrsrv{Персоналия} появятся записи, соответствующие датам, прошедшим после открывающего парного
	события и до данного события.

	Если для события система не может найти открывающего парного события, то ничего не происходит.

	Подробно о штатных календарях см. стр.~\pageref{sec-staffcal}.

	\paragraph{Заполнить календарь пропусками от парной операции}
	Действие аналогичное предыдущему с то лишь разницей, что элементы
	календаря формируются с флагом \dlgflag{Пропуск}.

	\paragraph{Установить календарь в протяженное состояние}
	Это действие аналогично действию \qu{Запись в календаре}, но создает в календаре
	запись, имеющую признак \dlgflag{Протяженный режим}. В результате все последующие
	даты в календаре автоматически будут считаться включенными в календарь.

	\paragraph{Установить календарь в протяженное состояние пропуска}
	То же, что и предыдущее действие, но протяженное состояние формируется записью,
	имеющей признак \dlgflag{Пропуск} в результате чего все последующие даты
	автоматически считаются присутствующими в календаре с этим признаком.

	\paragraph{Отменить протяженное состояние календаря}
	Это действие ищет в календаре последнюю запись, предшествующую дате
	операции и, если эта запись имеет признак \dlgflag{Протяженный режим},
	то удаляет ее. Если такая запись на найдена, то ничего не делает.

	Основное (но не единственно возможное) назначение этого действия - отменить
	протяженное состояние календаря, установленное открывающей парной операцией.

	\paragraph{Установить отношение со вторичной персоналией}
	В результате срабатывания действия будет установлено персональное отношение
	заданного типа от первичной персоналии к вторичной.

	Подробно о персональных отношениях см. стр.~\pageref{sec-personrel}.

	\paragraph{Отозвать отношение со вторичной персоналией}
	Это действие удаляет персональное отношение заданного типа от первичной персоналии к вторичной.

	Подробно о персональных отношениях см. стр.~\pageref{sec-personrel}.

	\paragraph{Начисление на персональную карту}
	Если в событии указана персональная карта, являющаяся кредитной или бонусной, то на нее будет начислена сумма 1.0.

	Действие обратимо: при удалении события начисленная величина списывается с карты, при изменении - списывается и снова начисляется.

	\paragraph{Списание с персональной карты}
	Если в событии указана персональная карта, являющаяся кредитной или бонусной, то
	с нее будет списана сумма 1.0. При этом, если остаток на карте не достаточен для списания,
	то персональное событие не будет проведено.

	Действие обратимо: при удалении события начисленная величина списывается с карты,
	при изменении - списывается и снова начисляется.

	\paragraph{Команда на устройство}
	Это действие позволяет отправить на обобщенное устройство команду, заданную текстовой
	строкой. Дополнительными (и обязательными) параметрами этого действия должны быть:
	обобщенное устройство и, собственно, команда.

	Действие срабатывает только при создании нового персонального события.

	Для этого действия допустима опция повтора.

	\paragraph{Звуковой сигнал}
	Простое действие, обеспечивающее звучание встроенного звукового устройства компьютера
	с заданной тональностью и длительностью.

	Тональность и длительность сигнала задаются в строке команды, связанной с действием.
	Параметры звучания задаются набором числовых пар: \ppyrsrv{частота в герцах, длительность в миллисекунд},
	разделенных точкой с запятой.

	\ppyexample{
		4000, 100; 6000, 100; 12000, 1000

		три последовательных сигнала с частотой, соответственно, 4000, 6000, 12000 герц и
		длительностью 100 миллисекунд два первых сигнала и 1000 миллисекунд последний.
	}

\section{Настройка персональных операций}

\subsection{Виды персональных операций}

Вид персональной операции определяет все основные правила поведения персональных операций,
относящихся к этому виду. В действительности, главные достоинства модуля управления
персональными операциями, заключены именно в конфигурации видов этих операций.
До того, как мы начнем рассказывать подробности работы с этими типами объектов данных,
перечислим и кратко охарактеризуем основные атрибуты видов персональных операций:

\begin{itemize}
 	\item	Наименование
	\item	Символ
	\item	Атрибуты парности - позволяют определить два вида операции как парные. В этом
	случае система будет следить за тем, чтобы соблюдалась парность операций соответствующего
	вида и предоставляет сервис по расчету времени, прошедшего между событиями.
	\item	Тип связанного регистрационного документа
	\item	Ограничения на первичную персоналию
	\item	Ограничения на вторичную персоналию
	\item	Параметры расширения
	\item	Список действий, которые выполняются при создании и модификации событий этого вида
\end{itemize}

\subsection{Редактирование видов персональных операций}

\ppypict{dlg-001}{Виды персональных операций}

Для просмотра и редактирования видов персональных операций выберите пункт меню
\ppymenu{Справочники\rdir Персоналии\rdir Виды персональных операций}.

При этом на экране появится диалог списка всех видов персональных операций, определенных в
вашей базе данных. В этом диалоге, как и в большинстве аналогичных, доступны кнопки создания
новой записи, редактирования и удаления выбранной записи.

Диалог редактирования записи показан на рис.~\ref{pic-dlg-001}.
Ниже перечислены управляющие элементы этого диалога и приведено их описание.

\begin{description}
	\item[Наименование]
	Уникальное среди всех видов персональных операций наименование, по которому пользователи
	идентифицируют этот вид операции.
	Максимальная длина строки - 47 знаков.

	\item[Символ]
	Уникальное среди всех видов персональных операций символьное имя, необходимое для ссылки
	на этот вид операции из формул и при автоматизации ввода.
	Это поле может быть пустым. Максимальная длина - 19 знаков.

	\item[\dlgcombo{Группа}]
	Группа, к которой относится данный вид операции. Комбо-бокс может быть пустым.

	\item[Парная операция]
	Операция, которая обрабатывается как парная для этой операции.

	\item[Тип регистрационного документа]
	Тип персонального регистрационного документа, ассоциированный с событием. События, для
	которых указан тип регистрационного документа, могут генерировать действия \ppyrsrv{Присвоить персоналии регистр} и
	\ppyrsrv{Отозвать у персоналии регистр} по соответствующему типу регистра.

	В качестве примера: событие \qu{Прием на работу} может содержать регистрационный документ
	\qu{Приказ о приеме на работу}, в котором указывается номер, дата и подписавшее приказ
	ответственное лицо.

	\item[\dlgflag{Уникальная}]
	Если установлен этот флаг, то каждая персоналия может иметь не более одного события,
	относящегося к этому виду. Тривиальный пример такого события - рождение (вряд ли вы
	будете учитывать такое событие, но пример этот достаточно нагляден).

	\item[\dlgflag{Обязательная}]
	Не используемый признак.

	\dlgradioc{Парность операции}
	\begin{description}
		\item[\dlgradioi{Не парная}]
		События этого вида не могут имеют парного события.

		\item[\dlgradioi{Открывающая парная}]
		События этого вида предшествуют событиям, соответствующим парному виду операции.

		\item[\dlgradioi{Закрывающая парная}]
		События этого вида заключают пару, начавшуюся событием, относящимся к парному виду.
		Если для события нет соответствующей открывающей пары, то система выдает сообщение об
		ошибке и не допускает ввод такого события.

		\item[\dlgradioi{Нуль-закрывающая парная}]
		События этого вида заключают пару, начавшуюся событием, относящимся к парному виду.
		При этом система не требует наличия открывающего события.
	\end{description}

	\item[\dlgbutton{Первичная персоналия}]
	Параметры, ограничивающие выбор первичной персоналии (той персоналии, которой соответствует
	событие).

	Диалог редактирования этих ограничений показан и описан ниже.

	\item[\dlgbutton{Вторичная персоналия}]
	Открывает диалог редактирования ограничений на вторичную персоналию.
	Подробности см. ниже.

	\item[\dlgbutton{Расширение}]
	Параметры расширения персональной операции. При нажатии этой кнопки появляется диалог,
	в котором можно указать дополнительные характеристики операции (должность или список тегов).

	\item[\dlgbutton{Действия}]
	При нажатии на эту кнопку появляется диалог редактирования списка действия, соответствующих
	событиям этого вида.

	\item[Таймаут для повтора, секунд]
	Специальная опция, позволяющая повторить некоторые действия, связанные с событием без создания
	нового события.

	Если в течении заданного здесь периода будет введено новое событие этого же вида и с той же первичной
	персоналией, то само событие создано не будет, но будут произведены действия, имеющие признак \dlgflag{Выполнять при повторе}.

	\item[\dlgcombo{Ограничивающий календарь}]
	Здесь может быть выбран штатный календарь, используемый как ограничивающий фактор для даты и времени
	события. Если календарь указан, то при вводе нового события система следит за тем, чтобы момент события
	попадал в один из допустимых периодов календаря.

	\item[Максимум событий в течении одного периода календаря]
	Поле, имеющее смысл только в контексте описанного выше ограничивающего календаря. Если здесь задано
	значение больше нуля, то при вводе нового события система будет следить чтобы за одни период календаря
	было не более заданного количества событий данного вида для одной и той же первичной персоналии.

\end{description}

\subsubsection{Параметры, ограничивающие выбор персоналии}

\ppypict{dlg-psnopkind-restriction}{Диалог ограничений выбора персоналии}

Диалог редактирования ограничений на выбор персоналии в персональной операции
показан на рис.~\ref{pic-dlg-psnopkind-restriction}.

Вид диалога ограничений на первичную и вторичную персоналии в виде операции
незначительно отличаются: для вторичной персоналии в диалоге присутствует
комбо-бокс \dlgcombo{По умолчанию}, которого нет в диалоге ограничения на
первичную персоналию.

Далее перечисляются управляющие элементы диалога:

\begin{description}
	\item[\dlgcombo{Вид}]
	Здесь может быть выбран вид, которому
	должна принадлежать персоналия, участвующая в персональном событии.

	Не смотря на то, что этот комбо-бокс можно оставить пустым, мы настоятельно
	рекомендуем ограничивать событие конкретным видом персоналии. В противном
	случае список выбора персоналии в диалоге события будет содержать
	все записи персоналий из базы данных. Что не только не удобно, но и
	чревато значительным числом ошибок ввода.

	\item[\dlgradioc{Тип юридического статуса}]
	Опциональное ограничение, позволяющее избежать части ошибок ввода.
	Возможные варианты здесь следующие:
	\begin{description}
		\item[\dlgradioi{Любой}] Система на будет ограничивать выбор персоналии
		по юридическому статусу.
		\item[\dlgradioi{Физическое лицо}] Программа будет допускать выбор только
		тех персоналий, чей юридический статус имеет признак \dlgradioi{Физическое лицо}.
		\item[\dlgradioi{Юридическое лицо}] В противоположность предыдущему варианту,
		в этом случае система будет допускать выбор только тех персоналий,
		чей юридический статус имеет признак \dlgradioi{Юридическое лицо}.
	\end{description}

	Подробно о юридических статусах персоналий рассказано на стр.~\pageref{sec-person-status}.

	\item[\dlgcombo{Ограничивающий тег}]
	Если в этом комбо-боксе выбран какой-либо персональный тег, то
	при вводе персонального события, соответствующего этому виду операции,
	система будет следить за тем, чтобы указанный тег для выбранной
	персоналии существовал и его значение было бы больше нуля (естественно,
	что тип этого тега должен быть числовым).

	\item[\dlgcombo{По умолчанию}]
	Этот параметр присутствует только в ограничениях вторичной персоналии.
	Если значение определено, то при создании нового события, относящегося к
	этому виду операции, программа автоматически установит эту персоналию как
	вторичную для события.

	Данная опция удобна тогда, когда большинство событий этого вида имеет
	одну и туже вторичную персоналию. Например, штатные операции, где
	вторичной персоналией почти всегда является главная организация.
\end{description}

\subsubsection{Расширение персональной операции}

\ppypict{dlg-004}{Расширение персональной операции}

Диалог редактирования расширения персональной операции показан на рис.~\ref{pic-dlg-004}.
Вот описание управляющих элементов диалога:

\begin{description}
	\item[\dlgradioc{Тип расширения}]
	Определяет дополнительные параметры, которые могут быть
	введены в диалоге персонального события, соответствующего данному виду операции.
		\begin{description}
		 	\item[\dlgradioi{Нет}] события этого вида не имеют расширения
			\item[\dlgradioi{Тег}] события этого вида имеет расширение в виде списка тегов.
			В нижней части этого диалога следует перечислить типы тегов, которые
			пользователь должен указать в событии этого вида.
			\item[\dlgradioi{Должность}] события этого вида имеют расширения в виде должности.
			При вводе событий этого вида пользователь должен указать должность
			первичной персоналии, ассоциированную с событием.
		\end{description}

	\item[Расширенные теги]
	Если задан тип расширения \dlgradioi{Тег}, то в этот список следует добавить типы тегов, которые
	пользователь может (но не обязан) задать для конкретного события этого вида.

\end{description}

\section{Использование персональных операций}

\subsection{Таблица персональных операций}

Таблица персональных операций является основным инструментом для ввода и
анализа персональных операций. Таблица позволяет не только увидеть список операций,
но и сгруппировать его по множеству критериев для анализа работы предприятия.

Обратиться к этой таблице можно через пункт меню \ppymenu{Справочники\rdir Персоналии\rdir Персональные операции}.

\subsubsection{Фильтр персональных операций}

\ppypict{dlg-f-001}{Фильтр по персональным событиям}

То, как выглядит диалог фильтре персональных операций, показано на рис.~\ref{pic-dlg-f-001}.
Описание элементов этого диалога приведено ниже.

\begin{description}
	\item[Период]
	Период, за который вы хотите увидеть персональные события. Если период пустой, то будут
	показаны события независимо от того, каким числом они датированы.

	\item[\dlgcombo{Операция}]
	Вид персональной операции. Если вы хотите увидеть события, соответствующие нескольким
	видам операций, то нажмите кнопку \dlgbutton{\dots} справа от этого комбо-бокса и перенесите интересующие
	вас виды операций из левого списка в правый.

	\item[\dlgcombo{Персоналия}]
	Первичная персоналия по событиям, которые вы хотите увидеть. Благодаря этому критерию
	фильтрации, вы можете отделить операции, относящиеся только к одной персоналии.
	Если поле пустое, то первичная персоналия не будет ограничителем выборки операций.

	\item[\dlgcombo{Контрагент}]
	Вторичная персоналия по событиям, которые вам необходимо просмотреть.

	\item[\dlgradioc{Подстановка}]
	Аналитический критерий. Позволяет сгруппировать операции по одному из следующих
	признаков:
	\begin{description}
		\item[\dlgradioi{Операция}]
		\item[\dlgradioi{Персоналия}]
		\item[\dlgradioi{Контрагент}]
	\end{description}
	В дальнейшем этот список может быть расширен.

	\item[\dlgcombo{Подстановка даты}]
	Если вы выберите один из предложенных в этом комбо-боксе вариантов, то персональные
	операции в выборке будут сгруппированы по соответствующим периодам.
	Одновременный выбор подстановки и подстановки даты позволит увидеть комбинированную
	группировку по двум критериям свертки.

	В комбо-боксе доступны следующие варианты:
	\begin{description}
		\item[Неделя] События будут сгруппированы по календарным неделям.
		\item[Месяц] События будут сгруппированы по календарным месяцам.
		\item[Квартал] Этот выбор позволит \qu{свернуть} все события по-квартально.
		\item[Год] Группирует персональные операции по календарным годам.
		\item[Час] Группирует события по времени (в совокупности по всему периоду,
		ограниченному одноименным полем). Дробность группировки - 15 минут.
		\item[День недели] Группирует события по дням недели в совокупности по
		всему периоду, определенному этим фильтром.
	\end{description}

	\item{\dlgflag{Парные события без пары}}
	Флаг, позволяющий получить отчет о событиях, требующих парной операции, но не имеющих таковой.

\end{description}

\subsubsection{Действия в таблице персональных операций}

\ppypictsc{brw-001}{Таблица персональных операций}{0.4}

Вид таблицы персональных операций без группировки показан на рис.~\ref{pic-brw-001}.

Далее перечисляются действия, доступные в этой таблице.

	\paragraph{Редактирование операции}\indent\keyb{Enter} Вызывает диалог редактирования выбранной персональной операции
	\paragraph{Создать операции}\indent\keyb{Insert} Вызывает диалог создания новой персональной операции
	\paragraph{Удалить операции}\indent\keyb{Delete} Удаляет выбранную персональную операцию (предварительно выдает предупреждение).
	\paragraph{Просмотр событий по операции}\indent\keyb{Ctrl-J}
	Показывает системный журнал, в котором отображаются системные события по выбранной
	персональной операции.
	\paragraph{Итог по выборке}\indent\keyb{F9} Показывает диалог, в котором отображается количество записей в выборке
	\paragraph{Печать}\indent\keyb{F7} Отправка отчета на печать либо экспорт отчета.

\subsection{Диалог редактирования персональной операции\label{sec-personevent-edit}}

\ppypictsc{dlg-060}{Редактирование персональных операций}{0.4}

Вид диалога показан на рис.~\ref{pic-dlg-060}. Далее следует детальное описание
этого диалога.

\begin{description}
	\item[Дата]
	Дата операции. При создании нового события в этом поле устанавливается текущая дата.

	\item[Время]
	Время операции. При создании нового события в этом поле устанавливается текущее время.

	\item[\dlgcombo{Персоналия}]
	Первичная персоналия, которой, собственно, соответствует это событие.
	В этом комбо-боксе система предлагает выбрать персоналию из списка, ограниченного видом
	персоналий заданным в параметрах вида персональной операции.

	\item[Карта]
	Номер карты персоналии. Эта карта будет ассоциирована с записью персональной операции.

	Если карта кредитная или бонусная, то к ней могут быть применены действия персональной операции:
	\ppyrsrv{Начисление на персональную карту} и \ppyrsrv{Списание с персональной карты}.

	\item[\dlgcombo{Контрагент}]
	Вторичная персоналия, связанная с событием.
	В этом комбо-боксе система предлагает выбрать персоналию из списка, ограниченного видом
	персоналий заданным в параметрах вида персональной операции.

	\item[Карта]
	Номер персональной карты контрагента. Эта карта будет ассоциирована с записью персональной операции.

	Если карта кредитная или бонусная, то к ней могут быть применены действия персональной операции:
	\ppyrsrv{Начисление на персональную карту} и \ppyrsrv{Списание с персональной карты}.

	\item[\dlgcombo{Подразделение}]
	Это поле следует заполнять в том случае, если событие относится к управлению кадрами.
	В частности, если речь идет о приеме на работу или штатному перемещению сотрудников
	между подразделениями.

	\item[\dlgcombo{Должность}]
	Аналогично предыдущему, это поле важно в кадровых событиях (назначение на должность,
	снятие с должности и т.д.).

	\item[Примечание]
	Произвольный текст с дополнительным описанием события.

	\item[\dlgbutton{Регистр}]
	Открывает диалог редактирования регистрационного документа, связанного с событием.

	\item[\dlgbutton{Печать}]
	Печать информации об этом событии.

\end{description}

\subsection{Функции рабочего стола}

Система предоставляет следующие функции рабочего стола
для использования персональных операций:

\begin{description}
	\item[Персональные операции] Эта функция практически не требует комментариев,
	поскольку является дубликатом пункта меню \ppymenu{Справочники\rdir Персоналии\rdir Персональные операции}.
	Со стандартным для таких команд рабочего стола отличием - возможностью предварительного
	определения фильтра.
	\item[Добавить персональное событие]
	Команда рабочего стола, не имеющая аналога в меню. Позволяет создать новое событие без
	обращения к таблице персональных операций.
	\item[Создание нового персонального события по специальной команде]
	Расширенная функция создания нового персонального события. Поясняется ниже.
\end{description}

\subsubsection{Расширенное создание персонального события}

Опция расширенного создания персонального события с рабочего стола реализована
специально для быстрого обслуживания таких бизнес-процессов, как учет рабочего
времени, фиксация предоставления услуг по абонементам и т.д.

Она требует некоторого времени на предварительную настройку, что сторицей
оправдывается эффективностью обработки множества каждодневных операций.

\paragraph{Общее описание функции}

Эта функция запускается через ассоциации команд рабочего стола. Процесс вызова следующий:

\begin{itemize}
	\item На рабочем столе нажимается клавиша \keyb{F11}, вызывающая диалог
	ввода кода команды рабочего стола.
	\item В этом диалоге вводится последовательность символов, первая часть
	которых идентифицирует префикс команды, а вторая - код вида персональной
	операции (обычно эта последовательность распечатывается в виде штрихкода
	и считывается сканером).
	\item Далее появляется диалог, в котором выбирается персоналия. Она может быть
	быть выбрана либо по коду, либо непосредственным выбором из списка комбо-бокса.
	\item В зависимость от конфигурации, при правильном выборе персоналии,
	появляется либо стандартный диалог ввода персональной операции, в котором уже
	инициализированы большинство необходимых полей, либо специализированный
	диалог подтверждения ввода события.
\end{itemize}

\paragraph{Настройка команды рабочего стола}
Для настройки команды следует на рабочем столе нажать правую кнопку мыши и из
появившегося меню выбрать \ppymenu{Редактирование рабочих столов}.

В диалоге, который вслед за этим высветится на экране, нажмите кнопку \dlgbutton{Ассоциации команд}
(если команда должна относиться только к данному рабочему стола), либо \dlgbutton{Общие ассоциации команд}
(если команда должна действовать для всех рабочих столов, определенных для текущей базы данных).

Откроется список ассоциации команд. Нажмите кнопку \dlgbutton{Добавить} и увидите диалог
ввода ассоциации. Здесь необходимо установить флаги \dlgflag{Спец код} и \dlgflag{Спец код как префикс}.
В результате выбора первого флага откроется поле ввода \qu{Спец код/сочетание клавиш}. В этом поле
введите символы команды (например, 001) и выберите саму команду - \ppyrsrv{Добавить персональное событие}.

Подтвердите ввод, нажав во всех диалогах \dlgbutton{ОК}.

Обратим внимание на флаг \dlgflag{Спец код как префикс}, который вы должны были установить. Он означает,
что при сканировании строки команды система, обнаружив заданный префикс (в нашем примере 001) следующие
за ним символы будет воспринимать как дополнительную информацию, которая в случае с командой
\ppyrsrv{Добавить персональное событие} воспринимается как символ вида персональной операции.
Таким образом, когда пользователь вводит, скажем строку \qu{001501}, программа воспримет ее как
инструкцию для создания новой персональной операции вида с символом 501 (если вида операции с таким
символом нет в базе данных будет выдано сообщение об ошибке).

\paragraph{Диалог выбора персоналии}

\ppypict{dlg-psnop-selperson}{Диалог выбора персоналии}

Внешний вид диалога выбора персоналии при расширенном создании персонального
события показан на рис.~\ref{pic-dlg-psnop-selperson}.

Здесь присутствуют следующие управляющие элементы:

\begin{description}
	\item[Поле наименования вида операции] Справочное поле, содержащее
	наименование выбранной персональной операции.
	\item[Поле ввода кода персоналии] В этом поле пользователь может
	ввести код, по которому система будет искать персоналию.

	Применяется следующий алгоритм поиска персоналии по коду:
	\begin{itemize}
		\item Если в ограничении по первичной персоналии вида операции указан вид персоналии, и для этого вида персоналии определен
		поисковый регистр, то программа пытается найти персоналии, чей номер поискового регистра равен введенному в этом поле.
		\item Если поиск по предыдущему условию оказался не удачен, то система ищет дисконтную карту с указанным номером. Если
		такая карта найдена и к ней привязана персоналия, относящаяся к виду, заданному в ограничении по первичной
		персоналии для вида персональной операции, то это определяет успешный поиск персоналии.
	\end{itemize}

	Обратим внимание на заголовок этого поля ввода. Если в ограничении по первичной персоналии вида операции указан вид персоналии,
	и для этого вида персоналии определен поисковый регистр, то в заголовке поля отображается наименование этого типа регистрационных документов.

	В противном случае в заголовке отображается приглашение ввести номер дисконтной карты.

	Заметьте, в первом случае номер карты также может сработать, в то время,
	как во втором случае поиск может быть осуществлен только по дисконтной карте.

	Если вы собираетесь идентифицировать персоналии по поисковому регистру,
	то мы рекомендуем создать карточки с нанесенными на них штрихкодами,
	соответствующими номерам регистров.

	\item[\dlgcombo{Персоналия}] В случае невозможности идентифицировать
	персоналию, для которой вводится операция, по номеру, можно просто выбрать
	ее в данном комбо-боксе.

	Список этого комбо-бокса ограничивается видом первичной персоналии, заданным в
	качестве ограничивающего в опциях вида персональной операции.

	\item[\dlgcombo{Вторичная персоналия}] Для некоторых операций
	желательно указывать вторичную персоналию. Этот комбо-бокс как раз
	служит этой цели.

	Список комбо-бокса ограничивается видом вторичной персоналии, заданным в
	качестве ограничивающего в опциях вида персональной операции.
\end{description}

\paragraph{Диалог подтверждения события}

Стандартное продолжение сценария добавления персонального события посредством команды
рабочего стола состоит в появлении обычного диалога редактирования нового события (стр.~\pageref{sec-personevent-edit}).

\ppypict{dlg-psnop-info}{Специализированный диалог завершения ввода события}

Специальная опция в конфигурации персоналий \dlgflag{Показывать картинку при вызове ассоциаций команд}
(стр.~\pageref{sec-person-cfg}) позволяет изменить способ завершения ввода нового
персонального события. В этом случае на экране появится диалог, изображенный на рис.\ref{pic-dlg-psnop-info}.
Диалог имеет в основном информационные элементы:

\begin{description}
	\item[Фотография] Отображает фотографию первичной персоналии, к которой относится событие
	(если база данных содержит фотографию для этой персоналии).
	\item[Поле информации] Здесь выводится информация о карте, по которой идентифицирована
	персоналия либо о регистре, если идентификация была осуществлена по регистру.
	Если персоналия была выбрана из списка комбо-бокса, то в этом поле отображаются данные
	о поисковом регистре персоналии (если таковой имеется).
	\item[Поле предупреждения] Если какие-либо условия создания персональной операции
	нарушаются, то здесь выводится информация об этом.
	\item[Индикатор предупреждения] В случае наличия ограничений на проведение
	этой операции индикатор имеет красный цвет, в противном случае - зеленый.
\end{description}

\paragraph{Специальные ограничения на проведение персональных операций}

При использовании специализированного диалога завершения ввода персональной операции
применяются дополнительные ограничения. Вот их список:

\begin{itemize}
	\item Если персоналия идентифицирована по номеру дисконтной карты,
	то проверяются следующие атрибуты карты:
	\begin{itemize}
		\item Признак \dlgflag{Закрыта}
		\item Дата истечения срока действия карты. Если текущая системная дата
		больше чем дата истечения срока действия карты, то операция не может быть
		проведена.

		Пустая дата истечения срока действия карты ни как не ограничивает операцию.
		\item Время действия. Если текущее системное время не входит в диапазон
		времени, указанный в карте, то операция не возможна.
	\end{itemize}
	\item Если персоналия идентифицирована не по дисконтной карте и имеет
	поисковый регистр, то дата истечения срока действия регистра (если определена)
	не должна превышать текущую системную дату.
	\item Стандартные критерии проведения персональной операции, определенные
	видом персональной операции.
\end{itemize}

\chapter{Кадры\label{ch-staff}}

Кадровый учет в системе \ppybrand{} базируется на следующий объектах данных:
\begin{itemize}
	\item 	Персоналии
	\item 	Персональные операции
	\item 	Штатное расписание
	\item 	Штатные назначения
	\item 	Штатные календари
	\item 	Штатные суммы
\end{itemize}
Работая вместе, эти объекты данных позволяют получить необходимую гибкость и удобство в
учете человеческих ресурсов предприятия.
Упрощенная схема взаимосвязей этих объектов приведена на рис.~\ref{pic-schema-staff}.

\ppypict{schema-staff}{}

\section{Штатное расписание}

Штатное расписание определяет список должностей, связанных с некоторой организацией и,
возможно, подразделением этой организации. Вы можете иметь штатное расписание для любой
из организаций, относящихся к зарезервированному виду \ppyrsrv{Работодатели}.
Каждая должность характеризуется следующими атрибутами:
\begin{itemize}
	\item 	Наименование
	\item 	Организация-работодатель
	\item 	Подразделение организации-работодателя
	\item 	Количество ставок
	\item 	Список именованных сумм, используемый для начисления заработной платы сотрудникам,
занимающим эту должность
\end{itemize}

Штатные должности, кроме прочего, выполняют важную функцию по группировке штатных
назначений, благодаря которой, администрирование информации о сотрудниках значительно
упрощается. Этот результат достигается благодаря наследованию сумм и календарей от штатных
должностей к штатным назначениям (рассмотрены ниже).

\subsection{Таблица штатного расписания}

\ppypict{brw-stafflist}{}

Доступ к штатному расписанию осуществляется через пункт меню \ppymenu{Кадры\rdir Штатное
расписание}.

Фильтр штатного расписания достаточно прост и включает два опциональных поля:
организация-работодатель и подразделение. Каждое из этих полей ограничивает выборку штатного
расписания, соответственно, по работодателю и подразделению.

Таблица содержит следующие колонки:
\begin{itemize}
	\item	Наименование штатной должности
	\item	Ранг штатной должности
	\item	Количество ставок (общее количество работников, которые должны, либо могут, быть
	назначены на эту должность.
	\item	Количество занятых ставок
\end{itemize}

\subsubsection{Действия в таблице штатного расписания}

	\paragraph{Редактировать штатную должность}\indent\keyb{Enter}
	Вызывает диалог редактирования выбранной штатной должности. Подробно диалог рассмотрен ниже.
	Эта функция не доступна, если у пользователя нет прав на модификацию штатного расписания.

	\paragraph{Добавить новую должность}\indent\keyb{Insert}
	Вызывает диалог создания новой штатной должности.
	Эта функция не доступна, если у пользователя нет прав на создание элемента штатного
	расписания.

	\paragraph{Удалить должность}\indent\keyb{Delete}
	Дает возможность удалить штатную должность. Перед удалением система запрашивает
	подтверждение на это.
	Если к штатной должности привязаны назначения, либо на нее ссылаются какие-либо объекты
	данных, то система не позволить ее удалить.
	Кроме того, функция не доступна, если у пользователя нет прав на удаление штатной
	должности.

	\paragraph{Штатные единицы}\indent\keyb{F3}
	Просмотр и редактирование назначений по выбранной должности

	Открывает таблицу назначений для выбранной штатной должности. Эта таблица рассмотрена
	ниже.

	\paragraph{Штатные календари, соответствующие выбранной должности}\indent\keyb{Ctrl-E}
	Позволяет просматривать и редактировать штатные календари, привязанные к выбранной
	штатной должности. Заметим, что речь здесь идет именно о тех календарях, которые
	непосредственно связаны с этой должностью. Особенности штатных календарей рассмотрены в
	соответствующем разделе.

	\paragraph{Фильтр}\indent\keyb{Ctrl-V}
	Типичная для большинства таблиц функция, позволяющая изменить условия просмотра.

	\paragraph{Проверка и восстановление целостности штатного расписания}\indent\keyb{Ctrl-R}
	Специализированная функция, проверяющая и, при необходимости, восстанавливающая некоторые
	параметры штатного расписания.
	По традиции, мы не документируем особенности этой функции, но лишь обеспечиваем ее
	безопасность (т.е., вы можете обращаться к этой функции без страха что-либо сломать).

\subsection{Диалог редактирования штатного расписания}

\ppypict{dlg-staff}{Штатная должность}

Диалог, показанный на рис.~\ref{pic-dlg-staff}, содержит следующие поля:

\begin{description}
	\item[Наименование]
	Наименование штатной должности. Это наименование должно быть уникально в пределах одного
	подразделения одного предприятия. То есть в одном подразделении не может быть двух
	должностей, названных, скажем, \qu{Бухгалтер}.
	В тоже время, на одном предприятии может быть две должности \qu{Бухгалтер}, относящиеся к
	разным подразделениям.

	\item[\dlgcombo{Организация}]
	Предприятие, к которому относится штатная должность. Выбор предприятий осуществляется по
	признаку принадлежности зарезервированному виду \ppyrsrv{Работодатели}.

	\item[\dlgcombo{Подразделение}]
	Подразделение, к которому относится штатная должность. Каждое подразделение имеет жесткую
	привязку к предприятию.
	Система не следит за обязательным заполнением этого поля.

	\item[Фиксированная должность]
	Специализированный признак. Его предназначение - привязка сотрудников к организациям для
	печати первичных документов. Использование фиксированных должностей позволяет обойти
	ограничение общих настроек (в которых указывается директор и главный бухгалтер
	предприятия без привязки к конкретной главной организации).

	\item[Ранг]
	Целочисленное значение, смысл которого - в изменении порядка сортировки представления
	должностей в списках и таблицах. Чем меньше значение ранга тем выше штатная должность
	стоит в списках. При этом штатные должности, имеющие равный ранг, сортируются по
	наименованию.

	\item[Количество ставок]
	Максимальное количество назначений, которое можно сделать на эту должность.

	\item[\dlgcombo{Группа начислений}]
	Группа начислений заработной платы, применяемая для этой должности.
	Группа начислений для должности может быть переопределена группой начислений,
	определенной для конкретного назначения на эту должность. Если же для назначения
	не определена группа начислений, то используется та, которая задана здесь.

	\item[\dlgbutton{Суммы}]
	Список сумм, применяемых для расчета заработной платы для штатных назначений на
	эту должность. Аналогично группе начислений, эти суммы могут переопределены величинами,
	определенными для конкретного назначения или персоналии.

\end{description}

\section{Штатные назначения}

Штатные назначения обеспечивают связку между персоналиями и штатными должностями, которые
они занимают в той или иной организации. Здесь важно уточнить различие между собственно
персоналией и должностью, которую она занимает. Так, один человек может одновременно
работать более чем на одном предприятии, либо занимать на одном предприятии несколько
должностей. Кроме того, чтобы точно знать историю назначений, переводов и увольнений по
предприятию, необходимо хронологически фиксировать как увольнения, так и повторные
назначения одного человека на одну и ту же должность.

Штатное назначение имеет следующие наиболее существенные атрибуты:
\begin{itemize}
 	\item	Штатная должность
	\item	Персоналия
	\item	Код
	\item	Дата назначения
	\item	Дата снятия
	\item	Признак закрытого назначения
	\item	Список именованных сумм, используемый для начисления заработной платы
\end{itemize}
Некоторых пояснений требует признак закрытого назначения. Для правильного учета,
перемещения людей по должностям, их приемы на работу и увольнения, должны четко
фиксироваться по датам.

Если назначение будет удалено, то исчезнет и вся связанная с ним информация
(начисления зарплаты, поощрения, взыскания и т.д.). По этому, когда человек уходит с
должности (неважно, увольняется он или переходит на другую должность), то соответствующее
назначение закрывается и одна ставка должности освобождается. В дальнейшем, вы сможете
видеть все закрытые назначения и события связанные с ними.

\subsection{Таблица штатных назначений}

\ppypict{brw-staffpost}{Примерный вид таблицы штатных назначений}

Доступ к таблице штатных назначений возможен двумя способами:
\begin{enumerate}
	\item Через таблицу штатного расписания. В этом случае,
	вы можете видеть назначения, соответствующие выбранной штатной должности
	\item Через пункт меню \ppymenu{Кадры\rdir Кадры\dots}
\end{enumerate}

Внешний вид таблицы показан на рис.~\ref{pic-brw-staffpost}.

\subsubsection{Фильтр штатных назначений}

\ppypict{dlg-f-ppost}{Диалог фильтра штатных назначений}

Фильтр просмотра штатных назначений (рис.~\ref{pic-dlg-f-ppost}) представлен следующими элементами:

\begin{description}
	\item[\dlgcombo{Работодатель}]
	В этом комбо-боксе можно выбрать персоналию, к которой относятся штатные назначения.

	Список персоналий в списке этого комбо-бокса относится к зарезервированному
	виду \ppyrsrv{Работодатели}.

	\item[\dlgcombo{Подразделение}]
	Комбо-бокс, позволяющий ограничить показываемые назначения только выбранным
	подразделением. Выбор подразделения, в свою очередь, ограничен выбранным работодателем.

	\item[\dlgcombo{Штатная должность}]
	Выбор штатной должности в этом комбо-боксе ограничит показ назначений только этой
	должностью.

	\item[Период назначения на должность]
	Период, в течении которого персоналия была назначена на должность.
	Если поле не пустое, то вы сможете получить выборку только тех назначений,
	которые были произведены в заданный период.

	\item[Период снятия с должности]
	Период, в течении которого персоналия была снята с должности.
	Если поле не пустое, то выборка будет ограничена только теми
	назначениями, которые закрыты и дата закрытия которых попадает
	в указанный период.

	Обратите внимание на то, что данный критерий может конфликтовать
	с переключателем, описанным ниже, если он установлен в положение
	\dlgradioi{Только открытые} (выборка просто будет пустой, поскольку
	открытые назначения не имеют даты закрытия).

	\item[Критерий по признаку закрытия]
	Этот переключатель позволяет ограничить выборку либо только
	открытыми назначениями, либо только закрытыми, либо не ограничивать
	вовсе по этому критерию.

	\begin{description}
		\item[\dlgradioi{Все}] будут показаны все назначения, независимо от признака \dlgflag{Закрыто}
		\item[\dlgradioi{Только открытые}] будут показаны только открытые на данный момент назначения
		\item[\dlgradioi{Только закрытые}] будут показаны только закрытые назначения.
	\end{description}
\end{description}

\subsubsection{Действия в таблице штатных назначений}

	\paragraph{Редактировать}\indent\keyb{Enter}
	Открывает диалог  редактирования штатного назначения.
	При редактировании поле персоналии заблокировано для изменения: менять персоналию в
	уже существующем назначении нельзя. Если в этом есть необходимость, то следует закрыть
	или удалить данное назначение и создать новое.

	\paragraph{Добавить}\indent\keyb{Insert}
	Открывает диалог для создания нового штатного назначения.

	\paragraph{Удалить}\indent\keyb{Delete}
	Удаляет выбранное назначение.
	Как уже говорилось выше, не рекомендуется пользоваться этой функцией. В случае, если
	сотрудник увольняется или переходит на другую должность, текущее назначение следует
	закрывать.

	\paragraph{Персоналия}\indent\keyb{F2}
	Позволяет посмотреть и редактировать персоналию, соответствующую назначению.

	\paragraph{Штатные календари}\indent\keyb{Ctrl-E}
	Показывает штатные календари, связанные с выбранным назначением.
	Напомним, что календари имеют иерархическую связь с объектами кадрового учета. По этой
	команде вы можете видеть только те календари, которые непосредственно привязаны к
	назначению. Другими словами, если здесь вы не видите ни одного календаря, это не значит,
	что с назначением фактически не связано ни одного календаря (они могут быть привязаны к
	персоналии, штатной должности и т.д.).

	\paragraph{Фильтр}\indent\keyb{Ctrl-V}
	Позволяет изменить фильтр выборки.

\subsection{Диалог редактирования штатного назначения}

\ppypict{dlg-staffpost}{Должностное назначение}

Диалог штатного назначения показан на рис.~\ref{pic-dlg-staffpost}.
Управляющие элементы этого диалога сведены в следующей таблице.

\begin{description}
	\item[\dlgcombo{Предприятие}]
	Предприятие, которому принадлежит штатная должность, соответствующая этому назначению.
	Данное поле используется для того, чтобы ограничить список штатных должностей, которые
	выбираются в комбо-боксе \dlgcombo{Должность}.

	\item[\dlgcombo{Подразделение}]
	Подразделение, которому принадлежит штатная должность, соответствующая назначению.
	Поле используется для ограничения списка штатных должностей, которые выбираются в
	комбо-боксе \dlgcombo{Должность}. Если подразделение не выбрано, но выбрано предприятие, то в
	комбо-боксе \dlgcombo{Должность} будут показаны все должности, относящиеся к предприятию,
	выбранному в соответствующем поле.

	\item[\dlgcombo{Должность}]
	Должность, которой соответствует редактируемое или создаваемое штатное назначение.

	\item[\dlgcombo{Персоналия}]
	Персоналия, назначаемая на штатную должность.

	\item[\dlgcombo{Группа начислений}]
	Группа начислений заработной платы. Если это значение здесь не выбрано, то при расчете
	заработной платы применяется группа начислений, заданная для штатной должности.

	\item[Дата назначения]
	Дата назначения персоналии на штатную должность.

	\item[Дата снятия]
	Дата снятия персоналии со штатной должности. Это поле может быть заполнено только в том
	случае, если установлен признак \dlgflag{Закрыта}.

	\item[\dlgflag{Закрыта}]
	Если этот флаг включен, то назначение более не является актуальным. То есть персоналия
	была снята с указанной должности.
	Закрытые назначения необходимы для отслеживания истории движения персоналий по должностям.
	Закрытое назначение не учитывается в счетчике назначений по должности. То есть, после
	закрытия назначения одна вакансия по должности освобождается.

	\item[\dlgbutton{Суммы}]
	Список сумм, применяемых для расчета заработной платы для этого штатного назначения.
\end{description}

\section{Штатные календари\label{sec-staffcal}}

Штатные календари являются инфраструктурными объектами, обеспечивающими подсчет рабочего
времени сотрудников.
Штатный календарь характеризуется следующими основными атрибутами:
\begin{itemize}
	\item 	Наименование
	\item	Символ
	\item	Связанный объект
	\item	Родительский календарь (только для календарей, связанных с объектами)
	\item	Признак унаследованного календаря %
	\item	Список элементов
\end{itemize}

\ppypict{dlg-061}{Штатный календарь}

На последнем пункте остановимся чуть подробнее. Список элементов, собственно, составляет
суть штатного календаря. Каждый элемент списка определяет дату (набор дат) и
продолжительность. Мы не уточняем дату и продолжительность чего именно определяет элемент,
поскольку это определяется назначением конкретного календаря.
Каждый элемент может быть задан тремя различными способами:

\begin{itemize}
	\item Как точная дата
	\item Как календарный день (не зависящий от года)
	\item Как день недели
\end{itemize}

В связи с этим, существует твердое правило подсчета элементов календаря системой: для
определения, что некоторая дата входит в календарь, система сначала ищет ее точное
представление, затем, если не находит, ищет календарный день не зависящий от года, и
наконец, если предыдущие две попытки окончились неудачей, то ищет день недели,
соответствующий заданному дню.

Кроме того, элемент календаря может быть помечен специальным признаком \dlgflag{Пропуск}. В этом
случае, дата, определяемая этим элементом, не входит в дни, определенные календарем.
Важной особенностью штатных календарей, о которой необходимо знать, является их
иерархическая организация. То есть, множество типов объектов данных (персоналии, штатные
должности, штатные назначения) могут быть связаны с собственными календарями. При этом, в
системе жестко определена иерархия, в соответствии с которой она применяет эти календари
при расчетах действительного рабочего времени. Иерархия использования календарей, при
расчете рабочего времени по штатному назначению, следующая:

%\ppypictsc{StCalUsageHier}{}{0.4}
\ppypict{StCalUsageHier}{}

%\begin{enumerate}
%	\item Персоналия, участвующая в штатном назначении
%	\item Штатное назначение
%	\item Штатная должность
%	\item Персоналия-работодатель
%	\item Заголовочный календарь (не привязанный к конкретному объекту).
%\end{enumerate}

\subsection{Диалог элемента штатного календаря}

\ppypict{dlg-staffcalentry}{Диалог элемента штатного календаря}

Диалог показан на рис.~\ref{pic-dlg-staffcalentry}.

\begin{description}
	\item[Переключатель способа определения элемента]
	Задает метод определения элемента:
	\begin{description}
		\item[\dlgradioi{Дата}]
		Точная дата.
		\item[\dlgradioi{Календарный день}]
		Календарный день, одинаковый для любого года.
		\item[\dlgradioi{День недели}]
		День недели.
	\end{description}
	\item[Дата]
	Это поле актуально для способов определения элемента \dlgradioi{Дата}
	и \dlgradioi{Календарный день}. Во втором случае указывается только день
	и месяц. Например: 8/3 - 8 марта любого года.

	\item[\dlgcombo{День недели}]
	Поле используется только при выбранном способе определения элемента
	\dlgradioi{День недели}.

	\item[Время начала]
	\item[Время окончания]
	\item[Продолжительность]
	\item[\dlgflag{Пропуск}]
	Если флаг установлен, то данный элемент определяет день или дни,
	когда результирующий календарь имеет пропуск. Например, это может быть
	выходной день в регулярном календаре сотрудника.

	\item[\dlgflag{Протяженный режим}]
	Элемент, имеющий признак протяженного режима определяет начало периода
	каждый день которого входит в результирующий календарь.
	Протяженный режим устанавливается, например, при наступлении события,
	окончание которого не определено. Скажем, болезнь или отпуск с не определенным
	окончанием.
\end{description}

\subsection{Регулярный календарь}

Регулярный календарь определяет штатную занятость сотрудников. Проще выражаясь, это
календарь, задающий рабочий график сотрудника без учета его возможных болезней, отпусков,
командировок и т.д.  В конфигурации персоналий указывается какой календарь является
регулярным.

\subsection{Подстановочный календарь}

Понятие подстановочного календаря является вспомогательным. Его смысл заключается в том,
чтобы штатным назначениям или персоналиям можно было присваивать разные фактические
календари, но ссылаться на них так, как будто речь идет об одном и том же.

Типичный пример полезности подстановочного календаря - определение для штатного назначения %
регулярного календаря с подстановкой альтернативного. Скажем, мужчины и женщины на
предприятии имеют разный график работы. Тогда мы определяем два графика МУЖ и ЖЕН и при
назначении на должность женщины назначаем ей календарь, унаследованный от регулярного, а
подстановочный указываем ЖЕН. Аналогично, при назначении на должность мужчины, устанавливаем
ему календарь, унаследованный от регулярного, но с подстановкой МУЖ.

\subsection{Анализ штатных календарей}

Отчет анализа штатных календарей позволяет просматривать и группировать элементы
выбранных штатных календарей по различным критериям.

Отчет доступен через пункт меню \ppymenu{Кадры\rdir Анализ штатных календарей}.

\subsubsection{Фильтр анализа штатных календарей}

\ppypictsc{dlg-f-012}{Фильтр штатных календарей}{0.5}

Внешний вид диалога редактирования фильтра отчета показан на рис.~\ref{pic-dlg-f-012}.
Следующая таблица поясняет назначение элементов этого диалога.

\begin{description}
	\item[Период]
	Период, за который будут анализироваться записи в штатных календарях.

	\item[\dlgcombo{Тип связанных объектов}]
	Так как штатные календари могут быть связаны с различными объектами в базе данных, то здесь
	можно уточнить, связанные с какими типами объектов календари вы собираетесь анализировать.
	Если этот комбо-бокс оставить пустым, то будут показаны только записи штатных календарей,
	которые не связаны ни с какими объектами данных.

	\item[\dlgcombo{Вид персоналии}]
	Комбо-бокс доступен только тогда, когда выбран тип связанного объекта \ppyrsrv{Персоналии}.
	Здесь вы можете уточнить вид персоналий для использования следующего
	критерия фильтрации \qu{Объект}.

	\item[\dlgcombo{Объект}]
	В зависимости от типа связанного объекта здесь может быть выбрана либо
	персоналия, либо штатная должность, по которой вы хотите проанализировать
	штатные календари.

	Для типа связанного объекта \ppyrsrv{Должностное назначение} это комбо-бокс
	не доступен.

	\dlgbutton{\dots} справа от комбо-бокса позволяет выбрать
	несколько связанных объектов.

	\item[\dlgcombo{Календарь}]
	В этом комбо-боксе может быть выбран календарь, по которому необходимо
	провести анализ.

	\item[\dlgcombo{Календарь проекции}]
	Здесь можно выбрать календарь, на который должны быть спроецированы
	календари отчета.

	Опция выбора календаря проекции очень полезна при тестировании
	календарных периодов для расчета заработной платы.

	Подробно о проекциях календарей рассказано в гл.~\ref{ch-salary}.

	\item[\dlgflag{Инверсивная проекция}]
	Данный флаг используется только тогда, когда выбран календарь
	проекции (см. выше).

	При установки флага будут рассчитываться инверсивные проекции
	выбранных календарей на календарь проекции.

	\dlgbutton{\dots} справа от поля предоставляет возможность
	выбора нескольких календарей.

	\item[\dlgcombo{Группировка}]
	Этот комбо-бокс позволяет выбрать вариант группировки отчета
	по периоду.

	Доступными опциями являются:
	\begin{description}
		\item[\dlgradioi{Неделя}]
		\item[\dlgradioi{Месяц}]
		\item[\dlgradioi{Квартал}]
		\item[\dlgradioi{Год}]
	\end{description}

	В сгруппированном отчета отображаются итоговые продолжительность и
	количество элементов за каждый период группировки и по каждому
	из объектов. Например, с помощью группирующего отчета можно проанализировать
	количество часов, пропущенных сотрудниками по болезни и т.п.

	\item[\dlgradioc{Сортировка}]
	Определяет порядок сортировки записей в отчете.
	\begin{description}
	 	\item[\dlgradioi{По дате}]
		\item[\dlgradioi{По объекту}]
	\end{description}

\end{description}

\subsubsection{Таблица анализа штатных календарей}

\ppypict{brw-017}{Штатные календари}{}

Примерный вид таблицы анализа штатных календарей показан на рис.~\ref{pic-brw-017}.

\subsubsection{Действия в таблице анализа штатных календарей}

	\paragraph{Деталировка}\indent\keyb{Enter}
	Выводит на экран диалог штатного календаря со списком всех
	записей.

	\paragraph{Переопределить элемент календаря}\indent\keyb{F2}
	Функция доступна для анализа, рассчитанного без группировки с
	явно заданным в фильтре типом связанный объектов.

	При выборе данного действия открывается диалог элемента штатного
	календаря, позволяющий явно определить выбранный день для выбранного
	связанного объекта. Если этот объект (персоналия, например) наследует
	выбранный день от родительского календаря, то переопределенный
	элемент будет принадлежать уже выбранному объекту.

	\paragraph{Печать}\indent\keyb{F7}
	Вызывает функцию печати (экспорта) отчета по анализу штатных
	календарей.

	Стандартная форма отчета: StaffCal.

	\paragraph{Фильтр}\indent\keyb{Ctrl-V}
	Позволяет изменить параметры фильтрации отчета.

	\paragraph{Временная диаграмма}\indent\keyb{Ctrl-A}

\chapter{Расчет заработной платы\label{ch-salary}}

\section{Терминология}

\begin{description}
	\item[Номинальный период начисления] Период, за который осуществляется начисление.
	Обычно, это - календарный месяц.

	\item[Актуальный период начисления] Для конкретного штатного назначения период
	работы может не совпадать с номинальным периодом начисления. Например, человек
	был принят на работу в течении месяца начисления, либо был уволен или переведен
	на другую должность в течении этого периода.

	Для того, чтобы отличать этот период от периода начисления, собственно, и введены
	понятия актуального и номинального периодов.

	\item[Проекция штатного календаря]
	Часто бывает необходимо сопоставить один штатный календарь с другим. Например,
	если сотрудник болел в течении 7 дней, а его рабочий график не включает воскресенье,
	то в действительности, он пропустил по болезни только 6 дней. Для правильного
	вычисления последней цифры необходимо наложить календарь болезни сотрудника на
	его регулярный штатный календарь.
	Такое наложение календарей называется \ppyterm{проекцией календаря X на календарь Y}.
\end{description}

\section{Штатные начисления\label{sec-salcharge}}

Основным объектом, определяющим правила начислений заработной платы, является штатное
начисление. Как правило, в базе данных определено множество штатных начислений так как
схемы расчета заработной платы весьма сложны и включают целый ряд правил.
Штатное начисление определяется следующими атрибутами:
\begin{itemize}
	\item 	Идентификатор
	\item 	Символ
	\item 	Наименование
	\item 	Формула
	\item 	Тип суммы для списания
	\item 	Вид операции списания
\end{itemize}
Символ служит для идентификации вида начисления в формулах и при обмене данными.
Формула - наиболее существенный атрибут вида начисления. Именно она определяет расчет
суммы начисления.
Тип суммы для списания используется при формировании документов, соответствующих начислению
по этому виду.
Вид операции списания задает вид документа, генерируемого при начислении по этому виду.
Если последние два атрибута не определены, то документы по этому начислению формироваться
не будут.

\subsection{Администрирование штатных начислений}

Список штатных начислений доступен через пункт меню \ppymenu{Справочники\rdir Зарплата и кадры\rdir Штатные начисления}.

В этом списке доступны следующие команды:

\begin{description}
	\item[Редактировать]
	Открывает диалог редактирования выбранной записи штатного начисления.

	Если пользователь имеет право на просмотр объекта \ppyrsrv{Штатные начисления},
	но не имеет прав на редактирование, то диалог откроется с заблокированной
	кнопкой \dlgbutton{ОК}.

	\item[Добавить]
	Открывает диалог создания новой записи штатного начислений.

	Функция доступна при наличии у пользователя прав на создание
	объектов типа \ppyrsrv{Штатные начисления}.

	\item[Добавить группу]
	Открывает диалог редактирования новой группы штатных начислений.

	Функция доступна при наличии у пользователя прав на создание
	объектов типа \ppyrsrv{Штатные начисления}.

	\item[Удалить]
	Удаляет выбранную запись.

	Функция доступна только в том случае, если пользователь обладает
	правом на удаление записей объектов типа \ppyrsrv{Штатные начисления}.

	\item[Передать Charry]
	Формирует файл Charry по всем записям из списка.

	Эта функция полезна для переноса сконфигурированных данных
	из одной базы данных в другую.

	\item[События]
	Открывает таблицу просмотра системных событий по выбранной
	записи.

	\item[Закрыть]
	Закрывает диалог.

\end{description}

\subsubsection{Диалог редактирования записи штатного начислений}

\ppypict{dlg-salcharge}{Диалог редактирования штатного начислений}

Внешний вид диалога показан на рис.~\ref{pic-dlg-salcharge}. Далее перечислены
управляющие элементы диалога.

\begin{description}
	\item[Наименование] Наименование начисления. Эта строка должна быть уникальна
	среди все записей.

	\item[Символ] Символьное обозначение штатного начисления, используемое
	в формулах и для ссылок на запись из внешних приложений.

	Эта строка должна быть односложной и уникальной среди всех записей
	справочника. Мы настоятельно рекомендуем использовать латинские символы
	для этого обозначения.

	Символ можно не указывать вовсе, однако при этом не удастся сослаться на
	данную запись из формул расчета заработной платы.

	\item[ИД] Справочное поле, отображающее идентификатор записи.

	\item[\dlgradioc{Тип объекта для перечисления}]

	\item[\dlgcombo{Дополнительный параметр для перечисления}]
	\item[\dlgcombo{Тип суммы для списания}]
	\item[\dlgcombo{Вид операции списания}]
	\item[\dlgflag{Списывать все начисления одним документом}]
	\item[Формула]
	\item[\dlgbutton{Выбор символа}]

\end{description}

\subsection{Формула штатного начисления}

\subsubsection{Специальные символы, используемые в формулах начисления}

\begin{description}
	\item[sckName]  Вид начисления с символом Name.
	\item[evName]   Вид персональной операции с символом Name
	\item[samtName] Тип штатной суммы с символом Name.
	\item[amtName]  Тип суммы документов с символом Name.
	\item[prLastMonth]Последний календарный месяц до периода начисления.
	\item[prLastQuart] Последний календарный квартал до периода начисления.
	\item[prLastYear]  Последний календарный год до периода начисления.
	\item[prNextMonth] Следующий за периодом начисления календарный месяц.
	\item[prNextQuart] Следующий за периодом начисления квартал.
	\item[prNextYear]  Следующий за периодом начисления календарный год.
	\item[prThisMonth] Целый календарный месяц, соответствующий верхней границе номинального периода начисления.

	Например, если период начисления май 2009 года, то и prThisMonth будет
	равен 1/5/2009..31/5/2009.

	Если же период начисления - 2-й квартал 2009 года, то prThisMonth будет
	равен 1/6/2009..30/6/2009.

	\item[prThisQuart] С начала квартала до конца месяца, соответствующего
	номинальному периоду начисления.

	Например, если период начисления июнь 2009 года, то prThisQuart будет
	равен 1/3/2009..30/6/2009.

	\item[prThisYear]  С начала года до конца месяца, соответствующего номинальному периоду начисления.

	Например, если период начисления июнь 2009 года, то prThisYear будет
	равен 1/1/2009..30/6/2009.

	\item[prNominal]   Номинальный период начисления.

	\item[prActual]    Актуальный период начисления.

	\item[tagName]     Значение тега персоналии с символом Name.

	\item[evName]      Вид персональной операции с символом Name.
	Например, \ppysyntax{evILL} - вид персональной операции с символом ILL.

	Такие символы применяются в функциях, рассчитываемых по персональным
	событиям, например \ppysyntax{evcount}.

	\item[evdate]      Дата персонального события, по которому рассчитывается начисление.

	Эту переменную можно использовать только для видов начислений, которые имеют тип
	объекта для перечисления \dlgradioi{Персональные операции}.

	\item[evpairdate] Дата персонального события, парного тому, по которому
	рассчитывается данное начисление. Если расчетное событие не имеет пары, то
	результатом подстановки этой переменной будет дата расчетного события.

	Эту переменную можно использовать только для видов начислений, которые имеют тип
	объекта для перечисления \dlgradioi{Персональные операции}.

\end{description}

%\subsubsection{Специальный символ календаря}

\subsubsection{Функции формулы начисления}

Следующие 6 функций аналогичны по смыслу символам с перфиксом pr
(например, prLastMonth) с той разницей, что могут принимать в качестве
аргумента дату, относительно которой и вычисляется период.

\paragraph{LastMonth}

\paragraph{LastQuart}

\paragraph{LastYear}

\paragraph{NextMonth}

\paragraph{NextQuart}

\paragraph{NextYear}

\paragraph{ThisMonth}

\paragraph{ThisQuart}

\paragraph{ThisYear}

\paragraph{cday} Количество дней в штатном календаре за период начисления.
	\newline Параметры:
	\begin{description}
		\item[Arg1] Символ календаря, для которого рассчитывается количество дней.

		\item[Arg2 (не обязательный)] Символ календаря проекции. Если этому символу
		предшествует знак $-$, то вычисляется инверсия от проекции.

		\item[Arg3 (не обязательный)] Период, за который следует рассчитать количество
		дней штатного календаря.

		По умолчанию, это - актуальный период начисления.
	\end{description}

	\ppyexample{
		Предположим, мы имеем два типа календарей: фактически отработанные дни $work$ и
		регулярный календарь (общий календарь рабочих дней) с символом $reg$.

		Далее, для определенности, положим, что в регулярном календаре следующие дни:
		2, 3, 4, 5, 6, 9, 10, 11, 12, 13, 16, 17, 18, 19, 20, 24, 25, 28. Итого, 18 дней.

		Сотрудник фактически выходил на работу в следующие дни:
		2, 3, 4, 5, 6, 9, 10, 11, 12, 13, 16, 17, 18, 19, 20, 23, 24, 25, 28. Итого, 19 дней.

		\begin{description}
			\item[$cday(work)$] количество дней в расчетном периоде по календарю $work$.

			Для нашего примера результат будет равен 19.
			\item[$cday(work, reg)$] количество дней в расчетном периоде по календарю $work$
			в проекции на календарь $reg$.

			Для нашего примера результат будет равен 18 (один день 23 числа сотрудник
			работал в выходной день, но так как этот день не входит в регулярный календарь
			функция его не учла).
			\item[$cday(work, -reg)$] количество дней в расчетном периоде по календарю $work$
			в инвертированной проекции на календарь $reg$.

			В случае с описанным примером результатом этой функции будет 1. То есть, один
			раз сотрудник выходил на работу в день, не учтенный в регулярном календаре.
		\end{description}
	}
\paragraph{chour} Количество часов в штатном календаре за период начисления.
	\newline Параметры:
	\begin{description}
		\item[Arg1] Символ календаря, для которого рассчитывается количество часов.
		\item[Arg2 (не обязательный)] Символ календаря проекции. Если этому символу
		предшествует знак $-$, то вычисляется инверсия от проекции.
		\item[Arg3 (не обязательный)] Период, за который следует рассчитать количество
		дней штатного календаря.

		По умолчанию, это - актуальный период начисления.
	\end{description}

	Эта функция ведет себя точно так же, как и $cday$ с той лишь разницей, что
	считает она не дни, а часы.

\paragraph{evcday} Количество дней в штатном календаре, соответствующих персональным
	событиям вида, заданного первым аргументом функции.
	\newline Параметры:
	\begin{description}
		\item[Arg1] Символ вида персональной операции.

		\item[Arg2 (не обязательный)] Символ календаря проекции. Если этому символу
		предшествует знак $-$, то вычисляется инверсия от проекции.

		\item[Arg3 (не обязательный)] Период, за который следует рассчитать количество
		дней штатного календаря.

		По умолчанию, это - актуальный период начисления.
	\end{description}

	Метод вычисления величины может быть описан так:
	за период, заданный третьим аргументом, извлекаются все персональные
	события заданного вида по персоналии, которой соответствует штатное назначение.

	Для каждого события извлекаются записи штатных календарей, если таковые имеются.
	В случае, если эти записи имеют определенную дату и не содержат признака \dlgflag{Пропуск},
	дата календаря сопоставляется с календарем проекции (если задан) и результат
	суммируется с общей величиной, которая после окончания обработки и
	возвращается функцией.

\paragraph{evchour} Количество часов в штатном календаре, соответствующих персональным
	событиям вида, заданного первым аргументом функции.

	Эта функция полностью аналогична по параметрам и алгоритму расчета функции \ppyrsrv{evcday},
	но подсчитывает не дни, а часы.

\paragraph{evcount} Количество персональных операций заданного вида, приходящихся на
	период, заданный параметром.
	\newline Параметры:
	\begin{description}
		\item[Arg1] Символ вида персональной операции.

		\item[Arg2 (не обязательный)] Период, за который следует рассчитать количество
		дней штатного календаря.

		По умолчанию, это - номинальный период начисления.
	\end{description}

\paragraph{thisevcday} Количество дней в календаре, соответствующем текущему событию,
	по которому осуществляется начислений.

	Функция применима только для видов начислений, которые имеют тип
	объекта для перечисления \dlgradioi{Персональные операции}.
	В противном случае функция вернет 0.

	Параметры:
	\begin{description}
		\item[Arg1 (не обязательный)] Символ календаря проекции.
	\end{description}

\paragraph{thisevchour}	Количество часов в календаре, соответствующем текущему событию,
	по которому осуществляется начислений.

	Функция применима только для видов начислений, которые имеют тип
	объекта для перечисления \dlgradioi{Персональные операции}.
	В противном случае функция вернет 0.

	Параметры:
	\begin{description}
		\item[Arg1 (не обязательный)] Символ календаря проекции.
	\end{description}

\paragraph{charge} Сумма начисления.
	\newline Параметры:
	\begin{description}
		\item[Arg1] Вид начисления.
		\item[Arg2] Период (если не задан, то за период начисления).
	\end{description}
\paragraph{avgcharge} Средняя величина начисления.
	\newline Параметры:
	\begin{description}
		\item[Arg1] Вид начисления.
		\item[Arg2] Период (если период не задан, то равно charge(Arg1)).
	\end{description}
\paragraph{bill} Сумма по документам за заданный период.
	\newline Параметры:
	\begin{description}
		\item[Arg1] Ид вида операции.
		\item[Arg2] Одно из следующих значений:
			\begin{description}
				\item[0] документы поднимаются по персоналии, как контрагенту документа.
		   		\item[1] документы поднимаются по персоналии, как дополнительному объекту документа.
		   		\item[2] документы поднимаются по персоналии, как агенту по документу.
		   \end{description}
		\item[Arg3] период (если не задан, то за период начисления).
	\end{description}
\paragraph{paym} Сумма оплат за заданный период по документам.
	\newline Параметры:
	\begin{description}
		\item[Arg1] Ид вида операции документов, к которым привязаны оплаты.
		\item[Arg2] Одно из следующих значений:
			\begin{description}
				\item[0] документы поднимаются по персоналии, как контрагенту документа.
		   		\item[1] документы поднимаются по персоналии, как дополнительному объекту документа.
		   		\item[2] документы поднимаются по персоналии, как агенту по документу.
		   \end{description}
		\item[Arg3] Период (если не задан, то за период начисления).
	\end{description}

\paragraph{sieve} Функция \qu{решето}. Возвращает значение, зависящее от того, в какой из
	определенных диапазонов попадает величина аргумента.

	Например: sieve[0; 20000?0.15; 40000?0.18](x)

\paragraph{round} Функция округления результата до ближайшего значения.
	\newline Параметры:
	\begin{description}
		\item[Arg1] Округляемое значение.
		\item[Arg2 (не обязательный)] Точность округления в десятичных знаках после точки.
		Отрицательное значение этого параметра округляет значение до соответствующего
		десятичного знака перед точкой. Если этот параметр не задан, то осуществляется округление до целого.

		\ppyexample{
		Допустим, значение, возвращаемое такой конструкцией $charge(sckSalary)$ равно 21023.175.
		Тогда следующие варианты применения функции round дадут показанные справа результаты:
		\begin{description}
			\item[$round(charge(sckSalary))$] 21023.00
			\item[$round(charge(sckSalary), 2)$] 21023.18
			\item[$round(charge(sckSalary), 1)$] 21023.20
			\item[$round(charge(sckSalary), -3)$] 21000.0
		\end{description}
		}
	\end{description}

\paragraph{roundup} Функция округления результата до верхнего значения.
	\newline Параметры:
	\begin{description}
		\item[Arg1] Округляемое значение.
		\item[Arg2 (не обязательный)] Точность округления в десятичных знаках после точки.
		Отрицательное значение этого параметра округляет значение до соответствующего
		десятичного знака перед точкой. Если этот параметр не задан, то осуществляется округление до целого.
	\end{description}

\paragraph{rounddown} Функция округления результата до нижнего значения.
	\newline Параметры:
	\begin{description}
		\item[Arg1] Округляемое значение.
		\item[Arg2 (не обязательный)] Точность округления в десятичных знаках после точки.
		Отрицательное значение этого параметра округляет значение до соответствующего
		десятичного знака перед точкой. Если этот параметр не задан, то осуществляется округление до целого.
	\end{description}

\section{Анализ штатных начислений}

Отчет анализа штатных начислений позволяет просмотреть и начисления, сформированные
суммы начислений по расчету заработной платы.

Для доступа к отчету необходимо выбрать пункт меню \ppymenu{Кадры\rdir Анализ начисления зарплаты}.

\subsection{Фильтр таблицы штатных начислений}

\ppypict{dlg-f-salary}{Фильтр анализа штатных начислений}

Вид фильтра показан на рис.~\ref{pic-dlg-f-salary}. Далее приводится описание
управляющих элементов этого диалога.

\begin{description}
	\item[Период] Период, за который следует вывести отчет. Обратите внимание на то,
	что при автоматическом начислении записи датируются днем начала периода начисления.
	Таким образом, начисления за январь все будут иметь дату 1 января.

	\item[\dlgcombo{Работодатель}] Комбо-бокс позволяющий отфильтровать отчет по
	организации-работодателю.

	В списке этого комбо-бокса отображаются персоналии, принадлежащие виду
	\ppyrsrv{Работодатели}.

	\item[\dlgcombo{Подразделение}] Здесь можно выбрать подразделение предприятия,
	по которому необходимо отобразить записи начислений.

	В списке этого комбо-бокса отображаются подразделения, относящиеся к работодателю,
	выбранному в соответствующем поле (см. выше). Если работодатель не выбран, то
	отобразятся все подразделения, занесенные в базу данных, не зависимо от того,
	к какому предприятию они относятся.

	\item[\dlgcombo{Штатная должность}] Выбор штатной должности приведет к тому, что
	будут показаны только те начисления, которые относятся к штатным назначениям,
	принадлежащим выбранной должности.

	\item[\dlgcombo{Назначение}] Позволяет отобрать только те начисления, которые
	относятся к выбранному штатному назначению.

	\item[\dlgcombo{Вид начисления}] Выбор конкретного вида начисления ограничит
	отчет начислениями, относящимися только к этому виду.
\end{description}

\subsection{Таблица штатных начислений}

\ppypictsc{brw-salary}{Таблица штатных начислений}{0.5}

Типичный вид таблицы анализа штатных начислений показан на рис.~\ref{pic-brw-salary}.

В таблице присутствуют следующие колонки:

\begin{description}
	\item[От] Дата начала периода начисления.
	\item[До] Дата окончания периода начисления.
	\item[Персоналия] Наименование персоналии, которой соответствует начисленная сумма.
	\item[Должность] Должность персоналии, которой соответствует начисленная сумма.
	\item[Вид начисления] Вид начисления, с которым сопоставлена сумма в строке.
	\item[Сумма] Сумма начисления. Обратим внимание на то, что сумма начисление не обязательно
	может быть выражена в денежных единицах. Многие виды начислений
	рассчитываются как вспомогательные для использования в последующих расчетах (например,
	величина \qu{Количество рабочих дней (норма)}, показанная на рисунке, выражена
	в днях).
	\item[Документ списания] Если для вида начисления задана операция списания и
	при расчете был сформирован документ списания, то в этой колонке отображается номер
	и дата этого документа.
\end{description}

\subsubsection{Действия в таблице штатных начислений}

\paragraph{Редактировать}\indent\keyb{Enter}
Открывает диалог редактирования выбранного начисления.
\ppynote{
	Так как большинство начислений формируется автоматически,
	не рекомендуется модифицировать записи вручную.
}

\paragraph{Добавить}\indent\keyb{Insert}
Позволяет создать запись штатного начисления вручную.

\paragraph{Удалить}\indent\keyb{Delete}
Позволяет удалить выбранную запись штатного начисления.

\paragraph{Удалить всю выборку}\indent\keyb{Ctrl-F8}
Удаляет все выборку записей, соответствующих фильтру.
При выборе этой функции система выдает диалог строгого подтверждения.

\paragraph{Персоналия}\indent\keyb{F2}
Открывает диалог просмотра и редактирования персоналии, соответствующей
выбранной записи штатного начисления.

\paragraph{Штатная должность}\indent\keyb{F3}
Открывает диалог просмотра и редактирования штатной должности,
соответствующей текущей записи.

\paragraph{Вид начисления}\indent\keyb{F4}
Открывает диалог просмотра и редактирования записи вида начисления,
по которому была сформирована текущая строка.

\paragraph{Связанный документ}\indent\keyb{Ctrl-F3}
Если выбранной строке соответствует документ списания, то эта функция открывает
диалог редактирования такого документа.

\paragraph{Начисление}\indent\keyb{F6}
Вызывает процедуру автоматического формирования начислений. Параметры
начисления будут отвечать условиям фильтрации текущей таблицы, однако,
вы можете изменить эти параметры так, как считаете нужным.

\paragraph{Печать}\indent\keyb{F7}
Отправляет отчет на печать.

\paragraph{Фильтр}\indent\keyb{Ctrl-V}
Позволяет изменить параметры фильтрации отчета.

\chapter{Управление проектами и задачами\label{ch-project}}

\section{Введение}

\section{Проекты}

\subsection{Таблица просмотра проектов}

\ppypict{dlg-069}{Проекты}

Таблица для работы с проектами доступна через пункт меню
\ppymenu{Операции\rdir Управление проектами}.
Просмотр таблицы предваряется диалогом фильтра проектов (рис.~\ref{pic-dlg-069}).

\subsubsection{Фильтр проектов}

\begin{description}
	\item[Период начала работ]
	Здесь указывается период, который ограничивает дату начала работ по проектам, которые будут
	показаны в выборке.

	\item[Период предполагаемого завершения работ]
	Период, ограничивающий выборку по дате предполагаемого завершения работ.

	\item[\dlgcombo{Клиент}]
	Выбрав здесь клиента, вы увидите только те проекты, которые относятся к нему.

	\item[\dlgcombo{Координатор}]
	Если этот комбо-бокс не пустой, то будут показаны только те проекты,
	координатором которых выступает выбранная персоналия.

	\item[Сортировать по] Позволяет выбрать один из следующих вариантов
	сортировки записей в таблице:
	\begin{itemize}
		\item Наименованию
		\item Дате начала работ
	\end{itemize}

	\item[\dlgflag{Показывать неактивные}]
	При установке этого флага в выборке будут показаны проекты, имеющие статус \ppyrsrv{Не активный}.

	\item[\dlgflag{Показывать архивные}]
	Установка этого флага приведет к тому, что из выборки не будут исключены проекты,
	имеющие статус \ppyrsrv{Архивный}.
\end{description}

\subsubsection{Действия в таблице проектов}

\ppypictsc{brw-018}{Таблица просмотра проектов}{0.4}

	\paragraph{Редактировать}\indent\keyb{Enter}
	Вызывает диалог редактирования выбранного проекта

	\paragraph{Добавить}\indent\keyb{Insert}
	Вызывает диалог редактирования нового проекта.

	\paragraph{Удалить}\indent\keyb{Delete}
	Удаление выбранного проекта. Перед удалением система запросит подтверждение для этой
	операции.

	\paragraph{Задачи}\indent\keyb{F3}
	Просмотр задач, связанных с выбранным проектом.

	\paragraph{Фазы}\indent\keyb{F4}
	Просмотр фаз, связанных с выбранным проектом.

	\paragraph{Документы}\indent\keyb{F5}
	Если с выбранным проектом ассоциированы документы, то по этой команде
	вы сможете увидеть их.
	Кроме того, в появившейся таблице просмотра вы сможете добавить новый связанный документ или
	отредактировать существующий.

	\paragraph{Системный журнал}\indent\keyb{Ctrl-J}
	Просмотр системных событий по выбранному проекту

	\paragraph{Передать выборку проектов}\indent\keyb{Ctrl-H}
	Вызывает диалог передачи всей выборки проектов в другой раздел базы данных.

	\paragraph{Печать}\indent\keyb{F7}
	Печать отчета по списку проектов

	\paragraph{Печать задач проекта}\indent\keyb{Alt-F7}
	Печать списка задач, соответствующих выбранному проекту

	\paragraph{Итог}\indent\keyb{F9}
	Итоговые значения по выборке проектов.

\subsection{Редактирование проектов и фаз}

\subsubsection{Диалог редактирования проекта}

\ppypict{dlg-070}{Редактирование проекта}

Внешний вид диалога редактирования показан на рис.~\ref{pic-dlg-070}. Далее
перечисляются управляющие элементы этого диалога и описывается их назначение.

\begin{description}
	\item[Наименование]
	Краткое наименование проекта. Это наименование должно быть уникально среди всех
	проектов.

	\item[Код]
	Код проекта. Система не требует обязательной уникальности этого кода. Однако,
	желательно чтобы этот код был уникальным. Для этого можно использовать систему
	автоматических счетчиков проектов, настраиваемую в конфигурации проектов.

	\item[Дата создания]
	Дата, когда проект создан. При вызове диалога создания нового проекта это поле
	автоматически заполняется текущей системной датой.

	\item[Дата начала работ]
	Здесь следует указать дату начала работ по проекту.

	\item[Предполагаемая дата завершения работ]
	В этом поле указывается предполагаемая дата завершения работ по проекту.

	\item[Фактическая дата завершения работ]
	По окончании проекта в этом поле необходимо будет установить дату, когда проект
	завершен.

	\item[Переключатель статуса]
	Каждый проект может иметь один из трех зарезервированных
	статусов:
	\begin{description}
	 	\item[Активный] Проект находится либо в ожидании начала работ по нему,
	 	либо в состоянии выполнения.
		\item[Неактивный] Проект по каким либо причинам отложен или отменен.
		\item[Архивный] Проект завершен.
	\end{description}

	\item[\dlgcombo{Клиент}]
	Если проект связан с каким-либо клиентом, то в этом комбо-боксе следует указать
	аналитическую статью, соответствующую этому клиенту. Таблица, из которой выбираются
	статьи в списке этого комбо-бокса определяется опцией \dlgcombo{Таблица покупателей} в общих
	настройках базы данных \ppymenu{Админ\rdir Настройки\rdir Операции}.

	\item[\dlgcombo{Координатор}]
	В этом комбо-боксе можно выбрать координатора проекта из числа персоналий, относящихся
	к виду \ppyrsrv{Персонал}.

	\item[\dlgcombo{Операция разноски документов}]
	В разработке.

	\item[Описание]
	Произвольный текст, описывающий характеристики проекта.

\end{description}

\subsubsection{Диалог редактирования фазы}

\ppypict{dlg-071}{Редактирование фазы}

Создание и редактирование фаз проекта доступно непосредственно из таблицы фаз проекта.
Диалог, используемый для этих целей, показан на рис.~\ref{pic-dlg-071}.
В верхней части диалога показывается текст наименования проекта, к которому относится фаза.

\begin{description}
	\item[Наименование]
	Краткое наименование фазы. Это наименование должно быть уникальным в пределах фаз одного
	проекта.

	\item[Код]
	Символьный код фазы. Если в конфигурации проектов определен счетчик фаз, то при создании
	новой фазы это поле автоматически заполняется новым значение.

	\item[Дата создания]
	Дата, когда фаза была создана. При вызове диалога создания новой фазы проекта это поле
	автоматически заполняется текущей системной датой.

	\item[Дата начала работ]
	Здесь следует указать дату начала работ по фазе проекта.

	\item[Предполагаемая дата завершения работ]
	В этом поле указывается предполагаемая дата завершения работ по фазе.

	\item[Фактическая дата завершения работ]
	По окончании фазы в этом поле необходимо будет установить дату, когда фаза завершена.

	\item[Статус]

	Фаза проекта может иметь один из двух зарезервированных статусов:
	\begin{description}
 		\item[Активный] Фаза, либо ожидающая начала исполнения,
 		либо находящаяся в процессе выполнения.
		\item[Неактивный] Отмененная либо завершенная фаза проекта.
	\end{description}

	\item[\dlgcombo{Клиент}]
	Если фаза связана с каким-либо клиентом, то в этом комбо-боксе следует указать
	аналитическую статью, соответствующую этому клиенту. Таблица, из которой выбираются статьи
	в списке этого комбо-бокса определяется опцией \qu{Таблица покупателей} в общих настройках
	базы данных (\ppymenu{Админ\rdir Настройки\rdir Операции}).\eor

	\item[\dlgcombo{Координатор}]
	В этом комбо-боксе можно выбрать координатора фазы проекта из числа персоналий, относящихся
	к виду \ppyrsrv{Персонал}.

	\item[\dlgcombo{Операция разноски документов}]
	В разработке.

	\item[Описание]
	Произвольный текст, описывающий характеристики фазы.
\end{description}

\section{Задачи}

Задачи являются инструментом учета и планирования заявок клиентов на обслуживание и рабочего
времени персонала предприятия.

Основными атрибутами задачи являются:
\begin{itemize}
	\item Код задачи
	\item Персоналия создавшая задачу
	\item Персоналия, ответственная за выполнение задачи (исполнитель)
	\item Клиент
	\item Адрес клиента
	\item Дата и время создания задачи
	\item Дата и время начала работ по задаче
	\item Дата и время предполагаемого завершения работ задачи
	\item Дата и время фактического завершения работ по задаче
	\item Проект, с которым задача связана
\end{itemize}

\subsection{Связь задач с персоналиями}

Взаимодействие задач со справочником персоналий нуждается в некоторых
пояснениях.

Как уже упоминалось, каждая задача взаимодействует со следующими контрагентами:
\begin{itemize}
	\item Создателем задачи
	\item Ответственным за выполнение задачи
	\item Клиентом
\end{itemize}

В отличии от документов (которые технически не взаимодействуют с персоналиями
на прямую, но посредством аналитических статей), задачи ссылаются прямо на
персоналии.

Важный аспект этого взаимодействия состоит в том, к какому виду относятся персоналии,
на которые ссылаются задачи.

Ответ на этот вопрос следующий: создатели задач и исполнители выбираются из
персоналий, принадлежащих зарезервированному виду \ppyrsrv{Персонал}, а клиенты -
из персоналий, принадлежащих зарезервированному виду \ppyrsrv{Покупатели}.

\subsubsection{Привязка задач к сотрудникам}

Еще один существенный вопрос, который следует обсудить, состоит в том, как
система узнает, что текущий пользователь сеанса является сотрудником, с
которым так или иначе связаны задачи.

При авторизации в базе данных пользователь вводит свое символьное имя и
пароль. Введенное имя ассоциировано с учетной записью пользователя в
справочнике пользователей базы данных. Одновременно, запись пользователя может
быть связана с персоналией, относящейся к виду \ppyrsrv{Персонал}.

Теперь система \qu{знает} кто именно работает в данном сеансе и
подстраивается под это при вводе новых задач, или выясняя, существуют ли
для данного пользователя не просмотренные задачи.

\subsection{Таблица просмотра задач}

Для работы с таблицей задач выберите пункт меню \ppymenu{Операции\rdir Управление заданиями}.

Кроме обычной формы просмотра данных эта таблица предоставляет возможность
анализировать кросс-табулированные формы с различными критериями
отображения.

\subsubsection{Фильтр задач}

\ppypict{dlg-072}{Фильтр по задачам}

Вид диалога фильтра задач показан на рис.~\ref{pic-dlg-072}. Следующая таблица поясняет
назначение управляющих элементов этого диалога.

\begin{description}
	\item[Переключатель Задачи/Шаблоны]
	В зависимости от положения этого переключателя в таблице будут показаны, соответственно,
	либо задачи, либо шаблоны задач.

	\item[Период создания]
	Период, в течении которого были созданы задачи. Этот критерий фильтрации соответствует
	полю \qu{Дата создания} задачи.

	\item[\dlgcombo{Шаблон}]
	Выбрав в этом комбо-боксе шаблон, вы можете увидеть только те задачи, которые были
	автоматически сгенерированы по этому шаблону.

	\item[Период начала]
	Если в этом поле указан период, то будут показаны задачи, дата начала которых попадает
	в этот период.

	\item[Период предполагаемого завершения]
	Здесь вы можете указать период, в который должны попадать даты предполагаемого выполнения
	показанных задач.

	\item[Период фактического завершения]
	Если это поле не пустое, то задачи будут отфильтрованы по дате фактического завершения
	так, что бы эта дата не выходила за указанный интервал.

	\item[\dlgcombo{Создал}]
	В этом комбо-боксе может быть выбрана персоналия, создавшая задачи. В таком случае
	будут показаны только задачи, созданные этим человеком.

	\item[\dlgcombo{Исполнитель}]
	Если здесь выбрать персоналию, то будут отобраны только те задачи, в которых
	исполнителем является выбранное лицо.

	Здесь выбираются персоналии, относящиеся к зарезервированному виду \ppyrsrv{Персонал}.

	\item[\dlgcombo{Клиент}]
	Этот комбо-бокс позволяет выбрать клиента, по которому система должна
	отфильтровать задачи.

	В списке отображаются персоналии, относящиеся к зарезервированному виду
	\ppyrsrv{Покупатели}.

	\item[\dlgcombo{Город клиента}]

	\item[Приоритет]
	Включите те значения приоритетов, которым должны соответствовать
	задачи, отображенные в таблице по этому фильтру.

	По умолчанию система устанавливает все флажки этого блока
	в положение \qu{включен}.

	\item[Статус]
	Включите те значения статусов, которым должны соответствовать
	задачи, отображенные в таблице по этому фильтру.

	По умолчанию флаги \dlgflag{Отложена} и \dlgflag{Завершена} выключены,
	остальные включены.

	\item[Табуляция]
	Здесь вы можете выбрать вариант кросс-табулированного
	отображения данных о задачах.

	Возможны следующие варианты (перед символом дроби стоит критерий,
	который будет отображаться в строках, показатель после этого символа
	будет отображаться в столбцах):
	\begin{description}
		\item[Дата/Час]
		\item[Клиент/Дата]
		\item[Исполнитель/Дата]
		\item[Клиент/Исполнитель]
		\item[Исполнитель/Час]
	\end{description}

	\item[Показатель]
	Если вы выбрали один из вариантов табуляции, то в этом комбо-боксе
	можете выбрать показатель, который будет отображаться в ячейках
	таблицы.

	Здесь допускаются следующие значения:
	\begin{description}
		\item[Количество невыполненных задач]
		\item[Выполненные задачи/количество задач]
		\item[Процент выписанных накладных]
		\item[Количество задач]
	\end{description}

	\item[\dlgcombo{Сортировка}] Комбо-бокс, позволяющий выбрать
	вариант сортировки записей при отображении в таблице и при выводе на печать.

	\item[\dlgcombo{Подстановка}]

	\item[\dlgflag{Только не связанные с проектами}]
	При установке этого флага будут показаны только те задачи, которые
	не связаны с проектами.

	\item[\dlgflag{Не просмотрена}]
	Если вы установите этот флаг, то в таблице отобразятся только те
	задачи, которые не были никем просмотрены.

	\item[\dlgflag{Не просмотрена ответственным}]
	Этот флаг предписывает системе отображать только те задачи, которые
	не были просмотрены ответственным.
	\ppynote{
		Этот флаг будет правильно работать только в том случае, если
		исполнители в вашей базе данных связаны с пользователями системы.
	}
\end{description}

\subsubsection{Вид таблицы задач}

\ppypictsc{brw-019}{Таблица просмотра задач}{0.4}

Примерный вид таблицы просмотра задач показан на рис.~\ref{pic-brw-019}.
В своей обычной форме (без кросстабуляции) эта таблица содержит следующие колонки:

\begin{description}
	\item[Код] Код задачи.
	\item[Дата] Дата создания задачи.
	\item[Дата начала работ] Дата начала работ по задаче.
	\item[Дата завершения] Предполагаемая дата завершения работ по задаче.
	\item[Фактическая дата завершения] Фактическая дата завершения работ по задаче.
	\item[Приоритет] Значение приоритета задачи.
	\item[Статус] Значение статуса задачи.
	\item[Клиент] Наименование клиента, с которым связана задача (если таковой определен).
	\item[Ответственный] Наименование лица, которое отвечает за выполнение задачи.
	\item[Описание] Текст описания задачи.

	При подведении курсора мыши к этой колонке
	отображается окно, в котором выводится полный текст описания задачи, а так же
	текст примечания к этой задаче (если для этой задачи существует примечание).
\end{description}

\subsubsection{Действия в таблице задач}

	\paragraph{Редактировать}\indent\keyb{Enter}
	Открывает диалог редактирования выбранной в таблице задачи.

	\paragraph{Добавить}\indent\keyb{Insert}
	Открывает диалог редактирования новой задачи.

	Если в фильтре, по которому построена таблица, выбраны шаблоны задач, то
	эта функция создает новый шаблон, в противном случае - обычную задачу.

	При создании новой задачи из таблицы, сформированной из задач, привязанных
	к проекту либо фазе проекта, новая задача будет привязана к выбранному
	в фильтре проекту (и, возможно, фазе).

	\paragraph{Добавить по образцу}\indent\keyb{Alt-F2}
	Позволяет создать новую задачу по образцу той, что является выбранной
	в таблице.

	\paragraph{Удалить}\indent\keyb{Delete}
	Удаляет выбранную задачу. При вызове этой функции система предварительно
	запросит подтверждение на удаление задачи.

	\paragraph{Удалить всю выборку}\indent\keyb{Ctrl-F8}
	Эта функция позволяет выполнить одно из двух действий:
	\begin{itemize}
		\item Удаление всех задач, соответствующих фильтру выборки.
		\item Установка для всех задач выборки статуса \ppyrsrv{Завершена}.
	\end{itemize}

	\paragraph{Связные задачи}\indent\keyb{F4}
	Открывает таблицу просмотра задач, связанных с выбранной.

	\paragraph{Просмотр связной задачи}\indent\keyb{Ctrl-L}
	Открывает диалог редактирования задачи, с которой связана текущая задача.
	Если выбранная задача не связана ни с одной задачей, то ничего не
	произойдет.

	\paragraph{Документы}\indent\keyb{F5}
	Открывает таблицу просмотра связанных с выбранной задачей документов.

	\paragraph{Системный журнал}\indent\keyb{Ctrl-J}
	Показывает системные события для выбранной задачи.

	\paragraph{Формирование задач по шаблону}\indent\keyb{F6}
	Эта функция доступна только для шаблонов задач. При ее выборе
	появляется диалог, в котором следует указать период на который
	должны быть созданы задачи, соответствующие выбранному шаблону.
	При указании периода и нажатии кнопки \dlgbutton{ОК} система
	сформирует задачи по этому шаблону.

	\paragraph{Передать выборку задач}\indent\keyb{Ctrl-H}
	Позволяет передать всю выборку задач, представленных в
	таблице, в другой раздел базы данных.

	Предварительно на экране появится стандартный диалог выбора
	параметров передачи (стр.~\pageref{sec-dbxchg-sendbyppview}).

	\paragraph{Печать}\indent\keyb{F7}
	Открывает стандартный диалог печати (экспорта) содержимого
	таблицы.

	\paragraph{Итог}\indent\keyb{F9}
	Показывает итоги по выборке задач. На текущий момент
	итоги состоят только из количества задач в выборке.

	\paragraph{Фильтр}\indent\keyb{Ctrl-V}
	Позволяет изменить условия фильтрации текущей выборки.

\subsection{Редактирование задач}

\subsubsection{Диалог редактирования задачи}

\ppypictsc{dlg-073}{Задача}{0.4}

Диалог редактирования задачи является весьма значительным по размеру и
количеству управляющих элементов. В действительности, в каждом конкретном случае
применения модуля задач в системе используется лишь его подмножество.

Внешний вид диалога показан на рис.~\ref{pic-dlg-073}.

\begin{description}
	\item[\dlgcombo{Проект}]
	Наименование проекта, с которым связана задача.

	Система допускает изменение привязки задачи к проекту. Для этого в описываемом следует
	выбрать тот проект, который требуется. С другой стороны, такая функция вряд ли
	может потребоваться часто. Скорее, крайне редко.

	\item[\dlgcombo{Шаблон}]
	Шаблон, по которому создана эта задача. Если задача не создана по шаблону,
	то, естественно, это поле будет пустым.

	\item[Код]
	Номер задачи. При создании новой задачи система автоматически присваивает
	ей новый номер, основываясь на шаблоне нумерации и счетчике нумерации задач,
	определенных в конфигурации проектов.

	\item[\dlgcombo{Фаза}]
	Фаза проекта, к которой привязана данная задача. Если задача не привязана
	к проекту, то она и не может быть привязана к какой либо фазе.

	Если же в комбо-боксе проекта выбран тот, к которому привязана задача, то
	в этом комбо-боксе можно выбрать одну из фаз данного проекта.

	\item[Дата создания]
	Дата и время создания задачи. При вводе новой задачи в эти поля автоматически
	устанавливается текущее системное время.

	\item[Код связной задачи]
	Если данная задача связана с какой либо иной задачей, то в этом поле
	отображается код той задачи.

	\item[Дата начала]
	Дата и время планируемого начала работ по задаче.

	\item[Предполагаемая дата завершения]
	Дата и время предполагаемого завершения работ по задаче.

	\item[Фактическая дата завершения]
	Дата и время фактического завершения работ по задаче.

	При установке в поле даты корректного значения и переходе
	с этого поля на другое в диалоге автоматически изменяется статус
	задачи на \ppyrsrv{Завершена} (вы можете не согласиться с этим изменив
	статус вручную).

	\item[Сумма]
	Если задача связана с какой либо денежной величиной (например,
	стоимость работы для клиента), то в этом поле можно указать значение
	этой величины.

	\item[\dlgcombo{Создал}]
	Персоналия, создавшая задачу.

	Если запись текущего пользователя системы в сеансе связана с персоналией
	вида \ppyrsrv{Персонал}, то при создании новой задачи эта персоналия автоматически
	устанавливается в этом поле.

	\item[\dlgcombo{Исполнитель}]
	Персоналия, ответственная за выполнение задачи.

	\item[\dlgcombo{Приоритет}]
	Здесь следует выбрать один из зарезервированных приоритетов задачи:
	\begin{itemize}
		\item Максимальный
		\item Высокий
		\item Нормальный
		\item Низкий
		\item Минимальный
	\end{itemize}

	По умолчанию для новой задачи система устанавливает нормальный приоритет.

	\item[\dlgcombo{Статус}]
	Этот переключатель определяет статус задачи. Возможен один из
	следующих зарезервированных вариантов:
	\begin{itemize}
		\item Новая
		\item Отложенная
		\item Выполненная
		\item В ожидании
		\item Завершена
	\end{itemize}

	При создании новой задачи система автоматически инициализирует ее
	статус в значении \ppyrsrv{Новая}.

	При установки не пустого значения даты завершения система переводит
	положение этого переключателя в значение \ppyrsrv{Завершена}. Естественно,
	пользователь может и самостоятельно изменять это положение.

	\item[\dlgcombo{Клиент}]
	В случае, если задача каким то образом связана с клиентом предприятия,
	в этом комбо-боксе следует выбрать этого клиента.

	Как уже говорилось выше, здесь может быть выбрана персоналия,
	относящаяся к виду \ppyrsrv{Покупатели}.

	\item[\dlgcombo{Адрес}]
	Если в комбо-боксе \dlgcombo{Клиент}, описанном выше, выбран клиент, и
	этот клиента имеет несколько адресов доставки, то в данном комбо-боксе
	может быть выбран один из этих адресов.

	Смысл этого значения может варьироваться в зависимости от особенности
	конкретной задачи. Так, это может быть непосредственно адрес, по которому
	следует что-либо доставить клиенту, или же адрес, по которому должна
	быть оказана услуга или другое.

	\item[\dlgcombo{Аналитическая статья для документов разноски}]
	В настоящий момент технология разноски задач не реализована.

	Тем не менее, этот комбо-бокс может быть использован для ввода
	дополнительного контрагента по задача.
	Статья, которая может быть здесь выбрана должна принадлежать
	основной таблице статей, определенной для операции разноски
	документов.

	Операция разноски документов определяется либо проектом,
	которому принадлежит задача, либо, если таковая не задана,
	конфигурацией проектов (\ppymenu{Админ\rdir Прочие конфигурации\rdir Конфигурация проектов}).

	\item[Описание]
	Произвольный текст, описывающий содержание задачи.

	\item[Примечание]
	Произвольный текст дополнительных пояснений по задаче.
\end{description}

\subsubsection{Диалог редактирования шаблона задачи}

\ppypict{dlg-074}{Шаблон задачи}

Диалог шаблона задачи показан на рис.~\ref{pic-dlg-074}.

\begin{description}
	\item[Код]
	Номер шаблона задачи.

	\item[Дата создания]
	Дата создания шаблона. При открытии диалога создания новой
	задачи это поле заполняется текущей системной датой.

	\item[\dlgcombo{Создал}]
	Персоналия, создавшая данный шаблон.

	Если запись текущего пользователя системы в сеансе связана с персоналией
	вида \ppyrsrv{Персонал}, то при создании новой задачи эта персоналия автоматически
	устанавливается в этом поле.

	\item[\dlgcombo{Исполнитель}]
	Персоналия, ответственная за выполнение задач, которые будут сформированы
	по шаблону.

	Если этот комбо-бокс останется не заполненным, то и в задачах, сформированных
	по такому шаблону исполнитель инициализирован не будет.

	\item[\dlgcombo{Приоритет}]

	\item[\dlgcombo{Статус}]

	\item[\dlgcombo{Клиент}]

	\item[\dlgcombo{Адрес}]

	\item[Описание]

	\item[Сумма]

	\item[\dlgbutton{Повторение}]

\end{description}

\chapter{Отчетность\label{ch-rep}}

Система позволяет получать различные виды отчетности необходимые для ведения хозяйственного
учета на предприятии.

Прежде всего следует сказать что мы несколько искусственно выделяем рассматриваемую в этой
главе отчетность. В основном речь здесь пойдет об отчетах, к которым можно обратиться из
одноименной группы меню.

Отчеты, рассматриваемые в настоящей главе разделим на следующие три категории:

\begin{itemize}
	\item Бухгалтерская отчетность
	\item Товарная отчетность
	\item Отчетность по взаиморасчетам с дебиторами/кредиторами
\end{itemize}

Бухгалтерская отчетность содержит информацию о состоянии и изменениях счетов бухгалтерского
учета. В системе можно получить следующие виды бухгалтерской отчетности:
\begin{itemize}
 	\item Анализ счета
	\item Кассовая книга
	\item Балансовые отчеты
\end{itemize}

Товарная отчетность дает возможность получить информацию об остатках и движении товаров,
а также отчеты о ценах, о расчетах с поставщиками и покупателями. К этой группе  относятся:
\begin{itemize}
	\item Прайс-лист
	\item Лоты
	\item Анализ заказов
	\item Анализ товарных операций (см. стр.~\pageref{sec-trfranlz})
	\item Анализ отгрузки
	\item Сравнительный анализ цен
	\item Остатки товаров
	\item Фрахт
	\item Товарооборот
	\item Налоговый анализ товарооборота
	\item Движение товаров
	\item Группировка товарных операций (см. стр.~\pageref{sec-opgrouping})
	\item Товарный отчет по операции
	\item Обороты по поставщикам
	\item Долговые ведомости по покупателям
	\item Долговые ведомости по поставщикам
\end{itemize}

\section{Работа с фильтрами и таблицами}

При выборе пункта меню \ppymenu{Отчетность\rdir Карточка товара}, открывается фильтр
\qu{Карточка товара},  в котором следует ввести условия на выбор товаров, по которым вы
желаете получить отчетность.

Диалоговое окно фильтра содержит одно поле ввода и три комбо-бокса.
В поле \qu{Период} следует ввести период времени за который необходимо получить информацию.
Как правило, система автоматически вставляет сюда текущее число. Вам остается либо принять
его, либо изменить по своему усмотрению. Пустое поле означает , что требуется брать
информацию за весь период работы с системой.

В комбо-боксе \dlgcombo{Склад} укажите местонахождение  интересующих вас товаров. Если оставить
это поле пустым, то система будет просматривать товары по всем имеющимся объектам.
В комбо-боксах \dlgcombo{Группа товаров} и \dlgcombo{Товар} задайте соответственно требующуюся  группу
товаров и наименование товара. Пустые поля говорят о том, что следует включить в отчет все
существующие наименования товаров.

Не обязательно заполнять все предлагаемые поля фильтра, некоторые из них, можно оставлять
пустыми, если система дополнительно об этом не попросит. Другими словами, отсутствие записи
в поле равносильно отсутствию ограничения.
После того как все необходимые условия будут определены, остается только нажать кнопку
\dlgbutton{OK} и запустить фильтр.

\chapter{Бухгалтерская отчетность\label{ch-rep-acc}}

\section{Опись проводок}

Опись проводок, являясь одним из базовых инструментов ввода данных, имеет богатые
возможности фильтрации и группировки, а потому может быть использована как эффективное
средство анализа.
Подробно опись проводок описана в разделе \qu{Бухгалтерские документы}.

\section{Анализ счета}

Анализ счета является многофункциональным разделом для исследования данных по бухгалтерским
счетам. Анализ счета подразумевает просмотр информации о проводках по заданному счету с
различными вариациями группировки и сортировки данных с тем, чтобы получить наглядную и
полезную картину движения по счету в максимальном числе различных ситуаций.

Для доступа к анализу счета выберите пункт меню \ppymenu{Отчетность\rdir Анализ счета}.

\subsection{Варианты отчета}

Данный отчет может быть представлен в следующих базовых вариантах:

\begin{description}
	\item[Простой анализ счета] Отображает каждую операцию по выбранному счету
	\item[Анализ счета с группировкой по корреспондирующему счету] Группирует операции по
	выбранному счету в соответствии с заданным параметром группировки:
	\begin{itemize}
		\item По счету
		\item По субсчету
		\item По субконто
		\item По виду операции документа проводки
		\item По складу, которому принадлежит документ, соответствующий документу, которому принадлежит проводка
		\item По агенту, указанному в документе проводки
	\end{itemize}
	\item[Анализ счета с циклами] Этот вариант может пересекаться с двумя предыдущими.
	Циклический анализ группирует проводки по периодам, определенным заданной длительностью
	циклов. При простом анализе (без группировки) все проводки по выбранному счету
	суммируются за каждый из циклов. Таким образом вы увидите итоговые обороты и
	остатки по счету по циклам.

	При совместном использовании группировки по корреспондирующему счету и цикличности,
	проводки будут сгруппированы по обоим из критериев.
	\item[Обороты по статьям счета]
	Специализированный вариант, отображающий сальдо и обороты по каждой статье
	выбранного счета.
\end{description}

\subsection{Фильтр анализа счета}

\ppypict{dlg-f-002}{Фильтр анализа счета}

На рис.~\ref{pic-dlg-f-002} показан внешний вид фильтра анализа счета.
Это - довольно сложный диалог, позволяющий получить анализ счета во множестве
комбинаций и ракурсов. Следующая таблица поясняет назначение каждого элемента фильтра.

\begin{description}
	\item[Период]
	Анализируемый период времени. Подчиняется общим правилам ввода периода в системе.
	Может быть неявно ограничен правами доступа пользователя.

	\item[\dlgcombo{Счет}]
	Анализируемый балансовый счет. Может быть введен либо как номер (например, 90.1),
	либо выбран из комбо-бокса справа.

	Если права доступа пользователя ограничивают список доступных счетов, то
	здесь можно будет выбрать только счет из этого списка.

	\item[\dlgcombo{Статья}]
	Анализируемая аналитическая статья выбранного счета. Если счет не содержит таблицы
	аналитического учета, то и статья выбрана быть не может.

	\item[\dlgcombo{Валюта}]
	При многовалютном учете можно выбрать либо конкретную валюту или отметить флажок
	\dlgflag{Все валюты} для того, чтобы был показан анализ проводок, независимо от валюты, к
	которой они относятся. Если ни валюта, ни флажок \dlgflag{Все валюты} не выбраны, то
	анализируются только проводки по базовой валюте.

	\item[\dlgflag{Обороты по статьям}]
	Если этот флажок отмечен, то рассчитывается и выводится на экран оборотная ведомость
	по статьям выбранного счета, содержащая столбцы:
	\begin{itemize}
		\item Статья
		\item Остаток на начало
		\item Обороты по дебету
		\item Обороты по кредиту
		\item Остаток на конец
	\end{itemize}

	Для получения оборотов лишь по одной статье
	счета можно выбрать ее в поле \dlgcombo{Статья}.

	Если выбранный счет не содержит таблицы аналитических статей, то рассматриваемые
	флаг не доступен.

	\item[\dlgflag{Не показывать нулевые обороты}]
	Этот флаг активен только в том случае, если включен флаг \dlgflag{Обороты по статьям}.
	При установке данного флага из просмотра оборотов по статьям будут исключены те статьи,
	обороты по которым за период отсутствовали.

	\item[\dlgflag{Исключать взаимные обороты}]
	Флажок используется тогда, когда анализ, рассчитываемый по балансовому или
	группирующему счету, может содержать проводки и дебет и кредит которых принадлежит
	анализируемому счету. При установки этого флажка, такие проводки будут исключены
	из анализа.
	\ppyexampletitle{Пример}{
		Допустим, что счет 50 (касса) содержит несколько субсчетов, соответствующих
		различным кассам предприятия. Если необходимо узнать итоговые денежные потоки по всем
		кассам предприятия (общий итог поступления и расхода наличности на предприятии, т.е.
		исключая перемещение денег между разными кассами), то следует выбрать анализируемый
		счет 50. Параметр группировки по счету выбрать \dlgradioi{По счету}, и установить
		\dlgflag{Исключать взаимные обороты}.
	}

	\item[\dlgradioc{Группировка\rdir По счету}]
	Данный переключатель позволяет уточнить, что именно подразумевается под введенным
	счетом. Либо это терминальный счет, либо счет первого порядка, либо субсчет. Если этот
	переключатель установлен в положение \dlgradioi{Нет}, то подразумевается, что анализ следует
	рассчитывать по проводкам, сделанным строго по указанному счету, и не по каким его
	субсчетам или статьям.

	Так, если в поле счет указан 60 (Расчеты с поставщиками), в
	поле статья не указано ничего, и параметр группировки установлен в положение \dlgradioi{Нет}, то
	система выдаст анализ проводок сделанных строго по счету 60, но не включит в этот анализ
	проводки, сделанные, скажем, по счету 60.121. Если же переключатель будет стоять в
	положении \dlgradioi{По счету}, то в анализ будут включены все проводки, сделанные по указанному
	счету, а также его субсчетам и аналитическим статьям. Положение переключателя
	\dlgradioi{По субсчету} заставляет систему включать в анализ проводки, сделанные только по
	указанному субсчету. Так, если счет 60 содержит субсчета, то \dlgradioi{По субсчету} мы заставим
	систему включить в анализ счет 60 только как счет второго порядка без субсчетов.
	Следует заметить, что в положении \dlgradioi{По счету} расчет идет значительно медленнее, чем в
	двух других.

	\item[\dlgradioc{Группировка\rdir По корр счету}]
	Позволяет сгруппировать анализ по корреспондирующим счетам либо по виду операции, к
	которой относится документ, создавший проводку. Этот переключатель предоставляет весьма
	широкие возможности по выяснению происхождения оборотов по счету. Анализ в этом случае
	выдается в форме [Группирующий параметр, обороты по дебету, обороты по кредиту]. После
	расчета этой разновидности анализа счета, система позволяет детализировать информацию
	по каждой строке, то есть просматривать все проводки по выбранному группирующему
	значению.

	\item[\dlgcombo{Цикл} и \qu{Количество циклов}]
	Позволяют получить циклический отчет за несколько последовательных периодов. Если не
	задана группировка по корр счету, то каждый период будет содержать одну строку,
	состоящую из итоговых значение оборотов за этот период и входящий и исходящий остатки
	по периоду.

	\item[\dlgbutton{Дополнительно}]
	Открывает диалог выбора дополнительных фильтрующих параметров отчета.

	В этом диалоге можно выбрать фильтрацию по складу и по агенту, привязанному
	к документу.

	Кроме того, здесь же можно выбрать один из вариантов сортировки:
	\begin{description}
		\item[\dlgradioi{По умолчанию}] Используется стандартный способ сортировки по дате и номеру операции за день.
		\item[\dlgradioi{По номеру документа}] Выбора сортируется по текстовой строке номер документа.
		\item[\dlgradioi{По корр счету}] В этом случае выборка отчета сортируется по номеру корреспондирующего счета.
	\end{description}

	Обратим внимание на то, что этот переключатель действует только на отчет
	без группировки. При использовании группировки записи отчета сортируются по
	наименованию группирующего элемента.
\end{description}

\subsection{Таблица анализа счета}

В зависимости от фильтра таблица просмотра анализа счета может иметь следующие формы:

\subsubsection{Простой анализ счета}

\ppypictsc{brw-accanlz-1}{Простой анализ счета}{0.4}

Эта форма показывает каждую операцию по счету, подходящую под заданные условия фильтрации.

В таблице доступны следующие действия:

\paragraph{Документ}\indent\keyb{Enter}
Открывает документ, которому соответствует выбранная строка отчета.

\paragraph{График}\indent\keyb{Ctrl-N}
Открывает окно графика по значениям, представленным в таблице.
Если текущая ячейка находится в столбце остатка, то на графике
будет представлено изменение остатка по счету.
В противном случае, график будет отображать дебетовые и кредитовые
обороты по счету линиями разного цвета.

\paragraph{Печать}\indent\keyb{F7}
Отправляет отчет на печать.

Стандартная форма отчета: \ppyrsrv{AccAnlz}.

\paragraph{Итог}\indent\keyb{F9}
Открывает диалог, в котором представлены итоговые величины по отчету:
\begin{description}
	\item[Количество строк в отчете]
	\item[Остатки на начало периода]
	Эти остатки представлены как в развернутом (раздельно по дебету и кредиту) виде, так и разницей дебет минус кредит.
	\item[Обороты по кредиту]
	\item[Обороты по дебету]
	\item[Остатки на конец периода] Представлены аналогично начальным остаткам.
	\item[Справочные поля] Отображают некоторые параметры фильтра в справочных целях.
\end{description}

\paragraph{Фильтр}\indent\keyb{Ctrl-V}
Открывает диалог изменения параметров фильтрации отчета.

\paragraph{Обновить список}
Обновляет список для отображения свежих данных.
Обратим внимание на то, что с этой функцией не сопоставлено ни
каких клавиш.

\subsubsection{Анализ счета с группировкой}

\ppypictsc{brw-accanlz-2}{Анализ счета с группировкой}{0.4}

Такая форма таблицы появляется в случае, если выбран режим с группировкой по корр счету
(по операции). Как видно из рисунка, каждая строка содержит сгруппированные по заданному
критерию обороты счета и наименование группирующего критерия (корр счета, либо операции).
В этой таблице доступны операции деталировки \keyb{Enter}, печати \keyb{F7} и просмотра
итогов \keyb{F9}. Деталировка сгруппированной строки состоит в показе простого анализа
счета только в корреспонденции с группирующим корр счетом либо только по группирующей
операции.

В этом варианте таблица допускает следующие действия:

\paragraph{Деталировка}\indent\keyb{Enter}
Открывает таблицу просмотра анализа счета с фильтрацией по
критерию группировки, соответствующему текущей строке данного отчета.

Так, например, если выбрана группировка по субсчету, то
будет показан анализ ведущего счета отчета с корреспонденции со
счетом (детализированным до субсчета), которому отвечает
выбранная строка.

Если выбрана группировка по складу, то будет отображен
анализ ведущего счета с фильтрацией по складу, видимому вами
в текущей строка данной таблицы.

\paragraph{Печать}\indent\keyb{F7}
Отправляет отчет на печать.

Стандартная форма отчета: \ppyrsrv{AccGrpng}.

\paragraph{Итог}\indent\keyb{F9}
То же, что и в предыдущем варианте отчета.

\paragraph{Фильтр}\indent\keyb{Ctrl-V}
То же, что и в предыдущем варианте отчета.

\paragraph{Обновить список}
То же, что и в предыдущем варианте отчета.

\subsubsection{Обороты по статьям счета}

\ppypictsc{brw-accanlz-3}{Обороты по статьям счета}{0.4}

Форма анализа оборотов по статьям счета позволяет просмотреть обороты, входящее и
исходящее сальдо по каждой аналитической статье выбранного счета.

Здесь доступны следующие действия:

\paragraph{Деталировка}\indent\keyb{Enter}
Открывает таблицу просмотра анализа счета ведущего счета с
уточнение по аналитической статье, которой соответствует
выбранная строка отчета.

\paragraph{Печать}\indent\keyb{F7}
Открывает диалог выбора варианта печати. Возможны следующие
опции:

\begin{description}
	\item[Простая оборотная ведомость]

	Стандартная форма отчета: \ppyrsrv{AccTrnovr}.
	\item[Акт расчетов с дебиторами]

	Стандартная форма отчета: \ppyrsrv{DbtrsStmt}.
	\item[Акт расчетов с кредиторами]

	Стандартная форма отчета: \ppyrsrv{CrdtrsStmt}.
	\item[Акты сверки задолженности]

	Стандартная форма отчета: \ppyrsrv{DebtAck}.
\end{description}

\paragraph{Итог}\indent\keyb{F9}
То же, что и в предыдущем варианте отчета.

\paragraph{Фильтр}\indent\keyb{Ctrl-V}
То же, что и в предыдущем варианте отчета.

\paragraph{Обновить список}
То же, что и в предыдущем варианте отчета.

\subsubsection{Циклическая группировка}

\ppypict{brw-accanlz-4}{Циклическая группировка}

Анализ счета с циклической группировкой показывает входящее и исходящее сальдо и обороты
по счету за каждый цикл выбранного периода. На рис.~\ref{pic-brw-accanlz-4} показан циклический анализ
без группировки. Если выбрана группировка по корр счету, то анализ за каждый цикл будет
содержать несколько строк сгруппированных по выбранному критерию.
Как и в описанных выше формах, здесь допускаются операции деталировки \keyb{Enter}, печати
\keyb{F7} и просмотра итогов \keyb{F9}.

\section{Баланс}

Отчетность \qu{Баланс} позволяет анализировать обороты и сальдо по каждому балансовому счету
предприятия.

Для выбора этого отчета обратитесь к пункту меню \ppymenu{Отчетность\rdir Балансы}.

\ppypict{dlg-011}{Диалог редактирования фильтра бухгалтерских балансов}

Диалог редактирования фильтра отчета показан на рис.~\ref{pic-dlg-011}. Далее следует
описание управляющих элементов этого диалога.

\begin{description}
	\item[Период]
	Период, за который рассчитывается отчет. Этот период автоматически накладывается на период
	чтения документов, определенный в правах доступа текущего пользователя.

	\item[Переключатель типа счетов]
	Позволяет выбрать категорию счетов, по которым рассчитывать отчет. Возможен один из
	следующих вариантов:
	\begin{description}
		\item[\dlgradioi{Балансовые счета}]
		\item[\dlgradioi{Забалансовые счета}]
		\item[\dlgradioi{Регистры}]
	\end{description}

	\item[\dlgradioc{Развернутое сальдо}]
	Этот переключатель регулирует правило развертывания сальдо по счетам. Обратите внимание,
	что сальдо может быть развернуто только по активно-пассивным счетам.
	Возможны следующие варианты:
	\begin{description}
		\item[\dlgradioi{Неразвернутое сальдо}] сальдо не будет разворачиваться
		\item[\dlgradioi{Разворачивать по субсчетам}] сальдо будет разворачиваться по субсчетам. Эта опция
		актуальна только в том случае, если вы рассчитываете отчет по счетам первого порядка.
		При таком варианте программа раздельно суммирует дебетовое и кредитовое сальдо каждого из
		субсчетов для отдельного счета первого порядка.
		\item[\dlgradioi{Разворачивать по субконто}] сальдо будет разворачиваться по аналитическим статьям
		счетов. В этом случае для каждого из счетов (субсчетов), для которого есть статьи
		аналитического учета, программа раздельно суммирует отрицательное (в кредит) и
		положительно (в дебет) сальдо по каждой из статьей счета (субсчета).
		Обращаем внимание, на то, что расчет развернутого по субконто сальдо занимает значительно
		больше времени нежели расчет не развернутого сальдо.
	\end{description}

	\item[\dlgflag{Исключать нулевые строки}]
	Если этот флаг установлен, то в отчет не попадут счета, по которым сальдо и обороты
	нулевые.

	\item[\dlgflag{Показывать в тысячах}]
	Установка этого флага приведет к тому, что все значения будут поделены на 1000.

	\item[\dlgflag{По счетам первого порядка}]
	Этот флаг предписывает системе рассчитывать отчет только по счетам первого порядка.
	При этом у вас будет возможность детализировать на экране каждый отдельный счет.

	\item[\dlgcombo{Валюта}]
	Выбор валюты приведет к тому, что отчет будет рассчитан только в заданной валюте.
	Все валюты	Если вы включите этот флаг, то отчет будет построен по каждой из валют,
	перечисленных в справочнике валют вашей базы данных.
\end{description}

Вид таблицы отчета показан на рис.~\ref{pic-brw-006}.

\ppypict{brw-006}{Таблица бухгалтерских балансов}

\subsection{Действия в таблице баланса}

	\paragraph{Деталировка}\indent\keyb{Enter}
	При деталировке возможны следующие случаи:
	\begin{itemize}
		\item Если счет, к которому относится строка имеет субсчета, то будет открыта
		таблица баланса на субсчетам выбранного счета.
		\item Если счет не имеет субсчетов, но связан привязанные статьи аналитического
		учета, то действие приведет к открытию таблицы оборотов по статьям этого счета.
		\item Если счет, к которому относится строка не имеет ни субсчетов, ни таблицы
		аналитического учета, то функция откроет таблицу анализа этого счета за период,
		заданный в фильтре.
	\end{itemize}

	\paragraph{Счет}\indent\keyb{F2}
	Открывает диалог просмотра и редактирования счета, соответствующего выбранной строке.

	\paragraph{Печать}\indent\keyb{F7}
	Позволяет отправить отчет на печать либо на экспорт.
	Стандартной печатной формой для этого отчета является Balance.

	\paragraph{Итог}\indent\keyb{F9}
	Открывает диалог просмотра итогов отчета.

\chapter{Язык описания данных DL200\label{ch-dl200}}

\ppynote{
	Этот раздел предназначен для администраторов системы и персонала, обеспечивающего
	поддержку системы \ppybrand{} у конечных пользователей.
}

Технология DL200 применяется для следующих целей:
\begin{itemize}
	\item Формирования финансовых отчетов, обладающих той особенностью,
	что каждая строка этих отчетов должна быть определена в соответствии с
	некоторым собственным правилом, в отличие от большинства встроенных отчетов,
	все строки которых генерируются по общему правилу, определяемому системой
	в соответствии с фильтром, заданным пользователем.

	Наиболее часто потребность таких отчетах возникает при формировании бухгалтерской и
	финансовой отчетности (например, формы баланса предприятия).
	\item Формирование финансовых отчетов с помощью COM-интерфейсов
	системы в электронных таблицах \trademark(Microsoft Excel).
	\item Описание правил расчета бизнес-показателей (см. главу \ref{ch-bizscore}).
	\item Определение специальных правил формирования бухгалтерских
	проводок в документах списания по счетам.
\end{itemize}

\section{Принцип использования технологии для формирования финансовых отчетов}

\ppypict{schema-creatingdl200}{}

Этапы процесса создания отчетов показаны на рис.~\ref{pic-schema-creatingdl200}

\subsection{Создание описания правил формирования отчета}

Для описания отчетов используется специализированный язык DL200. Он состоит из описания
переменных и описаний наборов данных, каждый из которых может быть использован для
формирования собственного отчета.

Файл описания может содержать любое количество наборов данных.
Подробно синтаксис языка DL200 описан ниже.

Файлы описания имеют расширение dl2 и, как правило, хранятся в подкаталоге DD основного
каталога системы.

\subsection{Компиляция файла описания отчетов}

Для того чтобы система \ppybrand{} могла использовать описания отчетов для генерации данных,
необходимых для печати отчетов, файл описания необходимо скомпилировать с использованием
программы компиляции dl200c.exe.

Форма вызова компилятора предельно проста:

dl200c <имя файла отчета>

В результате работы компилятора будет создан файл с тем же именем, что и
файл описания и расширением .bin. Система предполагает, что этот файл хранится в подкаталоге
DD основного каталога.

\subsection{Создание формы отчета в системе CrystalReport}

Для вывода данных, рассчитанных в соответствии с описанием на печать, экран или на экспорт,
используется форма отчета CrystalReport. Эта форма должна быть создана на основании данных,
которые генерирует система при обработке соответствующего набора данных. Созданный файл
отчета должен иметь имя следующего вида: dl2\_DataSetName.rpt, где DataSetName - имя набора
данных. Система ищет этот файл по тем же правилам, по которым ищет все другие файлы отчетов.

\section{Язык DL200}

\subsection{Структура файла}

Файл описания данных состоит из описания переменных и описания наборов данных. Приведем
пример описания %

\begin{Verbatim}[fontfamily=courier, fontsize=\small, frame=single]
// -----------------------------------------------------------------------
// Данные для формирования отчетной формы Ф-2 (Отчет о прибылях и убытках)
// -----------------------------------------------------------------------
//
// Доходы и расходы
PrftTaxless "Выручка (нетто)"=
	[90.1C]-[90.3D]-[90.4D]-[90.5D];
CostValueSold "Себестоимость проданных товаров"=
	[90.2D:20]+[90.2D:21]+[90.2D:23]+[90.2D:40]+[90.2D:41]+
	[90.2D:43]+[90.2D:45];
GrossPrft "Валовая прибыль"=
	PrftTaxless-CostValueSold;
CommBill "Коммерческие расходы"=
	[90.2D:44];
ManagBill "Управленческие расходы"=
	[90.2D:26];
PrftOrLossSold "Прибыль (убыток) от продаж"=
	PrftTaxless-CostvalueSold-GrossPrft-CommBill-ManagBill;
PrcntToGet "Проценты к получению"=
	[90.1C:62]+[90.1C:76]+[90.1C:51]+[90.1C:52];
PrcntToPay "Проценты к уплате"=
	[91.2D:60]+[91.2D:76]+[91.2D:66]+[91.2D:67];
PrftOthrOrgnz "Доходы от участия в других организациях"=
	[91.1C:76];
OthrOpertnlPrft "Прочие операционные доходы"=
	0;
OthrOpertnlLoss "Прочие операционные расходы"=
	0;
OutMarktPrft "Внереализационные доходы"=
	0;
OutMarktLoss "Внереализационные расходы"=
	0;
PrftOrLossTaxless "Прибыль (убыток) до налогообложения"=
	PrftOrLossSold+PrcntToGet-PrcntToPay+PrftOthrOrgnz+OthrOpertnlPrft-
	OthrOpertnlLoss+OutMarktPrft-OutMarktLoss;
DefrrdTaxActives "Отложенные налоговые активы"=
	0;
DefrrdTaxDebt "Отложенные налоговые обязательства"=
	0;
CurPrftTax "Текущий налог на прибыль"=
	0;
NetTrnvr "Чистая прибыль (убыток) отчетного периода"=
	0;
UsualTaxDebt "Постоянные налоговые обязательства"=
	0;
BasTrnvrPerShr "Базовая прибыль (убыток) на акцию"=
	0;
WatrdTrnvrPerShr "Разводненная прибыль (убыток) на акцию"=
	0;
FinePenltyEtc "Штрафы, пени и неустойки, признанные"=
	0;
PastPrftLoss "Прибыль (убыток) прошлых лет"=
	0;
PaymntOfDamags "Возмещение убытков, причиненных неисполнением обязательств"=
	0;
CurrencyOdds "Курсовые разницы по операциям в иностранной валюте"=
	0;
AssessmntFund "Отчисления в оценочные резервы"=
	0;
DebtLimtPeriod "Списание дебиторских и кредиторских задолженностей"=
	0;

DATA IncomeStat "Отчет о прибылях и убытках"
	<
	"Наименование показателя" STRING (128),
	"Код показателя" INT,
	"За отчетный период" [T],
	"За аналогичный период прошлого года" [T,-1Y]
	>
{
	GROUP UsualTrnvr "Доходы и расходы по обычным видам деятельности" {
		"Выручка (нетто) от продажи товаров, продукции, работ,
		услуг (за минусом НДС, акцизов и иных аналогичных обязательных платежей)",
			1, PrftTaxless, PrftTaxless;
		"Себестоимость проданных товаров, продукции, работ, услуг",
			2, CostValueSold, CostValueSold;
		"Валовая прибыль",
			3, GrossPrft, GrossPrft;
		"Коммерческие расходы",
			4, CommBill, CommBill;
		"Управленческие расходы",
			5, ManagBill, ManagBill;
		"Прибыль (убыток) от продаж",
			6, PrftOrLossSold, PrftOrLossSold;
	}
	GROUP OthrPrftAndLoss "Прочие доходы и расходы" {
		"Проценты к получению",
			7, PrcntToGet, PrcntToGet;
		"Проценты к уплате",
			8, PrcntToPay, PrcntToPay;
		"Доходы от участия в других организациях",
			9, PrftOthrOrgnz, PrftOthrOrgnz;
		"Прочие операционные доходы",
			10, OthrOpertnlPrft, OthrOpertnlPrft;
		"Прочие операционные расходы",
			11, OthrOpertnlLoss, OthrOpertnlLoss;
		"Внереализационные доходы",
			12, OutMarktPrft, OutmarktPrft;
		"Внереализационные расходы",
			13, OutMarktLoss, OutMarktLoss;
		"Прибыль (убыток) до налогообложения",
			14, PrftOrLossTaxless, PrftOrLossTaxless;
		"Отложенные налоговые активы",
			15, DefrrdTaxActives, DefrrdTaxActives;
		"Отложенные налоговые обязательства",
			16, DefrrdTaxDebt, DefrrdTaxDebt;
		"Текущий налог на прибыль",
			17, CurPrftTax, CurPrftTax;
		"Чистая прибыль (убыток) отчетного периода",
			18, NetTrnvr, NetTrnvr;
		"СПРАВОЧНО Постоянные налоговые обязательства (активы)",
			19, UsualTaxDebt, UsualTaxDebt;
		"Базовая прибыль (убыток) на акцию",
			20, BasTrnvrPerShr, BasTrnvrPerShr;
		"Разводненная прибыль (убыток) на акцию",
			21, WatrdTrnvrPerShr, WatrdTrnvrPerShr;
	}
}
\end{Verbatim}

\subsection{Переменные}

Переменные используются для описания расчета какого-либо значения, либо для мнемонической
подстановки некоторой константы.

Формат оператора, определяющего переменную следующий:

ИмяПеременной, Описание = Значение;

Здесь: ИмяПеременной - мнемоническое имя переменной.

Например: GrossPrft.

Имя переменной не должно содержать пробелов. Допускается использование русских букв.
Описание - необязательный элемент определения переменной. Может содержать любой текст.
Значение - константа или формула, определяющая значение переменной.

Например: 5, \qu{Просто текст}, [60].

Для подстановки данных из базы данных по счетам (как в последнем приведенном примере)
используются специальные конструкции, называемые определителями счетов, описанные в
следующем пункте.

\subsection{Правила описания определителей счетов}

Определения переменных, заполняемых из данных бухгалтерского учета базы данных системы
\ppybrand{}, используют следующие правила:
Формальный синтаксис представления данных по счету:
\newline ACCVAL := [(ACCDEF)?(([DC])?([IRTS])?)?(:ACCDEF)?(,PERIODOFFS)?]
\newline ACCDEF := ACCNUMBER | ACC\_CODE([O][123])?
\newline ACCNUMBER := ([0-9]+(.[0-9]+){0,2})
\newline ACC\_CODE := \~ IDENT
\newline PERIODOFFS := ((-)?[0-9]+)[DMQY]
\newline Для того чтобы все это стало более понятным, приведем несколько примеров:

	\paragraph{[60]}
	Получить информацию по счету 60. Если из контекста не следует, какие значения по этому
	счету необходимо получить, то указанное выражение по умолчанию подразумевает: чистый
	остаток по счету 60 (дебет - кредит).

	\paragraph{[60T]}
	Чистые обороты (T) по счету 60 (обороты по дебету - обороты по кредиту).

	\paragraph{[60DS]}
	Развернутое (S) дебетовое (D) сальдо по счету 60.

	\paragraph{[60DT]}
	Дебетовый (D) оборот (T) по счету 60.

	\paragraph{[10C]}
	Кредитовое (C) сальдо по счету 10.

	\paragraph{[10CR]}
	Тоже, но более формально (R - сальдо. Если не указано ни R, ни T, то по умолчанию
	предполагается, что необходимо получить сальдо по счету).

	\paragraph{[60DS,-Y]}
	Дебетовое (D) развернутое (S) сальдо по счету 60 на дату, отстоящую от заданной
	на один год назад (,-Y).

	\paragraph{[90.2DT:44]}
	Обороты (T) по дебету (D) счета 90.2 в корреспонденции со счетом 44.

Теперь рассмотрим синтаксис подробнее и с примерами:

	\paragraph{Номер счета}
	Числовой номер счета, возможно с субсчетом и аналитической статьей через точку. Если
	числовое представление счета не определяет однозначно его порядок, то следует
	использовать латинский символ O с непосредственно следующей за ней цифрой 1, 2 или 3.
	1 означает счет первого порядка, 2 - счет второго порядка, 3 - терминальный счет.

	Например, если вы хотите получить сальдо по счету 60 в случае если по нему самому
	(как терминальному счету) шли проводки, то следует написать [60O3DR].

	\paragraph{Код счета}
	Представление бухгалтерского счета в виде символьного кода. Используется в формате
	\~строка. Представление счета в виде кода может понадобиться для извлечения из базы
	данных информации оборотов или остатков по забалансовым счетам, бухгалтерским регистрам
	или обобщенным счетам.

	Пример: [\~cash] - сальдо по счету, имеющему символ cash.

	\paragraph{Символы результата по счету}
	Символы, указывающие системе, какая информация по счету нам нужна: R - исходящее сальдо
	по счету, I - входящее сальдо по счету, T - обороты по счету. Любой из этих вариантов
	накладывается на период расчета, заданный пользователем. Если ни один из этих символов
	не указан, то система по умолчанию полагает, что необходимо рассчитать исходящее сальдо
	по счету.

	\paragraph{Символы стороны  счета}
	Это символы, показывающие интересует нас дебетовая или кредитовая часть счета. В этом
	случае D - дебетовая сторона счета, C - кредитовая сторона счета. Если ни один из этих
	символов не указан, то сальдо система рассчитывает как разницу между дебетом и кредитом
	счета, а оборот как разницу между дебетовыми и кредитовыми оборотами за период.
	Дополнительно символ S предписывает системе рассчитывать развернутое сальдо по счету.
	И брать дебет либо кредит развернутый. Эта опция действует только для активно-пассивных
	счетов. Для чисто активных или чисто пассивных счетов сальдо не разворачивается.

	\paragraph{Корреспонденция в расчете оборотов}
	Если необходимо рассчитать обороты по счету в корреспонденции с конкретным счетом, то
	используется грамматическая конструкция :счет. Здесь счет, следующий за символом
	двоеточия, представлен либо номером счета, либо кодом счета.

	\paragraph{Смещение периода}
	Если необходимо получить расчет по счету, смещенный относительно периода заданного
	пользователем, то используется грамматическая конструкция, смещение (запятая период
	смещения).

	Период смещения задается в формате: ((-)?[0-9]+)[DMQY]. Здесь: - опциональный символ,
	означающий смещение назад по времени (например, год назад). Если минус не указан, то
	период смещается вперед;
	число - указывает количество периодов, на которое следует сместить заданный период.
	Если число не указано, то предполагается, что это значение равно единице; буква,
	характеризующая кратность периода смещения: D - дни, M - месяцы, Q - кварталы, Y - годы.

	Например: -2Q - период, смещенный относительно заданного на два квартала назад.

\subsection{Наборы данных}

Набор данных определяет правила формирования данных для одного отчета.
Синтаксис набора данных следующий:
\newline DATA ИмяНабора ОписаниеНабора
\newline	<ОписаниеКолонок>
\newline \{
\newline	ОписаниеСтрок
\newline \}
Опишем каждый из элементов синтаксиса набора данных.

\begin{ppytable2}
	DATA	&
	Ключевое слово, с которого начинается описание набора данных \eor

	ИмяНабора	&
	Символьное имя набора данных, не содержащее пробелов. Мы рекомендуем использовать
	латиницу для имен наборов, однако подойдут и русские наименования. Длина наименования
	не должна превышать 32 символов. Пример: balance  \eor

	ОписаниеНабора	&
	Строка в кавычках, служащая для более четкого описания набора данных, чем ИмяНабора.
	Это строка может быть сколь угодно длинной.

	Пример: "Баланс предприятия" \eor

	ОписаниеКолонок	&
	Конструкция, окаймленная угловыми скобками и перечисляющая наименования и типы колонок
	отчета. Более подробно синтаксис описания колонок объясняется в следующем пункте. \eor

	ОписаниеСтрок	&
	Перечисление строк отчета и способов вычисления из параметров. Синтаксис описания строк
	объясняется ниже. \eor

	Фигурные скобки {}	&
	Обязательный элемент, обрамляющий зону описания строк отчета. \eor

\end{ppytable2}

\subsection{Колонки}

\subsubsection{Синтаксис описания колонок}

Для того чтобы система могла разделить определяемый вами отчет на колонки, необходимо
описать каждую из колонок в соответствующей зоне. Формальный синтаксис зоны описания
колонок следующий:
\newline columns\_def := | < column\_def\_list >
\newline column\_def\_list := column\_def | column\_def\_list , column\_def
\newline column\_def := STRING column\_type columnmaxsize | column\_type columnmaxsize
| STRING ACCVAL | ACCVAL
\newline columnmaxsize := | ( INTVAL )
\newline column\_type := INT | REAL | STRING | DATE | TIME | PERIOD

Внесем пояснения.

Зона описания колонок может содержать любое количество так называемых дескрипторов колонок,
разделенных запятыми. Вся зона описания колонок обрамляется угловыми скобками.
Дескриптор колонки может быть представлен в одном из следующих вариантов:

\begin{itemize}
	\item 	СтрокаЗаголовка ТипКолонки
	\item 	ТипКолонки
	\item 	СтрокаЗаголовка ПараметрыСчета
	\item 	ПараметрыСчета
\end{itemize}

Здесь:

\begin{description}
	\item[СтрокаЗаголовка] строка в двойных кавычках, используемая в качестве заголовка
	колонки отчета. Например: \qu{Наименование}
	\item[ТипКолонки] тип данных, ассоциированный с колонкой.
	Это может быть одно из ключевых слов:
	\begin{description}
		\item[INT] целочисленное значение
		\item[REAL] значение с плавающей точкой
		\item[DATE] дата
		\item[TIME] время
		\item[PERIOD] период дат (дата начала периода и дата конца периода)
		\item[STRING] текстовая строка. В случае использования этого варианта необходимо указать
		максимальную длину строки в скобках.

		Например: \qu{Наименование} STRING(128)
	\end{description}
	\item[Параметры счета] специальная опция, позволяющая перенастраивать определители счетов,
	заданных в выражениях, используемых для описания строк отчета.
\end{description}

\subsubsection{Перенастройка определителей счетов}

Для того чтобы стал понятен смысл перенастройки определителей счетов, приведем два примера.

\ppyexample{
	Необходимо получить отчет, состоящий из колонок: наименование счета, входящее сальдо,
	дебетовые обороты, кредитовые обороты, исходящее сальдо. Этот отчет должен содержать
	строки, соответствующие, скажем,  трем счетам: 50, 51, 52.
	Определим переменные:
	\newline	Acc50 = [50];
	\newline	Acc51 = [51];
	\newline	Acc52  = [52];
	\newline	Теперь определим набор данных для формирования отчета
	\newline	DATA Example1 \qu{Пример 1}
	\newline	<
	\newline			\qu{Наименование счета} STRING(64),
	\newline			\qu{Входящее сальдо} [I],
	\newline			\qu{Обороты дебет} [DT],
	\newline			\qu{Обороты кредит} [CT],
	\newline			\qu{Исходящее сальдо} [R]
	\newline		>
	\newline	Далее следует описание строк отчета
	\newline	\{
	\newline			\qu{Касса}, Acc50, Acc50, Acc50, Acc50;
	\newline			\qu{Расчетный счет}, Acc51, Acc51, Acc51, Acc51;
	\newline			\qu{Валютный счет}, Acc52, Acc52, Acc52, Acc52;
	\newline	\}
	В этом примере мы по одному разу задаем переменные, соответствующие некоторым счетам, а
	функция перенастройки определителей счетов автоматически подставляет параметры определителей
	в соответствующие колонки.
}

\ppyexample{

	Необходимо получить отчет, состоящий из колонок: наименование счета, сальдо на конец
	периода, сальдо на конец соответствующего периода предыдущего года. Этот отчет должен
	содержать строку, соответствующую сумме счетов 50, 51 и 52.
	Определим переменную:
	\newline Cash = [50]+[51]+[52];
	\newline Теперь определим набор данных
	\newline DATA Example2 \qu{Пример 2}
	\newline 	<
	\newline 		\qu{Наименование} STRING(64),
	\newline 		\qu{Сальдо на конец периода} [R],
	\newline 		\qu{Сальдо на конец соответствующего периода прошлого года} [R,-1Y]
	\newline	>
	\newline \{
	\newline	\qu{Денежные средства и расчетные счета}, Cash, Cash;
	\newline \}

}

Таким образом, перенастройка определителей счетов позволяет многократно использовать
переменную, определенную один раз. Более формально: каждый раз, перед вычислением
определителя счета, система уточняет этот определитель из описания перенастройки,
содержащегося в дескрипторе колонки при условии, что перенастроенный таким образом
определитель счета не будет содержать противоречий. Так, если определитель счета
задает расчет оборотов, а перенастройка предполагает расчет сальдо, то эта перенастройка
не включится и определитель будет вычислен в том виде, в котором задан изначально.

\subsubsection{Дескриптор колонки по умолчанию}

Если зона описания колонок в описании набора данных отсутствует, то система полагает
по умолчанию, что отчет состоит из одной колонки с наименованием \qu{Default} и типом REAL
(значение с плавающей точкой).

\subsection{Строки}

Зона описания строк отчета состоит из дескрипторов групп и  дескрипторов строк. Каждый
дескриптор строки описывает одну строку отчета. Дескрипторы групп используются для
логического объединения нескольких строк. Система допускает неограниченную вложенность
группировки отчета, то есть, группа может включать в себя одну или несколько подгрупп,
как вложенных одна-в-другую, так и следующих одна-за-другой.
Формальный синтаксис описания строк отчета следующий:
\newline data\_def\_body : \{ group\_items\_list \}
\newline group\_items\_list : | group\_items\_list expression\_list ; | group\_items\_list
group\_def | group\_items\_list GROUP IDENT ;
\newline row\_def : IDENT description = expression ;
\newline group\_def : group\_def\_header data\_def\_body
\newline group\_def\_header : GROUP IDENT description
\newline description : | STRING
\newline expression\_list : expression | expression\_list , expression
\newline expression : IDENT | REALVAL | INTVAL | STRING | ACCVAL | ( expression) | - expression
\%prec - | + expression \%prec + |
\newline expression * expression | expression / expression | expression + expression | expression -
expression

\section{Использование отчетов DL200}

\ppypict{dlg-dl200}{Параметры расчета отчета DL200}

Для использования отчетов DL200 из системы  \ppybrand{} следует выбрать пункт меню
\ppymenu{Отчетность\rdir Внешние отчеты DL200}.
На экране появится диалог, показанный на рисунке. В поле \qu{Файл описания данных} выберите
файл, содержащий интересующие вас наборы данных. В поле \qu{Имя структуры данных} выберите
одну из структур, содержащихся в выбранном файле.
В поле  \qu{Период} следует указать период, которому должен соответствовать отчет.
После того, как вы нажмете кнопку \dlgbutton{ОК}, система рассчитает данные, на основе
описания и предложит распечатать или экспортировать полученный отчет.

\chapter{Бизнес-показатели\label{ch-bizscore}}

\section{Общие сведения}

Бизнес-показатели являются представлением числовых индикаторов функционирования предприятия.
Яркими примерами таких индикаторов могут служить, например:
\begin{itemize}
	\item Общие товарные запасы
	\item Сумма дебиторской задолженности предприятия %
	\item Выручка в торговых залах
	\item Объем оптовых продаж
	\item И т.д.
\end{itemize}

Характерной особенностью бизнес-показателей является отсутствие детализации. То есть,
если большинство отчетов в системе представляет информацию в глубоко детализированном
виде (по контрагентам, номенклатурным позициям, отдельным кассовым чекам и т.д.), то
бизнес-показатели имеют целью отразить картину работы предприятия в целом без излишних
подробностей.

Следующими особенностями бизнес-показателей являются:
\begin{itemize}
	\item возможность рассчитывать их по произвольным формулам
	\item возможность хранить рассчитанные на каждый день значения за длительный период времени
	\item технология доставки значений до удаленного пользователя
\end{itemize}

\subsection{Разграничение бизнес-показателей по пользователям}

Важным свойством бизнес-показателей является их привязка к пользователям системы.
Это означает, что показатели могут быть настроены на доставку до конкретных
сотрудников при этом те величины, которые предназначены одному не будут видны
другому сотруднику. Это одновременно решает две проблемы:

\begin{itemize}
	\item Разграничение прав доступа
	\item Уход от избытка информации, видимых каждым отдельным сотрудником
\end{itemize}

\subsection{Расчет значений бизнес-показателей}

Так как технология бизнес-показателей предполагает, что они регулярно рассчитываются,
система предоставляет специальный сервис пересчета бизнес-показателей средствами
JobServer'а.

Если вы не приобретали JobServer, то можете запускать расчет вручную. Для этого
существует отдельная функция, доступная через пункт меню
\ppymenu{Админ\rdir Разное\rdir Расчет бизнес-показателей}.

Для просмотра и анализа рассчитанных значений используется контроллер анализа
данных \qu{Значения бизнес-показателей} (пункт меню \ppymenu{Отчетность\rdir Значения бизнес-показателей}).

\section{Формулы бизнес-показателей}

Ключевым атрибутом любого бизнес-показателя является формула, по которой рассчитывается значение
этого показателя. Принципы ввода формул достаточно просты: система допускает применение так называемых
примитивов, которые, собственно, и определяют источник поступления расчетных данных, и
арифметических операций (сложение, вычитание, умножение и деление).

\ppyexample{
	В качестве вводного примера приведем незамысловатую формулу, которую можно использовать
	в бизнес-показателе:

	$@ccheck(@-1) / @ccheck(@-1/@-1/@)$

	Этот пример рассчитывает отношение вчерашних розничных продаж (сумма выручки по кассовым
	чекам) к соответствующему дню прошлого месяца. Здесь мы использовали один из примитивов,
	а именно $ccheck$, и применили концепцию шаблонов периодов:
	в первом подвыражении вычисляется сумма продаж по чекам за предыдущий день ($@-1$), во втором
	подвыражении - сумма продаж за предыдущий день предыдущего месяца ($@-1/@-1/@$).
}

Обратите внимание на то, что примитивы вводятся в формулы с предшествованием им символа $@$.
Это необходимо для того, что бы система могла отличить расчетный примитив от функции.

\subsection{Примитивы бизнес-показателей}

Количество примитивов бизнес-показателей, предоставляемых системой, сравнительно не велико.
Однако, благодаря возможностям параметризации этих примитивов и использованию шаблонов
периодов, количество вариантов бизнес-показателей может быть огромно. Мы надеемся, что
все значения, которые подскажут вам ваши насущные требования и фантазия, можно рассчитать с
помощью различных формул.

И так, \ppybrand{} предоставляет в ваше распоряжение следующие примитивы для расчета
бизнес-показателей:

\begin{description}
	\item[bill] Документы
	\item[goodsrest] Товарные остатки
	\item[debt] Долги
	\item[ccheck] Кассовые чеки
	\item[bizscore] Значения бизнес-показателей
\end{description}

Хотелось бы отметить последний из перечисленных примитивов - бизнес-показатели. Фактически,
благодаря тому, что значения бизнес-показателей хорошо структурированы и регулярно
рассчитываются, вы имеете возможность воспользоваться ими для расчета производных
показателей. Например, технология бизнес-показателей является наиболее удобным инструментом
для расчета таких величин как средние товарные остатки за период, либо средняя сумма
дебиторской задолженности за период. Вы можете получить эти цифры и другими способами,
но, повторим, описываемая здесь технология является наиболее удобной для этого.

При вводе в формулах примитивы применяются в соответствии со следующей схемой:

$@prim.modif(arg1, arg2)$

Здесь:
\begin{description}
	\item[$prim$] Наименование примитива.
	\item[$.modif$] Не обязательный модификатор. Смысл модификатора состоит в том,
	чтобы уточнить значение, которое вам необходимо от примитива. Например,
	вы можете получить количество документов либо их сумму в ценах поступления.
	Аналогично, для кассовых чеков вы можете затребовать либо их общую сумму,
	либо их количество и так далее.

	Если модификатор не указан, то система подставляет значение примитива по умолчанию.

	Ниже, при подробном описании каждого примитива, мы перечислим его допустимые модификаторы,
	а также модификаторы по умолчанию.
	\item[$arg1$, $arg2$ и т.д.] Аргументы (их количество и смысл описаны ниже).
\end{description}

\ppyexample{
	В качестве примера приведем формулу для расчета среднего чека с начала года по магазину
	с кодом store02:

	$@ccheck.amount(1/1/@..@, store02) / @ccheck.count(1/1/@..@, store02)$

	В этом примере мы использовали и в числителе и знаменателе один и тот же
	примитив, но в числителе применили модификатор суммы чеков, а в знаменателе -
	модификатор количества чеков.

	Отметим еще одну деталь: мы здесь воспользовались возможностью выбора
	склада в параметре примитива. В предыдущем примере склад явно указан не был,
	и в результате мы получали сумму выручки по всем магазинам предприятия (по которым
	учитываются чеки в текущей базе данных).
}

\subsubsection{Правила определения аргументов}

Технология расчета бизнес-показателей на текущий момент имеет весьма ограниченный (по сравнению
с интерактивным режимом) набор возможностей для определения агрументов расчета показателей.

Аргументы формируют набор параметров расчета показателей и могут представлять
следующие критерии:

\begin{description}
	\item[Период] Задает период, за которых расчитывается показатель.
	Период может быть указан строкой, так же, как это делается в интерактивных
	фильтрах системы. Допускается использование шаблонных периодов.

	\ppyexample{
		\begin{description}
			\item[2012] Весь 2012-й год.
			\item[iv/2011] Четвертый квартал 2011-го года.
			\item[@] Текущее число.
			\item[@-8..@-1] Последние 7 дней (до вчерашнего дня включительно).
		\end{description}
	}

	\item[Склад или список складов] Задает символ либо список символов складов,
	по которым должен осуществляться расчет.

	Если порядок следования аргументов предполагает, что данным аргументом должен
	быть склад, то символ склада может быть указан непосредственно без дополнительных
	признаков, однако, рекомендуется всегда указывать склад либо список складов
	в виде @loc(locsym1, locsym2), где locsym1 и locsym2 - собственно символы складов,
	а @loc - служебный префикс, сообщающий модулю разбора выражений, что речь идет
	именно о складах.

	\ppynote{
		Символы складов чувствительны к регистру. Поэтому следите за тем, чтобы
		написание символов точно соответствовало тому, что вы видите в диалоге
		склада.
	}

	\ppyexample{
		\begin{description}
			\item[@loc(WH1)] Склад с символом WH1.
			\item[@loc(WH1, Store2)] Суммарный отчет по складам с символами WH1 и Store2.
		\end{description}
	}

	\item[Товарная группа или список товарных групп] Задает код товарной группы, которой
	должно ограничиваться рассчитываемое значение.

	Если порядок следования аргументов предполагает, что данным аргументом должен
	быть код товарной группы, то этот код может быть указан непосредственно без дополнительных
	признаков, однако, рекомендуется всегда указывать код группы либо список кодов групп
	в виде @goodsgroup(code1, code2), где code1 и code2 - собственно коды групп,
	а @goodsgroup - служебный префикс, сообщающий модулю разбора выражений, что речь идет
	именно о товарных группах.

	\ppyexample{
		\begin{description}
			\item[@goodsgroup(12)] Товарная группа с кодом 12.
			\item[@goodsgroup(24, 302)] Суммарный отчет по товарным группам с кодами 24 и 302.
		\end{description}
	}

	\ppynote{
		На момент написания этого раздела ни один из бизнес-показателей не умеет
		рассчитывать значения по списку групп. Фактически, будет использована только
		первая (найденная по коду) группа.
	}

	\item[Вид операции]
	В тех бизнес-показателях, которым требуется вид операции, его следует указывать
	в виде символа, определенного в записи этого вида.

	Возможно использование символов обобщенных видов операций.
\end{description}

Далее мы рассмотрим подробно каждый из примитивов и перечислим его параметры.

\subsubsection{Примитив bill}

Рассчитывает итоговые значения по выборке документов.

\paragraph{Аргументы}
\begin{description}
	\item[Период] Фиксированное либо шаблонное представление периода, за который необходимо
	просматривать документы.
	\item[Символ вида операции] Это должен быть символ вида операции. Допускаются, наравне
	с обычными видами операций, обобщенные виды.
	\item[Символ склада] Символ склада либо список символов.
\end{description}

\paragraph{Модификаторы}
\begin{description}
	\item[amount] Номинальная сумма документов.
	\item[cost] Сумма документов в ценах поступления.
	\item[price] Сумма документов в ценах реализации.
	\item[discount] Сумма скидки по документам.
	\item[netprice] Чистая сумма реализации, то есть, разница суммы в ценах реализации и
	суммы скидки по документам.
	\item[margin] Разница между чистой суммой реализации и суммой в ценах поступления.
	\item[pctincome] Процентная доходность по выборке документов. То есть,
	отношение разницы между чистой суммой реализации и суммой в ценах поступления к
	сумме в ценах поступления.
	\item[pctmargin] Процентная маржа по выборке документов. То есть,
	отношение разницы между чистой суммой реализации и суммой в ценах поступления к
	чистой сумме реализации.
	\item[count] Количество документов в выборке.
	\item[По умолчанию] Номинальная сумма документов.
\end{description}

\ppynote{
	При использовании модификаторов, в которых упоминаются суммы в ценах реализации,
	суммы в ценах поступления и суммы скидки следует помнить, что речь идет о
	зарезервированных стандартных суммах. Если какие-либо товарные позиции, участвующие
	в документах, принадлежать специализированным товарным типам, то вы можете
	получить значения, отличные от тех, что ожидали увидеть.

	Кроме того, упомянутые модификаторы едва ли годятся для выборки
	бухгалтерских документов, в которых (за редкими исключениями) не
	встречаются указанные типы сумм.
}

\paragraph{Производительность}
В целом, этот примитив рассчитывается достаточно быстро. Зависимость
времени расчета от продолжительности периода - линейная (с поправкой на
различную временную плотность документов в разные периоды, разумеется).

\ppyexample{
	$@bill(@, SALES, @loc(whmain))$

	Номинальная сумма документов продажи (вид операции с символом SALES) за
	сегодняшний день по складу с символом whmain.
}

\subsubsection{Примитив goodsrest}

Рассчитывает итоговые значения по товарным остаткам.

\paragraph{Аргументы}
\begin{description}
	\item[Период] Фиксированное либо шаблонное представление периода, на конец
	которого должны быть рассчитаны остатки. Обратим внимание на то, что
	период здесь применяется формально (для унификации с остальными примитивами).
	Фактически, системе требуется только дата, на которую должны быть
	рассчитаны значения.
	\item[Символ склада] Символ склада либо список символов.
	\item[Товарная группа] Код товарной группы.
\end{description}

\paragraph{Модификаторы}
\begin{description}
	\item[amount] Сумма остатков в ценах реализации.
	\item[cost] Сумма остатков в ценах поступления.
	\item[price] То же, что и amount.
	\item[margin] Маржа: разница между суммой остатков в ценах реализации и суммой
	остатков в ценах поступления.
	\item[pctincome] Отношение маржи к сумме остатков в ценах поступления.
	\item[pctmargin] Отношение маржи к сумме остатков в ценах реализации.
	\item[count] Количество товарных позиций на остатке.
	\item[По умолчанию] Сумма остатков в ценах реализации.
\end{description}

\paragraph{Производительность}
Скорость расчета несколько выше, чем у отчета \qu{Остатки товаров} с аналогичными
параметрами фильтрации. Ускорение достигается за счет того, что результирующие
значения могут быть вычислены без построения громоздкой таблицы с детализацией по
номенклатурным позициям.

Расчет по одному складу осуществляется значительно быстрее, чем по списку складов.

\ppyexample{
	$@goodsrest.cost(@, @loc(whmain))$

	Остатки товаров в ценах поступления на текущее число по складу с символом whmain.

	$@goodsrest.count(@, @loc(whmain, store01), @goodsgroup(219))$

	Количество товарных позиций, принадлежащих группе с кодом 219, с ненулевым остатком на
	текущее число по складам с символами whmain и store01.
}

\subsubsection{Примитив debt}

Рассчитывает итоговые значения задолженности по документам (аналогично долговой ведомости).

Задолженность рассчитывается по методу расширенной долговой ведомости (то есть с учетом
незачтенных зачетных оплат).

\paragraph{Аргументы}
\begin{description}
	\item[Период] Фиксированное либо шаблонное представление периода, за который должны
	быть рассчитаны значения.

	Так как расчет осуществляется средствами контроллера анализа данных \qu{Долговая ведомость},
	то следует сказать, что этот период подставляется и в период просмотра долговых документов и
	в период просмотра оплат. Таким образом, указанный этим аргументом период трактуется как
	\qu{по состоянию на\dots}.

	\item[Символ таблицы аналитического учета] Символ таблицы, по аналитическим статьям
	которой рассчитывается примитив. Если аргумент не указан, то используется таблица покупателей
	(то есть, будет рассчитана долговая ведомость по отгрузкам покупателям).
\end{description}

\paragraph{Модификаторы}
\begin{description}
	\item[amount] Сумма долга с учетом не зачтенных предоплат.
	\item[count] Количество аналитических статей, по которым есть
	не оплаченные долги.
	\item[По умолчанию] То же, что и amount.
\end{description}

\paragraph{Производительность}
Показатель рассчитывается весьма продолжительное время. Причем, чем дольше работает
ваше предприятие, тем ниже скорость расчета.

С учетом сказанного, мы рекомендуем использовать этот примитив только если вы
возлагаете обязанность по расчету бизнес-показателей на JobServer.

\ppyexample{
	$@debt(@)$

	Рассчитывает сумму дебиторской задолженности по таблице статей
	покупателей.
}

\subsubsection{Примитив ccheck}

Рассчитывает итоговые значения по выборке чеков за период и, возможно,
по одному или нескольким складам.

Относительно складов есть один нюанс. Кассовые чеки не принадлежат на прямую
складам. Они относятся к кассовым сессиям, которые, в свою очередь, связаны с
записями кассовых узлов.

Таким образом, если вы запрашиваете расчет кассовых чеков по складу, то
в действительности будут просуммированы чеки, относящиеся к кассовым узлам,
которые принадлежат к выбранному вами складу.

\paragraph{Аргументы}
\begin{description}
	\item[Период] Фиксированное либо шаблонное представление периода, за который необходимо
	просматривать кассовые чеки.
	\item[Символ склада] Символ склада либо список символов.
	\item[Товарная группа] Код товарной группы.
\end{description}

\paragraph{Модификаторы}
\begin{description}
	\item[amount] Номинальная сумма чеков. Это - сумма выручки, в которой уже учтена скидка.
	\item[cost] То же, что и amount.
	\item[price] Сумма чеков, сложенная с суммой скидки. По смыслу этот показатель
	равен сумме, которую бы вы выручили если бы покупателям не предоставлялась скидка.
	\item[discount] Сумма скидки по чекам.
	\item[netprice] То же, что и amount.
	\item[count] Количество чеков в выборке.
	\item[По умолчанию] Номинальная сумма чеков.
\end{description}

\paragraph{Производительность}
Скорость расчета этого примитива линейно сильно зависит от количества
чеков  в выборке.

Для продуктовых магазинов расчет суммы чеков за год может составить до
нескольких минут.

\ppyexample{
	$@ccheck(@-1)$

	Сумма чеков за вчерашний день.

	$@ccheck.discount(1/1/@-1..31/12/@-1, 0, @goodsgroup(219))$

	Скидка по чекам, предоставленная на товары группы с кодом 219, за весь
	предыдущий год по всем складам.
}

\subsubsection{Примитив bizscore}

Рассчитывает значения по выборке бизнес-показателя заданного вида.

Практическая польза от этого примитива заключается в получении
агрегированных величин (сумма, среднее, количество) по выборке значений
бизнес-показателя за определенный период.

\paragraph{Аргументы}
\begin{description}
	\item[Период] Фиксированное либо шаблонное представление периода, за который необходимо
	просматривать значения бизнес-показателей.
	\item[Символ показателя] Символ бизнес-показателя, по которому необходимо получить
	агрегированное значение.
\end{description}

\paragraph{Модификаторы}
\begin{description}
	\item[amount] Сумма всех значений показателя за выбранный период.
	\item[count] Количество значений показателя за выбранный период.
	\item[average] Средняя величина по выборке значений за период.
	\item[По умолчанию] Сумма всех значений показателя за выбранный период.
\end{description}

\paragraph{Производительность}
Примитив рассчитывается очень быстро так как извлекает уже подготовленные значения.

\ppyexample{
	$@bizscore.average(@-60..@, curdebt)$

	Средняя дебиторская задолженность покупателей за последние 60 дней
	(предполагается, что в базе данных существует бизнес-показатель с
	символом curdebt, означающий текущую дебиторскую задолженность).
}

\paragraph{Дополнительные замечания по примитиву}

При использовании примитива bizscore следует учитывать следующие важные
соображения:

\begin{enumerate}
	\item Определяя формулу, на основе этого примитива, вы предполагаете,
	что за период, который задан в выражении, значения показателя рассчитано.
	Если это предположение не выполняется, то вы рискуете столкнуться с
	неадекватным результатом.

	Система предоставляет сервис для ручного расчета бизнес-показателей
	за произвольный период. Вы можете воспользоваться этой функцией
	для того, чтобы быть уверенным в наличии вычисленный значений
	показателя за какой-либо период. Чаще всего это имеет смысл при
	вводе нового показателя, поскольку показатели, определенные давно
	регулярно рассчитываются JobServer'ом.

	\item Порядок расчета бизнес-показателей не управляемый. То есть,
	вы не можете предписать системе рассчитывать сначала один показатель,
	а потом другой. Это замечание важно потому, что если вы определяете
	показатель, значение которого зависит от другого показателя, рассчитанного
	тут же, то не можете быть уверены, что производный показатель будет
	рассчитан позже того, от которого он зависит.

	\item Хотя бизнес-показатели привязываются к пользователям, это не
	означает, что бизнес-показатель, от которого зависит данный должен
	быть привязан к тому же пользователю.

	Другими словами, при каждом запуске расчета бизнес-показателей,
	система рассчитывает каждый из них. Привязка определяет только то,
	какому пользователю какие значения будут доставляться.

	Таким образом, вы можете определить показатель для пользователя $A$,
	который будет использовать значение показателя, определенного
	для пользователя $B$.

	Видимо, хорошей практикой следует считать определение бизнес-показателей,
	используемых другими показателями, вообще без привязки к пользователю.
\end{enumerate}

\section{Справочник бизнес-показателей}

Список бизнес-показателей доступен через пункт меню \ppymenu{Справочники\rdir Операции\rdir Бизнес-показатели}.

\subsection{Таблица бизнес-показателей}

\ppypict{brw-bizscore}{Таблица бизнес-показателей}

Внешний вид таблицы бизнес-показателей изображен на рис.~\ref{pic-brw-bizscore}.

\subsubsection{Действия в таблице бизнес-показателей}

\paragraph{Добавить}\indent\keyb{Insert}
Открывает диалог редактирования нового бизнес-показателя.
Описание диалога см. на стр.~\pageref{sec-bizscore-dialog}.

\paragraph{Добавить по образцу}\indent\keyb{Alt-F2}
Открывает диалог редактирования нового бизнес-показателя по образцу выбранного в таблице.
Описание диалога см. на стр.~\pageref{sec-bizscore-dialog}.

\paragraph{Редактировать}\indent\keyb{Enter}
Открывает диалог редактирования выбранного бизнес-показателя.
Описание диалога см. на стр.~\pageref{sec-bizscore-dialog}.

\paragraph{Удалить}\indent\keyb{Delete}
Удаляет выбранный бизнес-показатель и все значения, связанные с ним.

\paragraph{Значения показателя}\indent\keyb{F3}
Отображает таблицу значений выбранного бизнес-показателя. Подробно эта таблица описана
на стр.~\pageref{sec-bizscore-values}.

\paragraph{Пересчет всех показателей}\indent\keyb{F6}
Запускает функцию пересчета всех бизнес-показателей. Обращаем внимание на то, что
пересчету подвергаются все бизнес-показатели не зависимо от условий фильтрации данной
таблицы.

Для пересчета значений одного бизнес-показателя следует открыть таблицу значений по выбранному показателю
и выполнить пересчет там (см. стр.~\pageref{sec-bizscore-values}).

\paragraph{Просмотр событий}\indent\keyb{Ctrl-J}
Отображает системные события по выбранному бизнес-показателю.

\paragraph{Фильтр}\indent\keyb{Ctrl-V}
Позволяет изменить фильтр отображения бизнес-показателей в этой таблице.

Комбо-бокс на панели инструментов таблицы предоставляет возможность быстро изменить
пользователя, которым следует ограничить отображаемые показатели.

\subsection{Диалог редактирования бизнес-показателя\label{sec-bizscore-dialog}}

\ppypict{dlg-132}{Бизнес-показатель}

Диалог редактирования бизнес-показателя показан на рис.~\ref{pic-dlg-132}. Он включает в себя следующие
управляющие элементы:

\begin{description}
	\item[Наименование]
	Наименование показателя. Эта строка должна быть уникальной среди всех элементов
	данного справочника.

	\item[Символ]
	Строка, позволяющая ссылаться на этот показатель из формул. Если символ
	бизнес-показателя определен, то он должен быть уникальным среди всех
	элементов справочника (система следит за этим).

	\item[ИД]
	Идентификатор записи. Показывается для справки (менять это значение нельзя).

	\item[\dlgcombo{Пользователь}]
	Пользователь, к которому привязан данный бизнес-показатель. Если
	здесь не выбрано никакого пользователя, то значения этого показателя %
	будут рассчитываться, но не будут доставляться ни одному пользователю.
	\eor

	\item[Описание]
	Текстовая строка, более подробно, нежели наименование, описывающая %
	смысл показателя.

	\item[Формула]
	Расчетная формула, по которой система вычисляет значения показателя.

	\item[Контрольные границы значения]

	\item[\dlgbutton{Тест}]
	Кнопка, позволяющая протестировать правильность ввода формулы.
	При нажатии на эту кнопку система рассчитает значение показателя %
	на сегодняшний день и выведет его в строке, расположенной под
	кнопкой.
\end{description}

\section{Расчет значений бизнес-показателей}

Расчет бизнес-показателей возможен в двух режимах:

\begin{itemize}
	\item Ручном
	\item Серверном
\end{itemize}

Для расчета в ручном режиме выберите пункт меню \ppymenu{Админ\rdir Разное\rdir Расчет бизнес-показателей}.
Кроме того, функция расчета доступна из таблицы значений бизнес-показателей (см. ниже).

Серверный вариант позволяет поставить задачу JobServer'у для того, чтобы он
автоматически с заданной периодичностью запускал данный расчет.

\subsection{Параметры расчета бизнес-показателей}

\ppypict{dlg-133}{Параметры расчета бизнес-показателей}

Какой бы режим расчета вы не выбрали, перед непосредственным запуском (или при настройке серверной задачи)
необходимо определить ряд параметров расчета.

Диалог редактирования параметров показан на рис.~\ref{pic-dlg-133}, а следующая
таблица описывает его элементы.

\begin{description}
	\item[Период]
	Период, за который следует рассчитать значения показателей.
	Здесь допустимо использовать шаблонизированное представление периода.
	В случае настройки серверной задачи следует применять именно такое
	представление, чтобы сервер запускал расчет для заданного периода
	относительно даты, когда он это делает.

	\item[\dlgflag{Экспортировать данные в XML}]
	Если этот флаг установлен, то будет сформирован файл
	$BizScoreValView.xml$ в каталоге исходящих данных.

	\item[\dlgflag{Отправить данные на FTP сервер}]
	Установка этого признака требуется в том случае, если
	вы имеете зарегистрированные учетные записи на центральном
	сервере для доставки значений показателей мобильным
	пользователям.

	При включении этого флага необходимо также включить
	флаг \dlgflag{Экспортировать данные в XML} (поскольку именно
	этот файл отправляется на центральный сервер).

	\item[FTP-аккаунт]
	В случае установки флага \dlgflag{Отправить данные на FTP сервер}
	необходимо выбрать предварительно настроенную запись,
	в которой определены параметры FTP-сервера, на который
	передаются значения бизнес-показателей.
\end{description}

\section{Значения бизнес-показателей\label{sec-bizscore-values}}

\subsection{Таблица анализа значений бизнес-показателей}

Таблица значений бизнес-показателей доступна посредством меню
\ppymenu{Отчетность\rdir Значения бизнес-показателей}.

\subsubsection{Фильтр анализа значений бизнес-показателей}

\ppypict{dlg-131}{Фильтр по значениям бизнес-показателей}

Диалог фильтра по значениям бизнес-показателей изображен на рис.~\ref{pic-dlg-131}.
Он содержит перечисленные ниже управляющие элементы.

\begin{description}
	\item[Пользователь]
	Если здесь выбран пользователь, то будут показаны значения только тех
	показателей, которые привязаны к этому пользователю.

	\item[Показатель]
	Вы можете выбрать здесь один показатель. Тогда значения будут выведены
	только по нему.

	Обратим внимание на то, что при выборе здесь какого-либо показателя,
	становится возможным просмотр графика изменения его величины во времени.

	\item[Расчетный период]
	В этом поле можно ограничить период расчетных дат показателей,
	выводимых в таблице.

	\item[Начиная с\dots (Дата, Время)]
	Если в поле \qu{Дата} установлена допустимая дата, то будут показаны
	только те значения, которые были рассчитаны начиная с момента,
	определенного этими двумя полями.
\end{description}

\subsubsection{Действия в таблице значений бизнес-показателей}

\ppypictsc{brw-029}{Значения бизнес-показателей}{0.5}

\paragraph{Бизнес-показатель}\indent\keyb{F2}
	Открывает диалог просмотра и редактирования бизнес-показателя, которому
	соответствует значение в текущей строке.
\paragraph{Расчет}\indent\keyb{F6}
	Позволяет пересчитать значения отображаемого в таблице бизнес-показателя. Отметим, что при этом
	выполняется стандартная функция расчета, не зависящая от параметров
	фильтрации таблицы (кроме, собственно, показателя).

\paragraph{График}\indent\keyb{Ctrl-N}
	Эта опций доступна только в том случае, если в фильтре выбран
	конкретный показатель.

	В этом случае открывается окно графического представления величин
	показателя во времени.
\paragraph{Печать}\indent\keyb{F7}
	Выполняет обычную процедуру отправки таблицы на печать либо
	на экспорта.

	Стандартная печатная форма здесь BizScoreValView.
\paragraph{Фильтр}\indent\keyb{Ctrl-V}
	Позволяет изменить фильтр просмотра значений бизнес-показателей.

\chapter{Отчетность по расчетам с дебиторами и кредиторами\label{ch-rep-dbtcrd}}

\section{Долговая ведомость}

Долговая ведомость позволяет анализировать соотношение между отгрузкой и оплатами по
документам. Этот анализ может быть проведен как в разрезе покупателей, так и поставщиков,
а также любой другой категории контрагентов, по которой вы ведете учет оплат по документам.

Обратим внимание на то, что, не смотря на однозначное название, этот вид отчетности
является не только инструментом отслеживания долгов, но и предоставляет множество
возможностей для анализа финансовому менеджменту и бухгалтерскому подразделению вашего
предприятия.

Для того чтобы обратиться к долговой ведомости выберите пункт меню \ppymenu{Отчетность\rdir
Расчеты с дебиторами и кредиторами\rdir Долги по покупателям} или \ppymenu{Отчетность\rdir Расчеты
с дебиторами и кредиторами\rdir Долги по поставщикам}. Оба эти пункта меню практически идентичны
за исключением того, что в первом в качестве таблицы аналитических статей установлена
таблица \ppyrsrv{Покупатели}, а во второй \ppyrsrv{Поставщики}.

\subsection{Фильтр долговой ведомости}

\ppypict{dlg-043}{Долговая ведомость}

На рис.~\ref{pic-dlg-043} показан вид фильтра долговой ведомости. Следующая таблица
перечисляет о описывает назначение управляющих элементов этого диалога.

\begin{description}
	\item[Период отгрузки]
	Период, за который следует перебирать долговые документы.

	\item[Период оплаты]
	Период, которым следует ограничить перебор оплат по долговым документам.

	\item[Срок оплаты]
	Период, в который должны попадать сроки оплаты по долговым документам.

	\item[\dlgcombo{Аналитическая таблица}]
	Здесь должна быть указана таблица аналитических статей, по которой система должна перебирать
	документы. Если здесь, скажем, указана таблица \ppyrsrv{Покупатели} то перебираются только те долговые
	документы, контрагенты в которых относятся к этой таблице.

	\item[\dlgcombo{Контрагент}]
	Если вы хотите увидеть анализ только по одному контрагенту, то выберите его в этом комбо-боксе.
	Эта опция позволяет избежать нежелательной задержки в расчетах по всем контрагентам, если
	вас интересует только один контрагент.

	\item[\dlgcombo{Категория}]
	Выбор в этом комбо-боксе какого-либо значения заставит систему строить отчет только по
	тем контрагентам (аналитическим статьям), которые связаны с персоналиями, имеющими
	выбранную категорию.

	\item[\dlgcombo{Подстановка контрагента}]
	Опция, позволяющая сгруппировать отчет по одному из критериев, соответствующих
	контрагентам.
	При выборе здесь какого-то значения, система будет группировать контрагентов, одинаковых
	по этому критерию, и суммировать расчетные величины по таким контрагентам.

	\item[\dlgcombo{Город}]
	Позволяет фильтровать расчет по контрагентам, адрес которых содержит выбранный город.
	Если в диалоге установлен флаг \dlgflag{Адрес доставки}, то фильтрация осуществляется по
	адресу доставки, в противном случае - по юридическому адресу.

	\item[\dlgcombo{Склад}]
	При необходимости рассмотреть долговые документы, относящиеся только к одному складу,
	укажите этот склад в этом комбо-боксе.

	\item[\dlgcombo{Валюта}]
	Если ваши долги, либо долги ваших дебиторов номинированы в различных валютах, то вы
	имеете возможность ограничить расчет только конкретной валютой, выбрав ее здесь. Если это
	поле пустое, и не установлен флаг \dlgflag{Все валюты}, то просматриваются только документы,
	номинированные в базовой валюте.

	\item[\dlgflag{Все валюты} ]

	\item[\dlgflag{Только неоплаченные документы} ]
	При включенном флаге, система включает в отчет только те долговые документы, которые
	оплачены не полностью.

	\item[\dlgflag{Считать оплату только за период} ]
	Это устаревший флаг. Его смысл в том, что в отчете учитываются только те оплаты, дата
	которых попадает в период отгрузки. В настоящий момент эта опция работает именно так,
	но при условии, что поле \qu{Период оплаты} пустое. В большинстве случаев, для ограничения
	периода оплаты следует использовать поле \qu{Период оплаты}.

	\item[\dlgflag{В ценах поступления} ]
	Если этот признак включен, то система проецирует отгрузочные товарные документы,
	номинированные в ценах реализации , в цены поступления. Точно также, в соотношении сумма
	оплаты / сумма отгрузки, трансформируются суммы платежей.

	Этот флаг используется достаточно редко, в случаях, если необходимо оценить долги ваших
	покупателей перед вами в терминах себестоимости отгруженной им продукции.

	\item[\dlgflag{Расширенная ведомость} ]
	Если этот флаг включен, система рассчитывает долговую ведомость, которая учитывает не только
	суммы долговых документов и суммы платежей, но и отдельными колонками отчета показывает
	состояние зачетов по каждому контрагенту и итоговое сальдо по долгам и зачетам.

	Хотя расширенная ведомость рассчитывается несколько медленней обычной, она позволяет увидеть
	полную картину взаиморасчетов с контрагентами.

	\item[\dlgflag{Включать нулевые долги}]
	Обычно, долговая ведомость используется для высвечивания только ненулевых долгов. Если же,
	вашей целью является не просто долги, но более широкий аспект анализа, то установите этот
	флаг. При этом из отчета не будут устраняться контрагенты, итоговое сальдо взаиморасчетов
	с которыми нулевое.

	\item[\dlgflag{Показывать просроченную задолженность}]
	Если флаг установлен, то в результирующей таблице будет отображаться колонка с суммой
	долга, по которой дебитор нарушил срок оплаты.

	\item[\dlgflag{Адрес доставки} ]
	Если этот флаг установлен, то все критерии фильтрации и группировки, опирающиеся на адрес
	контрагента, используют адрес доставки.
	Алгоритм получения адреса доставки следующий:
	Извлекается адрес доставки по документу, если этот адрес не пустой, то он и применяется
	В противном случае извлекается фактический адрес персоналии и, если не пустой, то применяется
	Если первые два пункта не сработали (и адрес доставки по документу и физический адрес
	персоналии пустые), то используется юридический адрес персоналии.

	\item[Переключатель \dlgradioc{Сортировать по}]
	Позволяет выбрать порядок сортировки отчета либо одному из следующих критериев:
	\begin{itemize}
		\item Наименованию
		\item Сумме отгрузки
		\item Сумме долга
		\item Признаку стоп (сначала следуют контрагенты, для которых в соглашении
		установлен этот признак, затем тем, у которых - нет). Строки, для которых
		признак \dlgflag{Стоп} имеет одинаковое значение, сортируются по имени
		контрагента.
	\end{itemize}

	\item[\dlgbutton{Расширение\dots} ]
	Предоставляет возможность ограничить расчет ведомости по агенту, с которым связан документ,
	и (или) с плательщиком по документу. См. ниже.

	\item[\dlgbutton{Цикличность} ]
	Открывает дополнительный диалог, управляющий параметрами цикличности отчета (см. ниже).

	\item[\dlgbutton{Дополнение} ]
	Вызывает диалог, управляющий дополнительными критериями отбора документов,
	по которым строится отчет (см. ниже).

\end{description}

\subsubsection{Фильтр долговой ведомости по расширениям документов}

\ppypict{dlg-f-014}{Диалог расширения фильтра долговой ведомости}

Этот внутренний диалог фильтра долговой ведомости позволяет устанавливать
дополнительные параметры отбора документов, по которым должна строиться ведомость.
Вид этого диалога показан на рис.~\ref{pic-dlg-f-014}.

\begin{description}
	\item[\dlgcombo{Плательщик}]
	Ограничивает отчет только теми документами, в атрибуте \qu{Плательщик}
	установлена выбранная здесь статья.

	\item[\dlgcombo{Агент}]
	При выборе в этом комбо-боксе определенной статьи агент расчет
	будет вестись только по документам, в атрибуте \qu{Агент} которых
	установлена эта статья.

	\item[\dlgcombo{Таблица статей дополнительного объекта}]
	Вспомогательный комбо-бокс, позволяющий уточнить выбор дополнительного
	объекта по документам, которые должны попасть в отчет.

	Необходимость в выборе этой таблицы обусловлена тем, что
	отчет \qu{сворачивает} данные по множеству документов относящихся к
	к разным видам операций. Каждый вид операции может определять собственную
	таблицу статей дополнительного объекта по документам (или не определять
	вовсе). Следовательно, система не может самостоятельно идентифицировать
	эту таблицу в этом фильтре.

	\item[\dlgcombo{Дополнительный объект}]
	Если выбран дополнительный объект, то в отчет попадут данные только
	по тем документам, дополнительным объектов в которых является он.
\end{description}

\subsubsection{Параметры цикличности долговой ведомости}

\ppypict{dlg-085}{Параметры цикличности долговой ведомости}

Это - специальная группа опций фильтра отчета, управляющая его модификациями,
позволяющими получить кросстабулированные по периодам отчеты с заданными
показателями.

Подробнее эти модификации определяются ниже.

Изображение диалога приведено на рис.~\ref{pic-dlg-085}.

\begin{description}
	\item[Период отгрузки]
	В этом поле дублируется период из заголовочного диалога фильтра.
	При изменении периода здесь в заголовочном диалоге он также
	измениться.

	\item[Период оплаты]
	Аналогично предыдущему полю, это - дублирует одноименный критерий
	из заголовочного диалога фильтра.

	\item[Период срока оплаты]
	Так же, как и предыдущие два поля, это - дублирует критерий \qu{Период
	срока оплаты} из заголовочного диалога.

	\item[\dlgradioc{Показатель}]
	Блок переключателей, от которых зависит форма отчета.
	Возможны следующие варианты:
	\begin{description}
		\item[\dlgradioi{Нет}] Если переключатель в этом положении, то отчет не будет
		циклическим.
		\item[\dlgradioi{Просроченность оплаты}]
		\item[\dlgradioi{Задержка оплаты}]
		\item[\dlgradioi{Отгрузка по периодам}]
		\item[\dlgradioi{Оплаты по периодам}]
	\end{description}
	В зависимости от выбора варианта справа от переключателя показываются %
	дополнительные критерии расчета.

	Все четыре (отличные от \dlgradioi{Нет}) варианта отчета будут описаны ниже.
\end{description}

\subsubsection{Дополнительные отчеты по долговой ведомости}

\ppypict{dlg-086}{Дополнительные отчеты по долговой ведомости}

Вложенный диалог \qu{Дополнительные отчеты по долговой ведомости} (рис.~\ref{pic-dlg-086})
позволяет рассчитать специализированные макро-характеристики задолженности.

Такой отчет допускает использование подстановки по контрагенту.
В этом случае вы получите укрупненные параметры (по городу, категории контрагента и т.д.).

Здесь возможны следующие варианты:

\paragraph{Нет}
	Функции дополнительных отчетов отключены.

\paragraph{Доля просроченных долгов}
	При выборе этого положения переключателя, система рассчитает отчет, содержащий анализ
	задолженности по критерию отношения

	Просроченная задолженность / Общая задолженность

	Обращаем внимание на то, что этот отчет актуализирован только для текущего момента. То
	есть, сравнение величин  опирается на понятие  \qu{Текущей просроченной задолженности}.
	Другими словами, этот отчет не сможет продемонстрировать показатель доли просроченной
	задолженности по состоянию на какой-либо день, отличный от текущего.

	Критерием просроченности долга выступает поле \qu{Срок оплаты (дней)} в котором вам
	следует указать какое количество дней от даты документа отгрузки еще не
	является просроченным. Допустим, если вы укажете здесь значение 7, то документы,
	которые не оплачены в течении 7 дней или менее не являются просроченными, а документы,
	по которым не поступило полной оплаты в течении 8 дней и более - просрочены.

	Если в срок оплаты будет установлен равным нулю, то за срок оплаты для каждого
	документа будет приниматься последняя дата платежа из долгового документа.

	Заметим, что эти два варианта расчета (с явным указанием срока оплаты и
	со сроком, извлекаемым из долгового документа) заметно различаются по
	результирующим значениям.

\paragraph{Оборачиваемость дебиторской задолженности}
	Если установлено это значение переключателя, то будут рассчитаны значения оборачиваемости
	дебиторской задолженности по следующей методике:

	Оборот контрагента за период делится на его задолженности на конец периода.

	Все три величины выводятся в таблице просмотра.
	При использовании этой опции следует иметь в виду следующие обстоятельства:
	\begin{itemize}
		\item периодом считается период отгрузки, введенный в заголовочном диалоге фильтра
		\item контрагенты с нулевым долгом на конец указанного периода не показываются, поскольку
		попытка расчета оборачиваемость дебиторской задолженности по ним бессмысленна (деление
		на ноль).
		\item приведенная здесь методика расчета оборачиваемости дебиторской задолженности
		несколько отличается от классической. В классическом варианте оборачиваемость
		вычисляется как отношение оборота контрагента к его \emph{средней} задолженности
		за период.

		Данный отчет не позволяет вычислить за одну операцию среднюю задолженность.

		Для расчета классической оборачиваемости задолженности как
		макро-величины по всему предприятию следует использовать технологию
		бизнес-показателей.
	\end{itemize}

\subsection{Таблица долговой ведомости}

\ppypictsc{brw-debttrnovr-ext}{}{0.4}

На рис.~\ref{pic-brw-debttrnovr-ext} показан вид таблицы расширенной долговой ведомости.
Обычная (не расширенная) таблица не содержит последних четырех колонок.
Далее описывается смысл каждого из столбцов.

	\paragraph{Наименование} Наименование статьи контрагента. При подведении курсора мыши
	к ячейке этой колонки высвечивается подсказка, содержащая телефоны и другие
	электронные адреса контрагента (если для него какие-либо из этих адресов
	определены).
	\paragraph{№} Номер аналитической статьи контрагента.
	\paragraph{По отгрузке}

	\begin{itemize}
		\item Отгружено: Сумма долговых документов, соответствующих заданному фильтру.
		\item Оплачено: Общая сумма документов оплат, привязанных к документам отгрузки,
		просуммированных в колонке \qu{Отгружено} с учетом условий фильтра.
		\item Долг: Разница между колонками \qu{Отгружено} и \qu{Оплачено}.
	\end{itemize}
	\paragraph{По зачетам}

	\begin{itemize}
		\item Платежи: Сумма зачетных документов, за период отгрузки, заданный в фильтре.
		\item Зачтено: Сумма зачитывающих оплат, соответствующих зачетным документам,
		просуммированным в колонке \qu{Платежи}.
		\item Остаток: Разница колонок \qu{Платежи} и \qu{Зачтено}.
	\end{itemize}
	\paragraph{Общий долг}
	Разница колонок \qu{Долг} группы \qu{По отгрузке} и \qu{Остаток} группы \qu{По зачетам}.
	\paragraph{Стоп}
	Если аналитическая статья, которой соответствует строка, имеет установленный признак
	\dlgflag{Стоп}, то в этой колонке будет виден символ X.

	Заметим, что если в фильтре выбрана подстановка контрагента, то эта колонка
	всегда пустая (в общем случае, система не может идентифицировать установку
	флага \dlgflag{Стоп} по множеству статей, представленных одной строкой).

\subsection{Действия в таблице долговой ведомости}

	\paragraph{Документы}\indent\keyb{Enter}
	Просмотр долговых документов по выбранному контрагенту, соответствующих фильтру

	\paragraph{Аналитическая статья}\indent\keyb{F2}
	Открывает диалог просмотра и редактирования статьи аналитического учета, соотвествующей
	текущей строке таблицы.

	\paragraph{Долговая карточка клиента}\indent\keyb{F3}
	Просмотр долговой карточки контрагента. Эта карточка перечисляет как долговые документы,
	так и оплаты, в хронологическом порядке. Для каждого документа указывается сальдо, возникшее
	после него.

	\paragraph{Зачетные документы}\indent\keyb{F6}
	Просмотр зачетных документов по контрагенту, соответствующих фильтру.

	\paragraph{Персоналия}\indent\keyb{F4}
	Просмотр и редактирование персоналии, соответствующей выбранной строке.

	\paragraph{Печать ведомости}\indent\keyb{F7}
	\ppypict{dlg-debttrnovr-prn}{Печать долговой ведомости}
	При выборе этой функции вам будет предложен диалог выбора варианта отчета
	(рис.~\ref{pic-dlg-debttrnovr-prn}).

	\subparagraph{Ведомость должников}
		Будет печататься простой отчет долговой ведомости, аналогичный тому, что вы видите
		на экране.

	\subparagraph{Ведомость должников с док}
		Будет печататься отчет, содержащий не только итоговые строки, но и долговые документы
		с суммой долга по каждому контрагенту.

		Документы выводятся за период отгрузки, указанной в фильтре отчета.
		Если этот период большой, то и отчет может получиться внушительного объема.

	\subparagraph{Акт сверки}
		Специальная опция, позволяющая печатать акты сверки по всем контрагентам, перечисленным
		в ведомости, для рассылки.

		При выборе этого варианта, вероятно, следует заполнить поле \qu{Срок поступления ответа}.
		Здесь вы можете указать срок поступления ответа от контрагента, после которого,
		если контрагент не подтвердил акт сверки, его долг или ваша задолженность перед ним,
		считается утвержденным.

	\subparagraph{Переключатель способа сортировки}
		С помощью этого переключателя вы имеете возможность выбора способа сортировки выводимого
		на печать отчета.

	\paragraph{Итог}\indent\keyb{F9}
	Итоговые суммы по ведомости.

	\paragraph{Фильтр}\indent\keyb{Ctrl-V}
	Изменение фильтра с последующим пересчетом ведомости.

\section{План платежей}

План платежей - это инструмент анализа будущих денежных поступлений и расходов. Этот вид
отчетности опирается на долговые документы и учитывает сроки оплаты по документам.
Основываясь на этих данных, строится таблица, в которой для каждого цикла выбранного
периода, показывается сумма, которая должна быть оплачена.

\subsection{Техника расчета}

План платежей строится следующим образом:

\begin{itemize}
	\item За период, указанный в фильтре перебираются записи плановых сроков платежей.
	Соответствующие даты вы видите в диалоге документа в поле \qu{Дата оплаты}, либо
	(для сложного графика платежей) по кнопке \dlgbutton{План платежей}.
	\item Для каждой записи срока платежа извлекается документ, важнейшими атрибутами
	которого, для данного отчета, являются:
	\begin{itemize}
		\item Контрагент.
		\item Номинальная сумма (сумма отгрузки).
		\item Сумму оплаты. В случае, если фильтр предписывает учитывать
		текущий долг, считается полная сумма оплаты, в противном случае -
		только до даты начала периода отчета (поле \qu{Период} в фильтре).
	\end{itemize}
	\item Если фильтр определяет цикличность отчета, то записи
	сортируются по принадлежности временным циклам.
	\item Если в фильтре задано требование детализации по контрагенту,
	то записи сортируются по контрагенту, либо его подстановке
	(опция фильтра \dlgcombo{Подстановка контрагента}).

	Если же детализация по контрагенту не требуется, отчет считает суммарные
	значения суммы отгрузки, суммы оплаты и суммы ожидаемых платежей по всем
	контрагентам за период или цикл.

	\item При установленном в фильтре флаге \dlgflag{Кросстаб} после расчета
	система строит кросстабулированную таблицу по циклам.
\end{itemize}

\subsection{Фильтр плана платежей}

\ppypict{dlg-f-paymplan}{План платежей}

\begin{description}

	\item[Период]
	Период времени, за который система должна рассчитать отчет.

	\item[\dlgcombo{Склад}]
	Выберите здесь склад, если вы хотите ограничить расчет только этим складом. Если склад не
	выбран, то анализ ведется по всем складам.

	Кнопка \dlgbutton{Список} справа от этого комбо-бокса позволяет выбрать
	несколько складов, для которых должен рассчитываться отчет в совокупности.

	\item[\dlgcombo{Таблица статей}]
	Таблица аналитических статей, относительно которой следует вести расчет. Система будет
	перебирать только те долговые документы, которые относятся к этой таблице статей.

	\item[\dlgcombo{Контрагент}]
	Если вы хотите увидеть план платежей только по одному контрагенту, то выберите его
	здесь.

	\item[\dlgcombo{Цикл} / Количество циклов]
	Как правило, план платежей рассчитывается по циклам. Благодаря этому, можно увидеть
	детализированную картину предстоящих платежей, например, по неделям или дням.
	В комбо-боксе \dlgcombo{Цикл} выберите интересующий вас цикл, при этом, если период уже задан,
	система автоматически посчитает, сколько циклов попадает в заданный период, и установит
	это значение в соответствующее поле. В тоже время, вы можете переопределить выбранную
	системой величину.

	\item[\dlgflag{Считать только текущий долг}]

	\item[\dlgflag{Детализировать по контрагенту}]
	\item[\dlgflag{Кросстаб}]

	\item[\dlgcombo{Подстановка контрагента}]

\end{description}

\section{Обороты по поставщикам}

Отчет \qu{Обороты по поставщикам} является гибридом, совмещающим в себе оборотную
ведомость по статьям бухгалтерского счета \qu{Расчеты с поставщиками} и товарные
остатки по каждому из поставщиков.

То есть, в отчет отображает следующие значения по каждому из поставщиков:

\begin{itemize}
	\item Начальное сальдо на заданный период
	\item Дебетовый И кредитовый обороты за заданный период
	\item Сальдо на конец периода
	\item Суммовой остаток товаров поставщика (в ценах поступления)
\end{itemize}

Бухгалтерский счет, по статьям которого строится этот отчет извлекается из
общий настроек (\ppymenu{Админ\rdir Настройки} поле \qu{Счет поставщиков}).

Мы особо акцентируем внимание на том факте, что обороты и долги рассчитываются %
на базе бухгалтерских проводок, а не непосредственно по документам, как это происходит
в случае с долговой ведомостью.

Таким образом, если в вашей базе данных не настроены проводки по видам операций,
затрагивающим состояние взаиморасчетов с поставщиками, либо настроены не верно,
вы не сможете получить этот отчет в адекватном виде.

Для работы с отчетом выберите пункт меню
\ppymenu{Отчетность\rdir Расчеты с дебиторами и кредиторами\rdir Обороты по поставщикам}.

\subsection{Фильтр отчета}
\ppypict{dlg-134}{Диалог редактирования фильтра оборотов по поставщикам}
Внешний вид диалога фильтра этого отчета показан на рис.~\ref{pic-dlg-134}.
Далее перечислены его управляющие элементы.

\begin{description}
	\item[Период]
	Период расчета оборотов по поставщикам. Входящее и исходящее сальдо
	будет рассчитано, соответственно, на начало и конец этого периода.

	\item[\dlgcombo{Поставщик}]
	Вы можете ограничить отчет только одним поставщиком. Для этого выберите
	в этом комбо-боксе требуемую статью.

	\item[\dlgcombo{Склад}]
	Выбор склада в этом комбо-боксе приведет к ограничению расчета
	оборотов и сальдо только проводками по документам, принадлежащим
	выбранному складу.

	Заметим, что как и в случае анализа счета с ограничением по складу,
	расчет сальдо в этом случае значительно замедляется.

	\item[\dlgflag{Не показывать нулевые обороты} ]
	Если вы установите этот флаг, то в отчет не будут включены
	аналитические статьи, обороты по которым были в течении заданного
	периода нулевыми.

	\item[\dlgflag{Не показывать нулевое сальдо} ]
	Установка этого флага приведет к исключению из отчета аналитических
	статей, конечное сальдо за выбранный период по которым равно нулю.

\end{description}

\subsection{Таблица отчета}

\ppypictsc{brw-030}{Таблица оборотов по поставщикам}{0.4}

\subsubsection{Действия в таблице отчета}

\paragraph{Анализ}\indent\keyb{Enter}
	Открывает таблицу анализа счета по статье, соответствующей выбранному поставщику.
	Анализ рассчитывается за период, эквивалентный тому, что задан в фильтре отчета.
	Кроме того, если вы ограничили отчет одним складом, то и показанный анализ счета будет
	ограничен этим же складом.

\paragraph{Лоты}\indent\keyb{F3}
	Открывает таблицу просмотра всех лотов выбранного поставщика.

\paragraph{Документы}\indent\keyb{F4}
	Показывает документы поставщика за период, указанный в фильтре отчета.
	Если в фильтре выбран склад, то он также ограничивает выборку показываемый
	этой функцией документов.

\paragraph{Остатки товаров}\indent\keyb{F5}
	Отображает остатки товаров выбранного поставщика на конец указанного
	в фильтре периода с ограничением по выбранному складу.

\paragraph{Печать}\indent\keyb{F7}
	Отправляет на печать рассчитанный отчет.
	Появлению стандартного диалога печати предшествует диалог опций
	печати, аналогичный тому, что показывается при работе с анализом
	счета в варианте оборотов по статьям.

	При выборе основного отчета, форма печати несколько отличается от
	той, что применяется в случае с простым анализом счета.

	В этой форме присутствуют также колонки:
	\begin{description}
		\item[Наш долг сверх остатков товаров] Разница между остатками товаров
		поставщика и нашим долгом ему. Отрицательные и нулевые значения в
		этой графе не отражаются.

		Смысл этой величины - сумма, которую предприятие должно как можно
		скорее выплатить поставщику, поскольку продало (израсходовало)
		товары, приобретенные у поставщика, на указанную сумму и, вероятно,
		получило от этого соответствующую прибыль.
		\item[Остатки товаров сверх нашего долга] Разница между нашим долгом
		перед поставщиком и товарными остатками этого поставщика на складах
		предприятия. Как и в случае предыдущей графы, отрицательные и нулевые
		значения здесь не отображаются.

		Экономический смысл этой колонки заключается в том, что предприятие,
		возможно, имеет основания аргументировать задержку платежей поставщику
		на указанную сумму ввиду того, что эти товары не распроданы (израсходованы).
	\end{description}

	Заметим, что мы не пытаемся \qu{навязывать} вам приведенные трактовки
	отображаемых в отчете значений. Это - не более чем сложившаяся на
	многих предприятиях практика использования этого отчета.

	Стандартная форма отчета: SupplTrnovr.

\paragraph{Итог}\indent\keyb{F9}
	Отображает на экране диалог с итоговыми значениями отчета.

\paragraph{Обновить список}\indent\keyb{Ctrl-V}
	Пересчитывает отчет для отображения изменившихся данных.

\section{Рейтинги дебиторов\label{sec-debtorstat}}

Отчет \qu{Рейтинги дебиторов} является результатом статистической
обработки данных о платежах клиентов за всю историю ведения учета
в базе данных \ppybrand{}.

Этот отчет может быть крайне полезным инструментом для предприятий,
отгружающих продукцию своим клиентам в кредит.

\subsection{Элементы отчета}

\subsection{Величины, рассчитываемые в отчете}

Отчет рассчитывает и отображает следующие важные значения, характеризующие
как отдельных клиентов, так и работу всего предприятия в целом:

	\paragraph{Средние задержки платежей}
	Средняя величина задержек в днях между датой \emph{полной} оплаты по документу и датой отгрузки.

	Величина рассчитывается как для отдельных дебиторов, так и для всего
	предприятия в целом.

	\paragraph{Стандартное отклонение задержек платежей}
	Статистическое отклонение задержек платежей от средней величины.

	Значение рассчитывается и для отдельных клиентов и для всего предприятия.
	Величина характеризует разброс задержек оплаты. Довольно грубая ее
	интерпретация может звучать так: чем выше это отклонение, тем менее дисциплинирован
	клиент при оплате своих долгов. Повторим, это - весьма грубое объяснение.
	В действительности, интерпретацию величины следует увязывать с другими
	параметрами отчета. Такими как, средняя задержка платежей и средняя просроченность
	платежей.

	\paragraph{Средняя просроченность платежей}
	Средняя величина просроченности платежей по документам. Рассчитывается как
	статистическое среднее разницы в днях между полной оплатой по документу и
	последним сроком оплаты, указанным в документе.

	Если ваше предприятие не практикует использование сроков оплаты в
	документах отгрузки, то описываемая величина будет равна средней
	задержке платежа.

	Данное значение достаточно ярко характеризует как клиента, так и
	все предприятие. Чем оно ниже, тем более дисциплинированным является клиент и
	тем лучше организована работа по сбору дебиторской задолженности на предприятии.

	\paragraph{Плотность и период платежей}
	Очень важные параметры, определяющие удельную сумму и период платежей клиента
	за всю историю взаимоотношений с ним.

	Рассчитываются эти величины следующим образом:
	\begin{itemize}
		\item Перебираются все платежи клиента, привязанные к документам отгрузки.
		\item Сумма этих платежей делится на количество дней, в течении которых
		они были осуществлены.
	\end{itemize}

	Таким образом мы получаем характеристику, отражающую способность клиента
	гасить задолженность за отгруженный товар или оказанные услуги. Здесь важно
	подчеркнуть, что данная величина - оценка кредитоспособности клиента именно
	в проекции на ваше предприятие.

	Опять же, достаточно грубо, это можно иллюстрировать следующим примером.
	Некий магазин регулярно закупает у вас оптом товары, которые выставляет
	на своих торговых площадях. Его покупатели время от времени приобретают эти
	товары. Магазин, в свою очередь, расплачивается с вашим предприятием.
	Величина плотности платежей как раз суммирует эти оплаты и приводит их к
	унифицированной величине (делит на количество дней, на которые приходятся все
	оплаты от этого магазина). В результате (при достаточно продолжительной работе
	с этим магазином), мы получаем сумму, которая очень точно характеризует способность
	клиента торговать нашими товарами (или каким либо иным образом получать от них
	выгоду) и гасить задолженность перед нами.

	То есть, плотность платежей не столько определяет общую кредитоспособность
	клиента (быть может, владелец приведенного в примере магазина является очень
	богатым человеком), сколько его способность встречать требования по платежам
	именно вашего предприятия.

	Значение периода платежей работает в сопряжении с плотностью платежей.
	Малое значение этого параметра означает, что история взаимодействия вашего
	предприятия с этим клиентом не достаточна для адекватной оценки его
	кредитоспособности.

	Ниже мы расскажем как по описываемым значениям
	синтезируется сводная величина, дающая итоговое представление о возможностях
	покупателя гасить товарный кредит, предоставляемый ему нашим предприятием.

	\paragraph{Рейтинг клиента}

	Перечисленные выше параметры автоматически классифицируются системой и
	все множество ваших клиентов разбивается на несколько классов.
	Результатом этой классификации является рассчитанный рейтинг дебитора.

	Рейтинг представлен двумя буквами: от латинской $A$ до латинское $E$ каждая.
	Первая буква отражает кредитоспособность клиента, а вторая - его
	дисциплинированность как плательщика.

	Буква $A$ характеризует клиента наилучшим образом, соответственно, буква $E$ -
	наихудшим. Рейтинг $C$ означает, что дебитор находится по сводной характеристике
	в середине списка клиентов.

	Для примера, рейтинг $AD$ означает, что клиент, обладает очень высокой
	кредитоспособностью (с учетом истории сотрудничества с вашей организацией),
	но его дисциплинированность весьма низкая.

	Общий рейтинг по всему предприятию не рассчитывается.

	\paragraph{Расчетный кредитный лимит}

	На основе статистики платежей система в этом отчете автоматически рассчитывает
	кредитный лимит, который вы можете предоставить клиенту.
	Подробность методики расчета будут приведены ниже.

	\paragraph{Удельная стоимость кредитного портфеля}
	Этот параметр рассчитывается только для агрегированных элементов (для всего предприятия в целом,
	для агентов и статей, сгруппированных по персональному отношению, определенному в конфигурации)
	и отражает удельную итоговою стоимость выданных товарных кредитов в расчете на одну денежную
	единицу.

	Так, значение 0.0061 означает, что тысяча рублей дебиторской задолженности для вашего
	предприятия стоит 6.1 рубль. Эта величина рассчитывается на основе статистики
	задержки платежей и стоимости финансирования, определенной в конфигурации.

	Удельная стоимость кредитного портфеля является очень важным макро-показателем,
	отражающим эффективность вашего предприятия по сбору дебиторской задолженности.
	Кроме того, этот показатель позволяет оценить расходы на штат сотрудников соответствующих
	отделов и адекватность стоимости факторинговых услуг сторонних предприятий.

	При всем сказанном следует помнить, что данный показатель характеризует
	достаточно стабильные процессы, но не может в полной мере учесть риски дефолтов
	по платежам (то есть, ситуации, когда клиенты просто не в состоянии погасить
	свою задолженность).

	Ниже (для читателей, обладающих известной математической подготовкой) мы опишем методику
	расчета этой величины.

\subsection{Методика расчета параметров}

\subsubsection{Общий механизм}

Общий алгоритм работы механизма сбора и анализа статистики по дебиторам следующий:

\begin{enumerate}
	\item Сбор статистики по задержкам платежей.

	Система перебирает все документы, требующие оплаты, относящиеся к видам операций,
	связанных с таблицей аналитических статей, определенной в параметрах расчета.

	В расчет принимаются только те документы, которые полностью оплачены и последняя оплата
	совершена позже даты самого документа хотя бы на один день. Это ограничение отбрасывает
	документы, которые фактически не имеют отсрочки платежей (оплата за наличный расчет
	в день отгрузки, отгрузка по предоплате и т.д.).

	Для каждого документа рассчитывается задержка платежа (разница в днях между датой
	полной оплаты и датой отгрузки) и просроченность платежа (разница в днях между датой
	полной оплаты и сроком оплаты, определенном в документе). Заметим, что в расчет
	принимается срок платежа именно из документа, но не рассматривается период отсрочки
	платежа, определенный в соглашении с клиентом.

	Рассчитанные задержка и просроченность учитываются для статьи-контрагента по документу и,
	одновременно, агрегируются для всего предприятия, а также (если это предписано конфигурацией)
	по агенту, привязанному к документу и холдинговой статье, связанной с контрагентом
	персональным отношением также заданным в конфигурации.

	\item Сбор статистики по плотности платежей

	Система перебирает документы, относящиеся к видам операций, имеющим признак \qu{доходная}
	и связанным с таблицей аналитических статей, определенной в параметрах расчета.

	Если очередной из рассматриваемых документов требует платежного документа, то
	перебираются и суммируются все платежи по этому документу. В противном случае
	учитывается номинальная сумма документа.

	Так же как и в предыдущем пункте суммирование ведется как по статье-контрагенту
	документа, так и по агрегирующим группам (агент по документу, холдинг, все предприятие
	в целом).

	Одновременно, для каждой статьи засекается период, на который приходятся платежи.

	\item Расчет статистических характеристик

	На этом этапе система по собранной статистике рассчитывает описанные выше статистические
	характеристики дебиторов и агрегирующих групп статей.

	\item Сохранение рассчитанных характеристик в базе данных

	\item Установка кредитных лимитов в соглашениях.

	Этот этап осуществляется в том случае, если параметры расчета предписывают это.
\end{enumerate}

\subsubsection{Что такое сигма-фактор?\label{loc-debtorstat-sigmfactor}}

Сигма-фактор является коэффициентом, позволяющим учесть риски по выданным товарным
кредитам в зависимости от истории взаимоотношений вашего предприятия с клиентом.

Основная идея здесь состоит в том, что при увеличении продолжительности работы
с клиентом ваше доверие к нему возрастает. Сложность же в том, что, во-первых,
математический закон снижения риска от продолжительности взаимоотношений не очевиден
(более того - не известен), а во-вторых, этот закон точно не линеен. То есть, клиенту
с которым вы отработали 2 года вы не доверяете в 2 раза больше чем тому, с кем отработали
1 год.

Для приближенной оценки снижения риска по выданным кредитам в зависимости от
истории взаимоотношений мы использовали так называемую сигмоидальную функцию.

Вот ее математическая формула:

$$
\sigma(x) = \frac{1}{1 + e^{-ax}}
$$

Здесь $a$ - сигма-коэффициент, определяемый в конфигурации.

А вот графическое представление значения сигма-фактора взятое из реальных
данных (рис.~\ref{pic-plot-dstat-sigmoid-001}).

\ppypictsc{plot-dstat-sigmoid-001}{Значение сигма-фактора (а=0.01)}{0.4}

Как видно из рисунка, значение функции находится между нулем и единицей.

Аргументом сигмоидальной функции при расчете сигма-фактора ($x$ в представленной выше
формуле) является разница между периодом платежей конкретного дебитора и
средним значением периода платежей по всей выборке дебиторов.

В результате клиенты, имеющие период платежей близкий к среднему получат
значение сигма-фактора близкое к 0.5.

При очень малом значении сигма-коэффициента (0.0001 или меньше) сигмоидальная %
кривая превращается практически в прямую линию со значениями близкими к 0.5
для всех периодов платежей.

При увеличении сигма-коэффициента кривая становится более \qu{резкой} -
большинство дебиторов, имеющих историю меньше среднего получают нулевой
коэффициент, в то время как те, у кого история больше среднего - единичный.

\subsubsection{Расчет плотности платежей}

Величина плотности платежей рассчитывается как отношение суммы платежей,
поступивших от дебитора по доходным видам операций к длительности периода
платежей в днях, рассчитываемого как разница между датами последнего и
первого платежей.

\subsubsection{Расчет кредитного лимита}

Кредитный лимит рассчитывается по следующей формуле:

$$
L=P \cdot \sigma \cdot K \cdot d
$$
где:
\begin{description}
	\item[$L$] кредитный лимит
	\item[$P$] плотность платежей
	\item[$\sigma$] сигма-фактор
	\item[$K$] поправочный коэффициент, заданный в конфигурации
	\item[$d$] количество дней, на которые рассчитывается кредитный лимит.
	Это может быть как фиксированная величина для всех дебиторов, так и
	величина, извлекаемая из поля \qu{срок оплаты} соглашения с клиентом
	(опции выбора расчетного периода определяются конфигурацией).
\end{description}

\subsubsection{Расчет рейтингов\label{loc-debtorstat-rating}}

Методика расчета рейтинга - наиболее сложная в данном модуле.
В первую очередь, напомним, что рейтинг дебитора состоит из двух компонент:

\begin{itemize}
	\item Компонента, отражающая кредитоспособность дебитора.
	\item Компонента, отражающая дисциплинированность дебитора при выплате долгов.
\end{itemize}

В расчете рейтингов применяется методика относительных показателей или индексов. Это
значит, что в рассмотрение берутся не абсолютные статистические величины, рассчитанные
при сборе данных по платежам, а их отношение к среднестатистическим показателям
по всей выборке дебиторов вашего предприятия.

\ppyexampletitle{Приведем пример для иллюстрации данного подхода}{
Предположим, у нас есть 5 дебиторов, каждый из которых имеет некоторый абстрактный
показатель $\alpha$. Вот значения этих показателей для каждого из пяти дебиторов:

\begin{description}
	\item[Арбат] 2
	\item[Багет] 5
	\item[Визаж] 3
	\item[Гудзон] 4
	\item[Дирак] 1
\end{description}

Среднее значение показателя $\alpha$ по всей выборке равно 3.
Таким образом, индекс каждого из дебиторов будет следующим:

\begin{description}
	\item[Арбат] $2/3=0.667$
	\item[Багет] $5/3=1.667$
	\item[Визаж] $3/3=1.000$
	\item[Гудзон] $4/3=1.333$
	\item[Дирак] $1/3=0.333$
\end{description}
}

Итак, для расчета рейтинга нам понадобятся следующие индексы:

\begin{description}
	\item[Индекс задержек платежей] Это - синтетический индекс,
	вычисляемый через комбинацию следующих характеристик дебитора:
	\begin{itemize}
		\item Средняя задержка платежей
		\item Стандартное отклонение задержек платежей
		\item Средняя просроченность платежей
	\end{itemize}
	Первые две характеристики \qu{сворачиваются} в коэффициент
	вариации (отношение стандартного отклонения к средней задержке),
	третья характеристика \qu{смешивается} с коэффициентов вариации
	задержек платежей специальным образом (см. ниже).

	Точная формула для расчета индекса задержек платежей следующая:

	$$
	DI_i=(1-w)\cdot\frac{V_i}{\bar{V}} + w\cdot\frac{E_i}{\bar{E}}
	$$
	где:
	\begin{description}
		\item[$DI_i$] Индекс задержек платежей дебитора $i$
		\item[$V_i$] Коэффициент вариации задержек платежей дебитора $i$
		\item[$\bar{V}$] Средний коэффициент вариации по всей выборке дебиторов
		\item[$E_i$] Средняя просроченность платежей дебитора $i$
		\item[$\bar{E}$] Средняя просроченность платежей по всей выборке дебиторов
		\item[$w$] Весовой коэффициент просроченности в рейтинге, определяемый в конфигурации
	\end{description}
	\item[Индекс плотности платежей]
	Этот индекс представлен произведением плотности платежей
	на сигма-фактор (аналогично тому, как это делается при расчете
	кредитного лимита).

	Формула, применяемая при вычислении этого индекса, следующая:
	$$
	PI_i=\sigma(p_i-\bar{p}) \cdot d_i
	$$
	где:
	\begin{description}
		\item[$PI_i$] Индекс плотности платежей дебитора $i$
		\item[$\sigma$] Функция сигма-фактора от разницы между периодом платежей дебитора $i$
		и средним периодом платежей по всей выборке дебиторов (аргументы $p_i$ и $\bar{p}$,
		описанные ниже)
		\item[$p_i$] Период платежей дебитора $i$
		\item[$\bar{p}$] Средний период платежей по всей выборке дебиторов
		\item[$d_i$] Плотность платежей дебитора $i$
	\end{description}
\end{description}

Следующий шаг при определении рейтинга - распределение дебиторов
на основании вычисленных индексов. Для этого нам понадобиться мера, в соответствии
с которой дебитор, имеющий то или иное значение индекса, получит определенный рейтинг.

Такой мерой послужит статистическое стандартное отклонение индекса по всей выборке
дебиторов, умноженное на поправочный коэффициент.

\ppypictsc{plot-dstat-rating}{Распределение дебиторов по рейтингам}{0.3}

Для иллюстрации распределения дебиторов по рейтингам в согласии с индексами
приведем график, построенный на реальных данных (рис.~\ref{pic-plot-dstat-rating}).

На рисунке видны линия разграничений по которым дебиторам присваиваются значения рейтингов.
Вооруженные этой иллюстрацией, мы можем объяснить смысл символов рейтинга:
\begin{description}
	\item[Рейтинг $C$] присваивается дебиторам, имеющим значение индекса, лежащее
	в средней части распределения.
	\item[Рейтинги $B$ и $D$] присваиваются дебиторам, имеющим значение индекса
	соответственно лучше и хуже среднего диапазона.
	\item[Рейтинги $A$ и $E$] присваиваются при значениях индекса, выходящим за пределы
	трех средних диапазонов. Соответственно, рейтинг $A$ получают контрагенты, имеющие
	экстремально качественный индекс, а рейтинг $E$ - те, кто плохи за рамками допустимого.
\end{description}

Обратим внимание на неравномерность приведенного распределения. Так, некоторые символы
рейтингов остались не заполненными. В общем, это - не является значительной проблемой,
однако для более равномерного распределения существует два инструмента:

\ppypictsc{plot-dstat-rating-log}{Распределение дебиторов по рейтингам с логарифмической шкалой}{0.3}

\label{loc-debtorstat-01}
\begin{itemize}
	\item Коэффициенты, регулирующие ширины рейтингов. Они определяются в конфигурации
	статистики дебиторов.
	\item Применение логарифмической шкалы. Этот метод является весьма радикальным
	средством выравнивания шкал рейтингов, однако его использование связано также
	и с тем, что одно значение рейтинга будет у дебиторов, имеющих значительно
	различающиеся в абсолютном выражении индексы. То есть, сравниваться будут уже
	не абсолютные значения индексов, а их порядки.

	Иллюстрация на рис.~\ref{pic-plot-dstat-rating-log} показывает пример
	использования логарифмической шкалы для определения рейтингов. Заметим,
	что инструмент коэффициентов ширин рейтингов остается в силе и в этом случае.
\end{itemize}

\paragraph{Рейтинги и агрегирующие элементы отчета}

Мы уже упоминали о том, что отчет о статистике по дебиторам состоит из
терминальных аналитических статей и агрегирующих элементов, которые
суммируют статистику по торговым агентам, холдингам и по всему предприятию.

При расчете рейтингов агрегирующие элементы не принимаются в расчет и
по ним рейтинги не вычисляются. Главная причина тому - значительное отличие
величин характеризующих агрегирующие элементы от всех остальных. Если они
будут принимать участие в вычислении индексов, то это внесет заметное искажение
в общую картину, в результате чего мы не получим адекватных рейтингов ни по
терминальным статьям, ни по агрегирующим.

\subsubsection{Расчет стоимости кредитного портфеля}

Стоимость кредитного портфеля рассчитывается только для агрегирующих элементов
отчета.

При вычислении этой характеристики мы предполагаем, что задержка платежей
подчиняется гамма-распределению. Параметры этого распределения определяются из
значений средней задержки платежей и стандартного отклонения этой же характеристики.

Далее, перебираются все возможные задержки платежей в днях, оказывающие ощутимое влияние на результат,
и для каждой из этих задержек вычисляется вероятность и умножается на простую дневную ставку
финансирования, которая определена в конфигурации.

Просуммировав таким образом все рассчитанные значения, мы получим стоимость денежных
средств, замороженных в дебиторской задолженности, связанной с агрегирующим элементом
отчета.

\subsection{Расчет статистики}

Для расчета статистики по дебиторам необходимо запустить функцию процессинга должников.
Эта функция доступна через меню \ppymenu{Админ\rdir Разное\rdir Процессинг должников}.
Мы описывали эту процедуру в соответствующем разделе (стр.~\pageref{sec-debtrate}).

Для расчета статистики по дебиторам необходимо в опциях запуска этой функции установить
флаг \dlgflag{Собрать статистику о задержках платежей}.

\subsection{Таблица отчета}

\ppypictsc{brw-031}{Статистика по дебиторам}{0.5}

Таблица статистики по дебиторам доступна через пункт меню
\ppymenu{Отчетность\rdir Расчеты с дебиторами и кредиторами\rdir Статистика по дебиторам}.

Примерный вид таблицы изображен на рис.~\ref{pic-brw-031}.

Показатели, отображаемые в таблице, описаны выше. Заметим, что ячейки колонки \qu{Рейтинг}
выделяются цветом для того, чтобы было проще различать статьи с различными значениями рейтинга.

\subsection{Фильтр отчета}

\ppypict{dlg-135}{Фильтр по статистике дебиторов}

Фильтр таблицы статистики по дебиторам показан на рис.~\ref{pic-dlg-135}.
Далее приводится описание его управляющих элементов.

\begin{description}
	\item[\dlgcombo{Таблица статей} ]
	Таблица аналитических статей, по которым строится отчет.
	По умолчанию система устанавливает здесь таблицу покупателей из
	общих настроек системы (\ppymenu{Админ\rdir Настройки} \dlgbutton{Операции\dots}).

	\item[\dlgradioc{Сортировка} ]
	Выбор варианта сортировки элементов таблицы. Возможны следующие опции:
		\begin{itemize}
			\item По наименованию статьи
			\item По средней задержки платежа
			\item По стандартному отклонению задержки платежа
			\item По гамма-тесту
			\item По плотности платежей
			\item По периоду платежей
			\item По рейтингу
		\end{itemize}

	\item[\dlgflag{Включать итоговую строку по предприятию} ]
	Установленный флаг предписывает системе включить в отчет строку, отображающую
	итоговые статистические параметры по всему предприятию.

	Эта строка, если включается, находится в самом верху отчета и не содержит
	наименования в соответствующей колонке.

	По умолчанию флаг установлен.

	\item[\dlgflag{Включать агрегации по отношениям} ]
	Установленный флаг предписывает системе включить в отчет строки,
	отображающие агрегированные статистические по персональному отношению,
	определенному в конфигурации (\dlgcombo{Тип персонального отношения клиент-холдинг}).

	Если в статистика была собрана без установки этого типа отношения,
	то данный флаг не влияет на результат.

	В таблице на экране соответствующие строки отображаются бледно сиреневым цветом
	и сгруппированы вместе в верхней части отчета.

	По умолчанию флаг установлен.

	\item[\dlgflag{Включать агрегации по агентам} ]
	Если статистика по дебиторам собрана с включенным флагом \dlgflag{Собирать статистику по агентам},
	то установка данного флага приведет к тому, что в отчете будут отображаться %
	агрегированные значения статистических параметров по агентам.

	В таблице на экране соответствующие строки отображаются сиреневым цветом
	и сгруппированы вместе в верхней части отчета.

	По умолчанию флаг установлен.

	\item[\dlgflag{Включать терминальные статьи} ]
	Если этот флаг не установлен, то в отчет не будут включены строки, соответствующие
	собственно дебиторам (составляющим основную массу элементов отчета).

	По умолчанию флаг установлен.

\end{description}

\subsubsection{Действия в таблице отчета}

\paragraph{Аналитическая статья}\indent\keyb{F2}
Открывает диалог просмотра и редактирования выбранной аналитической статьи.

\paragraph{Персоналия}\indent\keyb{F4}
Открывает диалог просмотра и редактирования персоналии, соответствующей
статье в выбранной строке таблицы.

Эта функция работает только в том случае, если таблица статей дебиторов,
по которой построен отчет, ссылается на персоналии (в большинстве случаев это
так и есть).

\paragraph{Изменить конфигурацию и пересчитать}\indent\keyb{F8}
Эта функция позволяет изменить опции конфигурации статистики дебиторов и сразу
пересчитать значения, зависящие от них. Действие это весьма удобно на
этапе тюнинга анализа дебиторов для того, чтобы можно было точно подобрать
параметры конфигурации дабы они максимально точно отражали особенности
вашего предприятия.

\ppynote{
	Не увлекайтесь этой функцией после того, как были сформированы и
	утверждены основные параметры конфигурации, иначе постоянное изменение
	значений будет сбивать с толку сотрудников предприятия, использующих
	отчет в работе.

	Доступ к опциям конфигурации регламентируется наличием элемента
	\qu{Конфигурация статистики дебиторов} в списке доступных конфигураций,
	определенном в правах доступа пользователя или группы.
}

\paragraph{График}\indent\keyb{Ctrl-N}
Отображает на экране графическое представление отчета.
В зависимости от того, в какой колонке таблицы находится курсор возможны следующие
варианты графиков:
\begin{description}
	\item[Сигма-фактор] График отображает точки, соответствующие дебиторам, и
	расположенным таким образом, что координата X соответствует периоду платежей,
	а координата Y - сигма-фактору.

	Пример такого графика приведен на рис.~\ref{pic-plot-dstat-sigmoid-001}.
	\item[Рейтинг] График отображает точки, соответствующие дебиторам, и
	расположенные таким образом, что координата X соответствует индексу плотности
	платежей, а координата Y - индексу задержек платежей.

	Горизонтальные и вертикальные разделители на графике указывают расположение
	границ, отделяющих одно значение рейтинга от другого.

	Примеры графика, соответственно для линейной и логарифмической шкал
	приведены на рис.~\ref{pic-plot-dstat-rating} и рис.~\ref{pic-plot-dstat-rating-log}.
	\item[Средняя задержка платежей]
	\item[Отклонение задержка платежей]
	\item[Средняя просроченность платежей]
	Если текущей является одна из этих трех колонок, то на экране отображается трехмерный
	график, показывающий распределение элементов отчета по трем параметрам, соответствующим
	значениям в перечисленных колонках.
	\item[Остальные]
	Отображается экспериментальный график. Не станем комментировать его суть, поскольку
	он будет пересмотрен либо удален вовсе.
\end{description}

\paragraph{Печать}\indent\keyb{F7}
Отправляет отчет на печать либо на экспорт.

Стандартная форма отчета: DebtorStat.

\paragraph{Фильтр}\indent\keyb{Ctrl-V}
Позволяет изменить параметры фильтрации отчета.

\subsection{Конфигурация статистики дебиторов\label{sec-debtstat-cfg}}

\ppypict{dlg-136}{Конфигурация статистики дебиторов}

Конфигурация статистики дебиторов определяет ряд важных параметров, значительно
влияющих на результаты расчета величин отчета.

Обратиться к этой конфигурации можно либо через меню
\ppymenu{Админ\rdir Прочие конфигурации\rdir Конфигурация статистики дебиторов} либо
непосредственно из таблицы отчета (см. выше).

Как уже упоминалось, доступ к этой конфигурации регламентируется наличием элемента
\qu{Конфигурация статистики дебиторов} в списке доступных конфигураций,
определенном в правах доступа пользователя или группы.

Внешний вид диалога показан на рис.~\ref{pic-dlg-136}, а следующая таблица
поясняет назначение управляющих элементов конфигурации.

\begin{description}
	\item[Сигма-коэффициент плотности платежей (0.0001..10)] Определяет коэффициент,
	необходимый для расчета сигма-фактора. Подробно этот вопрос освещен на стр.~\pageref{loc-debtorstat-sigmfactor}.

	\item[Ширина ранга градации по плотности платежей (0.1..2)] Коэффициент, регулирующий ширину
	рейтинга дебитора в соответствии с плотностью платежей. Этот коэффициент применяется к
	стандартному отклонению плотности платежей по всей выборке дебиторов.
	Подробно методика вычисления рейтингов рассмотрена на стр.~\pageref{loc-debtorstat-rating}.

	\item[Ширина ранга градации по задержкам платежей (0.1..2)] Коэффициент, регулирующий ширину
	рейтинга дебитора в соответствии с факторами задержки платежей.
	Этот коэффициент применяется к стандартному отклонению фактора по всей выборке дебиторов.
	Подробно методика вычисления рейтингов рассмотрена на стр.~\pageref{loc-debtorstat-rating}.

	\item[Весовой коэффициент просроченности в рейтинге (0..1)]
	Данный коэффициент определяет соотношение между мерой разброса срока платежа
	дебитора и мерой просроченности в общем факторе задержек платежей, используемом
	для расчета соответствующего рейтинга дебитора.
	Подробно методика вычисления рейтингов рассмотрена на стр.~\pageref{loc-debtorstat-rating}.

	\item[Стоимость финансирования (\%)]
	Годовая процентная ставка, определяющая стоимость денежных ресурсов для предприятия.
	Эта величина используется для вычисления стоимости для предприятия выданных товарных кредитов.

	\item[\dlgcombo{Тип персонального отношения клиент-холдинг}]
	Если ваше предприятие ведет в базе данных учет отношений клиентов по принципу
	холдинг-филиал, то система позволяет рассчитать агрегированные характеристики
	дебиторской задолженности по холдингам в целом.

	\item[Период расчета кредитного лимита, дней] Период, на который
	рассчитывается кредитный лимит по клиенту. Это значение может быть
	переопределено частным соглашением с клиентом (см. ниже \dlgflag{Период кредитного лимита брать из соглашения}).

	\item[Поправочный коэфф кредитного лимита]
	Если это значение больше нуля, то рассчитанный на основе плотности
	платежей кредитный лимит будет умножен на заданную здесь величину.

	Например с помощью этого параметра вы можете нивелировать методику применения сигма-фактора
	установив этот коэффициент равным 2, а сигма-коэффициент (см. выше)
	в очень малое значение (допустим, 0.0001). Тогда сигма-фактор практически
	для всех дебиторов будет находится вблизи значения 0.5, а поправочный
	коэффициент доведет результат до 1.

	\item[Период для дополнительной величины лимита]
	Сервисная величина, позволяющая отображать в соглашениях с клиентами дополнительные значения
	кредитного лимита на заданное здесь количество дней.

	\item[Точность округления]
	Эта величина задает точность округления рассчитанного кредитного
	лимита. Если, скажем, вы хотите округлять результирующий лимит до
	1000 рублей, то установите в этом поле 1000. Если - до 10 копеек,
	то установите 0.1.

	\item[\dlgradioc{Направление округления}] Определяет направление
	округления рассчитанного кредитного лимита.
	\begin{description}
		\item[\dlgradioi{До ближайшего}]
		\item[\dlgradioi{В большую сторону}]
		\item[\dlgradioi{В меньшую сторону}]
	\end{description}
	\item[\dlgflag{Период кредитного лимита брать из соглашения (если определено)}]
	Если этот флаг включен и у статьи, соответствующей дебитору, есть соглашение,
	в котором прописан не нулевая отсрочка по оплате, то для расчета кредитного лимита
	используется именно это значение. В противном случае - величина, заданная параметром
	\qu{Период расчета кредитного лимита} (см. выше).

	Заметим, что речь идет о частном соглашении с клиентом. Общее соглашение в
	рассмотрение не принимается.
	\item[\dlgflag{Собирать статистику по агентам}]
	При установленном флаге система будет собирать агрегированную статистику по
	торговым агентам, связанным с документами отгрузки. Такая статистика
	позволяет проанализировать эффективность работы торговых представителей с
	клиентами.
	\item[\dlgflag{Логарифмическая шкала рейтингов}]
	Включенный флаг изменяет алгоритм расчета рейтингов. Подробности см. на стр.~\pageref{loc-debtorstat-01}.
	\item[Период сбора статистики]
	По умолчанию система собирает статистику по дебиторам за весь период ввода данных
	в базу данных. В том случае, если вы хотите изменить это правило, то введите в этом
	поле период, за который программа должна собрать данные.

	Обратим внимание на то, каким образом применяется данный период:
	\begin{itemize}
		\item При сборе статистики по временным параметрам отсрочки платежей перебираются только
		те отгрузочные документы, которые попадают в заданный период.
		\item При сборе статистики по плотности платежей перебираются все документы
		отгрузки, но учитываются только те оплаты по ним, которые попадают в заданный период.
	\end{itemize}

	В этом поле допускается ввод шаблонизированного периода (см. стр.~\pageref{sec-input-tamplatedate}).
	\item[Время последнего сбора статистики]
	Справочное поле, отображающее дату и время окончания последнего сбора статистики
	по дебиторам.
\end{description}

\chapter{Товарная отчетность\label{ch-rep-goods}}

\section{Прайс-лист}

Прайс-лист является универсальным инструментом для передачи информации о ценах на продукцию
вашего предприятия клиентам. С помощью этого отчета вы не только можете распечатать список
продукции с ценами, но распечатать ценники на отдельные наименования, а также опубликовать
прайс-лист в Интернете или экспортировать его в формате, доступном для чтения другими
программами.

\subsection{Фильтр прайс-листа}

\ppypictsc{dlg-036}{Прайс-лист}{0.4}

Заголовочный диалог этого фильтра показан на рис.~\ref{pic-dlg-036}.
Следующая таблица перечисляет все поля фильтра и их назначение.

\begin{description}
	\item[\dlgflag{Общий прайс-лист}]
	Прайс-лист может быть общим либо частным, то есть привязанным к конкретной учетной
	записи пользователя.

	Если данный флаг установлен, то вы будете работать с общим прайс-листом. В противном
	случае - с частным.

	\item[\dlgflag{Рассчитывать остатки}]
	Если этот флаг установлен, то в таблице прайс-листа будут показаны остатки
	по каждому из товаров на складе, определенном комбо-боксом \dlgcombo{Склад} (см. ниже).

	\item[\dlgcombo{Склад}]
	Склад, с которого берутся товары и цены для формирования прайс-листа. Этот комбо-бокс
	следует обязательно заполнить, в противном случае система не будет \qu{знать} с какого
	именно склада брать цены, соответственно, результат может быть непредсказуемым.

	\item[Выбор таблицы статей и статьи] Два комбо-бокса, позволяющие выбрать аналитическую
	статью, по которой будут извлекаться котировки для отображения в прайс-листе.

	\item[Дата]
	Дата, на которую сформирован последний прайс-лист по выбранному складу. Это поле нельзя
	изменять, оно заполняется автоматически при обновлении списка.

	\item[\dlgradioi{По базовым ценам}]
	Если выбрано это значение переключателя, то в таблице будут отображаться учетный
	цены, соответствующие последним лотам, относящимся к складу, выбранному в комбо-боксе
	\dlgcombo{Склад} (см. выше).

	\item[\dlgradioi{По котировкам}]
	При выборе этого варианта цены на товары будут извлекаться из товарных котировок
	вида, определенного комбо-боксом \dlgcombo{Котировка}.

	Если в фильтре задана статья, то система пытается извлечь котировки, заданные
	в привязке к этой статье.

	\item[\dlgcombo{Котировка}]
	Вид котировки, который должна использовать программа для извлечения цен
	по котировкам. Этот комбо-бокс доступен только в случае, если выбран вариант
	расчета цен по котировкам (см. выше).

	\item[\dlgflag{Показывать товары для которых нет котировок}]
	Если в комбо-боксе \dlgcombo{Котировка} указан вид котировки, то установка этого
	флага приведет к тому, что при автозаполнении прайс-листа в него попадут,
	наряду с товарами, для которых есть выбранная котировка, так же и те,
	для которых такая котировка не определена. Для этой категории товаров
	цена будет установлена по лотам.

	\item[\dlgcombo{Группа товаров}]
	Этот комбо-бокс позволяет отфильтровать только те товарные позиции,
	которые принадлежат выбранной группе.

	Кнопка \dlgbutton{Фильтр\dots} справа от этого комбо-бокса позволяет
	применить сложный товарный фильтр к отбору номенклатурных позиций.

	\item[\dlgflag{Исключить эту группу}]
	Установка данного флага приведет к том, что в таблицу прайс-листа попадут
	только те товарные позиции, которые не принадлежат выбранной в комбо-боксе
	\dlgcombo{Группа товаров} группе (это относится и к расширенному фильтру,
	поскольку он формирует временную динамическую альтернативную группу).

	\item[\dlgflag{Только то, что на складе}]
	При включении этого флага будут отобранные только те товары, которые
	присутствуют на остатке на складе, выбранном в комбо-боксе \dlgcombo{Склад}.

	\item[Подстановка товара]
	Экспериментальная опция.

	Ее основное назначение - формирование прайс-листа по классифицированным товарам.
	Например, можно получить прайс-лист по моделям обуви не перегружая список
	размерами.

	\item[Примечание]
	Произвольный текст, который будет печататься в отчете.

	\item[\dlgbutton{Дополнительно}]
	См. ниже.

\end{description}

\subsection{Диалог для выбора редко используемых параметров отбора строк прайс-листа.}

\ppypict{dlg-037}{Дополнительные опции прайс-листа}

\begin{description}
	\item[Период поступления товаров]
	Если здесь введен период, то в прайс-лист будут добавлены только те товары, которые пришли
	на склад в течение указанного периода.

	\item[\dlgcombo{Поставщик}]
	Выбор поставщика в этом комбо-боксе позволяет формировать прайс-лист только по тем товарам,
	которые приходили от него.

	\item[\dlgcombo{Склад}]
	Этот комбо-бокс дублирует аналогичный в заголовочном диалоге фильтра.

	\item[\dlgflag{Товары, которых не было до периода поступления}]
	Если этот флажок включен, то система добавит в прайс-лист исключительно те товары, которые
	никогда ранее периода, указанного выше, не поступали на выбранный склад. Это дает
	возможность, например, распечатать ценники на новые товары, не дублируя при этом уже
	существующие.

	\item[\dlgflag{Плюс то что на остатке}]
	Этот флаг является дополнением к предыдущему. Смысл его заключается в том, что
	товары, которые не удовлетворяют критерию периода поступления, но их остаток
	на текущий момент не нулевой, попадут в прайс-лист.

	\item[\dlgradioc{Фильтр по признаку товара}]

	Этот переключатель позволяет отобрать для прайс-листа товары, у которых
	установлен заданный признак.
	\begin{description}
		\item[\dlgradioi{Не использовать}] фильтрация по признаку товара отключена.
		\item[\dlgradioi{Только пассивные}] выбираются только товары, имеющие признак \dlgflag{Пассивный}.
		\item[\dlgradioi{Только обобщенные}] выбираются только обобщенные товары.
		\item[\dlgradioi{Только с ценой без налогов}] в прайс-лист попадут только товары,
		имеющие признак \dlgflag{Цена реализации без налогов}.
		\item[\dlgradioi{Только без скидки}] выбираются только товары, имеющие признак \dlgflag{Без скидки}.
	\end{description}
\end{description}

\subsection{Таблица прайс-листа}

После заполнения фильтра и нажатия на кнопку \dlgbutton{ОК}, вы увидите таблицу, содержащую
собственно прайс-лист.

Обратите внимание на то, что эта таблица имеет содержимое, которое не обязательно сразу
отвечает условиям введенного вами фильтра. Для формирования прайс-листа в полном соответствии
с заданными критериями необходимо сделать обновление, нажав клавишу \keyb{F8} или кнопку.
При этом вы получите запрос: хотите ли вы только обновить цены у существующих записей таблицы
или же полностью очистить и создать заново прайс-лист. Как правило, следует выбирать второй
вариант.

\subsection{Операции с таблицей прайс-листа}
Перечислим действия, возможные при работе с прайс-листом.

	\paragraph{Редактирование строки}\indent\keyb{Enter}
	Просмотр и изменение текущей строки прайс-листа

	\paragraph{Вставка новой строки}\indent\keyb{Insert}
	Добавление строки с новым товаром в прайс-лист

	\paragraph{Удаление строки}\indent\keyb{Delete}
	Удаление текущей строки

	\paragraph{Удаление всех строк}\indent\keyb{Ctrl-F8}
	Очистка всего прайс-листа

	\paragraph{Редактирование товара}\indent\keyb{F2}
	Позволяет просмотреть информацию о товаре, соответствующего текущей строке прайс-листа,
	и изменить ее.

	\paragraph{Добавить товар в корзину}\indent\keyb{Ctrl-F4}
	Позволяет вставить товар, соответствующий текущей строке прайс-листа в товарную корзину.

	\paragraph{Публикация прайс-листа в Интернете}\indent\keyb{F6}
	Эта функция обеспечивает передачу прайс-листа для публикации в Интернете. Необходима клиентам проекта Albatros.

	\paragraph{Экспорт прайс-листа}\indent\keyb{Ctrl-L}
	Формирует файл в формате SYLK для просмотра в системе Microsoft Excel.

	\paragraph{Печать}\indent\keyb{F7}
	Печатает собственно прайс-лист, ценники, либо информацию о сертификатах на товары,
	содержащиеся в прайс-листе.

	\paragraph{Обновление прайс-листа}\indent\keyb{F8}
	Переформирует прайс-лист. Подробно эта функция была рассмотрена выше.

\subsection{Конфигурация прайс-листа}

\ppypictsc{dlg-038}{Конфигурация прайс-листа}{0.4}

Для большего удобства пользования, а также для увеличения функциональности прайс-листа,
предназначена опция конфигурирования. Для доступа к диалогу конфигурации прайс-листа
выберите пункт меню \ppymenu{Админ\rdir Прочие конфигурации\rdir Конфигурация прайс-листа}.

\begin{description}
	\item[Котировка 1 (2, 3)]
	Три комбо-боксе, позволяющие указать котировки для дополнительных цен прайс-листа.
	Если какие-либо из этих комбо-боксов заполнены, то при формировании прайс-листа
	дополнительные цены для каждого товара будут соответствовать выбранным котировкам.

	\item[\dlgcombo{Группа товаров}]
	Не используется.

	\item[\dlgflag{Исключить эту группу}]

	\item[\dlgcombo{Склад}]

	\item[Дополнительное поле для подстановки в примечание]
	Здесь вы можете выбрать одно из дополнительных текстовых полей товара, содержанием
	которого будут заполняться примечания строк прайс-листа.

	\item[\dlgflag{Только то, что на складе}]
	Не используется.

	\item[\dlgflag{Отправлять в XML формате}]
	Системный признак. Если вы пользуетесь проектом Albatros, то должен быть всегда включен.

	\item[\dlgflag{Не выводить предупреждение при удаление строк}]

	\item[Наименование организации]
	То наименование вашего предприятия, которое будет передаваться для публикации на сайте Albatros.

	\item[Вид деятельности]
	Описание вида деятельности, которое будет передаваться для публикации на сайте Albatros.

	\item[Электронный адрес]
	Адрес eMail, используемый для приема заказов через сайт Albatros.

	\item[Спецификация экспорта]
	Описание спецификации экспортируемого файла прайс-листа в формате SYLK. См. ниже
	Если конфигурация не предусматривает использование емкости упаковки, то поля
	\qu{Емкость упаковки} и \qu{Цена упаковки} пропускаются.

\end{description}

Описание спецификации экспорта имеет следующую структуру:
\newline $export-spec$ ::= $field-item$[; $field-item$]
\newline $field-item$ ::= $field-name$[, $field-title$][, $field-width$]
\newline $field-name$ - одно из ключевых слов:

\begin{description}
	\item[$goodsname$] Наименование товара.
	\item[$barcode$] Штрихкод товара.
	\item[$unit$] Наименование единицы измерения товара.
	\item[$pack$] Емкость упаковки.
	\item[$price$] Цена за одну единицу товара.
	\item[$packprice$] Цена за одну упаковку товара.
	\item[$memo$] Примечание.
	\item[$field-title$] Наименование столбца.
	\item[$field-width$] Ширина столбца.
\end{description}

\ppyexample{
	\qu{goodsname;memo,Технические характеристики,80;price,Цена}

	Таблица, экспортируемая в соответствии с этой спецификацией, будет иметь три столбца:
	\begin{itemize}
		\item Наименование товара
		\item Технические характеристики
		\item Цена
	\end{itemize}

	Столбец \qu{Технические характеристики} будет иметь ширину 80 точек, ширины
	остальных столбцов определяются по умолчанию, равно как и заголовок первого столбца.
}

Если спецификация экспорта явно не указана, то используется спецификация по умолчанию,
которая выглядит следующим образом:

"goodsname,Наименование товара;barcode,Штрихкод;unit,Единица;pack,Емкость упаковки;price,
Цена единицы;packprice,Цена упаковки;memo,Примечание".

\ppynote{
	Кроме описанных параметров на форму прайс-листа влияет установка флага
	\dlgflag{Использовать параметры упаковки} в конфигурации пользователя системы
	\ppybrand{} (\ppymenu{Админ\rdir Группы и пользователи}\rdir \dlgbutton{Конфигурация}).
	Если вы используете параметры упаковки, то в прайс-листе всегда будет две
	дополнительные колонки: \qu{Емкость упаковки} и \qu{Цена за упаковку}.
}

\section{Лоты\label{sec-ppview-lots}}

Отчетность по лотам является весьма мощным средством просмотра и анализа информации о
товарах. Она позволяет выбрать и проанализировать данные по любой партии товаров,
когда-либо  поступавшей на предприятие.

\ppypict{dlg-f-lot}{Фильтр по лотам}

При обращении к пункту меню \ppymenu{Отчетность\rdir Лоты} открывается фильтр по лотам
(рис.\ref{pic-dlg-f-lot}). В фильтре задаются следующие условия выбора информации:

\begin{description}
	\item[Период]
	Период, в течение которого лоты поступили на склад.

	Обратим внимание на то, что имеется в виду период, в который попадает
	именно дата самого лота.

	Не путайте это значение с датой оригинального лота, то есть того, который
	поступил на предприятие из-вне и является предшественником порожденного лота.

	Если для вас важно получить список лотов именно по периоду оригинальных
	лотов, то установите флаг \dlgflag{Учитывать дату родительского лота}
	(см. ниже в этой таблице).

	\item[Операционный период]
	Если этот период не пустой, то система рассчитывает остатки и изменение остатков
	по каждому лоту за этот период. Если одновременно с указанием операционного периоды,
	выключите флаг \dlgflag{Пропускать лоты без операций в опер периоде}, то будут показаны только
	те лоты, по которым в течении операционного периода была по крайней мере одна операция.

	\item[\dlgradioc{Вид лотов}]
	Если выбрано \dlgradioi{Открытые}, то будут показаны только те лоты, которые имеют ненулевой текущий
	остаток. Выбрав \dlgradioi{Закрытые}, вы сможете видеть только те лоты, текущий остаток которых
	равен нулю. И, наконец, \dlgradioi{Все} означает, что вы хотите видеть все лоты в независимости от
	того, есть у этих лотов текущий остаток или нет.

	\item[\dlgcombo{Склад}]
	Если в этом комбо-боксе указан конкретный склад, то выборка будет содержать только те
	лоты, которые относятся к этому складу.

	\item[\dlgcombo{Поставщик}]
	Выбрав в этом комбо-боксе поставщика, вы можете получить лоты, поступившие только от
	этого поставщика.

	Если здесь выбрана статья, соответствующая персоналии, на которую ссылаются другие
	персоналии через отношение, имеющие признак \dlgflag{Группирующее}, то будут показаны лоты
	по всем этим персоналиям (точнее, аналитическим статьям, отвечающим этим персоналиям).

	\item[\dlgcombo{Группа товара}]
	Этот комбо-бокс позволяет задать группу товаров, лоты по которым необходимо получить.
	Если вы указали группу товара, и не указали конкретный товар, то такая выборка может
	занять довольно продолжительное время.

	\item[\dlgcombo{Товар}]
	Если этот комбо-бокс не пуст, то выборка будет содержать только лоты по заданному
	товару.

	\item[\dlgflag{Без сертификатов}]
	Изредка бывает необходимо получить выборку лотов, которые не имеют сертификатов.
	Этот флажок позволяет получить такую выборку.

	\item[\dlgflag{Цена поступления выше цены реализации}]
	Может понадобиться в тех редких случаях, когда необходимо извлечь лоты, по которым
	цена поступления превышает цену реализации.

	\item[\dlgflag{Без ГТД}]
	Позволяет получить выборку лотов, не имеющих прикрепленного номера ГТД. При реализации
	этой выборки система проверяет страну происхождения товара и, если страной происхождения
	является Россия, и номера ГТД нет, то такой лот все равно не попадает в выборку.

	Принцип определения страны происхождения товара см. на стр.~\pageref{loc-goodsattr-manuf}.

	\item[\dlgflag{Мертвые лоты}]
	Показывает только те лоты, по которым не было никаких операций, кроме собственно
	прихода.
	\ppynote{
		При установке этого флага постарайтесь сузить область поиска - то есть указать несколько
		других критериев в фильтре, поскольку поиск \qu{мертвых} лотов весьма сложная, и,
		соответственно, медленная операция.
	}

	\item[\dlgflag{Без срока годности}]
	Если этот флаг включен, то будут показаны только те лоты, у которых не установлен срок
	годности.

	\item[\dlgflag{Только брак}]
	Этот флаг связан с технологией учета бракованных серийных номеров. При установке этого
	флага будут показаны только те лоты, которые имеют серийные номера, включенные в список
	забракованных.

	\item[\dlgflag{Показывать серийные номера}]
	При установке этого флага в таблице появится колонка с серийными номерами лотов.
	Обратите внимание на то, что в этом случае системе требуется больше времени на вывод
	данных на экран.

	\item[\dlgflag{Пропускать лоты без операций в операционном периоде}]
	Этот флаг действует только в том случае, если в фильтре указан операционный период.
	Система не будет показывать лоты, по которым в течение операционного периода не было
	ни одной операции.

	\item[\dlgflag{Пропускать лоты, закрытые до операционного периода}]
	Этот флаг действует только в том случае, если в фильтре указан операционный период с
	заданной нижней границей. Система не будет показывать лоты, которые были закрыты до
	даты начала операционного периода.

	\item[\dlgflag{Учитывать дату родительского лота}]
	Если этот флаг установлен, то поле периода в этом фильтре трактуется как период
	поступления лотов на предприятие (то есть, если лот был сформирован в результате
	межскладского перемещения, то его датой считается дата поступления самого первого
	из лотов, порождающих этот). Благодаря этой опции, вы можете, например, увидеть
	открытые лоты, которые поступили на предприятие в определенный период (залежавшийся
	товар).

	Установка этого флага приводит к тому, что в колонке \qu{Дата} таблицы просмотра
	показывается дата прихода оригинального лота.
	\ppynote{
		При установленном флаге расчет отчета замедляется.
	}

	\item[\dlgflag{Суммовые остатки по оплатам за операционный период}]
	Специализированный флаг, позволяющий увидеть входящий и исходящий остаток (на операционный период)
	по лотам, не оплаченный поставщикам.

	\item[\dlgflag{Только с флагом 'Цены без налогов'}]
	Специализированных флаг, позволяющий отобразить только те лоты, для которых установлен флаг
	\dlgflag{Цены без налогов}. Опция бывает полезна при выявлении лотов, для которых ошибочно был
	выставлен упомянутый флаг.

	\item[\dlgbutton{Дополнительно}]
	При нажатии на эту кнопку выводится диалог дополнительных параметров фильтрации, описанный ниже.

	\item[\dlgbutton{Теги}]
	Открывает диалог установки критериев ограничения выборки по тегам лотов.

	Подробно о редактировании фильтров тегов рассказано на стр.~\pageref{sec-tagv-filt}.

\end{description}

Кнопка  \dlgbutton{Дополнительно} позволяет указать дополнительные, сравнительно редко
используемые, критерии отбора лотов.

\ppypict{dlg-f-lot-ext}{Расширение фильтра по лотам}

Вид диалога, в котором указываются эти параметры, приведен на рис.~\ref{pic-dlg-f-lot-ext}.

\begin{description}
	\item[Диапазон цен поступления]
	В этом поле можно указать диапазон, значений, в которые должны попадать цены поступления
	выбранных лотов. Такая возможность бывает очень полезна в том случае, когда вы ищете лоты,
	о которых известно только то, что их цены поступления равны какому-то значению или
	находятся в некотором диапазоне.

	\item[Диапазон цен реализации]
	Это поле аналогично предыдущему с той лишь разницей, что поиск будет идти по ценам
	реализации.

	\item[Период срока годности товара]
	Здесь можно указать период, в который должен попадать срок годности товара, поступившего
	с выбранными лотами.

	\item[Период истечения срока сертификатов]
	Здесь можно указать период, в который должен попадать срок истечения действия сертификата,
	связанного с лотом.

	\item[Серийный номер лота]
	В этом поле вы можете указать серийный номер. При этом система будет искать лоты, имеющие
	такой серийный номер.

	Если в начале строки вы укажете символ звездочки (*), то будут выведены все лоты, которые
	в серийном номере содержат строку, следующую за звездочкой.

	\item[Входящая налоговая группа]
	Позволяет отфильтровать список лотов по налоговой группе, с которой ассоциированы лоты.

	\item[\dlgflag{Показывать изменения цен}]
	Если вы включите этот флаг, то система будет по каждому лоту, выводимому в отчете,
	определять признак изменения цены по сравнению с предыдущим лотом этого же товара по
	тому же складу.

	Данный признак очень эффективен для идентификации фактов изменения цен с целью
	оперативного реагирования на это (вовремя распечатать новые ценники, обновить
	прайс-листы, выявить недобросовестное поведение поставщиков и т.д.).

	Факты изменения цен по лотам отображаются следующим образом:
	\begin{itemize}
		\item Если уменьшилась цена поступления, то в ячейке, соответствующей
		цене поступления, левый верхний угол будет окрашен в \emph{красный} цвет.
		\item Если увеличилась цена поступления, то в ячейке, соответствующей
		цене поступления, левый верхний угол будет окрашен в \emph{зеленый} цвет.
		\item Если уменьшилась цена реализации, то в ячейке, соответствующей
		цене реализации, левый верхний угол будет окрашен в \emph{красный} цвет.
		\item Если увеличилась цена реализации, то в ячейке, соответствующей
		цене реализации, левый верхний угол будет окрашен в \emph{зеленый} цвет.
		\item Если товар, соответствующий лоту поступил на данный склад первый
		раз с этим лотом, то левый верхний угол ячейки, соответствующей
		поступившему количеству, будет окрашен в \emph{синий} цвет.
	\end{itemize}

	Обратим внимание на то, что при установке рассматриваемого флага системе
	потребуется больше времени для формирования отчета, по этому, при его
	использовании рекомендуется ограничивать выборку лотов с помощью остальных
	параметров фильтрации (период поступления, товарная группа и т.д.)

	\item[\dlgradioc{По ценам поступления} и \dlgradioc{По ценам реализации}]
	Эти блоки радио-кнопок позволяют расширить функциональные возможности
	флага \dlgflag{Показывать изменения цен}, рассмотренного выше.
	С помощью переключателей вы можете ограничить выборку лотов в зависимости
	от того, каким образом изменились их цены в сравнении с предыдущими лотами
	по этим же товару и складу.
	\begin{description}
		\item[\dlgradioi{Все равно}] Выборка не ограничивается по признаку
		изменения выбранной цены.
		\item[\dlgradioi{Цена уменьшилась}] В выборку попадут только те лоты,
		цена которых уменьшилась.
		\item[\dlgradioi{Цена увеличилась}] В выборку попадут только те лоты,
		цена которых увеличилась.
		\item[\dlgradioi{Только изменения}] Выборка будет содержать только
		те лоты, по которым было какое-либо изменение выбранной цены.
	\end{description}

	\item[\dlgradioc{Вариант отображения}]
	Блок радио-кнопок, позволяющий выбрать специальный режим отображения таблицы лотов. Возможны
	следующие опции:
	\begin{description}
		\item[\dlgradioi{Стандарт}]
		Стандартный вариант отображения при котором выводится набор столбцов, подходящий
		для большинства случаев.
		\item[\dlgradioi{Теги ЕГАИС}] При этом варианте, кроме стандартных колонок, отображаются
		теги лотов, специфичные для работы с системой ЕГАИС.
		\item[\dlgradioi{Теги ВЕТИС}] При выборе этой опции, отображаются теги лотов, специфичные
		для работы с российской государственной системой ВЕТИС (Меркурий).
	\end{description}
\end{description}

\subsection{Цветовое выделение элементов таблицы}

\begin{itemize}
	\item Если лот является первым по этому товару на этом складе, то левый верхний угол ячейки "`Пришло"' окрашивается в синий цвет.
	\item Если цена поступления или реализации лота выше, чем у предыдущего, то левый верхний угол соответствующей ячейки с ценой окрашивается в зелёный цвет.
	\item Если цена поступления или реализации лота ниже, чем у предыдущего, то левый верхний угол соответствующей ячейки с ценой окрашивается в красный цвет.
\end{itemize}

\subsection{Таблица просмотра лотов}

\ppypictsc{brw-013}{Лоты}{0.4}

В таблице просмотра отображается  перечень выбранных лотов с начальными и текущими остатками
товаров и соответствующими этим товарам ценами.

Если в фильтре задан операционный период, то в таблице отображаются начальный и конечный
остаток для этого периода.

\subsubsection{Действия в таблице лотов}

\paragraph{Просмотр операций по лоту}\indent\keyb{Enter}

В таблице лотов по любому лоту можно увидеть операции, произошедшие с ним с момента прихода.
Для этого, сделав требуемый лот текущим, необходимо нажать клавишу \keyb{Enter} или \keyb{F3}.
Кроме того, этого же результата можно достичь, дважды щелкнув мышью над выбранным лотом.

\ppypict{brw-lotops}{Пример таблицы просмотра операций по лоту}

Операции по лоту отображаются в таблице, содержащей следующие колонки:

\begin{itemize}
	\item Дата операции.
	\item Номер документа, по которому эта операция совершена.
	\item Количество товара, участвующего в операции.
	\item Остаток товара после операции.
	\item Цена поступления товара.
	\item Цена реализации товара.
\end{itemize}

Если лот образован в результате межскладского расходования товара, то, нажав клавишу
\keyb{Enter} на этом лоте, можно перейти к операциям по лоту на складе-получателе.

Аналогично, если лот был создан межскладской операцией, то, нажав \keyb{Enter}, находясь
на первой операции по этому лоту, можно перейти к операциям по тому лоту на складе-
отправителе, из которого был сделан межскладской расход, образовавший этот лот.

\paragraph{Товар}\indent\keyb{F2}

Открывает диалог редактирования товара, к которому относится текущий лот в таблице.

\paragraph{Структура лота}\indent\keyb{Пробел}

Эта функция показывает состав лота. Действие доступно только для тех лотов,
которые были сформированы документом модификации товара.

\paragraph{Порожденные лоты}\indent\keyb{F3}

Открывает таблицу просмотра лотов, порожденных от того лота, который
является текущим.

Напомним, что порожденные лоты - это те, которые были созданы в результате
перемещения товаров из данного лота на другие склады документами
внутреннего перемещения.

\paragraph{Системная информация по лоту}\indent\keyb{Ctrl-F3}

При вызове этой функции открывается диалог просмотра разнообразных (в том числе
внутрисистемных) параметров выбранного лота.

\ppynote{
	Этот диалог не позволяет изменять демонстрируемые показатели.
}

Функция может быть полезна для диагностики проблем и получения подробной
информации о лоте. Внутри диалога находится кнопка, позволяющая увидеть
системную информацию по документу, создавшему этот лот.

\paragraph{Перенос операций по лоту на другой лот}\indent\keyb{Ctrl-M}

Эта сервисная функция позволяет переместить расходную операцию с одного
лота на другой.

Такая необходимость может возникнуть в случае, если требуется, например, удалить лот,
по которому были сделаны операции. Для реализации этой функции в таблице операций по лоту
выберите строку, соответствующую перемещаемой операции и нажмите клавиши \keyb{Ctrl-M}.
При этом на экране появится таблица лотов, на которые можно перенести выбранную
операцию (эти лоты должны относиться к тому же товару и проходить по тому же складу, что и
лот, с которого переносится операция. Выбрав в верхней таблице нужный лот, нажмите на нем
\keyb{Enter}.

\ppynote{
	Не гарантируется, что на любой из показанных в верхней таблице лотов возможен перенос
	операции, поскольку, лот-приемник должен также удовлетворять требованию свободного
	достаточного остатка на день операции.
}

\paragraph{Просмотр и замена сертификата, срока годности и ГТД}\indent\keyb{F4}

Система позволяет назначать для любого лота сертификат качества, срок годности товара,
пришедшего с этим лотом и номер ГТД (грузовой таможенной декларации). Обычно эти данные
вводятся одновременно с вводом прихода товара. Если требуется поменять один или несколько
из этих параметров в таблице лотов, то для этого следует щелкнуть пиктограмму на панели
инструментов либо нажать клавишу \keyb{F4}. Использование поля выбора сертификатов подробно
описано в разделе \qu{Сертификаты качества}.

\paragraph{Просмотр других лотов по товару и складу}\indent\keyb{F5}

Вызывает таблицу просмотра всех лотов, которые соответствуют товару и складу, к
которым относится выбранный лот. К выводимой по данной команде таблице применены все
критерии фильтрации текущей таблицы лотов за исключение следующих:
\begin{description}
	\item[Период]
	\item[Период истечения срока годности]
	\item[Период истечения срока годности сертификата]
\end{description}

Перечисленные критерии в порожденной таблице пустые. То есть, будут показаны
лоты по одному товару и по одному складу без ограничений по периодам (естественно,
ограничения, накладываемые правами доступа соблюдаются).

\paragraph{Просмотр информации о забракованной серии}\indent\keyb{F6}

Эта функция доступна только тогда, когда лоты выбраны с опцией фильтра
\dlgflag{Только брак}. В этом случае для выбранного лота открывается диалог,
в котором показан серийный номер и импортированные из внешнего источника
наименования товаров, соответствующие этому серийному номеру.

\paragraph{Возврат товара поставщику}\indent\keyb{Ctrl-F5}

Из таблицы просмотра лотов можно проводить операции возврата товара поставщику. Для этого,
подойдя к лоту, нажмите клавиши \keyb{Ctrl-F5}. Ввод возвратных документов осуществляется
обычным образом.

\paragraph{Изменение цен}\indent\keyb{Ctrl-C}

Специализированная функция, дающая возможность изменить следующие параметры лота:

\begin{itemize}
	\item цену поступления %
	\item цену реализации
	\item поступившее количество
	\item емкость упаковки
\end{itemize}

Кроме изменения перечисленных параметров, функция позволяет полностью удалить лот.

Изменение одного или нескольких из указанных параметров происходит в штатном режиме.
То есть, система выполняет те же действия, какие выполняла бы при открытии документа,
создавшего лот и изменении строки этого документа. Следовательно, выполняются те же
самые проверки:
\begin{itemize}
	\item вы не сможете изменить количество так, что бы нарушить ограничение
	на неотрицательный остаток по лоту
	\item проверяются права доступа для выполнения операции
	\item проверяются все остальные ограничения, препятствующие нарушению
	целостности данных
\end{itemize}

\paragraph{Положить в корзину}\indent\keyb{Ctrl-F4}

Вызывает диалог вставки товара, к которому относится выбранный лот, в какую-либо
товарную корзину.

\paragraph{Поставщик}\indent\keyb{Ctrl-S}

Открывает диалог редактирования персоналии, соответствующей поставщику выбранного лота.
Обращаем внимание на то, что речь идет именно о персоналии, хотя объектом данных,
отвечающим за поставщиков является аналитическая статья. Фактически, система извлекает
аналитическую статью с идентификатором поставщика лота и, если эта статья связана
с персоналией, то вызывает диалог редактирования этой персоналии.

\paragraph{Печать выборки лотов}\indent\keyb{F7}

Выбор режима печати осуществляется, как обычно, щелчком по пиктограмме или нажатием клавиши
\keyb{F7}. При этом появляется диалог, в котором можно уточнить особенности печати лотов:
порядок сортировки и возможность вывода количества товара в формате с упаковками. Затем вы
увидите стандартный диалог назначения установок печати.

\paragraph{Получение итога по выборке}\indent\keyb{F9}

\ppypict{dlg-lot-total-w}{Итог по лотам}

Для того чтобы получить итоговую информацию по выборке следует нажать клавишу \keyb{F9}.
При этом  активизируется диалог \qu{Итог по лотам} (рис.~\ref{pic-dlg-lot-total-w}).
В диалоге перечисляется:
\begin{itemize}
	\item общее количество выбранных лотов;
	\item количество поступивших  и оставшихся лотов;
	\item суммарная стоимость товара в ценах поступления и в ценах реализации.
\end{itemize}

Кнопка \dlgbutton{Расширенный итог} открывает диалог, содержащий расширенную итоговую информацию
по выборке.

\paragraph{Проверка и восстановление лотов}\indent\keyb{Ctrl-R}
Вызывает функцию корректировки лотов, описанную ниже.

\paragraph{Экспорт}\indent\keyb{F8}

Экспортирует выборку лотов согласно выбранной спецификации экспорта. Подробное описание
экспорта лотов см. стр.~\pageref{sec-impexp-lot}.

\paragraph{Экспорт данных для печати ценников}\indent\keyb{Ctrl-F8}

В ряде случаев требуется обработать полученную информацию другими программными средствами.
Для экспорта данных используется комбинация клавиш \keyb{Ctrl-L}. Экспорт осуществляется в
файл с именем glabel.dbf в формате DBF и содержит поля с наименованием товара, его ценой,
производителем и прочими параметрами. Путь к файлу определяется настройкой пути исходящих
файлов (см. раздел посвященный конфигурации системы).

\ppynote{
	Как правило, эта команда используется  для печати ценников другими  программными продуктами.
}

\paragraph{Фильтр}\indent\keyb{Ctrl-V}
Позволяет изменить фильтр просмотра лотов.

\subsubsection{Корректировка лотов}

Функция корректировки лотов позволяет проверить целостность товарного учета на уровне лотов и
операций по лотам. Кроме того, эта функция способна откорректировать многие сбойные ситуации, которые
могут встретиться при проверке.

\ppypict{dlg-039}{Корректировка лотов}

Диалог параметров корректировки лотов, предшествующий запуску функции, показан на рис.~\ref{pic-dlg-039}.
Этот диалог содержит следующие управляющие элементы:
\begin{description}
	\item[LOG-файл]
	Имя файла, в котором будут сохранены сообщения, сформированные во время корректировки и ремонта лотов.

	\item[Вид операции компенсации отрицательных остатков]
	Если в результате каких-либо сбоев остатки по каким-либо лотам стали отрицательными, то единственный способ
	скорректировать эту проблему - обсуждаемая корректировка лотов.

	Для компенсации отрицательных текущих остатков по лотам необходимо выбрать вид операции, которому будет
	принадлежать корректирующий документ. Суть такой корректировки состоит в формировании искусственных товарных
	строк, которые увеличат текущие остатки по сбойным лотам до нуля.

	Такая корректировка возможна только если в фильтре лотов выбран конкретный склад.

	\item[\dlgflag{Исправлять ошибки}]
	Если этот флаг включен, то процедура корректировки будет исправлять большую часть найденных ошибок.

	\item[\dlgflag{Корректировать емкости упаковок}]
	\item[\dlgflag{Исправлять цены поступления}]
	\item[\dlgflag{Исправлять цены реализации}]
	\item[\dlgflag{Удалять лоты без операций}]
	\item[\dlgflag{Проверять уникальность серий}]
	\item[\dlgflag{Корректировать не уникальные серии}]
	\item[\dlgflag{Корректировать признак 'Независимый учет в физических единицах'}]
	Если опция установлена процедура корректировки будет снимать системный флаг \dlgflag{Независимый учет в физических единицах} со
	строк операций по лотам, если соответствующий товар не имеет аналогичного флага.

	Если товар имеет признак \dlgflag{Независимый учет в физических единицах}, но строка лота не имеет такого признака, то
	процедура корректировки не будет устанавливать системный флаг у такой строки, хотя соответствующее замечание выводится в журнал
	восстановления. Связано это с тем, что последствия такой установки могут быть достаточно сложными.

	Данная опция работает только при включенном флаге dlgflag{Исправлять ошибки} (см. выше).
	\item[\dlgflag{Корректировать признак 'Цены реализации без налогов'}]
	\item[\dlgflag{Переносить ЕГАИС-код в товар}]
	\item[\dlgflag{Переносить ЕГАИС-код из товара в лот}]
\end{description}

\section{Остатки товаров}

Остатки товаров является одним из наиболее популярных отчетов, и используется практически
ежедневно. Он дает как количественные, так и суммовые параметры состояния товарных складов
и магазинов предприятия, кроме того, позволяет проанализировать некоторые ракурсы состояния
клиентских заказов. Для доступа к этому отчету обратитесь к пункту меню
\ppymenu{Отчетность\rdir Остатки товаров}.

\subsection{Некоторые подробности}

Имея в виду то, что рассматриваемый отчет очень часто применяется и не только прямо, но
и вовлекается в расчет иных отчетов, рассмотрим несколько аспектов его расчета.

\subsubsection{Техника расчета}

Остатки по товарам рассчитываются на основе лотов. То есть для каждого
товара система просматривает список лотов, влияющих на состояние остатков этого
товара на заданную дату и комбинирует значения этих лотов чтобы получить
требуемые итоговые значения для товара.

Говоря \qu{комбинирует} мы подразумеваем то, что с разными величинами программа
поступает по разному. Значения остатков, естественно, складываются. Значения цен
либо усредняются, либо учитывается только первое или последнее значение (это зависит
от условий расчета заданных фильтром).

\subsubsection{Алгоритмы расчета}

Учитывая высокие требования по надежности и скорости к данному отчету,
система \ppybrand{} реализует три алгоритма для вычисления остатков товаров.
В каждом случае конкретный алгоритм выбирается автоматически с учетом условий
фильтрации и конфигурации. Для правильной настройки системы мы считаем необходимым
кратко описать каждый из алгоритмов и привести условия его применения.

\paragraph{Итерация по товарам}

Этот алгоритм перебирает каждую номенклатурную позицию из выборки товаров, заданной
в фильтре, с вычислением параметров количественных и суммовых остатков.

Данный вариант применяется только для небольших выборок товаров, поскольку
именно в этом случае дает выигрыш во времени расчета. Если количество товаров в выборке
превышает некоторый порог, то время расчета значительно падает.

Порог применения этого алгоритма устанавливается в системных параметрах
общих настроек системы (см. стр.~\pageref{sec-commcfg-sys}).

\paragraph{Итерация по лотам}

Когда количество товаров в выборке, по которой необходимо рассчитать остатки,
сопоставимо с размером всего справочника, тогда применяется алгоритм итерации
по лотам. В этом случае система просматривает все лоты, которые могут повлиять на
состояние остатка на заданную дату (или текущего, если дата в фильтре не установлена)
и суммирует результат, группируя его по товарам.

\paragraph{Итерация по текущим остаткам лотов}

Это - новый алгоритм, применяемый лишь для расчетов остатков на заданную дату,
когда размер выборки соответствует применению алгоритма итерации по лотам.

Мотивом для использования этого варианта являются следующие соображения:
при длительной работе предприятия с одной базой данных накапливается значительное
количество лотов. Для расчета остатков на заданную дату серверу базы данных
приходится просматривать для отбора практически все лоты, предшествующие дате
расчета. Это не только может занять много времени, но и приводит к существенной
нагрузке на сервер.

Решением озвученной проблемы является индексация текущих остатков по лотам.
В результате создается таблица, в которой система поддерживает актуальные остатки
по каждому лоту на каждую дату \qu{жизненного цикла} лота (то есть за период от
создания до закрытия).

\subsubsection{Фильтрация по поставщику}

Отчет по остаткам товаров имеет двойственную фильтрацию по поставщику:
\begin{itemize}
	\item С одной стороны, собственный фильтр имеет атрибут \qu{Поставщик}.
	\item С другой стороны, остатки могут быть рассчитаны по сложному товарному фильтру,
	который включает в себя, наряду с другими атрибутами и поле \qu{Поставщик}.
\end{itemize}

Важно понимать, что эти два критерия не взаимозаменяемые. То есть, выбор поставщика в
самом фильтре отчета и выбор поставщика в привязанном к отчету фильтре по товарам не
приводят к одинаковым результатам.

В первом случае система покажет остатки с учетом только тех лотов, которые \emph{поступили}
от заданного поставщика, во втором случае будут показаны остатки тех товаров, которые
\emph{когда-либо} приходили от этого поставщика, но с учетом лотов, которые поступали
и от иных поставщиков.

Если вы установите одного и того же поставщика в обеих точках фильтра, то
результат будет такой же, как если бы вы установили его только в заголовочной
части фильтра.

Если вы установите разных поставщиков в обсуждаемых полях, то получите остатки
товаров, которые когда-либо приходили от поставщика А но только с учетом лотов,
поступивших от поставщика Б. Скорее всего, эта выборка будет очень маленькая (может
быть и вовсе пустой).

%topic(DLG_GOODSREST)

\subsection{Фильтр остатков товаров}

\ppypictsc{dlg-040}{Диалог редактирования фильтра остатков товаров}{0.5}

Фильтр по остаткам товаров (рис.~\ref{pic-dlg-040}) имеет следующие поля:

\begin{description}
	\item[Дата]
	Указав в этом поле дату, вы получите отчет об остатках товаров, которые существовали на
	конец заданного дня.

	Если вы оставите это поле пустым, система включит в отчет текущие остатки товаров. В этом
	случае расчет осуществляется значительно быстрее, чем тогда, когда задана конкретная дата.

	Внимание! Текущие остатки рассчитываются по последней проведенной операции. Здесь можно
	допустить такую ошибку: если вы провели вперед некоторую операцию N, и, забыв об этом,
	просите систему вывести текущие остатки, то они будут рассчитаны с учетом тех товаров,
	которые были включены в операцию N.

	\item[\dlgcombo{Склад}]
	Если в этом поле выбрать конкретный склад, то остатки будут рассчитаны только по этому
	складу, в противном случае система рассчитает и покажет суммарные остатки по всем
	складам предприятия.

	\dlgbutton{\dots} справа от этого комбо-бокса позволяет выбрать список
	складов, по которым строится отчет.

	\item[\dlgflag{Раздельно по каждому складу}]
	Позволяет получить единый отчет об остатках на каждом из складов.

	Если выбран список складов, то отчет, естественно, будет ограничен только
	этими складами.

	В этом случае таблица будет содержать дополнительную колонку \qu{Склад}.

	Форма печати такого отчета - кросс-табулированная: данные по каждому
	складу располагаются в отдельных колонках.

	\item[\dlgflag{Кросстаб}]
	Этот флаг доступен только в том случае, если установлена опция \dlgflag{Раздельно по каждому складу}
	(см.выше). При включении флага на экран будет выведена кросстабулированная таблица, колонки
	в которой соответствуют складам, а ячейки на пересечениях товаров и складов отображают
	остаток в торговых единицах.

	\item[\dlgcombo{Поставщик}]
	Вы можете выбрать в этом комбо-боксе конкретного поставщика, тогда система
	покажет остатки товаров, поступивших только от этого поставщика.

	\item[\dlgcombo{Товарная группа}]
	Этот комбо-бокс позволяет ограничить отчет только одной группой товаров. Здесь может
	быть выбрана как обычная, так и альтернативная группа.

	\dlgbutton{Фильтр\dots} справа от этого комбо-бокса позволяет определить
	фильтр по товарам, которые должны участвовать в расчете.

	\item[\dlgcombo{Брэнд}]
	Выбор брэнда ограничивает отчет только теми номенклатурными позициями,
	которые имеют соответствующее значение брэнда.

	Этот критерий фильтрации может вступать в конфликт с аналогичным
	параметром в расширенном фильтре товаров, по которым строиться отчет.
	То есть, если вы здесь укажете один брэнд, а в товарном фильтре - другой,
	то отчет не будет содержать ни одного элемента поскольку будут проверены
	оба критерия, но ни одна товарная позиция не может принадлежать
	одновременно двум брэндам.

	\item[\dlgradioc{Расчет цен}]
	В связи с тем, что часто товары одного наименования имеют разные цены поступления и
	реализации, и какую из них проставлять в отчет системе безразлично, вам следует выбрать
	конкретный способ расчета цен. При помощи переключателей выберите один из трех вариантов:
	\begin{description}
		\item[\dlgradioi{по среднему}] в этом случае высчитывается средняя цена по всем лотам
		товаров одного наименования. Этот вариант наиболее распространенный, поскольку
		итоговая сумма остатков оказывается точной.
		\item[\dlgradioi{по первому лоту}] используется цена первого лота с ненулевым
		на заданную дату остатком.
		\item[\dlgradioi{по последнему лоту}] используется цена последнего (на день,
		определенный полем \qu{Дата}) ненулевого лота.
	\end{description}

	\item[Группа флагов \qu{Разбить}]
	Обычно в этом отчете система сливает вместе все открытые на заданную дату лоты одного
	товара в одну строку отчета. В том случае, когда вы хотите видеть остатки одного товара
	в разбивку по ценам поступления, реализации или емкости упаковки, то выберите
	соответствующие позицию в этой группе флажков.

	Флаг разбивки \dlgflag{По серийным номерам} детализирует отчет по лотам, имеющим серийные
	номера. При этом в таблице будет отображаться дополнительная колонка, в которой выводятся значения серий,
	ассоциированных с каждой строкой отчета.

	\item[\dlgflag{Нулевые остатки}]
	Если включить этот флажок, то наряду с товарами, которые есть на складе (в организации),
	будут выданы те товары, которых не осталось (или даже вообще не было на заданном складе).

	При установленном флажке \dlgflag{Нулевые остатки} не будут показаны товары,
	имеющие признак \dlgflag{Пассивный}, если их остаток нулевой.

	\item[\dlgflag{Только нулевые остатки}]
	При установке этого флажка, в отчете будут показаны только те товары, остатки по которым
	равны нулю.

	\item[\dlgflag{Только с ненулевыми заказами}]
	Показывает в отчете только те товарные позиции, по которым есть незакрытые клиентские
	заказы.

	Этот флаг будет иметь силу только в случае, если включен флаг
	\dlgflag{Рассчитывать заказы} (см. ниже).

	\item[\dlgflag{Рассчитывать заказы}]
	Этот флажок позволяет получить отчет, в котором наряду с остатками товаров, будет
	показано заказанное количество каждого из товаров.

	\item[\dlgflag{Показывать штрихкоды}]
	В отчете будет показана колонка, содержащая штрихкод каждого товара.

	Обратим внимание на то, что при наличии у товара нескольких штрихкодов будет
	показан только один из них. Подробнее об этом см. стр.\pageref{sec-barcodelist}.

	\item[\dlgflag{Цены на товары без НДС}]
	Этот флажок может быть полезен бухгалтерам для анализа товарных остатков без НДС.
	При включенном флажке все цены и их суммы приводятся за вычетом налога на добавленную
	стоимость. Система корректно обрабатывает ситуации, когда товар приходил от поставщиков,
	освобожденных от НДС.

	\item[\dlgflag{Рассчитывать суммы НДС}]
	Опция заставляет систему рассчитывать суммы НДС по строкам отчета. При установке флага
	рассчитываются одновременно и суммы НДС в ценах реализации (к уплате) и в ценах поступления (к зачету).

	Если права доступа ограничивают возможность видеть цены поступления, то НДС в ценах поступления не
	считается.

	Включение флага приводит к появлению в таблице просмотра остатков двух дополнительных столбцов
	с рассчитанными величинами. Кроме того, в итогах показываются валовые значения сумм НДС.

	\item[\dlgflag{Ниже минимального остатка}]
	Если установить этот флажок, то в отчете будут показаны только те позиции, остаток по
	которым меньше минимального остатка, заданного для каждого из товаров. Если для товара
	минимальный остаток не задан, то такой товар в отчет не войдет. Подробности относительно
	установки минимального остатка смотрите в разделе, посвященном справочнику товаров.

	\item[\dlgflag{Остаток показывать без упаковок}]
	Установив этот флаг, вы предписываете программе показывать остатки без упаковок, даже
	если в базе данных указан признак \dlgflag{Использовать емкости упаковок}.

	\item[\dlgflag{Показывать минимальные остатки}]
	Включение опции приведет к тому, что в таблице просмотра остатков будет показана
	колонка со значениями минимальных остатков, заданными для каждого из товаров.
	Минимальный остаток устанавливается в диалоге товара.

	\item[\dlgflag{Показывать с учетом будущих драфт-приходов}]
	Если этот флаг включен, то одновременно с расчетом остатков система будет рассчитывать
	количество, заказанное поставщику посредством анализа документов драфт-приходов, относящихся к
	виду операции, заданной в общих настройках (см. стр.~\pageref{sec-commcfg-op}).

	Период драфт-документов, которые принимаются в расчет может быть задан в поле \qu{Период расчета будущих драфт-приходов}.
	Если этот период не задан, то программа рассматривает все документы с датой большей или равной текущей операционной дате.

	\item[\dlgflag{Ограничивать товарной матрицей}]
	Этот флаг предписывает системе строить отчет только по тем товарам, которые
	принадлежать товарной матрице по выбранному в этом фильтре складу.

	Если склад не выбран, то рассматривается матрица \qu{По всем складам}.
	Если выбран список складов, то рассматривается принадлежность товара
	матрице для каждого из складов. То есть, если какой-либо товар не принадлежит
	матрице по хотя бы одному из складов списка, то такой товар не
	включается в отчет.

	Если у текущего пользователя в конфигурации установлен признак \dlgflag{Использовать товарную матрицу}, то обсуждаемый флаг
	устанавливается автоматически (при этом остается возможность отключить его).

	\dlgflag{Отображать принадлежность товарной матрице}
	Если этот флаг установлен, то элементы таблицы отчета, которые входят
	в товарную матрицу (по комбинации товар/склад) будут выделены
	цветом (красный левый верхний угол ячейки наименования товара для обычной
	таблицы, для кросстабулированной таблицы цветом выделяются ячейки на
	пересечениях товаров и складов).

	Дополнительная особенность данного флага в применении к кросстабулированной
	таблице состоит в том, что итоговые строки и столбцы таблицы содержат
	несколько значений:
	\begin{itemize}
		\item Суммарные остатки
		\item Количество элементов, принадлежащих матрице
		\item Количество элементов, принадлежащих матрице и имеющих
		не нулевой остаток
		\item Отношение в процентах количества элементов, принадлежащих
		матрице и имеющих не нулевой остаток к количеству элементов
		просто принадлежащих матрице.

		Смысл этого отношения состоит в определении степени
		насыщения торговых точек предприятия регламентированным
		матрицей ассортиментом.
	\end{itemize}

	\item[\dlgflag{Цены по котировкам} и \dlgcombo{Вид котировки}]
	Если установлен этот флаг и в комбо-боксе указан вид котировки, то цены реализации
	товаров будут показаны в соответствии со значениями котировок этих
	товаров по выбранному виду котировки.

	Значения котировок извлекаются для каждого лота, попадающего в расчет
	остатков. При этом учитывается и склад, которому принадлежит лот.

	\item[\dlgcombo{Подстановка товара}]
	Комбо-бокс позволяет сгруппировать отчет по одному из атрибутов товаров.

	\item[\dlgbutton{Дополнительно}]
	Открывает диалог редактирования дополнительных опций фильтра:
	\begin{description}
		\item[\dlgcombo{Агент поставщика}]
		Позволяет рассчитать остатки только по тем лотам, которые
		поступили по документам, в которых указан выбранный
		здесь агент.

		\item[\dlgflag{Расчет с учетом документов дефицита}]
		Специальная опция, позволяющая скорректировать рассчитанные
		отчетом остатки на величины в драфт-документах покрытия дефицита
		по кассовым сессиям.

		\item[\dlgflag{Расчет с учетом незавершенных сессий}]
		Данная опция при расчете остатков вносит поправку на незавершенные
		кассовые сессии.

		Незавершенные кассовые сессии учитываются следующим образом:

		\begin{description}
			\item[Синхронные сессии]
			По всем кассовым узлам, которые привязаны к складам, которые
			участвуют в расчете остатков, извлекается идентификатор текущей
			сессии и количества в чеках продажи вычитаются из рассчитанных остатков,
			в то время как количества товаров в чеках возвратов прибавляются к
			остаткам.

			\item[Асинхронные сессии]
			Для асинхронных кассовых сессий поправка остатков реализуется на
			основании системного пула драфт-документов покрытия временных сессий.

			Система извлекает все такие драфт-документы и вычитает их из рассчитанных
			остатков.
		\end{description}

		\item[Дата начала расчета дефицита]
		Дата, начиная с которой следует рассчитывать дефицит
		для внесения поправки в отчет, согласно описанному выше флагу.
	\end{description}

\end{description}

%topic(BROWSER_GOODSREST)

\subsection{Таблица товарных остатков}

\ppypictsc{brw-014}{Остатки товаров}{0.4}

Типичный вид таблицы товарных остатков показан на рис.~\ref{pic-brw-014}.

Здесь видны следующие колонки:

\begin{description}
	\item[Наименование товара] Полное наименование товара
	\item[Остаток] Колонка разбита на две графы: остаток в торговых единицах
	и остаток в физических единицах. Если для товара не задано соотношение
	физических единиц к торговым, то значение остатка в физических единицах
	будет пустым.

	Если для товара ведется независимый учет в торговых и физических единицах то,
	разумеется, величины в этих двух графах не будут связаны простым отношением.
	\item[Цена] Эта колонка содержит две графы: учетная цена поступления товаров
	и учетная цена реализации товаров.

	Важно помнить, что значения в этих графах зависят от опции расчета
	цены, установленных в фильтре.

	Если пользователь не имеет прав доступа к ценам поступления, то
	колонка цены поступления будет пустой.
	\item[Сумма] Две графы, представляющие простое произведение
	колонки \qu{Остаток в торговых единицах} на соответствующую
	графу колонки \qu{Цена}.

	Если пользователь не имеет прав доступа к ценам поступления, то
	колонка суммы в ценах поступления будет пустой.
	\item[Наценка] Процент наценки, вычисленный по двум предыдущим
	графам следующим образом:

	$100 * \frac{P - C}{C}$,

	где:
	\\$C$ - сумма в ценах поступления %
	\\$P$ - сумма в ценах реализации.

\end{description}

Если отчет строился с флагом \dlgflag{Раздельно по каждому складу}, то в таблице
будет присутствовать колонка наименования склада (для каждой пары товар-склад, для которой
есть значимые результаты отчета, будет показана отдельная строка).

Если, в дополнение к этому флагу, установлен \dlgflag{Кросстаб}, то таблица
будет выглядеть по иному: первая колонка отображает наименования товаров,
верхняя строка - наименования складов, а в пересечениях будут показаны
остатки товаров на складах в торговых единицах.

\subsubsection{Действия над таблицей товарных остатков}

	\paragraph{Лоты}\indent\keyb{Enter}
	Показывает таблицу лотов по текущему товару.

	\paragraph{Заказы на товары}\indent\keyb{F3}
	Показывает таблицу заказов по текущему товару.

	\paragraph{Товар}\indent\keyb{F2}
	Позволяет просмотреть и изменить информацию по текущему товару.

	\paragraph{Положить в корзину}\indent\keyb{Space}
	Добавляет текущий товар в корзину.

	\paragraph{Добавить в корзину все товары из отчета}\indent\keyb{Ctrl-F5}
	Переносит в выбранную корзину все товары из отчета.
	\ppynote{
		Будьте внимательны с этой функцией. Если отчет очень большой,
		то операция внесения всех товаров из него в корзину может
		занять продолжительное время, к тому же работать с такой
		корзиной будет крайне затруднительно.
	}

	\paragraph{Группировка операций по товару}\indent\keyb{F5}
	Показывает отчет группировки товарных операций по выбранному товару. Предварительно
	запрашивается период, за который следует рассчитать группировку товарных операций.

	При последующих обращениях к этой функции из данной таблицы введенный период
	будет сохраняться.

	\paragraph{Прогноз}\indent\keyb{Ctrl-F9}
	Рассчитывает прогноз продаж по выбранному товару за период,
	который следует ввести в появившемся диалоге.

	Прогноз рассчитывается на основании таблицы продаж.

	\paragraph{Таблица продажи товара}\indent\keyb{Ctrl-S}
	Показывает таблицу продаж по выбранному товару.

	\paragraph{Анализ товарных операций}\indent\keyb{Ctrl-F3}
	Строит отчет анализа товарных операций по выбранному товару
	с группировкой по датам из весь период, доступный в базе данных.

	\paragraph{Установить контрактные цены}\indent\keyb{Ctrl-P}
	Специальная функция, позволяющая установить контрактные цены для поставщика,
	по которому рассчитан отчет (если поставщик не выбран, то функция не работает).

	Метод работы этой функции таков:
	перебираются все товары из отчета и для каждого из товаров и по каждому
	складу, входящему в список фильтра, устанавливается значение контрактной
	цены, равное цене поступления из отчета.

	Главное назначение функции - облегчить первоначальную установку контрактных
	цен на начальном этапе формализации ценовых договоренностей с поставщиками.

	\paragraph{Котировки}\indent\keyb{Ctrl-Q}
	Сервисная функция, позволяющая просмотреть котировки по текущему товару.

	\paragraph{Контрактные цены поставщиков}\indent\keyb{Ctrl-W}
	Вызов этой функции открывает диалог просмотра и редактирования контрактных
	цен на выбранный товар по поставщикам.

	\paragraph{Товарная матрица}\indent\keyb{Ctrl-M}
	Открывает диалог просмотра и редактирования товарной матрицы выбранного
	товара.

	\paragraph{Печать}\indent\keyb{F7}
	См. ниже

	\paragraph{Итоги}\indent\keyb{F9}
	Показывает итоговые значения таблицы остатков товаров

\subsubsection{Печать отчета}

\ppypict{dlg-goodsrest-prn}{Печать остатков товаров}

Функция печати позволяет распечатать отчет с выбором варианта отчета. Предварительно вы
увидите диалог, показанный на рис.~\ref{pic-dlg-goodsrest-prn}. В диалоге присутствуют
следующие управляющие элементы:

\begin{description}
	\item[Переключатель вида отчета] Позволяет выбрать один из следующих вариантов отчета:
		\begin{description}
			\item[\dlgradioi{В ценах поступления и реализации}]
			Результирующий отчет будет содержать цены поступления и реализации товаров, а также их
			суммы.
			\item[\dlgradioi{В ценах поступления}]
			Результирующий отчет будет содержать только цены поступления товаров и суммы в ценах
			поступления.
			\item[\dlgradioi{В ценах реализации}]
			Результирующий отчет будет содержать только цены реализации товаров и суммы в ценах
			реализации.
			\item[\dlgradioi{Инвентарная ведомость}]
			Будет распечатана ведомость для проведения инвентаризации на складе. Если вы выберите
			инвентарную ведомость без остатков, то в колонке \qu{Учетный остаток} не будут
			проставляться соответствующие значения. Для более подробной информации обратитесь к
			разделу, посвященному проведению инвентаризации товаров.
			\item[\dlgradioi{Бланк учета продаж на складе}]
			Эта форма полезна при проведении регулярной инвентаризации на удаленном складе, не
			обеспеченном компьютеризованной системой учета, для последующего занесения разницы между
			учетным и фактическим остатками как продаж на удаленном складе.
			\item[\dlgradioi{Специальный отчет}]
			Этот вариант предназначен для печати заказного специализированного отчета и здесь не
			рассматривается.
		\end{description}
	\item[Переключатель сортировки отчета]
		Позволяет выбрать сортировку строк печатного отчета.

	\item[\dlgflag{Печатать штрихкоды}]
	При включенном флажке будет напечатан отчет, содержащий колонку штрихкодов.

	\item[\dlgflag{Остатки в упаковках}]
	Если этот флажок включен, то величины остатков будут печататься в формате \qu{количество
	упаковок / емкость упаковки + остаток}. Например: 5/24+1.

	\item[\dlgflag{Не группировать}]
	Подавляет группировку отчета по наименованиям групп товаров.
\end{description}

\subsubsection{Поиск в таблице товарных остатков}

Опция поиска в таблице товарных остатков несколько модифицирована по сравнению со
стандартной функцией поиска в большинстве остальных таблиц.
Если вы нажимаете комбинации клавиш  \keyb{Ctrl-F} и  \keyb{Ctrl-G}, то выполняется
стандартный поиск.

То же самое происходит, если вы нажали клавишу, соответствующую какой-либо букве или
звездочку (*).

Если же вы нажали клавишу, соответствующую цифре, то появляется окно ввода штрихкода для
поиска строки  с товаром, имеющим введенный штрихкод.

\subsubsection{Быстрый выбор товарной группы}

В панели инструментов таблицы товарных остатков представлен комбо-бокс, позволяющий
быстро переключить отчет на какую-либо товарную группу. При этом остальные параметры
фильтрации остаются неизменными.

%endtopic

\section{Анализ товарных операций\label{sec-trfranlz}}

Анализ товарных операций является одним из наиболее мощных и универсальных средств
исследования накопленных данных по движению товаров. Этот анализ строится на основе строк
товарных документов.

Благодаря множеству критериев фильтрации (в том числе, достаточно сложных) а также
группирующим и подстановочным параметрам, позволяет удовлетворить огромный слой требований по
анализу движения товаров.

\subsection{Как работает этот отчет?}

Перед тем, как перейти к описанию фильтра и таблицы отчета коснемся вопросов его устройства.

\subsubsection{Компоненты фильтра}

В первую очередь попробуем разбить фильтр отчета на части (это важно из-за его внушительных
размеров).

И так, фильтр состоит из следующих компонентов:
\begin{description}
	\item[Фильтрующие критерии] Составляют наибольшую часть фильтра (в диалоге она
	сосредоточена в титульной области). Главным отличием этих критериев является то,
	что в соответствии с ними система извлекает данные из базы данных.
	\item[Группирующие критерии] По этим критериям система группирует отобранные
	из базы данных (на основе фильтрующих критериев) данные.

	Если группирующие критерии не определены, то вы получаете огромный отчет,
	состоящий из десятков и сотен тысяч строк.
	\item[Подстановочные критерии] Эта часть фильтра определяет параметры
	\qu{подмены} результирующих полей отчета.
\end{description}

Важно отметить отличие данного отчета от большинства иных отчетов
в системе: здесь подстановочные и группирующие критерии фильтра разделены.
Функционал группировки и подстановки присутствует и в других отчетах (например,
товарном отчете по операции, остатках товаров и т.д.) однако там,
выбирая подстановку, вы неявно выбираете и группировку по указанному
критерию.

Так, например, выбрав подстановку товара по группе в остатках товаров, вы
получите отчет, в котором каждая группа представлена одной строкой.

В анализе товарных операций - иначе: установив подстановку без
группировки вы получите отчет, в котором подставленный компонент
отчета повторяется много раз.

\subsubsection{Атрибуты отчета}

Атрибуты результирующего отчета, так же как и параметры фильтры, мы
разобьем на категории. Здесь их всего две:

\begin{description}
	\item[Ведущие атрибуты] это те атрибуты, которые присущи товарным
	строкам документов (возможно, самим документам) и не могут быть
	просуммированы.
	\item[Показатели] - собственно результат работы отчета. То есть, те
	данные, которые отвечают на вопрос \qu{сколько?}.

	Анализ товарных операций включает следующие основные показатели:
	\begin{itemize}
		\item Количество товара (в торговых и физических единицах),
		вовлеченное в операции.
		\item Сумма в ценах поступления %
		\item Сумма в ценах реализации (с учетом скидки)
		\item Суммарная скидка
	\end{itemize}

	В зависимости от параметров фильтра, отчет может содержать
	дополнительные показатели:
	\begin{itemize}
		\item Количество адресов, по которым была произведена отгрузка
		\item Остаток товара
	\end{itemize}

	Плюс к сказанному следует отметить производные от вышеобозначенных
	показателей:
	\begin{itemize}
		\item Доходность операций абсолютная %
		\item Доходность операций относительная (процентное отношение
		доходности к сумме операций в ценах поступления).
		\item Маржа по операциям относительная (процентное отношение
		доходности к сумме операций в ценах реализации).
	\end{itemize}
\end{description}

\subsubsection{Техника расчета}

Система, получив условия фильтра отчета, перебирает все строки товарных документов
в соответствии с фильтрующими условиями.

Затем, если в фильтре есть подстановочные критерии, полученные строки заменяют
заданные ведущие атрибуты отчета подстановочными атрибутами.

Наконец, при условии что в фильтре определены условия группировки, строки отчета
группируются. На этом этапе размерность отчета значительно сокращается: множество
строк сжимаются так, что в ведущих атрибутах отчета (для которых задана группировка)
устраняется дублирование значений, а соответствующие им показатели суммируются.

%topic(DLG_TRFRANLZ)

\subsection{Фильтр анализа товарных операций}

\ppypictsc{dlg-f-trfranlz}{Анализ товарных операций}{0.4}

Диалог фильтра анализа товарных операций показан на рис.~\ref{pic-dlg-f-trfranlz}.
Вот описание управляющих элементов указанного диалога:

\begin{description}
	\item[Период]
	Период анализируемых товарных операций.

	\item[Период поступления товаров]
	Период поступления анализируемых товарных операций.

	\item[\dlgcombo{Склад}]
	Склад, к которому относятся операции.

	\item[\dlgcombo{Вид операции}]
	Ограничивает анализ только теми операциями, которые относятся к выбранному виду. Это
	может быть обобщенная операция.

	\item[\dlgcombo{Контрагент}]
	Если выбран вид операции, то в этом комбо-боксе можно выбрать контрагента,
	соответствующего указанному виду операции. Если же вид операции не выбран, то здесь может
	быть указан покупатель.

	\item[\dlgcombo{Агент}]
	При необходимости изучить отгрузки, сделанные через конкретного торгового агента, в
	этом комбо-боксе можно выбрать этого агента.

	\item[\dlgcombo{Поставщик}]
	Указав поставщика, вы ограничите перебор операций только теми, которые привязаны к лотам,
	поступившим от этого поставщика.

	\item[\dlgcombo{Группа товаров}]
	Товарная группа, по которой следует провести анализ. Это может быть обыкновенная группа,
	а также альтернативная или группа верхнего уровня. Если выбрана группа-каталог с
	не пересекающимися альтернативными группами, то таким образом можно получить группировку
	по произвольной классификации товаров.

	\item[\dlgcombo{Товар}]
	Выбор товара позволяет увидеть движение только этого товара.
	При этом получается отчет специального вида, называемый по традиции карточкой товара.
	В этом отчете перечисляются операции по товару с указанием даты операции, номера
	документа, количества, цен и остатка этого товара после операции.

	\item[\dlgflag{Группировать по дате}]
	Этот флажок действует только в том случае, если указан конкретный товар. При этом
	будет получен отчет в форме: дата - приход - расход - остаток.

	\item[\dlgflag{Рассчитывать НДС}]
	Если флаг установлен, то в дополнение к остальным колонкам в таблице отчета
	будет отображаться колонка суммы НДС в ценах реализации.

	При группировках эта колонка так же рассчитывается, однако, если выбрана
	кросстабулированная форма отображения данных, то сумму НДС увидеть не удастся.

	\item[\dlgflag{Цены на товары без НДС}]
	Установка этого флага предписывает системе рассчитывать цены в товарных
	операциях без НДС.

	\item[\dlgflag{Показывать штрихкод товаров}]
	Опция во включенном состоянии предписывает системе отобразить в таблице отчета \ppyterm{единственных штрихкод} (см. стр.~\pageref{term-singlebarcode}).
	справа от колонки наименования товара.

	Опция работает если отключена группировка и не используется подстановка товара. В режиме карточки товара флаг так же игнорируется.

	\item[\dlgflag{Показывать серийные номера}]
	Если флаг установлен, то в таблице отчета отображается серийный номер лота, ассоциированного со строкой отчета.

	Опция действует только при отключенной группировке и без подстановки товара. В режиме карточки товара флаг так же игнорируется.

	\item[\dlgflag{Сравнивать с документами списания}]
	Этот флаг активен только в том случае, если в комбо-боксе \dlgcombo{Вид операции} выбран вид операции,
	относящийся к одному из типов драфт-операций, либо обобщенный вид операции, включающий помимо прочих,
	какую-либо драфт-операцию.

	Установка флага предписывает системе, наряду с обычным отчетом, рассчитывать для каждого элемента параметры
	списания драфт-документов.

	Соответствия строк драфт-документов со строками документов списания устанавливаются по товару.

	Если какой-либо драфт-документ не списан, то его строки попадают в отчет с пустым соответствием строк списания.

	Все группировки и подстановки, предусмотренные фильтром, корректно отрабатывают и применительно к компонентам
	отчета, отражающим значения из документов списания.

	\item[\dlgflag{Показывать только отличия от документов списания}]
	Флаг доступен тогда, когда включен флаг \dlgflag{Сравнивать с документами списания}, описанный выше.
	Если этот флаг включен, то в отчет попадают только те строки драфт-операций и, соответствующие им строки
	документов списания, между которыми существуют различия.

	\item[\dlgflag{Только по не списанным драфт-документам}]
	Этот флаг активен только в том случае, если в комбо-боксе \dlgcombo{Вид операции} выбран вид операции,
	относящийся к одному из типов драфт-операций, либо обобщенный вид операции, включающий помимо прочих,
	какую-либо драфт-операцию.

	Если флаг установлен, то перебор по драфт-документам осуществляется только среди тех документов, которые
	не имеют признака \dlgflag{Списан}.

	\item[\dlgradioc{Сортировка}]
	Позволяет выбрать порядок сортировки результирующего отчета.
	Здесь всего три варианта:
	\begin{description}
		\item[\dlgradioi{По дате}]
		\item[\dlgradioi{По товару}]
		\item[\dlgradioi{По контрагенту}]
	\end{description}

	\item[\dlgbutton{Параметры группировки}]
	См. ниже.

\end{description}

%topic(DLG_TAGRPNG)

\ppypict{dlg-f-trfranlz-grpng}{Параметры группировки анализа товарных операций}

По кнопке \dlgbutton{Параметры группировки} доступен диалог (рис.~\ref{pic-dlg-f-trfranlz-grpng}),
в котором можно задать параметры группировки и подстановки. Именно эта часть фильтра делает
анализ товарных операций исключительно полезным инструментом для аналитической обработки
накопленных данных, а так же для подготовки сводных отчетов.

\begin{description}
	\item[\dlgcombo{Группировка}]
	Здесь можно выбрать способ группировки отчета.
	В предложенном списке определены несколько вариантов группировки. Те из них, в которых
	несколько элементов разделены дробью, группируют отчет по комбинации соответствующих
	параметров.

	Перечислим эти варианты:
	\begin{description}
		\item[По товару]
		Все ведущие атрибуты строки кроме товара подавляются.
		Отчет будет содержать колонку товара и соответствующие ему числовые показатели.

		\item[По контрагенту]
		Отчет будет содержать колонку контрагента и
		соответствующие ему числовые показатели. Остальные ведущие показатели
		подавляются в пользу контрагента.

		\item[По контрагенту/дате]
		Отчет будет группироваться по указанной паре атрибутов.

		Эта группировка допускает кросстабуляцию отчета.

		\item[По товару/контрагенту]
		\item[По товару/контрагенту/дате]
		\item[По товару/документу]
		\item[По дате/контрагенту/агенту/товару]
		\item[По товару/дате]
		\item[По документу/контрагенту]
		\item[По товару/поставщику]

		\item[\dlgradioc{Расчет остатков}]

		Блок радио-кнопок, позволяющий выбрать алгоритм расчета остатков по строкам отчета.

		Блок доступен только при выборе группировки по товару или по товару и дате. Подстановка
		товара так же блокирует возможность расчета остатков.

		\ppynote{
			Расчет остатков в этом отчете не следует путать со штатным отчетом о товарных остатках.
			Здесь он имеет специализированное назначение и далеко не всегда может быть легко сопоставлен
			с остатками в обычном смысле слова.

			Алгоритм расчета значений остатков в этом отчете кратко можно описать следующим образом:
			\begin{itemize}
				\item Извлекаются начальные остатки по товарам на начало периода отчета.
				\item При переборе операций для включения в отчет одновременно перебираются абсолютно
				все операции, влияющие на состояние товарных остатков и, таким образом, формируется значение
				для каждого элемента отчета на каждый день.
			\end{itemize}

			Следствием вышесказанного является ощутимое замедление формирование отчета при использовании
			функции построения остатков.
		}

		\begin{description}
			\item[\dlgradioi{Нет}]
			Программа не будет строить данные об остатках.
			\item[\dlgradioi{Простые остатки}]
			В отчете будут отображаться остатки по каждому товару на конец периода.
			\item[\dlgradioi{Среднедневные остатки}]
			Будут отображаться среднедневные остатки по всему периоду расчета.

			Заметим, что этот вариант - единственный способ получить среднедневные остатки по большой выборке товаров
			и при этом раздельно по каждому товару. Агрегированный расчет остатков за период существует так же
			отчете \qu{Группировка товарных операций} (см. стр.~\pageref{sec-opgrouping}), но там нельзя получить массовый расчет значений
			по каждому товару в отдельности.
		\end{description}

		\item[\dlgflag{Рассчитывать оборачиваемость}]
		Опция, доступная если выбран расчет остатков, описанный выше. При включенном флаге
		система отобразит в отчете отношение операционного количества к величине остатков.

	\end{description}

	\item[\dlgflag{Контрагента разбивать по адресу доставки}]
	Если этот флаг включен и выбрана группировка, включающая контрагента, то, в случае, если
	выписывались документы на одного контрагента, но с разными адресами доставки, это
	отобразится разными строками отчета.
	Включение этого признака запрещает подстановку контрагента.

	\item[Подстановка при группировке]
	Применение подстановки позволяет провести укрупненный анализ товарных операций. Так,
	если вместо товара подставить производителя и выбрать группировку по товару, то можно
	получить, скажем, суммарные продажи по каждому из производителей.

	\item[\dlgcombo{Товар}]
	Реализует один из штатных вариантов подстановки товара.

	\item[\dlgcombo{Контрагент}]
	Дает возможность применить один из зарезервированных способов подстановки
	по контрагенту.

	\item[\dlgflag{Из фактического адреса}]
	Подстановка по контрагенту будет реализоваться на основе данных, указанных в фактическом
	адресе контрагента. Если фактический адрес не заполнен, то использоваться будет юридический
	адрес.

	\item[\dlgcombo{Дата}]
	Здесь может быть выбран месяц, квартал или год. Таким образом, вы можете анализировать
	итоговые данные помесячно, поквартально или по годам.

	\item[\dlgbutton{Кросстабуляция}]
	Открывает диалог выбора параметров кросстабулированного варианта отчета.
\end{description}

%topic(BROWSER_TRFRANLZ)

\subsection{Таблица анализа товарных операций}

\ppypictsc{brw-trfranlz}{}{0.4}

В зависимости от условий фильтра таблица анализа товарных операций может принимать весьма
разнообразные формы.

При отсутствии в фильтре ограничения по товару и параметров группировки таблица выглядит
так, как показано на рис.~\ref{pic-brw-trfranlz}.

\ppypictsc{brw-trfranlz-goods}{}{0.4}
Если в фильтре не указаны параметры группировки и указан какой-либо товар, то общий
вид таблицы будет похож на представленный рис.~\ref{pic-brw-trfranlz-goods}.

Установка параметров группировки повлечет за собой удаление колонок с номером документа
и видом операции, поскольку это - детальная информация, свойственная каждой товарной
операции в отдельности. В колонка количества, цен поступления и цен реализации будут
просуммированные значения по сгруппированным строкам.

\subsubsection{Особенности отражения показателей}
В этом отчете количественные и суммовые показатели отображаются с учетом знака.
Расходные операции - со знаком минус, а приходные - со знаком плюс. Если в одной
строке отчета сгруппированы более одной строки товарного документа, то результат
будет представлен суммой сгруппированных значений с учетом знака.

Цены отображаются всегда положительной величиной.

Если в фильтре установлен флаг \dlgflag{Цены на товары без НДС}, то цены и суммы
показаны без НДС.

\subsubsection{Действия в таблице анализа товарных операций}

	\paragraph{Просмотр/деталировка}\indent\keyb{Enter}
	Если таблица получена без группировки, то эта команда повлечет просмотр документа,
	соответствующего выбранной строке. При использовании группировки, по этой команде будут
	показаны операции, соответствующие выбранной сгруппированной строке.

	\paragraph{Печать}\indent\keyb{F7}
	Печать отчета по анализу товарных операций

	\paragraph{Экспорт}\indent\keyb{F8}
	Экспорт анализа товарных операций в DBF-формате. Сформированный файл называется trfranlz.dbf
	и находится в каталоге исходящих файлов (обычно PPY/OUT).

	\paragraph{Итоги}\indent\keyb{F9}
	Просмотр итогов по сформированному анализу товарных операций.

	%\paragraph{График}\indent\keyb{Ctrl-I}

%endtopic

\section{Товарный отчет по операции}

Назначение этого отчета - показать итоговые значения количества, сумм в ценах поступления и
реализации по каждому товару, по которому были совершены операции заданного вида.
Этот отчет весьма нагляден и позволяет, например, проанализировать продажи товаров за
определенный период времени, а также выявить те позиции, которые приносят самый большой
оборот. Вообще можно привести множество способов использования данного отчета. В их числе:
\begin{itemize}
	\item Простой анализ продаж, приходов и других операций
	\item Анализ вход-выход
	\item Анализ переоценок
	\item Оценка работы торговых агентов
	\item Нахождение доходности бизнеса по оплате
	\item ABC-анализ товаров или объектов, которые могут быть подставлены вместо
	товаров (товарные группы, поставщики, брэнды и др.)
	\item Сравнительный анализ операций по двум периодам
	\item Выявление товаров с отрицательной доходностью
	\item Выявление товаров, по которым не было выбранных операций при том,
	что остаток (на заданную дату) по этим товарам был.
	\item Комбинированный анализ операций по товарам, сопоставленный с
	остатками на выбранную дату
	\item И др.
\end{itemize}

%topic(DLG_GOODSOPR)

\subsection{Фильтр товарного отчета по операции}

\ppypictsc{dlg-f-goodsopr}{Товарный отчет по операции}{0.6}

Вид диалога фильтра показан на рис.~\ref{pic-dlg-f-goodsopr}. Ниже приводится описание
управляющих элементов этого диалога.

\begin{description}
	\item[Период]
	Период времени, за который анализируются операции.

	\item[\dlgradioc{Операции}]
	Способ выбора вида операции. Может иметь следующие положения:
	\begin{description}
		\item[На выбор] Вы должны явно выбрать вид операции в комбо-боксе  \dlgcombo{Вид операции}.
		\item[Доходные без возвратов] Анализ по операциям, имеющим признак  \dlgflag{Доходная операция}
		\item[Доходные с возвратами] То же, что и пункт выше, но за вычетом возвратов, привязанных к
		доходным операциям (непривязанные возвраты не считаются).
		\item[Доходные оплаченные]
		Анализ доходных операций по мере поступления оплат по ним. Принцип расчета в этом случае
		следующий: если документ относится к доходной операции, не требующей оплаты, то он
		обрабатывается обычным образом, если же документ требует оплаты, то все значения по этому
		документу рассчитываются в пропорции к поступившим по нему оплатам за выбранный период.
		Обратите внимание на то, что период в этом случае системой рассматривается как период оплаты,
		а не отгрузки.
		\item[Анализ 'вход-выход']
		Такой анализ предполагает выбор в комбо-боксе \dlgcombo{Вид операции} либо операции модификации товара,
		либо обобщенной операции, включающей одновременно операции прихода и расхода товаров. При этом
		система рассчитает соотношение выходящих товаров к входящим. Чаще всего анализ вход-выход
		используется в производстве и в ресторанном бизнесе.
	\end{description}

	\item[\dlgcombo{Вид операции}]
	Здесь выбирается вид анализируемой операции. Доступность этого комбо-бокса определяется
	положением переключателя \dlgradioc{Операция}.

	Вы можете выбрать в этом комбо-боксе как простую, так и обобщенную операцию. В последнем
	случае отчет будет построен суммарно по всем видам операций, входящих в обобщение.
	Если выбран вид операции типа \ppyrsrv{Переоценка}, либо обобщенная операция, в которую входят
	только операции, относящиеся к этому типу, то формат таблицы будет несколько отличаться
	от типового. В ней будут показаны суммы в ценах поступления и реализации как до переоценки,
	так и после.

	\item[\dlgcombo{Контрагент}]
	Если выбранная операция или группа операций предполагают наличие контрагента, то в этом
	комбо-боксе вы можете указать одного контрагента, которым хотите ограничить анализ.

	\item[\dlgcombo{Склад}]
	Выберите здесь склад, товарные операции по которому следует анализировать. Оставив поле
	пустым, вы сообщите системе, что хотите видеть операции по всем складам.
	Можно \qu{заставить} систему вывести отчет по списку складов. Для этого нажмите кнопку
	\dlgbutton{\dots} справа от этого поля и выберите в списке требуемые склады.

	\item[\dlgflag{Раздельно по каждому складу}]
	Установив этот флаг, вы получите отчет, содержащий значения, раздельно по складам. То
	есть, для каждого товара будут показаны рассчитанные величины для каждого, из определенного
	в фильтре, складов. Без установки этого флага все величины рассчитываются суммарно по всем
	складам, определенным в фильтре.

	\item[\dlgflag{Кросстаб}]
	Флаг доступен только в том случае, если включен флаг \dlgflag{Раздельно по каждому складу}.
	При установке данной опции, отчет будет сформирован в кросстабулированном по складам
	виде.

	Показатели, отображаемые в отчете, определяются диалогом, доступным по кнопке \dlgbutton{Сравнение}
	(в этом случае функционал сравнительного периода отключается). Если не будет выбраны
	какие-либо показатели, то кросстабулированный отчет отобразит только количество торговых
	единиц для каждого из складов.

	\item[\dlgcombo{Группа товаров}]
	Здесь можно указать товарную группу, которой следует ограничить анализ.

	\item[\dlgbutton{Фильтр}]
	С помощью этой кнопки программа позволяет вам установить подробные условия фильтрации списка
	товаров, по которым следует строить отчет.

	Если вы установите какие-либо критерии в товарном фильтре, то система автоматически создаст
	временную динамическую альтернативную группу, соответствующую фильтру.
	После закрытия таблицы отчета эта группа будет удалена.

	\item[\dlgflag{Разбивать товары по ценам}]
	При установке этого флага, каждая позиция, по которой были совершены операции с разными
	учетными ценами реализации, будет показываться раздельно для каждого значения цены.

	\item[\dlgflag{Разбивать по чистым ценам реализации}]
	То же, что и предыдущий пункт, но разбивка осуществляется по разнице (учетная цена
	реализации - скидка).

	\item[\dlgflag{Вычитать акциз из цен реализации}]
	Этот флаг может быть использован при торговле подакцизными товарами, для того, чтобы увидеть
	оборот и доходность операций без учета акцизов.

	\item[\dlgflag{Рассчитывать остатки}]
	При установленном флаге система рассчитает остатки по соответствующим товарам и покажет
	их в отдельной колонке отчета. По умолчанию, рассчитываются текущие остатки по складу,
	указанному в фильтре. Если вы хотите получить остатки на конкретную дату, то в дополнительных
	опциях фильтра установите эту дату.
	Обратим внимание на то, что включение этого флага увеличивает время расчета.

	\item[\dlgflag{Рассчитывать текущие заказы}]
	Опция предписывает системе рассчитать текущие заказы по каждому товару, вошедшему в отчет.
	\ppynote{
		По тем номенклатурным позициям, которые не вошли в отчет, заказы не рассчитываются.
		Таким образом, из отсутствия некоторого товара в отчете нельзя делать вывод,
		что по нему нет открытых заказов.
	}

	\item[\dlgflag{Показывать среднедневные продажи по статистике}]
	Установка флага приводит к тому, что система, для каждой номенклатурной позиции в отчете,
	выводит колонку среднедневных продаж из статистики продаж по товару.
	Если таблица продаж не заполнена, то значение будет пустым. Обратим также внимание на то,
	что среднедневные продажи берутся по всему периоду, который охватывает статистика продаж.

	\item[\dlgflag{Убыточные товары}]
	Если этот флаг установлен, то в отчет войдут только те позиции, для которых разница между
	суммой в ценах реализации (с учетом скидок) и суммой в ценах поступления отрицательная.
	При выводе на печать отчета с таким флагом применяется специализированная форма GOA\_LOSS.

	\item[\dlgflag{Товары, по которым не было операций (остаток не нулевой)}]
	Этот флаг доступен только в том случае, если вы установили флаг \dlgflag{Рассчитывать остатки}.
	Действует он следующим образом:
	рассчитывается товарный отчет по операции с учетом всех прочих условий фильтра
	рассчитываются остатки на указанную дату
	из списка товаров, по которым есть остатки удаляются все позиции, по которым есть
	какие-либо операции (соответственно фильтру)
	результирующий список выводиться на экран (или на печать)
	При выводе на печать отчета с таким флагом применяется специализированная форма GOA\_ZEROOP.

	\item[\dlgflag{Показывать только позиции, которые есть в торговом плане}]
	Опция активна только для отчета, который строится на основании торговых
	планов.

	Если флаг включен, то в отчет буду включены только те товары, которые
	присутствуют в документе (документах) торгового плана, по которому
	строится отчет. В противном случае в отчет войду все позиции, удовлетворяющие
	остальным критериям фильтра.

	\item[\dlgflag{Дополнять позициями с ненулевым остатком}]
	Если флаг включен, то при расчете отчета с остатками в него войдут все номенклатурные
	позиции, которые есть на остатке на заданную дату и по выбранному списку складов, даже
	если по этим позициям не было операций, определенных фильтром отчета.

	Флаг доступен к выбору только если включен флаг \dlgflag{Рассчитывать остатки}  и
	выключен флаг \dlgflag{Товары, по которым не было операций (остаток не нулевой)}.

	Рассматриваемая опция увеличивает время расчета.

	\item[\dlgflag{Разница цен при межскладской передаче}]
	Флаг, позволяющий получить специальный (и редко используемый) отчет по различиям в ценах
	реализации между складом отправителем и складом получателем. Кроме установки этого флага,
	для получения такого отчета следует выбрать операцию межскладского расхода товара.

	\item[\dlgflag{Рассчитывать отклонения цен}]
	Этот флаг предназначен для получения отчета специального вида, в котором кроме обычных
	колонок товарного отчета по операции будут показаны колонки со средними отклонениями
	цен реализации от базовой цены. Такой отчет может понадобиться для анализа цен, по
	которым продавались товары.

	Технология расчета, используемая здесь, следующая:  по каждой операции продажи фиксируется
	учетная цена реализации, и отклонение (раздельно положительное и отрицательное). Для каждой
	товарной позиции эти три величины (учетная цена, отрицательное отклонение, положительное
	отклонение) суммируются и делятся на количество. Таким образом, мы видим усредненные
	значения учетной цены, положительного и отрицательного отклонений по каждому товару.

	\item[\dlgflag{Количество показывать без упаковок}]
	Если конфигурация текущего пользователя предусматривает использование емкостей
	упаковок и в лотах товаров, по которым строится отчет определены такие емкости,
	то операционное количество будет представлено в таблице в специальной форме,
	показывающей количество упаковок, емкость упаковки и остаток сверх полной упаковки.

	Если вы хотите, что бы количество было представлено просто числом, то установите
	рассматриваемый флаг.

	\item[\dlgflag{Сравнивать с документами закупки}]

	\item[\dlgbutton{Дополнительно\dots}]
	См. стр.~\pageref{loc-goodsopanlz-filtext}.

	\item[\dlgbutton{Сравнение\dots}]
	См. стр.~\pageref{loc-goodsopanlz-filtcmp}.

	\item[\dlgflag{ABC-анализ\dots}]
	Если включен флаг ABC-анализ, то нажатием этой кнопки можно получить доступ к дополнительным
	опциям такого анализа. Подробно ABC-анализ рассмотрен ниже.

	\item[\dlgbutton{АВС фильтр}]

\end{description}

%topic(DLG_GOODSOPR2)

\ppypictsc{dlg-109}{Дополнительный опции товарного отчета по операции}{0.5}

По кнопке \dlgbutton{Дополнительно} доступен диалог дополнительных критериев анализа:\label{loc-goodsopanlz-filtext}
Вид этого диалога показан на рис.~\ref{pic-dlg-109}. Далее перечисляются элементы диалога.

\begin{description}
	\item[\dlgcombo{Поставщик}]
	Выбор здесь поставщика ограничивает анализ только теми позициями, которые поступили от
	заданного поставщика.

	\item[\dlgcombo{Агент поставщика}]
	Если документы прихода товаров содержат поле агента, то здесь вы можете выбрать только
	того агента, чьи товары следует перебирать.

	\item[\dlgcombo{Агент}]
	Вы можете проанализировать продажи через конкретного агента. Для этого его следует
	выбрать в этом комбо-боксе.

	\item[\dlgcombo{Город контрагента}]
	Ограничивает перебор документов теми, контрагенты которых живут в указанном городе.

	\item[\dlgcombo{Транспортный брокер}]
	Ограничивает отчет только теми документами, во данных о фрахте которых установлен выбранный здесь
	транспортный брокер. Подробно о вводе параметров фрахта документа см. на стр.~\pageref{sec-billfreight}.

	\item[Подстановка]
	Эта группа содержит два комбо-бокса, определяющие выбор вариантов подстановки
	объектов в отчете.
	\begin{description}
		\item[\dlgcombo{Документ}]
		Вариант подстановки атрибута документа. Заметим, что при выборе здесь
		какого-либо элемента прилагательное \qu{Товарный} для отчета утрачивает
		смысл, ибо он будет строиться уже в разрезе атрибутов документов, а не
		товаров.

		Возможны следующие опции:
		\begin{description}
			\item[Вид операции]
			Отчет строится в разрезе видов операций, которым принадлежат
			попавшие в него документы.

			\item[Дата]
			Левая колонка отчета будет содержать даты, к которым
			относятся документы.

			Этот вариант изменяет назначение нижнего комбо-бокса так,
			что в нем может быть выбрана подстановка даты (месяц, год и т.д.).

			\item[Склад]
			Отчет рассчитывается так, что значения будут просуммированы
			по складам, к которым принадлежат документы.

			\item[Статья]
			Используется разрез по основным статьям документов.

			При выборе этого варианта назначение нижнего комбо-бокса
			переключается на перечисление опций подстановки персоналии.

			\item[Дополнительная статья]
			Выстраивает отчет по дополнительным статьям документов (если
			эти документ, конечно, содержать дополнительные статьи).

			Так же, как и в предыдущем случае, нижний комбо-бокс
			переключается на выбор подстановки персоналии, связанной
			на этот раз с дополнительной статьей документа.

			\item[Статус]
			Подставляет статусы перечисляемых документов.

			\item[Агент]
			Отчет строится в разрезе агентов по документам.

			При выборе этого варианта назначение нижнего комбо-бокса
			переключается на перечисление опций подстановки персоналии.

			\item[Плательщик]
			Отчет строится в разрезе плательщиков по документам.

			При выборе этого варианта назначение нижнего комбо-бокса
			переключается на перечисление опций подстановки персоналии.
		\end{description}

		\item[\dlgcombo{Товар}]
		Если не выбрана подстановка документа, то этот комбо-бокс позволяет
		указать подстановку одного из атрибутов товаров, входящих в отчет.

		Если используется подстановка по документу, то данный комбо-бокс
		либо заблокирован, либо применяется для выбора дополнительной подстановки
		по одному из атрибутов документов (см. выше).
	\end{description}

	\item[\dlgcombo{Котировка вместо цены}]
	В этом комбо-боксе можно выбрать вид котировки. Тогда вместо цены реализации в отчете
	будет подставляться котировка, соответствующая выбранному виду.

	\item[Дата расчета остатков]
	Как упоминалось выше, это поле актуально тогда, когда вы установили флаг
	\dlgflag{Рассчитывать остатки} в основном диалоге фильтра. В противном случае,
	поле заблокировано.

\end{description}

По кнопке \dlgbutton{Сравнение} доступен диалог, изображенный на рис.~\ref{pic-dlg-118}.\label{loc-goodsopanlz-filtcmp}

%topic(DLG_GOODSOPRE)

\ppypict{dlg-118}{Опции сравнения товарного отчета по операции}

Посредством установки опций сравнения вы можете получить отчет, в котором выбранные
показатели будут сравниваться с аналогичными показателями за какой либо иной период.

Заметим, что время расчета отчета со сравнением выше, чем без оного.

Если в заголовочном диалоге отчета выбрана опция \dlgflag{Кросстаб}, то данный
диалог используется для выбора показателей, которые будут отображаться в
кросстабулированной по складам таблице. При этом поля \qu{Сравнительный период}
и \qu{Дата расчета остатков} будут заблокированы (поскольку теряют свой смысл).

\begin{description}
	\item[Сравнительный период]
	В этом поле следует ввести период, с которым будет проводиться сравнение.
	Вы вольны выбрать любой период, однако при этом следует учитывать то, что
	интерпретировать результаты такого сравнение придется вам же.

	Справа от поля присутствует кнопка, позволяющая облегчить пользователям
	задачу установки этого периода.
	Описание возможных вариантов приведено ниже (стр.~\pageref{sec-goodsopanlz-selcmpperiod}).

	\item[Дата расчета остатков]
	Это поле следует заполнять в том случае, если в фильтре отчета установлен
	флаг \dlgflag{Рассчитывать остатки}.

	Установка здесь конкретной даты приведет к расчету сравнительных
	остатков на эту дату.

	\item[Показатель]
	Список, позволяющий выбрать показатели, которые будут отображаться в
	отчете. Для каждого из показателей справа следует установить те флаги
	(см. ниже), которые соответствуют отображаемым величинам.

	\item[Переключатели значений, вычисляемых по выбранному показателю]
	Справа от списка показателей находится блок переключателей, позволяющий
	уточнить рассчитываемые по выбранному в списке показателю величины.

	\begin{description}
		\item[\dlgflag{Основной период}] В таблице будет выведен показатель
		за основной период отчета.
		\item[\dlgflag{Дополнительный период}] В таблице будет выведен показатель
		за дополнительный период отчета.
		\item[\dlgflag{Разница}] В таблице появится колонка, отображающая разницу между
		значениями в основном и дополнительном периодах.
		\item[\dlgflag{Разница в \%}] Если этот флаг включен, то в таблице будет
		отображаться разница в процентах к дополнительному периоду.

		По умолчанию в новом фильтре этот флаг включен.
	\end{description}
\end{description}

\subsubsection{Варианты выбора сравнительного периода\label{sec-goodsopanlz-selcmpperiod}}

Возможны следующие варианты быстрого выбора сравнительного периода (нажатие на
клавишу, приведенную справа от описания, при нахождении каретки в поле ввода
сравнительного периода приведет к тому же результату):

\begin{description}
	\item[Предыдущий месяц]\indent\keyb{F6} установит в поле сравнительного
	периода аналогичный основного периода отчета, но отстоящий от него
	ровно на один месяц назад.

	Обратите внимание на то, что если основной период по продолжительности
	превышает один месяц, то сравнительный период будет перекрывать его,
	то есть, конец сравнительного периода будет соответствовать более
	поздней дате, чем начало основного.

	Например:
	\newline основной период - 1/05/2008..12/06/2008
	\newline сравнительный период будет равен - 01/04/2008..12/05/2008
	\item[Предыдущий год]\indent\keyb{F8} установит сравнительный период
	равный пр продолжительности основному периоду отчета, но отстоящий от
	него ровно на один год назад.

	Например:
	\newline основной период - 1/05/2008..12/06/2008
	\newline сравнительный период будет равен - 01/05/2007..12/06/2007
	\item[Предыдущий примыкающий период]\indent\keyb{F10} установит
	сравнительный период равным по продолжительности основному таким
	образом, что последний день сравнительного периода будет предшествовать
	ровно на один день началу основного периода.

	Например:
	\newline основной период - 1/05/2008..12/06/2008
	\newline сравнительный период будет равен - 19/03/2008..30/04/2008
\end{description}

%topic(BROWSER_GOODSOPER)

\subsection{Таблица товарного отчета по операции}

\ppypictsc{brw-goodsopr}{}{0.4}

Наиболее общий вид таблицы товарного отчета по операции показан на
рис.~\ref{pic-brw-goodsopr}. Если в качестве анализируемой операции вы выбрали
переоценку или использовали флаг \dlgflag{Разница цен при межскладской передаче},
то таблица будет иметь несколько иной вид.

Колонка \qu{Количество в физических единицах} содержит правильное значение только в
случае, если для товаров указаны корректные соотношения физических единиц к торговым.

Колонка \qu{Сумма в ценах реализации} содержит сумму чистой цены реализации по операции,
то есть Номинальная цена реализации - Скидка.

Колонка \qu{Доход} рассчитывается только для операций, имеющих признак \dlgflag{Доходная}.
При этом значение в этой колонке равно разнице между суммой в чистых ценах реализации
(с учетом скидки) и суммой в ценах поступления для доходных операций.

\subsubsection{Действия с таблицей товарного отчета по операции}

	\paragraph{Лоты}\indent\keyb{Enter}
	Просмотр лотов по товару, соответствующему выбранной строке отчета

	\paragraph{Лоты заказов}\indent\keyb{Shift-F3}
	По этой команде доступен список заказов на выбранную товарную позицию.

	\paragraph{Товар}\indent\keyb{F2}
	Просмотр и редактирование товара, соответствующего выбранной строке.

	Если к отчету применена подстановка товара, то эта функция показывает
	подставленный вместо товара объект. Например, если используется подстановка
	поставщика, то будет показан поставщик, которому соответствует текущая %
	строка таблицы.

	\paragraph{Анализ товарных операций}\indent\keyb{F3}
	Эта команда позволяет рассчитать анализ товарных операций по выбранной позиции. При
	выборе этой команды вы увидите фильтр анализа товарных операций в котором установлен
	период такой же, как и в товарном отчете по операции и текущий товар из таблицы. Остальные
	параметры фильтрации вы можете изменить самостоятельно.
	Пока вы находитесь в таблице отчета, система хранит условия последнего выбранного анализа
	товарных операций с тем, чтобы вы могли и по другим товарным позициям посмотреть аналогичный
	отчет.

	\paragraph{Группировка операций}\indent\keyb{F5}
	Группировка операций по товару, соответствующему выбранной строке отчета, за период и по
	складу, выбранным в фильтре товарного отчета по операции

	\paragraph{Положить в корзину}\indent\keyb{Ctrl-F4}
	Положить выбранный товар в корзину

	\paragraph{Добавить в корзину все товары из отчета}\indent\keyb{Ctrl-F8}
	Загружает в выбранную корзину все номенклатурные позиции, вошедшие в отчет.
	Обратите внимание на то, что обычно отчет содержит весьма обширный список товаров. По
	этому, внесение этого списка в корзину и работа с такой корзиной могут занимать
	продолжительное время.

	\paragraph{Сортировка}\indent\keyb{Ctrl-O}
	Сортировка отчета по одному из следующих критериев:

	\begin{itemize}
		\item По наименованию товара
		\item По количеству товара в строке
		\item По сумме в ценах поступления
		\item По сумме в ценах реализации
		\item По доходности
	\end{itemize}
	Используя возможность сортировки, вы можете эффективно анализировать свой товарный
	ассортимент.

	\paragraph{Печать}\indent\keyb{F7}
	Отправка отчета на печать или экспорт в какой-либо из доступных форматов

	\paragraph{Итоги}\indent\keyb{F9}
	Просмотр итогов по отчету

%endtopic

\subsection{ABC-анализ}

ABC-анализ позволяет разбить все множество товаров, с которыми осуществлялись
выбранные операции, на несколько групп (обычно на три) по критерию оборачиваемости или
доходности:

\begin{itemize}
	\item Первая группа (A) - это очень небольшая часть ассортимента,
	приносящая максимальный оборот или доход.
	\item Вторая группа (B) - средняя номенклатура, оборот или доход от
	которой соизмерим с долей этих позиций в общем ассортименте предприятия.
	\item Третья группа (C) - грубо говоря, балласт. Количество этих позиций
	очень велико при несоизмеримо более низком доходом, который они приносят.
\end{itemize}

Вопрос интерпретации результатов ABC-анализа упирается в выбор группы, на которой
следует сконцентрировать внимание. Есть две альтернативы:
\begin{enumerate}
	\item Махнуть рукой на группу C и сконцентрироваться на управлении группой A.
	\item Сфокусировать усилия на группе C с тем, чтобы снизить неравномерность
	между ней и первыми двумя группами. Это подразумевает либо сокращение
	ассортимента, либо более эффективное управление им.
\end{enumerate}

Идеальная ситуация такова, что все три группы занимают соизмеримые доли ассортимента.

Добавим, что ABC-анализ можно рассчитывать не только на базе товарной номенклатуры, но
и по поставщикам, клиентам, брэндам и пр.
В системе \ppybrand{} использование ABC-анализа опирается на товарный отчет по операции.

Порядок работы следующий:
\begin{enumerate}
	\item Выберите операцию, которую хотите проанализировать. Если необходимо
	анализировать несколько операций вкупе, то создайте обобщенную операцию,
	объединяющие эти несколько операций, и выберите ее.

	Кроме того, можно воспользоваться переключателем операции в фильтре отчета.
	Здесь может быть полезен один из трех вариантов: доходные без возвратов,
	доходные с возвратами, доходные оплаченные.
	\item Укажите период, за который нужно получить отчет. Чем больший выбранный
	период, тем надежнее полученный результат ABC-анализа, но одновременно
	увеличивается время, необходимое для расчета.
	\item По желанию выберите склад
	\item Включите флажок \dlgflag{ABC-анализ}
	\item Нажмите кнопку \dlgbutton{ABC-анализ\dots}
	\item В диалоге, укажите (если вас не устраивают значения по умолчанию) процентное
	соотношение групп (всего групп может быть до пяти, но обычно только три).
	\item Выберите критерий группировки. Возможен один из четырех вариантов:
		\begin{itemize}
			\item по обороту в ценах поступления (по себестоимости)
			\item по обороту в ценах реализации
			\item по обороту в количественном выражении
			\item по доходности (оборот в ценах реализации за вычетом оборота в ценах поступления).
		\end{itemize}
\end{enumerate}

\ppypictsc{brw-abcgrpng}{}{0.4}

Результат расчета будет выглядеть так, как показано на рис.~\ref{pic-brw-abcgrpng}
Разберем подробнее каждую из колонок этого отчета:

	\paragraph{Группа}
	Обозначение группы с указанным в скобках заданным значением выбранного критерия
	группировки.

	\paragraph{Количество}
	Оборот в торговых единицах совокупности товаров, принадлежащих каждой из групп.

	\paragraph{Сумма в ценах поступления}
	Себестоимость товаров, принадлежащих каждой из групп.

	\paragraph{Сумма в ценах реализации}
	Оборот в ценах реализации каждой из групп.

	\paragraph{Доходность}
	Разница между значениями колонок \qu{Сумма в ценах реализации} и
	\qu{Сумма в ценах поступления}.

	\paragraph{Доля группы}
	Действительная доля групп в общей сумме заданного критерия. Эта величина может
	несколько отличаться от величины, указанной в параметрах фильтра. Для того чтобы
	были понятны причины этих различий, вы можете обратиться к описанию алгоритма
	расчета ABC-анализа, приведенному ниже.

	\paragraph{Доля от общего числа позиций}
	Процентное отношение количества наименований товаров, относящихся к каждой из групп,
	к общему количеству позиций, охваченному группировкой. Именно эта колонка определяет
	степень неравномерности участия товаров в общем результате деятельности вашего
	предприятия.

\subsubsection{Действия с таблицей ABC-анализа}

	\paragraph{Лоты}\indent\keyb{Enter}
	Детализирует состав выбранной ABC-группы по товарам

	\paragraph{Поместить товары данной группы в альтернативную}\indent\keyb{Ctrl-F5}
	Эта функция позволяет перенести все товары, относящиеся к текущей группе в альтернативную
	товарную группу. Это дает возможность использовать выборку товаров в других отчетах.
	После выбора этого действия система запросит указать альтернативную группу, в которую
	следует перенести выборку.

	\paragraph{Сортировка}\indent\keyb{Ctrl-O}

	\paragraph{Печать}\indent\keyb{F7}
	Печать результатов ABC-анализа. Доступны два варианта: печать только информации о
	группах; печать всего списка товаров, попавших в отчет с ABC-группировкой.

	\paragraph{Итог}\indent\keyb{F9}
	Показывает итоговые значения отчета

\section{Группировка товарных операций}\label{sec-opgrouping}

С помощью группировки товарных операций вы сможете проанализировать товарные документы или
операции по товару либо товарной группе в разрезе видов операций.
К этому отчету можно обратиться через пункт меню \ppymenu{Отчетность\rdir Группировка товарных
операций}.

\subsection{Как работает этот отчет?}

До того, как мы начнем описывать фильтр этого отчета и его самого, сделаем краткое введение
в способы вычисления показателей этого отчета. Это тем более важно, что некоторые иные отчеты
рассчитываются на таких же принципах.

Для формирования группировки товарных операций может быть использован один из двух базовых
методов:

\begin{itemize}
	\item Перебор по документам
	\item Перебор по строкам документов.
\end{itemize}

\subsubsection{Перебор по документам}

Этот способ расчета применяется в том случае, если фильтр не предусматривает ограничение
отчета по товару, товарной группе, поставщику либо агенту поставщика. То есть не
используются критерии, которые не могут быть применимы к документу в целом.

При таком варианте система перебирает документы за заданный период, проверяет
выполнение условий фильтра этими документами, и, если условия выполняются, заносит
данные по документу в отчет, группируя эти данные по виду операции.

Если требования фильтра предусматривают расчет остатков, те
рассчитываются как итоговые суммы товарных остатков на начало и конец периода
без дробления по товарам либо группам товаров (но с учетом ограничения фильтра
по складам).

\subsubsection{Перебор по строкам документов}

Способ формирования отчета с перебором по строкам используется тогда, когда фильтр
определяет один или несколько критериев, которые не могут быть применены к документу
целиком. Например, если в фильтре задан товар.

В этом случае система для формирования отчета перебирает товарные строки документов
за указанный в фильтре период. Соответственно, такой вариант требует значительно больше
времени для расчета, чем предыдущий. Кроме того, суммы отчета не могут
быть сопоставлены с какими-либо суммами конкретных документов либо выборки документов,
поскольку являют собой результат \qu{дробления} документов по заданным условиям фильтрации.

Если фильтр требует расчета остатков, то они рассчитываются по заданным условиям
фильтрации с представлены в отчете итоговыми суммами.

\subsubsection{Учет внутренних товарных перемещений в отчете}
Необходимо пояснить аспект отображения в отчете межскладских перемещений в
зависимости от условий фильтрации отчета по складам.

Если документ внутренней передачи затрагивает склады, включенные в фильтр,
то операции, соответствующие этому документу в отчет попадают вместе с искусственной
строкой \qu{Межскладской приход}. Связано это с тем, что в этом случае необходимо
отобразить изменения, произошедшие в результате парного расходу прихода товаров
на склад-получатель.

Если фильтр включает только склад-отправитель, то в отчет попадет строка
внутренней передачи.

Если фильтр включает только склад-получатель, то в отчет попадет искусственно
сформированная строка \qu{Межскладской приход}.

%topic(DLG_OPGRPNGFLT)

\subsection{Фильтр группировки товарных операций}

\ppypictsc{dlg-042}{Группировка операций}{0.5}

Диалог фильтра отчета изображен на рис.~\ref{pic-dlg-042}. Далее следует
описание управляющих элементов этого диалога.

\begin{description}
	\item[Период]
	Период, за который следует произвести расчет.

	\item[\dlgcombo{Склад}]
	Склад, которым следует ограничиться при расчете отчета.
	Справа от этого комбо-бокса расположена кнопка, позволяющая выбрать
	несколько складов.

	Если этот критерий пуст, то отчет рассчитывается по всем складам,
	которые определены в базе данных.

	\item[\dlgcombo{Поставщик}]
	Если в этом комбо-боксе выбран поставщик, то отчет будет содержать только те операции,
	которые совершены над товаром, поступившем от этого поставщика.

	\item[\dlgcombo{Агент поставщика}]
	Установив в этом комбо-боксе аналитическую статью, вы получите отчет, отфильтрованный
	по агенту поставщика. Обратите внимание на то, что учет агента поставщика отличается от
	фильтрации по обычному агенту по документу.
	Программа рассматривает только те строки товарных документов, которые связаны с лотами,
	поступившими на предприятие по документам, в которых установлен указанный агент.

	\item[\dlgcombo{Вид операции}]
	Здесь может быть указана обобщенная операция. При этом отчет будет сформирован только
	по тем видам операций, которые входят в это обобщение.

	\item[\dlgcombo{Контрагент}]
	Не используется.

	\item[\dlgcombo{Группа товаров}]
	Товарная группа, операции над которой следует анализировать.

	Справа от комбо-бокса расположена кнопка \dlgbutton{Фильтр}, нажав на которую, вы можете установить
	множество критериев отбора товаров для отчета. При этом отчет будет строится по
	искусственно созданной динамической альтернативной группе, включающей товары, отвечающие
	указанным вами условиям.

	\item[\dlgcombo{Товар}]
	Товар, операции над которым следует включить в анализ. Это может быть как обыкновенный,
	так и обобщенный товар.

	\item[\dlgcombo{Доп тип товара}]
	В этом поле может быть выбран тип товаров, суммы по которому будут вынесены в отдельную
	колонку. Часто в качестве дополнительного типа выбирается тара для параллельного анализа
	операций над товаром и над тарой.

	\item[\dlgcombo{Цикл} и Количество циклов]
	Эти два поля позволяют задать цикличность отчета. Если выбран цикл и количество циклов,
	то система рассчитает анализ по каждому из циклов. Это очень удобно как для исследования
	динамики развития бизнеса, так и для сверки результатов деятельности предприятия.

	\item[\dlgcombo{Статистика по циклам}]
	Комбо-бокс, позволяющий получить \qu{свернутые} статистические значения по
	циклическим величинам. Само-собой разумеется, что этот комбо-бокс может быть
	использован только при выборе цикла и количества циклов.

	При выборе какого-либо варианта статистики по циклам отчет будет содержать
	только одну строку для каждой операции, в которой
	показываются статистическая величина, соответствующая всей совокупности
	циклов.

	Система предоставляет следующие варианты выбора в этом комбо-боксе:
	\begin{description}
		\item[Среднее] Рассчитывается среднее арифметическое для каждой величины.
		\item[Минимум] Показывается минимальное значение по всей выборки циклов.
		\item[Максимум] Показывается максимальное значение по всей выборки циклов.
		\item[Тренд] Показывается тенденцию изменения значения на основе данных
		по циклам. Значение тренда рассчитывается с помощью построения линейной
		регрессии. Коэффициент наклона полученной линии и дает значение тренда,
		выводимое в таблице.
	\end{description}

	Обратим внимание на то, что изменение параметров фильтрации из таблицы,
	при котором меняется только статистика по циклам, не влечет за собой
	полного пересчета отчета.

	Одним из наиболее важных применений обсуждаемой опции
	является расчет средних остатков за период с требуемой цикличностью,
	кроме того, функция позволяет анализировать макрохарактеристики
	документооборота по организации.

	\item[\dlgflag{Рассчитывать остатки}]
	Если этот признак включен, то система рассчитает входящие и исходящие остатки за указанный
	период. При использовании циклов будут рассчитаны остатки на начало первого цикла,
	промежуточные и конечные остатки.

	Хотя включение этого флага значительно увеличивает время подготовки отчета, он может быть
	полезен для проверки правильности ведения товарного учета на предприятии.

	\item[\dlgflag{Рассчитывать среднее количество строк в документах}]
	Данный флаг предназначен, в основном, для целей отладки и анализа содержания базы данных.
	Если вы его установите, то система рассчитает среднее количество товарных строк для
	документов, соответствующих каждому из видов операции (само собой разумеется, что для
	бухгалтерских документов и оплат эти значения будут нулевыми).
	Учтите, что эта опция несколько снижает производительность расчета.

	\item[\dlgbutton{Дополнительно}]
	Открывает диалог с дополнительными параметрами отчета.
	На текущий момент этот диалог включает в себя только поле ввода периода отгрузки.
	%construction
\end{description}

\subsection{Пояснения по расчету статистики}

\ppypictsc{plot-opgrpng}{График, иллюстрирующий значения статистик}{0.3}

Для того, чтобы вы смогли наглядно увидеть смысл статистических характеристик, рассчитываемых
по циклическому отчету, мы привели график (рис.~\ref{pic-plot-opgrpng}).
Вы можете сами получить такой график выбрав соответствующую функцию в таблице отчета.

Приведенный график отображает значения группировки за один год с недельными циклами.
Тонкими зелеными линиями показаны, соответственно, минимум, среднее значение и максимум.
Эти параметры вряд ли требуют пояснений.

Красная линия показывает тренд значений отчета. Фактически, это - максимально
точное приближение данных отчета к прямой линии. Польза от величины тренда
состоит в том, что она, убирая неровности, показывает направление и величину
изменения отчетных цифр. Так, красная линия на приведенном графике говорит
о том, что в течении года сумма по операции \qu{Приход товара от поставщика},
в целом, увеличивалась (не смотря на локальные взлеты и падения).

%topic(BROWSER_BILLOPGRPNG)

\subsection{Таблица группировки товарных операций}

\ppypictsc{brw-opgrpng}{}{0.4}

Таблица отчета (рис.~\ref{pic-brw-opgrpng}) состоит из следующих колонок:

\begin{description}
	\item[Вид операции]
	Наименование вида операции

	\item[Количество документов]
	Количество документов, соответствующих операции.

	Колонка появляется только при расчете по документам.

	\item[Количество]
	При расчете по строкам товарных документов таблица содержит колонки
	\qu{Количество торговых единиц} и \qu{Количество физических единиц}.
	Эти колонки отражают соответствующее количество товара, участвующего
	в операции.

	\item[Номинальная сумма]
	При расчете по документам это - просуммированные по операциям значения номинальных
	сумм документов.

	При расчете по товарным строкам - либо сумма в ценах поступления, либо сумма в
	ценах реализации, в зависимости от конфигурации соответствующих видов операций.

	\item[Сумма в ценах поступления] Здесь отражена только стандартная сумма поступления плюс
	нестандартные, но замещающие стандартную сумму поступления (см. раздел посвященный типам
	товаров)

	\item[Сумма в ценах реализации] Здесь отражена только стандартная сумма реализации плюс
	нестандартные, но замещающие стандартную сумму реализации (см. раздел посвященный типам
	товаров).

	Важно заметить, что величины в колонке содержат \qu{чистые} цены реализации, то есть,
	с учетом скидки.

	\item[Скидка]
	Сумма скидки по документам или товарным строкам.

	\item[Доходность] (для видов операций, в которых установлен признак \qu{Доходная}). Если в
	параметрах настройки указан способ расчета доходности \qu{По оплате}, то для оплачиваемых
	операций доходность вычисляется по факту оплаты, то есть в строках, соответствующих оплатам
	доходных операций

	\item[Дополнительные суммы]
	Если в фильтре установлен \dlgcombo{Дополнительный тип товара}, то таблица будет содержать
	две колонки, в которых отображаются суммы в ценах поступления и реализации, определенные
	для товаров заданного типа.

	\item[Количество строк]
	\item[Среднее количество строк]
	Две колонки, отображаемые в случае если в фильтре установлен флаг
	\dlgflag{Рассчитывать среднее количество строк в документах}.
	Здесь показано, соответственно, общее и среднее количество строк в документах
	по каждому виду операции.

	Естественно, для строк остатков, а так же при расчете отчета по товарным
	строкам, эти показатели пустые.

\end{description}

В таблице группировки операций доступны следующие действия:

	\paragraph{Деталировка}\indent\keyb{Enter}
	Для отчета, рассчитанного по документам, показывает реестр документов, соответствующих
	фильтру отчета и операции в выбранной строке.

	Если отчет рассчитывается по товарным строкам, то показывает анализ товарных операций,
	соответствующих выбранной строке и фильтру отчета.

	Если вы вызываете эту функцию на строке, соответствующей входящим либо исходящим
	остатка, то на экране появится таблица остатков либо список лотов
	(если отчет строится по строкам товарных документов).

	\paragraph{Печать}\indent\keyb{F7}
	Печать отчета.
	Стандартные возможности печать отчета включают два варианта:
		\begin{description}
			\item[обычный отчет]
			\item[отчет с деталировкой]  в этом случае с каждой строкой,
			которую вы видите в таблице на экране будут печататься строки детализации.
		\end{description}

	\paragraph{Фильтр}\indent\keyb{Ctrl-V}
	Позволяет изменить параметры фильтрации для текущей таблицы.

\subsection{Замечания по специальным строкам отчета}

При некоторых условиях отчет может содержать следующие строки, не проецируемые
непосредственно на какие-либо конкретные виды операций:

\begin{description}
	\item[Начальный остаток]
	Остаток на дату, предшествующую начальной дате периода отчета.
	Если отчет считается с открытой левой границей периода (с начала
	ведения учета), то значения начального остатка будут нулевыми.

	Суммовые величины остатков рассчитываются по средним ценам.

	\item[Конечный остаток]
	Остаток на конечную дату периода расчета отчета.
	Если отчет считается с открытой правой границей периода,
	то значения конечного остатка рассчитываются как \qu{текущий} остаток
	(учитывает все операции, присутствующие в базе данных).

	\item[Межскладской приход]
	Искусственно сформированная строка, соответствующая приходу на склад-получатель
	товара, отправленного со склада-отправителя внутренней передачей (подробно этот
	вопрос рассмотрен выше).

	\item[Итоговая строка]
	Суммирует значения некоторых колонок. Детально методика этого
	суммирования обсуждается ниже.
\end{description}

\subsection{Методика расчета итоговых величин отчета}

Основное назначение итоговой строки - верификация правильности учетных
операций в системе. Для того, чтобы такая верификация была возможно
необходимо рассчитывать отчет с остатками (флаг \dlgflag{Рассчитывать остатки} в
фильтре).

При расчете по документам проверка осуществляется по итоговым суммам
в ценах поступления и реализации. Эти суммы должны быть близки к нулю.
Небольшое (в пределах нескольких рублей) отличие от нуля может
объясняться ошибками округления из-за многократного сложения и
округления большого количества малых величин.

При расчете по товарным строкам документов - необходимо проверять
итоги в колонках количества торговых единиц и сумм в ценах поступления и
реализации. Соответствующие значения должны быть нулевыми.

Суммирование перечисленных колонок реализуется следующим образом:

\begin{itemize}
	\item Начальные остатки включаются в результат со знаком \qu{плюс}.
	\item Конечные остатки вычитаются из результата.
	\item Приходные операции прибавляются.
	\item Расходные операции вычитаются.
	\item Операции переоценки прибавляются (переоценка, уменьшающая учетные
	цены будет представлена отрицательной величиной).
	\item Операции модификации прибавляются (так как итоговые величины
	по документам модификации равны разнице между приходуемой и расходуемой
	частями этих документов).
\end{itemize}

Следует остановиться на подведении итогов сумм в ценах реализации. Отчет
может быть сведен только в терминах учетных цен. То есть, без скидки.
Так как колонка сумм в ценах реализации содержит поправку на скидку,
то перед включением в общий результат колонки суммы в ценах реализации и
скидки складываются (то есть, убирается поправка на скидку).

Дополнительный нюанс связан с искусственной строкой межскладского прихода:
в ней сумма в ценах реализации отражается так же, как и по остальным операциям,
с поправкой на скидку. Однако сама сумма скидки в соответствующем столбце отсутствует
так как в противном случае эта скидка при суммировании итога будет учтена дважды
(по межскладскому расходу и межскладскому приходу).

\subsubsection{Причины расхождения сумм отчета}
Описанные в предыдущем подразделе итоговые суммы могут быть не равны нулю (значительно
отличаться от нуля для группировки по документам) по следующим причинам:
\begin{description}
	\item[Некоторые типы товары учитываются специфическими типами сумм]
	Данная ситуация не является аварийной, но есть следствие особенностей
	конфигурации учета на вашем предприятии.

	Проще всего выявить эту причину можно выбрав \qu{подозреваемый} тип
	товара в комбо-боксе \dlgcombo{Доп тип товара} фильтра отчета.

	Если в колонках сумм по дополнительному товару вы увидите сумму,
	\qu{похожую} на величину рассогласования, то причина скорее всего
	в этом товарном типе.

	\item[Рассогласование между суммами документов и суммами по строкам документов]
	Такая ситуация является сбойной.

	Идентифицировать ее можно вызовом функции проверки сумм по
	документам (\ppymenu{Админ\rdir Корректировка\rdir Проверка сумм по документам}).
	Если проверка выявила несоответствия между суммами документов и суммами
	по строкам в терминах цен поступления или реализации (обычно \ppyrsrv{COST} и \ppyrsrv{PRICE}),
	то их можно скорректировать функцией пересчета проводок по документам
	(\ppymenu{Админ\rdir Корректировка\rdir Пересчет проводок по документам}).

	\item[Ошибки в операциях по лотам или в самих лотах]
	Сбойная ситуация.

	Идентифицировать и исправить проблему можно корректировкой лотов
	(стр.~\pageref{sec-ppview-lots}).

	\item[Общий сбой в базе данных]
	Сбойная ситуация.

	Возможно, в результате сбоя в базе данных произошло нарушение
	целостности данных, повлекшие, в частности, рассогласование итогов
	группировки товарных операций.

\end{description}

%endtopic

\section{Товарооборот}

Этот отчет показывает суммовые значения движения товаров по дням. Операции с товарами
детализируются по группам операций:

\begin{itemize}
	\item Поступление от поставщиков
	\item Поступления из других складов (если выбрана фильтрация по складу)
	\item Возврат розничный (сюда входят все возвраты, привязанные к
	не именованным операциям продажи).
	\item Возврат от покупателей (сюда входят все возвраты, привязанные к
	именованным операциям продажи)
	\item Возвраты поставщикам (все возвраты, привязанные к операциям
	прихода от поставщиков)
	\item Расход розничный
	\item Расход по именованным операциям продажи
	\item Передачи на другие склады (если выбрана фильтрация по складу)
	\item Оплаты (итоговые суммы оплат за период, поступивших по именованным операциям продажи)
	\item Доход (валовая доходность по всем видам операций, помеченным как доходные)
\end{itemize}

Для того чтобы получить отчет о товарообороте предприятия следует вызвать пункт меню
\ppymenu{Отчетность\rdir Товарооборот}.

\subsection{Фильтр отчета о товарообороте}

\ppypict{dlg-007}{Отчет о товарообороте}

Вид диалога фильтра отчета о товарообороте показан на рис.~\ref{pic-dlg-007}.

\begin{description}
	\item[Период]
	Период, за который будет анализироваться товарооборот.

	\item[\dlgcombo{Склад}]
	Склад, по которому следует ограничит расчет отчета. Если склад не указан, то отчет строится
	по всем складам. В этом случае внутренние перемещения товаров не учитываются (их итоговая
	сумма будет равна нулю).

	\item[\dlgcombo{Поставщик}]
	Вы можете выбрать в этом комбо-боксе поставщика. В этом случае отчет будет ограничен только
	теми лотами, которые изначально поступили от выбранного поставщика.

	\item[\dlgcombo{Группа товаров}]
	Выбор группы позволит получить отчет, включающий в себя данные о товародвижении только
	этой группы.
	Допускается выбор обыкновенной, альтернативной группы, либо группы верхнего уровня.

	\item[\dlgcombo{Товар}]
	Комбо-бокс, в котором может быть выбран единственный товар, по которому строится отчет.

	\item[\dlgbutton{Фильтр}]
	По этой кнопке вы имеете возможность сформировать сложные критерии отбора товаров, по
	которым рассчитывается товарооборот.

\end{description}

\subsection{Таблица товарооборота}

\ppypictsc{brw-002}{Товарооборот}{0.4}

Действия в таблице товарооборота

	\paragraph{Группировка операций}\indent\keyb{Enter}
	Детализация строки отчета с подробной разбивкой по видам операций. Детализирующий отчет
	показывается за день, соответствующий выбранной строке.

	\paragraph{Печать}\indent\keyb{F7}
	Вывод отчета на печать.

\section{Налоговый анализ товарооборота}

Отчет \qu{Налоговый анализ товарооборота} рассчитывает обороты и величины налогообложения
в разрезе товаров. На базе этого отчета могут быть получены значения, необходимые для
подготовки налоговых деклараций.
Доступ к отчету возможен через пункт меню \ppymenu{Отчетность\rdir Налоговый анализ товарооборота}.

\subsection{Фильтр отчета}

\ppypict{dlg-008}{Налоговый анализ товарооборота}

Диалог фильтра налогового анализа товарооборота показан на рис.~\ref{pic-dlg-008}.
Далее следует описание его управляющих элементов.

\begin{description}
	\item[Период]
	Период, в который попадают документы, обрабатываемые данным отчетом.

	\item[Период поступления товаров]
	Период, ограничивающий дату поступления лотов, операции по которым
	попадают в отчет.

	\item[\dlgcombo{Склад}]
	Позволяет ограничить отчет выбранным складом.

	\item[\dlgcombo{Вид операции}]

	\item[\dlgcombo{Группа товаров}]

	\item[\dlgcombo{Поставщик}]

	\item[\dlgcombo{Агент поставщика}]

	\item[\dlgcombo{Подстановка товара}]

	\item[\dlgflag{Только подакцизные товары}]

	\item[\dlgflag{Игнорировать признак освобождения поставщика от НДС}]

	\item[\dlgflag{Рассчитывать по оплатам}]

	\item[\dlgradioc{Дифференциация}]
	Блок переключателей, позволяющий задать способ разбивки строк
	отчета по следующим критериям:
	\begin{description}
		\item[\dlgradioi{Нет}]
		\item[\dlgradioi{По налоговым ставкам}]
		\item[\dlgradioi{По входящим НДС}]
		\item[\dlgradioi{По исходящим НДС}]
		\item[\dlgradioi{По входящим и исходящим НДС}]
	\end{description}

	\item[\dlgradioc{Книга учета частного предпринимателя}]
	Блок радио-кнопок, определяющий специализированную форму отчета,
	необходимую для частных предпринимателей.
	\begin{description}
		\item[\dlgradioi{Нет}]
		\item[\dlgradioi{По дням}]
		\item[\dlgradioi{По месяцам}]
	\end{description}
\end{description}

В последней строке таблицы отражается итоговая информация по выборке
Включение режима печати отчета \qu{Налоговый анализ товарооборота} осуществляется нажатием
клавиши \keyb{F7}.

\ppypictsc{brw-003}{Таблица налоговый анализ товарооборота}{0.4}

	\paragraph{Деталировка}\indent\keyb{Enter}

	\paragraph{Товар (группа)}\indent\keyb{F2}

	\paragraph{Печать}\indent\keyb{F7}

	\paragraph{Итог}\indent\keyb{F9}

\section{Движение товаров}

Отчет о движении товаров представляет сгруппированную картину движения товаров
в пределах одного либо нескольких складов.

Основным достоинством этого отчета является то, что вы можете видеть одновременно
входящие и исходящие остатки по каждому товару наряду с просуммированными
значениями приходов и расходов.

Для обращения к этому отчету выберите пункт меню \ppymenu{Отчетность\rdir Движение товаров}.

\subsection{Фильтр движения товаров}

\ppypict{dlg-009}{Диалог фильтра движения товаров}

Диалог фильтра движения товаров показан на рис.~\ref{pic-dlg-009}.
Далее описываются управляющие элементы этого фильтра.

\begin{description}
	\item[Период]
	Период, за который необходимо рассчитать отчет.

	Если в учетной записи пользователя установлено ограничение
	периода доступа к документам на чтение, то это ограничение
	будет наложено на введенный здесь период.

	\item[\dlgcombo{Склад}]
	Склад, в пределах которого требуется получить отчет.
	Кнопка \dlgbutton{\dots} справа от этого комбо-бокса позволяет выбрать
	несколько складов.

	Если склад не выбран, то отчет будет рассчитан по всем складам
	предприятия.

	Обратим внимание на то, как отображаются внутренние перемещения товаров
	в зависимость от выбора складов:
	\begin{itemize}
		\item межскладской расход, учтенный в пределах списка выбранных
		складов \footnote{то есть и склад-отправитель и склад-получатель
		выбраны, либо склад вообще не выбран}, не отображается поскольку
		приход равен расходу и на остатки это не влияет.
		\item межскладской расход, склад-отправитель которого находится в
		пределах выбранного списка, а склад-получатель - нет, отображается %
		в колонке \qu{прочий расход}.
		\item межскладской расход, склад-получатель которого находится в
		списке, а склад-отправитель - нет, отображается в колонке
		\qu{прочий приход}.
	\end{itemize}

	\item[\dlgcombo{Поставщик}]
	Выбор в этом комбо-боксе поставщика приведет к тому, что в отчет
	войдут только те операции и остатки, которые соответствуют лотам,
	поступившим от этого поставщика.

	\item[\dlgcombo{Агент поставщика}]
	Отчет по выбранному агенту поставщика строится только по тем лотам,
	которые поступили в систему по документам атрибутом \qu{Агент} которых
	является выбранный агент. Естественно, при расчете входящих и исходящих
	остатков в отчете это ограничение также учитывается.

	\item[\dlgcombo{Группа товаров}]
	Выбор товарной группы позволит ограничить отчет только товарами
	этой группы.

	Допускается выбор как обыкновенных, так и альтернативных и групп,
	а также групп верхнего уровня.

	\dlgbutton{Фильтр\dots} справа от этого комбо-бокса
	позволяет задать произвольную фильтрацию товаров, про которым
	должен быть построен отчет.

	\item[\dlgcombo{Торговая марка}]
	Если вы укажите здесь торговую марку, то отчет будет ограничен
	только теми товарами, атрибутом \qu{Брэнд} которых является выбранное
	значение.

	\item[\dlgflag{Цены поступления без налогов}]
	Установка этого флага приведет к тому, что все цены поступления в
	отчете будут представлены значениями без налогов (НДС, акциза,
	налога с продаж).
\end{description}

\ppypictsc{Brw-004}{Движение товаров}{0.4}

	\paragraph{Деталировка}\indent\keyb{Enter}
	Команда открывает таблицу группировки товарных операций по
	товару, которому соответствует выбранная строка.

	Группировка рассчитывается за тот же период и по тому же
	набору складов, что и отчет о движении товаров.
	Если в фильтре отчета установлен поставщик и (или) агент
	поставщика, то эти параметры также проецируются на таблицу
	группировки товарных операций.

	Таким образом, вы сможете увидеть детализированную информацию
	по операциям и остаткам выбранного товара, которая должна
	совпадать со строкой отчета (естественно, с учетом того, что
	в отчете о движении товаров величины по отдельным операциям
	сгруппированы).

	\paragraph{Товар}\indent\keyb{F2}
	Открывает диалог просмотра и редактирования карточки товара,
	соответствующего текущей строке отчета.

	\paragraph{Лоты}\indent\keyb{F3}
	Открывает таблицу просмотра лотов по товару из выбранной строки отчета.

	Если в фильтре отчета выбран один единственный склад, то лоты
	будут показаны по этому складу, в противном случае в таблице лотов
	отобразятся лоты выбранного товара по всем складам.

	Поставщик из фильтра движения товаров, если выбран, то ограничивает и
	список лотов.
	\paragraph{Печать}\indent\keyb{F7}
	Отправка отчета на печать либо на экспорта.

	Перед тем, как появится стандартный диалог печати, система предложит
	вам выбрать опции, специфичные для этого отчета.
	Здесь программа запрашивает у вас выбор либо полного либо упрощенного
	отчета.

	Полный отчет печатает практически то же, что вы видите в таблице.

	Упрощенный - печатает столбцы начального и конечного остатка, а
	собственно движение представляет только столбцами прихода и расхода.
	То есть, все операции, в результате которых остаток товара
	увеличивается, заносятся в столбец прихода. Операции же, в результате
	которых остаток уменьшается, заносятся в столбец расхода.

	Для упрощенного отчета вы можете выбрать то, в каких ценах отображать
	суммовые величины:
	\begin{itemize}
		\item в номинальных ценах
		\item в ценах поступления %
		\item в ценах реализации
	\end{itemize}

	Поясним оставшиеся три опции:
	\begin{description}
		\item[Печатать средние цены] Не используется (устаревшая опция)
		\item[Не группировать] Отчет не будет группироваться по товарным группам.
		\item[Количество показывать без упаковок] Если в конфигурации
		пользователя, который печатает отчет, установлен флаг
		\dlgflag{Использовать емкость упаковки}, то по умолчанию те товарные
		позиции, в лотах которых заданы емкости упаковок, печатаются в
		формате вроде этого \qu{5/24+3}.
		При установке рассматриваемой опции количество будет печататься в
		обычном виде (для приведенного выше примера - 123).
	\end{description}

	\paragraph{Положить в корзину}\indent\keyb{Ctrl-F4}

	\paragraph{Итоги}\indent\keyb{F9}

В таблице \qu{Движение товаров} отражается  следующая информация

\begin{itemize}
	\item Наименования товара
	\item Остатки товаров на начало периода
	\item Объемы поступлений от поставщика в количественном и суммовом выражении
	\item Прочие поступления, например полученные в результате операции модификации.
	\item Объемы реализованной продукции в количественном и суммовом выражении.
	\item Прочий расход, например, в результате возвратных операций или  модификации
	\item Остатки товаров на конец периода
\end{itemize}

Нажатие клавиши \keyb{Enter} или двойной щелчок мышью над строкой в таблице
приведет к открытию окна \qu{Группировка товарных операций}, где содержится информация
обо всех операциях, над товарами этого наименования, объемы товаров участвующих в операциях
и доходность операций.

Чтобы распечатать отчет \qu{Движение товаров} нажмите клавишу \keyb{F7}.

\section{Фрахт\label{sec-rep-freight}}

Отчет \qu{Фрахт} предназначен для обеспечения сотрудников вашего предприятия оперативной
информацией о том, какие отгрузочные документы и когда должны быть отправлены (или уже отправлены)
потребителю. Также, этот отчет подробно информирует об пунктах отправления и назначения,
сроках доставки, грузовых параметрах отгружаемых товаров.

%topic(DLG_FRGHTFLT)

\subsection{Фильтр отчета по фрахтам}

\ppypict{dlg-137}{Фильтр по документам отгрузки}

Диалог фильтра отчета показан на рис.~\ref{pic-dlg-137}. Перечислим управляющие элементы
диалога:

\begin{description}
	\item[Период документов]
	Период, ограничивающий выборку отчета датой документов.

	\item[Период отгрузки]
	Ограничивающий критерий, предписывающий вводить в отчет только те документы,
	дата отгрузки (из данных по фрахту) которых попадает в заданный период.

	\item[Период доставки]
	Период, ограничивающий отчет датой доставки из информации по фрахту документа.

	\item[\dlgcombo{Вид операции}]
	Если в этом комбо-боксе выбран вид операции, то в отчет попадут
	данные по документам, относящимся к этому виду.

	Список выбора комбо-бокса содержит все виды операций, у которых
	есть признак \dlgflag{Ввод информации по фрахту}, а также
	обобщенные виды операций.

	\item[\dlgcombo{Контрагент}]
	Позволяет посмотреть отчет только по одному контрагенту.

	Список комбо-бокса содержит аналитические статьи, привязанные
	к таблице статей, соответствующей выбранному виду операции.
	Если вид операции не выбран, то в списке отображаются статьи,
	принадлежащие таблице покупателей (стр.~\pageref{sec-commcfg-op}).

	\item[\dlgcombo{Склад}]
	Выбор склада ограничивает отчет только теми документами,
	которые относятся к этому складу.

	\item[\dlgcombo{Транспорт}]
	Этот комбо-бокс позволяет ограничить отчет только теми документами,
	во фрахте которых задано выбранное здесь транспортное средство.

	\item[\dlgcombo{Пункт разгрузки}]
	Ограничивает отчет населенным пунктом или географическим регионом, в который
	должен быть доставлен груз.

	Здесь следует отметить две следующих особенности данного критерия фильтрации:
	\begin{itemize}
		\item Если фрахт, привязанный к документу, содержит пункт разгрузки, то
		фильтрация будет проверяться по этому атрибуту. Если же пункт разгрузки не
		определен, но выбран адрес доставки, то фильтроваться документ будет по
		соответствию населенного пункта из адреса доставки выбранному в этом
		комбо-боксе географическому объекту.

		\item Комбо-бокс позволяет выбрать как собственно населенный пункт, так
		и географический объект верхнего уровня (регион или государство). Если
		выбран объект верхнего уровня, то фрахты будут фильтроваться по принадлежности
		пункта разгрузки этому объекту.
	\end{itemize}

	\item[\dlgcombo{Капитан (водитель)}]
	Выбор здесь конкретной персоналии приведет к тому, что в отчет попадут только
	те записи документов, во фрахте которых установлен соответствующий капитан
	судна или водитель транспортного средства.

	\item[\dlgradioc{Сортировать по}]
	Позволяет выбрать вариант сортировки строк отчета.

	\begin{description}
		\item[\dlgradioi{Дате документа}]
		\item[\dlgradioi{Дате доставки}]
		\item[\dlgradioi{Адресу доставки}]
		\item[\dlgradioi{Пункту разгрузки}]
	\end{description}

	\item[\dlgflag{Только не отгруженные}]
	Если этот флаг установлен, то в отчет попадут только те документы,
	которые не имеют признака \dlgflag{Отгружен}.

	\item[\dlgflag{Заполнять багажные поля}]
	Включение флага предписывает системе строить отчет, содержащий
	колонки грузовых параметров документов. А именно:

	\begin{itemize}
		\item Сумма документа.
		\item Масса брутто (в килограммах).
		\item Грузовой объем (в кубических метрах).
		\item Количество погрузочных мест (число товарных упаковок).
	\end{itemize}

	\item[\dlgflag{Грузовые параметры не зависимо от фрахта}]
	Если этот флаг установлен, то грузовые параметры документов
	рассчитываются не зависимо от того, введены ли в документ
	данные о фрахте или нет.

	При отсутствии этого флага грузовые параметры рассчитываются только
	для документов, имеющих не пустой фрахт.

	\item[\dlgbutton{Теги}]
	Кнопка открывает диалог редактирования фильтра тегов, которому должны соответствовать
	документы, по которым строится отчет.

	Подробно о редактировании фильтров тегов рассказано на стр.~\pageref{sec-tagv-filt}.

\end{description}

%topic(BROWSER_FREIGHT)

\subsection{Таблица отчета по фрахтам}

\ppypictsc{brw-032}{Фрахт}{0.35}

Примерный вид таблицы отчета показан на рис.~\ref{pic-brw-032}.

Таблица содержит следующие колонки:

\begin{description}
	\item[Отгружен] Если документ имеет признак отгружен, то
	в этой колонке виден символ $X$.

	\item[Дата документа]

	\item[Номер документа]

	\item[Контрагент]
	Наименование контрагента по документу.

	\item[Дата доставки]
	Дата доставки, указанная в данных по фрахту.

	\item[Транспорт]
	Наименование транспортного средства из данных по фрахту документа.

	\item[Город назначения]
	Город назначения из данных по фрахту документа.

	\item[Адрес доставки]
	Текст адреса доставки из данных по фрахту документа.

	\item[Сумма]
	Номинальная сумма документа.

	\item[Брутто]
	Суммарная масса брутто в килограммах всех номенклатурных позиций,
	входящих в документ.

	\item[Объем]
	Суммарный грузовой объем в кубических метрах всех номенклатурных позиций,
	входящих в документ.

	\item[Мест]
	Суммарное количество упаковок.

\end{description}

\subsubsection{Действия в таблице}

	\paragraph{Документ}\indent\keyb{Enter}

	Открывает диалог редактирования документа, которому соответствует текущая строка отчета.

	\paragraph{Переключить признак отгрузки}\indent\keyb{F8}

	Изменяет значение признака \dlgflag{Отгружен} документа (то есть,
	если признак отсутствовал, то устанавливает его, если же он
	был включен, то - снимает.

	\paragraph{Итоги}\indent\keyb{F9}

	Открывает диалог итоговых значений отчета.

	\paragraph{Экспорт}\indent\keyb{Ctrl-R}

	Позволяет экспортировать все документы, представленные в отчете
	в соответствии с выбранной конфигурацией экспорта.

	Подробно об экспорте документов см. стр.~\pageref{sec-impexp-bill}.

	\paragraph{Печать}\indent\keyb{F7}

	\paragraph{Фильтр}\indent\keyb{Ctrl-V}
	Позволяет изменить критерии фильтрации отчета.

%endtopic

\section{Анализ отгрузки}

Данный вид отчетности  позволяет получить информацию об отгрузке товаров покупателям, а
также прослеживать выполнение тех или иных заказов, полученных от клиентов.
При обращении к пункту меню \ppymenu{Отчетность\rdir Анализ отгрузки}, появляется диалог
\qu{Анализ отгрузки}, в котором  необходимо указать:

\begin{itemize}
	\item Период времени
	\item Вид операции по отпуску товара
	\item Контрагента
\end{itemize}

Нажмите \dlgbutton{OK}.

\ppypict{Dlg-010}{Диалог редактирования фильтра анализа отгрузки}

\begin{description}

	\item[Период]

	\item[\dlgcombo{Вид операции}]

	\item[\dlgcombo{Контрагент}]

	\item[\dlgcombo{Склад}]

	\item[\dlgflag{Группировать по документам}]

	\item[\dlgflag{Только по неоплаченным}]

\end{description}

\ppypict{brw-005}{Таблица анализа отгрузки}

\paragraph{Деталировка}	\indent\keyb{Enter}
\paragraph{Печать}	\indent\keyb{F7}

Таблица отчета ~\ref{pic-brw-005} содержит следующие графы:

\begin{itemize}
	\item Наименование товара
	\item Количество заказанного товара
	\item Сумма заказанных товаров
	\item Количество отгруженных товаров по заказу
	\item Сумма отгруженных товаров
	\item Количество принятых покупателем товаров
	\item Сумма принятых товаров
\end{itemize}

Для того чтобы распечатать отчет, нажмите клавишу \keyb{F7}

\section{Сравнительный анализ цен поставщиков}

Отчет предназначен, в основном, предприятиям сетевой розницы. Цель сравнения может быть
одна из следующих:
\begin{itemize}
	\item Выявление магазинов, в которые поставщик поставляет товар по завышенным ценам
	\item Сравнение цен поступления между поставщиками
	\item Контроль (пост-фактум) выполнения поставщиками обязательств по контрактным ценам
	\item Автоматическая установка контрактных цен
\end{itemize}

Этот отчет позволяет проанализировать цены поступления товаров от поставщиков в разрезе
складов. Сравнение обеспечивается между, так называемыми, базовыми и фактическими ценами.
Как для базовых, так и для фактических цен предусмотрены различные алгоритмы расчетов.

Для доступа к этому отчету необходимо выбрать пункт меню \ppymenu{Отчетности\rdir Сравнительный
анализ цен}.

\subsubsection{Фильтр}

\ppypict{dlg-110}{Диалог фильтра сравнительного анализа цен}

\begin{description}
	\item[Период]
	Период, за который просматриваются лоты по каждому из товаров.
	Следует обратить внимание на то, что выбор этого периода оказывает значительное влияние на
	значения, отображаемые в таблице отчета.
	При слишком большом периоде разброс цен будет больше по естественным причинам (главная
	из которых - инфляция). При слишком малом периоде система может не заметить приходов
	позиций, которые закупаются у поставщика достаточно редко.

	\item[Поставщик]
	Если вы выберите здесь конкретного поставщика, то отчет будет рассчитываться только по
	этому поставщику.

	\item[Склад]

	\item[Группа товаров]

	\item[Алгоритм расчета фактической цены]

	\item[По первому лоту]

	\item[Среднее по лотам]

	\item[По последнему лоту]

	\item[Минимальная по лотам]

	\item[Минимальная по складам]

	\item[Базовая цена]

	\item[По одному из складов]

	\item[Контрактная]

	\item[Средняя по всем складам]

	\item[Склад для расчета базовой цены]

	\item[Отклонение цен в процентах]

	\item[Исключать строки без контрактных цен]

	\item[Исключать строки с ценой = фактической или ценой = 0]

	\item[Разбивать по поставщикам]
\end{description}

\subsection{Таблица сравнительного анализа цен}

\ppypict{brw-027}{Анализ сравнения цен}

\subsubsection{Действия в таблице}

\paragraph{Товар}\indent\keyb{F2}

\paragraph{Лоты по товару}\indent\keyb{F3}
\paragraph{Контрактные цены}\indent\keyb{F4}
\paragraph{Установить контрактные цены}\indent\keyb{Ctrl-S}
\paragraph{Печать}\indent\keyb{F7}
\paragraph{Фильтр}\indent\keyb{Ctrl-V}

\chapter{Статистика продаж и прогнозирование спроса\label{ch-salesstat}}

\section{Базовые сведения из математической статистики}

Для того чтобы были понятны принципы функционирования модуля прогнозирования спроса, мы
приведем здесь некоторые сведения из теории вероятности и математической статистики.
Постараемся быть предельно краткими.

Рассмотрим пример ежедневных продаж молока за месяц (рис.\ref{pic-statistics}).

\ppypictsc{statistics}{Пример временного ряда}{0.4}

Значения, приведенные в таблице, представляют временной ряд, то есть ряд данных, каждое
значение которого  ассоциировано с некоторым моментом времени (в нашем случае - с датой).
Для дальнейшей работы нам понадобятся следующие понятия:

	\paragraph{Количество значений ряда}
	\[N\]
	Общее число значение в ряду. В нашем примере количество значений ряда равно 31
	\paragraph{i-е значение ряда}
	\[x_{i}\]
		Значение ряда с номером i. Например, 5-е значение нашего ряда равно 59

	\paragraph{Сумма значений ряда}
	\[\sum_{i-1}^N x_{i}\]

	Общая сумма всех значений ряда. Сумма значений ряда продаж молока за март равно 2860.

	\paragraph{Среднее значение ряда}
	\[\bar{x}=\frac{\sum_{i-1}^N x_{i}}{N}\]


	Среднее арифметическое всех значений ряда. То есть, сумма всех значений, поделенная на
	количество значений ряда. Наш пример с продажами молока дает среднее значение равное
	2860/31=92.258 пакетов молока. Среднее значение обладает тем замечательным свойством,
	что сглаживает все неровности ряда и дает оценку, правда, очень грубую, значения ряда
	в единицу времени.

	\paragraph{Стандартное отклонение}
	\[\sigma=\sqrt{\frac{\sum (x_{i}-\bar{x})^{2}}{N-1}}\]

	Стандартное отклонение служит мерой рассеяния ряда. Проще говоря, величина стандартного
	отклонения дает оценку того, на сколько наш ряд \qu{разбросан} относительно среднего значения.
	В примере с продажами молока стандартное отклонение равно 33.181.

	\paragraph{Коэффициент вариации}	 \[\nu=\frac{\sigma}{\bar{x}}\]

	Коэффициент вариации является относительной мерой разброса значений ряда. Величина
	коэффициента вариации в отличие от стандартного отклонения, более понятна, поскольку
	является относительной величиной, независимой от среднего значения и позволяет сравнивать
	один ряд с другим. В нашем примере коэффициент вариации равен 0.3597.
	Если попытаться дать грубые ориентиры для оценки разброса ряда, то можно сказать, что
	значение этого коэффициента меньшее единицы является признаком \qu{хорошего} ряда, и,
	соответственно, чем больше значение коэффициента вариации, тем ряд менее стабилен.

	\paragraph{Тренд временного ряда}
	Долговременная тенденция в изменении значений ряда.
	Тренд может иметь различную форму. Вообще говоря, правильная идентификация формы тренда
	задача сама по себе достаточно сложная. Мы будем рассматривать только линейный тренд,
	аналогичный показанному на рисунке, иллюстрирующем наш пример. Здесь изображена наклонная
	линия линейного тренда в продажах молока. Исходя из рисунка, мы видим, что продажи молока
	увеличиваются, несмотря на то, что имеются кратковременные всплески и снижения в продажах.



Вот, в общем, и все. Если мы что-либо забыли, то по ходу изложения будем пояснять необходимые
понятия.

\section{Принципы работы модуля анализа статистики продаж и прогнозирования}

Прежде всего, сформулируем задачу, стоящую перед нами и выясним, с какими трудностями нам
предстоит столкнуться.

\subsection{Задача прогнозирования спроса}

Наша задача состоит в том, чтобы:
\begin{enumerate}
	\item спрогнозировать спрос на любой из товаров, присутствующих в справочнике, на произвольный
	период времени с максимальной точностью.
	\item иметь средства анализа, позволяющие проверить качество прогноза
	\item избежать индивидуального подхода к каждой позиции в справочнике, поскольку настроить
	каждую из нескольких тысяч позиций практически невозможно
	\item рассчитать прогноз спроса за минимальное время
\end{enumerate}

\subsection{В чем трудности?}

Теперь сформулируем основные проблемы, связанные с нашей задачей:
\begin{enumerate}
	\item Временные ряды продаж по каждому отдельному товару крайне нестабильны. Это значит,
	что по большинству товаров коэффициент вариации превышает (часто на много) единицу.
	\item Временные ряды продаж содержат большое число пропусков, возникающих из-за отсутствия
	товара на складе или в магазине. Эта проблема накладывается на предыдущую в результате
	чего, мы не можем с достаточной точностью заполнить пропуски.
	\item Так как анализ статистики реализуется на уровне отдельных товарных позиций, мы
	вынуждены постулировать, что наши временные ряды продаж лишены какой-либо регулярности
	(сезонности). Это утверждение можно попытаться оспорить, но мы будем на нем настаивать,
	поскольку наш опыт убеждает нас именно в этом. Здесь уместно заметить, что не следует
	путать статистику по одному товару и статистику по выборке товаров. Так, например, временной
	ряд продаж пива имеет четко выраженную регулярность, в то время как ряд продаж совершенно
	конкретного наименования пива (скажем, Хольстен  12\% в бутылках по 0,33 литра)
	регулярности не имеет. Еще одна оговорка по поводу этого утверждения: если ваше предприятие
	торгует очень узкой номенклатурой (до 100 наименований), то ряды по большинству из этих
	позиций все-таки будут регулярны. Аналогично, даже в большом торговом предприятии,
	оперирующем десятками тысяч наименований товаров, могут существовать очень стабильные с точки
	зрения спроса позиции, однако их число крайне мало и их сложно идентифицировать. Возможно,
	в следующих версиях нам удастся реализовать процесс автоматической идентификации таких товаров.
	\item При построении прогноза необходимо учитывать выходные дни. Так, если вы хотите знать
	прогноз продаж на следующие 14 дней, но ваше предприятие по воскресениям не работает, то
	система должна учесть этот факт и спрогнозировать спрос только на рабочие дни, попадающие
	в заданный интервал.
\end{enumerate}

\subsection{Как работает прогнозирование в системе \ppybrand{}}

Для прогнозирования спроса и анализа статистики продаж в первую очередь необходимо построить
таблицу продаж. Таблица продаж - это таблица, в которой собраны данные о продажах каждого
товара за каждый день и по каждому складу. Информация о продажах в этой таблице учитывается
в количественных единицах и суммарных ценах продажи.
Для использования модуля прогнозирования таблица продаж должна быть предварительно заполнена.
Сама по себе, таблица продаж является исключительно полезным инструментом, используемым для
анализа статистики продаж. Она позволяет идентифицировать наиболее стабильные с точки зрения
спроса товарные позиции, а также обнаружить товары, которые есть на остатке, но продаются по
каким-либо причинам, очень слабо.

\subsubsection{Достоверность таблицы продаж}

При построении таблицы продаж система отслеживает остатки товаров по каждому складу и на
каждый день. Если на какую-либо дату остаток товара нулевой, то этот день пропускается, то
есть мы не можем ничего сказать о продажах в такой день. Источником проблем являются дни, в
которые товар присутствовал не весь рабочий день. К сожалению, мы не видим способа обойти
эту сложность, поэтому считаем, что если товар был на складе хотя бы часть дня, то был весь
день.

\subsubsection{Охват истории продаж для прогнозирования}

Для построения прогноза продаж система использует данные истории продаж
не по календарному периоду, а по количеству достоверных точек продаж.
То есть, программа извлекает заданное в конфигурации количество точек,
соответствующих дням, на которые приходились не нулевые остатки товара.

\paragraph{Критерий надежности прогноза}
Для \qu{отбраковки} товаров, прогноз продаж по которым невозможно
построить с достаточным уровнем надежности, применяется критерий
надежности прогноза, основанный на отношении извлеченного из таблицы
продаж количества точек продаж к периоду (в днях), на который эти
точки приходятся. Чем меньше это отношение, тем менее надежен прогноз.

\ppypict{brw-033-example}{Иллюстрация критерия надежности прогноза}

Для иллюстрации критерия приведем следующий пример (см. рис.\ref{pic-brw-033-example}):
некоторый товар А имеет таблицу продаж за период до 30 июня 2007 года такую,
как показана на рисунке. Если система строит прогноз на период от дня, следующего
за этой датой и в конфигурации определено 14 точек прогнозирования, то
система отсчитает эти точки от 30 июня до 15 июня включительно. При этом
дни, когда товара на остатке не было исключаются из рассмотрения (на рисунке
выделены цветом 18 и 19 июня).

Таким образом, надежность прогноза составляет 14 точек / 16 дней = 0.875 = 87.5\%.

Если критерий надежности прогноза составляет 90\%, то прогноз по нашему примеру
будет признан ненадежным, если же критерий надежности, скажем, 75\%, то прогноз
по такому примеру признается адекватным.

\subsubsection{Учет выходных дней}

Проблема учета выходных дней состоит из двух частей:
\begin{enumerate}
	\item 	Выходные дни, встречающиеся в периоде построения таблицы продаж.
	Такие выходные система распознает автоматически по отсутствию в эти дни документов,
	относящихся к видам операций продаж. В выходные дни значения в таблицу продаж не
	заносятся. Здесь потенциальным источником ошибок в построении таблицы продаж может
	оказаться наличие случайного единственного документа продаж. В этом случае система не
	сможет распознать такой день как выходной и неоправданно зафиксирует нулевые продажи по
	тем товарам, которые присутствовали в этот день на складе.
	\item 	Выходные дни, попадающие в период, на который строится прогноз продаж.
	Так как продаж в дни, на которые строится прогноз, нет и быть не может (иначе, зачем нам
	прогноз), то такие выходные должны быть указаны явно в конфигурации.
\end{enumerate}

\subsubsection{Методы прогнозирования}

Для собственно прогнозирования в системе используется один из двух алгоритмов: простое
среднее или линейная аппроксимация. Разберем каждый из этих алгоритмов.

\paragraph{Прогнозирование по простому среднему}

Это - наиболее простой способ спрогнозировать спрос на товар в будущем. Для построения
прогноза используется среднее значение ряда и система считает, что в каждый из дней, на
который необходим прогноз будет продано количество товара, равное среднему значению продаж
за предыдущий период. Такой метод не учитывает тренд, однако может быть настроен так, чтобы
среднее значение продаж рассчитывалось не по всей статистике, а по любому числу последних
точек. В этом случае прогноз будет учитывать последние тенденции в спросе на каждый из товаров.

\paragraph{Прогнозирование по линейной аппроксимации}

Линейная аппроксимация несколько более сложный метод прогнозирования. В соответствии с этим
методом система строит уравнение тренда по заданному количеству последних точек в таблице
продаж и прогнозирует спрос исходя из этого уравнения. По сравнению с предыдущим методом,
этот имеет преимущество в плане учета тренда, но может проиграть в надежности, если количество
точек для построения уравнения тренда недостаточно велико.

\section{Конфигурация прогнозирования\label{sec-cfg-predict}}

\ppyadmin{
	В случае если вы начали эксплуатировать систему \ppybrand{} с версии более ранней, чем 4.4.11,
	вам необходимо в каталог базы данных скопировать пустые файлы данных psales.btr и gstat.btr
	и удалить из этого каталога файл garmapar.btr.
}

Для того чтобы правильно настроить заполнение таблицы продаж и прогнозирование, прежде
всего, необходимо определиться со следующими вопросами:

\begin{enumerate}
	\item Какие виды операций должны учитываться как продажи?
	Если вы хотите, чтобы продажи учитывались по нескольким операциям, то заведите обобщенную
	операцию и ассоциируйте ее с этими видами операций.
	\item 	С какой даты следует начинать учет продаж в таблице продаж?
	Этот вопрос существенен из-за того, что таблицу продаж следует строить не с самого первого
	дня функционирования учета на предприятии, с некоторым временным смещением. Основная причина
	этого в том, что начальный период внедрения учета характеризуется высоким уровнем ошибок в
	учете. С другой стороны, потеря информации о, скажем, одном месяце работы не столь
	существенна, как возможные искажения, вносимые такими ошибками.
	\item 	Какие дни недели и даты учитывать как выходные дни?
	Этот вопрос не существенен для построения таблицы продаж, но очень критичен для расчета
	прогноза спроса на будущий период.
\end{enumerate}

\subsection{Диалог конфигурации прогнозирования}

\ppypictsc{dlg-045}{Конфигурация прогноза продаж}{0.5}

Для вызова диалога конфигурации прогнозирования обратитесь к пункту меню
\ppymenu{Админ\rdir Прочие конфигурации\rdir Конфигурация прогноза продаж}. После этого на экране
появится диалог, изображенный на рис.~\ref{pic-dlg-045}.

\begin{description}
	\item[\dlgcombo{Операция продажи товаров}]
	Комбо-бокс, в котором следует выбрать вид операции продаж.

	\item[\dlgcombo{Операция закупки товаров}]
	Вид операции, относящийся к типу драфт-приход, который будет
	применяться для создания документа закупки при расчете
	заказа поставщику (стр.~\pageref{sec-suppl-order}).

	\item[Дата начала продаж]
	Дата, с которой следует начать построение таблицы продаж. Указанный здесь день включается
	в период построения таблицы продаж.

	\item[Дата конца расчета]

	\item[\dlgradioc{Метод прогнозирования}]
	В отличие от первых двух параметров, этот переключатель не влияет на построение таблицы
	продаж, поэтому может быть изменен в любой момент. Переключатель позволяет выбрать, какой
	метод следует использовать для расчета прогноза.

	\item[Критерий надежности прогноза (\%)]
	Здесь можно указать критерий надежности прогноза. Пустой (нулевое) значение будет
	сигнализировать системе, что вы не желаете применять ограничение этого прогноза.

	\item[Количество точек для построения прогноза]
	Количество последних достоверных значений в таблице продаж, которые следует использовать
	для вычисления ожидаемых продаж. Чем больше это значение, тем дольше система будет
	рассчитывать прогноз. Вместе с тем, увеличение этого параметра вовсе не означает улучшения
	качества прогноза. В каждом конкретном случае лучшим советчиком будет опыт. Первоначально
	можно рекомендовать использовать 14 последних значений и, если прогноз не будет
	удовлетворительным, то менять эту величину в большую или меньшую сторону.

	Обратите внимание на то, что речь идет не о количестве последних дней, а именно о количестве
	достоверных значений в таблице продаж. Например, в некоторых случаях 14 значений могут
	растянуться на месяц и больше из-за наличия пропусков в таблице продаж.

	Нулевое значение интерпретируется, как требование строить прогноз, полагаясь на все известные
	значения продаж. При этом, если вы используете метод простого среднего, то прогноз будет
	строиться максимально быстро, поскольку, система рассчитывает и хранит среднее значение
	продаж за весь период построения. Линейная же аппроксимация будет рассчитываться очень
	долго, из-за необходимости обработать все значения продаж. Вообще говоря, комбинация
	линейной аппроксимации и нулевого параметра количества точек не имеет смысла, так как,
	такой прогноз будет мало отличаться от линейного, а затраты времени увеличиваются
	многократно.

	\item[Минимальное число точек]

	\item[Параметр Q модели]
	Этот параметр в настоящее время не используется. Значение должно быть нулевым.

	\item[Страховочный запас по умолчанию (дней)]

	\item[\dlgradioc{Использование емкости упаковки}]
	Переключатель, регулирующий вопрос применения емкостей упаковок при
	расчете рекомендуемого заказа:
	\begin{description}
		\item[\dlgradioi{Не использовать}]
		При расчете рекомендуемого заказа система не будет пытаться округлять
		величину заказа до емкостей упаковок.

		\item[\dlgradioi{Предпочтение отдавать емкости упаковки поставки}]
		Если установлен этот вариант, то при расчете рекомендуемого заказа
		для некоторого товара, система в первую очередь будет рассматривать
		емкость упаковки поставки, заданную для товара (см. стр.~\pageref{sec-goodsvad}).

		Если емкость упаковки поставки для товара не задана, то система будет
		пытаться использовать емкость упаковки из последнего лота этого товара.

		\item[\dlgradioi{Предпочтение отдавать емкости упаковки из последнего лота}]
		Это положение переключателя - противоположность предыдущему. То есть, сначала
		программа будет пытаться использовать емкость упаковки из последнего лота
		товара, а затем, если это значение нулевое, емкость упаковки поставки.
	\end{description}

	\item[\dlgradioc{Округление рекомендуемого заказа}]
	Переключатель, регулирующий метод округления рекомендуемого
	заказа. Этот переключатель имеет смысл только для тех случаев, когда
	системе предписано учитывать емкости упаковок (см. описание переключателя выше).
	\begin{description}
		\item[\dlgradioi{До емкости упаковки вниз}]
		Величина рекомендуемого заказа будет округляться до меньшего значения, кратного
		емкости упаковки.

		Обратите внимание на флаг \dlgflag{Если после округления рекомендуемый заказ нулевой, то 1 упаковка},
		описанный ниже. Он также влияет на изменение величины рекомендуемого заказа в
		зависимости от емкости упаковки.

		\item[\dlgradioi{До емкости упаковки вверх}]
		Величина рекомендуемого заказа будет округляться до большего значения, кратного
		емкости упаковки.

		\item[\dlgradioi{До ближайшей емкости упаковки}]
		Величина рекомендуемого заказа будет округляться до ближайшего значения, кратного
		емкости упаковки.
	\end{description}

	\item[\dlgcombo{Вид котировки поправочого коэффициента}]

	\item[\dlgflag{Если после округления рекомендуемый заказ нулевой, то 1 упаковка}]
	Если этот флаг установлен и рассчитанный рекомендуемый заказа (после учета емкости упаковки)
	оказался равен нулю, то система предложит заказать одну упаковку товара.

	Другими словами, если рекомендуемый заказ меньше одной упаковки,
	то заказываем одну упаковку. Это - корректирующий флаг, обычно применяемый
	для правиле округления \dlgradioi{До емкости упаковки вниз}.

	\item[\dlgflag{Учитывать страховочный запас товаров}]
	Этот флаг сам по себе не влияет на расчет, но используется для автоматической
	установки одноименного флага в диалоге расчета заказа поставщику.

	\item[\dlgflag{Минимальный остаток трактовать как минимальный запас}]
	Специальная опция, изменяющая алгоритм поправки рекомендуемого заказа
	При установке этого флага рекомендуемый заказ рассчитывается по следующей
	формуле:

	$O = (P > M) ? (P - R) : (M - R)$

	где:
	\begin{description}
		\item[$O$] рекомендуемый заказа поставщику
		\item[$P$] прогноз продаж
		\item[$M$] минимальный запас товара
		\item[$R$] текущий остаток товара
	\end{description}

	Напомним, что если описываемый флаг не установлен, то формула расчета
	следующая:

	$O = P + M - R$

	При использовании страховочного запаса в днях этот флаг не учитывается.

	\item[\dlgflag{Округлять заказ, введенный вручную}]
	Установленный флаг предписывает системе автоматически округлять значение заказа, введенное
	пользователем в таблице, по правилам, аналогичным тем, что используются при автоматическом
	расчете заказа.

	\item[\dlgradioc{Фиксация артикулов по поставщику}]
	\begin{description}
		\item[\dlgradioi{Не применять}]
		\item[\dlgradioi{Дополнить товарами, имеющими коды по поставщику}]
		\item[\dlgradioi{Ограничить товарами, имеющими коды по поставщику}]
	\end{description}

\end{description}

\subsection{Редактирование списка выходных дней}

Для редактирования выходных дней выберите пункт меню \ppymenu{Админ\rdir Прочие конфигурации\rdir Выходные дни (для прогнозирования)}.
Диалог редактирования списка выходных дней представлен комбо-боксом выбора склада,
списком выходных дней и кнопками добавления и удаления элементов списка.
Выходные дни могут задаваться раздельно по каждому складу либо для всех складов одновременно.

\ppypict{dlg-holiday}{Выходной день}

Система использует следующий алгоритм определения является ли заданный день выходным:
\begin{enumerate}
 	\item	Если для заданного склада заданная дата явно указана как выходной день то так оно и
 	есть, иначе
	\item	Если для заданного склада календарный день, соответствующий заданной дате определен
	как выходной, то дата признается выходным днем, иначе
	\item	Если по заданному складу день недели, соответствующий заданной дате определен как
	выходной, то дата - выходной, иначе
	\item	Повторяем тот же алгоритм, только для списка определенного для всех складов.
\end{enumerate}

Вы можете задавать выходные дни одним из трех способов: днем недели, днем года (действительным
для всех лет) или полной датой.
Диалог редактирования выходного дня выглядит так, как показано на рис.~\ref{pic-dlg-holiday}.

\begin{description}
	\item[Индикатор наименования склада]
	Показывает, для какого склада вносится выходной день. Если для всех, то
	здесь появится текст \qu{Все склады}.

	\item[\dlgradioc{Вид выходного дня}]
	Выберите один из трех вариантов. В пояснении нуждается только средний вариант: календарный
	день. Это - регулярный ежегодный выходной день. Например, 1 января.

	\item[Дата]
	В этом поле вводится либо дата, либо календарный день. Дата вводится по обычным правилам,
	используемых в системе \ppybrand{}. Для календарного дня необходимо указать через разделитель
	день и месяц.

	\item[\dlgcombo{День недели}]
	Если вы выбрали вид выходного дня - день недели, то в этом комбо-боксе необходимо указать
	какой именно день недели является выходным.
\end{description}

\section{Заполнение таблицы продаж}

\subsection{Параметры заполнения таблицы продаж}

\ppypict{dlg-046}{Параметры заполнения таблицы продаж}

Перед началом эксплуатации модуля прогнозирования необходимо осуществить заполнение таблицы
продаж, для того, чтобы она содержала данные обо всех предшествующих продажах вашего
предприятия, начиная со дня, указанного в конфигурации как дата начала продаж.
В дальнейшем, следует дополнять таблицу новыми данными, для поддержки ее актуальности.
Для выполнения заполнения таблицы продаж выберите пункт меню \ppymenu{Админ\rdir Заполнение таблицы продаж}.
Вы увидите диалог, аналогичный показанному на рис.~\ref{pic-dlg-046}.

Верхний левый блок в этом диалоге - информационный. В нем показаны некоторые параметры из
конфигурации прогнозирования, помогающие вам сориентироваться в выборе параметров заполнения
таблицы.

В следующей таблице перечислены параметры заполнения таблицы продаж

\begin{description}
	\item[Дата, до которой выполнять расчет]
	День, до которого (включительно) следует заполнить таблицу продаж. Мы рекомендуем указывать
	здесь дату, отстоящую на несколько дней назад от текущей. Это позволит избежать ошибок в
	статистике, связанных с возможной корректировкой документов за последние дни.

	\item[Последняя заполненная дата]
	Справочное поле, показывающее дату, до которой таблица продаж уже построена на текущий момент.

	\item[\dlgcombo{Вид операции учета продаж}]
	Справочное поле, отображающее наименование вида операций, учитываемой как операция продаж.

	\item[Дата, до которой выполняется расчет]
	Здесь следует указать дату, до которой должна быть заполнена таблица продаж (включительно).

	Система допускает ввод в этом поле шаблонизированной даты, использующей специальный символ $@$.

	\item[Дата начала перерасчета]
	Дата, с которой система должна начать пересчет таблицы продаж. Это значение игнорируется,
	если выбран режим полного пересчета таблицы.

	Так же как и для даты завершения расчета здесь можно использовать шаблонизированное
	представление даты с использованием символа $@$.

	Если это поле не заполнено, то заполнение таблицы пойдет от последней заполненной
	даны (значение его указано в поле \qu{Последняя заполненная дата}).

	При установке в этом поле значения, превышающего дату начала пересчета, система
	выдаст сообщение об ошибке.

	\item[\dlgcombo{Товарная группа}]
	Указав здесь группу товаров, вы ограничите заполнение таблицы только теми товарами,
	которые входят в эту группу.

	Этот параметр нужен крайне редко и, в основном, для отладки процесса. Поэтому, мы не
	рекомендуем использовать его.

	\item[\dlgcombo{Товар}]
	Если в этом комбо-боксе выбран товар, то заполнение таблицы будет осуществлено только для
	этого товара.

	В таком случае блокируется опция полного пересчета таблицы.

	Выбор отдельного товара может быть полезен для проверки правильности заполнения или полного пересчета
	таблицы для одного единственного товара с целью отладки различных параметров расчета.

	\item[\dlgradioi{Заполнить отсутствующие дни}]
	Это положение переключателя предписывает системе заполнить таблицу продаж только для
	тех дней, которые позже даты последнего заполнения. То есть, здесь речь идет о дополнении
	таблицы продаж. Обычно именно это положение переключателя и следует использовать.

	Если вы указали дату начала пересчета, которая меньше последней заполненной даты,
	то за периода пересечения между этими двумя датами таблица будет пересчитана.

	Если указанная вами дата начала пересчета больше последней заполненной даты,
	то это - то же самое, что оставить поле даты начала пересчета пустой (система
	все равно будет считать от последней заполненной даты).

	\item[\dlgradioi{Полностью пересчитать данные}]
	При выборе этого положения переключателя таблицы статистики продаж будут полностью
	очищены, и заполнение пойдет \qu{с чистого листа}. Естественно, это - весьма длительная %
	процедура (может достигать нескольких часов).

	\item[\dlgflag{Использовать массовый расчет остатков}]
	Опция, позволяющая значительно ускорить построение таблицы продаж за счет модификации
	алгоритма расчета остатков. В большинстве случаев включение данного флага значительно
	снижает время расчета.
\end{description}

Подведем итог:
При нормальном использовании, в диалоге заполнения таблицы продаж следует указать дату,
до которой следует выполнять расчет и все остальные управляющие элементы оставить в
состоянии по умолчанию.

\subsection{Прерывание заполнения таблицы продаж}

При построении таблицы продаж по очень большим базам данных за продолжительный период
времени вы можете столкнуться с проблемой значительного времени, необходимого
для заполнения таблицы продаж.

Эта проблема может усугубляться загруженностью сервера базы данных. Так, если
в системе множество пользователей делают свою работу и одновременно с этим
выполняется процесс заполнения таблицы продаж, то нагрузка на сервер резко
возрастает, что мешает и работе пользователей и собственно, процессу заполнения.

Система предоставляет сервис для прерывания процесса и возобновления его
в следующий раз.

Существуют следующие средства прерывания этого процесса:

\begin{description}
	\item[Отключение программного сеанса] Самый простой, но и самый грубый метод.
	В случае использования JobServer этот способ может быть применен остановкой
	службы Papyrus Server с последующим запуском.

	\item[Создание сигнального файла] Если в подкаталоге BIN основного каталога
	системы создать файл $psalesstop$ (без расширения), то, увидев его, работающий
	процесс формирования таблицы продаж остановится занеся соответствующее сообщение
	в файл журнала.

	Сигнальный файл при этом удаляется процессом автоматически.

	Заметим, что если в перед запуском процесса в каталоге будет существовать
	файл с таким именем, то процесс остановиться не начавшись (выполнит только
	небольшую предварительную работу).

	Данный способ остановки удобен при использовании JobServer. Поскольку при
	этом нет необходимости каким либо образом открывать рабочий сеанс на серверном
	компьютере, на котором JobServer запускается.

	\item[Установка предельного времени работы процесса]
	Если вы точно знаете лимит времени, который может быть отведен процессу
	формирования таблицы продаж, то его можно определить в конфигурационном
	файле BIN/PP.INI в зоне [config] параметром PSales\_MaxTime=время в секундах.

	\ppyexample{
		[config]\\
		PSales\_MaxTime=14400
	}

	В приведенном примере процесс должен работать не более 4 часов (4 * 60 * 60 секунд).
\end{description}

\ppynote{
	Прерывание процесса заполнения таблицы продаж во втором и третьем вариантах
	происходит не моментально. Это связано с тем, что точки проверок возникновения %
	события прерывания могут быть достигнуты алгоритмом с некоторым опозданием
	относительно возникновения самого события.
}

\subsubsection{Возобновление процесса после прерывания}

Система формирует таблицу так называемыми квантами. Каждый квант состоит из
обработки фиксированного (или меньшего) количества наименований товаров.

После обработки очередного кванта, система фиксирует информацию об этом
в конфигурации прогноза продаж. Таким образом, при любом прерывании процесса
система будет помнить о том, какой квант был обработан последним. Вся работа,
положенная на квант, в течении которого произошло прерывание, будет потеряна.

В диалоге запуска построения таблицы продаж (рис.~\ref{pic-dlg-046}), если
процесс до этого был прерван, в нижней части отображается информация об этом.
Если вы запустите процесс в режиме заполнения отсутствующих дней, то
в действительности будет возобновлен прерванный процесс.

Для того, чтобы проигнорировать информацию о прерванном процессе, следует
включить флаг \dlgflag{Признак незавершенного процесса}.

Режим полного пересчета данных игнорирует информацию о прерванном процессе.

\subsection{Журнал заполнения таблицы продаж}

Процесс формирования таблицы продаж заносит информацию о собственной работе
в файл журнала с именем psales.log в каталоге журналов (по умолчанию, PPY/LOG).

\subsection{Блокировка процесса заполнения таблицы продаж}

Функция формирования таблицы продаж является монопольной. То есть, ее может
выполнять одновременно только один сеанс системы. По этому, при запуске
этого процесса программа устанавливает блокировку, которая не позволяет
любому другому сеансу, работающему с этой базой данных, выполнить процесс
заполнения таблицы продаж.

При успешном завершении либо после прерывания процесса блокировка
снимается автоматически.

\section{Анализ статистики продаж}

\ppypict{dlg-f-011}{Фильтр по статистике продаж}

Анализ статистики продаж позволяет увидеть таблицу выборки товаров, где для каждого
показаны важные статистические характеристики: количество значений в таблице продаж,
средние продажи, стандартное отклонение, коэффициент вариации и оборачиваемость. Эти
характеристики приведены как в количественном, так и в суммовом выражениях.
Для анализа статистики продаж выберите пункт меню \ppymenu{Отчетность\rdir Анализ продаж\rdir Статистика по товарам}.
Вслед за этим, вы увидите диалог фильтра. В таблице перечислены
управляющие элементы этого диалога и их смысл.

\begin{description}
	\item[\dlgcombo{Группа товаров}]
	Комбо-бокс, позволяющий ограничить выборку только одной товарной группой.

	\item[\dlgbutton{Фильтр\dots}]
	Нажатие этой кнопки открывает фильтр по товарам, в котором вы можете установить
	любые критерии фильтрации для получения списка товаров, по которым следует
	рассчитывать статистику продаж.

	Установка не пустого фильтра отменяет установку группы товаров в комбо-боксе,
	рассмотренным выше.

	\item[\dlgcombo{Подстановка товаров}]
	Вы можете выбрать здесь один из вариантов подстановки товара для анализа
	статистики продаж.

	Отметим, что использование подстановки в этом отчете разительно увеличивает
	его аналитические возможности. Причина заключается в том, о чем мы говорили выше,
	обсуждая особенности статистического поведения продаж отдельных товаров и
	товарных групп.

	Так, вы можете проанализировать статистику продаж отдельных торговых марок,
	либо товарных групп и т.д. Детализируя строки этого отчета, вы видите статистику
	продаж конкретной категории товаров в сгруппированном виде, где разброс продаж
	отдельных товарных позиций исчезнет и не будет мешать изучению поведения выбранной
	категории.

	\item[Период]
	Если это в этом поле указан период, то статистика будет рассчитываться только за указанный
	период, в противном случае, вы увидите статистику, рассчитанную за весь период, по которому
	построена таблица продаж. В этом случае данные берутся непосредственно из базы данных,
	поэтому такой вариант занимает меньшее время.

	\item[\dlgcombo{Цикл}]
	Выбор цикла приведет к тому, что каждая номенклатурная позиция в отчете будет
	показана несколькими строками (по одной для каждого цикла из периода).

	Таким образом, вы сможете проанализировать динамику изменения статистических
	параметров товара по временным циклам.

	При выборе нового значения в этом комбо-боксе система автоматически рассчитывает
	количество циклов, умещающихся в заданный период и устанавливает это значение
	в поле \qu{Количество циклов} (см. ниже).
	Если период до этого не был задан, то он устанавливается автоматически
	отсчетом одного цикла указанной длительности назад от текущей даты (включая ее).

	\item[Количество циклов]
	Это поле используется совместно с комбо-боксом \dlgcombo{Цикл}
	для уточнения количества циклов, по которым должен быть построен отчет.

	\item[\dlgcombo{Склад}]
	Здесь необходимо указать склад, статистика по которому вас интересует. Если склад не указан,
	то результат будет получен по всему множеству складов, по которым строилась таблица продаж.
	По умолчанию, система устанавливает в этом поле текущий склад.

	Справа от этого комбо-бокса присутствует кнопка \dlgbutton{\dots}, позволяющая выбрать
	произвольный список складов, суммарная статистика по которым вас интересует.

	\item[\dlgflag{Не показывать нулевые строки}]
	При включенном флаге вы не увидите товаров, по которым все значения нулевые. Если вы хотите
	увидеть товары, которых никогда не было на выбранном складе, то снимите этот флаг.

	\item[Количество точек]
	Фильтрующее ограничение по количеству точек.

	\item[Средние продажи (количество)]
	Фильтрующее ограничение по средним количественным продажам.

	\item[Средние продажи (сумма)]
	Фильтрующее ограничение по средним суммовым продажам.

	\item[Коэффициент вариации]
	Фильтрующее ограничение по коэффициенту вариации.

	\item[\dlgradioc{Сортировка}]
	С помощью этого переключателя можно выбрать порядок сортировки таблицы анализа статистики.

	Здесь следует обратить внимание на последний вариант (Количество элементов - Средние продажи).
	Это - специальная опция сортировки, в результате которой в верхней части таблицы будут
	отображены те элементы, которые долго присутствуют на остатке,
	но не продаются (так называемые \qu{зависшие товары}).

\end{description}

\subsection{Таблица анализа статистики продаж}

\ppypictsc{brw-gstat}{}{0.4}

Внешний вид таблицы показан на рис.~\ref{pic-brw-gstat}. Статистические характеристики товаров здесь
сгруппированы в два раздела: по реализованному количеству и по сумме реализации. Пояснения
требуются только для понятия оборачиваемость.
Под оборачиваемостью подразумевается величина, обратная к средним продажам. Смысл этой
характеристики - оборачиваемость по количеству показывает, за какое количество дней
продается одна единица товара. Оборачиваемость по сумме показывает, за какое количество
дней реализуется один рубль стоимости товара. Обратим внимание на то, что речь идет именно
о стоимости, а не о себестоимости, поскольку статистика продаж рассчитывается в ценах
реализации

\subsubsection{Действия в таблице анализа статистики продаж}

\paragraph{Таблица продаж товара}	\indent\keyb{Enter}
Выбрав это действие, вы можете увидеть таблицу продаж выбранного товара. Это позволяет
увидеть, из чего складывается статистика продаж.
Подробное описание таблицы продаж товара будет приведено ниже.

\paragraph{Товар}	\indent\keyb{F2}
Просмотр и редактирование информации о товаре.

\paragraph{Лоты}\indent\keyb{F3}
Показывает таблицу лотов по выбранному товару.

\paragraph{Положить в корзину}	\indent\keyb{Ctrl-F4}

\paragraph{Фильтр}	\indent\keyb{Ctrl-O}
Изменение параметров фильтрации отчета. Это действие удобно использовать для изменения
порядка сортировки таблицы.

\paragraph{Печать статистики}	\indent\keyb{F7}
Вывод таблицы на печать или экспорт в другой формат (Excel, HTML и др.)

\subsection{Таблица продаж товара}

\ppypictsc{brw-psales}{}{0.4}

Таблица продаж товара (рис.~\ref{pic-brw-psales}) детализирует статистику продаж по товару.
Информация для этой таблицы берется непосредственно из предварительно построенной таблицы продаж.
Здесь существенны только три колонки: дата, отгрузка по количеству и отгрузка по сумме.
Остальные колонки необходимы для тестовой проверки механизма прогнозирования.

\subsubsection{Действия в таблице продаж товара}

\paragraph{Группировка операций}\indent\keyb{F3} Показывает группировку операций по товару
за день в текущей строке. Эта функция может быть использована в качестве теста для проверки
правильности заполнения строки. Группировка показывается с входящими и исходящими остатками.

\paragraph{Печать}\indent\keyb{F7}	Печать таблицы продаж товара

\paragraph{Пересчет модели по товару}\indent\keyb{F8}	Это действие позволяет пересчитать
таблицу продаж по выбранному товару. Функция реализована для тестирования работы таблицы
продаж.

\paragraph{Агрегированные значения}\indent\keyb{F9}	Показывает итоговую статистику по товару
за выбранный период времени. Величины, показываемые в диалоге итогов аналогичны колонкам в
таблице анализа статистики продаж.

\paragraph{Тест прогноза}\indent\keyb{Ctrl-T}Тестовая функция, предназначена для проверки
функционирования механизма прогнозирования.

\paragraph{Фильтр}\indent\keyb{Ctrl-O} См. ниже

Фильтр по продажам товаров позволяет изменить условия просмотра таблицы продаж по товару.

\ppypict{dlg-f-psales}{Фильтр по продажам товаров}

\begin{description}
	\item[Период]
	Период, за который следует включать данные в таблицу. Если вы оставите это поле пустым,
	то используется период от дня начала расчета таблицы продаж по выбранному товару до дня
	окончания расчета.

	\item[\dlgcombo{Склад}]
	Склад, данные по которому должны быть показаны в таблице.

	\item[\dlgcombo{Группа}]
	Товарная группа и товар, по которому вы хотите видеть таблицу продаж. Комбо-бокс
	\dlgcombo{Товар} не должен быть пустым.

	\item[\dlgcombo{Товар}]

	\item[Цикл (дней)]
	Здесь можно указать количество дней, по которым следует сгруппировать значения. Если в
	этом поле указано значение большее единицы (ноль здесь воспринимается системой как
	единица), то все значения будут рассчитаны по группам, каждая из которых имеет протяженность
	в указанное  количество дней. При этом в таблице вы увидите для каждой группы дату,
	соответствующую началу периода.

	Группировка по периодам позволяет получить статистику с меньшим разбросом значений (это
	хорошо видно по коэффициенту вариации).

	\item[Дата отсчета]
	Специальное поле, предназначенное для тестирования прогнозирования. Указав здесь дату,
	вы заставите систему рассчитывать статистику по циклам назад и вперед от этого дня.
	Если дата не указана, то циклы отсчитываются от начала периода расчета.

	\item[\dlgflag{Показывать дни, в которые не было остатка}]
	Если этот флаг включен, то в таблицу отчета будут включены дни, в течении которых
	товара не было на остатке. Соответствующие строки будут выделены цветом.

\end{description}

\section{Прогнозирование спроса}

Для прогнозирования спроса используется отчет, доступный из пункта меню
\ppymenu{Отчетность\rdir Анализ продаж\rdir Прогноз продаж}.
Этот отчет предоставляет возможность видеть одновременно остатки товаров на складе и
прогноз спроса по каждому товару на заданный период. Благодаря этому, менеджер, отвечающий
за заказ товаров поставщику, может максимально точно определить количество заказываемого
товара.

\ppypict{dlg-047}{Остатки товаров с расчетом прогноза}

\subsection{Фильтр прогноза продаж}
Фильтр прогноза продаж определяет форму вывода данных о предполагаемых продажах.
Управляющие элементы этого фильтра следующие:

\begin{description}
	\item[Дата заполнения таблицы]
	Информационное поле, показывающее дату, до которой заполнена таблица продаж. Всегда следует
	обращать внимание на эту дату, поскольку она определяет степень актуальности таблицы продаж.
	Если указанный в этом поле день далеко отстоит от текущего, то следует обновить таблицу
	продаж.

	\item[Дата остатков]
	В этом поле вы можете указать дату, на которую необходимо рассчитать остатки. Незаполненное
	поле означает, что система должна рассчитать текущие остатки товаров.

	\item[Период прогноза]
	Период прогноза определяет дни, на которые система должна построить прогноз спроса на каждый
	из товаров.

	Для вашего удобства здесь предусмотрена функция, позволяющая ускорить ввод периода прогноза.
	Если вы хотите иметь прогноз на заданное количество дней, начиная со дня, следующего за днем
	расчета остатков, то введите в этом поле, выбранное количество дней и нажмите \keyb{F2}. Программа
	автоматически рассчитает период прогноза и установит в этом поле. Если дата расчета остатков
	не указана, то период будет вычислен от текущей операционной даты.

	\item[\dlgcombo{Склад}]
	Склад, по которому будет рассчитываться отчет. Если вы не укажете склад, то остатки будут
	выведены по всем складам, но прогноза спроса вы не увидите, поскольку он, как говорилось
	выше, строится только по конкретному складу.
	Изначально система выбирает здесь текущий склад.

	\item[\dlgcombo{Группа товаров}]
	Выбор товарной группы позволяет ограничить расчет только теми товарами, которые принадлежат
	выбранной группе.

	\item[\dlgbutton{Фильтр}]

	\item[\dlgcombo{Поставщик}]
	Вы можете выбрать в этом комбо-боксе конкретного поставщика, тогда система покажет остатки
	товаров, поступивших только от этого поставщика.
	Здесь возможно рассогласование: если один и тот же товар приходил от нескольких поставщиков,
	то остаток этого товара будет показан только по одному (выбранному) поставщику, а прогноз
	рассчитан просто по товару. То есть, существует вероятность, к счастью небольшая, что вы
	закажете товар, исходя из ошибочного значения остатка.

	\item[\dlgflag{Нулевые остатки}]
	Если включить этот флаг, то наряду с товарами, которые есть на складе (в организации),
	будут выданы те товары, которых не осталось (или даже вообще не было на заданном складе).
	При установленном флажке \qu{Нулевые остатки} не будут показаны товары, имеющие признак
	\qu{Пассивный}, если их остаток нулевой.
	При расчете прогноза продаж с целью определения заказа поставщику целесообразно включать
	этот флаг.

	\item[\dlgflag{Только ненулевые заказы}]
	Показывает в отчете только те товарные позиции, по которым есть незакрытые клиентские
	заказы.

	\item[\dlgflag{Рассчитывать заказы}]
	Этот флаг позволяет получить отчет, в котором наряду с остатками товаров, будет показано
	заказанное количество каждого из товаров.

	\item[\dlgflag{Ниже минимального остатка}]
	Если установить этот флажок, то в отчете будут показаны только те позиции, остаток по
	которым меньше минимального остатка, заданного для каждого из товаров. Если для товара
	минимальный остаток не задан, то такой товар в отчет не войдет. Подробности относительно
	установки минимального остатка смотрите в разделе, посвященном справочнику товаров.

	\item[\dlgflag{Ограничивать торговой матрицей}]

	\item[Период истощения запасов]

\end{description}

\subsection{Таблица прогноза продаж}

Таблица прогноза продаж во многом аналогична таблице остатков товаров. Отличие состоит в
двух колонках: остаток в днях и прогноз продаж.

Если с прогнозом продаж все более-менее ясно, то остаток в днях требует пояснения. Эта
величина вычисляется как отношение остатка в торговых единицах к среднедневным продажам за
весь период построения таблицы продаж. Из-за того, что этот алгоритм отличается от алгоритма
расчета прогноза продаж, эти два значения могут оказаться несогласованными.

\ppypictsc{brw-predict}{}{0.4}

\subsubsection{Действия в таблице прогноза продаж}

\paragraph{Лоты}\indent\keyb{Enter}
Показывает таблицу лотов по текущему товару

\paragraph{Заказы на товар}\indent\keyb{F3}
Показывает таблицу заказов по текущему товару

\paragraph{Товар}\indent\keyb{F2}
Позволяет просмотреть и изменить информацию по текущему товару

\paragraph{Положить в корзину}\indent\keyb{Ctrl-F4}
Добавляет текущий товар в корзину

\paragraph{Добавить в корзину все товары из отчета}\indent\keyb{Ctrl-F8}

\paragraph{Группировка операций по товару}\indent\keyb{F5}
Показывает отчет группировки товарных операций по выбранному товару.
Предварительно запрашивается период, за который следует
рассчитать группировку товарных операций.

\paragraph{Прогноз}\indent\keyb{Ctrl-F9}
В настоящее время не используется

\paragraph{Таблица продаж товара}\indent\keyb{Ctrl-S}
Выбрав это действие, вы можете увидеть
таблицу продаж выбранного товара. Это позволяет увидеть, из чего складывается прогноз продаж.
Подробно таблица продаж рассмотрена выше. Здесь уместно заметить, что при вызове таблицы продаж
из отчета по прогнозу, условия фильтрации таблицы изначально определяются так: цикл равен
количеству дней периода прогноза, дата отсчета равна дню, предшествующему периоду прогноза.

\paragraph{Печать}\indent\keyb{F7}
Печать отчета по прогнозу продаж

\paragraph{Итог}\indent\keyb{F9}
Показывает итоговые значения таблицы остатков товаров

\section{Расчет заказа поставщику\label{sec-suppl-order}}

Для расчета рекомендуемого заказа поставщику используется специальная форма, доступная
через пункт меню меню \ppymenu{Отчетность\rdir Анализ продаж\rdir Расчет заказа поставщику}. Эта
форма позволяет использовать две различные методики для расчета:
\begin{itemize}
 	\item Встроенный механизм статистического прогнозирования
	\item Средние продажи за указанное число прошедших периодов
\end{itemize}
Как обычно, оба метода имеют свои достоинства и недостатки.
Первый метод дает более точный прогноз, однако он не настолько нагляден как второй, кроме
того, метод расчета по средним продажам за фиксированное количество предыдущих периодов
больше соответствует принятой на многих предприятиях методикам.

Мы рекомендуем использовать первый метод поскольку он является более надежным в использовании
и предоставляет больше возможностей. Второй метод есть смысл применять в течении переходного
периода от ручного составления заказа к автоматическому для адаптации сотрудников.

Форма расчета заказа поставщику является комбинированным отчетом, объединяющем в себе
товарные остатки, статистику продаж и, собственно, расчет рекомендуемого к заказу количества
товаров.

\subsection{Принципы работы расчета заказа}

Первый и самый главный вопрос при работе с автоматическим заказом звучит примерно так:
\qu{как система определяет сколько товара мы продадим за будущий период?}.

Выше в этом разделе мы достаточно подробно рассмотрели таблицу продаж и методы расчета прогноза.
Здесь мы остановимся на вопросе определения прогнозируемого спроса при расчете заказа.

И так, когда пользователь формулирует запрос на заказ поставщику для заданной выборки
товаров (по поставщику, группе и др.) для каждого из товаров система пытается выбрать
фиксированное количество \ppyterm{точек достоверных продаж}. Мы обсуждали уже это понятие -
речь идет о днях, в течении которых товар присутствовал на заданном складе или группе складов.

\subsection{Фильтр расчета заказа поставщику}

\ppypictsc{dlg-048}{Расчет заказа поставщику}{0.5}

\begin{description}
	\item[\dlgcombo{Поставщик}]
	Если выбран поставщик, то форма заказа будет рассчитываться только по тем товарам, которые
	когда-либо приходили от этого поставщика.

	Это правило может быть подкорректировано следующим переключателем.

	\item[\dlgradioc{Использование артикулов по поставщику}]
	Определяет правило ограничения выборки товаров в зависимости от
	наличия товарного кода, привязанного к поставщику.
	\begin{description}
		\item[\dlgradioi{Не применять}] Товарные коды по статьям никак не влияют на
		выборку товаров для отчета.
		\item[\dlgradioi{Дополнить товарами, имеющими коды по поставщику}]
		В дополнение тем товарам, которые когда-либо приходили от выбранного поставщика
		в отчет включаются те позиции, которые имеют коды, связанные с этим поставщиком.
		\item[\dlgradioi{Ограничить товарами, имеющими коды по поставщику}]
		В отчет попадут только те товарные позиции, которые имеют код, связанный с
		выбранным поставщиком.
	\end{description}

	\item[\dlgcombo{Группа товаров}]
	Выбрав в этом комбо-боксе группу, вы ограничите отчет товарами, принадлежащими только этой
	группе.

	\item[\dlgbutton{Фильтр\dots}]
	Позволяет установить расширенный фильтр по товарам, которые будут вовлечены
	в формирование отчета.

	\item[\dlgcombo{Склад}]
	Здесь следует выбрать склад, остатки и продажи по которому необходимо анализировать. Если
	вы склад не укажете, то остатки будут рассчитаны по всем складам предприятия, а статистика
	продаж рассчитана не будет, поскольку существующая технология анализа продаж предусматривает
	обязательный выбор конкретного склада.

	\item[Следующие три поля]
	используются в том случае, если вы хотите использовать методику расчета заказа, основанную
	на средних продажах за один или несколько предыдущих периодов. В случае если вам необходим
	расчет, основанный на методике статистического прогнозирования, то эти поля заполнять не
	следует.

	\item[Дата отсчета]
	Здесь следует указать дату, от которой будут отсчитываться периоды продаж (назад). Если,
	скажем, вы указали здесь 30/09/2004, то предыдущие продажи будут рассчитываться до этой
	даты включительно.

	\item[Цикл]
	В этом поле можно выбрать продолжительность цикла расчета предыдущих продаж.
	Форма вывода результирующей таблицы в случае указания цикла расчета отличается от той,
	которая будет показаны, если циклы не выбраны.

	\item[Количество циклов]
	Если вы выбрали величину цикла продаж, то в этом поле введите количество циклов расчета.
	Например, если вы хотите увидеть продажи за четыре недели до 30/09/2004 включительно,
	то дату отсчета выберите 30/09/2004, цикл - неделя, количество циклов - 4.

	\item[\dlgradioc{Сортировать по}]
		Позволяет отсортировать отчет по одному из следующих критериев:
		\begin{description}
			\item[\dlgradioi{Товару}]
			\item[\dlgradioi{Количеству элементов}]
			\item[\dlgradioi{Средним продажам}]
			\item[\dlgradioi{Средней цене}]
		\end{description}

	\item[Дата расчета остатков]
	По умолчанию, рассчитываются текущие остатки товаров. Если это вас не устраивает, то в
	этом поле можно указать, на какую дату следует рассчитать остатки. Подробнее о нюансах
	расчета товарных остатков можно прочитать в разделе, посвященном этому вопросу.

	\item[Поля \qu{Период заказа} и \qu{Период доставки}]
	необходимы для указания периода, на который рассчитывается прогноз продаж. Фактически
	прогноз рассчитывается на период равный сумме периода заказа и периода доставки.
\end{description}

\subsection{Таблицы расчета заказа поставщику}

\ppypict{brw-gstat-supplorder}{}

Вид таблицы расчета заказов поставщикам по первому методу (статистическое прогнозирование)
показан на рисунке справа. Здесь колонка \qu{Прогноз продаж} рассчитывается исходя из всей
статистики продаж на основе метода, определенного в конфигурации прогнозирования.
В случае, если в фильтре расчета заказа указаны циклы, то таблица будет иметь несколько
иной вид (рис.~\ref{pic-brw-gstat-supplorder-ct}).

\ppypictsc{brw-gstat-supplorder-ct}{}{0.4}

Здесь колонка рекомендуемого заказа рассчитывается исходя из продаж за указанные периоды.
Колонки, показывающие продажи по циклам содержат следующую информацию: дата начала цикла,
количество достоверных значений продаж, продажи в торговых единицах (обратите внимание,
что в отличии от предыдущей таблицы, здесь показаны именно продажи за цикл, а не
среднедневные продажи).

\subsection{Действия в таблице расчета заказа поставщику}

\paragraph{Таблица продаж товара}\indent\keyb{Enter}
Выбрав это действие, вы можете увидеть таблицу продаж выбранного товара. Это позволяет
увидеть, из чего складывается прогноз продаж.

\paragraph{Товар}\indent\keyb{F2}
Позволяет просмотреть и изменить информацию по текущему товару

\paragraph{Лоты}\indent\keyb{F3}
Показывает лоты по товару, которому соответствует текущая строка таблицы.

\paragraph{Редактировать количество}\indent\keyb{F8}
Эта функция дает возможность изменить рекомендованное к заказу количество
товара в текущей строке.

\paragraph{Положить в корзину}\indent\keyb{Ctrl-F4}
Добавляет текущий товар в корзину. Подробно о работе с товарными корзинами см. стр.~\pageref{sec-goodsbasket}.

\paragraph{Добавить в корзину товары, подлежащие заказу}\indent\keyb{Ctrl-F8}
Переносит в выбранную корзину все товары, которые, согласно отчету, следует заказать
поставщику. Вместе с товаром переносится и количество, которое рекомендуется заказать.

\paragraph{Фильтр}\indent\keyb{Ctrl-O}
Это действие позволяет изменить условия фильтрации отчета.

\paragraph{Создание закупки}\indent\keyb{Ctrl-P}
В результате вызова этой функции будет создан драфт-документ закупки, который
вы можете отправить поставщику.

Документ будет создан при выполнении следующих условий:
\begin{itemize}
	\item В конфигурации прогнозирования спроса должен быть определен вид
	операции закупки товаров (стр.~\pageref{sec-cfg-predict}).
	\item В фильтре расчета заказа должен быть задан только один терминальный
	склад (то есть, если вы зададите один группирующий склад, который фактически
	разбивается на несколько, то данная функция не сработает).
\end{itemize}

Если ваша текущая конфигурация предполагает использование товарной матрицы,
то в формируемый документ закупки не попадут номенклатурные позиции, не
принадлежащие матрице для выбранного в фильтре склада.

\paragraph{Печать статистики}\indent\keyb{F7}
Вывод отчета на печать или экспорт.

\chapter{Розничные продажи и торговое оборудование\label{ch-retail}}

Настоящий раздел описывает идеологию и принципы учета розничных продаж в
системе \ppybrand{}, а так же конфигурацию, настройку и работу системы с различным торговым
оборудованием.

Учитывая огромное разнообразие по назначению и устройству существующего торгового оборудования, а также практическое отсутствие
приемлемой стандартизации в этой области, система не может охватить весь спектр представленных на рынке устройств. Если на вашем предприятии
уже используется или планируется использовать какие-то из типов торгового оборудования, которые не поддерживаются нашей системой,
то по взаимному согласованию, система может быть адаптирована для работы с вашим оборудованием. Наиболее правильным решением является
комплексное согласование всего проекта автоматизации предприятия до начала внедрения.

К сожалению, настройка системы на работу с оборудованием достаточно сложна и опирается на множество неформальных правил,
которые трудно описать в одном разделе, поэтому в вопросах такой настройки, по крайней мере, пока, можно полагаться только на специалистов,
прошедших подготовку у разработчиков системы.

\section{Модель учета розничных продаж}

В процессе учета и обработки данных о розничных продажах принимает значительное
число различных механизмов и модулей системы.

\ppypict{schema-ccheck}{Схема взаимосвязи объектов учета розничных продаж}

На рис.~\ref{pic-schema-ccheck} представлена общая схема внутренних объектов
системы, участвующих в учете розничных продаж, а так же их взаимосвязи.

Опишем кратко каждый из компонентов, представленных на рисунке.

\subsection{Кассовый узел}

Кассовый узел определяет характеристики одного или нескольких кассовых аппаратов,
через которые проходят покупатели при оплате своих покупок.

Кассовый узел содержит такие важные атрибуты, как:

\begin{itemize}
	\item Тип кассового аппарата либо кассового модуля
	\item Склад, к которому привязаны операции по этому узлу
	\item Множество других свойств, позволяющих тонко настраивать поведение этого
	узла при обработке розничных продаж.
\end{itemize}

\subsection{Кассовые сессии}

Кассовые сессии являются важным объектом, обеспечивающих правильную
группировку и обработку кассовых чеков как во время продажи, так и
при окончательном учете розничных операций.

За редким исключением, любой кассовый чек принадлежит строго определенной
сессии. Кроме того, и сами кассовые сессии могут группироваться в так называемые
суперсессии.

Каждая кассовая сессия принадлежит одному из кассовых узлов, что определяет
многие особенности ее поведения.

\subsection{Документы списания кассовых сессий}

Документы списания кассовых сессий представляют собой товарные (реже бухгалтерские)
документы. Они являются результатом обработки сессии после ее завершения.

Ни сама кассовая сессия, ни кассовые чеки не влияют непосредственно на
состояние товарных остатков и бухгалтерского баланса.
Для того, чтобы учесть продажи по чекам, кассовая сессия должна быть закрыта.
Процесс закрытия сессии включает и ее списание. Именно в это время формируются документы
списания кассовой сессии.

\subsection{Технология списания кассовых сессий\label{csess-wroff}}

Для того, чтобы правильно настраивать и использовать списание кассовых сессий
необходимо представлять процесс списания, который сам по себе является достаточно
сложным.

В общем случае обработка кассовой сессии при списании состоит из этапов (не все из которых обязательны),
показанных на рис.~\ref{pic-CSessWrOff}.

\ppypict{CSessWrOff}{Схема списания кассовой сессии}

Разберем каждый из этапов подробно.

\subsubsection{Группировка кассовых чеков}

Прежде всего, после команды на закрытие сессии, система группирует товарные
строки чеков, входящих в сессии. Цель этой группировки - сформировать таблицу
проданных товаров, дифференцированную по датам и знаку операции. То есть,
если в сессии присутствовали чеки за разные дни, то соответствующие операции
попадут в разные документы списания, датированные этими днями. Аналогично,
если в течении сессии были не только продажи, но и возвраты, то группировка
товарных позиций таких операций будет дифференцироваться для того, чтобы
сформировать отдельные документы возвратов и продаж.

Группировка кассовых чеков дает два существенных преимущества при формировании
документов:

\begin{itemize}
	\item Документы списания становятся компактными за счет того, что
	одна и та же номенклатурная позиция, будучи продана в течении сессии
	несколько раз (за один день) попадет в учетный документ одной строкой.

	\item После списания система сохраняет и предоставляет возможность анализа дефицита
	по кассовой сессии, возникающего из-за недостатка учетных остатков проданных
	через кассу товаров.
\end{itemize}

\subsubsection{Формирование документов списания}

После того, как строки чеков сгруппированы, система приступает к формированию
документов списания. Документы списания кассовых сессий могут относится к одному
из следующих видов:

\begin{description}
	\item[Продажа]
	Эти документы отражают продажи через кассу. Фактический вид операции, к
	которому относятся эти документы определяется полем \dlgcombo{Розничная продажа} в
	общих настройках операций (стр.~\pageref{sec-commcfg-op}).

	\item[Возврат]
	Эти документы отражают возвраты от покупателей. Фактический вид операции, к
	которому относятся эти документы определяется полем \dlgcombo{Розничный возврат} в
	общих настройках операций (стр.~\pageref{sec-commcfg-op}).

	\item[Бухгалтерский документ]
	Специализированный бухгалтерский документ с набором сумм, соответствующих
	кассовой сессии формируется, если в конфигурации оборудования установлен
	вид операции \dlgcombo{Бухгалтерская операция списания сессии} (стр.~\pageref{sec-cfg-trequip}).

	В этом документе отражаются следующие зарезервированные суммы:
	\begin{description}
		\item[Номинальная сумма]
		Итоговая сумма по чекам кассовой сессии.

		\item[Скидка]
		Итоговая сумма скидки по чекам.

		\item[Сумма кассовой сессии, оплаченная наличными]
		Сумма чеков, оплаченных наличными.

		\item[Сумма кассовой сессии, оплаченная безналично]
		Сумма чеков, оплаченных безналично (банковской картой).

		\item[Сумма кассовой сессии, оплаченная корпоративными кредитными картами]
		Сумма чеков, оплаченных корпоративными кредитными картами.

		\item[Сумма чековых строк кассовой сессии]
		Итоговая сумма сгруппированных строк чеков.

		\item[Не проведенная сумма кассовой сессии]
		Сумма дефицита по кассовой сессии. Эта сумма равна разнице между
		итоговой суммой сгруппированных строк чеков  и суммой документов списания
		(номинальная сумма документов продажи минус номинальная сумма документов возврата).
	\end{description}

	Все перечисленные выше типы сумм являются зарезервированными системой.
	Если в вашей базе данных нет этих типов, то их можно создать вызовом
	сервисной функции \ppymenu{Создание зарезервированных объектов}.

	\ppynote{
		Специальное замечание относительно номинальной суммы итогового бухгалтерского документа
		кассовой сессии.

		Если вы хотите, чтобы в качестве номинальной суммы применялось значение, вычисленное по формуле,
		заданной в виде операции, то для этого необходимо предпринять специальный трюк: префиксом формулы
		написать строку \ppyrsrv{ignfix}. Это связано с тем, что документ создается специальным образом
		с зафиксированными значениями установленных сумм.

		Например, если вы хотите, чтобы номинальной суммой была суммы наличной выручки по сессии то
		в формуле необходимо написать не \ppyrsrv{CS\_CASH}, а \ppyrsrv{ignfix CS\_CASH}.
	}
\end{description}

При повторном списании сессии суммы обсуждаемого бухгалтерского документа
меняются в соответствии с произошедшими изменениями.

\subsubsection{Формирование документов покрытия дефицита}

Если дефицит по кассовым сессиям должен являться источником данных
для формирования документов производства, либо по каким-то иным
соображениям должен быть учтен документально, то система \ppybrand{}
может сформировать так называемые драфт-документы покрытия дефицита.

В самом простом случае создаются драфт-документы, относящиеся к виду
операции, определенном в конфигурации оборудования как \dlgcombo{Операция покрытия дефицита для своего склада}
(стр.~\pageref{sec-cfg-trequip}). Такие документы датируются датой дефицита
и относятся к складу, к которому привязан кассовый узел сессии.

При необходимости же часть дефицита отнести к иным складам (например, если
некоторая продаваемая продукция производится или храниться на строго
определенных складах) используется вид операции \dlgcombo{Операция покрытия дефицита для чужого склада}
(стр.~\pageref{sec-cfg-trequip}).

Товары, для которых следует формировать драфт-документы покрытия дефицита для чужего
склада и соответствующие склады, определяются по ассоциации товар-склад (\ppymenu{Справочники\rdir Товары\rdir Ассоциация товар-склад}).

При повторном списании сессии документы покрытия дефицита модифицируются так,
чтобы отразить изменившееся состояние.

\subsubsection{Обработка дефицита}
При возникновении внепланового дефицита (т.е. такого, который не должен быть произведен) по сессии
правильной практикой является применение мер устранения самого дефицита а также
источников его возникновения. Подробно об этом рассказано на стр.~\pageref{loc-csessdfct}.

\subsubsection{Обработка документов покрытия дефицита}
Дефицит, который должен быть покрыт производством, обычно закрывается списанием
драфт-документов производства.

\subsubsection{Повторное списание сессии для учета обработки дефицита}
После применения мер борьбы с плановым и внеплановым дефицитом, необходимо
повторить процедуру списания сессии с тем, чтобы учесть затраченные усилия в
документах списания сессии.

\subsubsection{Техника выравнивания суммы списания кассовых сессий\label{csess-adjwroff}}
При списании кассовых сессий часто возникает небольшое рассогласование между общей суммой кассовых чеков
и суммой документов списания (продажа за вычетом возврата). Это рассогласование обусловлено ошибками
округления, возникающими при преобразовании строк продаж и возвратов кассовых чеков в учетные товарные документы.

Начиная с версии 8.6.3 система автоматически нивелирует это рассогласовании, используя следующую технику:

Во время процесса списания подбирается наиболее подходящая строка одного из документов списания. После завершения
процесса преобразования сессии в документы вычисляется разница между суммой кассовой сессии и документами списания.
Из этой разницы вычитается сумма дефицита по сессии и оставшаяся мизерная разница (чаще всего, несколько копеек)
компенсируется за счет скидки по выбранной до этого строке одного из документов.

Если по каким-либо причинам применение описанной техники не приемлемо на вашем предприятии, вы можете ее отключить
в конфигурации оборудования (см. стр.~\pageref{sec-cfg-trequip}).

\subsection{Кассовые чеки}

Кассовые чеки - объекты, отражающие отдельные транзакции розничной продажи.
Чек состоит из заголовка и списка строк.
Основные атрибуты чека следующие:
\begin{itemize}
	\item Идентификатор
	\item Время создания %
	\item Кассовая сессия, к которой относится чек
	\item Дисконтная карта (может и отсутствовать), по которой осуществлена продажа
	\item Сумма
	\item Скидка
\end{itemize}

В дополнение к указанным, чек может содержать специальную структуру расширения,
в которой могут хранится агент (официант, продавец и т.д.) и номер стола
(для ресторанного бизнеса).

Строки чека содержат следующие атрибуты:
\begin{itemize}
	\item Товар
	\item Количество
	\item Цена
	\item Скидка
\end{itemize}

Если ваше предприятие использует учет розничных продаж по серийным номерам,
то наряду с приведенными базовыми атрибутами, строки могут содержать расширение,
в котором хранится серийный номер, которому соответствует строка чека.

\subsection{Дисконтные карты}

Дисконтные карты представляют собой инструмент управления индивидуальными
скидками и ценами. Кроме того, дисконтные карты в системе \ppybrand{} могут
обеспечивать сервис кредитования клиентов либо оптимизации сбора платежей (так называемые,
корпоративные кредитные карты).

\section{Кассовые машины}

Кассовыми машинами мы будем называть разнообразные устройства, предназначенные для учета
наличных расчетов, а также расчетов по пластиковым картам с розничными покупателями или
потребителями услуг. Кассовые машины представляют собой огромный спектр устройств, начиная
от недорогих кассовых регистраторов и кончая сложными и дорогостоящими расчетными кассовыми
терминалами (POS-терминалами).
Мы здесь будем рассматривать только те кассовые машины, которые имеют интерфейс для обмена
информацией с компьютером.

\subsection{Конфигурации подключения кассовых машин}

Система \ppybrand{} различает два класса интерфейсов между кассовыми машинами: синхронный и
асинхронный.

\subsubsection{Синхронный интерфейс с кассовой машиной}

Синхронным интерфейсом между системой и кассовой машиной называется такой интерфейс, при
котором каждая регистрация покупки на кассовой машине немедленно отражается в основной
базе данных системы. То есть, как только товар или услуга были оплачены через кассовую
машину, сведения об этом (изменившийся остаток товара, увеличение остатка кассы и пр.)
становятся доступны любому пользователю системы (имеющему право видеть эту информацию).
Работа с кассовыми машинами с синхронным интерфейсом возможна в двух режимах:

\begin{itemize}
	\item 	Режим панели чеков. При этом режиме работа ведется в специальном окне, именуемом
	панель чеков. При этом продажи до закрытия кассовой сессии (снятия Z-отчета) не отражаются
	на остатках товаров и бухгалтерском балансе. При этом возможна продажа товаров, остаток
	товаров в базе данных равен нулю. Этот режим более технологичен, чем второй и мы настоятельно
	рекомендуем использовать его.
	\item 	Режим чековых документов. При таком режиме каждый чек представлен специализированным
	документом, который отражается на остатках товаров (но не отражается на бухгалтерском балансе
	до закрытия сессии). При таком режиме невозможна продажа товаров, остаток которых в базе
	данных равен нулю. Этот режим менее предпочтителен, чем предыдущий. Единственной причиной
	для его использования является необходимость в каждый момент времени видеть реальные остатки
	товаров (это не так существенно, как может показаться).
\end{itemize}


\subsubsection{Асинхронный интерфейс с кассовой машиной}

Асинхронным интерфейсом мы будем называть такой способ обмена данными между системой и
кассовой машиной, при котором кассовая машина, работая независимо от системы, получает от
нее только необходимую информацию о товарах, и регулярно передает в систему данные о продажах.
В отличие от синхронного, асинхронный интерфейс не позволяет видеть результаты сделки между
предприятием и покупателем сразу, однако позволяет развязать систему и кассовые машины, что
увеличивает общую надежность функционирования. Кроме того, асинхронный интерфейс при работе
со многими типами кассовых машин не имеет альтернативы, поскольку они поставляются с
собственным программным обеспечением, предоставляющим лишь возможность для асинхронного
обмена данными с программной системой автоматизации предприятия.

\paragraph{Конфигурация синхронного подключения кассовых машин}

При использовании синхронного интерфейса мы будем различать две схемы включения кассовых
машин:
\begin{itemize}
 	\item	Кассовая машина подключается к рабочей станции, на которой функционирует система.
 	При этом кассовая машина функционирует как фискальный кассовый принтер. Такую схему будем
 	называть пассивным синхронным подключением.
	\item	Система запускается непосредственно на кассовой машине. В этом случае кассовая машина
	должна быть активным POS-терминалом, реализующим как собственно функции кассовой машины,
	так и функции компьютера. Такую схему в дальнейшем мы будем именовать активным синхронным
	подключением.
\end{itemize}

\subsubsection{Конфигурации асинхронного подключения кассовых машин}

В случае асинхронного интерфейса между системой и кассовой машиной могут быть использованы
три варианта подключения кассовых машин к системе:
\begin{enumerate}
	\item 	Каждая кассовая машина включается в общую вычислительную сеть, в которой
	функционирует система. Этот вариант мы будем называть независимым асинхронным подключением.
	\item 	Несколько кассовых машин подключается к одному компьютеру, на котором функционирует
	специализированная программа, обслуживающая работу этих машин и реализующая интерфейс с
	системой. Такую схему мы будем называть асинхронным подключением с управляющим компьютером.
	\item 	Несколько кассовых машин подключаются к выделенной кассовой машине, называемой
	мастер-кассой. При этом мастер-касса одновременно реализует и функции кассовой машины и
	управление подключенными зависимыми кассовыми машинами и интерфейс с системой. Эту схему
	подключения в дальнейшем будем именовать асинхронным подключением с мастер-кассой.
\end{enumerate}

\subsection{Кассовые сессии}

Работа с кассовыми машинами по времени разделена на кассовые сессии. Кассовая сессия
аналогична понятию кассовой смены в общепринятом смысле с некоторыми оговорками. В
системе \ppybrand{} под кассовой сессией подразумевается период работы с кассовой машиной,
завершаемый операцией закрытия сессии. В зависимости от способа подключения кассовой машины
к системе закрытие сессии может иметь различный механизм и способ осуществления, однако в
любом случае это означает некоторую операцию, завершающую серию кассовых чеков. Часто
окончание кассовой сессии совпадает с закрытием кассовой смены и со снятием выручки по
кассе (Z-отчет), но это не всегда так.

Для просмотра и обслуживания кассовых сессий используется соответствующая таблица,
доступная через пункт меню  \ppymenu{Оборудование\rdir Кассовые сессии}.

\subsection{Права доступа по кассовым сессиям}

\ppypict{dlg-rt-csess}{Диалог редактирования прав доступа к кассовым сессиям}

Редактирование прав доступа к кассовым сессиям доступно из конфигурации по
группам и пользователям либо из общего диалога прав доступа по конкретной группе
или пользователю.

В списке прав - это права по объекту \qu{Кассовые сессии}.

\ppyadmin{
	Обратим внимание на то, что права по кассовым сессиям включают так же и
	регламент доступа к кассовым чекам. Связано это с тем, что кассовые чеки
	не имеют собственного управляющего модуля объекта данных.
}

Диалог переключателей флагов доступа по кассовым сессиям изображен на рис.~\ref{pic-dlg-rt-csess}.
Далее перечисляются эти флаги и приводится их описание.

\begin{description}
	\item[\dlgflag{Просмотр}]
	Позволяет просматривать кассовые сессии. Отсутствие данного флага
	запрещает просмотр таблицы кассовых сессий.

	\item[\dlgflag{Создание}]

	\item[\dlgflag{Модификация}]

	\item[\dlgflag{Удаление}]

	\item[\dlgflag{Админ}]

	\item[\dlgflag{Открытие сессии}]
	Отсутствие этого признака влияет только на возможность полной загрузки
	данный в асинхронный кассовый узел. При этом остается возможность
	загрузки изменений.

	Главным поводом для отзыва данного права у пользователей может быть
	то, что для больших магазинов с обширным ассортиментом и значительным
	количеством дисконтных карт время полной загрузки оказывается очень
	длительным.

	\item[\dlgflag{Закрытие сессии}]

	\item[\dlgflag{Добавление чеков}]

	\item[\dlgflag{Удаление чеков}]

	\item[\dlgflag{Специальная информация по чекам}]
	Разрешает просматривать и (частично) изменять системные
	параметры кассовых чеков.

	\item[\dlgflag{Отмена чеков}]
	Разрешает отменять чек, набранный в кассовой панели.

	\item[\dlgflag{Системная информация по сессиям}]

	\item[\dlgflag{Корректировка сессии}]

	\item[\dlgflag{Чеки возвратов}]

	\item[\dlgflag{Безналичный расчет}]
	Флаг предоставляет право на прием безналичного платежа в кассовой панели.

	\item[\dlgflag{Удаление строк в чеке}]
	Отключение флага блокирует возможность удаления строки чека в кассовой панели.

	\item[\dlgflag{Печать пре-чека}]

	\item[\dlgflag{Возможность отложить чек}]

	\item[\dlgflag{Печать копии чека}]

	\item[\dlgflag{Печать копии Z-отчета}]
	Привилегия дает возможность распечатать копию Z-отчета по существующей кассовой сессии.

	\item[\dlgflag{Снятие X-отчета}]
	Отсутствие флага блокирует возможность вызова функции
	снятия X-отчета.

	\item[\dlgflag{Разделение чека}]
	Опция предоставляет пользователю привилегию разделять чек на два чека. Может быть актуальна
	в ресторанном бизнесе.

	\item[\dlgflag{Изменение чека после печати счета}]
	Включенный флаг дает возможность изменить чек после печати счета клиенту (пре-чека). Наличие такой
	привилегии может предоставить возможность для злоупотреблений недобросовестными сотрудниками.

	\item[\dlgflag{Восстановление чека без выбора агента}]
	Если флаг отключен, то при восстановлении отложенного чека пользователь обязан выбрать агента в
	кассовой панели.

	\item[\dlgflag{Изменение агента в чеке}]
	Опция актуально в случае, если вам важно отслеживать агента, привязанного к чеку.
	Если флаг выключен, то изменить агента для существующего чека (в том числе того, который был
	извлечен из отложенных) не удастся.

	\item[\dlgflag{Удаление строки чека до отправки заказа}]
	Опция может быть важна для ресторанного обслуживания. Она работает в паре с опцией \dlgflag{Удаление строк в чеке}.
	Если пользователь не имеет права на удаление строки, однако этот флаг установлен и строка не была отправлена
	в виде заказа на изготовление, то пользователю все-таки предоставляется привилегия удаления строки.

\end{description}

\subsubsection{Переопределение прав доступа в кассовой панели}

Описанные выше права доступа определяются для пользователя, который
авторизовался в базе данных при открытии сеанса \ppybrand{}.

При работе с кассовой панелью неудобно, а иногда и невозможно
перезапустить сеанс для изменения прав доступа для выполнения тех
или иных функций.

Для того, чтобы можно было переопределить права доступа к некоторым
функциям кассовой панели существует два способа:

\begin{itemize}
	\item Использовать специализированную клавиатуру с ключом.
	\item Выбрать агента (продавца), имеющего специальные права.
\end{itemize}

Оба метода позволяют переопределить следующие права доступа:

\begin{description}
	\item[\dlgflag{Чеки возвратов}]
	\item[\dlgflag{Удаление строк в чеке}]
	\item[\dlgflag{Безналичный расчет}]
	\item[\dlgflag{Закрытие сессии (снятие Z-отчета)}]
	\item[\dlgflag{Отмена чеков}]
	\item[\dlgflag{Печать копии чека}]
	\item[\dlgflag{Печать копии Z-отчета}]
	\item[\dlgflag{Скидка на отдельную позицию}]
	\item[\dlgflag{Снятие X-отчета}]
	\item[\dlgflag{Разделение чека}]
	\item[\dlgflag{Изменение чека после печати счета}]
\end{description}

\paragraph{Использование клавиатуры с ключом}

Настройка клавиатуры с ключом описана на стр.~\pageref{sec-keybposcfg}.
Использование этой клавиатуры для изменения прав доступа заключается просто
в изменении положения переключателя, осуществляемое механически ключом.

\paragraph{Специальные права для агента}

Если с персоналией-агентом связан специальный зарезервированный тег
\ppyrsrv{Права агента на доступ к кассовым операциям}, то
при выборе этого агента в кассовой панели включается этот
набор прав.

Права доступа агента имеют более высокий приоритет, чем
права доступа, устанавливаемые посредством ключа.

При выборе другого агента права доступа либо устанавливаются в
соответствии с таковыми для нового агента, либо, если он не
имеет специально определенных прав, возвращаются в состояние
определяемое клавиатурным ключом или общими правами пользователя.

\subsection{Ассоциации товар-склад\label{loc-goodslocassoc}}

До того, как мы перейдем к рассмотрению подробностей настройки кассовых узлов,
остановимся на концепции ассоциаций товар-склад.

На текущий момент эта концепция применяется в следующих случаях:

\begin{itemize}
	\item При формировании драфт-документов покрытия дефицита по кассовым сессиям.
	\item При отправке на печать кассового чека с разделением между несколькими принтерами.
\end{itemize}

Оба применения обычно связаны с ресторанным бизнесом.

Ассоциация товар-склад обеспечивает систему информацией о соответствиях
между товарами и складами. Ассоциации могут быть как на уровне отдельных
товарных позиций, так и на уровне товарных групп. При этом, как обычно,
соответствие, заданное для конкретного товара, имеет больший приоритет,
нежели соответствие для группы.

\ppyexampletitle{Приведем простой пример ассоциации товар-склад}{

Группа Коктейли - Бар

Коктейль Огненный Гекко - Кухня Эксклюзив

Группа Горячие блюда - Кухня

Устрица Спесьяль де Бретань - Кухня Эксклюзив
}

Ассоциации товар-склад могут быть двух типов: анонимная и именованная.

Анонимная ассоциация одна на всю базу данных. Если все отношения товар-склад,
используемые вами могут быть уложены в одну схему, то кроме анонимной
ассоциации вам больше ничего и не надо.

Для редактирования анонимной ассоциации товар-склад обратитесь к пункту меню
\ppymenu{Справочники\rdir Товары\rdir Ассоциации товар-склад}.

Если для разных кассовых узлов необходимы различные схемы соответствий товар-склад,
либо, более того, при печать чеков на локальные принтеры используется одна схема,
а при списании сессии - другая, то придется использовать именованные ассоциации.

Администрирование именованных ассоциаций осуществляется через пункт меню
\ppymenu{Справочники\rdir Админ\rdir Именованные ассоциации объектов}.

Именованная ассоциация товар-склад должна быть определена в списке, доступном
через указанный пункт меню, с первичным типом объекта - \ppyrsrv{Товар}, вторичным - \ppyrsrv{Локация},
и группой вторичных объектов - \ppyrsrv{Склад}.

\subsection{Настройка системы для работы с кассовыми машинами}

Прежде чем описывать настройку системы для работы с кассовыми машинами необходимо
ввести понятие кассового узла.

\paragraph{Кассовым узлом} в системе \ppybrand{} называется логическая группа кассовых машин,
объединенная одним интерфейсом с системой. Другими словами, система взаимодействует
не с каждой отдельной кассовой машиной, а с кассовыми узлами. При этом кассовый узел
может состоять как из одной, так и из десятка кассовых машин.
\paragraph{Синхронный интерфейс} позволяет подключать только одну кассовую машину к кассовому узлу.
\paragraph{Асинхронный интерфейс} допускает подключение нескольких кассовых машин к одному узлу.

\subsubsection{Справочник кассовых узлов}

Для доступа к настройкам кассовых узлов необходимо обратиться к пункту меню
\ppymenu{Справочники\rdir Оборудование\rdir Кассы...}. При этом на экране появится таблица
доступных кассовых узлов справочника.

\subsubsection{Действия в таблице кассовых узлов}

В таблице кассовых узлов доступны следующие функции:

\paragraph{Добавить}\indent\keyb{Insert}
Создать новый кассовый узел.

При выборе этой функции система в первую очередь запросит тип кассовой машины,
а лишь за тем откроет диалог редактирования новой записи.

Если в списке нет того типа кассовой машины, который используется на вашем предприятии,
то необходимо обратиться к поставщику системы для того, чтобы поддержка этого типа была
введена в программу.

Если вы хотите создать группу кассовых узлов, то выберите тип \ppyrsrv{Группа кассовых узлов}.

\paragraph{Редактировать}\indent\keyb{Enter}
Просмотр и редактирование выбранной записи кассового узла.

\paragraph{Удалить}\indent\keyb{Delete}
Удаление выбранной записи.

\paragraph{Кассовые сессии}\indent\keyb{Ctrl-E}
Просмотр кассовых сессий по выбранному узлу.

\paragraph{Загрузить данные}\indent\keyb{Ctrl-L}
Загрузка данных для выбранного асинхронного кассового узла.

\paragraph{Статистика загрузки}\indent\keyb{Ctrl-S}
Открывает таблицу статистики загрузок для асинхронного узла.

\paragraph{Панель операций}\indent\keyb{Ctrl-O}
Открывает панель операций для выбранного кассового узла.

\paragraph{Фильтр}\indent\keyb{Ctrl-V}
Позволяет изменить параметры фильтрации.

\paragraph{Просмотр событий по кассам}\indent\keyb{Ctrl-J}
Открывает таблицу системного журнала для просмотра событий по
выбранному кассовому узлу.

\subsection{Настройка кассового узла с синхронным интерфейсом\label{sec-cashnode-sync}}

\ppypict{dlg-054}{Синхронный кассовый узел}

Диалог редактирования записи синхронного кассового узла показан на рис.~\ref{pic-dlg-054}.

Далее описаны управляющие элементы этого диалога.

\begin{description}
	\item[Наименование]
	Уникальное среди всех кассовых узлов наименование, содержащее до 47 символов.

	\item[Символ]
	Код кассового узла. Используется для идентификации узла из других программ
	и между разделами базы данных.

	\item[\dlgcombo{Группа}]
	Группа кассовых узлов, которой принадлежит данный узел. Поле может быть пустым,
	это значит, что узел не принадлежит ни какой из групп.

	Обратите внимание на то, что принадлежность группе несет не только декоративный смысл,
	но и позволяет изменить технологию списания кассовых сессий.

	\item[\dlgcombo{Специализация}]
	Атрибут, определяющий особенности использования кассового узла.
	В соответствии с этим параметром может изменяться назначение некоторых кнопок
	в кассовой панели, а так же модифицируется поведение кассовой панели в
	специализированных ситуациях.

	Здесь возможны следующие варианты:
	\begin{description}
		\item[Общий]
		\item[Кафе]
		\item[Магазин]
		\item[Доставка]
		\item[Аптека]
	\end{description}

	\item[Порт]
	Наименование интерфейсного порта, через который система взаимодействует с кассовым
	аппаратом. Это - символьное поле, содержащее, например текст COM1 (если кассовый аппарат
	присоединен к последовательному порту COM1), или что-либо другое.
	Если кассовый узел не взаимодействует с реальным аппаратом (в случае, скажем, с эмулятором),
	то это поле можно оставить пустым.

	\item[\dlgcombo{Устройство}]
	Тип устройства, с которым взаимодействует система. Все возможные варианты этих типов
	зарезервированы.

	\item[\dlgcombo{Склад}]
	Склад, к которому привязан кассовый узел. Все операции, генерируемые кассовыми сессиями,
	относящимися к этому кассовому узлу, будут относиться к этому складу.

	\item[Файл плана зала]
	Здесь может быть указано имя файла полотна плана зала (расширение wtm).

	Редактирование полотен доступно из пункта меню \ppymenu{Админ->Интерфейс->Редактирование полотен}.

	\item[Файл описания SLIP-отчетов]
	Обычно, система берет описание slip-отчетов (используемых для печати чеков, сменных
	отчетов и прочих небольших документов на специализированных принтерах и кассовых регистраторах)
	из файла BIN\\STDSLIP.FMT.

	Однако, если для данного кассового узла необходимо специальное описание таких печатных
	форм, которое отличается от используемого другими кассовыми узлами, тогда можно определить
	иной файл описания отчетов и указать путь к нему в этом поле.

	Подробно описание SLIP-отчетов см. на стр.~\pageref{sec-slipformat}.

	\item[\dlgflag{Использовать панель ввода чеков}]
	Если это флаг установлен, то пользовательский интерфейс ввода чеков представлен кассовой
	панелью, в противном случае - используется устаревший и не рекомендованный к использованию
	механизм ввода редуцированных чековых документов.
	Таким образом, в подавляющем большинстве случаев, рекомендуется устанавливать этот флаг.

	\item[\dlgflag{Не активизировать первую строку чека}]
	Этот флаг относится к устаревшему механизму работы с редуцированными чековыми документами
	(флаг \dlgflag{Использовать панель ввода чеков} выключен). Если этот флаг не установлен, то при
	создании каждого нового чекового документа система открывает диалог ввода новой строки.
	В противном случае, этот диалог надо открывать вручную.

	\item[\dlgflag{Открывать денежный ящик при пробивке чека}]
	Если флаг установлен, то при проведении чека, система будет обращаться к кассовому
	аппарату с \qu{требованием} открыть денежный ящик (работоспособность опции определяется
	возможностями драйвера кассового аппарата).

	\item[\dlgflag{Округлять в чеке \% скидки до целого}]
	При установки этой опции, величина скидки, предоставленной покупателю, будет округляться
	до целой величины. Использовать этот флаг целесообразно только в тех случаях, когда все
	цены указаны в целых значениях, в противном случае, после вычета целой скидки из нецелой
	цены результат окажется также нецелым, что лишает опцию смысла.

	\item[\dlgflag{При вводе чеков показывать все товары}]
	При подборе товара в кассовой панели по списку, система ограничивает список товаров только
	теми, которые числятся на текущих остатках.

	Установив этот флаг, вы укажете системе, что в списках необходимо показывать все товары
	(даже, если их нет в текущих остатках).

	Если флаг не установлен и остаток выбранного товара меньше или равен нулю, то
	выдается предупреждение.

	Величина остатка рассчитывается по правилу, описанному в блоке, посвященному
	флагу \dlgflag{Показывать остаток} (см. ниже).

	\item[\dlgflag{Автоматически печатать копию чека}]
	Только для кассовой панели.

	После ввода чека автоматически печатается его копия. Это может понадобиться в том случае,
	если требуется документ, например, для сборки выбитого покупателем заказа.

	\item[\dlgflag{Использовать котировки в панели чеков}]
	Только для кассовой панели.

	Если опция установлена, то система будет применять цены на выбранные товары исходя из
	котировок (в том числе, специальных котировок, определенных на периоды времени, и количество
	проданного товара).

	\item[\dlgflag{Не запрашивать вид оплаты}]
	Только для кассовой панели.

	По умолчанию, при проведении чека, система запрашивает вид оплаты, которым покупатель
	расплатится за купленные товары. Выбор состоит из двух вариантов: наличная оплата и
	безналичная оплата.

	Если ваш магазин не применяет безналичную оплату, то установка этой опции несколько ускорит
	обслуживание покупателей за счет того, что кассиру не придется выбирать вид оплаты.

	Обратите внимание на то, что даже при снятии этого флага, для того, чтобы система
	запрашивала вид оплаты необходимо чтобы пользователь имел право проведения безналичной
	оплаты по чеку (права доступа по объекту \ppyrsrv{Кассовые сессии}).

	\item[\dlgflag{Показывать остаток}]
	Только для кассовой панели.

	Если этот флаг включен, то в панели чеков будет показываться остаток по выбранному товару
	на складе, к которому относится кассовый узел.

	Остаток рассчитывается следующим образом: берется текущий остаток и от него вычитаются
	продажи по чекам, относящимся к незакрытым сессиям, по всем кассовым узлам, привязанным к
	тому же складу, что и данный кассовый узел (включая и его самого).

	\item[\dlgflag{Использовать клавиатуру с ключом}]
	Только для кассовой панели.

	Установка этого флага предписывает системе распознавать редуцированную клавиатуру с
	ключом для переключения прав доступа к операциям в кассовой панели.
	Соответствие положений ключа правам доступа определяется конфигурацией клавиатуры с
	ключом \ppymenu{Админ\rdir Прочие конфигурации\rdir Конфигурация клавиатуры с ключом}.

	\item[\dlgflag{Работа с кассовой панелью при блокировке}]
	Одно из общих правил работы системы заключается в том, что объекты, работа с которыми
	более чем одного пользователя, может привести к коллизиям, блокируются при обращении к
	ним первого пользователя. Так, например, происходит с документами, товарами, товарными
	корзинами, и др. Такой же подход \qu{исповедуется} в отношении синхронных кассовых узлов:
	если один сеанс открыл панель работы с кассовым узлом, то другие сеансы не могут получить
	к нему доступ.

	В некоторых (весьма редких) случаях может понадобится предоставить возможность работы с
	одним синхронным кассовым узлом более чем одному сеансу. В этом случае следует включить
	данных флаг.

	Пример: в баре два сеанса открыты для ввода заказов официантами, а один сеанс - для
	бармена, который управляет проведением чеков.

	\ppynote{
		Будьте осторожны при использовании этой опции. Ни в коем случае не включайте ее, если
		не уверены в том, что это действительно необходимо. Кроме того, установка этого флага
		требует более тщательного подхода к управлению правами доступа пользователей одновременно
		использующих один и тот же кассовый узел.
	}

	\item[\dlgflag{Не показывать чеки за кассовой панелью}]
	Только для кассовой панели.

	По умолчанию после закрытия кассовой панели на экране отображается таблица
	кассовых чеков по текущей кассовой сессии. Если этот флаг включен, то
	после закрытия панели рабочая среда системы перейдет в состояние, предшествующее
	открытию кассовой панели.

	\item[\dlgflag{Запрет операции без выбора агента}]
	Только для кассовой панели.

	Если в кассовой панели не выбран агент (официант), то система не позволит провести либо
	отложить чек, а так же выбрать товар.

	\item[\dlgflag{Пропускать \qu{не отпечатанные} чеки}]
	\qu{Не отпечатанный} чек - это тот, который проведен в базе данных, но одновременно не был
	правильно проведен через кассовый аппарат. Другими словами, не отпечатанный чек с высокой
	вероятностью не попал в фискальную память кассового аппарата.

	Для того, чтобы система считала такие чеки недействительными, установите рассматриваемую
	опцию. Сами по себе, чеки будут видны и доступны для анализа, но при списании и расчете
	суммы кассовой сессии они учитываться не будут.

	\item[\dlgflag{Проверять на выдачу подарков}\label{loc-cashnode-sync-gift}]
	Включение опции позволит системе после ввода каждой новой позиции либо удалении
	уже введенной проверять состояние чека на возможность выдачи подарочного
	товара покупателю.

	Подробно начисление подарков покупателям описано на стр.~\pageref{sec-chkpan-gift}.,

%	Округление скидок
%	\begin{itemize}
%		\item Не округлять
%		\item До ближайшего
%		\item В большую сторону
%		\item В меньшую сторону
%	\end{itemize}&
%	\eor

	\item[Текущая дата]
	Информационное поле, показывающее в какой дате сейчас работает асинхронный кассовый
	узел.

	\ppynote{
		Текущая дата кассового узла переопределяет общую текущую дату, установленную в
		системе. Если текущая дата кассового узла не равна дате, установленной при входе в сеанс
		работы с системой, то при начале работы с синхронным кассовым узлом текущей датой
		становится именно дата, установленная для кассового узла.
	}

	\item[ИД текущей сессии]
	Идентификатор кассовой сессии, которую обслуживает в текущий момент асинхронный кассовый
	узел. Если этот идентификатор нулевой, то кассовый узел в текущий момент не связан с какой-либо
	сессией (кассовый день не открыт).

	\ppynote{
		Это поле можно менять только в исключительный ситуациях, сопряженных со сбоями в работе
		кассового узла. В штатных режимах ни в коем случае не пытайтесь изменить это значение,
		поскольку это может привести к нарушениям в работе кассового узла.
	}

	\item[\dlgbutton{Доп. устройства}]
	Кнопка настройки дополнительных устройств, связанных с кассовым узлом:
	\begin{itemize}
		\item Сенсорный экран (TouchScreen)
		\item Сдвоенный кассовый узел
		\item Головной узел обмена (в разработке)
		\item Весы
		\item Дисплей покупателя %
		\item Порт принтера
	\end{itemize}

	\item[\dlgbutton{Группа-Отдел}]
	Кнопка, определяющая ассоциации между товарными группами и отделами магазина.

	\item[\dlgbutton{Параметры округления}]
	Определяет особенности расчета скидки и округления сумм по чеку.
	Подробнее эти параметры будут описаны ниже.

	\item[Время засыпания, сек]
	Только для кассовой панели
	Определяет время простоя кассовой панели, после которого панель переходит в режим
	блокировки.

	Снять блокировку можно либо кодом агента, либо универсальным кодом 9990.

	\item[\dlgflag{Объединять одинаковые товары в чеке}]

	Если флаг установлен, то чек, набранный в кассовой панели,
	сохраняется в базе данных так, что строки, содержащие одинаковые
	товары с одинаковыми ценами и одинаковыми же (или пустыми)
	серийными номерами, объединяются.

	\item[\dlgflag{Объединять одинаковые товары при печати}]

	\item[\dlgflag{Не использовать обрезчик чеков}]
	Опция актуальна для фискальных регистраторов. Если флаг включен,
	то система не будет передавать фискальному регистратору команду
	на отрезку чека.

	Необходимость во включении этого флага может быть обусловлена
	одним из двух случаев:
	\begin{itemize}
		\item На фискальном регистраторе обрезчик вышел из строя. Для того,
		чтобы можно было продолжать обслуживать покупателей до
		исправления технической проблемы, можно установить этот флаг.
		\item Модель фискального регистратора не имеет обрезчика
		чеков. Тогда данный флаг должен быть безусловно установлен.
	\end{itemize}

	\item[\dlgflag{После выбора товара предлагать выбрать серийный номер}]
	Данный переключатель может быть использован в том случае, если
	учет и продажи товаром ведутся по серийным номерам партий (лотов).

	При включенном флаге, после выбора кассиром в кассовой панели товара,
	система просматривает все имеющиеся на остатке лоты этого товара.
	Если будут обнаружены лоты, содержащие серийные номера, то
	на экране появится таблица выбора одного из этих лотов.

	Акцентируем внимание на том, что таблица выбора появляется только
	при существовании лотов с серийными номерами и показывает только
	те лоты, остаток которых на складе, к которому относится кассовый узел,
	не нулевой.

	\item[\dlgflag{Запрет ввода позиции без номера отдела}]
	Включение флага приведет к тому, что кассир не сможет ввести в чек
	строку, если не выберет предварительно номер отдела.

	Не устанавливайте без необходимости этот флаг поскольку его
	использование приводит к снижению производительности кассира.

	\item[\dlgflag{Запрет ввода позиции при нехватке товара}]
	Этот флаг можно включить только если установлен флаг \dlgflag{Показывать остаток}.
	Если флаг включен, то система будет блокировать выбор товара,
	остаток которого недостаточен для продажи.

	Величина остатка рассчитывается по правилу, описанному в блоке, посвященному
	флагу \dlgflag{Показывать остаток} (см. выше).

	\item[\dlgflag{Расширенный режим выбора карты}]
	Если флаг включен, то в кассовой панели, после нажатия кнопки (или клавиши) ввода
	персональной карты покупателя, появляется специализированный диалог, в котором
	отображаются дополнительные сведения о карте и фотография владельца (если
	она есть в базе данных).

	\item[\dlgflag{Keep original UserID}]
	Если флаг установлен, то при восстановлении отложенного чека в кассовой панели, пользователь, создавший
	чек изначально, будет по-прежнему ассоциирован с этим чеком. Если флаг не установлен, то
	с чеком будет ассоциирован пользователь, который последний провел или отложил его.

	\item[\dlgflag{Запрет операций без выбора карты}]
	Специализированная опция, блокирующая проведение чека в кассовой панели без выбора персональной
	карты. Может быть актуальна в некоторых бизнес-процессах, предполагающих обязательную
	деанонимизацию покупателя.

	\item[\dlgflag{Импортировать заказы с сервера Universe-HTT}]

	\item[\dlgflag{Разрешить проводить абстрактные товарные позиции}]
	Установленный флаг позволяет в кассовой панели добавлять в чек неименованные строки с произвольной ценой.
	Для того, чтобы эта возможность работала в конфигурации товаров необходимо указать товар по умолчанию.
	В этом случае, команда подбора товара по цене подменяется автоматическим формированием строки
	чека с указанной ценой и товаром по умолчанию из конфигурации.

	\item[\dlgbutton{Именованная ассоциация товар-склад}]
	Если анонимная ассоциация товар-склад не удовлетворяет требованиям данного кассового
	узла, то в этом комбо-боксе можно указать именованную ассоциацию, которая будет
	использоваться для печати чеков на локальные принтеры и при формировании
	драфт-документов покрытия дефицита по кассовым сессиям данного узла.

	Если вы хотите, чтобы выбранная именованная ассоциация использовалась только
	для печати, а для формирования драфт-документов покрытия дефицита применялась бы
	анонимная ассоциация, то включите флаг \dlgflag{Только для печати} под
	рассматриваемым комбо-боксом.

	Подробно ассоциации товар-склад описаны на стр.~\pageref{loc-goodslocassoc}.

\end{description}

\subsubsection{Диалог дополнительного оборудования синхронного кассового узла}

\ppypict{dlg-posnode-addeq}{Диалог дополнительного оборудования}

Вид диалога показан на рис.~\ref{pic-dlg-posnode-addeq}. Далее перечисляются управляющие
элементы этого диалога:

\begin{description}
	\item[\dlgcombo{Сенсорный экран}]
	Если рабочее место кассира оборудовано сенсорным экраном,
	то здесь необходимо выбрать соответствующую запись из
	справочника.

	Подробно справочник сенсорных экранов описан ниже.

	\item[\dlgcombo{Локальный сенсорный экран}]
	В случае, если несколько рабочих мест совместно используют
	общий кассовый узел с сенсорным экраном, возможна
	ситуация, когда на этих рабочих местах модели сенсорных
	мониторов различаются. При этом на каких-то местах
	сотрудники будут испытывать затруднения, связанные с тем,
	что настройки не соответствуют их оборудованию.

	Для разрешения такой ситуации в этом диалоге можно
	указать локальную по отношению к компьютеру запись
	сенсорного экрана. Ссылка на эту запись храниться не в
	общей базе данных а системном реестре компьютера. В результате,
	пользователи, работающие на этой машине будут
	использовать именно данную запись настроек сенсорного
	монитора.

	\ppyadmin{
		Обсуждаемая ссылка хранится в ветке реестра HKEY\_LOCAL\_MACHINE.
		Для того, чтобы программа могла сохранить значение в реестре
		необходимо изменять его имея достаточно системных прав на это.
	}

	\item[\dlgcombo{Спаренный кассовый узел}]
	Специализированная опция, позволяющая параллельно печатать один
	чек на два принтера, разделяя таким образом этот чек по разным
	товарам.

	Эта опция востребована, например там, где необходимо разделить
	фискальный учет продаж по разным товарным группам.

	Программа определяет принадлежность товара кассовому узлу по
	ассоциациям \ppyrsrv{товар-кассовый узел} редактирование которых
	доступно через пункт меню \ppymenu{Справочники\rdir Товары\rdir Ассоциации товар-кассовый узел}.

	\item[\dlgcombo{Альтернативный регистратор}]
	Дополнительный кассовый узел, который может использоваться в кассовой панели вместо
	основного по выбору кассира (например, в случае неработоспособности основного кассового аппарата).

	\item[\dlgflag{Дополнительный узел как альтернативный принтер}]
	Если выбран дополнительный кассовый узел и это флаг включен, то дополнительный узел работает
	как альтернативный регистратор.

	\item[\dlgcombo{Узел Papyrus}]
	Зарезервированная опция (в разработке).

	\item[\dlgcombo{Весы}]
	Если необходимо принимать значение количества взвешиваемого товара
	непосредственно с электронных весов, то здесь следует выбрать
	соответствующую запись весового устройства.

	\item[Порт принтера]
	\ppybrand{} может использовать в качестве чекового принтера, кроме
	специализированных устройств, обычный Windows-совместимый принтер.

	Если типом кассового узла является \ppyrsrv{Эмулятор (синхронный)}
	и в этом поле выбрано имя принтера, то чеки будут печататься на
	этот принтер.

	\item[\dlgradioc{Работа с сервером ЕГАИС}]
	Блок радио-кнопок, позволяющий выбрать режим работы с сервером ЕГАИС в случае
	продажи алкогольной продукции через кассовую панель.
	\begin{description}
		\item[\dlgradioi{Использовать}]
		Кассовая панель будет обрабатывать продажу алкогольных напитков в полном соответствии
		с требования российского законодательства (требовать сканирования акцизной марки и передавать
		данные о продажах в ЕГАИС).
		\item[\dlgradioi{Не использовать}]
		Кассовая панель не будет никак обрабатывать продажу алкогольных напитков.
		\item[\dlgradioi{Тестовый режим}]
		Кассовая панель будет обрабатывать продажу алкогольных напитков в тестовом режиме.
		При этом данные на сервер ЕГАИС отправляться не будут, но программа будет требовать
		сканирования акцизных марок и будет привязывать эти марки к чеку.
		\item[\dlgradioi{Только сканировать марку}]
		Специальный режим, используемый главным образом в секторе общественного питания. Позволяет
		сканировать марку без каких-либо попыток системы передать данные в ЕГАИС.
		Причина наличия такой опции заключается в том, что российское законодательство требует
		фиксировать факт вскрытия бутылки с алкогольным напитком с последующей регулярной передачей
		информации о вскрытых бутылках в ЕГАИС (но не при каждом событии).
	\end{description}

	\item[\dlgflag{Проверять уникальность сканированных марок}]
	Если флаг включен, то при сканировании алкогольной акцизной марки, система будет проверять
	наличие таких же номеров марок во всех чеках базы данных. В некоторых случаях эта операция
	может оказаться продолжительной. Поэтому не рекомендуется включать флаг, если ваша база
	данных обслуживается медленным сервером.

\end{description}

\subsection{Настройка кассового узла с асинхронным интерфейсом}

\ppypict{dlg-055}{Асинхронный кассовый узел}

При настройке асинхронного кассового узла в первую очередь, необходимо знать с каким
кассовым модулем (драйвером, кассовыми аппаратами) будет взаимодействовать система
посредством этого кассового узла.

Большинство современных кассовых модулей - достаточно сложные программные системы, которые
сами по себе требуют специальных знаний по настройке и обслуживанию. По-этому, правильнее
всего для выполнения работы по настройке кассовых узлов обращаться к специалистам.

Диалог редактирования записи асинхронного кассового показан на рис.~\ref{pic-dlg-055}.

\begin{description}
	\item[Наименование]
	Уникальное среди всех кассовых узлов наименование, содержащее до 47 символов.

	\item[\dlgcombo{Устройство}]
	Тип кассовой машины либо кассового модуля, с которым система будет обмениваться данными.
	Все типы зарезервированы. Это значит, что вы не можете произвольно создавать либо изменять
	записи списка типов устройств.

	\item[Версия драйвера]
	Два поля, используемые для того, чтобы система могла правильно различать версии кассовый
	модулей, если они отличаются протоколами обмена данными.

	Для правильной установки этих значений необходимо проконсультироваться с компанией, которая
	обслуживает систему на вашем предприятии.

	\item[\dlgcombo{Группа}]
	В этом комбо-боксе может быть выбрана группа кассовых узлов, которой должен
	принадлежать данный узел.

	\item[\dlgcombo{Склад}]
	Каждый кассовый узел обязательно должен быть привязан к одному и только одному складу.
	Установите в этом комбо-боксе склад, к которому привязан этот узел.

	Помните, что привязка к складу определяет такие важные параметры функционирования кассового
	узла, как определение цен на товары и формирование документов списания по кассовым сессиям.

	\item[Дополнительная котировка для дисконтных карт]
	Специализированная опция. Определяет, использовать ли и, если да,
	то какой вид котировки, для загрузки на кассовый модуль цен, которые
	будут применяться при продаже товаров покупателю, владеющему дисконтной
	картой.

	Здесь важны следующие два обстоятельства:
	\begin{itemize}
 		\item Не все кассовые модули позволяют взаимодействовать с ними для загрузки такой цены
		\item Ценообразование с использованием дисконтных карт определяется целым рядом  параметров.
	\end{itemize}

	Следовательно, рассматриваемый параметр влияет на ценообразование, но в комбинации с другими
	факторами (процент скидки по карте, расстановка котировок на товары, вид котировки, привязанный
	к группе дисконтных карт и т.д.).

	\item[\dlgbutton{Именованная ассоциация товар-склад}]
	Если здесь выбрана именованная ассоциация, то она будет
	применяться для формирования драфт-документов покрытия дефицита.

	Если вы хотите, чтобы выбранная именованная ассоциация использовалась только
	для загрузки в кассовый модуль (см. флаг \dlgflag{Загружать символы ассоциированных локальных принтеров}),
	а для формирования драфт-документов покрытия дефицита применялась бы глобальная ассоциация,
	то включите флаг \dlgflag{Только для загрузки} под рассматриваемым комбо-боксом.

	Подробно ассоциации товар-склад описаны на стр.~\pageref{loc-goodslocassoc}.

	\item[Файлы импорта]
	Применение этого поля определяется устройством, с которым взаимодействует система.
	В общем случае, в этом поле должны быть перечислены один или несколько файлов либо каталогов,
	из которых \ppybrand{} извлекает данные для импорта чеков. В свою очередь, эти файлы должны быть
	сформированы кассовым модулем по этим же адресам.
	В этом поле может быть задано несколько каталогов (файлов), разделенных символом ;
	(точка с запятой).

	Для кассовых модулей АТОЛ и FRONTOL, если это поле пустое, то используются пути, заданные
	в поле \qu{Пути экспорта}.

	\item[Пути экспорта]
	Применение этого поля определяется устройством, с которым взаимодействует система.
	Здесь перечисляются пути или файлы, в которые система будет передавать файлы с
	данными для кассового модуля.
	В этом поле может быть задано несколько каталогов (файлов), разделенных символом ;
	(точка с запятой).

	Для кассовых модулей АТОЛ и FRONTOL, если это поле пустое, то используются пути, заданные
	в поле \qu{Файлы импорта}.

	\item[Логические номера касс]
	Применение этого поля определяется устройством, с которым взаимодействует система.
	В этом поле могут быть перечислены через запятую логические номера кассовых аппаратов,
	с которыми взаимодействует данных кассовый узел.

	Если кассовый модуль, с которым взаимодействует система \ppybrand{}, поддерживает
	логические номера касс, то при импорте сессий, будут обрабатываться только те чеки,
	которые сопоставлены с одним из перечисленных в этом поле логическим номером кассы.

	Кроме последовательного перечисления номеров в этой строке допускается использование
	диапазонов. Диапазон может быть задан как пара значений начального и конечного номеров,
	разделенный двумя точками (..) или дефисом (-).

	\ppyexample{
		1,3,20 \\
		1,3,6-12,20 \\
		1,3,6..12,20 \\
	}

	\item[Дополнительные поля для загрузки]
	Здесь можно указать строку, определяющую комбинацию дополнительных полей товаров,
	при загрузке в кассовый модуль.

	Для кассового модуля Set-Retail версии 10.0 и выше порядок загрузки полей следующий:
	\begin{enumerate}
		\item composition (состав)
		\item storage-conditions (условия хранения)
		\item food-value (пищевая ценность)
	\end{enumerate}
	Например, если обсуждаемый дескриптор \qu{BCA}, то поле \ppyrsrv{B} загрузится как composition,
	поле \ppyrsrv{C} - как storage-conditions, поле \ppyrsrv{A} - как food-value.

	\item[\dlgflag{Передавать контрольную цифру кода}]
	Если этот флаг установлен, то система, при передаче в кассовый модуль информации о товарах,
	если штрихкоды не содержать контрольной цифры, будет автоматически добавлять в из конец
	контрольную цифру.

	Контрольная цифра может быть правильно рассчитана только для следующих стандартов штрихкодов:
	EAN-13, EAN-8, UPC-A, UPC-E (то есть, для штрихкодов, применяемых в розничной торговле).

	Для штрихкодов, длиной меньше или равной 3 система не пытается добавлять контрольную цифру.
	Остальные штрихкоды, если они не соответствуют ни одному из указанных стандартов по длине,
	система дополняет ведущими нулями и присваивает контрольную цифру.

	\item[\dlgflag{Импортировать чеки до закрытия сессии}]
	Установка этого флага приведет к тому, что \ppybrand{} будет пытаться импортировать чеки из
	кассового модуля даже, если Z-отчет, соответствующий этим чекам не снят. Опция может быть
	полезна если вам необходимо формировать драфт-документ по одному или нескольким чекам для
	выписки покупателю счета-фактуры и других документов. Для этого в конфигурации оборудования
	должна быть указана \qu{Операция покрытия временных сессий}.

	\item[\dlgflag{Загружать номера отдела}]
	Флаг действует только в том случае, если определены ассоциации группа-отдел (см. ниже
	описание кнопки \dlgbutton{Группа-Отдел}).

	Если флаг установлен, то с каждым, загружаемым в кассовый модуль, товаром
	будет сопоставлен номер отдела, который система будет определять по
	ассоциации группа-отдел.

	\item[\dlgflag{Загружать товарные остатки}]
	Если данный признак установлен, то для кассового модуля будут подготовлены
	данные, содержащие товарные остатки.

	Эта опция поддерживается для модулей АТОЛ и FRONTOL.

	\item[\dlgflag{Загружать товарные группы}]
	Установка этого флага предписывает системе загружать в кассовый модуль
	информацию о товарных группах, которым принадлежать товары, передаваемые
	при экспорте.

	Эта опция поддерживается для модулей Set-Retail, АТОЛ, FRONTOL.

	\item[\dlgflag{Загружать символы ассоциированных локальных принтеров}]
	Если флаг установлен, то при экспорте данных в кассовый модуль, будут
	загружаться символы локальных принтеров, ассоциированных с товарами согласно
	локальной (относительно данного кассового узла) или, если таковая не определена,
	глобальной ассоциации товар-склад.

	Эта опция поддерживается только для модуля FRONTOL.

	\item[\dlgflag{Загружать дробность товаров согласно единице измерения}]
	Если флаг установлен, то в кассовый модуль будет передаваться дробность
	количества продаваемого товара из единицы измерения этого товара.

	Если единица измерения не имеет определенного значения дробности, то
	загружается величина 0.001.

	Подробности о единицах измерения см на стр.~\pageref{sec-units}.

	Эта опция поддерживается для модулей: Set-Retail.

	\item[\dlgflag{Ограничивать загрузку изменений пользовательской группой}]
	Специализированная опция, применяемая только при обновлении данных на кассовом
	модуле. Если флаг включен и пользователь, осуществляющий загрузку, ограничен в правах
	доступа единственной товарной группой, то в кассовый модуль будут попадать
	только те товары, которые принадлежат этой группе.

	Одновременно, при определении момента, от которого система отсчитывает
	изменения товаров, используется последняя загрузка данных на этот кассовый
	узел, сделанная именно этим пользователем.

	\item[\dlgflag{Удалять пассивные товары}]
	Если флаг включен, то система будет передавать кассовому модулю данные
	для удаления пассивных товаров, по которым на складе, ассоциированном с этим
	кассовым узлом, нулевой остаток.

	На текущий момент опция поддерживается только для кассового модуля Frontol.

	\item[\dlgflag{Создавать объекты при импорте чеков}]
	\item[\dlgflag{Загружать номера кассовых аппаратов}]
	\item[\dlgflag{Игнорировать обратный анализ специальных цен}]

	\item[\dlgflag{Пассивный}]
	\item[\dlgbutton{Группа-Отдел}]
	Таблица ассоциаций между товарными группами и номерами отделов магазина.
	Эта таблица актуальна только при установке флага \dlgflag{Загружать номера отдела}
	и может понадобиться в том случае, если для разных товарных групп
	кассовый модуль должен получать различные номера отделов.

	Таблица, кроме элементов, содержащих явно заданную товарную группу,
	может содержать один элемент с пустой группой. Это элемент означает
	номер отдела по умолчанию. То есть, для товаров, по чьим группам явно
	определены номера отделов, эти номера и будут отправляться кассовому
	модулю, для остальных же будет грузиться номер отдела по умолчанию.

	Если таблица не содержит элементе с номером отдела по умолчанию, то
	таковым является $1$.

	Эта опция поддерживается только для модуля Set-Retail.
\end{description}

\section{Работа с кассовыми машинами с синхронным интерфейсом}

Работа с кассовыми машинами для машин с синхронным и асинхронным интерфейсами значительно
отличается. По этому мы отдельно рассмотрим оба варианта.

\subsection{Режим кассовых документов}

\subsubsection{Начало работы с кассовыми чеками}

При использовании кассовой машины с пассивным синхронным интерфейсом на компьютере, к
которому подключена кассовая машина, следует обратиться к пункту меню
\ppymenu{Оборудование\rdir Кассовый узел}. Выбрать нужный узел и нажать кнопку \dlgbutton{Чеки}.
Если предыдущая кассовая сессия была закрыта, или вы в первый раз обращаетесь к чекам этого
кассового узла, то на экране появится запрос на открытие новой сессии. Ответьте \qu{Да}.
Вслед за этим на экране появится таблица кассовых чеков. Эта таблица очень похожа на
таблицу товарных документов. Работа с кассовыми чеками в этом режиме также мало отличается
от работы с обычными товарными документами.

\subsubsection{Запуск системы в режиме синхронной кассовой сессии из командной строки}

Если на компьютере, к которому подключена кассовая машина, работа всегда или почти всегда
ведется в режиме расчетов с покупателями, то можно запускать систему таким образом, чтобы
она сразу входила в таблицу кассовых чеков без дополнительного обращения к пунктам меню.
Для этого необходимо запустить программу следующим образом:
pp.exe /cash:cash\_name
здесь cash\_name - это наименование кассового узла.
После ввода имени пользователя и пароля система автоматически загрузит таблицу просмотра
кассовых чеков для кассового узла cash\_name.

\subsubsection{Ввод нового чека}

Для того чтобы начать ввод нового чека, необходимо в таблице кассовых чеков нажать клавишу
\keyb{Insert}. При этом на экране появится диалог нового чека. В зависимости от того,
является ли режим работы с синхронной кассовой сессией пассивным или активным этот диалог
будет иметь различный внешний вид.

\subsubsection{Выбор товара по группе и наименованию}

Для того чтобы добавить новую строку чека в таблицу, необходимо либо нажать клавишу
\keyb{Insert}, либо выбрать товар по штрихкоду.

\subsubsection{Выбор товара по штрихкоду}

Для выбора товара по штрихкоду, находясь в таблице строк чека, необходимо набрать штрихкод
продаваемого товара с клавиатуры, или считать его сканером с товара. Сканер должен быть
настроен на интерфейс клавиатуры компьютера.

\subsubsection{Расчет сдачи}

Если при завершении формирования чека вам необходимо рассчитать сдачу, которую следует
выдать покупателю, то в диалоге заголовка чека нажмите клавишу \keyb{F2}. При этом появится
диалог, в верхнем поле которого высвечивается общая сумма покупки. В поле \qu{Наличность}
укажите сумму, которую вам дает покупатель, и нажмите \keyb{Enter}. В поле \qu{Сдача} вы
увидите сумму, которую следует вернуть покупателю. Чтобы убрать этот диалог с экрана нажмите
снова \keyb{Enter} или \keyb{Escape}.

\subsubsection{Закрытие чека}

Сформировав все товарные строки, чек необходимо закрыть. Это делается так же, как и проводка
товарного документа: если открыта таблица строк чека, то клавишей \keyb{Escape} закройте ее,
затем, в диалоге заголовка чека нажмите кнопку \dlgbutton{ОК}. Одновременно с проводкой чека
на кассовой машине отпечатается бумажный чек, с кратким содержанием покупок, суммой, датой и
другой служебной информацией.

\subsection{Режим панели чеков}

\ppypictsc{brw-015}{Кассовая панель}{0.4}

Панель чеков позволяет быстро вводить всю необходимую информацию о розничных продажах в
магазинах, ресторанах и других организациях, продающих какие-либо товары или оказывающих
услуги населению.
Панель состоит из следующих компонентов:
\begin{itemize}
	\item 	списка введенных товарных позиций
	\item 	строки ввода (в нижней части панели)
	\item 	буфера ввода (непосредственно под списком слева)
	\item 	окна подсказок
	\item 	информационных полей
\end{itemize}

Далее, описание работы

\subsubsection{Как выбрать товар}

Товар в панели чеков может быть выбран одним из следующих способов:
\begin{description}
	\item[По штрихкоду] Просканируйте штрихкод товара. Если система найдет такой штрихкод в
	базе данных, то она немедленно вставит его в буфер ввода. Код может быть введен и вручную.
	Для этого наберите код товара в строке ввода и нажмите  \keyb{Enter}.
	Если введенный штрихкод не найден, то система издаст звуковые сигналы и выдаст на экран
	сообщение.
	\item[По наименованию] Нажмите клавишу  \keyb{F2} и в появившемся списке выберите группу
	товаров и товар. Подробно список выбора товара описан в разделе, посвященном товарным
	документам.
	Особенность панели чеков состоит в том, что, если в опциях кассового узла установлен флаг
	\dlgflag{При вводе чеков показывать все товары}, выбрать можно любой товар. В противном случае,
	в списке будут видны только те позиции, которые числятся на текущих остатках.
	\item[По цене] Введите в поле ввода значение цены и нажмите  \keyb{F4}. На экране появится
	список товаров, учетная цена которых равна введенной. Обратите внимание на то, что речь идет
	именно об учетной цене, то есть о цене, указанной в лотах товара, но не в котировках.
\end{description}

\subsubsection{Применение серийных номеров}

Некоторые предприятия розничной торговли (например, аптеки) организуют процесс
учета и продажи товаров по серийным номерам. При этом в кассовой панели кассир должен
иметь возможность выбрать партию либо непосредственно по серийному номеру, либо
выбрав товар, уточнить какую именно партию этого товара он продает.

Перед тем, как описать правила работы кассира, сделаем несколько важных
замечаний по поводу схемы учета продаж по серийным номерам.

\paragraph{Учет серийных номеров в чеках - опциональный}
Это означает, что начальная конфигурация системы и стартовых
баз данных, поставляемых с дистрибутивом не предполагает
применения в кассовых чеках серийных номеров. Ниже мы опишем порядок
настройки системы для этого.

\paragraph{Серийный номер не является уникальным идентификатором лота}
Крайне существенное свойство серийных номеров (оно распространяется не
только на кассовые сессии, но и на все аспекты работы системы \ppybrand{}).
Это означает, что разные лоты (даже относящиеся к различным товарам) могут
иметь одинаковые серийные номера. В реальной жизни это скорее исключение,
чем правило, но о нем необходимо помнить.

\subsubsection{Как ввести количество}

После выбора товара следует указать продаваемое количество. Сразу, как только пользователь
выбрал товар, система устанавливает количество равным одной единице. Если товар выбран по
весовому штрихкоду, содержащему вес упаковки, то количество устанавливается таким, как
закодировано в штрихкоде.

Для ручного ввода количества существуют следующие методы:

\paragraph{Значение + Специальная клавиша}
Введите в поле ввода значение количества и нажмите \keyb{F6}.

\paragraph{Специальная кнопка + Калькулятор}
Этот метод применяется в кассовой панели для сенсорного экрана: нажмите кнопку \dlgbutton{Количество}
в ответ на это на экране появится калькулятор, в котором можно ввести значение и
нажать кнопку \dlgbutton{А}.

\paragraph{Значение + Enter}
Для того, чтобы программа восприняла строку в поле ввода как количество после нажатия \keyb{Enter}
необходимо первым либо последним символом в строке ввести символ \keyb{*}.

\ppyexample{
	2.3*

	*4
}

\paragraph{Специальные возможности при вводе количества}
Система предоставляет возможность ввода обыкновенных дробей в качестве значения количества
продаваемого товара. Для того чтобы указать количество в виде обыкновенной дроби введите
в строке ввода числитель и знаменатель дроби, разделив их символом \keyb{+}.

\ppyexample{
	3/5

	2.5/6
}

Кроме того, для товара, у которого определена физическая единица измерения и соотношение
физических единиц к торговым, вы можете вводить количество в физических единицах. Для этого
в конце значения необходимо добавить символ \keyb{/}.

\ppyexample{
	Допустим, существует товар Колбаса Докторская 0.400 (штучная колбаса, каждая единица
	которой весит 0.400 кг). Вы можете продать две штуки такой колбасы, введя

	0,800/

	Программа установит количество равным 2 (0.800 / 0.400).
}

\paragraph{Особенности ввода количества}

\begin{itemize}
	\item Значение количества сохраняется в строке чека с округлением до 6-го знака
	после десятичной точки.
	\item Если единица измерения товара целочисленная, то программа запрещает
	вводить для такого товара дробные значения количества.
	\item Если единица измерения товара определяет минимальную дробность
	количества, то в кассовой панели это ограничение действует при условии, что в конфигурации оборудования
	установлен флаг \dlgflag{Проверять дробность количества в кассовой панели} (см. стр.~\pageref{sec-cfg-trequip}).

	Так, скажем, если для товара \qu{Хлеб Окский} установлена единица измерения \qu{Буханка},
	в которой, в свою очередь, задана дробность 0.25, то в кассовой панели
	нельзя будет ввести количество 0.3 или любое иное, не кратное указанной дробности.
	\item Для алкогольных товаров, подлежащих маркировке акцизными марками в соответствии с российским законодательством,
	допускается ввод только по одной единице на каждую строку чека, поскольку при выборе такого товара программа дополнительно запрашивает сканирование акцизной марки.
\end{itemize}

\subsubsection{Как ввести номер отдела}

С каждой строкой кассового чека может быть связан номер отдела. Если для вас
это важно, то существует два способа связывания номера отдала со строками чека:

\begin{itemize}
	\item Автоматический
	\item Ручной
\end{itemize}

\paragraph{Автоматический метод ввода номера отдела}

При автоматическом способе система самостоятельно определяет принадлежность
каждого товара какому-либо отделу на основании информации, определенной
для кассового узла. Здесь следует иметь в виду то, что если программа не найден
соответствия для товара, то такая строка останется с неопределенным номером
отдела.

\ppyadmin{
	Настройка кассового узла для автоматического сопоставления номеров отделов
	с товарными группами состоит в установке таких ассоциаций в записи кассового узла.

	Выберите пункт меню \ppymenu{Справочники\rdir Оборудование\rdir Кассы}. В списке выберите
	кассовый узел и дважды щелкните мышью по выбранной строке.

	В диалоге синхронного кассового нажмите кнопку \dlgbutton{Группа-Отдел}.

	Вы увидите диалог, в котором есть список ассоциаций и кнопки
	для управления элементами этого списка.

	Для создания новой ассоциации нажмите кнопку \dlgbutton{Добавить},
	выберите товарную группу и соответствующий ей номер отдела.

	Номер отдела по умолчанию (то есть для тех товаров, группы которых
	явно не перечислены в списке) определяется специальным элементом
	списка, в котором группа не выбрана.

	Например, допустим в вашем справочнике существует 10 обыкновенных
	товарных групп. Вы хотите, чтобы для двух из них (для определенности будем считать,
	что это \qu{вино} и \qu{сигареты}) номер отдела был соответственно 2 и 3,
	а для остальных - 1.

	Создайте в списке три элемента:
	\begin{itemize}
		\item Группа \qu{Вино} - отдел 2
		\item Группа \qu{Сигареты} - отдел 3
		\item Пустая группа (не выбрана) - отдел 1
	\end{itemize}.
}

\paragraph{Ручной метод ввода номера отдела}

При ручном методе установки номера отдела кассир после выбора наименования товара
должен указать в кассовой панели номер отдела, которому сопоставлена вновь
вводимая строка.

Для этого следует ввести номер отдела в строке ввода и нажать \keyb{F9}. Если
при нажатии на \keyb{F9} строка ввода была пуста, то откроется калькулятор,
в котором вы сможете нажать кнопку, соответствующую номеру отдела, а затем
для подтверждения кнопку \dlgbutton{=}.

Описанный способ крайне трудоемок для кассира и использовать его
следует только тогда, когда это действительно необходимо.

Если в опциях кассового узла установлен флаг \dlgflag{Запрет ввода позиции без номера отдела},
тогда система не позволит перевести строку из промежуточного буфера в список строк, если
номер отдела не указан.

\ppyadmin{
	Для ручного ввода номера отдела существует метод выбора его с помощью
	сканера штрихкодов. Системой зарезервирован специальный префикс штрихкода
	$DIV$. Если в строке ввода панели чеков вручную либо с помощью сканера ввести
	код, начинающийся с этого префикса и заканчивающийся числом, то система
	воспримет это число как номер отдела.

	Например:
	\begin{itemize}
		\item $DIV02$ - второй отдел
		\item $DIV1$ - первый отдел
		\item $DIV003$ - третий отдел
	\end{itemize}

	Таким образом, можно заранее заготовить палетки со штрихкодами, соответствующими
	всем номерам отделов (штрихкод должен быть в стандарте CODE39) с тем, чтобы
	кассир вместо нажатия на клавиши, мог бы просто просканировать нужный штрихкод.
}

\ppynote{
	Если для строки чека номер отдела выбран вручную, то
	автоматическое правило к нему не применяется.
}

\subsubsection{Как занести введенный товар в список чека}

После того, как товар выбран и введено его количество, строку из буфера ввода необходимо
переместить в список. Для этого можно либо просто нажать \keyb{Enter} в пустой строке
ввода, либо выбрать следующий товар. При этом позиция из буфера ввода переместится в список
строк чека.

\subsubsection{Как определяется цена на товар}

Панель чеков не позволяет ввести цену товара, так как определение цены не входит в
компетенцию кассира. Система позволяет использовать один из нескольких алгоритмов определения
цены товара, которые грубо можно разбить на две категории:
\begin{itemize}
	\item По учетной цене
	\item По котировкам
\end{itemize}
В сущности, это разделение определяет приоритет использования значений цен на товар. Если
приоритетной является котировка, то после выбора товара система сначала ищет наиболее
подходящую котировку для него, и, если находит, то показывает в панели чеков это значение.
Если подходящей котировки нет, то система использует учетную цену.
Если приоритетной является учетная цена, то система использует ее для всех лимитируемых товаров.
Для нелимитированых товаров (услуги и пр.) система использует базовую котировку.
Подробнее политика ценообразования описана в соответствующем разделе.

\subsubsection{Как привязать чек к агенту (продавцу, официанту)}

Система привязки чека к агенту построена на использовании специализированных штрихкодов.
Каждый агент должен иметь карточку со штрихкодом, соответствующем ему. При сканировании
этой карточки система привязывает чек к соответствующему агенту. В информационном поле
средней части панели чеков высвечивается имя агента, к которому привязан чек.

Если в опциях кассового узла установлен флаг \dlgflag{Запрет операций без выбора агента},
то при попытке выбрать товар или провести чек система выдаст сообщение об ошибке, сопровождаемое
звуковым сигналом.

\ppyadmin{
	Специализированный штрихкод карточки агента должен иметь следующий формат: SAL99999
	Здесь $SAL$ - зарезервированный системой префикс, а 99999 - код поискового регистра агента.
	Количество символов в коде регистра не существенно. Штрихкод должен быть в кодировке
	CODE39. Все агенты должны принадлежать таблице статей, привязанной к зарезервированному
	виду персоналий \ppyrsrv{Агенты}. Тип регистра поискового агента определяется вами и указывается
	в таблице статьей, к которой относятся записи агентов (поле \qu{Тип регистра для поиска}
	в диалоге редактирования таблицы аналитических статей).

	Вы можете переопределить префикс кода агента в конфигурации оборудования (см. стр.~\pageref{sec-cfg-trequip}).

	Для того чтобы система могла вести учет привязки чеков к агентам, в системных параметрах
	общих настроек должен быть установлен флаг \dlgflag{Использовать расширение кассовых чеков}.
}

\subsubsection{Как привязать чек к номеру стола (для ресторанов)}

Аналогично привязке к агентам, привязка к столам использует систему специализированных
штрихкодов. Для выбора стола, оператор должен иметь палетку с нанесенными на нее штрихкодами
и подписями номеров столов. При вводе чека, для клиента, который обслуживается за столом N,
просканируйте штрихкод, соответствующий этому столу. При этом в информационном поле средней
части панели чеков высветится номер стола.

\ppyadmin{
	Специализированный штрихкод карточки стола должен иметь следующий формат: $TBL999$
	Здесь $TBL$ - зарезервированный системой префикс, а $999$ - числовой номер стола. Количество
	символов в коде стола не существенно. Штрихкод должен быть в кодировке CODE39.
	Для того чтобы система могла вести учет привязки чеков к агентам, в системных параметрах
	общих настроек должен быть установлен флаг \dlgflag{Использовать расширение кассовых чеков}.
}

\subsubsection{Как провести чек}
Нажатие \keyb{Enter} в пустой строке ввода, когда буфер ввода пуст, а в списке есть хоть одна
позиция, приведет к проведению чека. При этом система запросит способ оплаты (наличная или
безналичная) и, в случае наличной оплаты, выведет на экран калькулятор для расчета сдачи.
Если кассовый узел, с которым связана панель чеков, настроен на работу с фискальным
регистратором, то на фискальном регистраторе отпечатается чек. Если чек успешно проведен
и отпечатан, то панель чеков сразу после этого готова к вводу нового чека.

\ppyadmin{
	Если все расчеты с клиентами на вашем предприятии проводятся наличными деньгами, то вы
	можете избавить кассиров от необходимости всегда выбирать способ оплаты, установив флаг
	\dlgflag{Не запрашивать вид оплаты} для любого из синхронных кассовых узлов.
}

\subsubsection{Как отложить чек\label{sec-howsuspccheck}}

Если по каким-либо причинам чек не должен быть проведен немедленно, его можно отложить для
последующей обработки. Для того чтобы отложить чек нажмите клавишу \keyb{F8}. При этом чек
немедленно будет переведен в состояние отложенного и список панели чеков будет готов для
ввода нового чека.

\subsubsection{Как выбрать отложенный чек}

\paragraph{Ручной выбор отложенного чека}

При необходимости вернуться к чеку, который был отложен, нажмите клавишу \keyb{F8}, когда
панель свободна, то есть когда и список строк чека и буфер ввода пусты. При этом на экране
появится диалог, в котором отобразятся все отложенные чеки для кассового узла, к которому
относится текущая панель чеков. При выборе одного из этих чеков, он немедленно отобразится
в кассовой панели как текущий.

Если непосредственно перед выбором отложенного чека, вы введете в панель код агента и (или)
номер стола, то список выбора отложенных чеков будет ограничен только выбранным агентом и
(или) столом. Эта опция позволяет уменьшить трудозатраты на выбор требуемого отложенного
чека.

\paragraph{Выбор отложенного чека по специальному штрихкоду}

Если образ чека, который был отложен, печатался на принтере со специальным штрихкодом,
то можно быстро восстановить этот чек, просканировав такой штрихкод сканером.

\ppyadmin{
	Для кодирования чеков применяется специальное правило:
	первые два символа кода: $CA$, далее следует 4-значный идентификатор кассового узла и,
	затем, 6-значный номер чека.

	Для печать этого штрихкода следует применять кодировку CODE39. В структуре DL600
	CCheckDetail поле с кодом называется OrderCode, а его версия для печать штрихкода на принтере POrderCode.
}

\ppynote{
	При выборе отложенного чека, в базе данных он получает признак
	\dlgflag{JUNK} и после этого его образ перемещается в панель.

	Если в панели чек будет отменен или произойдет аварийное завершение сеанса
	(например из-за сбоя электропитания), то вы сможете увидеть образ потерянного
	чека в базе данных просмотром чеков с установленным в фильтре чеков флагом
	\dlgflag{Показывать JUNK-чеки} (стр.~\pageref{sec-ppview-ccheck}).

	Если вы хотите, чтобы после введенных вами изменений снова отложить чек,
	то повторите процедуру, описанную на стр.~\pageref{sec-howsuspccheck}.
}

\ppynote{
	Еще одно замечание касается периода, за который отображаются в диалоге выбора отложенные чеки:
	этот период составляет 7 дней до текущей системной даты.

	То есть, если вы выбираете отложенный чек 7 июля, то в списке выбора не будут видны отложенные чеки,
	имеющие дату 30 июня и меньше.
}

\subsubsection{Как разделить отложенный чек на два}

В некоторых случаях возникает необходимость разбивки одного большого чека
на несколько меньших. Чаще всего это случается если несколько клиентов
заказывали одновременно, а расчет просят предоставить раздельно.

Вы можете разделить отложенный чек на два с помощью кнопки \dlgbutton{Разделить}
в диалоге выбора отложенного чека. При нажатии на эту кнопку появляется диалог,
состоящий и горизонтально разделенных двух частей: в верхней части расположены
строки выбранного отложенного чека, а в нижней - строки нового чека. Вам следует
перенести требуемые позиции из верхней части в нижнюю (при переносе система
запрашивает количество товар, который должен из одного чека перейти в другой).

\subsubsection{Как ввести чек возврата}

Система предоставляет два режима ввода возврата покупки:
\begin{itemize}
 	\item	Привязанный возврат
	\item	Не привязанный возврат
\end{itemize}

В первом случае, вы принимаете от покупателя товар в соответствии с чеком продажи, который
он вам предоставил. Во втором случае, ввод возвращаемых позиций свободный. Естественно,
первый вариант предпочтительней, хотя бы по тому, что система при этом \qu{вспомнит} цены,
по которым была осуществлена продажа. Ко второму варианту приходится прибегать в том случае,
если покупатель не может предоставить вам чек, но при этом вы готовы принять его товар обратно.
В любом случае, для ввода чека возврата нажмите в панели чеков \keyb{Ctrl-F5}. При этом на
экране появится диалог, в котором следует ввести номер чека и дату продажи, по которой
делается возврат, после этого нажмите \keyb{Enter}. В списке отобразятся все чеки (обычно
один единственный), имеющие эту дату и номер. Выберите чек. Сразу после выбора чека на
экране появится диалог, в котором отображены позиции чека продажи. Выберите те из них,
которые покупатель хочет вернуть. Проведите сформированный чек возврата.
Если вы хотите сделать не привязанный возврат, то когда появится диалог выбора чека продажи,
нажмите \keyb{Esc} или кнопку \dlgbutton{Отмена}. После этого вы можете свободно выбирать
любые товарные позиции для возврата.

\ppynote{
	При вводе не привязанного чека, цены на товарные позиции система указывает текущие,
	а не те которые были на момент продажи покупателю товара.
}

\subsubsection{Как ввести дисконтную карту}

Если покупатель имеет дисконтную или корпоративную кредитную карту, то для того, чтобы
предоставить ему скидку по этой карте, следует нажать клавишу \keyb{F3} и просканировать
карту сканером или (для карт с магнитной полосой) кардридером.

В информационном поле справа от строки ввода отобразится номер карты и процент скидки,
предоставляемый по этой карте.

Если вы хотите отменить выбор карты, то нажмите снова \keyb{F3} и далее, не вводя ни какого
номера, \keyb{Enter}.

\subsubsection{Внесение денег на корпоративную кредитную карту}

\ppyadmin{
	Для того, чтобы оператор мог через кассовую панель внести деньги на
	кредитную карту клиента необходимо создать специальный нелимитированный
	(он должен принадлежать товарному типу с признаком \dlgflag{Нелимитированный ресурс})
	товар и сослаться на него в конфигурации дисконтных карт (см. стр.~\pageref{sec-scard-cfg}).

	Мы настоятельно рекомендуем присвоить ему какой-либо штрихкод для того,
	чтобы оператор мог быстро выбрать его с помощью сканера при обслуживании клиента.
}

Порядок внесения следующий:
\begin{enumerate}
	\item Нажмите \keyb{F3} и введите номер карты.
	\item Просканируйте штрихкод товара внесения средств на карту.
	\item Введите сумму и символ '*' (сумма внесения вводится как количество
	виртуального товара).
	\item Проведите строку и чек.
\end{enumerate}

Не следует в чек внесения денег добавлять обычные товары: он должен содержать
только одну строку с указанным специальным товаром.

\subsubsection{Возврат денег с корпоративной кредитной карты}

В случае, если необходимо вернуть клиенту остаток средств на его
корпоративной карте, следует поступить также как и в случае с начислением
средств, с той лишь разницей, что чек должен быть возвратным.

\subsubsection{Как предоставить скидку на отдельную позицию чека}

Ручное назначение скидки на отдельную позицию чека является нежелательной
операцией с точки зрения защиты от недобросовестных сотрудников предприятия.

Тем не менее, если необходимо предоставить сотрудникам возможность
назначения скидки на позицию чека, следует установить для пользователя флаг
\dlgflag{Разрешать скидку на строку} в правах по объекту \ppyrsrv{Кассовая сессия}.

Скидка можно предоставить только на позицию, находящуюся в
буфере ввода кассовой панели. Для этого нажмите клавишу \keyb{F3} (ввод
дисконтной карты) и вместо номера карты наберите в строке ввода
значение процента скидки и символ \% либо / после этого значения.

Например:
\begin{description}
	\item[\keyb{F3}~\rdir~5\%] Скидка на строку в буфере 5\%.
	\item[\keyb{F3}~\rdir~3.5/] Скидка на строку в буфере 3.5\%.
	\item[\keyb{F3}~\rdir~2000100000717] Дисконтная карта с номером 2000100000717.
\end{description}

Важная особенность учета такой скидки состоит в том, что она сразу же
включается в цену. То есть, если строка попадет из буфера в список
строк чека, то величина предоставленной скидки не будет отражаться в
колонке \qu{Скидка}, но цена будет уменьшена на величину скидки.

Если на чек будет назначена общая скидка по дисконтной карте, то
для рассматриваемой строки общая скидка будет применена уже на цену,
включающую ручную скидку (таким образом, вы должны учитывать возможность
\qu{двойной} скидки).

Для отмены или изменения ручной скидки следует сбросить содержимое буфера
ввода и выбрать товар снова.

\subsubsection{Как ввести примечание к чеку и (или) параметры доставки}

\ppypict{dlg-cchkdlvr}{Примечание и параметры доставки}

При необходимости можно ввести примечание к чеку. Кроме того, система позволяет
определить кассовый чек как требующий доставки и ввести дополнительные данные
о доставке чеке.

Для вызова диалога ввода примечания и параметров доставки следует дважды щелкнуть
мышью в поле ввода кассовой панели, либо нажать \keyb{F10}. В результате на экране
появится диалог, изображенный на рис.~\ref{pic-dlg-cchkdlvr}.

Этот диалог содержит следующие управляющие элементы:

\begin{description}
	\item[Примечание]
	Текстовое поле, в котором можно ввести произвольный текст длиной до 255 символов.

	\item[\dlgflag{Доставка}]
	Если этот флаг включен, то чек получает признак \qu{Доставка} и
	описанные ниже поля становятся доступными для изменения.

	\item[\dlgcombo{Город}]
	Комбо-бокс, в котором можно выбрать город доставки. Так как обычно
	доставка осуществляется в пределах населенного пункта, в котором
	находится ваше предприятие, то по умолчанию здесь устанавливается город,
	указанный в адресе главной организации.

	\item[ИД]
	Справочное поле, отражающее идентификатор адреса.

	\item[Адрес]
	Поле, в котором следует ввести адрес, по которому должны быть
	осуществлена доставка товаров.

	\item[Телефон]
	Здесь можно ввести номер контактного телефона заказчика.

	\item[Дата]
	Дата доставки.

	\item[Время]
	Планируемое время доставки.

\end{description}

Если, до включения флага \dlgflag{Доставка} поля адреса и телефона были пусты
и в чеке установлена карта, связанная с конкретной персоналией, то система
пытается извлечь адрес и телефон из данных об этой персоналии. Если эта попытка
оказалась успешной, то соответствующие данные окажутся в полях диалога автоматически.

\subsubsection{Как отпечатать чек на офисном принтере}

Для того чтобы отпечатать текущий чек на обычном офисном принтере, нажмите \keyb{Alt-F7}.
При этом будет вызвана обычная процедура печати.
Если список товарных позиций панели пуст, то эта команда отпечатает последний проведенный
чек.

\paragraph{Раздельная печать чека на несколько принтеров}

Для ресторанного бизнеса бывает важно разделить печать чека на несколько частей и отправить
каждую часть на строго определенный принтер. Это связано с необходимостью информировать
различные подразделения предприятия о необходимости приготовления того или иного блюда. В
случае, если на вашем предприятии система настроена на раздельную печать, то при вызове
команды печати чека вы увидите диалог выбора способа печати: на локальные принтеры или на
принтер по умолчанию. Печать на локальные принтеры осуществит вывод строк чека на
соответствующие принтеры, печать на принтер по умолчанию выведет чек обычным образом.

\ppyadmin{
	Раздельная печать чека требует аккуратной настройки. Прежде всего, каждое подразделение, на
	которое отправляется своя часть чека, должно быть ассоциировано с каким-либо складом в базе
	данных. Например, если на вашем предприятии две кухни и один бар, то в базе данных должны
	быть заведены три склада, соответствующих этим подразделениям.

	Далее, система должна \qu{знать}, какая товарная позиция к какому подразделению относится.
	Для определения этих соответствий необходимо воспользоваться справочником ассоциаций
	товар-склад (меню \ppymenu{Справочники\rdir Товары\rdir Ассоциации товар-склад}).

	Наконец, необходимо настроить так называемые локальные принтеры (меню \ppymenu{Справочники\rdir
	Оборудование\rdir Локальные принтеры}). Для каждого подразделения вы должны создать запись
	локального принтера, в которой указать наименование принтера, склад, с которым он связан
	и системный сетевой путь к принтеру.

	После того, как все это сделано, система сможет правильно разделить позиции чеков по
	подразделениям и, сгруппировав, отправить эти позиции на соответствующие принтеры.
	Сотрудники этих подразделений, увидев отпечатанные списки блюд, которые им необходимо
	приготовить, смогут сделать это.
}

\subsubsection{Специальные коды в кассовой панели}

Строка ввода кассовой панели специальным образом обрабатывает некоторые коды,
вводимые с клавиатуры или со сканера штрихкодов. Большая часть этих кодов
определяются префиксом, а следующая за префиксом часть распознается как
уточняющая часть кода. Некоторые коды мы уже обсуждали выше. Здесь мы приведем
сводку специальных кодов и их значение. После обозначения кода следует пометка,
является ли этот код, собственно полным кодом (Код) или префиксом (Префикс).

\begin{description}
	\item[TBL] Префикс. Выбор стола. Сразу за префиксом должен следовать номер стола.
	\item[SAL] Префикс. Выбор официанта (агента по чеку). За префиксом должен следовать
	номер регистра персоналии, заданный в таблице статей \ppyrsrv{Агенты} как поисковый.

	Данный префикс может быть переопределен конфигурацией (см. стр.~\pageref{loc-cfg-trequip-agentcode}).
	\item[SUS00] Код. Отложить чек.
	\item[SUS01] Код. Выбрать отложенный чек.
	\item[DIV] Префикс. Выбор номера отдела. За префиксом должен следовать номер отдела.
	\item[TSN] Префикс. Выбор технологической сессии для конвертации в чек. За префиксом
	должен следовать ид технологической сессии.

	Этот префикс предназначен для внутреннего использования. Вместе с тем, ни что не
	мешает применять его для непосредственного ввода из строки команд.
	\item[99999] Код. Блокировка панели.
\end{description}

\subsection{Режим кассовой панели для сенсорных экранов}

\ppypictsc{dlg-chkpan-ts}{Кассовый панель для сенсорного экрана}{0.25}

Система \ppybrand{} предоставляет специализированный режим кассовой панели
для использования с сенсорными мониторами. Принципы и методы работы этого варианта
аналогичны описанным для обыкновенной кассовой панели. Различия заключаются лишь
в деталях, а именно:

\begin{itemize}
	\item Список подбора товаров и групп находится непосредственно в окне
	панели слева.
	\item Дополнительно введен режим выбора товара из альтернативной группы
	наиболее популярных позиций (кнопка выбора группы с символом \qu{масть червей}).
	\item Все кнопки и большинство вспомогательных диалогов имеют увеличенный
	размер для того, чтобы удобнее было выбирать команды и опции пальцем на
	экране.
\end{itemize}

\subsubsection{Настройка кассовой панели для сенсорных экранов}

Для использования этого режима кассовой панели в первую очередь необходимо
создать запись для сенсорного экрана в справочнике.
Для этого обратитесь к пункту меню \ppymenu{Справочники\rdir Оборудование\rdir TouchScreen}.

\ppynote{
	Обратим внимание на то, что если на вашем предприятии эксплуатируется более
	одного устройства с сенсорным монитором, это не означает, что на каждое
	такое устройство необходимо создавать отдельную запись в данном справочнике.

	Один элемент справочника может обслуживать произвольное число подобных
	друг другу мониторов.
}

\ppypict{dlg-touchscreen}{Диалог редактирования записи TouchScreen}

Диалог редактирования записи о сенсорном мониторе показан на рис.~\ref{pic-dlg-touchscreen}.
Перечислим управляющие элементы этого диалога:

\begin{description}
	\item[Наименование]
	Уникальная среди всех записей данного
	объекта данных строка наименования записи.

	\item[ИД]
	Идентификатор записи.

	\item[\dlgcombo{Тип экрана}]
	Тип монитора.

	\item[\dlgcombo{Группа по умолчанию}]
	Альтернативная товарная группа,
	содержащая наиболее популярные продаваемые позиции.
	Если этот комбо-бокс оставить пустым, то функция выбора из
	такой группы будет не доступна.

	\item[\dlgbutton{Выбор групп товаров}]
	По этой кнопке открывается диалог
	выбора товарных групп, которые будут доступны при подборе товара
	в диалоге кассовой панели.

	\item[\dlgbutton{Выбор шрифта товаров}]
	С помощью диалога, открываемого при нажатии на эту кнопку, вы сможете
	выбрать гарнитуру и размер шрифта которые будут
	использоваться для отображения наименований товаров и групп	в списке
	подбора товара кассовой панели.

	\item[Увеличение высоты элемента выбора товара]
	Поле, позволяющее задать дополнительный вертикальный интервал между
	наименованиям товаров и групп в списке подбора товара кассовой панели.

	\item[\dlgflag{Печать подкладного документа}]
	Если этот флаг установлен, то вместо печати на локальные принтеры, будет
	осуществляться печать подкладного документа на принтере, подключенном
	к компьютеру, на котором запущена кассовая панель.

	\item[\dlgflag{Текст на кнопках}]
	Этот флаг предписывает системе показывать подписи к кнопкам в
	кассовой панели.
\end{description}

После того, как запись сформирована можно связать с нею запись
кассового узла во вкладке по кнопке \dlgbutton{Доп. устройства} (см. стр.~\pageref{sec-cashnode-sync}).
С этого момента кассовая панель для этого узла будет работать в
варианте сенсорного монитора.

\subsection{Автоматическое начисление подарков покупателям\label{sec-chkpan-gift}}

В маркетинговых целях многие предприятия розничной торговли организуют акции,
заключающиеся в выдаче подарков покупателям, если те приобретут определенный
набор товаров.

Система \ppybrand{} позволяет автоматизировать некоторые формы такого
поощрения покупателей при использовании синхронных кассовых узлов.

Здесь существуют следующие возможности:

\begin{itemize}
	\item Автоматическое добавление к кассовому чеку подарочных товаров
	с нулевой ценой.
	\item Фиксированная скидка с суммы чека, при наступлении условий
	предоставления подарка.
	\item Применение специальной цены на товары, составляющие подарочную комбинацию,
	при помощи подарочной котировки.
\end{itemize}

Оба варианта реализуются при помощи так называемых подарочных товарных структур.
То есть, товар, являющийся подарком должен содержать структуру, имеющую признак
\dlgflag{Подарок} (стр.~\pageref{sec-goodsstruc}).

Обратите внимание: владельцем подарочной структуру является товар-подарок, а
номенклатурные позиции, покупка которых служит условием
для предоставления поощрения - компоненты этой структуры.

Следующее важное замечание: компоненты подарочной структуры могут быть
обобщенными товарами, но сам подарок - нет (иначе система просто не будет знать
какой именно товар из обобщения выдавать в качестве подарка).

\ppyexample{
	Вы можете определить в качестве поощрения за покупку трех флаконов \emph{любого из}
	шампуней (все они должны входить в обобщение) один флакон \emph{конкретного}
	ополаскивателя для волос.
}

Одна единица подарочного товара начисляется за один полный комплект компонентов,
перечисленных в подарочной структуре.

\ppyexample{
	За покупку десяти тетрадей и двух ручек вы дарите покупателю один
	карандаш. В этом случае, если покупатель купил 20 тетрадь и 2 ручки, система
	предоставит ему в подарок два карандаша.
}

\subsubsection{Начисление подарка в виде скидки на чек}

Если вы хотите, чтобы в качестве поощрения покупатель, за купленный им набор
товаров, получил бы не товар, а дополнительную скидку на чек, то следует
поступить следующим образом: для комбинации товаров, за покупку которой
дается скидка, создать специальный нелимитированный товар, к которому и привязать
подарочную структуру аналогично тому, как это было сделано для подарка-товара.

Самым важным здесь является необходимость определить для этого товара
специализированную котировку, принадлежащую зарезервированному виду
\ppyrsrv{Подарочная скидка}.

Если этот вид котировки отсутствует в вашей
базе данных, то его можно создать автоматически, обратившись к функции
\ppymenu{Разное\rdir Создание зарезервированных объектов} (этот пункт
есть в системном меню, которое можно увидеть, войдя в базу данных под
именем \ppyrsrv{SYSTEM} и с паролем пользователя \ppyrsrv{MASTER}.

Этот вид котировки будет создан со следующими атрибутами:
\begin{description}
	\item[Наименование] Подарочная скидка
	\item[Символ] GIFT
	\item[ИД] 2
\end{description}

Значение котировки должно быть задано в абсолютном выражении, то есть
подарочная скидка может быть определена только точной суммой.

Подведем краткое резюме правилам определения подарочной скидки:

\begin{itemize}
	\item Товар, для которого определена подарочная структура с
	суммовой скидкой, должен быть нелимитированным.
	\item Для этого товара должна быть определена котировка вида
	\ppyrsrv{Подарочная скидка}.
	\item Значение подарочной скидки должно быть задано
	абсолютным значение, но не процентной величиной.
\end{itemize}

Кроме всего вышесказанного, подарочная скидка имеет особенности в
плане распределения величины скидки по строкам чека. В общем случае,
при проведении чека эта скидка пропорционально распределяется по
строкам, содержащим товары, входящим в подарочную комбинацию.

Если один из компонентов товаров подарочной структуры содержит признак
\qu{Основной компонент структуры}, то скидка будет распределена только
по строкам, содержащим товары, соответствующие этому компоненту.

\subsubsection{Начисление подарка специальных цен}

Возможность продать покупателю некоторые товары по специальным ценам при
достижении им некоторых условий предоставления подарка, определяется полем
\dlgcombo{Подарочная котировка} в диалоге товарной структуры.

Если эта котировка задана, то вместо выдачи подарка на позиции чека,
которые составляют заданную структурой комбинацию подарка, устанавливается цена,
определяемая подарочной котировкой.

При использовании такой подарочной схемы заголовочный товар подарочной структуры
игнорируется.

\subsubsection{Настройка кассового узла для использования подарочных структур}

Для того, чтобы кассовый узел мог обрабатывать подарочные структуры
необходимо в записи этого узла установить флаг \dlgflag{Проверять на выдачу подарков}
(см. стр.~\pageref{loc-cashnode-sync-gift}).

\subsubsection{Учет суммовых подарков при списании сессии}

При списании кассовой сессии суммы подарочных скидок учитываются в документах
возврата.

Если вам необходимо отражать в бухгалтерском учете суммы подарочных
скидок каким-то особым образом, то следует определить отдельный товарный тип
(с признаком \dlgflag{Нелимитируемый ресурс}), к которому привязать товары,
отвечающие за эту скидку. Далее, в этом товарном типе установить типы учетных
сумм, для которых описать шаблоны бухгалтерских проводок в виде операции,
которой принадлежать документы розничного возврата, формируемые по кассовым
сессиям.

\subsubsection{Использование в кассовой панели}

Кассиру, работающему с кассовой панелью, необходимо только проследить за
тем, что система начислила по чеку подарок и выдать его покупателю.
За подарочной скидкой следить не обязательно, поскольку ее выдавать не надо.

Если в результате набора чека программа обнаружила условия поощрения покупателя,
то раздастся звуковой сигнал и поле информации кратковременно окрасится в
зеленый цвет.

Кроме того, если в строках чека присутствует подарок, то поле суммы чека
окрашивается в розовый цвет. Если подарок суммовой, то поле скидки
окрашивается в зеленый цвет.

\section{Работа с кассовыми машинами с асинхронным интерфейсом}

Укрупнено процесс работы с асинхронной кассовой сессией состоит из следующих шагов:

\begin{enumerate}
	\item Начальная загрузка данных в кассовые машины, объединенные кассовым узлом (открытие
	сессии)
	\item Обновление данных на кассовых машинах, по мере поступления нового товара и изменения
	данных по товарам (например, цен)
	\item После снятия суточных (Z) отчетов на кассовых машинах, закрытие сессии, в результате
	которого информация о продажах будет занесена в базу данных системы \ppybrand{}.
	\item Сравнение результатов закрытия сессии с данными кассовых отчетов и, в случае
	обнаружения расхождений, выявление причин и устранение возникших проблем.
	\item Частичное или полное устранение излишков по кассовым сессиям.
\end{enumerate}

\subsection{Полная загрузка кассового узла}

Для полной загрузки кассовых машин, привязанных к кассовому узлу, следует выбрать пункт
меню \ppymenu{Оборудование\rdir Кассовый узел}. Если ваша система настроена на работу с более
чем одним кассовым узлом, то система запросит выбор одного из них. Далее, на экране
появится командная панель для работы с кассовым узлом. На этой панели следует нажать
кнопку \dlgbutton{Открыть сессию}. После чего система начнет процесс формирования данных
для загрузки кассовых машин. Если используемый вашим предприятием тип кассовых машин и
программных модулей, управляющих ими, не позволяет автоматически загрузить сформированные
данные, то может понадобиться на каждой  машине инициировать процесс загрузки.

\subsection{Обновление данных на кассовых машинах}

Во время работы с базой данных система отслеживает факты ввода новых товаров, изменение
существующих, а также изменение цен на товары. Так как полная загрузка кассовых машин -
процесс весьма долгий, то, как правило, для обновления данных на кассовых машинах следует
использовать механизм частичного обновления данных, при котором загружаются только те данные,
которые существенно изменились с момента предыдущей загрузки или обновления кассовой сессии.
Для этого выберите пункт меню \ppymenu{Оборудование\rdir Кассовый узел}. Выбрав, если необходимо,
кассовый узел, в панели управления кассовым узлом нажмите кнопку \dlgbutton{Обновить сессию}.
Как и при полной загрузке, используемый тип кассовых машин может потребовать инициировать
процесс обновления данных с кассовых машин.


\subsection{Закрытие сессии}

Для закрытия последних сессий существуют три альтернативных метода:
\begin{enumerate}
	\item 	Из таблицы кассовых сессий
	\item 	Из панели управления кассовым узлом
	\item 	Из командной строки
\end{enumerate}
Опишем подробно каждый из методов

\subsubsection{Закрытие кассовых сессий из таблицы кассовых сессий}

Выберите пункт меню \ppymenu{Оборудование\rdir Кассовые сессии} В фильтре кассовых сессий
выберите кассовый узел и период, включающий последние дни (если база данных вашего
предприятия включает не очень много кассовых сессий, то можно период оставить пустым).
Флажок \dlgflag{Только суперсессии} должен быть включен. Нажмите \dlgbutton{ОК}.
В появившейся на экране таблице нажмите клавишу \keyb{F8} или пиктограмму, показанную слева.
Процесс закрытия сессий может занять несколько минут, после чего в таблице появятся вновь
сформированные сессии.
Подробно работа с таблицей кассовых сессий описана в соответствующем разделе.

\subsubsection{Закрытие кассовых сессий из панели управления кассовым узлом}

Выберите пункт меню \ppymenu{Оборудование\rdir Кассовый узел}. Выбрав, если необходимо, кассовый
узел, в панели управления кассовым узлом нажмите кнопку \dlgbutton{Закрыть сессию}.
\subsubsection{Закрытие кассовых сессий из командной строки}

Этот способ удобен для автоматического закрытия кассовых сессий без дальнейшего наблюдения
за результатами закрытия.
Для реализации этого метода следует ввести из командной строки либо задать в batch-файле
следующую командную строку:
ppw.exe [user\_name] [/db:database\_name] /imp:cash\_node\_name [/batch]

Здесь:

\begin{description}
	\item[user\_name]
	Необязательный параметр, обозначающий имя пользователя, под которым следует входить
	в систему.

	\item[/db:database\_name]
	Необязательный параметр - имя базы данных, в которую следует войти для закрытия
	сессии.

	\item[/imp:cash\_node\_name]
	Ключевой в данном контексте параметр, предписывающий системе закрыть кассовые сессии
	на кассовом узле с именем cash\_node\_name.

	\item[/batch]
	Необязательный параметр, предписывающий системе завершить работу по окончании закрытия
	сессий.
\end{description}

\section{Таблица кассовых сессий}

Таблица кассовых сессий является развитым инструментом оперирования результатами работы
кассовых машин. Как и большинство таблиц в системе \ppybrand{}, таблица кассовых сессий
предваряется фильтром выбора условий просмотра.

Для входа в таблицу необходимо выбрать пункт меню \ppymenu{Оборудование\rdir Кассовые сессии}.

%topic(DLG_CSESSFILT)

\subsection{Фильтр просмотра кассовых сессий}

\ppypict{dlg-f-csess}{Фильтр по кассовым сессиям}

Внешний вид фильтра кассовых сессий показан на рис.~\ref{pic-dlg-f-csess}.
Следующая таблица перечисляет поля

\begin{description}
	\item[Период]
	Период, в который должны попадать, показываемые в таблице сессии.

	\item[Кассовый узел]
	Кассовый узел, к которому должны относиться показываемые сессии. Кнопка \dlgbutton{Список} справа
	от поля, позволяет выбрать список кассовых узлов, по которым необходимо увидеть сессии.

	\item[Номер кассы]
	Логический номер кассовой машины, сессии по которой вы хотите увидеть в таблице. Если
	здесь стоить 0, то будут показаны сессии, относящиеся ко всем кассовым машинам, и
	удовлетворяющие остальным условиям фильтра.

	\item[\dlgflag{Расширенная ведомость}]
	Установка этого флага позволяет просмотреть расширенную таблицу кассовых сессий, содержащую
	результаты списания, как в ценах реализации, так и в ценах поступления, а также валовую
	доходность (разницу между суммами в ценах реализации и в ценах поступления). Обратим
	внимание на то, что указанные три значения берутся исходя из документов списания, то есть,
	не учитывают те товары, которые были проданы, но которые списать не удалось (попали в дефицит).
	Кроме того, в расширенной ведомости показываются суммы возвратов по каждой сессии и значения
	сумм продаж без учета возвратов.

	\item[\dlgflag{Только суперсессии}]
	Этот признак (установленный по умолчанию) предписывает системе показывать только так
	называемые суперсессии, то есть сессии, объединяющие сессии со всех кассовых машин,
	относящихся к выбранному кассовому узлу и закрытые в течение одних суток.

	\item[\dlgradioc{Сортировка}]
	В этом блоке радио-кнопок можно выбрать желаемый вариант сортировки.

	Вариант \dlgradioi{По умолчанию} предполагает, что сессии будут сортироваться в
	порядке определенном системой (исходя из компромисса между удобством пользователей
	и производительностью).

\end{description}

%topic(BROWSER_CSESS)

\subsection{Таблица просмотра кассовых сессий}

\ppypict{brw-csess}{}

Показанная на рис.~\ref{pic-brw-csess} таблица (не расширенная) содержит следующие колонки:

\begin{description}
	\item[ИД]
	Идентификатор сессии.

	\item[Дата]
	Дата закрытия сессии. Для суперсессии - это дата закрытия последней из содержащихся в
	ней сессий.

	\item[Номер смены]
	Для обычных сессий - номер Z-отчета, снятого с кассовой машины, для суперсессии (если
	она одновременно не соответствует лишь одной кассовой машине) - номер по внутреннему
	реестру.

	\item[Кассовый узел]
	Наименование кассового узла, которому принадлежит сессия.

	\item[Номер кассы]
	Номер кассового аппарата, с которым связана сессия.

	Для синхронных сессий этот номер равен идентификатору кассового узла.

	Для асинхронных сессий - это номер кассового аппарата, импортируемый вместе
	с чеком из кассового модуля.

	\item[Завершенность]
	Специальное поле, указывающее на уровень завершенности в обработке сессии. Правильно
	закрытая сессия имеет это значение равным нулю. Если уровень завершенности не нулевой,
	то следует обратиться к сопровождению за консультациями.

	\item[Сумма чеков]
	Общая сумма чеков, пробитых кассовой машиной (или кассовыми машинами для суперсессии).
	Эта сумма должна соответствовать данным кассового журнала и Z-отчетам, снятым с кассовых
	машин.

	\item[В том числе]
	Группа колонок отображающая значения различных видов оплат, включенных в общую сумму чеков.
	\begin{description}
		\item[Безналичн оплата]
		Сумма чеков, оплаченных безналично.
		\item[Корп кредитные карты]
		Сумма чеков, оплаченных корпоративными кредитными картами.
	\end{description}

	\item[Скидка]
	Сумма скидок по чекам предоставленных покупателям на кассовых машинах.
	Обращаем внимание на то, что сумма скидки включена в значение суммы чеков.

	\item[Списанная сумма]
	Сумма документов розничной продажи, сформированных по результатам кассовой сессии. Эта
	сумма может присутствовать только у суперсессий, поскольку только по ним система
	осуществляет списание. Списанная сумма, как правило, меньше суммы чеков на сумму
	излишков.

	\item[Сумма дефицита]
	Сумма чековых позиций, которые не удалось списать из-за того, что учетный остаток в
	системе соответствующих товаров недостаточен для такой операции. Ежедневная работа
	оператора обязательно должна включать анализ и устранение причин возникновения дефицита
	по кассовым сессиям, а также меры по устранению самого дефицита.
\end{description}

\subsubsection{Операции в таблице кассовых сессий}

Таблица кассовых сессий предоставляет возможность осуществления ряда важных операций по
анализу и управлению данными. Приведем список этих операций:

\paragraph{Деталировка}\indent\keyb{Enter}
Операция деталировки выбранной сессии. Для суперсессии будет показан список сессий по
отдельным кассовым машинам, относящихся к этой суперсессии. Для обычной сессии система
высветит список чеков, относящихся к ней.

\paragraph{Создать новую сессию}\indent\keyb{Insert}

\paragraph{Удалить сессию}\indent\keyb{Delete}
Для суперсессии система предложит на выбор либо удаление
результатов списания, либо полное удаление сессии.

Если кассовая сессия является синхронной и текущей для кассового узла, которому
принадлежит, то вы не сможете ее удалить.

Право на удаление сессий регламентируется флагом \dlgflag{Удаление} в правах
доступа по объекту \qu{Кассовые сессии}.

\paragraph{Дефицит по сессии}\indent\keyb{F3}
Просмотр дефицита по суперсессии. Предварительно система предложит выбрать, хотите ли
вы увидеть дефицит по выбранной сессии или по всей выборке сессий.

\paragraph{Товарный отчет по списанию}\indent\keyb{F4}
Этот отчет позволяет увидеть список товаров, попавших в документы списания сессии с
проданным количеством, ценами, суммами и доходностью. Как и в случае с просмотром излишков,
система предварительно запросит, показывать ли отчет по выбранной сессии либо по всей
совокупности сессий, удовлетворяющих условиям фильтра выборки.

\paragraph{Налоговый отчет по списанию}\indent\keyb{Shift-F4}
Эта функция позволяет получить налоговый отчет по документам
списания сессии или выборки сессий. Непосредственно перед расчетом система запрашивает
дополнительные критерии отчета.

Наибольшее значение эта функция приобретает в том случае, если вам необходимо рассчитывать
такой отчет для магазина, работающего круглосуточно. В этом случае очень трудно подобрать
период расчета в независимом от кассовых сессий налоговом анализе товарооборота, с тем,
чтобы суммы по нему согласовывались с суммами Z-отчетов по кассовым аппаратам.

\paragraph{Чеки по всей выборке сессий}\indent\keyb{Alt-F4}
Открывает таблицу анализа чеков, отображающую чеки, привязанные
ко всем сессиям выборки.

\paragraph{Документы списания}\indent\keyb{F5}
Показывает таблицу документов списания выбранной суперсессии.
Эта функция может быть полезна для уточнения результатов списания.

\paragraph{Документы покрытия дефицита}\indent\keyb{Shift-F5}
Вызывает таблицу просмотра документов покрытия дефицита
списания по выбранной сессии.

\paragraph{Документы списания по всей выборке}\indent\keyb{Ctrl-F5}
Показывает таблицу документов списания по всем сессиям выборки.

\paragraph{Завершить сессию}\indent\keyb{Ctrl-F8}
Завершает закрытие выбранной суперсессии. Такая операция необходима в случае завершения
списания неудачно закрытых сессий, либо при дополнительном списании с учетом закрытия
позиций излишков.

\paragraph{Списание драфт-документов дефицита по сессии}\indent\keyb{Shift-F8}
Функция вызывает процедуру списания драфт-документов покрытия дефицита по сессии.

\paragraph{Передать сессию}\indent\keyb{Ctrl-H}
Передача сессии в другой раздел.

Обратите внимание, что для кассовых сессий в отличие от большинства других таблиц,
этой операцией передается только текущая сессия, а не вся выборка. Это связано,
в первую очередь, с тем, что кассовые сессии вместе со связанными
с ними чеками занимают довольно большой объем, а потому передача выборки сессий займет
очень много времени и потребует большого дискового пространства.

\paragraph{Создать драфт-документ}\indent\keyb{Ctrl-C}
Создание драфт-документа по сессии или по выборке сессий. Специализированная функция,
позволяющая на основе сессии по заранее заданному правилу сформировать драфт-документ,
который может быть использован для формирования каких-либо учетных данных.

Правила создания таких драфт-документов определяются в пункте меню
\ppymenu{Админ\rdir Прочие конфигурации\rdir Правила создания драфт-документов по кассовым сессиям}.

\paragraph{Печать}\indent\keyb{F7}
Печать списка сессий.

Стандартная форма отчета:
\begin{description}
	\item[CSessView] Для обычной таблицы сессий
	\item[CSessViewExt] Для расширенной таблицы сессий
\end{description}

\paragraph{Закрыть последнюю сессию}\indent\keyb{F8}
Завершение последних кассовых сессий

\paragraph{Печать чека на POS-принтер}\indent\keyb{Ctrl-Z}

\paragraph{Итог по выборке}\indent\keyb{F9}
Просмотр итоговых сумм по всей выборке сессий

\paragraph{Фильтр}\indent\keyb{Ctrl-V}
Позволяет изменить условия фильтрации текущей таблицы.

\paragraph{Системная информация о сессии}\indent\keyb{Ctrl-F3}
Просмотр и корректировка системной информации по выбранной кассовой сессии.
При выборе этой операции на экране появляется диалог, в котором можно увидеть системные
атрибуты кассовой сессии. Кроме того, некоторые из атрибутов сессии можно изменить.
Будьте крайне осторожны с модификацией атрибутов кассовых сессий: все атрибуты
устанавливаются автоматически и система очень чувствительна к их значениям.

Право доступа к этой операции регламентируется флагом
\dlgflag{Системная информация по сессии} в правах доступа по объекту
\qu{Кассовые сессии}.

\paragraph{Отвязать сессию от суперсессии}\indent\keyb{Ctrl-D}
Корректирующая функция.
В редких случаях встречается ситуация, когда суперсессия содержит в себе сессию, обработанную
как суперсессия. В этом случае получается так, что документы списания сформированы и по
внутренней сессии и по внешней суперсессии, что является очевидной ошибкой.
Для извлечения внутренней сессии из внешней, на внутренней сессии следует нажать
\keyb{Ctrl-D}. При этом внутренняя сессия потеряет ссылку на родительскую суперсессию,
после чего обе сессии следует пересписать.

Право доступа к этой операции регламентируется флагом \dlgflag{Корректировка сессий}
в правах доступа по объекту \qu{Кассовые сессии}.

\paragraph{Пересчитать сессию}\indent\keyb{Ctrl-R}
Корректирующая функция. См ниже.

Право доступа к этой операции регламентируется флагом \dlgflag{Корректировка сессий} в правах
доступа по объекту \qu{Кассовые сессии}. Причем, отсутствие этого флага не запрещает
пользователю провести проверку выборки кассовых сессий, так как эта проверка не
модифицирует сессии, а только лишь информирует о существующих проблемах.

При выборе корректировки кассовых сессий на экране появляется диалог выбора корректирующей
операции. Этот диалог содержит блок переключателей, значение которых определяется следующим
перечнем:

\begin{description}
	\item[Пересчитать выбранную сессию]
	Эта функция пересчитывает суммы по сессии. В штатном режиме все суммы по сессиям строго
	соответствуют внутреннему содержанию этих сессий, то есть, сумма по чекам равна сумме чеков,
	находящихся в сессии, сумма списания равна сумме документов списания и т.д. Однако, в
	исключительных ситуациях может получиться так, что какие-то суммы не совпадают с теми суммами,
	которые они агрегируют. В этом случае функция пересчета приведет значения агрегирующих сумм
	по выбранной сессии в соответствие с содержанием сессии.

	\item[Пересписать выбранную сессию до 5-го уровня]
	Эта функция объединяет раздельные операции по откату списания сессии и повторному ее
	списанию.
	Эту функцию следует использовать с осторожностью.

	\item[Пересписать выбранную сессию до 10-го уровня]
	Эта функция объединяет раздельные операции по откату списания сессии до 10-го уровня
	завершенности (удаляется группировка по чекам) и повторному списанию этой сессии.
	Значительным преимуществом этой функции по сравнению с раздельным исполнением является то,
	что она сохраняет результаты подстановки альтернативных товаров в дефиците по сессии.
	Эту функцию следует использовать с осторожностью.

	\item[Проверить всю выборку]
	Эта функция проверяет соответствие агрегирующих сумм по всем сессиям выборки с содержанием
	каждой сессии, а также обнаруживает ошибочную вложенность суперсессий.
	Эта операция не осуществляет никаких действий над проверяемыми сессиями, по этому, совершенно
	безопасна.
\end{description}

%endtopic

\subsection{Дефицит по кассовым сессиям\label{loc-csessdfct}}

Так как система не допускает отрицательных товарных остатков по учетным операциям,
при списании кассовой сессии товары, которых не достаточно для формирования расходных
или возвратных документов, формируют дефицит по этой кассовой сессии.

Хорошей практикой можно считать регулярную работу по выявлению и устранению
причин возникновения такого дефицита. Основные его причины следующие:

\begin{description}
	\item[Пересортица при приеме товаров от поставщиков]

	Например, от поставщика пришло две номенклатурные единицы (с разными штрихкодами)
	по 20 штук каждой, а в приходный документ занесли одну номенклатурную
	единицу в количестве 40 штук. В этом случае тот товар, который
	не попал в документ прихода будет продаваться в торговом зале,
	но не будет списан из-за того, что его нет на остатке (при этом,
	тот товар который был введен в документ, будет не оправданно
	значится на остатке).

	\item[Ошибки в маркировке товаров]

	При ручной маркировке, либо при маркировке посредством
	электронных весов, неверная идентификация маркируемого товара
	может также привести к возникновению дефицита.

	\item[Ошибки при ручном формирование товарных документов]

	Так как обычно часть движения товаров учитывается ручным вводом
	документов (например, межскладские перемещения, возвраты поставщикам и т.д.),
	то ошибки идентификации товаров при вводе таких документов также могут
	привести к возникновению дефицита по кассовым сессиям.
\end{description}

\subsubsection{Таблица дефицита по кассовым сессиям}

\ppypictsc{brw-csessexc}{Таблица дефицита по кассовой сессии}{0.35}

Примерный вид таблицы показан на рис.~\ref{pic-brw-csessexc}.
Она содержит следующие столбцы:

\begin{description}
	\item[Знак]
	Эта колонка содержит либо 1 для продажи, либо -1 - для возвратов.

	\item[Товар]
	Наименование дефицитного товара.

	\item[Продано]
	Количество торговых единиц дефицитного товара, которое было
	продано (возвращено) через кассу в течении сессии (выборки сессий).

	\item[Дефицит]
	Количество торговых единиц товара, которое не удалось списать
	из-за того, что товара нет на учетном остатке по складу,
	которому принадлежит кассовая сессия.

	\item[Цена]
	Средняя цена продажи дефицитного товара. Обращаем внимание на то,
	что эта величина получается расчетным путем как результат
	деления суммы продажи на количество торговых единиц.

	То есть, эта цена может отличаться от номинальной цены,
	которая указана на ценнике в торговом зале, из-за скидок
	или изменения цен в течении кассовой сессии.

	\item[Сумма]
	Общая сумма, на которую дефицитный товар был продан (возвращен).

	\item[Группа колонок \qu{Альтернативный товар}]
	Эта группа отображает информацию, связанную с подстановкой
	вместо дефицитного товара иной номенклатурной позиции, которую
	система должна списать.

	\item[Альтернативный товар - Наименование]
	Наименование альтернативного товара.

	\item[Альтернативный товар - Списано]
	Количество альтернативного товара, которое было списано в
	результате досписания кассовой сессии после подстановки.

	\item[Альтернативный товар - Цена]
	Цена альтернативного товара, по которой он был списан после
	подстановки.

	\item[Альтернативный товар - Сумма]
	Сумма досписания альтернативного товара.

	\item[Альтернативный товар - Результат]
	Разница между суммой списания альтернативного товара и
	суммой продажи (возврата) дефицитного товара.

	Эта величина позволяет оценить потери или прибыль от
	причин возникновения дефицита. Важно помнить, что данный
	показатель будет адекватен только в том случае, если
	подстановка альтернативного товара была правильной. То есть,
	если альтернативный товар - действительно тот, что был
	пронесен покупателем через кассу.

\end{description}

\subsubsection{Действия в таблице дефицита по кассовым сессиям}

Таблица дефицита по кассовым сессиям допускает следующие действия:

\paragraph{Товар}\indent\keyb{F2}
Открывает диалог просмотра и редактирования товара, которому соответствует
выбранная строка.

\paragraph{Лоты}\indent\keyb{F3}
Открывает таблицу лотов, связанных с товаром, которому соответствует выбранная строка.

\paragraph{Альтернативный товар}\indent\keyb{F4}
Открывает диалог подстановки альтернативного товара вместо дефицитного.
Подробно подстановка дефицита описана ниже.

\paragraph{Добавить в корзину все товары из отчета}\indent\keyb{Ctrl-F8}
Позволяет перенести в выбранную товарную корзину все номенклатурные
позиции, представленные в отчете.

В корзину попадает дефицитное количество торговых единиц каждого из товаров
отчета.

\paragraph{Печать}\indent\keyb{F7}
Отправляет отчет на печать или на экспорт.

Стандартной формой отчета, в зависимости от параметров фильтрации, является:
Стандартная форма отчета:
\begin{itemize}
	\item Если в фильтре выбран флаг \dlgflag{С альтернативными товарами},
	то \ppyrsrv{CSESSEXCALT}.
	\item В противном случае, \ppyrsrv{CSESSEXC}.
\end{itemize}

\paragraph{Итог}\indent\keyb{F9}
Открывает диалог с итоговыми значениями отчета.

\paragraph{Фильтр}\indent\keyb{Ctrl-V}
Позволяет изменить условия фильтрации текущего отчета.

\subsubsection{Подстановка дефицита}

\ppypict{dlg-csessdfctsubst}{Диалог подстановки дефицитного товара}

Система позволяет подставить вместо дефицитного товара какой-либо иной
и учесть это повторным \qu{досписанием} кассовой сессии.

Для подстановки выберите в таблице дефицита по кассовым сессиям строку,
для которой хотите осуществить подстановку и вызовите команду \qu{Альтернативный товар}
(\keyb{F4}).

Откроется диалог, показанный на рис.~\ref{pic-dlg-csessdfctsubst}.

Диалог состоит из двух блоков:

\paragraph{Блок информации о дефицитном товара}

	Здесь присутствуют следующие информационные поля:
	\begin{itemize}
		\item Наименование дефицитного товара.
		\item Дата последнего поступления дефицитного товара.
		\item Цена поступления (по последнему лоту).
		\item Цена реализации (по последнему лоту).
		\item Фактическая цена продажи. То есть та цена, которая была
		получена за товар на кассе с учетом всех скидок.
	\end{itemize}

\paragraph{Блок подстановки}

	\begin{description}
		\item[\dlgflag{Показывать только те товары, которые сейчас есть на остатке}]
		Если этот флаг установлен, в списке описанного ниже комбо-бокса \dlgcombo{Товар} будут
		отображаться только номенклатурные позиции, присутствующие на текущем учетном остатке.

		\item[\dlgcombo{Товарная группа}]
		Вспомогательный комбо-бокс, позволяющий выбрать группу для сужения списка
		товаров, отображаемых в списке комбо-бокса \dlgcombo{Товар}.

		При открытии диалога для строки дефицита, в которой не определен подстановочный
		товар, данный комбо-бокс инициализируется той же группой, которой принадлежит
		дефицитный товар.

		\item[\dlgcombo{Товар}]
		Здесь может быть выбран собственно подстановочный товар.

		\item[Дата прихода]
		Дата прихода последнего лота выбранного подстановочного товара.

		\item[Цена поступления]
		Цена поступления по последнему лоту.

		\item[Цена реализации]
		Цена реализации по последнему лоту.

		\item[\dlgbutton{Лоты\dots}]
		Вспомогательная кнопка, позволяющая увидеть лоты выбранного подстановочного
		товара.

	\end{description}

\paragraph{Ограничения на подстановку дефицитного товара}

В конфигурации оборудования (стр.~\pageref{sec-cfg-trequip}) может быть указан диапазон
допустимого отклонения учетной цены реализации подстановочного товара от фактической цены
продажи дефицитного товара.

Если при подстановке это ограничение не выполняется, то программа не
допустит этой операции с соответствующим сообщением об ошибке.

\section{Таблица кассовых чеков\label{sec-ppview-ccheck}}

Для просмотра, анализа и печати кассовых чеков используется таблица с соответствующим
названием. Для доступа к этой таблице обратитесь к пункту меню
\ppymenu{Оборудование\rdir Кассовые чеки}.

%topic(DLG_CCHECKFLT)

\subsection{Фильтр кассовых чеков}

\ppypictsc{dlg-f-007}{Фильтр по кассовым чекам}{0.5}

Приведенная ниже таблица перечисляет поля фильтра по кассовым чекам, вид диалога
которого показан на рис.~\ref{pic-dlg-f-007}.

\begin{description}
	\item[Период]
	Здесь следует указать период, за который вы хотите увидеть или проанализировать чеки.

	\item[\dlgflag{Период начала обслуживания}]
	Этот флаг влияет на то, как система интерпретирует указанный выше период.
	Если флаг установлен, то в отчет отбираются только те чеки, чье время начала
	обслуживания попадает в указанный период.

	Время начала обслуживания фиксируются для чеков, не имеющий признака \dlgflag{Доставка}
	или \dlgflag{Заказ стола}, и равно времени, когда чек был создан. Таким образом,
	сколько бы раз чек не откладывали и не восстанавливали из отложенных, время начала
	обслуживания остается неизменным (в отличии от основного времени чека, которое
	изменяется каждый раз при сохранении чека в отложенных).

	\item[\dlgcombo{Кассовый узел}]
	Выберите здесь кассовый узел, которым следует ограничить список чеков.
	Обращаем ваше внимание на то, что выбор конкретного кассового узла может несколько
	замедлить вывод и обработку списка чеков на экран.

	Справа от комбо-бокса находится кнопка \dlgbutton{Список\dots}, нажав на которую
	вы можете выбрать список кассовых узлов, по которому необходимо получить чеки.

	\item[Номер кассы]
	В этом поле можно указать номер кассового аппарата, чеки по которому вы хотите видеть.

	\item[Диапазон номеров чеков]
	В этом поле можно указать диапазон значений, разделенных двумя точками, в который должны
	попадать номера показываемых чеков. Например: 1023..1119.

	\item[\dlgcombo{Группа товаров}]
	Если вы выберите группу в этом комбо-боксе, то система покажет вам только те чеки, которые
	содержат товарные позиции, относящиеся к этой группе.

	С права от комбо-бокса расположена кнопка \dlgbutton{Фильтр}, позволяющая установить
	сложный фильтр для выбора товаров, находящихся в анализируемых чеках.

	\item[\dlgcombo{Товар}]
	Если вы хотите найти чеки, по которым были продажи конкретного товара, то выберите в этом
	комбо-боксе нужный товар. При этом система пробежит строки каждого чека выборки,
	ограниченной всеми прочими критериями фильтрации, и найдет только те, что содержат
	выбранный товар.

	Эта процедура может занять довольно значительное время.

	\item[\dlgcombo{Серия карточек}]
	Если вы выберите здесь какую-либо серию, то будут показаны только те чеки, которые
	проведены по карточкам, относящимся к этой серии.

	\item[\dlgcombo{Номер карточки}]
	Если выбрана карта, то показываются только те чеки, которые проведены именно по этой
	карте.

	\item[\dlgcombo{Агент}]
	Агент по чеку - это дополнительное поле, идентифицирующее продавца в магазине или
	официант в ресторане, который обслуживал клиента, при проведении этого чека. Вы можете
	воспользоваться этим критерием фильтрации для того, чтобы увидеть чеки по выбранному
	агенту. Это позволит, например, рассчитать вознаграждение выбранного агента в зависимости
	от того, сколько покупателей и на какую сумму он обслужил.

	\item[\dlgcombo{Кассир}]
	Позволяет выбрать персоналию-кассира, который выбивал чеки.
	Этот комбо-бокс инициализируется только в том случае, если в конфигурации оборудования установлен
	\dlgcombo{Вид персоналии - кассиры} (см. стр.~\pageref{sec-cfg-trequip}).

	\item[Номер стола]
	Номер стола является специфическим для ресторанного бизнеса расширением чека. Если вы
	используете в учете по чекам номера столов, то этот критерий фильтрации позволит получить
	отчет о чеках по выбранному столу.

	\item[\dlgflag{С неопределенной кассовой сессией}]
	Служебный признак. Позволяет выбрать только те чеки, которые не принадлежат ни одной из
	кассовых сессий.

	\item[\dlgflag{Показывать отложенные}]
	По умолчанию, система не показывает отложенные чеки, поскольку они никак не участвуют в
	учете. Если же вы, все-таки, хотите увидеть отложенные чеки, то включите этот флаг.

	\item[\dlgflag{Только отложенные}]
	Если этот флаг включен, то будут показаны только отложенные чеки.

	\ppynote {
		Включение этого флага автоматически включает и \dlgflag{Показывать отложенные}.
	}

	\item[\dlgflag{Только возвратные}]
	Установка этого флага предписывает системе показывать только чеки возвратов.

	\item[\dlgflag{Только JUNK-чеки}]
	При включенном флаге в выборку чеков войдут только те из них, которые помечены признаком
	\dlgflag{JUNK}.

	Напомним, что речь идет о чеках, которые были извлечены в чековую панель из
	отложенных, но после этого не были ни проведены, ни отложены вновь. То есть,
	проще выражаясь, это - отложенные чеки, которые были потеряны из-за
	сбоя электропитания либо прерывания сеанса по каким-то иным причинам.

	Вследствие вышесказанного JUNK-чеки - достаточно редкая вещь и использование
	рассматриваемого флага актуально в исключительных случаях, когда
	совершенно не понятно куда исчез отложенный чек.

	\item[\dlgflag{Только ненапечатанные}]
	Показывает только те чеки, у которых не установлен признак \dlgflag{Отпечатан}.
	Напомним, этот признак устанавливается у всех чеков, которые принадлежат
	синхронному кассовому узлу и были успешно проведены через фискальный регистратор.

	Если при печати чека на фискальном регистраторе возникла ошибка, то
	чек сохраняется в базе данных, но для него не устанавливается флаг \dlgflag{Отпечатан}.

	Чеки, относящиеся к кассовому узлу с типом \qu{Эмулятор} всегда имеют
	этот признак.

	Чеки, относящиеся к асинхронному кассовому узлу никогда не имеют этого признака.

	\item[\dlgflag{Только с признаком 'Подарок'}]
	Если этот флаг установлен то для отчета будут перебираться только чеки,
	на которых сработало правило предоставление подарка.

	Флаг может быть использован для расчета сумм по таким чекам.

	\ppynote{
		Важно отметить, что чек не хранит информацию о том, какой именно
		подарок и по какой схеме был предоставлен покупателю по чеку.

		Таким образом, суммы по чекам, имеющим рассматриваемый признак
		могут лишь приблизительно дать представление о расходах, понесенных
		вашим предприятием на выдачу подарков покупателям.
	}

	\item[\dlgflag{Только чеки заказа стола}]
	Установка флага предписывает системе отображать только чеки,
	созданные как записи о заказе столов.

	При включении этого флага в таблице просмотра чеков (без группировки)
	отображаются дополнительные колонки:
	\begin{enumerate}
		\item Время начала обслуживания по заказу
		\item Предполагаемое время завершения обслуживания по заказу
	\end{enumerate}

	\item[\dlgflag{Только чеки с доставкой}]
	Если флаг установлен, то отображаться будут только те чеки,
	у которых есть признак \qu{Доставка}.

	При включении этого флага в таблице просмотра чеков (без группировки)
	отображаются дополнительные колонки:
	\begin{enumerate}
		\item Время исполнения %
		\item Телефон
		\item Город доставки
		\item Адрес доставки
	\end{enumerate}

	\ppynote{
		Флаги \dlgflag{Только чеки заказа стола} и \dlgflag{Только чеки с доставкой} -
		взаимоисключающие. То есть, при установке одного из них другой отключается.
	}

	\item[\dlgflag{Только с доставкой и не исполненные}]
	Дополняющий предыдущий флаг, при установке которого отбираются только те
	чеки, у которых включен признак доставки, но по которым не отмечен факт исполнения.

	\ppynote {
		Установка этого флага автоматически включает установку флага \dlgflag{Только чеки с доставкой}
		и отключение \dlgflag{Только чеки заказа стола}.
	}

	\item[\dlgflag{Рассчитывать статистику по строкам}]
	Если флаг включен, то в таблице будут отображаться колонки со значениями
	суммарного количества строк в чеках и количества уникальных товарных позиций
	в каждом чеке.

	Кроме того, если рассчитывается отчет с группировкой, то таблица так же
	будет содержать среднее количество строк и уникальных товарных позиций
	по каждой сгруппированной выборке чеков.

	\ppynote{
		Установка этого флага увеличивает время подготовки отчета.
	}

	\item[\dlgflag{Пропускать неучитываемые чеки}]
	При включенном флаге в выборку не попадают чеки, не учитываемые как завершенная продажа.
	Пропуск осуществляется по следующему правилу: чек пропускается, если имеет признак \dlgflag{Не обрабатывать чек}
	или чек не имеет признака \dlgflag{Отпечатан} и в кассовом узле, к которому он относится установлен
	флаг \dlgflag{Пропускать не отпечатанные чеки}.

	\item[\dlgflag{Печать детализации чеков}]
	Сервисный флаг, не влияющий на выборку чеков, но при печати предписывающий системе использовать
	специализированную печатную форму, которая выводит каждый чек с содержанием.

	\item[\dlgflag{Без признака специального финиша}]
	Специализированная опция, позволяющая отобразить только те чеки, у которых не установлен флаг
	\dlgflag{Финишированный чек}.

	Опция может быть использована для включения дополнительной фазы обработки чеков.

	\item[Параметры группировки]
	С помощью группировки чеков вы сможете провести всесторонний анализ продаж по чекам.
	Варианты группировки описаны ниже.

	\item[Подстановка при группировке]
	Дополнительная опция, позволяющая заместить в группировке товар одним из его атрибутов,
	например, группой. Доступна только для тех вариантов группировки, которые включают
	в себя товар.

	\item[Дробность группировки]
	Определяет дробность группировки сумм чеков или количества товара в строках чеков
	при использовании группировки по сумме или по количеству, соответственно.

	\item[\dlgradioc{Сортировать по}]
	Позволяет выбрать порядок сортировки записей в таблице.
	\begin{description}
		\item[\dlgradioi{Умолчанию}]
		\item[\dlgradioi{Количеству чеков}]
		\item[\dlgradioi{Количеству}]
		\item[\dlgradioi{Сумме}]
	\end{description}

	\item[\dlgradioc{Наличные/безналичные}]
	Вы можете выбрать здесь одно из значений:
	\begin{description}
		\item[\dlgradioi{Все}] показывать чеки независимо от признака наличной/безналичной оплаты.
		\item[\dlgradioi{Только наличные}] показывать только чеки, оплаченные наличными деньгами.
		\item[\dlgradioi{Только безналичные}] показывать только чеки, оплаченные безналично.
	\end{description}

	\item[\dlgradioc{Альтернативный регистратор}]
	Вы можете выбрать здесь критерий отбора чеков по признаку печати на альтарнативном регистраторе.
	\begin{description}
		\item[\dlgradioi{Все}] показывать чеки независимо от того был ли он отпечатан на регулярном или
		альтернативном регистраторе.
		\item[\dlgradioi{Только 'ДА'}] показывать только чеки, отпечатанные на альтернативном регистраторе.
		\item[\dlgradioi{Только 'НЕТ'}] показывать только чеки, отпечатанные на регулярном регистраторе либо
		не отпечатанные вовсе.
	\end{description}
\end{description}

\subsubsection{Группировка кассовых чеков}

Система предоставляет следующие варианты группировка кассовых чеков:

\begin{description}
	\item[По часам] Система сгруппирует все выбранные чеки по каждому часу. Благодаря
	такой группировке, вы увидите, какие часы работы являются самыми продуктивными,
	а какие, наоборот, проходят \qu{вхолостую}.

	\item[По дням] Группировка осуществляется по каждому дню за выбранный период времени.

	\item[По дням недели] Чеки будут сгруппированы по дням недели.

	\item[По дням недели и часам] В таблице будет отображена группировка чеков одновременно
	по двум параметрам: дню недели и часу.

	\item[По аппаратам] Чеки будут сгруппированы по номерам кассовых аппаратов. Такой отчет
	дает представление о загруженности каждого из аппаратов в магазине.

	\item[По карточкам] Система группирует чеки по пластиковым картам (и дисконтным и кредитным).

	\item[По сумме] Чеки группируются по диапазонам сумм. Градация диапазонов задается в
	поле \qu{Дробность группировки по сумме}. Если вы укажете дробность группировки, скажем,
	500, то чеки будут сгруппированы в группы 0..499.99; 500..999.99; 1000..499.99 и т.д.

	\item[По количеству] Чеки группируются по диапазонам количества товара одного наименования
	в чеке. Градация диапазонов задается в поле \qu{Дробность группировки} аналогично тому,
	как это делается в случае группировке по сумме.

	\item[По товарам] Чеки группируются по наименованиям товаров, содержащихся в строках чеков.

	\item[По кассирам] Чеки группируются по кассирам. Если вы используете асинхронные кассовые
	узлы, то вам необходимо настроить загрузку кассиров в базу данных кассового модуля из
	системы \ppybrand{} для того, чтобы система могла правильно идентифицировать кассиров,
	работающих на кассах.

	\item[По агентам] Чеки будут сгруппированы по агенту, к которому привязан чек.
	Этот вариант может быть использован только в том случае, если на вашем предприятии
	применяется такая привязка.

	\item[По количеству строк в чеке] Чеки группируются по количеству строк.
	Градация диапазонов здесь не применяется: обычно количество возможных вариантов
	не превышает сотни.

	\item[По номеру отдела] Группировка осуществляется по номеру отдела, указанному
	в строках чеков.

	\item[По количеству гостей] Чеки группируются по параметру \qu{Количество гостей},
	вводимому в расширении чека. Опция может быть интересна для предприятий общественного питания.

	\item[По номеру стола] Если система используется в ресторанном бизнесе, то
	опция позволит анализировать чеки в разрезе номеров столов.

	\item[По агентам и часам] Комбинированная группировка, суммирующая чеки по паре
	факторов: агент и час.

	\item[По кассовому узлу] Чеки группируются по кассовому узлу, к которому относятся.
	Не путайте с номером кассового аппарата: при работе с асинхронными кассовыми узлами
	один кассовый узел может обслуживать несколько кассовых аппаратов.

	\item[По агентам и товарам] Еще одна комбинированная группировка, собирающая чеки
	одновременно по двум атрибутам: агент и товар. Так как один чек содержит (как правило)
	более одного товара, то данная группировка разбивает чеки.

	При отображении в таблице количество строк в каждой группе показывается с
	выравниванием нулями до 4 знаков (например 0003 - чеки с тремя строками).
	Сделано это для правильной сортировки элементов.
\end{description}

Для всех группировок, кроме вариантов \qu{По товарам} и \qu{По карточкам} в таблице
доступна функция вывода графической гистограммы (исключенные варианты обычно
представлены слишком большим количеством элементов, чтобы можно было их
уместить на одном графике).

%endtopic

\subsection{Цветовое выделение элементов таблицы кассовых чеков}

\begin{itemize}
	\item Если заказ отменён, то левый верхний угол ячейки с номером чека окрашивается в тёмно-синий цвет, иначе в светло-синий.
	\item Если чек является чеком z-отчёта, то левый верхний угол ячейки с номером чека окрашивается в жёлтый цвет.
	\item Если отложенный чек загружен в чековую панель, то левый верхний угол ячейки с номером чека окрашивается в коричневый цвет.
	\item Если чек является отложенным, то левый верхний угол ячейки с номером чека окрашивается в оранжевый цвет.
	\item Если чек является чеком возврата, то левый верхний угол ячейки с номером чека окрашивается в красный цвет.
	\item Если чек был отпечатан (пробит на ККМ), то левый верхний угол ячейки с номером чека окрашивается в серый цвет.
	\item Если чек, имееющий опцию доставки, является чеком закрытого заказа стола, то левый нижний угол ячейки с номером чека окрашивается в жёлтый цвет, иначе в коралловый .
\end{itemize}





\subsection{Действия в таблице кассовых чеков}

До того как перечислить функции в таблице кассовых чеков скажем, что
часть из этих функций доступна только по сгруппированным чекам, а другая %
часть - только по не сгруппированным (см. опции фильтра чеков).

\paragraph{Просмотр чека/Детализация}\indent\keyb{Enter}
	Эта функция позволяет увидеть товарное содержание чека. При этом редактирование этой
	информации не возможно.

	Если отчет получен с группировкой, то эта операция детализирует выбранную
	сгруппированную строку.
\paragraph{Добавить чек}\indent\keyb{Insert}
	Эта функция доступна только в режиме работы с чеками активной кассовой сессии синхронного
	кассового узла. При выборе этой команды на экране появляется панель ввода чеков, где
	пользователь может вводить данные о продажах.
	В остальных случаях эта функция не действует.
\paragraph{Удалить чек}\indent\keyb{Delete}
	Удаляет выбранный чек. Эта операция возможна только в том случае, если пользователь имеет
	право на удаление чеков.

	Удаление чеков бывает нужно крайне редко, а потому мы настоятельно рекомендуем выставлять
	запрет пользователям на эту операцию. Кроме того, удаленные чеки по синхронным кассовым
	узлам восстановить невозможно, в противовес асинхронным кассовым узлам, где чеки, как
	правило, можно повторно забрать из базы данных кассового модуля (по крайней мере, в
	течение какого-то времени).
\paragraph{Создание драфт-документа по чеку}\indent\keyb{F2}\label{loc-v-ccheck-f01}
	С помощью этой функции вы можете создать расходный драфт-документ по одному
	(текущему) чеку либо по всей выборке чеков.

	Для того, чтобы эта функция была возможна в конфигурации оборудования должен
	быть определен вид операции покрытия временных сессий (см.~\pageref{sec-cfg-trequip}).
	Кроме того, система проверяет чтобы этот вид операции относился к типу драфт-расход
	(в противном случае вызов функции ни к чему не приведет).
\paragraph{Системная информация о чеке}\indent\keyb{Ctrl-F3}
	Позволяет просмотреть системную информацию о чеке. Эта функция допускает частичную
	модификацию этой информации, что бывает нужно очень редко в целях исправления каких-либо
	нештатных ситуаций.
	\ppyadmin{
		Доступ к этой функции регламентируется признаком \dlgflag{Специальная информация
		по чекам} в правах доступа по объектам \qu{Кассовые сессии}.
	}
\paragraph{Корреляция товаров}\indent\keyb{F6}
	Рассчитывает по-парные количества совместного нахождения товаров в чеках.
	Перед запуском этой функции система запросит у вас параметры отчета.
\paragraph{Печать списка чеков}\indent\keyb{F7}
	Выводит на печать отчет, соответствующий выбранным параметрам фильтрации.

	Используются следующие стандартные формы отчетов:
	\begin{description}
		\item[CCheckView] Если не выбрана группировка чеков. То есть, этот
		отчет содержит простой список чеков.
		\item[CCheckView\_Q] Список строк чеков, который формируется при
		выборе в фильтре товара или товарной группы, а также при фильтрации
		отчета по диапазону суммы, но без группировки.
		\item[CCheckView\_G\_DT] При группировке чеков по дате.
		\item[CCheckView\_G\_Q] При группировке чеков по количеству.
		\item[CCheckView\_G] При остальных вариантах группировки чеков.
	\end{description}
\paragraph{Корректировка чеков\label{loc-ccheckview-recover}}\indent\keyb{Ctrl-R}
	Специальная функция, проверяющая рассогласования в чеках.
	Не смотря на название функции, она в действительности не предпринимает каких-либо
	шагов для исправления обнаруженных ошибок.

	Проверка осуществляется по следующим критериям:
	\begin{itemize}
		\item Соответствие суммы чека суммам строк.
		\item Соответствие скидки по чеку скидкам по строкам этого чека.
		\item Целостность ссылки на дисконтную карту. То есть, если чек
		привязан к карте, но такой карты в базе данных не существует, то
		будет выведено сообщение об ошибке.
	\end{itemize}
\paragraph{Итоги}\indent\keyb{F9}
	Показывает итоговые значения по выборке чеков.
\paragraph{График}\indent\keyb{Ctrl-N}
	Эта функция доступна только в таблице просмотра группировки чеков.

	При ее вызове открывается гистограмма распределения сумм и скидок
	чеков, сгруппированных по заданным параметрам.

\section{Язык описания форматов POS-отчетов\label{sec-slipformat}}

POS-отчетами мы будем называть чеки, копии чеков, подкладные документы, кассовые
отчеты и другие печатные формы, выводимые на специализированный принтер (POS-принтер).

Характерной особенностью POS-принтеров является специфичность интерфейса для работы с
ними при одновременном отсутствии полноценного драйвера, позволяющего абстрагироваться
от особенностей этого интерфейса посредством операционной системы.

По этому, для того, чтобы форматы чеков, подкладных документов и отчетов по кассовым
аппаратам, выводимых на специализированных принтерах и фискальных регистраторах, были
максимально независимы от кода системы, используется язык описания форматов чеков.

\subsection{Источники данных при печати POS-отчетов}

Источником данных для печати POS-отчетов могут служить:
\begin{itemize}
	\item Кассовые чеки
	\item Товарные документы
	\item Кассовые сессии
\end{itemize}
Естественно, вы должны настраивать формы исходя из предположения, что именно будет
выводиться на печать с помощью этой формы.

\subsection{Вводный пример}

Для того, чтобы разъяснения по этому языку были понятнее, начнем с простого примера

\begin{Verbatim}[fontfamily=courier, fontsize=\small, frame=single]
slip Form1 {
	title="КОПИЯ ЧЕКА"
	number="@billno"
	pagewidth=36
	pagelength=60
	paper=regular,journal
.header
	"@mainorg"
	"ПРОДАЖА"
	"@date-@time-@billno"
	space="-"
.detail
	"@goods"
	if(@qtty != 1)
		"@qtty X @price=@itemamt" right
	else
		"@price=@itemamt" right
	endif
.footer
	if(@discount > 0)
		"СКИДКА @pctdis=@discount" right
	endif
	space="-"
	"ИТОГО=@amount" right
\end{Verbatim}

В файле определения форматом может содержаться любое количество таких описаний.

\subsubsection{Рамка описания формата}

Описание каждого формата начинается с зарезервированного слова slip, за которым следует
наименование формата. Затем должна следовать открывающая фигурная скобка. Завершается
описание закрывающей фигурной скобкой.

И так, пустое описание формата будет иметь вид:

\begin{Verbatim}[fontfamily=courier, fontsize=\small, frame=single]
slip Form1 {
}
\end{Verbatim}

Так как от такого описания мало пользы, то его следует наполнить содержанием.

\subsubsection{Заголовочная зона формата}

Содержание состоит, во-первых, из заголовочной зоны, которая следует с новой строки после
открывающей фигурной скобки и представлена набором параметров.
Каждый параметр записывается в форме: параметр=значение<перевод каретки>
Перечислим эти параметры

\begin{description}
	\item[Title]
	Заголовок чека, передаваемый специализированному печатающему устройству. Использование
	этого параметра полностью определяется конкретным печатающим устройством и система
	больше никак его не применяет.

	\item[Number]
	Номер документа. Так же как и параметр title, этот параметр передается специализированному
	печатающему устройству. Система не пытается самостоятельно выводить это значение на печать.

	\item[PageWidth]
	Ширина листа или ленты, на которую ведется печать. Это значение задается в символах
	Если этот параметр не указан, то система попытается самостоятельно установить правильное
	значение ширины листа, однако, невозможно гарантировать, что она это сможет сделать,
	поскольку это целиком зависит от драйвера печатающего устройства.

	\item[PageLength]
	Длина листа, на который ведется печать. Если это значение не указано (или, что тоже самое,
	равно нулю) то система считает что печать ведется на бумажную ленту и не предпринимает
	никаких действий по ограничению вывода строк на принтер.
	Если значение больше нуля, то система будет предлагать пользователю вставить бумагу в
	принтер, когда закончился очередной лист.

	\item[Paper]
	Так как некоторые устройства могут одновременно печатать на несколько источников бумаги,
	то этот параметр уточняет на какую именно бумагу (ленту) печатать форму.
	Здесь допустимы следующие варианты:
	\begin{description}
		\item[regular] печать на регулярную кассовую ленту
		\item[journal] печать на контрольную кассовую ленту
		\item[slip] печать подкладного документа.
	\end{description}
	В зависимости от возможностей принтера, некоторые из этих опций могут быть невыполнимыми.
	В этом случае, система просто не будет выводить соответствующий отчет.
	Опции regular и journal могут быть совмещены:
	paper=regular,journal
	При этом принтер будет выводить форму одновременно и на регулярную и на контрольную ленты.
	Если этот параметр вовсе опущен, то система считает, что задана опция regular.

	\item[Font]
	Определитель шрифта. При выводе отчета на обычный принтер, можно задать набор
	шрифтов, которые будут использоваться при печати различных строк.

	В заголовочной зоне может быть задано произвольное количество таких определителей.

	Формат определителя шрифта следующий:

	font-id~=~\qu{font-name}~font-size~[page-width]

	Здесь:
	\begin{description}
		\item[font-id] Идентификатор определителя. Это значение используется в описании строк зоны вывода для ссылки на
		тот или иной определитель шрифта.

		Определитель с идентификатором 0, если задан, то будет использоваться по умолчанию для строк вывода, в которых
		не указан явно идентификатор шрифта.

		\item[font-name] Наименование гарнитуры шрифта. Это наименование должно быть заключено в кавычки.

		\item[font-size] Размер шрифта.

		\item[page-width] Опциональное значение количества символов,
		которое может быть отпечатано заданным шрифтом. Если это значение
		не указано, то программа применит для этого шрифта величину,
		указанную параметром PageWidth, описанным выше.

	\end{description}

	\ppyexample{

		font 0 = "courier new" 10 50 \newline
		font 1 = "times new roman" 12 \newline
		font 2 = "Arial Bold" 12 30
	}

\end{description}

\subsubsection{Зоны вывода}

В описании формы может быть несколько зон вывода данных. Каждая из зон характеризуется
принадлежностью к одному из трех видов:
\begin{itemize}
 	\item $header$ - зона заголовка формы. Она печатается в самом начале и один раз.
	\item $detail$ - зона повторяющейся по строкам источника данных информации.
	\item $paymdetail$ - зона по элементам оплат кассового чека. Данная зона не применима для иных источников
	данных кроме кассового чека (для прочих источников она игнорируется).

	\ppyadmin{Зона введена в версии 8.4.1}

	\item $footer$ - завершающая зона формы. Печатается один раз в конце отчета.
\end{itemize}

\ppynote{
	Хотя, синтаксически допустимо в файле описывать более одной зоны одинакового вида,
	система будет использовать для печати только первую из них.
}

Описание зоны состоит из следующей в начале строки точки, непосредственно за которой
следует наименование вида зоны ($header$, $detail$, $footer$). Затем должен следовать перевод
каретки.

Содержание зоны состоит из определения печатаемых строк. Определение может быть одного
из трех видов:
\begin{itemize}
	\item 	строка
	\item 	определение пустой строки
	\item 	условный оператор
\end{itemize}

\paragraph{Строка}

Элемент строки содержит собственно строку печати, обрамленную двойными кавычками и,
возможно, опции форматирования.

Строка может содержать внутри себя псевдопеременные, вместо которых программа подставит
значения из базы данных, соответствующие источнику данных. Полный список псевдопеременных
приведен ниже.

\paragraph{Перенос строки при печати}

Для того, чтобы при печати строка была перенесена на следующую используется специальная %
грамматическая конструкция: $wrap=number$, где $number$ - количество символов на одной строке.

\ppyexample{

{\ttfamily \symbol{34}\symbol{64}goods\symbol{34} wrap=20} % "@goods" wrap=20

}

В этом примере первые двадцать символов наименования товаров программа распечатает на
текущей строки, а все, что останется перенесет на следующую. Если остаток превышает
указанные 20 символов, то перенос будет продолжен на следующую строку.

При переносе система пытается разбивать строки по пробелу. То есть, если в приведенном
выше примере 21-й символ не является пробелом, то будет найдет первый пробел слева от
него и по этому пробелу и произойдет разрыв строки. Если же пробел найден не будет,
то строка будет разорвана посреди слова.

\paragraph{Разбиение строки на левую и правую части}

Если необходимо вывести строку, состоящую из двух частей, таких что,
левая часть выравнивается по левому краю ленты, а правая - по правому краю,
то следует в описании строки вставить пару символов \symbol{92}t. Эта пара разобьет
выводимую строку так как описано выше.

По умолчанию, левая и правая части строки будут разделены пробелами. Если
требуется использовать иной символ разделения, то укажете его непосредственно
после \symbol{92}t, предварив знаком \symbol{92}.

\ppyexample{

{\ttfamily \symbol{34}\symbol{64}goods\symbol{92}t\symbol{64}qtty X \symbol{64}price\symbol{34}}

{\ttfamily \symbol{34}\symbol{64}goods\symbol{92}t\symbol{92}.\symbol{64}qtty X \symbol{64}price\symbol{34}}

При печати строки чеки, по которой продан товар, скажем, 'Бананы, вес' в количестве 3.21кг по
цене 30руб. за килограмм получим следующие результаты:

{\ttfamily Бананы, вес~~~~~~~~~~~~30 x 3.210}

и

{\ttfamily Бананы, вес...........~30 x 3.210}

соответственно.
}

Обратим внимание на то, что, фактически, строка разбивается на две только в том случае,
если сумма длин левой и правой частей плюс один символ пробела, меньше, чем
ширина бумажной ленты в символах (с учетом определителя шрифта, в котором должна
печататься эта строка).

\paragraph{Определение пустой строки}

Для вывода пустой строки применяется специальный оператор space.
Этот оператор может использоваться в конструкции, позволяющей заполнить
строку каким-либо символов. Для этого символ следует указать в кавычках
вслед за оператором после символа =.

\ppyexample{

{\ttfamily space=\symbol{34}-\symbol{34}}

Этот оператор выведет строку, состоящую из символов - (тире).

{\ttfamily space}

Этот оператор выведет строку, состоящую из одних пробелов.

}

\paragraph{Условный оператор}

Язык описания POS-отчетов допускает использование простых условных операторов $if$ и $else$.
При этом условиями внутри оператора $if$ могут быть операторы сравнения:
\begin{description}
	\item[<] меньше
	\item[<=] меньше или равно
	\item[>] больше
	\item[>=] больше или равно
	\item[=] равно
	\item[==] равно (\qu{синтаксический сахар} - полностью аналогичен оператору $=$)
	\item[<>] не равно
	\item[!=] не равно (\qu{синтаксический сахар} - полностью аналогичен оператору $<>$)
\end{description}

\begin{Verbatim}[fontfamily=courier, fontsize=\small, frame=single]
Примеры условных конструкций:

if(@itemdispct > 0)
	if(@isgiftquot > 0)
		"ПОДАРОЧНАЯ СКИДКА =@ITEMDISPCT\%" right
	else
		"СКИДКА =@ITEMDISPCT\%" right
	endif
endif

if(@scard <> ""')
	"НОМЕР КАРТЫ: @scard"'
endif
\end{Verbatim}

\subsection{Псевдопеременные языка описания POS-отчетов}

Следующая таблица перечисляет все псевдопеременные, которые можно использовать в описаниях
POS-отчетов.

Заметим, что программа при разборе описаний не проверяет допустимость псевдопеременных.
Таким образом, если вы введете в строке форматирования скажем такой текст \qu{@ABRACADABRA},
то программа выведет в отчете строку ABRACADABRA.

Если система не может исходя из контекста правильно подставить значение псевдопеременной,
то она подставляет пустую строку.

Например, требование напечатать строку
\qu{Количество = @QTTY} в итоговой зоне отчета приведет к появлению текста:
\qu{Количество =} (разумеется, без кавычек).

Дополнительно заметим, что описываемый язык не \qu{умеет} решать формулы. То есть, вы не
можете указать \qu{@PRICE * 2} в надежде получить удвоенную цену по строке. Результатом
будет что-то вроде этого: \qu{45.00 * 2}.

\begin{description}
	\item[@CURDATE]

	Контекст: Любой

	Текущая дата.

	\item[@CURTIME]
	Контекст: Любой

	Текущее время.

	\item[@MAINORG]

	Контекст: Любой

	Наименование главной организации.

	\item[@DATE]

	Контекст: Кассовый чек, документ, кассовая сессия.

	Дата документа (чека, сессии).

	\item[@TIME]

	Контекст: Кассовый чек, кассовая сессия.

	Время кассового чека или сессии.

	\item[@BILLNO]

	Контекст: Кассовый чек, документ, кассовая сессия.

	Номер документа (чека, сессии).

	\item[@CLIENT]

	Контекст: Документ.

	Наименование контрагента по документу.

	\item[@CLIENTEXTNAME]

	Контекст: Документ.

	Расширенное наименование контрагента по документу. Если персоналия-контрагент не имеет расширенного
	наименования, то псевдопеременная замещается стандартным наименованием контрагента.

	\item[@AGENT]

	Контекст: Кассовый чек, документ.

	Наименование агента по документу либо кассовому чеку.

	\item[@CASHIER]

	Контекст: Кассовый чек, документ, кассовая сессия.

	В контексте кассового чека, если в нем определен пользователь,
	пробивший чек, то эта переменная заменяется на имя указанной персоналии.

	В контексте товарного документа, кассовой сессии, либо кассового чека,
	для которого не определен пользователь его создавший,
	псевдопеременная заменяется на имя персоналии, сопоставленной
	с пользователем текущего сеанса системы, или же, если с пользователем не
	сопоставлена персоналия, на имя самого пользователя.

	\item[@DIRECTOR]

	Контекст: Кассовый чек, документ, кассовая сессия.

	Имя директора текущей главной организации.

	\item[@ACCOUNTANT]

	Контекст: Кассовый чек, документ, кассовая сессия.

	Имя главного бухгалтера текущей главной организации.

	\item[@TABLE]

	Контекст: Кассовый чек.

	Наименование или номер стола, к которому привязан кассовый чек. Если номер стола, указанный в чеке
	является символом элемента справочника столов ресторанного зала, то вместо этой пвседопеременной
	подставляется имя стола из справочника, в противном случае - значение номера.

	\item[@TABLN]

	Контекст: Кассовый чек.

	Номер стола, к которому привязан кассовый чек.	В отличии от @TABLE данная переменная никогда не
	замещается наименованием стола из справочника.

	\ppyadminline{Переменная введена в релизе 8.4.1.}

	\ppynote{
		Обратите внимание на написание переменной - буквы E между L и N нет.
	}

	\item[@AMOUNT]

	Контекст: Кассовый чек, документ, кассовая сессия.

	Номинальная сумма документа или чека. Для кассовой сессии - сумма выручки по чекам за
	минусом возвратов (включая и наличный и безналичный расчет).
	Эта сумма учитывает все скидки, предоставленные покупателю.

	\item[@DISCOUNT]

	Контекст: Кассовый чек, документ, кассовая сессия.

	Сумма скидка по документу или чеку. Для кассовой сессии - общая сумма скидки по всем
	чекам.

	\item[@AMOUNTWODIS]

	Контекст: Кассовый чек, документ, кассовая сессия.

	Сумма документа (чека, сессии) без учета скидок (в предположении, что по документам или
	чекам скидки не предоставлялись).

	Величины @AMOUNT, @DISCOUNT и @AMOUNTWODIS связаны выражением:
	@AMOUNT = @AMOUNTWODIS - @DISCOUNT.

	\item[@FISCALAMOUNT]

	Контекст: Кассовый чек.

	Фискальная сумма чека.

	\item[@NONFISCALAMOUNT]

	Контекст: Кассовый чек.

	Нефискальная сумма чека.

	\item[@BRINGAMOUNT]

	Контекст: Кассовый чек.

	Сумма наличных денег переданных кассиру покупателем до
	выдачи сдачи. Если чек оплачен безналично, то эта величина
	равна сумме чека.

	\item[@DELIVERYAMOUNT]

	Контекст: Кассовый чек.

	Сумма сдачи возвращенная кассиром покупателю. Для чека, оплаченного
	безналично значение этой пвсевдопеременной равно нулю.

	Величины @AMOUNT, @BRINGAMOUNT и @DELIVERYAMOUNT связаны выражением:
	@DELIVERYAMOUNT = @BRINGAMOUNT - @AMOUNT.

	\item[@SCARD]

	Контекст: Кассовый чек, документ.

	Номер персональной карты, привязанной к чеку (документу).

	В зоне $paymdetail$ для кассового чека эта псевдопеременная отражает номер кредитной или бонусной карты, которой
	был осуществлен частичный платеж.

	\item[@SCARDOWNER]

	Контекст: Кассовый чек, документ.

	Имя владельца дисконтной карты, привязанной к чеку или документу.

	В зоне $paymdetail$ для кассового чека эта псевдопеременная отражает имя владельца кредитной или бонусной карты, которой
	был осуществлен частичный платеж.

	\item[@ISCREDITSCARD]

	Контекст: Кассовый чек, документ.

	Если карта, к которой привязан чек или документ является кредитной,
	то эта пвсевдопеременная равна 1, в противном случае 0.

	Данную псевдопеременную не следует использовать, начиная с версии 7.4.10:
	вместо нее рекомендуется применять переменную @SCARDTYPE.

	В зоне $paymdetail$ для кассового чека эта псевдопеременная применяется к кредитной или бонусной карте, которой
	был осуществлен частичный платеж.

	\item[@SCARDTYPE]

	Контекст: Кассовый чек, документ.

	Тип карты, ассоциированной с чеком или документом.
	Возможные варианты результата следующие:
	\begin{description}
		\item[1] Обыкновенная дисконтная карта.
		\item[2] Корпоративная кредитная карта.
		\item[3] Бонусная карта.
		\item[0] С чеком либо документом не ассоциирована карта, или же
		возникла ошибка с определением ее типа (такая ошибка может возникнуть
		только в результате сбоя в базе данных).
	\end{description}

	В зоне $paymdetail$ для кассового чека эта псевдопеременная применяется к кредитной или бонусной карте, которой
	был осуществлен частичный платеж.

	\ppyadminline{Переменная введена в релизе 7.4.10.}

	\item[@SCARDREST]

	Контекст: Кассовый чек, документ.

	Остаток на корпоративной кредитной карте, к которой привязан чек или
	документ. Если карта не является кредитной, то значение всегда 0.

	Значение остатка учитывает операцию, по которой печатается отчет.

	В зоне $paymdetail$ для кассового чека эта псевдопеременная применяется к кредитной или бонусной карте, которой
	был осуществлен частичный платеж.

	\item[@PCTDIS]

	Контекст: Кассовый чек, документ.

	Величина скидки в процентах к величине @AMOUNTWODIS.

	\item[@WROFFAMOUNT]

	Контекст: Кассовая сессия.

	Сумма списания кассовой сессии.

	\item[@DEFICIT]

	Контекст: Кассовая сессия.

	Сумма дефицита по кассовой сессии.

	\item[@ITEMNO]

	Контекст: Кассовый чек, документ.
	Только для зоны $.detail$.

	Номер строки чека или товарного документа.

	\ppyadminline{Переменная введена в релизе 6.2.12.}

	\item[@GOODSGRP]

	Контекст: Кассовый чек, документ.
	Только для зоны $.detail$.

	Наименование непосредственной родительской группы товара,
	соответствующего строке чека или документа.

	\ppyadminline{Переменная введена в релизе 5.9.9.}

	\item[@GOODS]

	Контекст: Кассовый чек, документ.
	Только для зоны $.detail$.

	Наименование товара, соответствующего строке чека или документа.

	\item[@QTTY]

	Контекст: Кассовый чек, документ.
	Только для зоны $.detail$.

	Количество товара, соответствующего строке чека либо документа.
	Величина этой переменной всегда больше или равна нулю.

	Выводимое значение округляется до трех знаков после точки с отбрасыванием незначащих нулей.

	\item[@PHQTTY]

	Контекст: Кассовый чек, документ.
	Только для зоны $.detail$.

	Физическое количество товара, соответствующего строке чека либо документа.
	Величина этой переменной всегда больше или равна нулю.

	Если для товара не определена физическая единица или соотношение физических
	к торговым единицам равно нулю, но псевдопеременная замещается на пустую строку.

	Выводимое значение округляется до трех знаков после точки с отбрасыванием незначащих нулей.

	\ppyadminline{Переменная введена в релизе 7.5.0.}

	\item[@PHUNIT]

	Контекст: Кассовый чек, документ.
	Только для зоны $.detail$.

	Наименование физической единицы измерения товара, соответствующего строке чека или документа.
	Если для товара не определена физическая единица, то пвсевдопеременная замещается на
	пустую строку.

	\ppyadminline{Переменная введена в релизе 7.5.0.}

	\item[@PRICE]

	Контекст: Кассовый чек, документ.
	Только для зоны $.detail$.

	Цена единицы товара, соответствующая строке чека или документа. Эта величина
	учитывает все скидки, предоставленные покупателю.

	\item[@PRICEWODIS]

	Контекст: Кассовый чек, документ.
	Только для зоны $.detail$.

	Цена единицы товара, соответствующая строке чека или документа без учета скидок.

	\item[@ITEMDIS]

	Контекст: Кассовый чек, документ.
	Только для зоны $.detail$.

	Скидка по строке чека на одну единицу товара (документа).
	Значение округляется до двух знаков после точки.

	Величины @PRICE, @PRICEWODIS и @ITEMDIS связаны соотношением:

	$@PRICE = @PRICEWODIS - @ITEMDIS$

	\item[@ITEMDISAMT]

	Контекст: Кассовый чек, документ.
	Только для зоны $.detail$.

	Сумма скидка по строке чека (документа).
	Значение округляется до двух знаков после точки.

	Должно выполняться равенство:

	$@ITEMDISAMT = @ITEMDIS * @QTTY$

	\item[@ITEMDISPCT]

	Контекст: Кассовый чек, документ.
	Только для зоны $.detail$.

	Процентная величина скидка по строке чека (документа).
	Значение округляется до одного знака после точки.

	\item[@ITEMAMT]
	Контекст: Кассовый чек, документ.
	Только для зоны $.detail$.

	Сумма по строке документа или чека с учетом всех скидок.

	Должно выполняться равенство:

	$@ITEMAMT = @PRICE * @QTTY$

	\item[@ITEMAMTWODIS]
	Контекст: Кассовый чек, документ.
	Только для зоны $.detail$.

	Сумма по строке документа или чека без учета скидок.

	Должно выполняться равенство:

	$@ITEMAMTWODIS = @PRICEWODIS * @QTTY$

	\item[@ISGIFTQUOT]
	Контекст: Кассовый чек.
	Только для зоны $.detail$.

	Если по строке предоставлена скидка по подарочной котировке, то
	результатом подстановки этой псевдопеременной будет 1, в противном
	случае - 0.

	\ppyadminline{Переменная введена в релизе 7.4.10.}

	\item[@MEMO]
	Контекст: Кассовый чек, документ.

	Текст примечания к документу или чеку.

	\item[@POS]
	Контекст: Кассовый чек, кассовая сессия.

	Номер кассового аппарата, которому соответствует чек или кассовая сессия.
	Если POS-отчет печатается по суперсессии, объединяющей несколько внутренних сессий и,
	при этом, сама суперсессия не привязана к конкретному кассовому аппарату, тогда это
	поле - пустое.

	\item[@POSNODE]

	Контекст: Кассовый чек, кассовая сессия.

	Наименование кассового узла, которому соответствует кассовый чек или сессия.

	\item[@POS]

	Контекст: Кассовый чек, кассовая сессия.

	Номер кассового аппарата, на котором пробит чек либо снята кассовая сессия.

	\item[@ISRET]

	Контекст: Кассовый чек, документ.

	Признак того, что либо документ отражают операцию возврата от покупателя.
	Если чек (документ) возвратный, то значение переменной равно 1, в противном
	случае - 0.

	\item[@RETURN]

	Контекст: Кассовый чек, документ, кассовая сессия.

	\begin{itemize}
		\item Для чека - сумма чека, если чек возвратный и ноль в противном случае
		\item Для документа - сумма документа, если он возвратный и ноль в противном случае
		\item Для кассовой сессии - сумма чеков возвратов по этой сессии
	\end{itemize}

	\item[@CASHAMOUNT]

	Контекст: Кассовый чек, документ, кассовая сессия.

	\begin{itemize}
		\item Для чека - сумма чека, если чек оплачен наличными деньгами и ноль в противном случае
		\item Для документа - равно сумме документа (тоже, что и @AMOUNT)
		\item Для кассовой сессии - сумма чеков по этой сессии, оплаченных наличными
	\end{itemize}

	\item[@BANKAMOUNT]

	Контекст: Кассовый чек, документ, кассовая сессия.

	\begin{itemize}
		\item Для чека - сумма чека, если чек оплачен безналично и ноль в противном случае
		\item Для документа - 0
		\item Для кассовой сессии - сумма чеков по этой сессии, оплаченных безналично
	\end{itemize}

	\item[@RETCASHAMOUNT]

	Контекст: Кассовый чек, кассовая сессия.

	\begin{itemize}
		\item Для чека - сумма чека, если это - чек возврата, оплаченный наличными и ноль в противном случае.
		\item Для кассовой сессии - сумма чеков возврата по этой сессии, учтенных наличным расчетом.
	\end{itemize}

	\ppyadminline{Переменная введена в релизе 7.5.0.}

	\item[@RETBANKAMOUNT]

	Контекст: Кассовый чек, кассовая сессия.

	\begin{itemize}
		\item Для чека - сумма чека, если это - чек возврата, оплаченный через банк и ноль в противном случае.
		\item Для кассовой сессии - сумма чеков возврата по этой сессии, учтенных расчетом через банк.
	\end{itemize}

	\ppyadminline{Переменная введена в релизе 7.5.0.}

	\item[@CHECKCASHCOUNT]

	Контекст: Кассовый чек, кассовая сессия.

	\begin{itemize}
		\item Для чека - если это - чек продажи, оплаченный наличными, то 1 и ноль в противном случае.
		\item Для кассовой сессии - количество чеков продажи по этой сессии, оплаченных наличными.
	\end{itemize}

	\ppyadminline{Переменная введена в релизе 7.5.0.}

	\item[@CHECKBANKCOUNT]

	Контекст: Кассовый чек, кассовая сессия.

	\begin{itemize}
		\item Для чека - если это - чек продажи, оплаченный через банк, то 1 и ноль в противном случае.
		\item Для кассовой сессии - количество чеков продажи по этой сессии, оплаченных через банк.
	\end{itemize}

	\ppyadminline{Переменная введена в релизе 7.5.0.}

	\item[@RETCASHCOUNT]

	Контекст: Кассовый чек, кассовая сессия.

	\begin{itemize}
		\item Для чека - если это - чек возврата, учтенный наличным расчетом, то 1 и ноль в противном случае.
		\item Для кассовой сессии - количество чеков возврата по этой сессии, учтенных наличным расчетом.
	\end{itemize}

	\ppyadminline{Переменная введена в релизе 7.5.0.}

	\item[@RETBANKCOUNT]

	Контекст: Кассовый чек, кассовая сессия.

	\begin{itemize}
		\item Для чека - если это - чек возврата, учетнный расчетом через банк, то 1 и ноль в противном случае.
		\item Для кассовой сессии - количество чеков возврата по этой сессии, учтенных расчетом через банк.
	\end{itemize}

	\ppyadminline{Переменная введена в релизе 7.5.0.}

	\item[@INITTIME]

	Контекст: Кассовый чек.

	Строка даты/времени создания чека.

	Дата и время создания чека актуальны только для асинхронных кассовых
	чеков.

	\item[@UHTTSCHASH]

	Контекст: Кассовый чек.

	Если чек проведен по бонусной или кредитной карте, синхронизированной с сервисом
	Universe-HTT, то результатом подстановки этой псевдопеременной будет
	код доступа, с помощью которого покупатель может просматривать отчеты об
	операциях с картой на сервере Universe-HTT.

	\ppynote{
		До некоторых пор, это поле заполняется только если чек не
		имеет признака доставки.
	}

	\ppyadminline{Переменная введена в релизе 7.4.10.}

	\item[@ISORDER]

	Контекст: Кассовый чек.

	1 - если чек является заказом на обслуживание за столом и 0 в противном случае.

	\item[@ORDERDATE]

	Контекст: Кассовый чек.

	Дата заказанного начала обслуживания за столом.

	\item[@ORDERTIMESTART]

	Контекст: Кассовый чек.

	Время заказанного начала обслуживания за столом.

	\item[@ORDERTIMEEND]

	Контекст: Кассовый чек.

	Время окончания заказанного обслуживания за столом.

	\item[@ORDERDURATION]

	Контекст: Кассовый чек.

	Заказанная продолжительность обслуживания за столом.

	\item[@LINKORDERNO]

	Контекст: Кассовый чек.

	Номер чека заказа, к которому привязан данный чек.

	\item[@LINKORDERDATE]

	Контекст: Кассовый чек.

	Дата чека заказа, к которому привязан данный чек.

	\item[@DLVRCITY]

	Контекст: Кассовый чек.

	Только для чека с признаком доставки: наименование города, в который
	следует осуществить доставку.

	\item[@DLVRADDR]

	Контекст: Кассовый чек.

	Только для чека с признаком доставки: текст адреса, по которому
	следует осуществить доставку.

	\item[@DLVRPHONE]

	Контекст: Кассовый чек.

	Только для чека с признаком доставки: номер телефона, по которому
	можно связаться с лицом, для которого предназначена доставка.

	\item[@PAYMTYPE]

	Контекст: Кассовый чек. Доступно только в зоне $paymdetail$.

	Текстовое описание типа элемента оплаты по чеку.

	\ppyadminline{Переменная введена в релизе 8.4.1.}

	\item[@PAYMAMT]

	Контекст: Кассовый чек. Доступно только в зоне $paymdetail$.

	Сумма элемента оплаты по чеку.

	\ppyadminline{Переменная введена в релизе 8.4.1.}

	\item[@ISEGAIS]

	Контекст: Кассовый чек.

	Логическая переменная, принимающая значение 1, если чек содержит
	маркированную алкогольную продукцию, по которой надлежит передавать
	данные в систему ЕГАИС.
	Если чек не содержит такой продукции, то псевдопеременная принимает значение 0.

	\item[@EGAISURL]

	Контекст: Кассовый чек.

	Если чек содержит маркированную алкогольную продукцию, по которой надлежит передавать
	данные в систему ЕГАИС и данные были успешно переданы, то эта переменная содержит
	строку url-адреса, по которому можно видеть переданную информацию на сайте ЕГАИС.
	Эта же строка печатается на чеке в виде QR-кода.

	\item[@EGAISSIGN]

	Контекст: Кассовый чек.

	Если чек содержит маркированную алкогольную продукцию, по которой надлежит передавать
	данные в систему ЕГАИС и данные были успешно переданы, то эта переменная содержит
	строку хэш-подписи чека, полученной от сервера УТМ.

	\item[@MANUFSERIAL]

	Контекст: Кассовый чек.

	Заводской номер кассового аппарата, заданный в записи синхронного кассового узла.

\end{description}

\subsection{Стандартный файл описания кассовых отчетов }

Система использует файл описания отчетов с именем stdslip.fmt, находящийся в
каталоге BIN (там же, где находятся исполняемые файлы системы).

По умолчанию применяются следующие наименования форматов:

\paragraph{CCheck} Стандартный фискальный чек.
\paragraph{CCheckCopy} Копия чека.
\paragraph{CCheckRetCopy} Копия чека возврата.
\paragraph{ZReportCopy} Копия Z-отчета.

Имя файла описания отчетов может быть переопределено для конкретного кассового узла
установкой пути к этому файлу в записи кассового узла (см. стр.~\pageref{sec-cashnode-sync}).

\section{Сканеры штрихкодов}

Сканеры штрихкодов предназначены для считывания и ввода в компьютер штриховых кодов.

\subsection{Классификация сканеров штрихкодов}

Ассортимент сканеров штрихкодов, предлагаемых рынком весьма многообразен.
Приведем упрощенную классификацию этих устройств с короткими пояснениями.

\subsubsection{По физическому способу считывания}

\begin{description}
	\item[Лазерные]
	Используют лазерный луч. Дорогие устройства с высоким расстоянием и большой точностью
	считывания.

	\item[Светодиодные]
	Используют светодиод. Доступные по цене устройства. Считывают код только с очень близкого
	расстояния.
\end{description}

\subsubsection{По количеству направлений считывания}

\begin{description}
	\item[Одноплоскостные]
	Один считывающий луч сканирует одно направление. Цена невысокая, но приходится
	ориентировать сканируемый штрихкод перпендикулярно лучу.

	\item[Многоплоскостные]
	Один или несколько лучей благодаря сложной системе зеркал и сервомеханизмов сканируют
	несколько направлений, позволяя считывать штрихкод, находящийся под разными углами и
	на больших расстояниях.
\end{description}

\subsubsection{По способу работы оператора со сканером}

\begin{description}
	\item[Ручные]
	Оператор, считывая код, держит сканер в руке.

	\item[Стационарные]
	Сканер закреплен, и оператор для считывания кода должен пронести товар перед
	сканером.

	\item[Комбинированные]
	Сканер закреплен в держателе и, как правило, используется в стационарном варианте, но
	оператор имеет возможность извлечь его из держателя и использовать в ручном режиме.
\end{description}

\subsubsection{По интерфейсу подключения к компьютеру}

\begin{description}
	\item[Клавиатурные]
	Сканер подключается к клавиатурному разъему компьютера. Такой вариант подключения
	позволяет легко использовать сканер как эмулятор клавиатуры. То есть, считываемые
	сканером знаки воспринимаются компьютером так, как будто они поступают с клавиатуры.

	\ppynote{
		При сканировании штрихкодов, содержащих латинские символы (это допускается такими
		стандартами штрихкодов, как CODE39, CODE59 и некоторыми другими) обратите внимание
		на то, что некоторые модели сканеров возвращает символ, соответствующий скан-коду
		клавиатуры, а не самому символу.

		На практике это означает, что символы, возвращаемые таким сканером фактически
		могут зависеть от текущего значения переключателя языка клавиатуры.

		Так, для русской раскладки клавиатуры и в режиме ввода русских букв сканер
		вместо латинской 'Q' может вернуть русскую 'Й'.
	}

	\item[Последовательные]
	Сканер подключается к последовательному порту компьютера. В этом случае программа,
	использующая сканер, должна быть специально адаптирована для такого варианта подключения.

	Так как система работает со сканером штрихкодов так, как будто просканированные данные
	поступают непосредственно с клавиатуры, то для использования сканера, подключаемого к
	COM-порту компьютера, следует воспользоваться программой эмуляции, например, бесплатной
	программой SoftWedge компании \trademark{Metrologic} (www.metrologic.com).

	\item[USB]
	Сканер подключается через USB-шину. Аналогично случаю с последовательным подключением,
	программа, использующая сканер, должна быть специально адаптирована для этого.
\end{description}

\subsection{Настройка сканера штрихкодов}

Для конфигурирования сканера штрихкодов обычно используется прилагаемая к нему изготовителем
инструкция с набором штрихкодов, считывая которые можно установить те или иные параметры.

Наиболее существенные параметры, с точки зрения использования с системой \ppybrand{} - это те,
которые определяют, передает ли сканер при считывании штрихкода контрольную цифру. Если вы
вводите штрихкоды без контрольной цифры, то проверьте, чтобы сканер не передавал ее для кодов
EAN-8, EAN-13, UPC-A и UPC-E. По умолчанию, большинство сканеров настроено на передачу
контрольной цифры.

Некоторые сканеры не позволяют установить отказ от передачи контрольной цифры в указанных
стандартах штрихкодов.

При вводе штрихкода со сканера непосредственно в систему \ppybrand{} убедитесь, чтобы передачу
кода он завершал символом перевода каретки.

\section{Электронные весы}

Под электронными весами, использование которых описывается в этом разделе, мы подразумеваем
устройства для взвешивания товара, способные одновременно с этим рассчитывать цену взвешенного
товара и печатать этикетку со штрихкодом. Система \ppybrand{} адаптирована для работы со следующими
типами и моделями электронных весов:
\begin{itemize}
	\item	CAS LP-15
	\item	CAS LP-15 (версия протокола 1.6)
	\item   CAS C5000J
	\item	MettlerToledo TIGER
	\item	Масса-К
	\item	DIGI
	\item	Любые устройства, с которыми работает сервер торгового оборудования Кристалл-Сет компании
	Кристалл-Сервис
	\item	Bizerba
	\item	Штрих-Принт
\end{itemize}
При необходимости подключения весов других моделей следует обратиться в службу сопровождения.

\subsection{Конфигурация подключения электронных весов}

Для полноценного функционирования электронных весов необходимо загружать в них информацию об
имеющихся на складе или в магазине товарах. Эта информация включает в себя наименования товаров,
их цены и коды для штрихового кодирования. Для загрузки всей этой информации весы должны быть
подключены к компьютеру или компьютерам, на которых запускается система \ppybrand{}.
Мы будем различать следующие варианты подключения электронных весов к компьютеру.

\paragraph{Прямое подключение к последовательному порту компьютера}
	Для устройства явно указывается номер последовательного порта, к которому оно подключено.
	Загрузка весов возможна только с того компьютера, к которому подключены весы.
	Возможен вариант, когда загрузкой весов можно управлять, подключаясь к компьютеру, к которому
	подключены весы, через терминал удаленного доступа.

\paragraph{Подключение весов к компьютеру через специализированный концентратор}
	В этом случае к одному последовательному порту компьютера подключается специальное
	устройство - концентратор, а несколько взвешивающих устройств уже включаются в этот
	концентратор. В этом случае, в системе для каждого из этих устройств указывается один и
	тот же номер последовательного порта, но разные логические номера.

\paragraph{Подключение весов в цепь один аппарат за другим. При этом только первый аппарат в цепи
	подключается прямо к последовательному порту компьютера}
	Такая схема поддерживается только весами Масса-К.

\paragraph{Подключение через IP-протокол}
	Этот способ используется для тех взвешивающих устройств, которые поддерживают соответствующий
	протокол обмена. В этом случае вместо порта обмена для таких устройств задается IP-адрес.
	Загрузка по IP-протоколу идет значительно быстрее, чем через последовательный порт.

\paragraph{Подключение через программу-посредника}
	Существуют специализированные программы, реализующие интерфейс с широким набором типов
	устройств. При использовании таких программ, \ppybrand{} передает им данные для загрузки
	весов в виде файла, который обрабатывается этой программой, и передается на весы.

\subsection{Настройка системы для работы с электронными весами}

Начинать настройку системы для работы с весами следует с принятия решения о том, какие
товары будут взвешиваться на каждом аппарате. При этом необходимо завести в справочнике
групп товаров альтернативные группы, которые будут содержать товары, предназначенные для
взвешивания на каждом аппарате.

Удобно создать группу-папку, которая будет содержать все альтернативные группы,
используемые для загрузки весов.

\ppypictsc{dlg-scale}{Диалог редактирования записи о весах}{0.5}

Вызвав пункт меню \ppymenu{Справочники\rdir Оборудование\rdir Весы}, вы увидите диалог со списком весов.
Для добавления новых весов нажмите кнопку \dlgbutton{Добавить}. На экране появится диалог для
ввода параметров нового аппарата (рис.~\ref{pic-dlg-scale}).
В таблице перечислены параметры настройки весов и описано их значение

\begin{description}
	\item[\dlgcombo{Группа}]
	Группа устройств, которой принадлежат данные весы.
	Группировка устройств упрощает процедуру загрузки нескольких
	весов за одну операцию.

	\item[\dlgcombo{Тип весов}]
	Комбо-бокс определяющий тип аппарата. Если вы используете какой-либо тип весов с печатью
	этикеток штрихкодов, который не перечислен в списке, то обратитесь к сопровождению за
	информацией о подключении таких весов.

	Специализированный тип \qu{Группа весов} позволяет создать группирующую запись,
	с которой могут быть сопоставлены одна или несколько обычных записей весов.

	\item[Наименование]
	Наименование аппарата, под которым он будет фигурировать в системе. Все весы должны иметь
	различные наименования.

	\item[Ид]
	Закрытое для изменения поле. Это - внутренний идентификатор записи, информация о котором
	может понадобиться для сопровождения системы.

	\item[Порт обмена]
	Наименование порта обмена для связи компьютера с весами. Для устройств, обмен с которыми
	осуществляется через порт RS-232, допустимы значения COM1, COM2  и т.д. до COM31.
	Для устройств, обмен с которыми реализован посредством протокола TCP/IP, здесь указывается
	IP-адрес устройства.

	\item[Логический номер]
	Это поле должно содержать ненулевое значение только в том случае, когда используется
	множественное подключение весов к одному компьютеру (через концентратор или последовательным
	включением аппаратов друг за другом). При этом каждый из аппаратов должен иметь уникальный
	логический номер. Если весы подключены в одиночку и непосредственно к асинхронному или
	IP-порту компьютера, то это поле должно содержать 0.

	\item[Версия протокола обмена]
	Специализированное поле требуется для идентификации системой версии концентратора, через
	который подключаются весы. Для правильной установки этого поля обратитесь к сопровождению.

	\item[\dlgcombo{Склад}]
	Склад, который обслуживается весами. Система будет загружать на весы только те товары,
	которые либо есть на этом складе, либо хоть когда-либо приходили на него.

	\item[\dlgcombo{Группа товаров}]
	В этом комбо-боксе необходимо выбрать альтернативную группу товаров, которые должны
	загружаться на весы. Обычно весы имеют весьма ограниченный размер памяти, поэтому группа
	товаров должна содержать минимальный набор наименований, которые будут взвешиваться на этом
	аппарате.

	\item[\dlgcombo{Котировка}]
	Если в этом поле указан вид котировки, то при загрузке товаров на весы система в первую
	очередь будет пытаться определить цену исходя из этого вида котировки. Если товар не
	содержит подходящей котировки, то используется общее правило расчета розничной цены.

	\item[Дополнительные поля для загрузки]
	В этом поле можно ввести мнемоническую формулу, определяющую формат
	дополнительных строк, загружаемых на весы вместе с товаром.

	Эта формула может состоять из букв A, B, C, D, E, M. Каждая буква
	обозначает одну дополнительную строку и источник ее формирования.

	Смысл букв следующий:
	\begin{description}
		\item[A] Дополнительное поле товара A
		\item[B] Дополнительное поле товара B
		\item[C] Дополнительное поле товара C
		\item[D] Дополнительное поле товара D
		\item[E] Дополнительное поле товара E
		\item[M] Дата и время производства товара, извлеченное из тега
		лота, определившего учетную цену этого товара.
		Тип тега зарезервированный - \ppyrsrv{Дата производства} (ид 14, символ \ppyrsrv{MANUFTIME}).
	\end{description}

	Две и более букв могут быть объединены в группу с помощью круглых скобок.
	В этом случае строки из нескольких источников объединяются в одну и выводятся как
	одна строка дополнительного сообщения.

	\ppyexample{
		(AB)M

		Первой строкой будет сцепка дополнительных полей товара A и B. Второй
		строкой - дата/время производства.
	}

	\item[Длина строки доп текста]
	Максимальная длина одной строки, которая может быть загружена на данные
	весы. Если это поле пустое или содержит ноль, то система применяет
	значение на собственное усмотрение (в зависимости от типа весов).

	\item[\dlgflag{Игнорировать весовой префикс}]
	Флаг, предписывающий функции загрузки весов опускать весовой префикс в начале штрихкода
	загружаемого товара. Эта возможность необходима в том случае, когда в системе штрихкод
	весовых товаров вводится с весовым префиксом (потому что так требует кассовый аппарат),
	а на весы штрихкод должен поступать без весового префикса.

	Например: \qu{Колбаса Русская Вес} имеет штрихкод 2944008. При этом на кассовый аппарат
	этот товар должен поступать с таким же кодом, а на весы с кодом 44008. В этом случае для
	весов устанавливается флаг \dlgflag{Игнорировать весовой префикс}.

	\item[\dlgflag{Загружать то, что на складе}]
	Флаг, предписывающий функции загрузки весов опускать при сбросе на весы те товары,
	остаток которых на складе нулевой. Установка этого флага позволяет избежать переполнения
	памяти весов, однако, если товар в базе данных имеет нулевой остаток, а фактически на
	складе имеется, то взвесить его не удастся.

	\item[\dlgflag{Использовать TCP/IP протокол}]
	Флаг, указывающий, что для выбранных весов используется протокол обмена TCP/IP. Этот
	флаг следует устанавливать для весов \trademark{Mettler Toledo TIGER}.

	\item[\dlgflag{Проверять при загрузке данные на ошибки}]
	Перед отправкой данных на весы каждая запись проверяется на корректность
	по ряду критериев, существенных для правильной загрузки на устройство.

	\item[\dlgflag{Пассивные}]
	Если этот флаг включен, то для таких весов не осуществляется процедура
	загрузки данных.

\end{description}

\subsection{Загрузка данных о товарах в электронные весы}

Перед загрузкой данных на весы необходимо убедиться, что на аппарате не взвешивают
товары.

Для загрузки данных о товарах, подлежащих взвешиванию на весы, необходимо обратиться к
пункту меню \ppymenu{Оборудование\rdir Загрузка весов}. На экране появится диалог с предложением
выбрать весы, которые следует загрузить.  Выберите весы и нажмите кнопку \dlgbutton{ОК}.

Перед загрузкой система подготовит данные. После подготовки данных появится предложение
распечатать список товаров, подлежащих загрузке с тем, чтобы отпечатанный список можно было
бы отдать продавцу, взвешивающему товар на весах. Этот список понадобится продавцу для
определения кодов, идентифицирующих весовые товары при взвешивании.

Наконец, система приступит к загрузке данных на весы.

Если загрузка не получилась, на экране появится сообщение, информирующее о причинах
сбоя.

\subsection{Особенности настройки конкретных типов весов}

\subsubsection{Весы \trademark{CAS}}

Компания \trademark{CAS Electronics} поставляет обширный ассортимент весов. Наиболее
популярны в розничной торговле устройства типа LP-15. С точки зрения системы \ppybrand{}
важно то, что существуют две значительно различающиеся версии протоколов обмена
данными между весами \trademark{CAS Electronics} и компьютерными программами:
\begin{itemize}
	\item Протокол версии 1.6.
	\item Протокол, предшествующий этой версии.
\end{itemize}

Кроме того, устройства этого производителя поставляются как с последовательным
интерфейсом обмена (RS-232), так и с сетевым протоколом TCP.

\ppybrand{} \qu{умеет} работать со следующими конфигурациями таких весов:
\begin{itemize}
	\item Протокол, предшествующий версии 1.6 с интерфейсом RS-232.
	\item Протокол 1.6 с интерфейсом RS-232
	\item Протокол 1.6 с интерфейсом TCP
\end{itemize}

Рассмотрим особенности настройки для каждого из этих вариантов:

\paragraph{Протокол, предшествующий версии 1.6 с интерфейсом RS-232}

Весы подключаются непосредственно к компьютеру, на котором запускается сеанс \ppybrand{}.
Следующие параметры записи весов в базе данных \ppybrand{} имеют существенное значение:
\begin{description}
	\item[Тип весов] CAS Electronics
	\item[Порт обмена] Строка наименования COM-порта с номером. Например, COM2. Допустимыми
	являются номера портов от COM1 до COM31.
	\item[Логический номер] 0
	\item[Версия протокола обмена] 0
	\item[\dlgflag{Использовать TCP/IP протокол}] Включен
	\item[\dlgbutton{Системные параметры}\rdir Задержка между попытками чтения из порта]
	Это значение рекомендуется устанавливать в диапазоне от 10 до 500 миллисекунд.
	Выбор величины может зависеть от особенностей конкретного компьютера.
	Практически применяются значения от 30 до 100.

	Остальные системные параметры игнорируются.
\end{description}

\paragraph{Протокол 1.6 с интерфейсом RS-232}

Весы подключаются непосредственно к компьютеру, на котором запускается сеанс \ppybrand{}.

Само устройство настраивается специальной программой Tibbo DS MANAGER.
Необходимо задать следующие параметры устройства:
\begin{description}
	\item[Закладка] \qu{Serial Settings}

	\begin{description}
		\item[Serial interface] 2 - Automatic
		\item[RTS/CTS flow control] 0 - Disabled or remote
		\item[DTR mode] 0 - Idle or remote
		\item[Baud rate] 9600
		\item[Parity] 0 - None
		\item[Data bits] 1 - 8 bits
		\item[Soft entry into Serial...] 0 - Disabled
		\item[On-the-fly commands] 0 - Disabled
		\item[Notification bitmask] 0
	\end{description}

	\item[Закладка] \qu{Outbound packets}

	\begin{description}
		\item[Max packet length] 255
		\item[Max intercharacter delay] 5
		\item[Start on any char] 1 - Yes
		\item[Use start-character] 0 - No
		\item[Start character (ASCII)] 0
		\item[Use stop-character] 0 - No
		\item[Stop-character (ASCII)] 0
		\item[Number of post-character] 0
	\end{description}
\end{description}

Следующие параметры записи весов в базе данных \ppybrand{} имеют существенное значение:
\begin{description}
	\item[Тип весов] CAS Electronics
	\item[Порт обмена] Строка наименования COM-порта с номером. Например, COM2. Допустимыми
	являются номера портов от COM1 до COM31.
	\item[Логический номер] не нулевое значение, соответствующее логическому номеру
	устройства, определяемое настройками на нем самом.
	\item[Версия протокола обмена] 16
	\item[\dlgflag{Использовать TCP/IP протокол}] Выключен
	\item[\dlgbutton{Системные параметры}\rdir Задержка между попытками чтения из порта]
	Это значение рекомендуется устанавливать в диапазоне от 10 до 500 миллисекунд.
	Выбор величины может зависеть от особенностей конкретного компьютера.
	Практически применяются значения от 30 до 100.

	Остальные системные параметры игнорируются.
\end{description}

\paragraph{Протокол 1.6 с интерфейсом TCP}

Весы подключаются в ту же компьютерную сеть, в которую входит компьютер, на котором
запускается сеанс \ppybrand{}.

Само устройство настраивается специальной программой Tibbo DS MANAGER.
Необходимо задать следующие параметры устройства:
\begin{description}
	\item[Закладка] \qu{Network Settings}

	\begin{description}
		\item[Owner name] пусто
		\item[Device name] пусто
		\item[Mac-address] не изменять
		\item[DHCP] 0 - Disabled
		\item[Ip-address] Доступный в сети IP-адрес. В \ppybrand{} вы должны будете указать
		для соответствующей этому устройству записи это же значение адреса.
		\item[Port] 1001
		\item[Transport protocol] 1 - TCP
		\item[Inband commands] 0 - Disabled
		\item[Data login] 0 - Disabled
		\item[Connection timeout (min)] 5
		\item[Routing Mode] 0 - Server (Slave)
		\item[Notification destination] 0 - Last port
	\end{description}

	\item[Закладка] \qu{Outbound packets}

	\begin{description}
		\item[Max packet length] 255
		\item[Max intercharacter delay] 5
		\item[Start on any char] 1 - Yes
		\item[Use start-character] 0 - No
		\item[Start character (ASCII)] 0
		\item[Use stop-character] 0 - No
		\item[Stop-character (ASCII)] 0
		\item[Number of post-character] 0
	\end{description}
\end{description}

Следующие параметры записи весов в базе данных \ppybrand{} имеют существенное значение:
\begin{description}
	\item[Тип весов] CAS Electronics
	\item[Порт обмена] IP-адрес, заданный для весов (см. выше).
	\item[Логический номер] не нулевое значение, соответствующее логическому номеру
	устройства, определяемое настройками на нем самом.
	\item[Версия протокола обмена] 16
	\item[\dlgflag{Использовать TCP/IP протокол}] Включен
	\item[\dlgbutton{Системные параметры}\rdir Задержка между попытками чтения из порта] 10000
	\item[\dlgbutton{Системные параметры}\rdir Задержка между попытками записи в порт] 1000

	Остальные системные параметры игнорируются. Установите их в значение 0.
\end{description}

\paragraph{Специализированные концентраторы}
При использовании специализированных концентраторов, разрабатываемых сторонними
фирмами, необходимо проконсультироваться с компанией, осуществляющей внедрение на
вашем предприятии.

\paragraph{Дополнительные особенности}
Для более устойчивого обмена по протоколу RS-232 рекомендуется в файле pp.ini
установить параметр

[system]

ComPortReadCycling=10,10

Подробно этот параметр описан в файле pp\_ini.txt распространяемом с дистрибутивом
системы.

\subsubsection{Весы \trademark{DIGI} (через программу Sis2002)}

Весы \trademark{DIGI} поддерживают интерфейс обмена данными через протокол TCP/IP. Порядок настройки
следующий:
\begin{enumerate}
	\item 	Выбрать компьютер, на котором будет работать программа SiS2002
	\item 	Установить программу на этом компьютере. Подробности установки смотрите в
	документации к этой программе. Мы рекомендуем осуществить установку  SiS2002 в каталоге
	PPY, в котором установлена система \ppybrand{} в подкаталог DIGI/SIS2002.
	\item 	В каталоге, в который установлен SiS2002, создайте каталоги DATA и INOUTDIR,
	ссылку на которые укажите в настройках базы данных программы SiS2002.
	\item 	В параметрах настройки базы данных программы SiS2002 укажите следующие опции:
	\begin{itemize}
		\item  Каталог основной базы данных: путь к каталогу DATA, определенном в предыдущем
		пункте
		\item  Каталог обмена данными: путь к каталогу INOUTDIR, определенном в предыдущем
		пункте
		\item  Маска импорта: *.dat
		\item  Проверка данных импорта: да
		\item  Перезаписывать названия артикулов: да
		\item  Режим Устройство<\rdir Группа: выключен
		\item  Формат импорта: простой
		\item  Поле \qu{Артикул} файла импорта: Номер PLU
		\item  Кодировка файла импорта: Кодировка Windows
	\end{itemize}
	\item 	Для каждого весового устройства в \ppybrand{}'е укажите свой уникальный логический
	номер (лучше всего, совпадающий с последним байтом IP-адреса весов), а также путь (кнопка
	\dlgbutton{Системные параметры}) к каталогу INOUTDIR (например, H:/PPY/DIGI/SIS2002/INOUTDIR).
	\item 	Сделайте первую загрузку каждого из устройств. После того, как SiS2002 заберет
	выгруженные из \ppybrand{}'а данные, и вы увидите их в окне SiS2002, сделайте привязку каждой
	из групп к своему устройству.
 \end{enumerate}

\subsubsection{Весы \trademark{Mettler Toledo Tiger}}

Система взаимодействует с этими весами через сетевой протокол TCP/IP. Существует два режима
работы с этими устройствами:
	\begin{enumerate}
		\item 	Непосредственная передача данных из системы в весы по сетевому протоколу TCP/IP.
		\item 	Используя специализированный драйвер весов.
	\end{enumerate}
Первый метод является предпочтительным. Для его использования в записи весов следует установить
версию протокола 0, а в системных параметрах количество попыток чтения и записи - 0, задержка
между попытками чтения и задержка между попытками записи должны быть равны 1000.
Если используются весы с духстрочной печатью, то версию протокола следует установить равной 2.

Для использования 2-го метода необходимо установить драйвер и в записи весов указать версию
протокола обмена равной 101 (для устройств с однострочной печатью) или 102 (для устройств с
двухстрочной печатью).

\subsubsection{Весы \trademark{Штрих-Принт}}

Система взаимодействует с этим типом устройств посредством драйвера, поставляемого
с устройством.

Интерфейс поддерживает только загрузку данных на весы, но не поддерживает чтение
данных с весов.

Строки дополнительной информации о товарах загружаются, начиная с версии \ppybrand{} 7.4.1.
Так же, начиная с этой версии, на весы передается информация о штучных товарах.

\section{Принтеры штрихкодов\label{sec-bcprinter}}

Принтеры штрихкодов являются специализированными устройствами, предназначенными для печати
товарных этикеток, содержащих, как правило, штрихкод товара и небольшой текст, описывающий
наименование, цену и свойства товара.

Система \ppybrand{} поддерживает работу с принтерами штрихкодов, производимых компаниями \trademark{Zebra}
и \trademark{Datamax Corp}, а так же принтерами любых производителей, чьи устройства распознают языки
вывода ZPL (\trademark{Zebra}) и Datamax. Следует обратить внимание на то, что принтеры \trademark{Zebra}
работают как с оригинальным ZPL, так и со скриптом описания этикеток, унаследованными этой компанией от
приобритенной ее компании Eltron: \ppybrand{} поддерживает оба формата.

Начиная с версии 9.6.6 система \ppybrand{} поддерживает печать этикеток на любом принтере, для которого есть
Windows-драйвер.

\subsection{Диалог редактирования принтера штрихкодов}

\ppypict{dlg-bclprn}{Принтер этикеток}

Для просмотра и редактирования списка принтеров штрихкодов выберите пункт меню
\ppymenu{Справочники\rdir Оборудование\rdir Принтеры штрихкодов}.

Диалог редактирования записи принтера штрихкодов изображен на рис.~\ref{pic-dlg-bclprn}.
Определим управляющие элементы этого диалога.

\begin{description}
	\item[Наименование] Наименование принтера. Строка длиной не более 47 символов.
	\item[Тип принтера] Тип принтера. Возможны следующие варианты:
		\begin{description}
			\item[ZEBRA] Принтер производителя \trademark{Zebra} либо иной, поддерживающий язык вывода ZPL.
			\item[DATAMAX] Принтер производителя \trademark{Datamax} либо иной, поддерживающий язык вывода EPL.
			\item[ELTRON] Принтер производителя \trademark{Zebra} либо иной, поддерживающий язык вывода CPCL.
			\item[WINDOWS] Любой принтер, для которого есть драйвер \trademark{Windows}. Обращаем внимание
			на то, что при печати на такой тип принтера язык описания форматов этикеток не применяется.
			Вместо этого используется специализированные отчет BarcodeLabelList со структурой данных DL600
			BarcodeLabelList.
		\end{description}
	\item[Порт вывода] Наименование порта вывода, для отправки этикеток на печать.
	Это могут быть как зарезервированные обозначения последовательных или параллельных портов COM1, COM2, COM3,
	LPT, LPT1, LPT2, LPT3 так и символьное наименование принтера, по которому ваша операционная система
	идентифицирует направление отправки этикеток.

	Кроме того, в целях отладки, в качестве порта вывода можно указать какое-нибудь имя файла. Тогда \ppybrand{}
	отправит этикетку в этот файл (только для анализа вывода по заданному формату этикетки - практическая польза
	этого файла отсутствует).

	\item[Форма] Наименование формы вывода, определенной в файле описания этикеток, подробное описание которого
	приведено ниже.
	\item[\dlgflag{OEM-кодировка}] Флаг актуален только для принтеров типа \ppyrsrv{ZEBRA}. Если установлен, то
	данные на принтер будут подаваться в OEM-кодировке.
	\item[Толщины полос штрихкодов (в точках)]

		Два параметра актуальные на текущий момент только для принтеров типа \ppyrsrv{ELTRON}. Они
		определяют факторы печати штрихкодов на принтере. С их помощью можно варьировать общий
		размер выводимого штрихкода а так же обеспечить более уверенное считывание штрихкода сканером.

		\begin{description}
			\item[Толщина узких полос]
			\item[Толщина широких полос]
		\end{description}

	\item[Параметры COM-порта]

		Набор параметров, актуальных только при прямом выводе этикетки на принтер через COM-порт.
		Учитывая то, что COM-порты встречаются все реже, внимание этим параметрам можно не уделять.

		\begin{description}
			\item[\dlgradioc{Скорость COM-порта}]
			\item[\dlgradioc{Контроль четности}]
			\item[\dlgradioc{Биты данных}]
		\end{description}
\end{description}

\subsection{Формат описания этикеток}

Для того чтобы можно было печатать этикетки со штрихкодами товаров на принтере штрихкодов
из программы \ppybrand{} необходимо подготовить файл описания форматов этикеток и настроить
параметры принтера или принтеров (если у вас их более одного).

Для печати этикеток на принтере штрихкодов необходимо создать файл описания этикеток.
Этот файл должен находиться в каталоге бинарных файлов (обычно PPY/BIN). Название файла
по умолчанию должно быть BARLABEL.LBL. Если вы хотите использовать другое имя файла, то
его необходимо прописать в файле pp.ini в разделе [config] параметром label\_file.
Формально синтаксис файла описания этикеток следующий.

\begin{Verbatim}[fontfamily=courier, fontsize=\small, frame=single]
label_definition_file = label_definitions
label_definitions = label_definition | label_definitions
label_definition = LABEL label_name { label_param_list . label_format }
label_name - наименование формата этикетки. В файле может быть несколько описаний этикеток,
каждое из которых должно иметь уникальное наименование.
label_param_list = label_param | label_param_list
label_param = SIZE x_size y_size | GAP gap_size | HOME  x_pos y_pos | CODEPAGE
codepage_symbol
x_size, y_size -  размеры этикетки по ширине и высоте соответственно.
gap_size - высота зазора между этикетками на ленте
x_pos, y_pos - начальная позиция области печати по оси x и y соответственно.
codepage_symbol - таблица кодировки символов текста
label_format = label_format_statement | label_format
label_format_statement = text_statement | barcode_statement
text_statement = TEXT [: maxlen] rotation x_pos y_pos font_name x_multiplier y_multiplier
"text"
wrap_statement = WRAP [:maxlen] rotation x_pos y_pos font_name x_multiplier y_multiplier
font_name = font_name[,font_width,font_height]
Здесь font_width и font_height - соответственно, ширина и высота масштабируемого шрифта.
barcode_statement = BARCODE rotation x_pos y_pos height x_multiplier y_multiplier
serialcode_statement =SERIALCODE rotation x_pos y_pos height x_multiplier y_multiplier
\end{Verbatim}

$LABEL$, $SIZE$, $GAP$, $HOME$, $TEXT$, $WRAP$, $BARCODE$, $SERIALCODE$, $SERXNOM$
являются зарезервированными словами. Их можно вводить в любом регистре (либо строчными либо
прописными латинскими буквами).

$rotation$ - угол поворота текста или штрихкода относительно горизонтальной оси этикетки в
градусах по часовой стрелке. Большинство принтеров поддерживает только четыре угла поворота:
0, 90, 180 и 270 градусов. Если вы укажете иное значение, то реальный угол поворота будет тот,
что позволяет принтер и который наиболее близок к значению, указанному вами.

$x\_pos$, $y\_pos$ - координаты верхнего левого угла области печати текста или штрихкода.

$font\_name$ - наименование шрифта, которым следует печатать текст. Этот параметр зависит от
принтера и набора шрифтов, загруженных в принтер.

$height$ - высота штрихкода.

$x\_multiplier$, $y\_multiplier$ - целочисленные коэффициенты масштабирования текста или штрихкода
по осям x и y соответственно. Допустимый диапазон 1..9. Используются в принтерах \trademark{Datamax Corp}.
\ppynote{
	Внимание: для серийного номера (CODE39) эти два параметра должны быть установлены в 0.
}

$text$ - текст, который необходимо вывести в этикетке. Текст может содержать псевдопеременные
	для подстановки реальных параметров. Следующая таблица перечисляет и поясняет значения этих
	псевдопеременных.

\subsubsection{Псевдопеременные}

	\paragraph{@date} Текущая дата.

	\paragraph{@time} Текущее время.

	\paragraph{@mainorg} Наименование главной организации

	\paragraph{@warehouse} Наименование склада, с которым ассоциирован факт печати
	этикетки (определен не во всех случаях).

	\paragraph{@user} Имя пользователя, который печатает этикетку.
	Если пользователь ассоциирован с персоналией, то @user - имя персоналии,
	в противном случае - это то символическое имя, которое пользователь
	вводит при входе в систему.

	\paragraph{@gname} Наименование товара.

	\paragraph{@goodsgrpname} Наименование группы товара (непосредственный
	родитель товара, для которого печатается этикетка).

	\paragraph{@goodscode} Текстовое представление кода товара.

	\paragraph{@price} Цена товара. Данная цена формируется по правилам
	определения розничной цены товара в текущем контексте (склад, дата, и пр.).

	\paragraph{@quot:symb} Значение котировки вида с символом sybm для товара по складу,
	соответствующему текущему контексту. Дата привязки значения применяется текущая системная.

	Символ вида котировки извлекается из описания этикетки до достижения одного из следующих
	терминальных событий: знак пробел, знак табуляция, конец строки, длина более 19 знаков,
	идентифицирован вид котировки по считанной строке.

	Таким образом, если в базе данных есть виды котировок, имеющие одинаковый префикс,
	то возникает риск неверного определения символа. Допустим, вы хотите получить в этикетке
	значение котировки вида с символом \qu{Quot012}, а в базе данных есть виды котировок
	\qu{Quot012} и \qu{Quot01}. Если вы введете в описание этикетки псевдопеременную
	\qu{@quot:Quot011}, то результатом будет что-то вроде \qu{25.002} (в предположении, что
	значение котировки вида \qu{Quot01} равно 25).

	\paragraph{@linecost} Цена поступления товара, извлеченная непосредственно из
	  контекста печати. В случае печати этикетки по строке документа, это - цена
	  поступления, заданная в этой строке. При печати этикетки по лоту - цена поступления лота.

	\paragraph{@lineprice} Цена реализации товара, извлеченная непосредственно из
		контекста печати.

	\paragraph{@revalprice} Цена товара до переоценки. Значение этой псевдопеременной
	может отличаться от $@price$ только в том случае, если этикетка печатается из строк документа
	переоценки.

	\paragraph{@manuf} Наименование производителя товара.

	\paragraph{@country} Наименование страны производителя товара.

	\paragraph{@brand} Наименование торговой марки товара.

	\paragraph{@gcdimx} Значение размерности X классифицированного товара.

	\paragraph{@gcdimy} Значение размерности Y классифицированного товара.

	\paragraph{@gcdimz} Значение размерности Z классифицированного товара.

	\paragraph{@gcdimw} Значение размерности W классифицированного товара.

	\paragraph{@gckind} Строка наименования классификатора KIND классифицированного товара.

	\paragraph{@gcgrade} Строка наименования классификатора GRADE классифицированного товара.

	\paragraph{@gcaddprop} Строка наименования классификатора ADDPROP классифицированного товара.

	\paragraph{@gcaddprop2} Строка наименования классификатора ADDPROP2 классифицированного товара.

	\paragraph{@expiry} Срок годность товара.

	\paragraph{@manufdate} Дата/время изготовления товара. Значение для подстановки этой
	псевдопеременной берется из зарезервированного тега \ppyrsrv{Дата производства} лота,
	из которого извлечена учетная цена товара.

	Следующие псевдопеременные применимы только для печати этикеток по лотам:

	\paragraph{@serialcode} Серийный номер лота.

	\paragraph{@billdate} Дата документа прихода лота. Если этикетка
	печатается по технологической сессии, то вместо этой псевдопеременной
	подставляется дата, которой введена строка.

	\paragraph{@billno} Номер документа прихода лота. Если этикетка
	печатается по строке технологической сессии, то вместо этой переменной
	подставляется номер технологической сессии.

	\paragraph{@qtty} Оприходованное количество в лоте.

	\paragraph{@phqtty} Оприходованное количество в лоте в физических единицах.

	\paragraph{@pack} Емкость упаковки.

	\paragraph{@brutto} Масса брутто оприходованного количества.

	\paragraph{@objname} Статья технологической сессии, к которой относится строка,
	по которой печатается этикетка.

	\paragraph{@obj2name} Дополнительная статья технологической сессии, к которой
	относится строка, по которой печатается этикетка.

	\paragraph{@prcname} Наименование процессора, к которому
	относится технологическая сессия, по строке которой печатается этикетка.

	\paragraph{@ext\_a} Дополнительное поле товара A (Условия хранения и
	срок годности).

	\paragraph{@ext\_b} Дополнительное поле товара B (Стандарт).

	\paragraph{@ext\_c} Дополнительное поле товара C (Состав).

	\paragraph{@ext\_d} Дополнительное поле товара D (Энергетическая ценность).

	\paragraph{@ext\_e} Дополнительное поле товара E (Способ использования или приготовления).

\ppyexampletitle{Приведем пример описания этикетки}{
\newline LABEL label\_one \{
\newline .
\newline TEXT  0 20 80 115 1 2 \qu{@gname}
\newline TEXT  0 20 70 101 1 1 \qu{Цена:}
\newline TEXT  0 40 68 115 1 2 \qu{@price}
\newline TEXT  0 20 60 101 1 1 \qu{Дата маркировки: @date}
\newline TEXT  0 20 50 101 1 1 \qu{Маркировщик: @user}
\newline BARCODE 0 20  0  20 2 2
\}
}

\paragraph{Перенос текста}

Если вся строка целиком не вмещается на этикетке, то, начиная с версии 5.1.12, появилась
возможность задавать в формате этикетки печать текста в несколько строк. Для этого
используется ключевое слово WRAP и опция максимальной длины строки, задаваемая после
ключевых слов TEXT и WRAP. Принцип переноса проще всего показать на примере.
Допустим, мы определяем строку вывода наименования товара:

\ppyexample{
	TEXT 0 20 80 115 1 2 \qu{@gname}
}

Так как этикетка маленькая, то в длину умещается только 30 символов (приблизительно). Для
того чтобы система разбила наименование товара на две части, перепишем указанный пример в
следующем виде:

\ppyexample{
	\newline TEXT:30 0 20 80 115 1 2 \qu{@gname}
	\newline WRAP    0 20 70 115 1 2
}
Теперь на этикетке будет печататься в первой строке наименования не более 30 символов, а на
следующей строке (обратите внимание на координату y - она, естественно, задается вручную как
для первой, так и для второй строки) оставшиеся символы (сколько поместится на этикетке).
Ключевое слово $WRAP$ можно использовать только вслед за строкой, содержащей ключевое слов $TEXT$
или $WRAP$. При этом, первый оператор $TEXT$, определяющий печатаемую строку обязательно должен
содержать максимальную длину строки. То есть, следующие примеры приведут к ошибке разбора
формата этикетки:
\ppyexample{
	TEXT     0 20 80 115 1 2 \qu{@gname}
	\newline WRAP    0 20 70 115 1 2 // Для предыдущего оператора TEXT не указана максимальная
длина строки - непонятно
\newline									 // как переносить текст
\newline BARCODE 0 20  0  20 2 2
\newline WRAP    0 20 70 115 1 2 // Предыдущий оператор не TEXT - непонятно что переносить.
}

\subsection{Шрифты}

Некоторые принтеры штрихкодов содержат ограниченный набор встроенных шрифтов. Кроме того,
могут возникнуть проблемы с национальными (русскоязычными) шрифтами. Система \ppybrand{} не
предоставляет ни шрифтов, ни встроенных средств загрузки шрифтов. В случае появления описанных
проблем следует обратиться к поставщику принтера или службе сопровождения системы для выяснения
способов устранения возникших трудностей.

\subsection{Настройка параметров принтеров штрихкодов}

Для настройки параметров принтеров этикеток выберите пункт меню \ppymenu{Справочники\rdir
Оборудование\rdir Принтеры штрихкодов}. Для добавления нового принтера в появившемся на экране
списке нажмите кнопку \dlgbutton{Добавить} или клавишу \keyb{Insert}. Диалог ввода и редактирования
параметров принтера штрихкодов выглядит так, как показано на рисунке.
В поле наименование необходимо ввести наименование принтера. Здесь под наименованием
подразумевается не марка принтера, а наименование того физического устройство, для которого
заводится данная запись. Если у вас более одного принтера, то таких записей должно быть ровно
столько, сколько у вас принтеров штрихкодов.

В комбо-боксе \qu{Тип принтера} необходимо выбрать тип, к которому относится ваш принтер. Тип
принтера подразумевает не обязательно производителя устройства, а набор команд, используемый
для формирования этикеток. Если ваше устройство не поддерживает ни один из перечисленных
типов, то вам следует обратиться к сопровождению для получения более подробной информации по
решению этой проблемы.

Поле \qu{Порт вывода} задает порт, к которому присоединен ваш принтер. Это может быть COM1,
COM2, LPT1, LPT2, и т.д. Портом вывода может быть и имя файла. В этом случае формат этикетки
будет выводиться в файл с таким именем. Это бывает удобно для отладки форматов этикеток.
Поле \qu{Форма} содержит наименование формы этикетки, используемой для вывода на принтер.

\subsection{Печать этикеток}

\ppypict{dlg-bclprn-run}{Принтер этикеток}

Напечатать этикетки из программы можно, находясь либо в таблице просмотра товаров, либо из
диалога редактирования товара.
Находясь в таблице просмотра товаров, выберите товар, для которого хотите напечатать этикетку,
затем нажмите \keyb{Ctrl-L}. После этого на экране появится диалог, предлагающий выбрать принтер,
на который следует вывести этикетку, а также порт вывода и количество экземпляров этикеток,
которое необходимо отпечатать.
В диалоге товара следует также нажать \keyb{F7} и далее процедура та же, что и для таблицы.
Этикетки, содержащие параметры лота (серийный номер, количество и т.д.) могут быть
отпечатаны из таблицы просмотра лотов (\ppymenu{Отчетность\rdir Лоты}).

\section{Терминалы сбора данных}

Система \ppybrand{} поддерживает работу с терминалами сбора данных
\trademark{Denso} BHT (BHT-терминал). Для этого предназначен модуль StyloBHT
(поставляется отдельно), загружаемый на терминал.

Система позволяет использовать BHT-терминал для ускорения приемки товаров и для
инвентаризации. В обоих случаях процесс использования BHT-терминал состоит из трех этапов:
BHT-терминал - это  электронное устройство для сбора,  хранения, и передачи данных. Он
состоит из двух частей - блока приема и хранения  данных, то есть, собственно, терминала,
и блока передачи данных.

Терминал представляет собой мини компьютер, снабженный сканером штрихкодов, экраном и
клавиатурой.

Устройство можно использовать при приемке товара, в ходе проведения инвентаризации, в тех
случаях, когда требуется быстро собрать некоторую информацию о товарах и передать ее для
анализа в систему.

\subsubsection{Начало и завершение работы.}

Для того чтобы включить терминал нажмите красную кнопку. Как только на экране терминала
появится текст, устройство готово к работе. Чтобы отключить его, нажмите на кнопку еще
раз и подержите в нажатом состоянии несколько секунд.

\subsubsection{Как работать с терминалом}

Схема работы терминала очень проста. Сначала он получает данные об известных системе
товарах и поставщиках из основного компьютера. Затем используется в работе, сканирует
штрихкоды, а затем передает полученные данные для обработки обратно в систему.
Терминал работает под управлением программы StyloBHT
Основное меню терминала состоит из следующих разделов
\begin{itemize}
	\item НАКЛАДНЫЕ
	\item ИНВЕНТАРИЗАЦИЯ
	\item ОБМЕН ДАННЫМИ
	\item ЗАГРУЗКА ПРОГРАММЫ
\end{itemize}
Для того чтобы выбрать раздел меню установите на него курсор и нажмите клавишу \keyb{ENT}.
Для того чтобы вернуться в предыдущий раздел нажмите \keyb{C}. Перемещаться по строкам меню,
можно нажимая клавишу, с соответствующим разделу номером или при помощи клавиш со стрелками.
В разделах, где  осуществляется ввод  данных, используются следующие правила
\begin{itemize}
	\item 	Для ввода цифровой информации (номеров  накладных, количества)  используйте
	цифровую клавиатуру.
	\item 	Ввод даты осуществляйте строго по шаблону $XX.XX.XX$
	\item 	Чтобы считать штрихкод нажмите кнопку расположенную сбоку на рукоятке
	терминала. При этом сканер терминала вспыхнет красным светом. Это означает, что терминал
	готов к считыванию штрихкода.  Проведите сканером по полоскам штрихкода. Как только
	код считается, терминал издаст короткий звуковой сигнал и красный свет погаснет.
	\item 	Переход вперед по строкам ввода осуществляется при нажатии клавиши \keyb{ENT},
	назад - клавиши \keyb{С}.
Рассмотрим поэтапно всю схему работы с терминалом.
\end{itemize}
\paragraph{Как загрузить в терминал справочники товаров и поставщиков?}

Включите терминал и положите его на устройство передачи данных.
Выберите в системе  \ppybrand{} раздел \ppymenu{Оборудование\rdir Загрузка BHТ-Терминала}. В диалоге
\qu{Загрузка данных в BHТ-Терминал} укажите опцию \dlgflag{Полная загрузка} и поставьте флажок
в строке обновить исходные данные. Нажмите \dlgbutton{ОК}. Затем аккуратно исполните инструкции
системы.
\begin{itemize}
	\item На  ТСБ выберите меню \ppymenu{ОБМЕН ДАННЫМИ\rdir ПОСТАВЩИКИ}
	\item На  ТСБ выберите меню \ppymenu{ОБМЕН ДАННЫМИ\rdir ТОВАРЫ}
\end{itemize}
После того как весь справочник товаров будет загружен  нажмите на терминале кнопку \keyb{С} и
вы вернетесь в главное меню системы

\subsection{Как выгрузить из терминала результаты работы}

Включите терминал и положите его на устройство передачи данных.
Выберите раздел \ppymenu{Оборудование\rdir Выгрузка с ТСБ}. И в окне \qu{Загрузка с
BHT-терминала} нажмите \dlgbutton{ОК}.
По окончании выгрузки на терминале нажмите \keyb{С}.

\subsection{Как с помощью терминала осуществлять приемку товаров}

Включите терминал и выберите раздел меню \ppymenu{НАКЛАДНЫЕ\rdir ВВОД}
Введите номер накладной, дату и номер поставщика (см. Распечатку поставщиков)
Как только вы это введете, на терминале появится строка КОД. Возьмите товар и
просканируйте его. Если терминал знает такой код, на экране отразится ОК, если товар
новый на экране будет NF.  Неизвестные системе товары следует отложить в корзинку (по
одному наименованию) и по завершению приемки отнести  операторам, которые вручную занесут
эти товары в компьютер.

\subsection{Как вводить ревизию}

Включите терминал и выберите раздел меню \ppymenu{ИНВЕНТАРИЗАЦИЯ\rdir ВВОД}.
Введите номер инвентаризации и дату.

\ppynote{
	Важно!

	Если вы используете в инвентаризации несколько терминалов, введите на них одинаковый
	номер и дату. Это следует сделать с той целью, чтобы при передаче данных в компьютер,
	документы с разных терминалов правильно объединились в один документ инвентаризации.
}

Просканируйте штрихкод товара, введите его количество.
В конце работы нажмите \keyb{ENT} еще раз и закройте документ.

\subsubsection{Что делать если терминал завис?}

Часто, после неправильного  нажатия клавиш, на терминале появляется сообщение об ошибке.
Обычно, чтобы вернуться к знакомым разделам меню достаточно несколько раз нажать на клавишу
\keyb{С} или \keyb{ENT}. Но иногда, пользователи,  умудряются основательно заблокировать
систему, так что привычных нажатий клавиш не достаточно для того чтобы привести терминал в рабочее
состояние. Чтобы оживить терминал проделайте следующее:
\begin{itemize}
	\item Выключите терминал
	\item Нажмите клавишу \keyb{1}, затем, не отпуская ее нажмите вторую клавишу
	\keyb{SF} (клавиша голубого цвета), и придерживая их обе нажатыми,
	нажмите оранжевую клавишу.
	\item Если клавиши нажимались правильно, на экране терминала появится следующий текст
\end{itemize}

\section{Терминал сбора с модулем StyloBHTII}

\subsection{Предварительная настройка ТСД и модуля StyloBHTII}

\subsubsection{Установка имени терминала}

Имя терминала устанавливается на самом устройстве следующим образом:
\begin{itemize}
	\item \dlgbutton{Пуск}.
	\item \ppymenu{Settings\rdir Control Panel}.
	\item В панели управления выбрать ярлык System.
	\item В диалоге \qu{System Properties} выбрать закладку \qu{Device Name}.
	\item В поле \qu{Device name} указать имя устройства. Например, BHT-DEV01.
	\item Нажать \dlgbutton{OK}.
\end{itemize}

\subsubsection{Создание записи терминала в \ppybrand{}}

\begin{itemize}
	\item Выберите меню \ppymenu{Справочники\rdir Оборудование\rdir BHT-терминал}.
	\item Нажмите \dlgbutton{Добавить}
	\item В появившемся диалоге:
		\begin{itemize}
			\item Введите наименование записи (это наименование не обязательно
			должно соответствовать имени устройства, но во избежании путаницы, лучше
			сделать его таким же).
			\item Выберите тип терминала \dlgradioi{StyloBHTII}.
			\item Укажите путь импорта/экспорта данных. Его можно узнать установив
			соединение вашего компьютера с терминалом и посмотрев свойства этого соединения.

			Например: C:/Documents and Settings/ivan-ws/Мои документы/bht-dev01 My Documents
		\end{itemize}
\end{itemize}

\subsection{Установка модуля на ТСД}

\begin{itemize}
	\item Подключите терминал к компьютеру и установите связь между компьютером и ТСД.
	\item Откройте в окне проводника Windows папку, в которой содержится дистрибутив
	программы StyloBHTII.

	Файл дистрибутива обычно имеет наименование, состоящие из
	префикса SBII и номера версии, непосредственно, следующим за этим префиксом.
	Расширение файла - EXE. Например: SBII101.EXE.
\end{itemize}

%topic(DLG_EQUIPCFG)

\section{Конфигурация оборудования\label{sec-cfg-trequip}}

\ppypictsc{dlg-cfg-equip}{Конфигурация оборудования}{0.55}

Для настройки общих условий работы торгового оборудования используется блок настроечных
параметров, именуемый конфигурацией оборудования. Обратиться к параметрам этой конфигурации
можно через пункт меню \ppymenu{Админ\rdir Прочие конфигурации\rdir Конфигурация оборудования}.

Возможность просмотра и редактирования этой конфигурации для конкретного
пользователя определяется наличием элемента \qu{Конфигурация оборудования}
в списке доступных конфигураций.

Вид диалога конфигурации показан на рис.~\ref{pic-dlg-cfg-equip}.
Далее перечисляются элементы этого диалога и описывается его управляющие элементы.

\begin{description}
	\item[\dlgcombo{Бухгалтерская операция списания сессии}]
	Вид операции, применяемый для формирования бухгалтерского документа, содержащего
	суммы, связанные со списанной кассовой сессией.

	Подробности см. на стр.~\pageref{csess-wroff}.

	\item[\dlgcombo{Вид персоналии - кассиры}]
	В этом комбо-боксе можно указать группу пользователей, используемую для загрузки информации
	о кассирах на кассовые узлы, для которых такая возможность поддерживается. В настоящее
	время \ppybrand{} обеспечивает такую возможность для кассовых модулей Кристалл-Сет и Кристалл-УКМ.
	Для правильной загрузки информации о кассирах на кассовые узлы используются следующие правила
	указания наименований пользователей, относящихся к этой группе:

	\begin{itemize}
 		\item	Если вместе с наименованием кассира необходимо загрузить пароль, то этот пароль должен
		быть указан в том же поле после собственно наименования кассира через двоеточие.
		Например: Соколова:абв
		Такой подход используется из-за того, что бы не нарушить секретность паролей, хранимых
		в базе данных \ppybrand{}.
		\item	Если необходимо удалить из кассового модуля какого-либо кассира, то перед его
		наименованием следует поставить знак '-'. Например для удаления кассира Соколовой ее
		имя должно быть следующем: -Соколова:абв.
	\end{itemize}
	\ppynote{
		Настоятельно рекомендуется не применять пользователей из группы кассиров в
		качестве реальных пользователей \ppybrand{}. Для этого всей группе следует максимально урезать
		права доступа к данным внутри базы данных \ppybrand{}.
	}

	\item[\dlgcombo{Кассовый узел по умолчанию}]
	Если значение в этом комбо-боксе не пустое, то в фильтрах по кассовым чекам,  по кассовым
	сессиям и по дефициту по кассовым сессиям будет подставляться этот кассовый узел. Такая
	опция полезна в тех случаях, когда в справочнике имеется более одного кассового узла, но
	пользователи, как правило, используют только один из них.

	\item[\dlgcombo{Прием данных с весов}]
	Система позволяет обрабатывать в товарных документах данные, передаваемые некоторыми
	типами электронных весов. Для правильной работы этой функции в этом комбо-боксе необходимо
	указать запись взвешивающего устройства, данные с которого следует обрабатывать.

	\item[\dlgcombo{Операция покрытия временных сессий}]
	Если здесь определен вид операции (этот вид должен относиться к типу операций
	\ppyrsrv{Драфт-расход} либо \ppyrsrv{Драфт-приход}), то при приеме незакрытой асинхронной
	кассовой сессии будет формироваться драфт-документ заданного вида.

	При повторном приеме этой сессии, драфт-документ покрытия временной сессии,
	который был сформирован до этого удаляется. Если вновь принятая сессия опять
	является временной, то формируется новый документ покрытия.

	Данная опция может понадобиться в том случае, если вы хотите анализировать
	продажи и остатки с учетом еще не завершенных кассовых сессий.

	Отчет \qu{Остатки товаров} поддерживает функцию расчета остатков
	с учетом документов покрытия временных кассовых сессий.

	Существует дополнительная функциональная нагрузка на этом поле.
	Указанный здесь вид операции (если он относится к типу драфт-расход)
	используется для создания драфт-документов по кассовым чекам
	(см.~\pageref{loc-v-ccheck-f01}).

	\item[\dlgcombo{FTP-аккаунт}]
	Если система обменивается данными с асинхронным кассовым узлом через
	FTP-сервер, то здесь следует выбрать элемент справочника учетных записей FTP,
	в котором заданы параметры этого сервера.

	\item[\dlgflag{Проверять ввод с весов}]
	Если этот признак не установлен, то система не будет проверять сигнал с электронных
	весов при вводе товарных документов.
	Обратите внимание, что этот признак хранится на конкретной рабочей станции, а не в
	базе данных, так как обычно весы подключаются к одному или нескольким компьютерам,
	но не относятся ко всем компьютерам в сети, на которых установлен \ppybrand{}.

	\item[\dlgflag{Комплектация дефицита}]
	Если этот признак установлен, то при списании кассовых сессий те товары, которые
	попадают в дефицит и содержат структуру, допускающую комплектацию, будут автоматически
	формироваться из имеющихся в наличии компонентов.

	Вид операции, используемый для комплектации таких товаров, система извлекает из общих
	настроек (\ppymenu{Админ\rdir Настройки} кнопка \dlgbutton{Операции} - Операция автокомплектации).
	Если вид операции автокомплектации не задан, то комплектация
	дефицитных позиций осуществляться не будет.

	Система комплектует только те позиции, для которых хватает наличного количества
	компонентов.

	\item[\dlgflag{Закрывать кассовые сессии до 10-го уровня}]
	Если этот признак включен, то система не реализует списания кассовых сессий. Такие
	сессии остаются со степенью завершенности 10 и по ним не формируются документы
	списания. Это может быть полезно в тех случаях, когда вам нужна только информация о
	чеках, но не нужно получать привязанные к кассовым сессиям учетные документы
	списания.

	Пример: из раздела данных, соответствующего удаленному магазину вы получаете документы
	розничных продаж и, наряду с этим, кассовые сессии. Для того, чтобы избежать дублирования
	документов продаж, установите этот флаг и кассовые сессии будут существовать независимо
	от документов продаж.

	\item[\dlgflag{Не проверять готовность кассовых машин к приему данных}]
	Для некоторых кассовых модулей система \ppybrand{} проверяет их готовность к приему данных.
	Если кассовый модуль некорректно информирует о неготовности к приему данных, установка
	этого флага позволяет выгрузить данные из системы, несмотря на отсутствие  явного
	подтверждения готовности кассового модуля.
	Признаком неготовности кассового модуля к приему данных является сообщение
	\qu{Кассовая машина не готова к приему данных}.

	\item[\dlgflag{Не использовать обобщенные товары для компенсации дефицита}]
	По умолчанию, при возникновении дефицита при списании кассовых сессий, система пытается
	для его компенсации использовать товары, входящие в обобщении наряду с дефицитным товаром.
	Например, если кассиры на кассе постоянно путают код хлеба \qu{Дарницкий} с кодом хлеба
	\qu{Окский}, то можно создать обобщенный товар, в который войдет как один так и другой
	хлеб. Тогда, при возникновении дефицита, скажем, по хлебу \qu{Дарницкий}, система спишет
	хлеб \qu{Окский}.

	Рассматриваемый признак запрещает такую компенсацию дефицита. Это может быть связано с
	тем, что вы используете обобщенные товары в контексте, не допускающем этого.

	\item[\dlgflag{Тестировать чеки при закрытии кассовой сессии}]
	Это - диагностическая опция. Если флаг установлен, то при закрытии асинхронных кассовых
	сессий система будет проверять принятые из внешнего кассового модуля чеки.
	Обнаруженные при проверке ошибки будут выводиться в файл журнала $pperror.log$.

	Здесь применяется та же процедура проверки, которая может быть вызвана вручную из
	таблицы просмотра чеков (стр.~\pageref{loc-ccheckview-recover}).

	\item[\dlgflag{Вести журнал чековых операций}]
	При включенном флаге в базе данных будут фиксироваться операции с кассовыми
	чеками в специальной таблице.

	Опцию следует включать при использовании синхронных кассовых узлов. Журнал
	чековых операций в этом случае помогает разбирать спорные и сомнительные ситуации,
	возникающие на расчетно-кассовом узле.

	Если ваше предприятие работает только с асинхронными кассовыми узлами,
	данная опция излишняя. Более того, в этом случае, она может приводить
	к неоправданному снижению быстродействия при закрытии кассовых сессий.

	\item[\dlgflag{Распознавать значение кодов}]
	Флаг применяется в кассовой панели. Если он включен, то система после
	ввода пользователем кода без специального префикса пытается идентифицировать
	назначение кода в следующем порядке:

	\begin{itemize}
		\item Товар по штрихкоду, совпадающему с введенным кодом
		\item Лот по серийному номеру
		\item Агента по поисковому коду персоналии
		\item Дисконтную карту
	\end{itemize}

	Опция позволяет избежать применения специального префикса кода агента и нажатия кнопки
	выбора дисконтной карты. Однако, при этом необходимо, чтобы коды агентов,
	коды товаров и коды дисконтных карт не пересекались. Другими словами, не должно существовать товаров, имеющих
	такие же коды, что и коды агентов, равно как и дисконтных карт, имеющих коды такие же
	как у товаров либо поисковые коды персоналий-агентов.

	\item[\dlgflag{Унифицированный расчет в кассовой панели}]
	Если флаг установлен, то в кассовой панели применяется новый метод (с версии 6.8.0) выбора способа оплаты
	чека.
	В большинстве случаев рекомендуется устанавливать этот флаг.

	\item[\dlgflag{Подтверждать безналичную оплату при унифицированном расчете}]
	Опция обеспечивает дополнительный вывод предупреждения при выборе безналичной оплаты в кассовой панели,
	если применяется унифицированный расчет.

	Необходимость установки флага может быть обусловлена частыми ошибками персонала при проведении чеков.

	Предупреждение выдается в случае, если в унифицированной панели расчета была выбрана безналичная форма оплаты
	и сумма наличной части платежа нулевая (в противном случае предполагается, что вероятность ошибки не высока).

	\item[\dlgflag{Игнорировать товарный признак 'Без скидки' в кассовой панели}]
	Специализированная опция, блокирующая ограничение на предоставление скидки на товар,
	если в товара установлен флаг \dlgflag{Без скидки}.

	Данная опция может быть использована в тех случаях, когда продажа товаров с помощью
	товарных документов совмещается с продажами через кассовую панель, причем применение
	скидки в документах должно ограничиваться признаком товара 'Без скидки', а в кассовой
	панели - нет.

	\item[\dlgflag{Проверять дробность количества в кассовой панели}]
	Если флаг установлен, то в кассовой панели программа будет следить за тем, чтобы
	вводимое количество продаваемого товара соответствовало параметру целочисленности
	единицы измерения этого товара и дробности.

	Подробно о единицах измерения рассказано на стр.~\pageref{sec-units}.

	\item[\dlgflag{Запрещать ввод номера карты вручную}]
	Опция применяется в кассовой панели для предотвращения злоупотреблений путем ввода номера персональной карты
	вручную.

	Система отличает ввод посредством сканера от ручного путем замера промежутков времени между поступлениями символов
	с клавиатуры.

	\item[\dlgflag{Не применять выравнивание сумм документов списания}]
	Флаг блокирует автоматическую модификацию документов списания кассовых сессий с целью выравнивания итоговой суммы
	списания с суммой чеков в кассовой сессии (за вычетом дефицита списания).

	Подробно вопрос освещен на стр.~\pageref{csess-adjwroff}.

	\item[\dlgflag{Цены товаров по котировкам}]
	Если этот флаг установлен, то при загрузке информации о товарах на кассы и на электронные
	весы, система будет определять цены на товары исходя из базовой котировки, установленной
	для товаров по складу, к которому относится кассовый узел либо, если такой котировки нет,
	то по котировке \qu{для всех складов}. И, если подходящей котировки нет, использовать учетную
	цену реализации из лотов.

	При отсутствии этого признака система определяет цены на товар исходя из учетных цен
	реализации по лотам.

	При загрузке данных на весы, для которых указан вид котировки, который следует использовать
	для определения цены, флаг \dlgflag{Цены товаров по котировкам} имеет меньший приоритет.
	То есть, система сначала пытается определить цену на товар, исходя из котировки вида,
	указанного для весов, и только если такая котировка не определена для товара, используется
	общее правило.

	\item[\dlgflag{Безусловная базовая цена для асинхронных узлов}]
	При загрузке на данных на асинхронные кассовые узлы для цен товаров не применяются правила
	розничных котировок (по дням недели, времен дня и т.д.).

	\item[\dlgflag{Автосохранение синхронных чеков}]
	При каждом изменении чека в кассовой панели система автоматически сохраняет его
	в виде JUNK-чека. Эта опция резко снижает риск потери введенных данных, вызванной
	потерей связи с сервером, отключением электричества и т.д.

	\item[Длина кода агента и префикс кода агента\label{loc-cfg-trequip-agentcode}] Используются в кассовой панели.

	Эти поля позволяют переопределить установленный
	по умолчанию префикс кода агента, распознаваемый системой в кассовой панели.

	По умолчанию таким префиксом является $SAL$. При сканировании кода с таким префиксом
	система считает, что непосредственно за ним следует код агента.

	Указав в рассматриваемых полях общую длину кода агента с префиксом, вы предпишите
	системе воспринимать строку указанной длины и начинающуюся с указанного префикса как
	код агента.

	\ppyexample{
		Если длина кода равна 5, а префикс 77, то коды:
		77001, 77209, 77014 будут восприниматься как выбор агентов с
		номерами поисковых регистров соответственно, 001, 209, 014.

		При этом код 7700102220001 будет восприниматься как код
		товара поскольку длина этой строки не равна 5 (хотя префикс и
		совпадает с заданным).
	}

	Система не разрешает ввод длины кода агента, меньшей чем длина
	префикса плюс 1.

	\item[Префикс кода отложенного чека]
	Не используется.

	\item[Предельное отличие цены при подстановке дефицита по кассовой сессии]
	Параметр ограничивает возможность выбора товара для подстановке в таблице
	дефицита по кассовой сессии. Основное назначения параметра - снизить вероятность
	случайной или намеренной ошибки при компенсации дефицита.

	В этом поле может быть определен диапазон допустимого процентного отклонения
	учетной цены реализации подставляемого товара от цены, по которой был продан
	дефицитный товар. Нижняя граница диапазона должны быть меньше верхней.
	При этом отрицательное значение допускает уменьшение цены, а положительное - увеличение.

	Например: -60..30 означает, что система разрешит подставить товар, учетная цена
	которого составляет не менее 40\% (100-60) и не более 30\% от цены продажи.

	Подробнее о дефиците по кассовым сессиям см. стр.~\pageref{loc-csessdfct}.

	\item[Период извлечения фиксированных цен (дней)]
	Значение в этом поле определяет количество дней, начиная с текущего, которое программа
	охватывает при поиске лотов с различающимися ценами на выбранный товар.

	Такой обзор применяется в специальных случаях, когда одна из фиксированных цен может быть выбрана
	в ручную кассиром при продаже товара. В России это, главным образом, относится к сигаретам, имеющим
	фиксированную максимальную розничную цену (МРЦ), которая имеет в последнее время (2016-2018 годы)
	обыкновение часто меняться.

	Техника извлечения фиксированных цен применяется как для синхронных так и для асинхронных кассовых
	узлов.
\end{description}

При списании кассовых сессий система позволяет сформировать так называемый пул документов
покрытия дефицита. Этот пул состоит из драфт-документов, чьи товарные строки отражают
товарные позиции, которые система не смогла списать из-за того, что их нет на
учетном остатке.

Следующие два параметры определяют виды операций, используемые для формирования таких
документов. Если ни один из этих параметров не указан, то пул покрытия дефицита по кассовым
сессиям создаваться не будет.

Третий и четвертый параметры определяют специфическую опцию ценообразования при
формировании драфт-документов покрытия дефицита по чужому складу.

Для полного понимания технологии создания документов покрытия дефицита необходимо пояснить
что такое ассоциация товар-склад. Эта ассоциация связывает товары или группы товаров со
складом, на которых эти товары (товары принадлежащие группе) хранятся или производятся.
Подробно такие ассоциации разобраны в разделе, посвященном справочнику товаров.

\begin{description}
	\item[\dlgcombo{Операция покрытия дефицита для своего склада}]
	Этот вид операции используется для создания драфт-документов покрытия дефицита, для тех
	товаров, для которых ассоциация товар-склад либо не задана, либо, согласно этой ассоциации,
	товар относится к складу, которому соответствует кассовый узел, по которому закрывается
	кассовая сессия.

	\item[\dlgcombo{Операция покрытия дефицита для чужого склада}]
	Этот вид операции используется для создания драфт-документов покрытия дефицита для тех
	товаров, для которых ассоциация товар-склад указывает на склад, отличный от того,
	которому соответствует кассовый узел, по которому закрывается кассовая сессия.

	\item[\dlgcombo{Вид котировки для чужого склада}]
	Если здесь указан вид котировки, то цена реализации в драфт-документах
	покрытия дефицита по чужому складу будет формироваться по этой котировке.

	\item[\dlgflag{Покрытие дефицита по другому складу по базовой цене реализации}]
	Флаг отвечает за то, что бы при формировании драфт-документов покрытия дефицита по
	кассовым 	сессиям, для номенклатурных позиций, ассоциированных со складом, отличным
	от того, к которому привязана сессия, цены реализации в этих драфт-документах
	устанавливались в соответствии с базовой ценой реализации склада, к которому привязана
	сессия.

	Если флаг не установлен, то цена реализации в таких документах будет устанавливаться
	согласно последнему лоту на складе, к которому относится создаваемый драфт-документ.
	Опция применяется в том случае, когда необходимо формировать документы производства по
	указанным драфт документах таким образом, чтобы учетная цена реализации формируемых
	товаров соответствовала складу, на котором осуществляется продажа.

	Флаг не доступен, если установлен вид котировки для чужого склада (см. выше).
\end{description}

%topic(DLG_CFGKBDWKEY)

\section{Конфигурация клавиатуры с ключом\label{sec-keybposcfg}}

Система \ppybrand{} поддерживает ограничение прав доступа к функциям
кассовой панели по положениям ключа в специализированной клавиатуре.

Для настройки соответствия положений ключа правам доступа
необходимо выбрать пункт меню \ppymenu{Админ\rdir Прочие конфигурации\rdir Конфигурация клавиатуры с ключом}.

\ppypict{dlg-081}{Конфигурация клавиатуры с ключом}

Диалог, который откроется при обращении к этому пункту меню, показан на рис.~\ref{pic-dlg-081}.
Далее перечисляются поля этого диалога. Смысл каждого из полей состоит в том,
что перечисленные в них числовые значения положения ключа будут разрешать соответствующее
действие кассира.

\begin{description}
	\item[Чеки возврата]
	При заданных положениях ключа допускается вводить чеки возврата.

	\item[Удаление покупки из чека]
	Допускается удаление строки из текущего вводимого чека.

	\item[Безналичный расчет]
	Допускается применять закрытие чека за безналичный расчет.

	\item[Снятие Z-отчета]
	Допускается снятие Z-отчета (закрытие сессии).

	\item[Отмена чека]
	Допускается отменять текущий вводимый чек.

	\item[Копия чека]
	Допускается печать копии чека.

	\item[Копия Z-отчета]
	Допускается печать копии Z-отчета.

	\item[Скидка на отдельную позицию]
	Допускается вручную предоставлять скидку на отдельную позицию чека.

	\item[Снятие X-отчета]
	Допускается снятие X-отчета.

	\item[Разделение чека]

	\item[Изменение чека после печати счета]

\end{description}

Для примера, если Z-отчет можно снимать только при положении ключа в позиции
3, то в поле напротив соответствующего текста (Снятие Z-отчета) следует поставить
цифру 3.

Если безналичный расчет допускается при положении ключа 1, 2 и 3, то
в поле напротив \qu{Безналичный расчет} следует указать 1,2,3.

%endtopic

\chapter{Интерфейс с сервисом IP-телефонии\label{ch-ipphoneifc}}

В систему \ppybrand{} включены механизмы взаимодействия с сервисами ip-телефонии. С помощью
этих механизмов вы можете оптимизировать работу по обслуживанию клиентов, и взаимодействие с
иными контрагентами, обращающимися к сотрудникам вашего предприятия по телефону.

Система \ppybrand{} на текущий момент работает только с телефонными серверами Asterisk и предоставляет
два варианта взаимодействия с телефонным сервисом:

\begin{description}
	\item[Специализированное обслуживание доставки] Хорошо отработанная техника, обеспечивающая
	поддержку специализированного бизнес-процесса приема и обработки заказов на доставку.
	Этот вариант тесно связан с кассовой панелью.
	\item[Универсальный интерфейс] Новая техника, реализующая универсальный подход к взаимодействию
	с сервисом ip-телефонии. Позволяет реагировать на звонки в широком диапазоне возможных ответных
	действий.
\end{description}

\section{Настройка работа с телефонным сервисом}

\subsection{Справочник телефонных сервисов}

Прежде всего, необходимо сформировать элемент справочника телефонного сервиса, определяющего
параметры соединения и взаимодействия с конкретным сервером IP-телефонии.

Соответствующий справочник доступен по меню \ppymenu{Справочники/Оборудование/Телефонные сервисы}.

Диалог редактирования записи сервиса показан на рис.~\ref{pic-dlg-phnsvc}.

\ppypict{dlg-phnsvc}{Запись настройки телефонного сервиса}

Вот список и назначение полей этого диалога.
\begin{description}
	\item[Наименование] Уникальное наименование записи длиной не более 47 символов.
	\item[Символ] Символ, позволяющий ссылаться на запись. Либо пустая строка, либо
	уникальная среди других аналогичных записей строка длиной не более 19 символов.
	Настоятельно рекомендуется использовать только латинские буквы, цифры и знаки
	препинания.
	\item[ИД] Справочное поле, отображающее внутренний идентификатор записи.
	\item[\dlgcombo{Тип сервиса}] Зарезервированный на будущее комбо-бокс для
	выбора типа сервера (сейчас работа возможна только с сервером Asterisk).
	\item[Адрес сервера] ip-адрес и (опционально) порт сервера.
	\item[Авторизация] Имя авторизации на телефонном сервере и пароль.
	\item[Символ локального канала (Up)] В этом поле указывается префикс канала,
	для которого включается реакция на подъем телефонной трубки.
	Для сервера Asterisk обычно этот символ задается как SIP/999 где 999 - локальный номер
	телефона сотрудника, к чьему рабочему месту относится компьютер, на котором настраивается запись.
	Важно: этот символ хранится не в базе данных, а в локальном реестре на компьютере.
	Таким образом, одна запись на разных компьютерах может (и, вероятно, должна) иметь разные символы локального
	канала.

	Если данный компьютер должен реагировать на подъем трубки для нескольких префиксов канала,
	то в этом поле можно прописать их все, разделяя запятой или пробелом.

	Специальный символ \@all обеспечивает соответствующую реакцию на подъем трубки любого канала телефонного сервера.

	\item[Символ локального канала (Scan)] В этом поле указывается префикс канала,
	для которого включается реакция входящий звонок.
	Правила ввода и хранения данного символа аналогичны тем, что описаны для символа локального калана (Up).

\end{description}

\chapter{Управление мобильной торговлей\label{ch-mobiletrading}}

Система \ppybrand{} предоставляет сервис для торговых агентов, позволяющий автоматизировать
и упростить процесс сбора и обработки заказов с помощью карманного компьютера (КПК) под
управлением операционной системы \trademark{PalmOS} либо \trademark{Windows Mobile}.

С этой целью поставляется отдельный модуль \trademark{StyloPalm}, загружаемый на КПК.

\section{Обмен данными}

Обмен данными между мобильным агентом и офисом может осуществляться по одной из
двух схем:

\begin{itemize}
	\item Прямой обмен.
	\item Обмен посредством сервера.
\end{itemize}

\subsection{Прямой обмен}

\ppypict{schame-stylopalm-exchg-direct}{Схема прямого обмена}

Рис.~\ref{pic-schame-stylopalm-exchg-direct} иллюстрирует эту схему обмена.

Фактически, такой вариант не удобен тем, что, во-первых, требует прихода
агента в офис компании, а, во-вторых, может зависеть от особенностей
операционной системы, установленной на КПК агента.

\subsection{Обмен посредством сервера}

\ppypict{schame-stylopalm-exchg-server}{Схема обмена посредством сервера}

Наиболее предпочтительный вариант обмена данными между агентами
и офисом.

Рис.~\ref{pic-schame-stylopalm-exchg-server} иллюстрирует принцип
работы этой схемы.

Внесем некоторые пояснения.

\begin{itemize}
	\item При такой организации обмена должен существовать
	сервер с открытым ip-адресом. Это необходимо для того, чтобы
	мобильные агенты имели возможность соединиться с этим сервером
	посредством сотовой связи.

	\item На сервере должен быть установлен Papyrus JobServer
	(лицензируется отдельно). Он необходим для обслуживания запросов
	со стороны модулей StyloPalm.

	\item На сервере должна быть установлена какая-либо программа FTP-сервера.
	Это необходимо для обмена данными между офисом вашего предприятия и
	сервером для синхронизации данным между ними.

	\item Агент кроме КПК должен иметь сотовый телефон, настроенный
	на обмен данными. Возможно также применение смартфонов (объединяющих
	в себе и КПК и сотовый телефон).
\end{itemize}

\section{Администрирование мобильных устройств}

\subsection{Таблица мобильных устройств}

\subsection{Диалог редактирования записи устройства}

\ppypictsc{dlg-062}{Palm}{0.5}

Диалог показан на рис.~\ref{pic-dlg-062}. Далее описываются его
управляющие элементы.

\begin{description}
	\item[Наименование]
	Наименование устройства. Система следит за уникальностью
	данного наименования среди всех записей устройств (включая группы).

	\item[Символ]
	Символьное обозначение устройства, используемое для доступа к
	записи из формул и из внешних систем.

	Если символ не пустой, то должен быть уникальным
	среди всех записей устройств (включая группы).

	\item[Ид]
	Справочное поле, отображающее идентификатор записи.

	\item[\dlgcombo{Группа}]
	Группа, которой принадлежит данное устройство.

	Может быть пустым.

	\item[\dlgcombo{Агент}]
	Аналитическая статья, соответствующая агенту, за которым
	закреплено данное устройство.

	Может быть пустым.

	\item[\dlgcombo{Склад}]
	Склад, на который будут приниматься документы заказов с
	этого устройства.

	При формировании данных для загрузки на устройство, система
	предполагает, что агенту потребуются данные относящиеся только
	к этому складу (группе складов, если выбран список, описанный ниже).

	\item[\dlgbutton{Список}]
	Позволяет выбрать список складов, на которые допускается принимать
	заказы с этого устройства.

	\item[\dlgcombo{Товарная группа}]
	Если необходимо ограничить агента работой только с одной товарной группой,
	то в этом комбо-боксе следует выбрать такую группу.

	Допускается выбор как обыкновенной, так и альтернативной группы, а
	так же группы верхнего уровня.

	\item[\dlgcombo{Вид операции импорта}]
	Вид операции, применяемый для формирования документов заказов,
	принятых с данного устройства.

	Если значение здесь не выбрано, то наследуется от группы,
	которой принадлежит запись.

	В случае, если системе не удалось идентифицировать вид операции,
	то заказы с этого устройства приняты не будут.

	\item[\dlgcombo{Учетная запись ftp}]

	При обмене посредством сервера, если сервер обмена находится вне
	локальной сети предприятия, необходимо указать учетную запись
	для обмена между офисом и сервером обмена по протоколу FTP.

	\item[Путь экспорта/импорта данных]
	Каталог в сети предприятия, через который осуществляется обмен
	данными между устройствами (или удаленным сервером обмена) и
	системой.

	\item[Путь экспорта/импорта данных на ftp]

	Каталог на удаленном сервере, с которым взаимодействует система
	для обмена данными.

	\item[\dlgflag{Наследовать флаги от группы}]
	Если этот флаг установлен, то описанные ниже флаги наследуются от
	группы, которой принадлежит данное устройство.

	Если устройство не принадлежит группе, то этот флаг заблокирован.

	Если флаг установлен, то следующие флаги блокируются для выбора.

	\item[\dlgflag{Допускает импорт в кассовую панель}]
	Если устройство используется для приема заказов в торговом зале или
	в зале кафе (ресторана), то необходимо установить данный флаг.
	При этом появляется возможность передачи заказа с устройства в
	кассовую панель в виде чека.

	\item[\dlgflag{Экспортировать долги клиентов}]
	Если флаг установлен, то для устройства будут формироваться данные
	о долгах контрагентов.

	\item[\dlgflag{Экспортировать продажи}]
	Если флаг установлен, то для устройства будут формироваться данные
	о продажах в разрезе товаров и контрагентов.

	\item[\dlgflag{Экспортировать брэнды}]
	Если на устройстве необходимо подбирать товары не только по
	группам, но и по брэндам, следует установить этот флаг.
\end{description}

\subsection{Диалог редактирования записи группы устройств}

\ppypictsc{dlg-063}{Группа Palm`ов}{0.5}

Показанный на рис.~\ref{pic-dlg-063} диалог редактирования группы
устройств, по содержанию аналогичен описанному выше диалогу
собственно записи устройства.

Элементы \dlgcombo{Склад}, \dlgcombo{Товарная группа}, \dlgcombo{Вид операции импорта},
\dlgcombo{Учетная запись ftp} и флаги используются для того, чтобы
наследоваться записями, чьим родительским элементом является данная запись.

\subsection{Конфигурация}

Для доступа к конфигурации мобильной торговли необходимо обратиться к
пункту меню \ppymenu{Админ\rdir Прочие конфигурации\rdir Конфигурация StyloPalm}.

\ppypict{dlg-065}{Конфигурации StyloPalm}

\begin{description}
	\item[Операция продажи товаров]

	\item[Количество недель расчета]

	\item[Операция инвентаризации клиентов]
\end{description}


\section{Работа с мобильными агентами}

\ppypict{Dlg-064}{Palm импорт/экспорт}

\begin{description}
	\item[Palm]

	\item[Вид операции приема документов]

	\item[Склад для приема документов]

	\item[Обновлять данные для Palm`a]

	\item[Обновить данные на FTP]

	\item[Забрать данные с FTP]

	\item[Удалить файлы импорта]
\end{description}

\chapter{Разделенные базы данных\label{ch-dbxchg}}

\section{Введение}
Разделенные базы данных - это технология, основное назначение которой - обеспечить
совместную работу территориально разделенных объектов. Хотя существуют и другие способы
использования этой технологии, мы будем рассматривать только этот, по нашему мнению,
главный.

Кроме того, эта технология - не единственный способ организовать работу территориально
разделенных пользователей в одном пространстве данных. Если ваше предприятие имеет доступ
к устойчивым высокопропускным каналам связи, то будет естественным рассматривать вопрос
об использовании терминального доступа к серверу базы данных. Можно применять и
комбинированный вариант - одновременное использование и технологии разделенных баз
данных и терминального доступа.

\ppypictsc{schema-dbxchg}{}{0.4}

\section{Описание технологии}

Система  \ppybrand{} обеспечивает обмен данными между синхронизированными разделами базы
данных на прикладном уровне. Это означает, что вся инфраструктура технологии реализована
средствами собственно системы, а не средствами системы управления базами данных или же
какими-либо подсистемами промежуточного слоя.
Принципиальной особенностью технологии является то, что синхронизация между разделами
базы данных организована на уровне объектов данных, а не записей базы данных. То есть,
синхронизируются не записи из таблиц базы данных, а объекты данных.
Для примера, если в разделе $A$ создана персоналия $X$, то при синхронизации между разделами
$A$ и $B$ в раздел $B$ будет передан пакет данных, содержащий полный набор атрибутов персоналии
$X$. Кроме того, вместе с пакетом, соответствующим этой персоналии в раздел $B$ будут переданы
все объекты данных, от которых зависит пакет персоналии $X$ (адреса, теги, типы электронных
адресов, типы регистров и т.д.). При приеме этого пакета в разделе $B$ в базу данных этого
раздела будут занесены все переданные с пакетом атрибуты. При этом система не принимает во
внимание особенности хранения информации о персоналии $X$ в разделе-отправителе ($A$).
Для правильного понимания функционирования обмена данными между разделенными базами
необходимы две ключевые концепции: синхронизация объектов и  разрешение ссылок. Далее
мы рассмотрим эти понятия.

\subsection{Синхронизация объектов}

\ppypictsc{schema-dbxchg-objects}{}{0.4}

На рис.~\ref{pic-schema-dbxchg-objects} изображена схема, которая нам поможет
разобраться с механизмом синхронизации объектов между разделами базы данных.

Для простоты будем рассматривать два раздела базы данных: $X$ и $Y$, в каждом из которых
присутствует по два синхронизированных друг с другом объекта $A$ и $B$. Напомним, что под
объектами могут подразумеваться товары, документы, персоналии и множество других сущностей,
с которыми работает система. Каждый из объектов имеет собственное представление в каждом
из разделов базы данных. Эти представления мы обозначили, соответственно, $Ax$ $Bx$ для раздела
$X$ и $Ay$ $By$ для раздела $Y$.

Основная трудность заключается в том, что каждое представление одного и того же объекта
одновременно в двух разделах базы данных \qu{живет} своей собственной жизнью. То есть,
участвует в качестве ссылки в других объектах, изменяется и даже, возможно, удаляется
независимо от представлений в других разделах.

Далее, система должна \qu{знать}, что объекты $Ax$ и $Ay$ - суть один и тот же объект $A$,
находящийся в разных разделах. Для этого предназначена технология системной синхронизации.
Системная синхронизация обеспечивается специальной таблицей в базе данных каждого раздела,
которая хранит информацию о соответствиях объектов в разных разделах.

Что происходит, когда новый объект (допустим, это объект $A$) создается в одном из разделов
(для определенности - раздел $X$)? С точки зрения синхронизации - ничего. События, связанные
с синхронизацией данных, начинаются в тот момент, когда этот объект из раздела, в котором
создан, передается в какой-либо другой раздел. При этом система присваивает этому объекту
уникальный общий идентификатор ($A$), формирует запись в таблице синхронизации, в которой
отражает соответствие созданного общего идентификатора собственному идентификатору $Ax$. После
этого объект упаковывается вместе с другими в пакет передачи данных и отправляется в
раздел-получатель $Y$.

Раздел-получатель обнаруживает, что полученный объект $A$ не имеет соответствия в таблице
синхронизации (напомним, что это уже таблица раздела $Y$). Далее события могут пойти по
одному из двух возможных путей:
\begin{enumerate}
 	\item	Раздел-получатель пытается использовать контекстную синхронизацию для объекта A.
 	Для каждого типа объектов контекстная синхронизация может быть разная. Например, для
 	товаров, она подразумевает поиск по точному соответствию наименования или штрихкода
 	товара, для других типов объектов - по коду. Для некоторых же типов объектов, контекстная
 	синхронизация вообще не предусмотрена.
	Если в разделе-получателе обнаружен объект, соответствующий объекту Ax, то система полагает,
	что он и должен быть представлением $Ay$ для общего объекта $A$.
	\item	Если контекстная синхронизация не нашла соответствия объекту Ax, то в
	разделе-получателе создается новый объект Ay, в точности соответствующий Ax, и далее
	система считает его представлением A в разделе Y.
\end{enumerate}

Наконец, система в разделе-приемнике создает две записи для таблицы синхронизации: одна
хранит пару {Ax-A}, другая - {Ay-A}. Теперь раздел-получатель знает о том, что объект
Ay - является локальным представлением объекта A, а в разделе X этому объекту соответствует
представление Ax.
Теперь нам необходимо выяснить, что происходит, когда из раздела X в раздел Y передается
объект (скажем, B), для которого и в том и в другом разделах существуют представления
(соответственно Bx и By).
Раздел-получатель, обнаружив, что принимаемый им объект Bx имеет собственное представление
By, может либо изменить By так, чтобы он соответствовал Bx, либо отклонить изменение.
Алгоритм принятия решения об этом достаточно сложен из-за того, что он опирается как на
общую технику (справедливую для всех типов объектов), так и на особенности конкретных
типов объектов.
Общая техника предполагает три варианта:
\begin{enumerate}
	\item Объект в разделе-приемнике не изменяется
	\item Объект в разделе-приемнике безусловно изменяется
	\item Объект в разделе-приемнике изменяется, если он старше объекта, полученного от
	раздела-отправителя.
\end{enumerate}
Последний вариант предполагает, что система сравнивает время последней модификации объекта
в разделе-приемнике со временем последней модификации объекта в разделе-отправителе (это
время передается вместе с объектом). Если полученный объект имеет более позднее время
изменения, то система модифицирует представление объекта.

\ppyadmin{
	Система определяет время модификации объекта по системному журналу.
	Для правильного функционирования механизма синхронизации по времени необходимо, что бы
	системные часы в разделе-приемнике были синхронизированы с разделом-отправителем.
	Кроме общей техники в правила изменения объектов при синхронизации данных вмешиваются
	множество правил и исключений. Наиболее существенным исключением является невозможность
	для системы изменить товарный документ. То есть, однажды полученный товарный документ
	при следующей передаче, даже если был изменен в разделе-отправителе, уже не измениться.
	Со всеми остальными документами (бухгалтерскими, драфт-документами, оплатами) и типами
	объектов таких нерегулируемых ограничений нет, но остаются регулируемые ограничения. Так,
	администратор системы может запретить прием изменений товаров в одном или нескольких разделах
	и пр.
}

\subsection{Акцепт объекта}

Это понятие обозначает создание или изменение объекта, присланного из раздела-отправителя,
в базе данных раздела-получателя. Подчеркнем, что имеется в виду именно сохранение объекта
в базе данных, а не учет его в очереди приема.

\subsection{Разрешение ссылок}

Технология разрешения ссылок необходима для того, чтобы при передаче объекта из одного
раздела в другой сохранялась его целостность. Большинство типов объектов не существуют
сами по себе, а зависят от других объектов. Так, товар, принадлежит товарной группе,
относится к какой-либо (возможно пустой) торговой марке, имеет единицы измерения и т.д.
В свою очередь, товарная группа, торговая марка и единица измерения сами являются
объектами, которые необходимо синхронизировать между разделами базы данных.
Суть техники разрешения ссылок заключается в том, что при передаче объекта, вместе с
ним передаются все объекты, от которых он зависит. По принципу матрешки те объекты в
свою очередь \qu{тянут} за собой объекты, от которых зависят сами. Таким образом, при
передаче, допустим, одного товара из раздела в раздел будет передан объем данных
значительно превышающий тот, что занимает один товар. Следующим шагом является
преобразование ссылок из раздела-отправителя на значения, соответствующие им в
разделе-получателе.
Весь процесс передачи и разрешения ссылок, естественно, полностью автоматический.

\subsection{Приоритет приема объекта}

Когда раздел-отправитель формирует пакет объектов для передачи в другой раздел, он
присваивает каждому объекту приоритет обработки. Этот приоритет представлен целым
положительным числом. Чем меньше значение этого числа, тем раньше объект будет акцептирован
в разделе-получателе.

Существуют два важных обстоятельства, связанных с приоритетом акцепта объектов:
\begin{enumerate}
	\item 	Объекты с одинаковым значением приоритета принимаются в соответствии со временем
	их последней модификации (создания) в разделе-отправителе (объект, который был модифицирован
	или создан раньше, будет акцептироваться перед объектом, имеющим тот же приоритет, но более
	позднее время изменения или создания).
	\item 	Объекты, от которых зависит какой-либо акцептируемый объект, акцептируются вне
	очереди. То есть, если системе для проведения документа, поступившего из другого раздела,
	необходимо акцептировать какой-либо товар, то это будет сделано, независимо от приоритета
	приема этого товара, немедленно.
\end{enumerate}

Для релиза 5.6.8 и выше применяется следующая схема назначения приоритетов:
\begin{itemize}
	\item 	Динамические объекты - 100
	\item 	Типы тегов объектов - 120
	\item 	Документы, относящиеся к типу операции \ppyrsrv{Приход товара} - 200
	\item 	Прочие документы, которые только увеличивают товарные остатки - 220
	\item 	Документы модификации товаров - 240
	\item 	Документы, который только расходуют товар - 280
	\item 	Все остальные документы - 300
	\item   Зависимые объекты (которые не должны акцептироваться независимо от основного объекта) - 2000
	\item 	Остальные объекты - 1000
\end{itemize}

\subsection{Отложенная фиксация транзакции приема данных}

Фиксация транзакции приема данных состоит в акцепте всех объектов, поступивших из других
разделов и ожидающих в очереди синхронизации.
Первое, что делает система, когда принимает пакет из другого раздела базы данных, это -
сохраняет все объекты из пакета в очереди. Если принятый объект уже находится в очереди,
но вновь поступивший имеет более позднее время модификации в разделе-отправителе, то более
новая версия замещает более старую. При этом, один и тот же объект (в соответствии с общим
идентификатором) поступивший из разных разделов хранится в очереди синхронизации раздельно
для каждого из разделов-отправителей.
Вы можете увидеть состояние очереди приема, если выберите пункт меню \ppymenu{Админ\rdir Обмен данными\rdir Очередь синхронизации}.

Если пакеты принимаются без признака \dlgflag{Непосредственная фиксация транзакции},
то очередь будет заполняться, пока не будет дана команда на фиксацию транзакции.

\subsection{Как \ppybrand{} обрабатывает объединенные объекты?}

\ppypictsc{schema-dbxchg-uniteobjects}{}{0.4}

Так как система позволяет объединять некоторые объекты данных (например, товары или
персоналии), при этом один из объединяемых объектов удаляется, возникает вопрос о том,
что происходит с синхронизацией объединенных объектов.

Во-первых, необходимо отметить, что сам факт объединения пары объектов в одном разделе,
никак не сказывается на других разделах. Возможно, в будущем это будет не так, но сейчас
(версия 5.5.10 включительно) в другие разделы никакой информации о том, что в одном из
разделов произошло объединение каких-либо объектов, не передается.

Для иллюстрации того, что происходит с объединяемыми объектами, приведем схематическое
изображение двух объектов $A$ и $B$, представленных в двух разных разделах базы данных.
После объединения объектов в разделе $Y$ объект $A$ по-прежнему существует и в $X$ и в $Y$, а
объект представление объекта B осталось только в разделе $X$.

Передача данных из $Y$ в $X$ не претерпела никаких изменений (за исключением того, что
пользователи в $X$ с удивлением обнаружили отсутствие каких-либо операций или событий по
объекту $B$, приходящих к ним из раздела $Y$).

Передача же из $X$ в $Y$ несколько усложнилась. Теперь, если в $Y$ приходит объект $B$ (или
что-либо с ним связанное), система в разделе $Y$ увидев это, не должна пытаться создать
локальное представление, но должна понять, что в действительности, пришел объект $A$ (ибо
для $Y$ после объединения $A$ с $B$ это так). Для решения этой задачи, система, обнаружив
необходимость акцепта отсутствующего объекта, ищет в системном журнале информацию о том,
не был ли этот объект объединен с каким-либо иным. Если да, то идентификатор $B$ подменяется
локальным идентификатором $Ay$.

\subsection{Принцип равнозначности разделов}

Важной особенностью технологии разделенных баз данных в системе \ppybrand{} является то, что
все разделы базы данных технически равноправны. Мы говорим \qu{технически} потому, что в
организационном смысле это не всегда так. Структура предприятия обычно содержит множество
подразделений, каждое из которых имеет собственный ранг в иерархии управления и исполнения
функций. Соответственно этому рангу, подразделения вводят и потребляют информацию. Система
\ppybrand{} позволяет организовать обмен данными между разделами без учета ранжирования этих
разделов. Самый простой пример, демонстрирующий преимущества такой методологии, это -
прямой обмен данными между филиалами предприятия минуя управляющий центр.
С другой стороны, в систему встроены возможности, позволяющие ограничить обмен данными
между различными разделами так, чтобы учесть особенности организационной структуры
предприятия.

\subsection{Принцип соблюдения прав доступа}

Когда система принимает данные из других разделов, она проверяет возможность создания или
изменения объектов данных для того пользователя, под чьим именем принимаются эти данные.
Таким образом, если, допустим, пользователь не имеет прав доступа на изменение всех либо
некоторых документов, то такие документы приняты не будут, а в журнале сообщений появится
соответствующая информация. То же самое касается и всех остальных типов объектов данных.
Указанный принцип следует иметь в виду при настройке прав доступа пользователей и
распределении ролей пользователей.

\subsection{Какие объекты базы данных должны синхронизироваться?}

Мы вынесли этот вопрос в заголовок потому, что ответ на него не очевиден. Вообще говоря,
разделы базы данных не являются, даже теоретически, идентичными. Приведем несколько примеров:

\begin{description}
	\item[Тип объекта \ppyrsrv{Электронные весы}] Предприятие может владеть сетью магазинов.
	При этом каждый из магазинов имеет собственный набор электронных весов.
	Следовательно, синхронизировать записи об электронных весах не только не нужно,
	но и, вероятно, нежелательно.
	\item[Тип объекта \ppyrsrv{Вид операции}] Эти объекты \qu{жизненно} важны
	для функционирования системы. Более того, они должны быть синхронизированы
	иначе документы, заведенные в одном из разделов, будут приходить в другой
	раздел с принадлежностью к другому виду операции, что сделает эти документы
	совершенно непригодными к использованию. Однако в разных разделах один и тот же
	вид операции может иметь различные настройки бухгалтерских проводок и конфигурационных
	опций. По этому, система не передает между разделами изменения видов операций и не
	синхронизирует настройки бухгалтерских проводок.
\end{description}

Таким образом, мы еще раз увидели, что особенности синхронизации данных сильно зависят от
типов синхронизируемых объектов.

В приложении приведен полный список типов объектов системы с информацией о правилах
синхронизации.

\subsection{Некоторые технические особенности}

Администраторам системы и специалистам, сопровождающим программный продукт, следует
знать следующие особенности обмена данными в системе \ppybrand{}.
\begin{itemize}
	\item 	Формат файлов передачи данных является бинарным и не документированным. В
	связи с тем, что иногда (не часто) формат меняется, важно помнить, что версию системы
	в этом случае следует менять во всех разделах базы данных. Информация об этом
	обязательно публикуется в файле истории версий DOC/VERSION.TXT. В систему встроена
	защита от обмена данными между несовместимыми по формату передачи версиями.
	\item 	В системе существует опция сжатия файлов передачи данных с тем, чтобы сократить
	объем передаваемой информации по \qu{узким} каналам связи
	(\ppymenu{Админ\rdir Прочие конфигурации\rdir Конфигурация обмена данными\rdir Упаковывать файлы перед отправкой}).
	\item 	Система полагается на правильность настройки записей разделов базы данных. Это
	значит, что вы должны  очень аккуратно подойти к вопросу формирования этих записей, а
	так же ограничить права доступа обычных пользователям на изменения этих записей.
\end{itemize}

\section{Настройка разделенных баз данных}

Как правило, процесс настройки разделенной базы данных состоит в репликации некоторой
существующей базы - то есть в создании базы данных нового раздела (реплики), связанной
с существующей базой данных. Под словом \qu{связанной} мы подразумеваем то, что все объекты
данных, находящиеся в существующей базе и требующие синхронизации будут синхронизированы
с репликой.

Для настройки разделенных баз данных вы должны знать пароль пользователя master.
Это нужно, во-первых, потому, что вам понадобятся права доступа, достаточные для изменения
конфигурационных параметров, а, во-вторых, функция автосинхронизации доступна в специальном
режиме system, в который можно войти только с паролем пользователя master.

И так, порядок создания реплики базы данных.

	\paragraph{Создание (проверка наличия) записи о  текущем разделе базы данных (раздел базы данных: реплицируемая база данных)}

	Меню \ppymenu{Справочники\rdir Админ\rdir Разделы базы данных}. Если реплицируемая база данных уже
	участвует в группе разделенных баз данных, то для нее в справочнике разделов уже имеется
	запись.

	Если нет, то следует создать новую запись для текущего раздела базы данных (диалог
	редактирования записи раздела базы данных описан ниже).
	Как система определяет, к какому из разделов в справочнике относится текущая база
	данных?
	Выберите пункт меню \ppymenu{Админ\rdir Конфигурация}. В появившемся диалоге нажмите кнопку
	\dlgbutton{Конфигурация}.
	Комбо-бокс \qu{Раздел БД} указывает раздел, который является текущим.

	\paragraph{Создание записи о создаваемой реплике базы данных (раздел базы данных: реплицируемая база данных)}

	Меню \ppymenu{Справочники\rdir Админ\rdir Разделы базы данных}.
	Внесите новую запись для создаваемой реплики. Обязательно обратите внимание на
	идентификатор новой записи: он должен быть уникальным среди всех разделов и его значение
	не должно превышать 255. На текущий момент управление идентификаторами разделов является
	полностью ручной операцией.

	Еще раз обратим внимание на уникальность идентификатора: так как вы имеете дело с
	территориально разделенными базами данных, то проследите, чтобы ни в одной из баз данных
	среди группы, участвующей в обмене не существовало вновь создаваемого идентификатора
	раздела - система не сможет за вас сделать эту работу, так как не имеет постоянной
	гарантированной связи с остальными разделами.

	\paragraph{Автосинхронизация (раздел базы данных: реплицируемая база данных)}

	Откройте новый сеанс работы с текущей базой данных и войдите в него с именем system при
	этом введите пароль пользователя master.
	Выберите меню \ppymenu{Разное\rdir Автосинхронизация}.

	\paragraph{Создание реплики из текущей базы данных (раздел базы данных: реплицируемая база данных)}

	Возможны два варианта создания реплики:

	\begin{enumerate}
		\item 	Создание точной копии существующей базы данных. Для этого просто скопируйте весь
		каталог реплицируемой базы в другой каталог. Тот другой каталог и станет репликой текущей
		базы. Этот метод следует применять в случае, если вы сделали полную автосинхронизацию
		(с документами).
		\item 	Создание базы данных по образцу. Для этого запустите сеанс \ppybrand{}, выберите пункт
		меню \ppymenu{Админ\rdir Создание базы данных}. Выберите вариант создания \qu{По образцу}.
		Подробно создание базы данных описано в разделе, посвященном администрированию.
	\end{enumerate}
	Этот вариант создания реплики базы данных применяется в том случае, если автосинхронизация
	реплицируемой базы осуществлялась \qu{без документов}.

	\paragraph{Настройка реплики (раздел базы данных: реплика)}

	Единственное принципиальное действие, которое вам необходимо сделать во вновь созданной
	реплике - это установка текущего раздела базы данных.
	Для этого зайдите в базу данных новой реплики, выберите пункт меню \ppymenu{Админ\rdir Конфигурация},
	в появившемся диалоге нажмите кнопку \dlgbutton{Конфигурация} и в поле \qu{Раздел БД}
	выберите запись, соответствующую новому разделу.

	После переноса этой базы данных на сервер, на котором она будет использоваться, следует
	правильно настроить пути \ppymenu{Админ\rdir Конфигурация\rdir Пути}. При этом помните, что группы
	и (или) пользователи могут иметь собственные настройки путей.
	Определитесь с механизмом переноса данных из одного раздела в другой (электронная почта,
	магнитные носители и т.д.) и осуществите необходимые настройки.

\subsection{Диалог редактирования записи раздела базы данных}

\ppypict{dlg-dbdiv}{Раздел базы данных}

Вид окна диалога редактирования раздела базы данных показан на рис.~\ref{pic-dlg-dbdiv}.
Далее приводится описание его управляющих элементов.

\begin{description}
	\item[ИД]
	Идентификатор раздела. Для нового раздела устанавливается вручную. Для существующего
	раздела это поле изменять не допускается.
	При установке значения идентификатора нового раздела будьте внимательны: в группе баз
	данных, участвующих в обмене информации, не должно быть записи какого-либо раздела,
	идентификатор которого равен устанавливаемому значению.
	Кроме того, значение этого идентификатора не должно превышать 255.

	\item[Счетчик]
	Служебное поле, используемое для формирования уникальных наименований файлов передачи
	данных.

	На текущий момент не известно ни одной причины, по которой следовало бы вручную менять
	значение этого поля.

	\item[Имя]
	Наименование раздела базы данных. Выбирайте такое наименование, которое будет понятно
	вам и пользователям, вовлеченным в процесс обмена данными.

	\item[Адрес]
	Значение в этом поле используется для перенаправления пакетов данных в/из каталоги
	назначения или на адреса электронной почты.
	При указании этого адреса следует иметь в виду следующие правила:
	\begin{itemize}
		\item 	Если адрес раздела, в который отправляются данные пустой, то файлы передачи
		данных никуда не копируются и остаются в каталоге OUT.
		\item 	Если адрес раздела, в который отправляются данные, содержит символ @, то система
		воспринимает эту строку как адрес электронной почты и пытается отправить файлы передачи
		на этот адрес, используя учетную почтовую запись в конфигурации глобального обмена
		\ppymenu{Админ\rdir Прочие конфигурации\rdir Конфигурация глобального обмена}.
		\item 	Если адрес раздела не пустой и не содержит символа @, то система трактует его
		как каталог файловой системы (проверяя его предварительно на существование) и копирует
		файлы передачи данных в этот каталог.
		При получении данных, система ориентируется и на адрес текущего раздела и на адреса других
		разделов базы данных. Здесь правила следующие:
		\item 	Если адрес текущего раздела не пустой, то система трактует его как каталог входящих
		файлов и переносит файлы из этого каталога в каталог IN для дальнейшей обработки файлов.
		\item 	Если адрес текущего раздела пустой и какой-либо из адресов других разделов содержит
		символ @, то система обращается к серверу электронной почты за почтовыми сообщениями,
		имеющими тему (subj) \$PpyDbTransmission\$. Все письма с этой темой забираются с сервера,
		распаковываются и обрабатываются в каталоге IN.
	\end{itemize}
	Следствием вышесказанного является то, что в собственном разделе, если файлы данных не
	приходят к нему из другого каталога, поле адрес должно быть пустым.

	\item[Операция межскладского прихода]
	Здесь обязательно следует выбрать вид операции, используемой системой для приема
	документов внутренней передачи, если текущий раздел не отвечает за склад-отправитель
	товара.

	В таком случае переданный документ внутреннего перемещения преобразуется в документ
	межскладского прихода, не расходуя товар со склада-отправителя.
	Этот вид операции должен принадлежать типу \ppyrsrv{Приход товара} и в качестве таблицы статей
	содержать таблицу складов (та же таблица используется в операции внутренней передачи товаров).

	\ppyadmin{
		Система идентифицирует таблицу статей складов в соответствии с установкой в меню
		\ppymenu{Админ\rdir Конфигурация}\rdir \dlgbutton{Конфигурация}, поле \qu{Таблица позиций}.
	}

	\item[Счета передаваемых проводок]
	По умолчанию, между разделами базы данных документы общих бухгалтерских проводок не
	передаются. Если вы хотите, чтобы все, либо некоторые общие проводки все-таки передавались,
	то в записи раздела, в который должны передаваться такие проводки, следует указать через
	запятую счета, проводки по которым следует передавать. Если следует передавать все документы
	общих бухгалтерских проводок, то в этом поле проставьте символ *.

	\item[Подчиненные склады]
	Список складов, за которые отвечает этот раздел. Если список пустой, то раздел отвечает за
	все склады. Ответственность по складу подразумевает то, что в этот раздел должны попадать
	документы, изменяющие остаток по складу. Если раздел не отвечает за некоторый склад, то в
	этот раздел не попадают документы этого склада из других разделов. Внутреннее перемещение
	со склада, за который раздел не отвечает на склад, за который раздел отвечает, принимается
	как межскладской приход с контрагентом, соответствующим складу-отправителю.

	\item[\dlgflag{Диспетчерский раздел}]
	На момент написания главы, этот признак влияет только на обмен данными по дисконтным картам.
	Диспетчерский раздел не принимает изменения дисконтных карт, но принимает обороты по ним из
	других разделов.

	\item[\dlgflag{Обмен только по пластиковым картам}]
	Если этот флаг установлен, то между разделами осуществляется обмен только объектами,
	связанными с дисконтными картами. Этот признак применяется крайне редко и в розничных
	сетях, между разделами которых нет полной синхронизации данных, но необходимо воспользоваться
	механизмом разделенных баз данных для обмена информацией о скидках, оборотах (и остатках) по
	дисконтным (кредитным) картам.

	\item[\dlgflag{Принимает кассовые сессии вместе с документами списания}]
	Специализированный флаг, отменяющий существенный принцип обмена данными по кассовым сессиям
	\qu{или сессия или документы списания}. Суть этого принципа в том, что если одновременно из
	магазина в другой раздел (офис, например) передается и кассовая сессия и документы ее
	списания, то возникает риск дублирования информации: принятую сессию могут списать в офисе и
	тогда у принятых документов списания появятся дубликаты.

	Если, по каким-либо причинам, вам необходимо принимать и кассовые сессии и документы их
	списания, то установите этот флаг. Во избежание описанной выше проблемы в конфигурации
	оборудования можно установить флаг \dlgflag{Закрывать кассовые сессии до 10-го уровня}
	(в случае, если принимающий раздел базы данных должен списывать собственные кассовые
	сессии, такой трюк не сработает).

	\item[\dlgflag{Принимает документы без товарных строк}]
	Эта опция предназначена для так называемого консолидированного учета. Если флаг установлен,
	то все товарные документы принимаются без товарных строк, но с зафиксированными суммами. В
	результате, раздел, принимающий такие документы, будет иметь информацию о финансовой стороне
	деятельности филиалов, но не видит (не хочет видеть) детализации на уровне движения товаров.

	\item[\dlgflag{Пассивный}]
	Если этот флаг включен, то эта запись раздела базы данных не будет видна в списках выбора.
	Устанавливать флаг следует в том случае, если вы не планируете более пользоваться этим
	разделом базы данных.
\end{description}

\section{Синхронизация разделенных баз данных}

Синхронизация разделенных баз данных состоит из процессов передачи и приема данных.
Мы начнем с объяснения процессов передачи данных в другой раздел, которые намного сложнее
и многообразнее процесса приема данных из других разделов.

\subsection{Передача данных в другие разделы}

Существуют следующие способы передачи данных из текущего раздела в другие:
\begin{enumerate}
	\item Передача измененных объектов
	\item Специализированная передача документов
	\item Передача из системного журнала
	\item Передача из таблиц просмотра объектов.
	\item Передача с использованием сервера задач
\end{enumerate}

Опишем каждый из этих методов подробно.

\subsubsection{Передача измененных объектов}

\ppypict{dlg-tranmod}{Перенос измененных объектов}

Передача изменений является наиболее общим методом отсылки данных в другие разделы. При
этом система передает в разделы-получатели все объекты, типы которых перечислены в списке
и которые изменились либо были добавлены с указанного момента времени.
При этом соблюдаются общие ограничения для передачи объектов, справедливые во всех случаях
(учитывается ответственность разделов по складам, признак диспетчерского раздела и т.д.).
Функцию передачи изменений следует использовать как основной инструмент регулярного обмена
данными. Для ее вызова обратитесь к пункту меню
\ppymenu{Админ\rdir Обмен данными\rdir Передать изменения}.

Диалог, предшествующий запуску функции на выполнение приведен на рис.~\ref{pic-dlg-tranmod}.
Разберем управляющие элементы этого диалога.

\begin{description}
	\item[Передать изменения с (дата, время)]
	Дата и время момента, начиная с которого следует отслеживать измененные или созданные
	объекты для передачи их в другие разделы.
	При выборе раздела-получателя программа просматривает системный журнал в поисках
	последнего события передачи изменений в этот раздел. Если такое событие обнаружено, то
	в рассматриваемых полях автоматически указывается дата и время этого события.

	\ppynote{
		Не следует всегда полагаться на автоматически указываемое время так как, во-первых, в
		тот раз могли не передаваться изменения по типам объектов, которые вы хотите передать
		сейчас, а, во-вторых, прошлая передача данных могла оказаться безуспешной.
		Дата изменения (создания) объекта определяется по системному журналу.
	}

	\item[\dlgflag{Очищать источник}]
	Если этот флаг установлен и, в соответствии с настройками раздела-получателя, файлы
	передачи должны либо копироваться на дисковый каталог, либо передаваться по электронной
	почте, то после копирования сформированные файлы будут удалены из каталога OUT (системного
	каталога исходящих файлов).

	\item[\dlgflag{Очищать приемник}]
	Если этот флаг установлен и, в соответствии с настройками раздела-получателя, файлы
	передачи должны копироваться на дисковый каталог, то перед копированием из этого каталога
	будут удалены все файлы имеющие расширение PPS.

	\item[Список \qu{Разделы БД}]
	Список разделов, в которые следует передать объекты. Вы можете выбрать здесь любое
	количество разделов-приемников.
	Для того чтобы добавить раздел-получатель, нажмите кнопку \dlgbutton{Добавить}.
	При этом на экране появится диалог, содержащий два списка: в левом перечислены
	все зарегистрированные в базе данных разделы, а в правом - те, в которые вы
	хотите передать данные. Выбор текущего раздела игнорируется.

	\item[Список \qu{Передавать объекты}]
	Список типов объектов, которые необходимо обработать. Здесь можно выбрать любое количество
	типов объектов.

	Для выбора всех возможных типов объектов нажмите кнопку \dlgbutton{Добавить} и в появившемся диалоге
	нажмите кнопку \dlgbutton{>>}.
	В результате все записи из левого списка попадут в правый список типов объектов для передачи.
	\ppynote{
		Указание типа объекта для передачи в этом списке не отменяет ограничения на передачу данных
		между разделами. Так, записи электронных весов и некоторых других типов объектов в принципе
		не передаются между разделами, хотя этот список позволяет выбрать такие типы объекты.
	}

	\item[\dlgflag{Передать информацию о синхронизации}]
	Этот флаг предписывает системе передать информацию о синхронизации в другой раздел для
	сравнения синхронизации объектов и разрешения конфликтов синхронизации.
	Тема разрешения конфликтов синхронизации обсуждается ниже.
\end{description}

\subsubsection{Специализированная передача документов}

Так как для многих организаций документы являются центральным объектом учета, в систему
включена отдельная функция передачи документов за определенный период. Если не считать
специальных и крайне редко используемых опций, эта функция является избыточной и
перекрывается другими методами передачи объектов. По этому, в общем случае, использование
специализированной передачи документов не рекомендуется.
Доступ к этой функции осуществляется через пункт меню
\ppymenu{Админ\rdir Обмен данными\rdir Передать документы}.

\ppypict{dlg-tranbill}{Перенос документов}

Диалог параметров функции показан на рис.~\ref{pic-dlg-tranbill}.
Он содержит следующие управляющие элементы.

\begin{description}
	\item[Период]
	Период, за который следует передать документы в другой раздел (разделы).

	\item[Вид операции]
	Если выбран вид операции, то переданы будут только документы, принадлежащие этому виду
	операций. Выбранный здесь вид операции может быть обобщением.

	\item[Преобразовать в]
	Специальная опция, позволяющая преобразовать вид операции переданных документов в выбранный
	здесь вид. Эта опция доступна только в том случае, если выбран вид операции, описанный выше.
	Обращаем особое внимание на то, что функция преобразования вида операции передаваемых
	документов является весьма сложной и предназначена для решения узкоспециализированных
	задач. По этому не используйте ее без консультаций со специалистами, занимающимися
	техническим сопровождением системы на вашем предприятии.

	\item[\dlgflag{Очищать источник}]
	Если этот флаг установлен и, в соответствии с настройками раздела-получателя, файлы передачи
	должны либо копироваться на дисковый каталог, либо передаваться по электронной почте, то
	после копирования сформированные файлы будут удалены из каталога OUT (системного каталога
	исходящих файлов).

	\item[\dlgflag{Очищать приемник}]
	Если этот флаг установлен и, в соответствии с настройками раздела-получателя, файлы
	передачи должны копироваться на дисковый каталог, то перед копированием из этого каталога
	будут удалены все файлы имеющие расширение PPS.

	\item[Список \qu{Разделы базы данных}]
	Список разделов, в которые следует передать объекты. Вы можете выбрать здесь любое
	количество разделов-приемников.

	Для того чтобы добавить раздел-получатель, нажмите кнопку \dlgbutton{Добавить}. При этом на
	экране появится диалог, содержащий два списка: в левом перечислены все зарегистрированные
	в базе данных разделы, а в правом - те, в которые вы хотите передать данные.
	Выбор текущего раздела игнорируется.

\end{description}

\subsubsection{Передача из таблиц просмотра объектов\label{sec-dbxchg-sendbyppview}}

Многие таблицы просмотра объектов данных (документы, товары, персоналии и т.д.), а также
некоторые списки просмотра объектов (группы товаров, товарные корзины и т.д.) предоставляют
сервис передачи выборки объектов в другие разделы. В таблицах для этого служит комбинация
клавиш \keyb{Ctrl-H}, в списках - кнопка \dlgbutton{Передать}.
При выборе такой команды на экране появляется диалог передачи объектов. Этот диалог аналогичен
диалогу передачи измененных объектов за исключением того, что вместо указания даты и времени,
начиная с которых следует передавать изменения, содержит переключатель \qu{Протокол изменения
объектов в разделе-адресате}.
Остановимся на этом моменте.

Протокол изменения объектов может иметь одно из трех значений:

\begin{description}
	\item[Не изменять]
	Этот вариант предписывает системе принять в разделе-приемнике только новые объекты (то есть
	те, которых в том разделе нет). Никакие из уже синхронизированных объектов при этом не
	меняются.

	\item[В соответствии со временем модификации]
	При выборе этого варианта раздел-приемник создает у себя недостающие объекты, а для тех
	объектов, которые уже синхронизированы, сравнивает время изменения объекта в
	разделе-отправителе и у себя. Если в отправителе объект был изменен позже, чем приемнике,
	то объект изменяется, в противном случае - нет.

	\item[Безусловное обновление объектов]
	При выборе этого варианта переданные объекты изменяются в разделе приемнике независимо
	от времени изменения в отправителе.

\end{description}

В связи с вышесказанным, следует обратить внимание на следующие особенности поведения
системы:
\begin{itemize}
	\item 	Указанные правила не отменяют ограничения, установленные правами доступа
	пользователей на изменения объектов.
	\item 	Некоторые правила изменения объектов регламентируются отдельно (например,
	правило изменения налоговой группы товаров при приеме данных из других разделов).
	\item 	Для типов объектов, которые система не изменяет при приеме данных, безразлично
	как определен протокол изменения.
\end{itemize}

\subsubsection{Передача из системного журнала}

Еще один способ передачи объектов состоит в выборе команды передачи данных из таблицы
просмотра системного журнала с опцией фильтрации \qu{Показывать объекты}.
Подробнее эта команда рассматривается в разделе, посвященном системному журналу.

\subsection{Прием данных из других разделов}

\ppypict{dlg-095}{Прием данных из других разделов}

Для приема данных из других разделов выберите пункт меню \ppymenu{Админ\rdir Обмен данными\rdir Принять почту}.
На экране появится диалог, изображенный на рис.~\ref{pic-dlg-095}.
Этот диалог содержит следующие управляющие элементы

\begin{description}
	\item[Переключатель опции извлечения файлов обмена данными из внешнего источника]
	Этот переключатель активен, если текущий раздел настроен на прием данных из внешнего
	каталога или для каких-либо разделов, из которых могут быть получены данные, определены
	адреса электронной почты.
	Варианты выбора работают следующим образом:

	\begin{itemize}
 		\item	Забрать данные из внешнего источника, очистив приемник: внешние источники данных
 		проверяются на наличие файлов обмена данными и, если такие обнаружены, то они копируются
 		во входящий каталог. Входящий каталог предварительно очищается.
		\item	Забрать данные из внешнего источника: то же самое, что и предыдущий вариант, за
		исключением того, что входящий каталог предварительно не очищается.
		\item	Система не пытается забрать данные из внешнего источника, но обрабатывает файлы
		данных, находящиеся в каталоге входящих файлов.
	\end{itemize}

	\item[\dlgflag{Очистить приемник после приема данных}]
	Если вы установите этот флаг, то после обработки файлов передачи данных система удалит их
	из каталога входящих файлов.

	\item[\dlgflag{Непосредственная фиксация транзакции}]
	Если этот флаг установлен, то сразу после занесения объектов из принятых файлов данных в
	очередь синхронизации, система запустит процесс фиксации транзакции синхронизации.
	Этот флаг устанавливается по умолчанию, если в конфигурации обмена данными не установлен
	признак \qu{Отложенная фиксация транзакции по умолчанию}.

	\item[\dlgflag{Очистить очередь после фиксации транзакций}]
	Если этот флаг установлен, то очередь синхронизации будет очищена после фиксации транзакции
	независимо от того, остались ли необработанные объекты или нет. Если вы не установите этот
	флаг и при фиксации не все объекты были правильно обработаны, то очередь не будет очищена
	до тех пор, пока не будут правильно обработаны все объекты, находящиеся в очереди.
	Если в конфигурации обмена данными установлен признак \qu{Очистка очереди после фиксации по
	умолчанию}, то рассматриваемый флаг будет устанавливаться по умолчанию.

	\item[Список разделов, из которых следует принять данные]
	Вы можете перечислить здесь те разделы, из которых системе следует принимать данные. Файлы
	данных из других разделов не обрабатываются и из каталога входящих файлов не удаляются.
	\ppynote {
		Так как для текущего раздела из всех разделов по электронной почте файлы шлются на один
		и тот же адрес электронной почты либо внешний каталог обмена данными, то в каталог
		входящих файлов эти файлы попадут независимо от того, перечислили вы разделы-отправители
		в этом списке или нет. Перечисление сказывается только на обработке этих файлов.
	}
\end{description}

Во время приема данных в нижней части экрана появляется информационное окно, в котором
высвечиваются сообщения о ходе процесса. В этом же окне отображаются сообщения об ошибках
приема данных. После завершения процесса сообщения из этого окна копируются в файл журнала
LOG/DBXRECV.LOG.
Функция приема данных является эксклюзивной. Это значит, что система блокирует возможность
вызова этой функции, если какой-либо иной сеанс уже запустил ее.

\subsection{Просмотр очереди приема объектов}

Таблица просмотра очереди синхронизации позволяет анализировать содержимое очереди, а также
выполнить действия по управлению ею.
Доступ к этой таблице осуществляется из пункта меню  \ppymenu{Админ\rdir Обмен данными\rdir Очередь синхронизации}.

\ppypictsc{brw-025}{Очередь синхронизации}{0.4}

\paragraph{Принять данные (фиксировать транзакцию)}\indent\keyb{F8}
Вызывает диалог приема данных из других разделов.
Эта функция полностью аналогично обращению к пункту меню
\ppymenu{Админ\rdir Обмен данными\rdir Принять почту}.
Единственное (положительное) отличие заключается в том, что вы сможете сделать это наблюдая
за очередью синхронизации.

\paragraph{Очистить очередь}\indent\keyb{Ctrl-F8}
Полностью очищает очередь синхронизации. Перед выполнением этой функции система
запрашивает подтверждение.

\paragraph{Фильтр}\indent\keyb{Ctrl-V}Просто обновляет содержимое таблицы.

\section{Разрешение проблем}

При приеме данных из других разделов возможно возникновение ряда проблем, которые можно
разделить на следующие группы:
\begin{itemize}
 	\item Дефицит учетных остатков на складе, по которому принимаются расходные документы
	\item Нарушение синхронизации объектов
\end{itemize}
Разберем каждую группу проблем

\subsection{Дефицит учетных остатков}

Этот конфликт возникает в том случае, если при приеме расходного документа в базе-приемнике
не хватает учетных остатков для проведения документа.
Система выдает исчерпывающую диагностику этих проблем при приеме данных.
Если рассматриваемый дефицит не является штатной ситуацией (такие ситуации будут описаны
ниже), то наиболее правильным выходом из ситуации является сведение учетных остатков по
дефицитным позициям с разделом отправителем. Для этого хорошо подходит анализ товарных
операций по дефицитному товару и по складу, по которому не удается провести расход.
Более грубым (и, соответственно, менее правильным) методом борьбы с таким дефицитом является
автоматический форсированный приход недостающих позиций. Для этого в системе предусмотрена
специализированная опция: в конфигурации обмена данными установите флаг \dlgflag{Приходовать
итоговый дефицит}. Одновременно в общих настройках (\ppymenu{Админ\rdir Настройки\rdir Операции})
должен быть установлен вид операции \qu{Приход от поставщика}, который будет использован
для приходования дефицитных позиций.

\subsection{Нарушение синхронизации объектов}

Как уже упоминалось выше, разделы базы данных изменяются независимо друг от друга. В связи с
этим, иногда возможны ситуации рассогласования взаимной синхронизации объектов между
разделами. Хотя такие события возникают не часто, они могут значительно осложнить работу с
системой.

Наиболее \qu{изученным} является случай неправильной синхронизации объектов. То есть, системная
синхронизация зафиксировала связь объекта в одном разделе с объектом, совершенно не
соответствующим этому, в другом разделе. Например, товар \qu{Творог Крестьянский} в разделе
$A$ соответствует товару \qu{Вермишель ажурная} в разделе $B$.

Известным симптомом неправильной синхронизации может быть невозможность принять объект
(например, документ или кассовую сессию) в раздел-получатель, несмотря на видимое отсутствие
причин для этого.

\subsection{Сравнение синхронизации объектов}

\ppypictsc{brw-026}{Анализ синхронизации объектов}{0.4}

В системе предусмотрен специализированный инструмент для анализа синхронизации. Этот
инструмент позволяет сравнить правильность синхронизации различных объектов между двумя
разделами базы данных. Общий порядок использования сравнения синхронизации следующий:
\begin{itemize}
	\item Из одного раздела в другой передается выборка объектов с установленным признаком
	\dlgflag{Передать информацию о синхронизации}
	\item В разделе-приемнике запускается функция \qu{Анализ синхронизации объектов}. Если
	раздел-приемник обнаружит файлы с переданной информацией о синхронизации, то на экране
	будет показана таблица сравнения синхронизации.
\end{itemize}

\paragraph{Просмотр объекта}\indent\keyb{Enter}
Показывает свой объект, соответствующий выбранной строке

\paragraph{Удалить информацию о синхронизации  объекта (по общему ид-ру)}\indent\keyb{Delete}
Удаляет информацию о синхронизации, соответствующую выбранной строке.
Это действие может потребоваться для устранения неверной синхронизации (обычно при коде
ошибки 2 и низкой величине сравнения наименований своего и чужого объектов).

\paragraph{Удалить информацию о синхронизации по всей выборке}\indent\keyb{Ctrl-F8}
Удаляет информацию о синхронизации по всей выборке, определенной текущим фильтром.
Будьте очень внимательны: не используйте эту функцию, если четко не представляете ее
последствий!

\paragraph{Положить товар в корзину}\indent\keyb{Ctrl-F4}
Если текущая строка соответствует объекту \qu{Товар}, то функция позволяет добавить этот
товар в выбранную корзину.

\paragraph{Печать}\indent\keyb{F7}
Отправляет на печать выборку анализа синхронизации.

\paragraph{Итоги}\indent\keyb{F9}
Показывает итоги по выборке анализа.

\paragraph{Фильтр}\indent\keyb{Ctrl-V}
Позволяет изменить параметры фильтрации выборки.

\subsubsection{Виды ошибок синхронизации}

\begin{description}
	\item[0] Объекты синхронизированы правильно
	\item[1] В таблице синхронизации не найден общий идентификатор, переданный с объектом
	для сравнения.
	Следовательно, в нашей базе данных отсутствует какая-либо информация о синхронизации
	этого объекта (вероятнее всего, он был создан в другом разделе и к нам никогда не
	передавался).
	\item[2] Таблица синхронизации имеет правильные записи по этому объекту, но
	наименования объектов различаются. Уровень соответствия наименований указан
	отдельной колонкой в отчете.

	Если уровень соответствия близок к нулю, то чаще всего это указывает на полностью
	неправильную синхронизацию объектов между разделами. В любом случае, для окончательного
	принятия решения о том, правильная синхронизация или нет, следует внимательно посмотреть
	на свое и чужое наименования объектов.

	\item[3] Информация о синхронизации по объекту в разделе-отправителе отличается от
	нашей информации (собственный идентификатор в нашей базе имеет не то значение,
	которое для него установлено в разделе-отправителе).

	На человеческом языке это означает примерно следующее \qu{Другой раздел думает о нас не то,
	что есть на самом деле}. Как правило, это не является большой проблемой.
	К сожалению, большей проблемой является то, что эта ошибка \qu{маскирует} другие возможные
	ошибки с кодом 2. То есть, если есть и ошибка 2 и ошибка 3, то в отчете показывается 3.

	\item[4] Информация о синхронизации объекта в таблице есть, но системе не удалось найти
	сам объект в своей базе данных. Этот вид ошибки возникает крайне редко из-за того,
	что при удалении объекта информация о синхронизации по нему корректируется соответствующим
	образом.
\end{description}

\section{Конфигурация обмена данными\label{sec-dbxchg-cfg}}

\subsection{Основная конфигурация обмена данными}

Доступ к конфигурации обмена данными возможен через меню \ppymenu{Админ\rdir Прочие конфигурации\rdir Конфигурация обмена данными}.

Обращаем ваше внимание на то, что эта конфигурация определяет не все опции обмена данными.
Некоторые особенности синхронизации заданы в других разделах конфигурации системы.
Символ ! в левой колонки помечает наиболее существенные, с точки зрения воздействия на базу
данных, опции.

\ppypict{dlg-059}{Конфигурации обмена данными}

\begin{description}
	\item[! \dlgflag{Не принимать неполные документы}]
	Если этот флаг установлен, то полученные товарные документы, которые не могут быть списаны
	из-за дефицита в учетных остатках, не будут приняты в разделе-получателе.
	Если флаг не установлен, то система примет неполный документ.
	В общем случае настоятельно рекомендуется устанавливать эту опцию.

	\item[\dlgflag{Рассчитывать итоговой дефицит товаров}]
	При включенном флаге, система рассчитает итоговый дефицит по всем полученным документам.
	Опция не только полезна для анализа проблем с расхождением остатков между
	разделом-отправителем и разделом-получателем, но и используется системой для более сложной
	обработки такого дефицита.

	\item[! \dlgflag{Приходовать итоговый дефицит}]
	Установив этот флаг, вы  \qu{заставите} систему автоматически генерировать документы прихода
	на весь дефицит по полученным из другого раздела документам.
	Фактически, опция решает проблему расхождения остатков между разделами  \qu{через колено}.
	По этому, мы не рекомендуем ею пользоваться. Правильнее решать проблемы с расхождениями
	остатков на уровне отдельных товарных позиций.
	Существует одна,  \qu{законная} причина, по которой эту опцию следует включать: если вы
	используете обмен данными между разделами с целью  \qu{раздвоения} учета. То есть, в одной
	базе данных ведете управленческий учет, а в другой (реплике) принимаете расходные
	документы, а приходные документы под принятый расход система генерирует автоматически.

	\item[\dlgflag{Связывать возвратные документы}]
	Как правило, этот флаг должен быть установлен.
	Если нет, то документы привязанных возвратов будут приниматься без ссылки на документы,
	с которыми они связаны в базе отправителе.

	\item[\dlgflag{Не обрабатывать пакеты подтверждений}]
	Установка этой опции запретит системе обрабатывать файлы подтверждения приема, поступившие
	от других разделов.
	В общем случае, включать флаг не следует. Однако практика показывает, что отсутствие
	пакетов подтверждений, несмотря на то, что они являются частью протокола обмена, не
	оказывает значительного влияния на правильность работы разделенных баз данных.

	\item[\dlgflag{Двухпроходная обработка приема}]
	Применяется при включенном признаке \dlgflag{Приходовать итоговый дефицит}. Если флаг включен,
	то система, после расчета итогового дефицита автоматически повторит прием данных для
	акцепта расходных документов, которые не были приняты из-за дефицита.

	\item[! \dlgflag{Передавать документы списания ревизии}]
	Если этот флаг включен, то текущий раздел базы данных будет передавать в другие разделы
	документы списания инвентаризации.
	В противном случае такие документы передаваться не будут.
	Почему существует необходимость в регламенте передачи документов инвентаризации?
	В общем случае, учетные остатки по одному и тому же складу в разных разделах могут
	отличаться. Документ инвентаризации сам по себе является документальным подтверждением
	фактических остатков. При его списании в том разделе, где он создан, учетные остатки
	приводятся в соответствие фактическим остаткам.
	Далее, при передаче документа инвентаризации в другой раздел, раздел-получатель акцептирует
	информацию о фактических остатках на удаленном складе. После списания этой инвентаризации в
	разделе-получателе остатки по складу в обоих разделах придут в соответствие друг с другом.
	Если, вслед за документом инвентаризации, прибудут документы списания инвентаризации из
	раздела-отправителя, то в разделе-получателе произойдет  \qu{дублирование} списания одной и той
	же инвентаризации (собственные документы списания плюс документы списания из раздела-отправителя).
	Из-за описанных причин обычно данный флаг устанавливать не следует.
	И только тогда, когда вам почему-либо необходимо передать документы списания инвентаризации,
	этот флаг можно снять (при этом следует помнить про обрисованную выше проблему).

	\item[! \dlgflag{Не принимать изменения товаров}]
	Установка этой опции запретит системе принимать какие-либо изменения в товарах из других
	разделов.

	Использовать этот флаг следует только тогда, когда существует действительная необходимость
	запретить другим разделам базы данных изменять объекты справочника товаров в вашем разделе.
	Хотя, установив опцию, вы можете быть  \qu{спокойны} за изменения, вносимые вами и другими
	пользователями вашего раздела в справочник товаров, существует опасность \qu{рассинхронизации}
	этого справочника между вашим разделом и теми разделами, в которых пользователи могут
	модифицировать товары.
	\ppynote{
		Описанная опция не препятствует созданию в вашем разделе базы данных товара, созданного в
		другом разделе и переданного (возможно вместе с каким-либо иным объектом данным, скажем,
		товарным документом) к вам.
	}

	\item[\dlgflag{Контекстная синхронизация видов операций}]
	Если флаг установлен, то система, при приеме нового вида операции из другого раздела,
	прежде чем создать его копию в базе данных, попытается найти контекстный аналог ей.
	Аналоги ищется по следующим критериям: совпадение имени, совпадение типа операции и
	совпадение таблицы аналитических статей.

	В общем случае, можно рекомендовать устанавливать эту опцию, поскольку отрицательные
	побочные эффекты от нее крайне маловероятны.
	Когда она действительно необходима, так это в случаи независимого создания одного и того
	же (по смыслу) вида операции в разных разделах. Если это флаг не будет установлен, то в
	результате, в каждом из разделов возникнет по два, фактически одинаковых вида операции.
	Более того, в дальнейшем произойдет  \qu{раздвоение} документов, относящихся к этим видам
	операций.

	С другой стороны, даже если этот флаг включен, при независимом заведении видов операций
	следует давать им абсолютно идентичные наименования, иначе система не зафиксирует их
	эквивалентность.

	\item[! \dlgflag{Передавать карточки без чеков}]
	Эта опция предписывает системе передавать в другой раздел дисконтные карты так, как
	они есть.

	Если опция не установлена, то дисконтные карты будут  \qu{тянуть} за собой список всех
	кассовых чеков, которые связаны с этими картами.
	В чем смысл такого поведения? Если диспетчерский раздел (отвечающий за администрирование
	дисконтных и кредитных карт) не получает из других полные кассовые сессии со всеми чеками,
	то единственный способ для него правильно проанализировать обороты по картам и избежать
	коллизий в суммах этих оборотов - видеть чеки, сформировавшие эти обороты. Именно для
	этого базовый механизм системы предусматривает передачу вместе с дисконтными (кредитными)
	картами и чеки.

	Вам следует включить рассматриваемый флаг, если ваш раздел передает в другие разделы
	кассовые сессии. В этом случае, отсутствие флага может привести к дублированию оборотов
	по картам (см. опцию \qu{Передавать кассовые сессии}).

	\item[\dlgflag{Не преобразовывать скидки на документы}]

	\item[! \dlgflag{Передавать кассовые сессии}]
	Установив этот флаг, вы разрешите системе передавать кассовые сессии в другие разделы.
	По умолчанию, кассовые сессии не передаются в другие разделы из-за того, что, во-первых,
	они имеют локальное значение (то есть, офису или другому магазину может быть безразлично,
	какие кассовые чеки пробиты в этом магазине), а, во-вторых, кассовые сессии являются
	довольно громоздким объектом в связи с тем, что объединяют в себе все чеки по всем
	кассовым узлам магазина.

	Во многих случаях, удаленный офис, отвечающий за работу магазина, вполне удовлетворяется
	получением документов списания по кассовым сессиям из этого магазина.
	Если же вы хотите, чтобы офисный и (или) другие разделы получали кассовые сессии, то
	установите этот флаг. При этом система запретит передачу документов списания кассовых
	сессий в другие разделы, чтобы избежать проблемы дублирования документов списания по
	сессиям (этот запрет может быть отменен установкой признака  \dlgflag{Принимает кассовые сессии
	вместе с документами списания} в записи раздела-получателя).

	\item[\dlgflag{Упаковывать файл перед отправкой}]
	Эта опция обеспечивает сжатие файлов передачи данных перед отправкой в другой раздел.
	Благодаря ей, вы можете уменьшить трафик при передаче файлов обмена данными.

	\item[\dlgflag{Игнорировать объединенные объекты}]
	Если флаг включен, то система не пытается идентифицировать пришедший из другого
	раздела и отсутствующий в этом разделе объект как объединенный.
	Подробнее см. обсуждение синхронизации объединенных объектов выше.

	\item[\dlgflag{Суммировать дубл строки инвентаризации}]
	Флаг актуален при обмене данными по документам инвентаризации.
	Причину существования этого флага проще всего объяснить на примере:

	\begin{itemize}
		\item 	в офисе товары $A$ и $B$ были объединены
		\item 	в магазине ввели документ инвентаризации, в который попали и товар $A$ и товар $B$
		\item 	инвентаризация передана из магазина в офис
		\item 	так как в документах инвентаризации исключено дублирование одного товара более чем
	в одной строке, то при приеме в офисе, система выдает сообщение об ошибке. Не смотря
	на то, что это сообщение весьма  \qu{интеллигентное}, (то есть, такая ошибка не препятствует
	приему документа), офис  \qu{не досчитается} в документе одной строки.
	\end{itemize}
	Если вы установите рассматриваемый флаг, то, возвращаясь к нашему маленькому примеру,
	система примет строки по товарам  А и Б как одну строку, в которой фактическое количество
	равно сумме соответствующих значений по строкам оригинального документа.

	\item[! \dlgradioc{Порядок списания}]

	Этот переключатель позволяет переопределить порядок списания лотов при приеме расходных
	товарных документов.

	\begin{itemize}
		\item \dlgradioi{По умолчанию}
		\item \dlgradioi{FIFO}
		\item \dlgradioi{LIFO}
	\end{itemize}

	Значение \qu{По-умолчанию} означает, что будет использован порядок списания, заданный в
	конфигурации.

	Причина, по которой может понадобиться переопределить порядок списания лотов, кроется в
	том, что документы из разделов-отправителей могут передаваться не в хронологическом порядке.
	Например, сначала переданы документы за 20 августа, а потом за 15 августа. В этом случае,
	если основная конфигурация предполагает порядок списания лотов FIFO, то более поздний
	расходный документ может \qu{съесть} остаток по лотам, который в разделе-отправителе,
	использовался для более ранних документов.

	Теперь, когда придут документы за 15 августа, им не достанется остатка из предшествующих
	лотов, а более поздние лоты они использовать не могут в силу принципа недопущения алогичных
	товарных операций.

	Для предупреждения этой коллизии вы можете этим переключателем установить порядок
	использования лотов как LIFO (однако, надежнее будет наладить порядок передачи документов
	из других разделов  \qu{день-в-день}).

	\item[! \dlgcombo{Все документы принимать на один склад}]
	Специальная опция. Если не знаете, зачем вам это надо, то не устанавливайте в этом
	комбо-боксе ничего.

	Результатом выбора здесь какого-либо склада будет то, что все товарные документы, которые
	ваш раздел получает из других разделов, будут акцептироваться на выбранном складе независимо
	от того, какому складу они принадлежать в разделе-отправителе.

	\item[\dlgcombo{Вид операции для приходования дефицита}]
	Если включен флаг \dlgflag{Приходовать итоговый дефицит} и в этом комбо-боксе установлен вид
	операции, то эта операция будет использована для создания документов прихода, компенсирующих
	дефицит, возникающий при синхронизации.

	Если здесь вид операции не определен, то применяется вид операции прихода товаров от поставщика,
	заданный в общих настройках (стр.~\pageref{sec-commcfg-op}).

	Здесь может быть выбран вид операции, относящийся к типу \ppyrsrv{Приход товара} и имеющий таблицу
	статей поставщиков (такую же, как и регулярная операция поступления товара от поставщика).

	\item[\dlgflag{Процент наценки для дефицита}]
	Специальная опция.

	Используется при автоматическом приходовании дефицита по принятым расходным документам и
	двухпроходной обработке приема (см. опции  \dlgflag{Приходовать итоговый дефицит} и
	\dlgflag{Двухпроходная обработка приема}).

	Если в этом поле указана ненулевое значение, то система будет формировать приходные документы
	с ценой поступления, отличной от чистой цены реализации в расходных документах на величину
	указанной наценки.

	\item[\dlgflag{Цена реализации равна цене поступления}]
	Эта опция относится к обработке пакетом обмена по технологии Charry. Если флаг установлен,
	то в принимаемых документах цена реализации будет устанавливаться равной цене поступления,
	заданной во входящем документе. В противном случае, система будет пытаться извлечь цену
	реализации из последнего лота соответствующего товара.

	\item[\dlgflag{Подстановка дефицитного товара}]

	\item[\dlgflag{Отложенная фиксация транзакции по умолчанию}]
	Этот флаг влияет только на диалог приема данных их других разделов.
	Если он установлен, то в этом диалоге не будет устанавливаться флаг
	\dlgflag{Непосредственная фиксация транзакции}.

	\item[\dlgflag{Очистка очереди после фиксации по умолчанию}]

	\item[\dlgflag{Не показывать информацию об изменении объектов}]

	\item[\dlgflag{Передавать с тегами прикрепленные файлы}]
	Если флаг установлен, то при передаче объектов в другой раздел, файлы, связанные с тегами
	передаваемых объектов так же передаются. Это может увеличить объем файлов обмена, но
	в большинстве случаев рекомендуется устанавливать данный флаг.

\end{description}

\subsection{Конфигурация глобального обмена}
	\ppypict{dlg-cfg-glbchange}{Конфигурация глобального обмена}
	Далее следует потрясающее описание диалога, который можно обнаружить \ppymenu{Админ\rdir Прочие конфигурации\rdir Конфигурация глобального обмена}.



	\begin{description}
		\item[\dlgcombo{Вид операции заказа}]
		\item[\dlgcombo{Почтовая учетная запись}]
		\item[Параметры Universe-HTT]
		\begin{description}
			\item[URN сервисов Universe-HTT]
			\item[Префикс URL сервисов Universe-HTT]
			\item[Аккаунт Universe-HTT]
			\item[Пароль аккаунта Universe-HTT]
		\end{description}

		\item [\dlgcombo{Учетная запись СМС-клиента}]
		\item [\dlgcombo{Адрес сервера обмена ЕГАИС}]
		\item [Параметры EDI]
		\begin{description}
			\item [\dlgcombo{Вид операции ORDER}]
			\item [\dlgcombo{Вид операции ORDERSP}]
			\item [\dlgcombo{Вид операции DESADV}]
			\item [\dlgcombo{Вид операции прихода от поставщика через ЕГАИС}]
			\item [\dlgcombo{Вид операции возврата от покупателя через ЕГАИС}]
			\item [\dlgcombo{Тэг номера документа подтверждения}]
			\item [\dlgcombo{Тэг номера TTH}]
		\end{description}
		\item [\dlgflag{Не принимать документы с неразрешенными компонентами}]
		\item [\dlgflag{Вычисление рассогласований RECADV - по корректирующим документам}]
	\end{description}







\chapter{Импорт и экспорт данных\label{ch-impexp}}

\section{Унифицированная конфигурация форматов импорта/экспорта}

Унифицированный механизм настройки импорта/экспорта предоставляет возможность обмена
данными с другими программами посредством файлов, представленных в различных формах. Этот
механизм реализован для части объектов данных, используемых системой. Сюда входят:
\begin{itemize}
 	\item Товарные документы
	\item Платежные поручения (при импорте - выписка банка)
	\item Прайс-лист
	\item Строки инвентаризации (только импорт)
\end{itemize}

Унифицированная конфигурация импорта/экспорта позволяет использовать следующие форматы файлов:
\begin{itemize}
	\item DBF
	\item Текстовый (предусмотрен целый ряд опций, позволяющих настроить систему на подавляющее
	большинство вариантов текстовых представлений данных)
	\item XML
\end{itemize}

\subsection{Общие принципы работы и структура унифицированных конфигураций импорта/экспорта}

\ppypictsc{schema-impexpcfg}{}{0.4}

Конфигурация импорта/экспорта хранится в текстовом файле bin/impexp.ini.
Структура конфигурации содержит следующие атрибуты:
\begin{itemize}
	\item Наименование
	\item Направление передачи данных (импорт или экспорт)
	\item Путь к файлу импорта/экспорта
	\item Тип формата файла
	\item Параметры формата
	\item Список соответствия полей
	\item Дополнительный опции, определяемые конкретной областью использования конфигурации
\end{itemize}
Наиболее сложной и трудоемкой для определения частью конфигурации является список соответствия
полей. Этот список задает связь между каждым полем во входном (выходном) файле и внутренним
полем, предоставляемым системой для обмена данными.
Для каждой области использования конфигураций импорта/экспорта определен собственный набор
внутренних полей данных, по которым может осуществляться обмен.

Например, конфигурация импорта/экспорта заголовков товарных документов содержит внутренние
поля:
\begin{itemize}
	\item 	Ид документа
	\item 	Номер документа
	\item 	Дата
	\item 	ИНН контрагента
	\item 	Имя контрагента
	\item 	Код контрагента
	\item 	и т.д.
\end{itemize}
Вы можете установить соответствие каждому или некоторым из этих полей в полях входящего
(исходящего) файла.
Как правило, для каждой области использования конфигураций импорта/экспорта допускается
ведение произвольного числа конфигураций, каждая из который отличается от остальных парой
(наименование, направление передачи). То есть, можно создать одну конфигурация АБВ для
экспорта и одну с таким же именем для импорта. В тоже время не допускается создание двух
конфигураций с одинаковым именем для импорта (или же для экспорта).

\subsubsection{Возможности обмена данными через текстовые файлы}

Различные системы используют самый обширный набор форматов представления данных в текстовых
файлах.

\subsection{Настройка конфигурации импорта/экспорта}

\subsubsection{Общий список конфигураций импорта/экспорта}

\ppypict{dlg-140}{Диалог конфигураций импорта/экспорта}

Доступ к большей части конфигураций импорта/экспорта объединен
общим диалогом, показанном на рис.~\ref{pic-dlg-140}. Здесь
сгруппированы следующие наборы конфигураций:

\begin{itemize}
	\item Товаров
	\item Заголовков и строк документов
	\item Инвентаризации
	\item Прайс-листов
\end{itemize}

Обращение к диалогу возможно через пункт меню
\ppymenu{Админ\rdir Конфигурации импорта/экспорта\rdir Конфигурации импорта/экспорта}.

\subsubsection{Заголовочный диалог конфигурации}

\ppypict{dlg-051}{Параметры импорта/экспорта}

В заголовочном диалоге необходимо указать основные параметры импорта/экспорта.
Вид этого диалога показан на рис.~\ref{pic-dlg-051}.
Далее в таблице перечисляются управляющие элементы этого диалога.

Обратите внимание, что в некоторых случаях, заголовочный диалог может отличаться от
представленного на рисунке дополнительными полями, специфичными для конкретной области
применения.

\begin{description}
	\item[Наименование]
	Наименование конфигурации.

	\item[Формат внешних данных]
	Формат, в котором представлены входящие (исходящие) файлы. Доступны следующие варианты:
	\begin{description}
		\item[Текстовый] Данные представлены в виде текста. При этом детальные опции формата
		устанавливаются в дополнительном диалоге \qu{Параметры текстового файла}.
		\item[DBF] Широко распространенный формат представления данных, используемый популярными
		системами семейства xBase (dBase, FoxPro, Clipper и др.)
		\item[XML] Текстовый файл в формате XML. На текущий момент поля могут быть
		определены только в виде тегов XML-файла, но не как атрибуты тегов.
		\item[Excel] Данные представлены в виде файла в формате \trademark{Microsoft Excel}.

		Работа с такими файлами реализуется средствами COM-интерфейсов программы \trademark{Microsoft Excel}.
		Это означает, что она должна быть установлена на том компьютера, на котором
		запускается сеанс, выполняющий функции импорта/экспорта.
	\end{description}

	\item[\dlgbutton{Параметры текст файла}]
	Эта кнопка открывает диалог редактирования опций формата текстового файла (см. ниже).

	\item[\dlgflag{OEM - кодировка}]
	Если этот флаг установлен, то система предполагает, что строки во внешнем файле имеют
	национальную OEM-кодировку (для русского языка это - CP-866). Если флаг не установлен,
	то система считает, что текстовые строки в файле представлены в Windows-кодировке (для
	русского языка это - Windows-1251).

	\item[\dlgflag{Удалять файлы после импорта}]


	\item[\dlgradioc{Экспорт/Импорт}]
	Если переключатель установлен в положении \dlgradioi{Экспорт}, то система будет использовать эту
	конфигурацию для экспорта данных. Если же выбран \dlgradioi{Импорт}, то конфигурация используется
	для импорта данных.

	Обращаем внимание на то, что система следит за уникальностью наименований конфигураций в
	привязке к этому переключателю. То есть, вы можете иметь две конфигурации с одним именем,
	но при этом значение рассматриваемого переключателя в этих конфигурациях должно различаться.

	\item[\dlgbutton{Соответствие полей}]
	При нажатии на эту кнопку открывается диалог редактирования списка соответствия полей.
	Подробно этот диалог рассмотрен ниже.

	\item[Имя файла]
	Имя файла импорта/экспорта. Здесь должен быть указан полный путь к файлу. Если вы укажете
	только имя без пути, то система будет пытаться найти (при импорте) или создать (при экспорте)
	файл в текущем рабочем каталоге, что, в общем случае, может привести к некоторой
	неопределенности (текущий рабочий каталог определяется при запуске сеанса программы).

	Справа от поля находится кнопка, позволяющая выбрать каталог в стандартном диалоге
	навигации по файловой системе.

	При экспорте, если в имени файла содержатся символы '?', то они будут замещаться на
	цифры так, чтобы сформировать имя файла, уникальное для данного каталога. Заметим, что
	такие символы допускаются только собственно в имени файла, но не в расширении и не
	в наименовании каталога.

	\item[\dlgcombo{Учетная запись FTP-сервера}]

	\ppyexample{
		H:/PPY/OUT/F???-???.TXT будет последовательно замещаться на

		H:/PPY/OUT/F000-001.TXT \\
		H:/PPY/OUT/F000-002.TXT \\
		... \\
		H:/PPY/OUT/F999-999.TXT \\
		пока не будет найдено имя файла, отсутствующего в каталоге H:/PPY/OUT.

		При переполнении нумерации экспорт всегда идет в файл в имени которого
		все символы '?' замещены на '9'.
	}

	Кроме знаков вопроса, в имени файла экспорта может вставлена метапеременная \ppyrsrv{\#guid}.
	Если система встретит такую метапеременную, то заменит ее на глобально уникальный идентификатор (длиной 36 символов).
	Так как такой идентификатор гарантированно уникален, то и полное имя файла будет абсолютно уникальным.

\end{description}

\subsubsection{Диалог параметров текстового файла}

\ppypict{dlg-120}{Диалог параметров текстового файла данных}

Параметры текстового файла импорта/экспорта позволяют настроить множество вариантов
обмена данными посредством текстовых файлов. При настройке этих параметров желательно иметь
перед глазами образец файла, который должен получиться или из которого будут извлекаться
данные.

Кроме наиболее популярного формата с разделителями полей, вы можете настроить формат с полями
фиксированной длины, а так же с вертикальной раскладкой полей (каждое поле занимает одну строку).

Вид диалога редактирования этих параметров приведен на рис.~\ref{pic-dlg-120}.

\begin{description}
	\item[Имя файла данных]
	Это поле дублирует аналогичное поле в диалоге заголовка конфигурации. При открытии диалога,
	значение поле \qu{Имя файла} и заголовочного диалога копируется в этот диалог. При подтверждении
	изменений в диалоге параметров текстового файла это имя будет скопировано в диалог заголовка.

	\item[Ориентация записей]
	Горизонтальная ориентация предполагает, что каждая запись содержится в одной строке.
	При вертикальной ориентации каждая строка содержит информацию об одном поле записи. При
	этом записи отделяются друг от друга специальной разделительной строкой.

	\item[Строка-разделитель полей]
	Для горизонтальной ориентации записей в этом поле вводится строка (чаща всего, состоящая из
	одного символа), отделяющая одно поле записи от другого. Если поля имеют фиксированную длину
	(см соответствующий флаг), то разделитель полей не используется. Чаще всего разделителем
	полей при горизонтальной раскладке записей служит либо запятая, либо точка с запятой, либо
	символ табуляции (используйте для представления табуляции специальный формат \textbackslash t).

	При вертикальной ориентации записей в этом поле устанавливается специальная строка, отделяющая
	одну запись от другой. Если вы хотите, чтобы при вертикальной ориентации записи разделялись
	пустой строкой, то в качестве разделителя следует указать специальную строку \textbackslash n.

	Еще один специальный случай - неявное разделение записей в вертикальной раскладке
	по числу строк. То есть, каждые $N$ строк входного файла составляют отдельную запись,
	при этом явной строки-разделителя нет. В этом случае в рассматриваемом поле следует
	ввести строку следующего вида :$N$: (например, :4:).

	\item[\dlgflag{Первая запись - наименование полей}]
	Если этот флаг установлен, то первая запись (и при вертикальной и при горизонтальной
	раскладке) трактуется как наименования полей. В случае вертикальной ориентации записей,
	такая запись должна быть отделена от остальных записей обычным разделителем записей.

	\item[\dlgflag{Поля фиксированной длины}]
	Этот флаг применяется только при горизонтальной ориентации записей.
	Если он установлен, то каждое поле записи занимает строго определенное количество
	символов - не больше и не меньше. Позиция, с которой начинается поле, определяется
	длинами всех предшествующих полей. При таком варианте формата разделители полей не
	используются.

	\item[\dlgflag{Формат поля: имя=значение}]
	Этот флаг применяется только при вертикальной ориентации записей.
	Если он установлен, то программа предполагает, что поля в файле заданы строками вида:

	имя поля=значение поля (имена полей не должны содержать символов '=').

	Такой формат предпочтительнее чем использующий безымянные поля, поскольку допускает
	пропуски полей и изменение порядка их следования внутри записи.

	\ppynote{
		Специальный случай, когда наряду с полями в формате 'имя=значение' необходимо вывести
		одну или несколько строк только со значением поля, но без наименования,
		может быть реализован с помощью специального внешнего наименования поля,
		начинающегося с 'empty'.
	}

	\item[\dlgflag{Текст имеет OEM - кодировку}]
	Если этот флаг установлен, то система предполагает, что строки во внешнем файле имеют
	национальную OEM-кодировку (для русского языка это - CP-866). Если флаг не установлен,
	то система считает, что текстовые строки в файле представлены в Windows-кодировке
	(для русского языка это - Windows-1251).

	\item[\dlgflag{Текстовые поля обрамлены кавычками}]
	Если этот флаг установлен, то система предполагает, что все поля, имеющие тип \qu{Строка},
	обрамлены двойными кавычками.

	\item[Количество незначащих строк в начале файла]
	Установив в этом поле значение больше нуля, вы предпишите системе пропускать при импорте заданное
	количество строк в начале файла.

	При экспорте в файл будет занесено указанное количество пустых строк.

	\item[Завершающая строка файла]
	Этот параметр применим только для конфигурации с вертикальной раскладкой полей.
	Если здесь указан какой-либо текст, то при экспорте программа выведет его последней
	строкой файла.

	\item[\dlgbutton{Поля заголовка...}]
	Кнопка применима только при экспорте и при вертикальной раскладке полей.

	При нажатии на кнопку открывается диалог выбора полей заголовка. Это диалог
	аналогичен диалогу списка соответствия полей.

	Если для данной конфигурации специфицированы какие-либо поля заголовка, то
	начало экспортируемого файла будет формироваться в следующем порядке:

	\begin{itemize}
		\item Заданные параметром 'Количество незначащих строк в начале файла' пустые строки.
		\item Если установлен флаг \dlgflag{Первая запись - наименование полей}, то
		перечисляются наименования полей.
		\item Выводятся поля заголовка.
	\end{itemize}

\end{description}

\subsubsection{Диалог параметров XML-файла}

\ppypict{dlg-impexp-fileparam-xml}{Диалог параметров XML файла данных}

Параметры XML-файла предназначены для определения особенностей структуры импортируемого или экспортируемого
файла. Внешний вид диалога параметров XML-файла показан на рис.~\ref{pic-dlg-impexp-fileparam-xml}.

Далее перечислены управляющие элементы диалога и их назначение.

\begin{description}
	\item[Корневой тег]
	\item[Тег записи]
	\item[Тег заголовка]
	\item[\dlgflag{Использовать DTD}]
	\item[\dlgflag{Использовать кодировку UTF8}]
	\item[\dlgflag{Имеет вложенную запись}]
	\item[\dlgbutton{Поля заголовка...}]
\end{description}

\subsubsection{Диалог списка соответствия полей}

\ppypict{dlg-052}{Соответствие полей импорта/экспорта}

В диалоге соответствия полей импорта/экспорта представлен упорядоченный список, состоящий
из следующих колонок:

\begin{itemize}
 	\item	Наименование внутреннего поля
	\item	Наименование внешнего поля
	\item	Тип данных внешнего поля
	\item	Длина внешнего поля
	\item	Автоматически вычисляемая величина смещение поля относительно начала записи в символах
	(эта колонка служит хорошим подспорьем в случае настройки обмена данными через текстовый файл
	с фиксированной шириной полей).
\end{itemize}

Пример визуального представления этого диалога показан на рис.~\ref{pic-dlg-052}.

Кроме описанного списка, диалог содержит несколько типовых кнопок:

	\paragraph{\dlgbutton{Редактировать}}
	Вызывает окно \qu{Сопоставление поля экспорта/импорта} (см. ниже), позволяет вносить изменения.

	\paragraph{\dlgbutton{Добавить}}
	Вызывает окно \qu{Сопоставление поля экспорта/импорта} (см. ниже), позволяет добавлять новые
	поля.

	\paragraph{\dlgbutton{Удалить}}
	Удаляет соответствие полей.

	\paragraph{\dlgbutton{Вверх} и \dlgbutton{Вниз}}
	Меняют порядок полей. Эти кнопки бывают очень полезны в случае, если порядок полей в файле
	важен, а вы ввели соответствия полей в неправильной последовательности.

\subsubsection{Диалог элемента списка соответствия полей}

\ppypict{dlg-053}{Сопоставление поля для экспорта/импорта}

В этом диалоге вводится соответствие поля во внешнем файле внутреннему полю системы. Кроме
использования фиксированного набора внутренних полей вы можете применять специальные формулы,
позволяющие увеличить возможности настройки форматов обмена данными.

\begin{description}
	\item[Внутреннее представление]
	Здесь необходимо выбрать одно из полей, предоставляемых системой. Список внутренних полей
	определяется спецификой конкретной области использования конфигурации импорта/экспорта.
	Далее в этом разделе будут перечислены все внутренние поля для каждой области использования
	конфигурации.

	\item[Формула]
	Вместо выбора одного из зарезервированных внутренних представлений полей вы можете указать
	формулу. Формула может быть либо пустым значением (необходимо для представления незначащих
	полей в импортируемом или экспортируемом файле), либо специально заданной текстовой строкой,
	вычисляемой непосредственно при импорте/экспорте системой на основе существующих полей данных.
	Правила описания формул приведены ниже.
	И так, для ввода формулы, установите флаг \dlgflag{Формула} и в открывшемся поле введите текст
	требуемой формулы.

	\item[Внешнее наименование поля]
	Наименование поля, используемой внешним файлом данных. Если конфигурация предполагает
	использование безымянных полей (например, текстовый файл без заголовков полей), то здесь
	можно ввести произвольный текст (обычно программа, при выборе вами внутреннего представления
	поля, автоматически заносит сюда некоторое наименование).
	В остальных случаях правильное указание внешнего наименования поля крайне важно.

	\item[Тип поля]
	Тип данных содержащихся в данном поле. Система предоставляет выбор одного из следующих
	типов данных:

	\begin{itemize}
 		\item	Строка - произвольная строка символов
		\item	Целое число - целочисленная величина
		\item	Число - число с плавающей точкой
		\item	Дата
		\item	Время
	\end{itemize}

	Обычно, тип данных для соответствия полей важен, однако, во многих случаях типы могут быть
	автоматически преобразованы друг в друга.
	Все возможные варианты привести сложно, но для примера можно сказать, что для текстового файла
	вы можете в качестве числового типа всегда выбирать просто \qu{Число}.
	При экспорте данных важно понимать как принимающая программа будет воспринимать переданные
	типы.

	\item[Длина поля]
	Эта величина предельно важна для текстовых файлов данных с фиксированной шириной полей.
	В остальных случаях многое зависит от программы, которая использует (формирует) файл обмена.
	Очень важное замечание заключается в том, что если вы укажете недостаточную длину поля в
	конфигурации экспорта, то система \ppybrand{} урежет передаваемые данные в случае, если они не
	помещаются в установленную длину.

	Обратите внимание, что для чисел с десятичной точкой, длина поля включает разрядность после
	точки (для текстовых файлов и саму точку).
	Для XML-формата задаваемая здесь длина не существенна.

	\item[Точность (только для чисел)]
	Максимальное количество десятичных знаков после точки для дробных чисел.
\end{description}

\subsubsection{Определение формул в соответствиях полей}

Вычисление формул при импорте/экспорте реализуется таким образом, чтобы
можно было использовать как текстовые, так и арифметические выражения (но не
одновременно то и другое в одной формуле).

\paragraph{Текстовая формула} представлена строкой, в которой могут быть включены
псевдопеременные для подстановки. Например:

\qu{Сегодня @curdate}

Эта формула будет преобразована к виду \qu{Сегодня 1/09/2008} (если текущая дата - первое
сентября 2008 года).

Вот немногочисленный список пвседопеременных, которые можно использовать в формулах:

\begin{description}
	\item[@empty]
	Специальная переменная, не заменяемая ни чем. Используется для представления пустых
	полей.

	Это может понадобиться при экспорте, если какое-то поле должно присутствовать
	в файле, но его нет необходимости наполнять содержанием.

	При импорте необходимость в пустом поле может быть обусловлена тем, что
	входящий файл данных содержит поле, которое не может быть интерпретировано
	системой.

	\item[@recno]
	Номер текущей записи.

	\item[@curdate]
	Текущая системная дата.

	\item[@curyear]
	Числовое представление текущего года.

	\item[@curmonth]
	Числовое представление текущего месяца (1 - январь).

	\item[@curday]
	Числовое представление текущего календарного дня.

	\item[@curtime]
	Текущее системное время.

	\item[Функции]
	Система предусматирвает несколько специализированных функция для использования в
	выражениях экспорта:
	\begin{description}
		\item[@personregnum]
		Возвращает строку номера регистра персоналии.

		Аргументы:
		\begin{description}
			\item[regtypesymb]
			Символ типа регистрационного документа.

			\item[personid]
			Значение идентификатора персоналии.
		\end{description}

		\ppyexample{
			@presonregnum(inn, @ManufID)

			Приведенный вызов будет замещен кодом ИНН производителя товара (при экспорте
			товаров, в предположении, что символ типа регистра ИНН - \qu{inn}).
		}

		\item[@arregnum]
		Возвращает строку номера регистра персоналии, связанной с аналитической статьей.

		\begin{description}
			\item[regtypesymb]
			Символ типа регистрационного документа.

			\item[articleid]
			Значение идентификатора персоналии.

		\end{description}

		\ppyexample{
			@arregnum(kpp, @CntragID)

			Приведенный вызов будет замещен кодом КПП контрагента по документу (при экспорте
			документов, в предположении, что символ типа регистра КПП - \qu{kpp}).
		}

		\item[@arregdate]
		Возвращает строку даты регистра персоналии, связанной с аналитической статьей.

		\begin{description}
			\item[regtypesymb]
			Символ типа регистрационного документа.

			\item[articleid]
			Значение идентификатора персоналии.

		\end{description}

		\ppyexample{
			@arregdate(lic, @CntragID)

			Приведенный вызов будет замещен датой регистрационного документа некоторой лицензии контрагента по документу (при экспорте
			документов, в предположении, что символ типа регистра лицензии - \qu{lic}).
		}

		\item[@objtag]
		Возвращает текстовое представление значения лота по объекту.

		Аргументы:
		\begin{description}
			\item[tagsymb]
			Символ типа тега.

			\item[objtypesymb]
			Символ типа объекта. Допускаются следующие значения:
			\begin{description}
				\item[GOODS] Тег товара.
				\item[PERSON] Тег персоналии.
				\item[LOT] Тег лота.
				\item[GLOBALUSER] Тег глобальной учетной записи.
			\end{description}

			\item[objid]
			Значение идентификатора объекта.
		\end{description}

		\ppyexample{
			@objtag(manuf, LOT, @LotID)

			Приведенный вызов будет замещен текстом тега с символом manuf, прикрепленного
			к лоту (при экспорте строк документа).
		}

	\end{description}

	\item[Наименования полей]
	Вы можете использовать в формулах \emph{внутренней представление} наименований полей
	для подстановки их значений в результат вычисления формулы.

\end{description}

\paragraph{Арифметическая формула} представлена выражением,
содержащим числа, наименования полей и арифметические операции.

\ppyexample{

	@price - @discount

	1.2 * @cost
}

\paragraph{Специальные возможности}
Если в формуле представлена строка, обрамленная двойными ковычками, то эта строка
без изменения (но без кавычек) переносится в строку результата.

\ppyexample{

	Выражение:

	\textquotedblТекущий год\textquotedbl @curyear

	Даст результат:

	Текущий год 2012
}

Если вам необходимо явное обрамление результата двойными кавычками, то
кавычка в описании формулы седует предварять символом \textbackslash (обратный слэш).

\ppyexample{

	Выражение:

		\textbackslash\textquotedbl@serial\textbackslash\textquotedbl

	Даст результат (в предположении, что значение @serial 00308):

	\textquotedbl00308\textquotedbl
}

\section{Интерфейс с системами клиент-банк\label{sec-clibnk}}

Интерфейс с системами клиента-банк, встроенный в \ppybrand{} позволяет как экспортировать
данные о платежах во внешнюю программу, так и импортировать из внешних программ
платежную ведомость (банковскую выписку) с целью автоматизации процесса внесения %
платежных документов в базу данных.

\subsection{Конфигурация форматов клиент-банк}

Для настройки конфигурации форматов систем клиент-банк выберите пункт меню
\ppymenu{Админ\rdir Конфигурации импорта/экспорта\rdir Конфигурация форматов клиент-банка}.
На экране вы увидите список доступных конфигураций, в котором доступны следующие
действия:

	\paragraph{\dlgbutton{Редактировать}}
	Вызывает окно \qu{Параметры импорта/экспорта для систем клиент-банка} (см. ниже) и
	позволяет вносить изменения.

	\paragraph{\dlgbutton{Добавить}}
	Вызывает окно \qu{Параметры импорта/экспорта для систем клиент-банка} (см. ниже) и
	позволяет добавлять новые конфигурации.

	\paragraph{\dlgbutton{Удалить}}
	Удаляет выделенную конфигурацию.

	\paragraph{\dlgbutton{События}}
	Не работает.

	\paragraph{\dlgbutton{Ассоциации}}
	Позволяет редактировать ассоциации импорта выписки из систем клиент-банк.

	\paragraph{\dlgbutton{Закрыт}}
	Закрывать диалог редактирования списка форматов.

\subsubsection{Диалог редактирования формата клиент-банк}

Этот диалог практически не отличается от общего диалога форматов экспорта/импорта за
исключением того, что в нем присутствуют несколько дополнительных управляющих
элементов.

Вот их описание:

\paragraph{Код банка}
	Каждый банк имеет уникальный код, так называемый \qu{БИК банка}, позволяющий отличить
	его от других банков.

	Если вы введете код банка, которому соответствует данная конфигурация формата,
	то система будет экспортировать по этой конфигурации только те платежные поручения,
	в которых код банка плательщика равен указанному здесь.

	Если поле оставить пустым, то такая проверка выполняться не будет.
\paragraph{Соответствие кодов платежей}
	Это поле предназначено для трансляции кодов платежей экспортируемых платежных поручений
	из системы \ppybrand{} в значения, которые должны использоваться в принимающей
	системе клиент-банк.

	Формат описания этих соответствий следующий:

	$PM1,BM1;PM2,BM2;..;PMN,BMN$

	Здесь:
	$PM1$ (а так же PM2 и далее) - номер метода платежа, определенный в системе \ppybrand{}
	$BM1$ (а так же BM2 и далее) - номер метода платежа, определенный в системе клиент-банк.

	В системе \ppybrand{} используются следующие коды платежей

	\begin{description}
		\item[0] неопределенный
		\item[1] почтой
		\item[2] телеграфом
		\item[3] электронно
		\item[4] срочно
	\end{description}

	Если вы оставите описываемое поле пустым, то в систему клиент-банк будет
	попадать метод платежа с кодом 0.

	\ppyexample{
		1,0;2,1;3,2;4,3

		вид платежа \qu{почтой} будет передан с кодом 0
		вид платежа \qu{телеграфом} будет передан с кодом 1
		вид платежа \qu{электронно} будет передан с кодом 2
		вид платежа \qu{срочно} будет передан с кодом 3
	}

\paragraph{\dlgflag{Определять плательщика по знаку суммы}}
	Этот флаг используется при импорте выписки из системы клиент-банк.
	Включать его следует в том случае, если система клиент-банк предоставляет
	файл выписки, в которой присутствует только реквизиты контрагента
	вашего предприятия. В этом случае, \ppybrand{} определяет является ли контрагент
	плательщиком либо получателем по знаку суммы.

	Альтернативная категория форматов представлена парой групп полей:
	для плательщика и для получателя. В этом случае \ppybrand{} определяет
	кто есть кто, сравнивая ИНН и того и другого с ИНН главной организации,
	определенной в текущем состоянии базы данных.

\subsubsection{Список полей представленных в окне \qu{Соответствие полей импорта/экспорта}}

\begin{description}
	\item[Empty]\indent Строка(16)\\
	Поле, не заполняемое системой, но требуемое модулем клиент-банк.

	\item[BillID]\indent Число(9)\\
	ИД платежного документа.

	\item[Code]\indent Строка(24)\\
	Номер платежного документа.

	\item[Date]\indent Дата(8)\\
	Дата платежного документа.

	\item[PayerBankAcc]\indent Строка(32)\\
	Банковский счет плательщика.

	\item[PayerID]\indent Число(10)\\
	ИД персоналии плательщика.

	\item[PayerINN]\indent Строка(24)\\
	ИНН плательщика.

	\item[PayerName]\indent Строка(128)\\
	Наименование плательщика.

	\item[PayerBankCode]\indent Строка(24)\\
	БИК банка плательщика.

	\item[PayerBankCorr]\indent Строка(32)\\
	Корр счет банка плательщика.

	\item[PayerBankName]\indent Строка(128)\\
	Наименование банка плательщика.

	\item[ReceiverID]\indent Число(10)\\
	ИД персоналии получателя.

	\item[ReceiverBankAcc]\indent Строка(32)\\
	Банковский счет получателя.

	\item[ReceiverINN]\indent Строка(24)\\
	ИНН получателя.

	\item[ReceiverName]\indent Строка(128)\\
	Наименование получателя.

	\item[ReceiverBankCode]\indent Строка(24)\\
	БИК банка получателя.

	\item[ReceiverBankCorr]\indent Строка(32)\\
	Корр счет банка получателя.

	\item[ReceiverBankName]\indent Строка(128)\\
	Наименования банка получателя.

	\item[Amount]\indent Число(10,2)\\
	Сумма платежа.

	\item[Purpose]\indent Строка(160)\\
	Назначение платежа.

	\item[Sequence]\indent Число(4)\\
	Очередность платежа.

	\item[TaxPayerKPP]\indent Строка(24)\\
	КПП плательщика бюджетного платежа.

	\item[TaxReceiverKPP]\indent Строка(24)\\
	КПП получателя бюджетного платежа.

	\item[TaxPayerStatus]\indent Строка(4)\\
	Статус плательщика бюджетного платежа.

	\item[TaxClass]\indent Строка(24)\\
	Код бюджетной классификации.

	\item[OKATO]\indent Строка(16)\\
	Код по ОКАТО бюджетной организации.

	\item[TaxReason]\indent Строка(8)\\
	Код причина бюджетного платежа.

	\item[TaxPeriod]\indent Строка(16)\\
	Налоговый период.

	\item[TaxDocNumber]\indent Строка(16)\\
	Номер документа, согласно которому идет уплата.

	\item[TaxDocDate]\indent Строка(16)\\
	Дата документа, согласно которому идет уплата.

	\item[TaxPaymType]\indent Строка(8)\\
	Тип бюджетного платежа.

	\item[VatSum]\indent Число(8,2)\\
	Сумма НДС.

	\item[PurposePlusVat]\indent Строка(250)\\
	Поле примечание с присоединенным к нему текстом по НДС.

	\item[CorrName]\indent Строка(16)\\
	Не используется.

	\item[CorrBIC]\indent Строка(16)\\
	Не используется.

	\item[CorrINN]\indent Строка(16)\\
	Не используется.

	\item[CorrPerson]\indent Строка(16)\\
	Не используется.

	\item[PaymMethod]\indent Число(4)\\
	Вид платежа.

	\item[AddedAssocTag]\indent Число\indent(Только импорт)\\
	Дополнительный признак ассоциации вида операции.

	Это поле позволяет уточнить вид операции импортируемого документа выписки.
	Если в принимаемом файле определено это поле, то при идентификации вида
	операции, которой должен принадлежать создаваемый документ, система
	обращает внимание на поле \qu{Дополнительный признак ассоциации} в
	элементах списка ассоциаций импорта клиент-банк.

	\item[AgentINN]\indent Строка(24)\\
	ИНН агента по документу.

	Если это поле определено, то при импорте выписки, в создаваемый
	документ будет устанавливаться агент по документу (если система
	сумеет идентифицировать агента по значению кода ИНН в этом поле
	входящего файла).

	Для разрешения проблем с идентификацией агента по этому коду
	желательно, чтобы поле AgentName также было определено в файле импорта.

	При экспорте платежных поручений в это поле будет заносится ИНН
	агента (если таковой имеется) по экспортируемому документу.

	\item[AgentName]\indent Строка(48)\\
	Наименование агента по документу.

	Это поле помогает разрешать проблемы с идентификацией агента по
	импортируемому документу.

	\item[LocSymb]\indent Строка(12)\\
	Символ склада.

	При импорте, если в этом поле указано допустимый символ склада,
	то создаваемый документ будет принадлежать соответствующему складу.

	При экспорте в это поле заносится символ склад, которому принадлежит
	экспортируемый документ.

	\item[DebtBillID]\indent Число\indent(Только импорт)\\
	ИД долгового документа (для зачета).

	Если это поле определено и в файле импорта в нем установлено
	ненулевое значение, то система попытается автоматически зачесть
	создаваемый документ на долговой документ и этим идентификатором.

	Обратим внимание, что система тщательно проверит указанный
	идентификатор на предмет того, что соответствующий документ
	действительно может быть зачтен созданный платежом.

	\item[Дата и номер долгового документа]

	Эти два поля имеют тоже назначение, что и DebtBillID. Только
	идентификация долгового документа для зачета в этом случае будет осуществляться //
	по номеру и дате документа.

	Для того, чтобы такая идентификация работала необходимо, чтобы были определены
	оба эти поля и во входном файле их значения должны быть не пустыми.

	Так как поле DebtBillID и пара полей DebtBillDate/DebtBillCode являются дублирующими,
	то при наличии всех трех полей приоритет использования принадлежит DebtBillID.

	\begin{description}
		\item[DebtBillDate]\indent Дата\indent(Только импорт)\\
		Дата долгового документа (для зачета).
		\item[DebtBillCode]\indent Строка(24)\indent(Только импорт)\\
		Номер долгового документа (для зачета).
	\end{description}
\end{description}

\subsection{Экспорт платежных поручений}

Для использования экспорта платежных поручений необходимо настроить, как минимум,
одну конфигурацию экспорта.

Сама процедура экспорта состоит в вызове функции экспорта платежных поручений из
реестра документов (см. стр.~\pageref{loc-viewbill-clibnkexp}).

\subsection{Импорт банковской выписки}

Для импорта банковской выписки необходимо выбрать пункт меню
\ppymenu{Справочники\rdir Админ\rdir Импорт\rdir Импорт банковской выписки}.
Вслед за этим на экране появится диалог, позволяющий выбрать конфигурацию
импорта. Если существует только одна конфигурация, то процедура импорта
начинается немедленно. Если не настроено ни одной конфигурации импорта, то
система выдаст соответствующее сообщение об ошибке.

\section{Импорт и экспорт документов\label{sec-impexp-bill}}

Функции импорта и экспорта документов отличаются от импорта/экспорта
других типов объектов данных тем, что требуют настройки обработки
двух таблиц: заголовков документов и строк документов.

\subsection{Настройка импорта и экспорта документов}

Конфигурации вариантов импорта/экспорта документов доступна
посредством меню \ppymenu{Админ Конфигурации импорта/экспорта Конфигурация форматов экспорта/импорта документов}
и \ppymenu{Админ Конфигурации импорта/экспорта Конфигурация форматов экспорта/импорта строк документов}.

\ppypict{dlg-cfg-impexp-billhdr}{Диалог конфигурации импорта/экспорта заголовков документов}

\subsubsection{Описание полей заголовка документа}

\begin{description}
	\item[ID]\indent zstring(32)

	Идентификатор документа.
	По этому полю система сопоставляет данную запись с записями строк документа.

	\item[Code]\indent zstring(24)

	Номер документа.

	\item[Date]\indent date

	Дата документа.

	\item[OpID]\indent long

	Только для экспорта.

	Идентификатор вида операции, которой принадлежит документ.

	\item[OpSymb]\indent zstring(20)

	Только для экспорта.

	Символ вида операции, которой принадлежит документ.

	\item[InvoiceCode]\indent zstring(24)

	Номер счет-фактуры. При экспорте, если номер счет-фактуры явно не задан,
	то это поле равно номеру документа.

	При импорте, это поле устанавливается в создаваемом документе если оно не пустое
	и отличается от номера документа.

	\item[InvoiceDate]\indent date

	Дата счет-фактуры. При экспорте, если дата счет-фактуры явно не задана,
	то это поле равно дате документа.

	При импорте, это поле устанавливается в создаваемом документе если оно не пустое
	и отличается от даты документа.

	\item[INN]\indent zstring(32)

	ИНН контрагента.

	При импорте по этому поле система идентифицирует контрагента.
	Идентификация осуществляется следующим образом:
	\begin{itemize}
		\item Из базы данных извлекается список персоналий, у которых
		регистрационный номер зарезервированного типа \ppyrsrv{ИНН} равен
		значению этого поля.
		\item Найденный список персоналий проецируется на таблицу статей,
		заданную в виде операции, которой принадлежит импортируемый документ,
		как основная таблица объектов.
		\item Если результирующий список статей не пустой, то
		берется первая статья из этого списка и она считается контрагентом
		по документу.
	\end{itemize}

	Обратите внимание на то, что крайне желательно обеспечивать уникальность
	кода ИНН среди записей персоналий в базе данных, иначе могут возникнуть
	неопределенности при идентификации контрагентов.

	Указанному методу идентификации контрагента предшествуют попытки
	идентификации по CntragID и по RegistryCode (см. ниже). Если эти две
	попытки не дали результата, то только в этом случае применяется описанный
	метод.

	\item[GLN]\indent zstring(16)

	Только для экспорта.

	Код GLN контрагента по документу. Этот код берется из регистра с
	зарезервированным типом \ppyrsrv{Код GLN} персоналии, связанной с
	основной статьей документа.

	\item[CntragID]\indent long

	Идентификатор аналитической статьи контрагента по документу.

	При экспорте это поле заполняется.

	При импорте система в первую очередь пытается идентифицировать контрагента
	по этому значению. Если аналитическая статья с таким идентификатором
	существует и принадлежит таблице статей, заданной для вида операции
	как таблица контрагентов, то эта статья становится основным контрагентом
	документа. В противном случае включается идентификация контрагента по RegistyCode и
	ИНН (см. описания соответствующих полей).

	\item[CntragNo]\indent long

	Только для экспорта.

	Номер аналитической статьи контрагента по документа.

	\item[CntragName]\indent zstring(128)

	Имя контрагента.

	\item[RegistryCode]\indent zstring(32)

	Поисковый код контрагента. Именно, это - номер регистра персоналии,
	соответствующий типу регистрационного документа, определенному в одном из
	видов, которому принадлежит персоналия, как поисковый.

	При импорте, если не удалось идентифицировать контрагента по идентификатору
	CntragID и значение RegistryCode не пустое, то программа пытается идентифицировать
	контрагента по этому номеру. Эта идентификация осуществляется следующим образом:
	\begin{itemize}
		\item Из таблицы аналитических статей, связанной с видом операции импортируемого
		документа извлекается вид персоналий, связанных со статьями этой таблицы (если,
		конечно, таблица связана с персоналиями, а не с каким-то иным типом объектов данных).
		\item Из найденного на предыдущем шаге вида персоналий извлекается тип регистрационного
		документа для поиска.
		\item Ищется персоналия по номеру RegistryCode определенного предыдущими шагами
		типа регистрационного документа.
		\item Из таблицы статей, связанной с видом операции импортируемого документа,
		выбирается статья, сопоставленная найденной персоналии.
	\end{itemize}

	Если все описанные шаги привели к успешному поиску аналитической статьи, то
	она становится контрагентом по документу, в противном случае применяется поиск по
	ИНН.

	\item[Obj2ID]\indent long

	Только для экспорта.

	Идентификатор дополнительного объекта по документу.

	\item[Obj2Name]\indent zstring(48)

	Только для экспорта.

	Наименование дополнительного объекта по документу.

	\item[Obj2No]\indent long

	Номер статьи дополнительного объекта по документу.

	При импорте, если значение этого поля не нулевое, программа
	пытается идентифицировать дополнительную статью по документу с его
	помощью. Если такая попытка не удалась, то применяется идентификация по Obj2INN
	(см. ниже).

	\item[Obj2INN]\indent zstring(32)

	ИНН дополнительного объекта по документу.

	При импорте, если с видом операции импортируемого документа
	ассоциирована дополнительная таблица объектов, то система
	пытается идентифицировать статью по этому полю (если оно
	заполнено, разумеется) и в случае удачи, устанавливает у
	документа эту статью.

	Описанная идентификация при импорте применяется в случае, если
	не удалось идентифицировать дополнительную статью документа
	с помощью поля Obj2INN (см. выше).

	\item[Obj2GLN]\indent zstring(16)

	Только для экспорта.

	Код GLN дополнительного объекта по документу. Этот код берется из регистра с
	зарезервированным типом \ppyrsrv{Код GLN} персоналии, связанной с
	дополнительной статьей документа.

	\item[AgentName]\indent zstring(128)

	Только для экспорта.

	Наименование агента, к которому привязан документ.

	\item[AgentINN]\indent zstring(32)

	ИНН агента, к которому привязан документ.

	При импорте, если это поле заполнено, то система пытается идентифицировать
	по нему агента. В случае успешной идентификации документ
	привязывается к этому агенту.

	\item[AgentGLN]\indent zstring(16)

	Только для экспорта.

	Код GLN агента по документу. Этот код берется из регистра с
	зарезервированным типом \ppyrsrv{Код GLN} персоналии, связанной со статьей агента по документу.

	\item[DueDate]\indent date

	Дата исполнения документа (чаще всего, планируемая дата отгрузки).

	\item[PaymDate]\indent date

	Последняя дата из плана платежей по документу. Чаще всего (но не всегда)
	она и единственная.

	При импорте документа эта дата применяется к создаваемому документу
	только в том случае, если в конфигурации определено поле суммы \ppyrsrv{Amount}
	и значение этого поля не нулевое (сумма ассоциируется с величиной платежа,
	планируемого на эту дату).

	\item[Amount]\indent double format(8.2)

	Номинальная сумма документа. При импорте товарных документов значение
	этого поле

	\item[CRate]\indent double format(8.2)

	Валютный курс, по которому рассчитываются базовые суммы валютного документа.

	\item[CurID]\indent long format(10)

	Идентификатор валюты.

	\item[BaseAmount]\indent double format(8.2)

	Базовая номинальная сумма документа.

	\item[CostWithSTax]\indent int16 format(4)

	Признак того, что в цены реализации товарного документа включают налог с продаж.

	\item[VatSum]\indent double format(8.2)

	Сумма НДС в номинальных ценах.
	Используется только при экспорте.

	\ppynote{
		Это поле будет заполняться только в том случае, если
		в суммах документа есть значение для зарезервированной суммы НДС.
	}

	\item[Memo]\indent zstring(160)

	Примечание к документу.

	\item[LocID]\indent zstring(32)

	Идентификатор склада, к которому относится документ.

	\item[LocName]\indent zstring(48)

	Наименование склада, к которому относится документ.

	\item[LocCode]\indent zstring(16)

	Код склада, к которому относится документ.

	При импорте система идентифицирует склад создаваемого документа
	именно по этому полю.

	\item[City]\indent zstring(48)

	Город.
	При экспорте в это поле копируется наименование города, в
	котором находится склад, которому принадлежит документ.

	\item[Addr]\indent zstring(255)

	Адрес.
	При экспорте в это поле копируется адрес склада, которому принадлежит документ.

	\item[OrderBillID]\indent zstring(32)

	Только для экспорта.

	Идентификатор документа заказа, к которому привязан данный документа.

	Если документ привязан к нескольким документам заказа, то это поле принимает
	идентификатор одного из них (порядок не регламентирован).

	\item[OrderBillNo]\indent zstring(24)

	Только для экспорта.

	Номер документа заказа, к которому привязан данный документ.

	\item[DlvrAddrID]\indent long

	Только для экспорта.

	Идентификатор адреса доставки из данных по фрахту.

	\item[DlvrAddrCode]\indent zstring(16)

	Только для экспорта.

	Код адреса доставки из данных по фрахту.

	\item[DlvrAddr]\indent zstring(255)

	Только для экспорта.

	Адрес доставки из данных по фрахту.

	\item[MainGLN]\indent zstring(16)

	Только для экспорта.

	Код GLN главной организации. Этот код берется из регистра с
	зарезервированным типом \ppyrsrv{Код GLN} текущей главной организации.

\end{description}

\subsubsection{Применение формул при экспорте документов}

В дополнение к штатному механизму определения формул в конфигурации экспорта
заголовков документов можно применять символы, используемые
для формирования сумм шаблонов проводок (см. стр.~\pageref{loc-opkind-att-formula}).

Благодаря этому вы, например, можете экспортировать документы со значениями
их дополнительных сумм.

Обратим внимание на то, что символы, относящиеся к контексту документа
можно вписывать в формулу как с префиксом @, так и без него.
Например, выражения ${@addamt * 1.8}$ и ${addamt * 1.8}$ эквивалентны.

\subsubsection{Описание полей строк документа}

\begin{description}
	\item[BillID]\indent     zstring(32)

	Идентификатор документа.
	По этому полю система сопоставляет данную запись с записью в
	таблице документов.

	\item[LineNo]\indent long

	Только для экспорта.

	Номер строки (первая строка нумеруется единицей).

	\item[GoodsID]\indent    long

	Идентификатор товара.

	\item[LotID]\indent    long

	Только для экспорта.

	Идентификатор лота, к которому привязана строка документа.

	\item[GoodsName]\indent  zstring(128)

	Наименование товара.

	\item[GoodsGroup]\indent  zstring(128)

	Наименование группы, которой принадлежит товара. При импорте, если система создает отсутствующий
	в базе данных товар, то это поле используется как наименование группы, которой должен принадлежать
	создаваемый товар.

	\item[BrandName]\indent  zstring(128)

	Наименование бренда товара. При импорте, если система создает отсутствующий
	в базе данных товар, то это поле используется как наименование бренда создаваемого товара.

	\item[Barcode]\indent    zstring(24)

	Штрихкод товара.

	\item[ArCode]\indent     zstring(24)

	Кода товара, сопоставленный со статьей контрагента по документу.

	\item[ArCodeOwn]\indent     zstring(24)

	Только для экспорта.

	Собственный код товара (артикул, сопоставленный с пустой аналитической статьей).

	\item[UnitName]\indent     zstring(48)

	Только для экспорта.

	Наименование торговой единицы измерения товара.

	\item[UnitCode]\indent     zstring(20)

	Только для экспорта.

	Код торговой единицы измерения товара.

	\item[PhUnitName]\indent     zstring(48)

	Только для экспорта.

	Наименование физической единицы измерения товара.

	\item[Quantity]\indent   double       format(10.3)

	Количество торговых единиц товара.

	\item[PhQtty]\indent   double       format(10.3)

	Только для экспорта.

	Количество физических единиц. Если по товару в строке ведется независимый учет
	физических единиц, то данное поле отражает соответствующее значение из
	строки документа. В противном случае, величина, выводимая в этом поле
	равна произведению количества на соотношение физических единиц к торговым,
	заданное для товара.

	Для переоценки это поле не инициализируется.

	\item[UnitPerPack]\indent double format(10.3)

	Емкость упаковки.

	\item[PckgQtty]\indent double format(10.3)

	При экспорте это поле заполняется количеством целых упаковок, содержащемся строке документа.
	Емкостью упаковки при этом берется из лота, к которому привязана данная строка.
	Если в лоте емкость упаковки не определена, то система пытается извлечь значение
	емкости упаковки поставки из записи товара. Если и эта величина не определена,
	то значение данного поля нулевое.

	При импорте поле PckgQtty используется только в случае, если величина в
	поле Quantity не определена либо меньше или равна нулю. При этом емкость упаковки
	определяется в следующем порядке:

	\begin{itemize}
		\item Значение, заданное в поле UnitPerPack обрабатываемой записи (см. выше).
		\item Значение емкости упаковки поставки, заданное в карточке товара.
		\item Емкость упаковки в последнем лоте товара, к которому относится строка,
		выбранном на складе, которому  принадлежит импортируемый документ.
	\end{itemize}

	\item[Cost]\indent       double       format(8.2)

	Цена поступления одной торговой единицы товара.

	\item[Price]\indent      double       format(8.2)

	Цена реализации одной торговой единицы товара.

	\item[Discount]\indent   double       format(8.2)

	Скидка на одну торговую единицу товара.

	\ppynote{
		Полная цена реализации представляется разницей

		$Price - Discount$
	}

	\item[CVatRate]\indent   double       format(3.1)

	Ставка входящего НДС в процентах.

	\item[CVatSum]\indent    double       format(8.2)

	Ставка входящего НДС.

	\item[VatRate]\indent    double       format(3.1)

	Ставка НДС в номинальных ценах в процентах.

	\item[VatSum]\indent     double       format(8.2)

	Сумма НДС в номинальных ценах в процентах.

	\item[Expiry]\indent     date

	Дата истечения срока годности товара.
	При экспорте это значение берется из лота, которому принадлежит
	операция.

	\item[Serial]\indent     zstring(32)

	Серийный номер лота.

	\item[CLB]\indent        zstring(32)

	Номер грузовой таможенной декларации (ГТД), сопоставленный с лотом,
	к которому относится операция.

	\item[QcCode]\indent     zstring(32)

	Номер сертификата качества.

	\item[QcBc]\indent       zstring(16)

	Код бланка сертификата качества.

	\item[QcManuf]\indent    zstring(48)

	Производитель, указанный в сертификате качества.

	\item[QcPrDate]\indent   zstring(16)

	Дата производства, указанная в сертификате качества.

	\item[QcInitDate]\indent date

	Дата выдачи сертификата качества.

	\item[QcExpiry]\indent   date

	Дата окончания срока действия сертификата качества.

	\item[QcRegOrg]\indent   zstring(48)

	Наименование органа, выдавшего сертификат качества.

	\item[QcEtc]\indent zstring(48)

	Дополнительная информация по сертификату качества.
\end{description}

\subsubsection{Применение формул при импорте документов}

В конфигурации импорта строк документа можно использовать специализированные формулы
(так называемые, динамические импортируемые поля).

Общий формат такой формулы следующий: $prefix . content$.
Здесь $prefix$ - зарезервированное ключевое слово, обозначающее механизм обработки,
$.$ (точка) - просто разделитель префикса и содержания формулы,
$content$ - содержание формулы.

На данный момент доступны следующие поля:

\begin{description}
	\item[lottag]
	Формулы для динамической привязки тегов лотов. Для этого в содержании формулы необходимо
	указать символ тега с префиксом $lottag$. Например, формула $lottag.manufprice$ означает, что
	из заданного внешнего поля будет извлечено значение, которое
	будет присвоено тегу лота с символом \ppyrsrv{manufprice}.

	\item[priceformula]
	Формула для расчета цены реализации импортируемой строки документа.
	После точки должна следовать собственно формула расчета. Обратим внимание на то,
	что эта формула может оперировать только псевдопеременными, ссылающимися на
	поля импортируемой структуры, но не на документ (строку документа).

	Например: $priceformula.@cost*1.2$ присвоит цене реализации значение,
	равное цене поступления, умноженное на 1.2.

	Если расчет по формуле завершился с ошибкой или дал нулевой либо
	отрицательный результат, тогда данное значение игнорируется (цена реализации
	устанавливается так, как будто эта формула задана не была, но в журнал
	импорта заносятся соответствующие замечания).

	Параметры внешнего поля при использовании данного вида формулы не значимы.

	\item[costformula]
	То же, что и \ppyrsrv{priceformula}, но для расчета цены поступления.

	\item[formula\lbrack\ppyrsrv{inner-field-name}\rbrack]
	Сложная конструкция, реализующая вычисление значения числового поля по формуле.


	\item[token\lbrack\ppyrsrv{inner-field-name}\rbrack]
	Сложная конструкция, реализующая извлечение значения из внешнего текстового поля.
	Здесь \ppyrsrv{inner-field-name} - символьное обозначение внутреннего поля, значение которого
	необходимо определить.

	После точки следуют 3 аргумента разделенные пробелами:
	\ppyrsrv{outer-field-name} \ppyrsrv{divider} \ppyrsrv{token-no}
	\begin{description}
		\item[\ppyrsrv{outer-field-name}] Символьное обозначение внешнего поля, из которого необходимо извлечь подстроку.
		\item[\ppyrsrv{divider}] Допустимые разделители, отделяющие подстроки исходного текста.
		Здесь могут следующие варианты: один из символов \_ , ; . - : \% \^ \$ \@ \#
		или специальные строки: space (пробел), tab (табуляция).
		\item[\ppyrsrv{token-no}] Номер подстроки, которую необходимо извлечь. Первая подстрока имеет номер 1.
	\end{description}

	Например: в исходных данных содержится текстовое поле с символом \ppyrsrv{CODEANDDATE} вида номердокумента-датадокумента
	Для извлечения номера документа из этого поле применим формулу $$token\lbrack Code \rbrack.CODEANDDATE - 1$$

	А для извлечения даты документа применим формулу $$ token\lbrack Date \rbrack.CODEANDDATE - 2$$


\end{description}

\subsection{Экспорт документов}

Для экспорта документов необходимо войти в реестр документов (категория документов
выбирается в зависимости от того, какие именно документы необходимо экспортировать).

Затем, в фильтре по документам укажите параметры фильтрации так, чтобы в выборку
попали только те документы, которые вы намерены экспортировать.

Наконец, в таблице документов выберите команду \qu{Экспорт документов} (\keyb{Ctrl-R}).

Кроме этого, функция экспорта документов присутствует в отчете по фрахтам.

\ppypict{dlg-runiebill-exp}{Диалог экспорта документов}

\subsection{Импорт документов}

Для импорта документов следует выбрать пункт меню \ppymenu{Справочники\rdir Админ\rdir Импорт\rdir Импорт документов}.

\ppypict{dlg-runiebill-imp}{Диалог импорта документов}

\subsubsection{Разрешение неопределенных товаров при импорте документов}

Импорт товарных документов предполагает, что не все товары, на которые
ссылаются строки пришедшего из другой организации документа, присутствуют
вашей базе данных.

В этой ситуации система придерживается двух принципов:

\begin{itemize}
	\item Документ, у которого есть строки с неразрешенными товарами,
	не может быть сохранен в базе данных.
	\item Пользователь должен иметь возможность самостоятельно
	принять решение о создании новых позиций, либо подстановке
	вместо неразрешенных товаров тех, которые уже присутствуют в
	базе данных.
\end{itemize}

Таким образом, если в процессе импорта программа обнаружила товары,
о которых ничего не знает (неизвестный штрихкод, неизвестное наименование
и т.д.), то открывается диалог со списком, в котором отображены
наименования и штрихкоды (если те или другие присутствуют в исходных
файлах данных) этих товаров.

Пользователю в этом диалоге доступны следующие действия:

\begin{itemize}
	\item Создать новый товар для каждой из неизвестных позиций в отдельности.
	\item Массовое создание новых товаров для всех неизвестных позиций сразу.
	Эта функция занимает меньше сил, но и снижает возможности контроля над
	формированием новых номенклатурных позиций.
	\item Заменить неизвестную системе позицию на существующую по выбору
	пользователя.
	\item Найти аналог неизвестного товара по наименованию.
\end{itemize}

\subsection{Импорт инвентаризации}

Система предоставляет унифицированный сервис для импорта строк инвентаризации. Настройка
форматов импорта инвентаризации доступна через пункт меню
\ppymenu{Админ\rdir Конфигурации импорта/экспорта\rdir Конфигурация импорта инвентаризации}.

\subsubsection{Поля, используемые при импорте инвентаризации}

\begin{description}
	\item[GoodsID]\indent long

	Идентификатор товара.

	\item[Barcode]\indent zstring(24)

	Штрихкод товара.

	\item[GoodsName]\indent zstring(64)

	Наименование товара.

	\item[Serial]\indent zstring(24)

	Серийный номер.

	\item[Quantity]\indent double format(12.5)

	Фактическое количество. Допустимое значение должно лежать в пределах
	от 0 до 1000000 (включительно). Если значение выходит за указанные
	границы, то строка не будет принята (система проинформирует об этом
	пользователя).

	\item[Cost]\indent double format(12.5)

	Цена поступления.

	\item[Price]\indent double format(12.5)

	Цена реализации.
\end{description}

\subsubsection{Идентификация товаров при импорте инвентаризации}

\ppypictsc{ImpInvIdentifyGoods}{}{0.4}

Схема порядка идентификации товара приведена на рис.\ref{pic-ImpInvIdentifyGoods}.
Далее следует описание порядка идентификации:

\begin{itemize}
	\item Если в файле определено значение идентификатора товара и
	товар с этим идентификатором есть в базе данных, то используется он.

	\item В противном случае, если во входном файле определен штрихкод
	товара, то товар ищется по этому штрихкоду со следующими особенностями:
	\begin{itemize}

		\item Если в записи входного файла задан серийный
		номер, то ищется подходящий лот с этим серийным номером и из него извлекается товар.

		При этом строка инвентаризации получает принадлежность серийного номера.

		\item Если указанный штрихкод имеет весовой префикс, то
		этот код разбирается так же, как и кассовым узлом, то есть,
		из него извлекается собственно код товара и вес.

		Упомянутый вес используется как фактическое количество только
		в том случае, если поле Quantity записи во входном файле имеет
		недопустимое значение или ноль.

		\item Если штрихкод имеет весовой префикс и в конфигурации товаров
		установлен флаг \dlgflag{На весы вместо штрихкода загружать ИД товара},
		то пять цифр после весового префикса трактуются как идентификатор товара.

		\item Штрихкод без весового префикса ищется в базе данных функцией
		адаптивного поиска (то есть, с учетом возможных мелких несоответствий между
		кодом в базе данных и сканированным).

		\item Если штрихкод в базе данных не найден, то программа
		пытается трактовать этот код как серийный номер лота с извлечением товара,
		которому принадлежит найденный лот.

		При этом строка инвентаризации не получает принадлежность серийного номера
		(сравните с первым вариантом - там строка, наоборот, получает такую принадлежность).
	\end{itemize}

	\item Если все вышеперечисленные процедуры не сработали, но в файле определено
	наименование товара, то системы ищет товар по точному (не различия регистра символов)
	соответствию наименования.
\end{itemize}

Результат идентификации товара выводится в журнал, отображаемый на экране в процессе работы
процедуры.

\subsubsection{Правило определения цен при импорте строк инвентаризации}

Как правило, при импорте инвентаризации, цены во входном файле на определяются.
В этом случае цена для строк документа определяется автоматически по правилу
последнего лота.

Если же вы хотите, чтобы при импорте цены устанавливались в соответствии с входным
файлом, то необходимо определить как минимум одно из полей: Cost или Price.

Система применяет следующий порядок вовлечения значений из этих полей в
формирование цен строк инвентаризации:

\begin{itemize}
	\item Если вид операции документа предусматривает учет строк в ценах реализации,
	то цена извлекается из поля Price (но только если значение этого поля больше нуля).

	\item Если вид операции предусматривает учет строк в ценах поступления и
	значение поля Cost во входном файле больше нуля, то применяется это
	значение.

	\item Если предыдущие два случая дали нулевой результат, и существует учетный
	остаток товара на дату инвентаризации, то используется средняя цена поступления или
	реализации (в зависимости от флага \dlgflag{В ценах поступления} опций вида операции).

	\item Если же и учетный остаток равен нулю, то цена извлекается из последнего
	лота товара, причем лот ищется строго по складу, которому принадлежит документ,
	и такой, чтобы его дата не превышала дату документа.
\end{itemize}

\section{Импорт и экспорт товаров}

\ppypictsc{dlg-139}{Параметры импорта/экспорта товаров}{0.5}
\begin{description}
	\item[Наименование конфигурации]

	\item[\dlgcombo{Группа по умолчанию}]
	\item[\dlgcombo{Операция прихода}]
	\item[\dlgcombo{Таблица аналитических статей}]
	\item[\dlgcombo{Поставщик}]
	\item[\dlgcombo{Склад}]

	\item[Признак необходимости добавления товара в матрицу]
	\item[SubCode (offs,len)]
	\item[\dlgcombo{Торговая единица по умолчанию}]
	\item[\dlgcombo{Физ ед измерения}]

	\item[Формат внешних данных]
	\begin{description}
			\item[\dlgradioi{Текстовый}]
			\item[\dlgradioi{DBF}]
			\item[\dlgradioi{Xml}]
			\item[\dlgradioi{Excel}]
	\end{description}

	\item[\dlgradioi{Экспорт}]
	\item[\dlgradioi{Импорт}]

	\item[\dlgflag{OEM-кодировка}]
	\item[\dlgflag{Удалять файлы после импорта}]

	\item[\dlgflag{Не приходовать нулевое количество}]
	\item[\dlgflag{Анализировать наименования}]
	\item[\dlgflag{Анализировать штрихкоды}]
	\item[\dlgflag{Только анализ}]
	\item[\dlgflag{Universe-HTT}]
	\item[\dlgflag{Force Single Barcode}]
	\item[\dlgflag{Import Images}]
	\item[\dlgflag{Заменять существующих производителей}]

	\item[\dlgbutton{Параметры файла...}]
	\item[\dlgbutton{Соответствия полей...}]

	\item[Имя файла]

\end{description}

\subsubsection{Поля, используемые при импорте и экспорте товаров}
	\begin{description}
		\item[Code]\indent           zstring(32)

		Штрихкод.

		\item[CodeCD]\indent         zstring(32)

		Штрихкод с форсированной контрольной цифрой // @v6.2.4

		\item[AddedCode]\indent      zstring(32)

		Дополнительный штрихкод.

		\item[AddedCodeQtty]\indent  double format(10.4)

		Количество для дополнительного штрихкода.

		\item[GrpID]\indent        zstring(32)

		Только для экспорта.

		Идентификатор родительской группы товара.

		\item[GrpCode]\indent        zstring(32)

		Код группы родительской группы товара.

		\item[GrpName]\indent        zstring(128)

		Наименование группы.

		\item[FolderGrpName]\indent  zstring(128)

		Наименование группы верхнего уровня.

		\item[Name]\indent           zstring(128)

		Наименование.

		\item[Abbr]\indent           zstring(128)

		Сокращенное наименование.  // @v6.2.4

		\item[UnitName]\indent       zstring(48)

		Наименование единицы измерения.

		\item[UnitCode]\indent       zstring(20)

		Только для экспорта.

		Код единицы измерения.

		\item[PhUnitName]\indent     zstring(48)

		Наименование физической единицы измерения.

		\item[PhUPerU]\indent        zstring(48)

		Соотношение физических единиц к торговым.

		\item[ClsCode]\indent        zstring(20)

		Символ класса товара.

		При импорте, если это поле ссылается на	существующий класс, то
		соответствующий класс будет присвоен импортируемому товару даже в случае,
		если товарная группа предписывает назначение товару другого класса по умолчанию.
		Если товар уже существует в базе данных, то его класс не меняется.

		\item[DimX]\indent           double

		Числовой классификатор X.

		\item[DimY]\indent           double

		Числовой классификатор Y.

		\item[DimZ]\indent           double

		Числовой классификатор Z.

		\item[DimW]\indent           double

		Числовой классификатор W.

		\item[PropKindName]\indent   zstring(48)

		Наименование классификатора товара \ppyrsrv{Kind}.
		При импорте, если элемент классификатора с таким именем не существует, система
		создает новый элемент с этим именем.

		\item[PropGradeName]\indent  zstring(48)

		Наименование классификатора товара \ppyrsrv{Grade}.
		При импорте, если элемент классификатора с таким именем не существует, система
		создает новый элемент с этим именем.

		\item[PropAddName]\indent    zstring(48)

		Наименование классификатора товара \ppyrsrv{Add}.
		При импорте, если элемент классификатора с таким именем не существует, система
		создает новый элемент с этим именем.

		\item[PropAdd2Name]\indent   zstring(48)

		Наименование классификатора товара \ppyrsrv{Add2}.
		При импорте, если элемент классификатора с таким именем не существует, система
		создает новый элемент с этим именем.

		\item[UnitsPerPack]\indent   double format(10.6)

		Емкость упаковки лота.

		\item[Cost]\indent           double format(10.2)

		Цена поступления.

		\item[Price]\indent          double format(10.2)

		Цена реализации.

		\item[Rest]\indent           double format(10.4)

		Остаток.

		\item[QCNumber]\indent       zstring(32)

		Сертификат качества: номер сертификата.

		\item[QCBlank]\indent       zstring(16)

		Сертификат качества: код бланка.

		\item[QCDate]\indent         date

		Сертификат качества: дата выдачи.

		\item[QCExpiry]\indent       date

		Сертификат качества: срок годности.

		\item[QCManuf]\indent        zstring(128)

		Сертификат качества: изготовитель.

		\item[QCOrg]\indent          zstring(128)

		Сертификат качества: регистрирующий орган.

		\item[QCManufDate]\indent    zstring(20)

		Сертификат качества: дата производства.

		\item[QCEtc]\indent          zstring(32)

		Сертификат качества: прочая информация.

		\item[QCInnerCode]\indent    zstring(16)

		Сертификат качества: внутренний код.

		\item[SalesTax]\indent       double format(10.2)

		Ставка налога с продаж.

		\item[Vat]\indent            double format(10.2)

		Ставка НДС.

		\item[Country]\indent        zstring(48)

		Страна изготовитель.

		\item[CountryCode]\indent    zstring(48)

		Код страны изготовителя.

		\item[Clb]\indent            zstring(32)

		Грузовая таможенная декларация.

		\item[Serial]\indent         zstring(32)

		Серийный номер.

		\item[Expiry]\indent         date

		Срок годности.

		\item[ExpiryPeriod]\indent   long

		Срок годности дней.

		\item[PckgQtty]\indent       double

		Емкость упаковки поставки (количество торговых единиц).
		При импорте, если значение этого поля больше нуля, то оно
		импортируется в расширение товара.

		\item[PckgBrutto]\indent     long

		Масса брутто упаковки поставки, г.

		\item[PckgLength]\indent     long

		Длина упаковки поставки, мм.

		\item[PckgWidth]\indent      long

		Ширина упаковки поставки, мм.

		\item[PckgHeight]\indent     long

		Высота упаковки поставки, мм.

		\item[ManufID]\indent        long

		Только для экспорта.

		Ид производителя товара.

		\item[ManufName]\indent      zstring(128)

		Наименование производителя товара.

		\item[Brand]\indent         zstring(128)

		Наименование торговой марки товара.
		При импорте, если в справочнике брэндов найдена запись с таким
		наименованием, то товар получает принадлежность этому брэнду,
		в противном случае создается новая запись для торговой марки с
		этим наименованием.

		\item[ExtA]\indent           zstring(255)

		Дополнительное текстовое поле товара 1.

		\item[ExtB]\indent          zstring(255)

		Дополнительное текстовое поле товара 2.

		\item[ExtC]\indent           zstring(255)

		Дополнительное текстовое поле товара 3.

		\item[ExtD]\indent           zstring(255)

		Дополнительное текстовое поле товара 4.

		\item[ExtE]\indent           zstring(255)

		Дополнительное текстовое поле товара 5.

		\item[ArCode]\indent         zstring(32)

		Только для импорта.

		Код по статье. Код присваивается товару и соответствует поставщику,
		выбранному следующим образом:

		\begin{itemize}
			\item Если поле BillSupplID содержит идентификатор существующей
			статьи аналитического учета, то код будет соответствовать этой статье.

			\item Если предыдущий вариант не привел к выбору статьи, и поле
			BillSupplCode содержит действительный поисковый код персоналии,
			соответствующей какому-либо поставщику, то ArCode будет сопоставлен
			этому поставщику.

			\item В случае невозможности определить аналитическую статью по
			предыдущим двум шагам код товара по статье сопоставляется с поставщиком,
			заданным в конфигурации импорта.

			Если же и это значение пустое, то код станет собственным.
		\end{itemize}

		\item[AltGrpCode]\indent zstring(32)

		Только для импорта.

		Код альтернативной группы.

		Если это поле содержит не пустое значение,
		и в базе данных есть не динамическая альтернативная группа с таким кодом,
		то идентифицированный или созданный товар будет введен в эту группу
		(если, конечно, его там еще нет).

		\item[AltGrpPLU]\indent long

		Только для импорта.

		PLU для альтернативной группы.

		Данное поле дополняет AltGrpCode, описанное выше. Если значение данного
		поля не пустое, то товар будет введен в альтернативную группу так, что
		код соответствия товара этой группе будет равен данному значению.

		Если указанное значение PLU уже занято в группе, то товар вообще не будет
		введен в нее.

		\item[HierObjCode]\indent    zstring(32)

		Код объекта в иерархии.

		Поле необходимо для импорта иерархически организованного файла
		товаров и товарных групп.

		\item[HierParentCode]\indent zstring(32)

		Код группы верхнего уровня в иерархии.

		Поле необходимо для импорта иерархически организованного файла
		товаров и товарных групп.

		\item[BillSupplID]\indent    long

		Документ: ид поставщика

		\item[BillSupplCode]\indent  zstring(32)

		Документ: код поставщика.

		При импорте поставщик по этому коду идентифицируется как
		аналитическая статья, связанная с персоналией, имеющей номер
		поискового регистрационного документа равный указанному в этом
		поле.

		Поисковый тип регистрационного документа определяется из
		таблицы аналитических статей поставщиков
		(не путайте с поисковым типом регистра, заданным для вида персоналии).

		\item[BillCode]\indent       zstring(32)

		Документ: номер документа.

		\item[BillDate]\indent       date

		Документ: дата документа.

	\item[FlgPassive]\indent zstring(8)

	Признак товара 'Пассивный'.

	При экспорте, если флаг установлен, то формируется значение \ppyrsrv{true},
	в противном случае \ppyrsrv{false}.

	При импорте, если поле отсутствует или пустое оно игнорируется. Значения
	\ppyrsrv{true}, \ppyrsrv{yes}, \ppyrsrv{1} трактуются как необходимость
	установить флаг, иные - снять.

	\item[FlgNoDiscount]\indent zstring(8)

	Признак товара 'Без скидки'

	При экспорте, если флаг установлен, то формируется значение \ppyrsrv{true},
	в противном случае \ppyrsrv{false}.

	При импорте, если поле отсутствует или пустое оно игнорируется. Значения
	\ppyrsrv{true}, \ppyrsrv{yes}, \ppyrsrv{1} трактуются как необходимость
	установить флаг, иные - снять.

	\item[FlgWantVetisCert]\indent zstring(8)

	Признак товара 'Требует сертификата ВЕТИС'

	При экспорте, если флаг установлен, то формируется значение \ppyrsrv{true},
	в противном случае \ppyrsrv{false}.

	При импорте, если поле отсутствует или пустое оно игнорируется. Значения
	\ppyrsrv{true}, \ppyrsrv{yes}, \ppyrsrv{1} трактуются как необходимость
	установить флаг, иные - снять.

\end{description}

\section{Экспорт лотов\label{sec-impexp-lot}}

Для лотов предусмотрен только экспорт.

Конфигурация экспорта лотов практически аналогична общей конфигурации экспорта/импорта
за исключением дополнительного атрибута \dlgcombo{Аналитическая статья для получения кодов товаров}.
Этот параметр необходим в том случае, если требуется экспортировать коды товаров по статье.

Вызов функции экспорта лотов осуществляется из таблицы лотов (см. стр.~\pageref{sec-ppview-lots}).

\subsubsection{Поля, используемые при экспорте лотов}

\begin{description}
	\item[ID]\indent             long

	Ид. лота.

	\item[BillID]\indent         long

	Ид. документа, которым сформирован лот.

	\item[LocID]\indent          long

	Ид. склада.

	\item[Dt]\indent             date

	Дата поступления лота.

	\item[OprNo]\indent          long

	Номер операции за день.

	\item[Closed]\indent         int16

	Признак нулевого текущего остатка по лоту.

	\item[GoodsID]\indent        long

	Ид. товара.

	\item[QCertID]\indent        long

	Ид. сертификата качества.

	\item[UnitPerPack]\indent    double format(10.3)

	Количество единиц в упаковке.

	\item[Quantity]\indent       double format(10.3)

	Поступившее количество единиц.

	\item[WtQtty]\indent         double format(10.3)

	Поступившее количество в независимых физических единицах.

	\item[WtRest]\indent         double format(10.3)

	Остаток после операции в независимых физических единицах.

	\item[Cost]\indent           double format(10.2)

	Цена поступления.

	\item[ExtCost]\indent        double format(10.2)

	Величина накладных расходов.

	\item[Price]\indent          double format(10.2)

	Цена реализации.

	\item[Rest]\indent           double format(10.3)

	Текущий остаток. То есть остаток с учетом все операций по лоту.

	\item[PrevLotID]\indent      long

	Ид. родительского лота.

	\item[SupplID]\indent        long

	Ид. поставщика.

	\item[CloseDate]\indent      date

	Дата закрытия лота.

	\item[Expiry]\indent         date

	Дата истечения срока годности.

	\item[InTaxGrpID]\indent     long

	Ид. налоговой группы прихода.

	\item[BegRest]\indent        double format(10.3)

	Остаток на начало операционного периода.
	Заполняется только если экспорт осуществляется из списка лотов с непустым операционным периодом.

	\item[EndRest]\indent        double format(10.3)

	Остаток на конец операционного периода.
	Заполняется только если экспорт осуществляется из списка лотов с непустым операционным периодом.

	\item[QttyPlus]\indent       double format(10.3)

	Приход за операционный период (количество).
	Заполняется только если экспорт осуществляется из списка лотов с непустым операционным периодом.

	\item[QttyMinus]\indent      double format(10.3)

	Расход за операционный период (количество).
	Заполняется только если экспорт осуществляется из списка лотов с непустым операционным периодом.

	\item[OrgLotDt]\indent       date

	Дата поступления оригинального лота.

	\item[Serial]\indent         zstring(32)

	Серийный номер лота. Заполняется только если экспорт осуществляется из
	списка лотов с атрибутом фильтра \dlgflag{Показывать серийные номера}.

	\item[UhttArCode]\indent zstring(32)

	Приватный UHTT-код товара.

\end{description}

\section{Импорт других объектов данных}

\subsection{Импорт товаров (старая версия)}

\begin{description}
	\item[file=filename]
	Имя файла, из которого будут импортированы данные.

	\item[hierarchy=obj\_code,parent\_code]
	Иерархический справочник:
	\begin{description}
	 	\item[obj\_code] код объекта.
	 	\item[parent\_code] код родительского объекта.
	\end{description}

	\item[code=fld\_name]
	goods code (imported into Code (not ID)).

	\item[addedcode=fld\_name]
	Дополнительный код товара. Если существует запись с кодом (code), который  уже есть
	в справочнике, но addedcode при этом уникальный, то в товар с кодом code добавляется
	дополнительный код addedcode.

	\item[addedcodeqtty=fld\_name]
	Количество товара, ассоциированное с addedcode (по умолчанию - 1).

	\item[subcode=offs,len]
	Подстрока значения поля code, по которой следует проводить дополнительную  попытку
	идентификации товара по штрихкоду
	 Используется в случае, если длина импортируемых кодов почему-либо выросла но при этом
	 необходимо избежать дублирования с товарами, которые уже есть в справочнике.
	 Если такой код найден, то он заменяется на более длинный из импортируемого справочника.
	 Offs=0.., len=1..

	\item[supplid=fld\_name]
	supplier id (used for linking to suppliers)

	\item[groupcode=fld\_name]
	parent group code

	\item[groupname=fld\_name]
	parent group name (used only if grpcode undefined)

	\item[group2name=fld\_name]
	Наименование группы-папки, которой принадлежит группа groupname

	\item[name=fld\_name]
	goods name

	\item[unitname=fld\_name]
	Unit name

	\item[phperu=fld\_name]
	physical units per unit

	\item[packqtty=fld\_name]
	quantity of trade units in one package

	\item[cost=fld\_name]
	Cost of one trade unit

	\item[price=fld\_name]
	price of one trade unit

	\item[rest=fld\_name]
	rest (trade units)
	Остаток товара.

	\item[qcnmb=fld\_name]
	quality cert name

	\item[qcblank=fld\_name]
	quality cert blank code

	\item[qcdate=fld\_name]
	quality cert issue date

	\item[qcexpiry=fld\_name]
	quality cert expiry date

	\item[qcmanufname=fld\_name]
	goods manufacturer name (as marked in quality cert)

	\item[qcorgname=fld\_name]
	quality cert issue organization name

	\item[qcmanufdate=fld\_name]
	goods produce date string (as marked in quality cert)

	\item[qcetc=fld\_name]
	quality cert extra string (imported into QalityCert.Etc

	\item[salestaxrate=fld\_name]
	rate of sales tax

	\item[vatrate=fld\_name]
	rate of vat

	\item[manufcountryname=fld\_name]
	goods manufacturer country name

	\item[manufcountrycode=fld\_name]
	goods manufacturer country code

	Если задан manufcountrycode, и поле manufcountry пустое, то система ищет государство
	(не персоналию-государство, а именно государство) с аббревиатурой manufcountrycode.
	Если такое государство существует, то создается персоналия-государство, соответствующая
	найденному государству и ее идентификатор принимается в качестве производителя товара.

	\item[clb=fld\_name]
	ГТД лота.

	\item[manufname=fld\_name]
	Производитель.

	\item[brand=fld\_name]
	Торговая марка.

	\item[ext\_a=fld\_name]
	Дополнительное поле A.

	\item[ext\_b=fld\_name]
	Дополнительное поле B.

	\item[ext\_c=fld\_name]
	Дополнительное поле C.

	\item[ext\_d=fld\_name]
	Дополнительное поле D.

	\item[ext\_e=fld\_name]
	Дополнительное поле E.

	\item[warehouse=warehouse\_code]
	Символ склада для которого приходовать остаток или задавать товарную матрицу.

	\item[matrix=-1,0,1 (bias *1000)]
	Признак необходимости добавлять товар в матрицу. Если указан параметр warehouse, то матрица
	устанавливается для выбранного этим параметром склада, в противном случае - для всех
	складов.
	\begin{description}
		\item[-1] игнорировать матрицу (эквивалентно отсутствию параметра).
		\item[0] устанавливать для матрицы значение 0.
		\item[1] устанавливать для матрицы значение 1.
		\item[1000] устанавливать для матрицы значение 0 только если в базе
		данных уже есть такой товар. В противном случае товар не
		добавлять и не приходовать.
		\item[1001] устанавливать для матрицы значение 1 только если в базе
		данных уже есть такой товар. В противном случае товар не
		добавлять и не приходовать.
	\end{description}
\end{description}

\subsection{Импорт товарных групп}

Импорт товарных групп возможен из файлов формата DBF.

Описание импорта товарных групп заносится в файл bin/import.ini
в зону [goodsgroup].

Здесь могут быть следующие параметры:

\begin{description}
	\item[file]
	Обязательный параметр.

	Имя файла, из которого будут импортированы данные.

	\item[name]
	Обязательный параметр.

	Наименование поля, в котором находится имя группы.

	\item[code]
	Наименование поля, в котором содержится код группы.

	\item[parentseq]
	Специализированный параметр, позволяющий импортировать
	иерархию групп в случае, если все уровни группировки
	хранятся в одной записи.

	Значение параметра задается в виде списка элементов, разделенных
	символом ; (точка с запятой). Каждый элемент представлен
	одним или двумя наименованиями полей, представляющих
	соответственно, поле имени группы верхнего уровня и поле кода
	этой группы.

	\ppyexample{
		$
		name=nam \\
		code=cod \\
		parentseq=group;subgroup,sgc \\
		$

		В этом примере предполагается, что входной файл содержит
		следующие поля:
		\begin{description}
			\item[nam] Наименование товарной группы.
			\item[cod] Код товарной группы.
			\item[group] Наименование группы самого верхнего уровня.
			\item[subgroup] Наименование группы второго уровня.
			\item[sgc] Код группы второго уровня.
		\end{description}

		Обратите внимание, на то, что для группы самого верхнего
		уровня код опущен.
	}
\end{description}

Вызов функции импорта товарных групп осуществляется посредством пункта
меню \ppymenu{Справочники\rdir Админ\rdir Импорт товарных групп}.

\subsection{Импорт персоналий}

Импорт персоналий возможен из файлов формата DBF.

Описание импорта персоналий заносится в файл bin/import.ini
в зону [person] или [suppl] (специализированный импорт поставщиков).

\begin{description}
	\item[file=filename]
	Имя файла, из которого будут импортированы данные.

	\item[personcodereg=reg\_symb]
	Символ (не наименование) вида регистрационного документа, используемого в качестве кода
	персоналии. Этот вид регистра может быть использован для связи персоналий с другими
	объектами (товарами, дисконтными картами и т.д.).

	\item[code=fld\_name]
	unique code, identified person in enterprise domain Уникальный внутри импортируемого файла
	код персоналии. В базу данных \ppybrand{} этот код заносится как регистр типа \ppyrsrv{personcodereg}.
	Если \ppyrsrv{personcodereg} не определен, то код персоналии не присваивается.

	\item[idbias=bias]
	bias added to key to avoid person id duplicating

	\item[kind=person\_kind\_list]
	Список наименований видов персоналий, которым должны принадлежать импортируемые персоналии.
	Если таких видно несколько, то их наименования должны следовать друг за другом с разделителем
	',' (запятая). Если этот параметр отсутствует или не содержит ни одного допустимого
	значения, то создаваемые персоналии получают принадлежность зарезервированному виду
	\ppyrsrv{UNKNOWN} (Неизвестные).

	\item[name=fld\_name]
	person name (imported into PersonTbl::Rec.Name)
	Обязательное поле. Поле наименования персоналии. Система не принимает персоналию, если в
	базе данных уже имеется персоналия с таким именем.

	\item[extname=fld\_name]
	Расширенное наименование персоналии.

	\item[status=fld\_name]
	Символ (не наименование) юридического статуса, которому должна принадлежать
	импортируемая персоналия.

	Если это значение пусто, либо не найден статус с таким символом, то
	персоналия получает статус по следующему правилу:

	\begin{itemize}
		\item Если среди списка видов персоналий, заданного параметром \ppyrsrv{kind},
		есть хоть один, для которого определен юридический статус по умолчанию,
		то будет применяться этот статус.
		\item В противном случае используется зарезервированные статус \ppyrsrv{Юридическое лицо}.
	\end{itemize}

	\item[vatfree=fld\_name]
	Признак освобожденности персоналии от уплаты НДС.

	Для того, чтобы импортированная персоналия получала признак \qu{Освобожден от НДС}
	необходимо, чтобы значение этого поля было одно из следующих:
	\begin{itemize}
		\item 1
		\item YES
		\item Y
	\end{itemize}

	\item[city=fld\_name]
	Наименование города. Этот город заносится в юридический адрес персоналии. Если в базе данных
	нет города с таким наименованием, то система создает запись для этого города с принадлежностью
	родному государству.

	\item[zip=fld\_name]
	Почтовый индекс адреса.

	\item[addr=fld\_name]
	Поле адреса персоналии. Этот адрес заносится как юридический адрес персоналии.

	\item[phone=fld\_name]
	Поле телефона. Указанная в этом поле строка заносится в список электронных адресов персоналии
	с зарезервированным видом \ppyrsrv{Рабочий телефон}.

	\item[inn=fld\_name]
	ИНН персоналии. Система пытается идентифицировать персоналию по ИНН наряду с именем. Так,
	если в базе данных уже существует персоналия с ИНН, содержащимся в записи, то такая
	персоналия не импортируется.

	\item[okpo=fld\_name]
	ОКПО персоналии. Импортируется как номер зарезервированного
	типа регистрационного документа \ppyrsrv{ОКПО} (ИД=5).

	\item[okonh=fld\_name]
	ОКОНХ персоналии. Импортируется как номер зарезервированного
	типа регистрационного документа \ppyrsrv{ОКОНХ} (ИД=4).

	\item[kpp=fld\_name]
	Код КПП персоналии. Импортируется как номер зарезервированного
	типа регистрационного документа \ppyrsrv{Код КПП} (ИД=10).

	\item[bankacc=fld\_name]
	Номер банковского счета.

	\item[bankname=fld\_name]
	Наименование банка.

	Если банка с заданным в записи наименованием не существует, то система создает новую запись
	для такого банка.

	\item[bic=fld\_name]
	БИК банка.

	Система пытается идентифицировать банк по этому коду.
	Если в базе данных есть банк с таким кодом, то считается, что банк идентифицирован.

	\item[corracc=fld\_name]
	Корр счет банка. Перед импортом рекомендуется присвоить
	признак \qu{Дублируемый номер} типу регистрационного документа \qu{Корр счет банка}, в который
	собственно и импортируется значение из этого поля.

	\item[memo=fld\_name]
	Примечание персоналии.
\end{description}

Вызов функции импорта персоналий осуществляется посредством пункта
меню \ppymenu{Справочники\rdir Админ\rdir Импорт персоналий}.

Для импорта поставщиков (определенном в зоне [suppl] файла bin/import.ini)
необходимо воспользоваться пунктом меню \ppymenu{Справочники\rdir Админ\rdir Импорт поставщиков}.

\subsubsection{Идентификация дубликатов персоналий при импорте}

Для того, чтобы избежать импорта персоналий, которые уже присутствуют
в базе данных система применяет следующие правила:

\begin{itemize}
	\item Если импортируется персоналия с зарезервированным типом регистрационного
	документа \ppyrsrv{ИНН} и этот тип регистра не имеет признака
	\dlgflag{Неуникальный номер}, то система ищет в базе данных персоналию с
	таким ИНН. Если соответствующая персоналия найдена, то данная запись не
	импортируется.

	\item Если предыдущее правило не обнаружило дубликата персоналии, то
	ищется персоналия, имеющая то же имя, что и импортируемая, и принадлежащая одному
	из видов, которому принадлежит импортируемая персоналия.
\end{itemize}

\subsection{Импорт котировок}

\begin{description}
	\item[file=filename]
	Имя файла, из которого будут импортированы данные.

	\item[quotname=string]
	QuotKind Name for importing. Сначала программа ищет котировку по символу quotname, а
	потом, если символ не найден, по наименованию.

	\item[goodsid=fld\_name]
	goods id.

	\item[goodscode=fld\_name]
	goods code (goodsid | goodscode)

	\item[goodsname=fld\_name]
	goods name

	\item[price=fld\_name]
	Price

	\item[warehouse=warehouse\_code]
	Символ склада для которого устанавливать котировку.

	\item[cursymb=fld\_name]
	currency symbol

\end{description}

\subsection{Импорт персональных карт}

\begin{description}
	\item[file=filename]
	Имя файла, из которого будут импортированы данные.

	\item[personcodereg=reg\_symb]
	Символ вида регистрационного документа, используемого в качестве кода владельца карты.

	\item[seriesid=scser\_id]
	Идентификатор серии, к которой должны относится импортируемые карты. Если серия не
	определена, то система использует серию с именем DEFAULT. Если такая серия не существует,
	то создает новую серию с этим именем.

	\item[code=fld\_name]
	Текстовый код карты.

	\item[codenum=fld\_name]
	Числовой код карты поле codenum имеет приоритет перед code. То есть, если значения есть
	и в поле codenum и в поле code, то система использует поле codenum и преобразует его в
	текст.

	\item[personcode=fld\_name]
	Код владельца карты. Привязка персоналии-владельца карты осуществляется по этому коду,
	содержащемуся в регистре персоналии с типом personcodereg.

	\item[pctdis=fld\_name]
	Процент скидки по карте.

	\item[turnover=fld\_name]
	Начальный оборот по карте. Заносится кассовым чеком, привязанным к этой карте по нулевому
	кассовому узлу за 01/01/2001.
\end{description}

\subsection{Импорт банков}

В интернете по адресу http://cbrates.rbc.ru/bnk/bnk.exe доступен регулярно обновляемый
список банков, действующих на территории Российской Федерации.

Вы можете загрузить этот список и импортировать его частично или полностью в базу данных
\ppybrand{}.

Для этого необходимо выполнить следующие шаги:
\begin{enumerate}
	\item Загрузить с указанного адреса файл bnk.exe в какой-либо каталог на
	вашем компьютере (для примера, C:/BNK).
	\item Запустить на выполнение указанный файл. В результате будут распакованы
	два файла: bnkseek.txt и reg.txt.
	\item Запустить \ppybrand{} с параметром командной строки /convertrbcbnk:путь для %
	конвертации файлов bnkseek.txt и reg.txt в bnkseek.dbf и reg.dbf соответственно.

	Для нашего примера командная строка запуска будет выглядеть так:\\
	ppw.exe /convertrbcbnk:C:/BNK
	\item В каталоге \ppybrand{} в файле BIN/IMPORT.INI настроить зону описания
	импорта банков. Она должна выглядеть так:

	\begin{Verbatim}
		[bank]
		file=c:/bnk/bnkseek.dbf
		regionfile=c:/bnk/reg.dbf
		regionid=ID
		regionname=Name
		name=Name
		city=City
		bic=BIC
		corracc=CorrAcc
	\end{Verbatim}

	Обратите внимание на параметры file и regionfile. В них пути должны соответствовать
	тому каталогу, в котором вы осуществили конвертацию файлов.

	\item Открыв сеанс \ppybrand{} выбрать пункт меню \ppymenu{Справочники\rdir Админ\rdir Импорт\rdir Импорт банков}.
	Непосредственно перед импортом система предложит вам выбрать город, которому должны
	соответствовать импортированные банки. Если вы не выберите город, то будут импортированы
	все банки из справочника (это - довольно много).

\end{enumerate}

\chapter{Интеграция с другими системами и сервисами\label{ch-intritergration}}

Система \ppybrand{} предоставляет обширный встроенный функционал для интеграции с популярными (и не очень) сервисами и системами. В этой главе мы, прежде всего, рассмотрим интеграцию с обязательными по Российскому законодательству сервисами ЕГАИС и ВЕТИС, а так же коснемся встроенных механизмов работы с иными системами.

\section{ЕГАИС}

Интеграция с российской системой ЕГАИС представляет из себя весьма значительный модуль, тесно взаимодействующий со многими блоками системы. А именно: с товарными документами, лотами, кассовой панелью, инфраструктурными модулями.

\subsection{Конфигурация системы для работы с ЕГАИС}

\subsection{Обмен данными с ЕГАИС}

\subsection{ЕГАИС в розничных операциях}

\section{ВЕТИС (Меркурий)}

Российская государственная система ВЕТИС предоставляет сервисы для обмена данными о ветеринарных сертификатах на продукцию животноводства. Система \ppybrand{} предоставляет инструменты для взаимодействия с этой системой.

\subsection{Конфигурация системы для работы с ВЕТИС}

\subsection{Обмен данными с ВЕТИС}

\chapter{Специальный процессинг данных\label{ch-spcdataprc}}

\section{Обработка текстовых объектов}

Начиная с версии 7.9.5 в системе \ppybrand{} появилась технология, реализующая функции автоматической обработки текстовых
объектов базы данных.

Обработка текстовых объектов может быть применена для следующих целей:

\begin{itemize}
	\item Приведение наименований товаров, персоналий и других объектов данных к унифицированному виду для того,
	чтобы улучшить навигацию и идентифицировать дубликаты
	\item Автоматическая расстановка формализованных атрибутов объектов на основе информации, содержащейся в
	их наименованиях. Например, установка классификаторов крепости и емкости алкогольных напитков, брэндов или
	принадлежности товаров группам
	\item Автоматическое распознавание компонентов почтовых адресов
	\item Какие-то иные
\end{itemize}

\subsection{Как работает процессинг текстовых объектов?}

В основе технологии обработки текстовых объектов лежит традиционный метод дробления исходного текста на слова и разделители
с последующим поиском в результирующем массиве заданных правилами образцов. При нахождении искомого образца, модуль выполняет
одну из заданных операций: замещение либо инициацию, так называемого, сигнала.

Операция замещения удаляет найденных образец, а вместо него вставляет определенный правилом текст.

Сигнал же не изменяет исходный текст, но формирует специальную строку, которая дает команду системе выполнить то или иное действие.

\subsection{Синтаксис описания правил}

Правила обработки текстовых объектов перечисляются в текстовом файле с расширением sr. Например goods.sr.

В общем, правило состоит из трех компонентов:
\begin{itemize}
	\item образец поиска
	\item определитель операции
	\item целевой образец
\end{itemize}

Для некоторых операций целевой образец не используется (например в правилах изменение регистра символов образца).

Приведет вводный пример простого правила замены:
\begin{Verbatim}
сабака%>собака %-- Исправим ошибочное написания слова "собака"'
\end{Verbatim}

Разберем приведенное правило. Как не трудно догадаться, целью такого правила может быть исправление часто встречающейся
ошибки в написании слова \qu{собака}. Здесь образец поиска - \qu{сабака}, целевой образец - \qu{собака}, а определитель операции \%>
В конце строки приведен пример комментария: он начинается с трех символов \%-- и заканчивается вместе со строкой. Все, что находится между
\%-- и концом строки игнорируется системой.

Допускается и обратный порядок написания того же выражения:
\begin{Verbatim}
собака%<сабака %-- Исправим ошибочное написания слова "собака"' несколько по-иному
\end{Verbatim}

Здесь образец поиска и целевой образец поменялись местами, а в качестве определителя операции используется \%<

Вообще, все служебные конструкции в правилах обработки текстовых объектов начинаются с символа \%. Обычно
служебная конструкция состоит из пары символов: собственно, префиксного знака \% и второго символа, определяющего операцию или
что-то еще (позже мы опишем все возможные для использования служебные конструкции).

Кроме двух упомянутых зеркальных операций замены существуют три операции замены регистра слов:
\begin{itemize}
	\item[\%A] Переводит слова образца в верхний регистр
	\item[\%a] Переводит слова образца в нижний регистр
	\item[\%K] Переводит первую букву первого слова образца в верхний регистр
\end{itemize}

Остались еще несколько важных операторов, но их мы рассмотрим позже, а сейчас сосредоточимся на способах определения
образцов поиска.

Прежде всего необходимо знать, что программа поступает с образцами поиска и замены аналогично тому, как и с обрабатываемым текстом: она
дробит образцы на отдельные слова и знаки, а потом сравнивает или подставляет результирующие цепочки. Возвращаясь к нашему
простому примеру, представим, что анализируется текст: "Редкая сабака не побежит за кошкой." Система при обработке этого текста превратит его
примерно в следующую цепочку

\section{Индексация телефонов}

\chapter{Job-Server\label{ch-jobserver}}

\section{Настройка серверных задач}

Диалог администрирования серверных задач доступен посредством пункта меню \ppymenu{Админ\rdir Серверные задачи}.

\ppypict{dlg-jobsrv-joblist}{Диалог списка серверных задач}

Вид списка задач показан на рис.~\ref{pic-dlg-jobsrv-joblist}.

Следует обратить внимание на переключатель \dlgflag{Показывать задачи для всех баз данных}.
По умолчанию, в списке отображаются только те задачи, которые были созданы из текущей
базы данных. Если же включить указанный флаг, то в списке будут показаны так же задачи,
относящиеся ко всем базам данных.

\subsection{Диалог редактирования серверной задачи}

\ppypict{dlg-jobsrv-job}{Диалог редактирования серверной задачи}

Диалог, применяемый для создания или изменения серверной задачи показан на рис.~\ref{pic-dlg-jobsrv-job}.
Он содержит следующие управляющие элементы:

\begin{description}
	\item[Наименование]
	Наименование задачи. Система следит за тем, чтобы не существовало двух задач
	с одинаковым наименованием.

	\item[ИД]
	Справочное поле, отображающее идентификатор задачи.
	Для новой задачи его значение - ноль.

	\item[Символ]
	Символьное обозначение задачи, используемое для ссылок на нее из
	формул или из других программ.

	Если символ не пустой, то он должен быть уникальным среди всех
	серверных задач.

	\item[\dlgcombo{Команда}]
	Комбо-бокс выбора команды, которая должна быть выполнена сервером
	при наступлении времени запуска задачи.

	\item[База данных]
	Справочное поле, отображающее символ базы данных, которой принадлежит
	задача.

	При создании новой задачи она автоматически получает принадлежность
	той базе данных, в которой авторизован текущий сеанс.

	\item[\dlgcombo{Следующая задача}]
	Здесь может быть выбрана задача, которая должна быть выполнена сразу
	после завершения работы данной (редактируемой) задачи.

	\item[\dlgflag{Посылать e-mail уведомление}]
	Установка этого флага предписывает серверу отправлять уведомления на
	электронную почту. Настройка этих уведомлений описана ниже.

	\item[\dlgflag{Пассивная}]
	Если этот флаг установлен, то задача не будет выполняться.

	\item[\dlgbutton{Расписание}]
	По этой кнопке доступен диалог редактирования расписания запусков
	задачи.

	\item[\dlgbutton{Параметры}]
	Эта кнопка открывает диалог редактирования параметров задачи.
	Содержимого этого диалога определяется командой, выбранной в
	одноименном комбо-боксе (см. выше).

	Например для команды \ppyrsrv{Процессинг должников} эта кнопка
	откроет диалог запуска процессинга должников (см. стр.~\pageref{loc-debtrate-param}).
\end{description}

\subsection{Настройка рассылки уведомлений сервером}

Для того, чтобы отослать уведомление о выполнении задачи Job-сервер должен
иметь следующую информацию:

\begin{description}
	\item[Список адресов, по которым необходимо отправить уведомления]
	Этот список сервер извлекает из параметра \ppyrsrv{jobserver\_notify},
	находящегося в зоне \ppyrsrv{config} файла BIN/PP.INI

	Если необходимо отправить сообщения более чем на один адрес, то
	все адреса должны быть перечислены этим параметров, разделенные символом ; (точка с запятой).

	Например:
\begin{Verbatim}
	[config]
	jobserver_notify=admin@suncity.ru;mgr1@sunsity.ru
\end{Verbatim}

	\item[Данные почтовой учетной записи]
	Параметры почтовой учетной записи сервер извлекает из файла BIN/MAILACC.TXT.
	Параметры в этом файле должны храниться в формате обмена CHARRY.

	Нет смысла здесь вдаваться в особенности этого формата поскольку
	файл может быть сформирован автоматически из списка почтовых учетных записей,
	хранящегося в базе данных.

	В рабочем сеансе \ppybrand{} выберите пункт меню \ppymenu{Справочники\rdir Админ\rdir Почтовые учетные записи}.
	Если в списке нет ни одной учетной записи, то создайте ее. Если же есть, то экспортируйте
	список кнопкой \dlgbutton{Передать Charry}. В каталоге \ppyrsrv{OUT} появится файл,
	содержащий все записи списка. Переименуйте его в BIN/MAILACC.TXT.

	Если в этом файле описано более одной учетной записи, то Job-сервер будет использовать
	для отсылки сообщений самую первую. Так как формат CHARRY является текстовым, то
	вы можете отредактировать файл в любом текстовом редакторе (только не изменяйте
	строку пароля - он хранится в зашифрованном виде и любое изменение этой строки
	приведет к тому, что сервер не сможет авторизоваться на почтовом сервере).
\end{description}

\subsubsection{Почему сервер не может взять все эти данные непосредственно из базы данных?}

Ответ заключается в том, что для выполнения некоторых задач сервер не авторизуется в базе данных,
следовательно в общем случае, информация, хранящаяся в ней, серверу не доступна. Кроме того,
если на вашем предприятии используется несколько баз данных, то может получиться, что
при выполнении задач для разных баз сервер будет отсылать сообщения на разные адреса.

\section{Задачи Job-Server}

Job-Server может по расписанию выполнять те или иные регулярные задания.

Вот список типов задач Job-Server'а:

\subsection{Прием данных из других разделов БД} символ: ObjRecv


\subsection{Резервное копирование nologin} символ: Backup

Осуществляет резервное копирование базы данных.

\subsection{Обслуживание базы данных} символ: DBMaintain
\subsection{Обслуживание задач noparam} символ: MaintainPrjTask
\subsection{Загрузка данных на кассовый узел} символ: LoadAsyncPOS
\subsection{Загрузка данных на весы} символ: LoadScale
\subsection{Пересчет скидок по дисконтным картам} символ: SCardDiscRecalc
\subsection{Импорт/экспорт palm} символ: PalmImpExp
\subsection{Передача изменений в другой раздел} символ: TransmitModif
\subsection{Закрытие кассовых сессий} символ: CSessClose
\subsection{Заполнение таблицы продаж} символ: FillSalesTable
\subsection{Прием объектов charry} символ: CharryImport
\subsection{Удаление временных файлов} символ: RemoveTempFiles
\subsection{Тест создания файлов} символ: TestCreateFiles
\subsection{Запустить приложение} символ: LaunchApp
\subsection{Создание драфт-документов по кассовым сессиям} символ: CSessCrDraft
\subsection{Процессинг должников} символ: DebtRate
\subsection{Расчет бизнес-показателей} символ: BizScore
\subsection{Экспорт данных Балтика} символ: ExportBaltika
\subsection{Передача документов с фильтрацией} символ: TransmitBillByFilt
\subsection{Экспорт документов} символ: ExportBills
\subsection{Создание документов заказов поставщикам} символ: AutoSupplOrder
\subsection{Сервер RFID устройств} символ: RfidDevicePrcssr
\subsection{Обработка выборки пластиковых карточек} символ: SCardSelectionPrcssr
\subsection{Изменение котировок} символ: UpdateQuots

Вызывает функцию изменения котировок.

\paragraph{Параметры}
	Для редактирования параметров вызывается тот же диалог, что и при
	работе с интерактивной функцией изменения котировок (см. стр.~\pageref{sec-quotupd}).

\subsection{Экспорт отчета по именованному фильтру} символ: ExportView

Экспортируе XML-файл с результатами расчета отчета, определенного заранее подготовленным
именованным фильтром.

\paragraph{Параметры}
	\begin{itemize}
		\item Именованный фильтр
		\item Символ структуры DL600, по которой осуществляется экспорт
		\item Имя файла или просто каталог, в который будет выгружен результат
	\end{itemize}

\subsection{Пустое задание (отладка) noparam} символ: Dummy

Тестовая задача, используемая для проверки работы сервера по расписанию.

\paragraph{Параметры} Отсутствуют.

\section{Команды Job-Server}

Job-Server работает как TCP-сервер, принимая команды от клиентского приложения и
возвращая ему ответы.

\subsection{TCP-порт сервера}

По умолчанию используется TCP-порт 28015, однако это значение может быть
переопределено параметром [server] port в файле pp.ini.

\subsection{Формат и синтаксис команд}

Команды Job-Server'у посылаются в текстовом формате. Каждая команда
завершается парой символов \textbackslash xD\textbackslash xA (бинарный перевод каретки).

Параметры команд передаются через пробел. Если параметр содержит несколько слов, разделенных
пробелами, то можно обрамлять такие многосложные параметры двойными кавычками. В случае, если
внутри такого параметра необходимо передать действительный символ двойной кавычки - его
необходимо предварить обратным слэшем \textbackslash.

\ppyexample{

	gray

	"gray hourse"

	"gray hourse with \textbackslash "quoted string\textbackslash " "

}

Далее приводится список команд и их синтаксис.

\subsubsection{HELLO}
	Получение информации от сервера.
	\paragraph{Параметры} Отсутствуют.
	\paragraph{Возвращаемые значения}
	1 Название программы

\subsubsection{LOGIN}
	Авторизация в базе данных.
	\paragraph{Параметры}
	\begin{description}
		\item[Символ базы данных]
		\item[Имя пользователя]
		\item[Пароль пользователя]
	\end{description}
	\paragraph{Возвращаемые значения}
	\begin{description}
		\item[1] Авторизация прошла успешно.
		\item[0] Ошибка. Сообщение об ошибке можно получить вызовом команды GETLASTERR.
	\end{description}

	\ppyexample{
		LOGIN normal\_base valery gala02
	}

\subsubsection{LOGOUT}
	Выход из сеанса связи с базой данных.
	\paragraph{Параметры} Отсутствуют.
	\paragraph{Возвращаемые значения} 100

\subsubsection{HSH}
	Команда используется для получения строки идентификации текущей
	сессии. В дальнейшем этот идентификатор может быть использован
	для восстановления прерванного соединения с сервером.

	\paragraph{Параметры} Отсутствуют.
	\paragraph{Возвращаемые значения} Строка идентификатора сессии.

\subsubsection{SUSPEND}
	Прерывает соединение с сервером с возможностью последующего
	восстановления.

	\paragraph{Параметры}
	\begin{description}
		\item[Таймаут ожидания] Необязательный параметр, указывающий серверу
		время в секундах, в течении которого следует ожидать
		восстановления соединения.

		По умолчанию, таймаут ожидания восстановления соединения после
		команды SUSPEND составляет 3600 секунд.
	\end{description}
	\paragraph{Возвращаемые значения} Строка идентификатора сессии.

\subsubsection{RESUME}
	Восстанавливает прерванное до этого соединение.

	\paragraph{Параметры}
	\begin{description}
		\item[Идентификатор сессии] Строка идентификатора сессии,
		полученная перед прерыванием соединения командой HSH или
		SUSPEND.
	\end{description}
	\paragraph{Возвращаемые значения}
	\begin{description}
		\item[ACK] В случае успешного восстановления соединения.
		\item[BUSY] Восстановить соединение не удалось так как
		сессия, с которой клиент пытается восстановить соединение
		занята и не ответила в течении заданного времени (по умолчанию 30 секунд).
		\item[ERR] Ошибка.
	\end{description}

\subsubsection{QUIT}
	Конец сеанса связи с Job Server.
	\paragraph{Параметры} Отсутствуют.
	\paragraph{Возвращаемые значения} 100 BUY

\subsubsection{GETLASTERR}
	Возвращает строку сообщения о последней ошибке.
	\paragraph{Параметры} Отсутствуют.
	\paragraph{Возвращаемые значения} 1 Сообщение об ошибке

\subsubsection{SPII}
	Обмен данными с КПК на основе PalmOS или Windows Mobile и
	установленной программой StyloPalmII или StyloWCE.
	\paragraph{Параметры} Отсутствуют.
	\paragraph{Возвращаемые значения} 100

\subsubsection{STYLOBHT}
	Обмен данными с терминалом на основе Windows Mobile и установленной программой StyloBht.
	\paragraph{Параметры} Отсутствуют.
	\paragraph{Возвращаемые значения} 100

\subsubsection{STYLOBHTII}
	Обмен данными с терминалом на основе Windows Mobile и установленной программой StyloBhtII.
	\paragraph{Параметры}
	\begin{description}
		\item[DbSymb]   символ базы данных
		\item[UserName] имя пользователя
		\item[Password] пароль (в зашифрованном виде)
	\end{description}
	\paragraph{Возвращаемые значения}
	\begin{description}
		\item[100] Обмен прошел успешно.
		\item[0] Ошибка. Сообщение об ошибке можно получить вызовом команды GETLASTERR.
	\end{description}

\subsubsection{GETBIZSCORES}
	Получение названий и значений бизнес-показателей.
	\paragraph{Параметры}
	\begin{description}
		\item[UserName] глобальное имя пользователя (PPOBJ\_GLOBALUSERACC)
		\item[Password] пароль (в открытом виде)
	\end{description}
	\paragraph{Возвращаемые значения}
	\begin{description}
		\item[100] текст с наименованиями и значениями показателей] Функция отработала успешно.
		\item[0] Ошибка. Сообщение об ошибке можно получить вызовом команды GETLASTERR.
	\end{description}

\subsubsection{CHECKGLOBALCREDENTIAL}
	Проверяет правильность имени глобальной учетной записи и соответствующего ей
	пароля.
	\paragraph{Параметры}
	\begin{description}
		\item[UserName] глобальное имя пользователя (PPOBJ\_GLOBALUSERACC)
		\item[Password] пароль (в открытом виде)
	\end{description}
	\paragraph{Возвращаемые значения}
	\begin{description}
		\item[1] Существует учетная запись с заданным именем и переданный пароль правилен.
		\item[0] Ошибка. Сообщение об ошибке можно получить вызовом команды GETLASTERR.
	\end{description}

\subsubsection{GETBBOARD}
	Возвращает список запущенных задач Job Server.
	\paragraph{Параметры} Отсутствуют.
	\paragraph{Возвращаемые значения}
	Если есть хоть одна запущенная задача, то
	возвращает все запущенные задачи в виде:
	1 Запущенная задача в формате: 1 Дата Время Описание задачи [(Ход выполнения)]
	Затем возвращает 100.

	Если не запущено ни одной задачи, то возвращает строку:
	0 There are no started tasks

\subsubsection{GETTDDO}
	Возвращает текст, построенный по шаблону заданного tddo-файла.
	\paragraph{Параметры}
	\begin{description}
		\item[FileName] Имя tddo-файла.
		\item[ArgList] Список дополнительных аргументов, передаваемых обработчику tddo-файла.
		Этот список может содержать ноль или более аргументов.
	\end{description}

	\ppyexample{
		GETTDDO ppgoodsdetail 3401 "еще один аргумент"

		Здесь:
		\begin{description}
			\item[ppgoodsdetail] Имя tddo-файла
			\item[3401] Первый аргумент обработчика (будет подставлен в ответ на переменную \$\{1\})
			\item["еще один аргумент"] Второй аргумент обработчика (будет подставлен в ответ на переменную \$\{2\})
		\end{description}
	}
	\ppyexample{
		GETTDDO greeting

		Вызов обработчика шаблона greeting.tddo без дополнительных аргументов.
	}

\subsubsection{TEST}
	Тестирование обмена данных с сервером.
	\paragraph{Параметры} Отсутствуют.
	\paragraph{Возвращаемые значения}
	\begin{description}
		\item[100] Тест прошел успешно.
		\item[0] Ошибка. Сообщение об ошибке можно получить вызовом команды GETLASTERR.
	\end{description}

\subsubsection{GETIMAGE}
	Возвращает файл с изображением, ассоциированным с выбранным объектом данных.

	\paragraph{Параметры}
		\begin{description}
			\item[ObjType] Символ типа объекта данных.
			Команда поддерживает следующие символы:
			\begin{description}
				\item[GOODS] Товары
				\item[PERSON] Персоналии
			\end{description}

			\item[ObjID] Идентификатор объекта, по которого необходимо
			извлечь изображение.
		\end{description}

	\ppyexample{
		GETIMAGE goods 12029

		Возвращает изображение товара с идентификатором 12029.
	}

\subsubsection{EXECVIEW}
	Запускает расчет отчета по именованному фильтру и возвращает XML-файл
	с результатами.

	\paragraph{Параметры}
		\begin{description}
			\item[NamedFiltSymb] Символ именованного фильтра.

			\item[DL600DataName] Не обязательный.
			Наименование структуры DL600, которую следует использовать
			для формирования файла отчета.
			Если этот параметр опущен, то сервер попытается использовать
			структуру данных, ассоциированную с отчетом по умолчанию (не
			все КАД'ы определяют такой отчет).
		\end{description}

	\ppyexample{
		EXECVIEW goodsrest02

		Возвращает файл результата расчета по фильтру с символом goodsrest02.
	}

\subsubsection{SELECT}
Команда со сложным синтаксисом, предназначенная для извлечения данных из системы.

\paragraph{Формат возвращаемого значения}

Сервер возвращает запрошенные данные в формате XML. Для большинства типов
объектов формат одной записи следующий:

\begin{description}
	\item[Id] Идентификатор объекта.
	\item[ParentId] Идентификатор родительского объекта (может быть 0).
	\item[Name] Наименование объекта.
\end{description}

Для некоторых типов объектов формат представления иной. В таких случаях
ниже мы опишем соответствующие форматы.

\paragraph{Синтаксис команды SELECT}

Общий принцип состоит в том, что клиентское приложение формирует запрос, содержащий
тип объекта, записи которого следует извлечь, и список критериев, которым должны
удовлетворять извлекаемые записи.

Критерии задаются следующей конструкцией:

	criterion-clause ::= criterion subcriterion-clause criterion-value-clause

	subcriterion-clause ::= nothing | .subcriterion
	criterion-value-clause ::= nothing | ( criterion-value )

То есть, каждый критерий состоит из трех частей (некоторые из которых могут отсутствовать):
наименование критерия ($criterion$), подкритерий ($subcriterion$), значение критерия ($criterion-value$).

Наименования критериев и подкритериев будут описаны подробно для каждого типа объектов.
Значение критерия заключается в скобки. Внутри скобок значения, даже текстовые, не должны
обрамляться кавычками.

\ppyexample{

	SELECT GOODS BY PARENT.NAME(Сигареты)

	Приведенная конструкция извлекает список товаров, принадлежащих группе с
	именем \qu{Сигареты}.
}

Далее приводится список возможных наименований объектов и соответствующие
им критерии.

\begin{description}
	\item[DL600] Запись в формате структуры DL600. После символа DL600
	должно следовать наименование структуры и лишь за тем - критерии.

	Критерии:
	\begin{description}
		\item[ID] Идентификатор данных, которые должны быть извлечены.
		Подкритерии отсутствуют.
	\end{description}

	\ppyexample{
		SELECT DL600 UhttPerson by id(21319)

		Извлекает данные о персоналии (в формате UhttPerson) с идентификатором 21319.
	}

	\item[GOODS] Товары.
	Критерии:
	\begin{description}
		\item[ID] Идентификатор товара.

		Множественное представление обрабатывается: в выборке будут присутствовать товары
		для каждого из перечисленных идентификаторов.

		Подкритерии отсутствуют.
		\item[NAME] Наименование товара.
		Подкритерии отсутствуют.
		\item[SUBNAME]
		Строка, которую должны содержать наименования извлекаемых товаров.
		\item[PARENT]
		\item[BRAND]
		\item[MANUF]
		\item[CODE]
		\item[BARCODE]
		\item[TAGEXIST]
		Критерий, позволяющий выбрать товары, для которых определен (не зависимо от значения)
		заданный критерием тег.

		Множественное представление обрабатывается по условию ИЛИ. То есть, несколько таких критериев
		обеспечивают выборку товаров, которые имеют значение хотя бы для одного из перечисленных тегов.

		Подкритерии:
			\begin{description}
				\item[ID]   (default) Идентификатор типа тега.
				\item[CODE]  Символ типа тега.
				\item[NAME]  Наименование типа тега.
			\end{description}
	\end{description}

	\item[GOODSARCODE] Товары с кодами, привязанными к контрагентам.

	Структура записей, возвращаемых вызовом SELECT GOODSARCODE
	определяется структурой данных DL600 UhttGoodsArCode (см. файл ppexp.dl6, распространяемый
	с дистрибутивом системы).

	Критерии:
	\begin{description}
		\item[SELLER] Обязательный критерий, идентифицирующий контрагента,
		коды привязки к которому, возвращает сервер.

		Подкритерии:
		\begin{description}
			\item[ID]   (default) Идентификатор персоналии.
			\item[CODE]  Номер поискового регистра вида персоналии (не путать с поисковым регистром таблицы аналитических статей).
			\item[NAME]  Наименование персоналии (поиск по точному соответствию имени без учета регистров символов).
		\end{description}

		\item[ID] Идентификатор товара. Множественное представление обрабатывается.
		Подкритерии отсутствуют.
		\item[NAME] Наименование товара.
		Подкритерии отсутствуют.
		\item[SUBNAME]
		Строка, которую должны содержать наименования извлекаемых товаров.
		\item[PARENT]
		\item[BRAND]
		\item[MANUF]
		\item[CODE]
		\item[BARCODE]
	\end{description}

	\item[GOODSGROUP] Товарные группы.
	\begin{description}
		\item[ID] Идентификатор группы. Множественное представление обрабатывается.
		Подкритерии отсутствуют.
		\item[NAME] Наименование группы.
		Подкритерии отсутствуют.
		\item[SUBNAME]
		\item[PARENT]
		\item[CODE]
	\end{description}

	\item[BRAND] Торговые марки.
	\begin{description}
		\item[ID] Идентификатор брэнда. Множественное представление обрабатывается.
		Подкритерии отсутствуют.
		\item[NAME] Наименование группы.
		Подкритерии отсутствуют.
		\item[SUBNAME]
		\item[OWNER]
	\end{description}

	\item[PERSONKIND] Виды персоналий.
	\begin{description}
		\item[ID] Идентификатор вида персоналии. Множественное представление обрабатывается.
		Подкритерии отсутствуют.
		\item[NAME] Наименование вида.
		Подкритерии отсутствуют.
		\item[CODE] Символ вида персоналии.
	\end{description}

	\item[PERSON] Персоналии.
	\begin{description}
		\item[ID] Идентификатор персоналии. Множественное представление обрабатывается.
		Подкритерии отсутствуют.
		\item[NAME] Наименование персоналии.
		Подкритерии отсутствуют.
		\item[SUBNAME] Подстрока, содержащаяся в имени персоналии.
		\item[KIND] Вид персоналии.
		\item[REGISTER]
	\end{description}

	\item[LOCATION] Локации (склады, адреса, автономные адреса).
	\begin{description}
		\item[ID] Идентификатор локации. Множественное представление обрабатывается.
		Подкритерии отсутствуют.
		\item[CODE] Код локации. Множественное представление обрабатывается.
		Подкритерии отсутствуют.
		\item[OWNER] Персоналия-владелец адреса.
		Подкритерии:
		\begin{description}
			\item[ID]   (default) Идентификатор персоналии.
			\item[CODE]  Номер поискового регистра вида персоналии (не путать с поисковым регистром таблицы аналитических статей).
			\item[NAME]  Наименование персоналии (поиск по точному соответствию имени без учета регистров символов).
		\end{description}
		\item[PHONE] Номер телефона для поиска автономных адресов. Запрос может вернуть более одного адреса.
		Для эффективной работы этого критерия необходимо, чтобы была включена индексация телефонов в системных параметрах общих настроек (см. стр.~\pageref{sec-commcfg-sys}).
	\end{description}

	\item[CITY] Города.
	\begin{description}
		\item[ID] Идентификатор города. Множественное представление обрабатывается.
		Подкритерии отсутствуют.
		\item[NAME] Наименование группы.
		Подкритерии отсутствуют.
		\item[CODE]
		\item[PARENT]
	\end{description}

	\item[COUNTRY] Государства.
	\begin{description}
		\item[ID] Идентификатор государства. Множественное представление обрабатывается.
		Подкритерии отсутствуют.
		\item[NAME] Наименование группы.
		Подкритерии отсутствуют.
		\item[CODE]
		\item[PARENT]
	\end{description}

	\item[QUOT] Котировки.
	\ppynote{
		Здесь речь идет о втором поколении котировок, реализованном в \ppybrand{}.
		Общая инфраструктура котировок на момент написания этого раздела не
		переведена на второе поколение.

		Таким образом, котировки, которыми можно манипулировать в стандартном
		сеансе системы не могут быть (пока) извлечены вызовом этой команды.
	}

	Выборка котировок не предусматривает множественных критериев. Таким образом,
	если одни и тот же критерий указан несколько раз, то в рассмотрение берется только
	последнее значение этого критерия.

	Структура записей, возвращаемых вызовом SELECT QUOT
	определяется структурой данных DL600 UhttQuot (см. файл ppexp.dl6, распространяемый
	с дистрибутивом системы).

	\begin{description}
		\item[ACTUAL]
		Критерий без параметров, означающий, что необходимо извлечь только актуальные котировки.
		Если это критерий не указан, то извлекаются все значения подходящих котировок. Если указан,
		то извлекаются только актуальные (текущие) значения подходящих котировок.

		Подкритерии отсутствуют.

		\item[KIND]
		Вид котировки.

		Подкритерии:
		\begin{description}
			\item[ID]   (default) Идентификатор вида котировки.
			\item[CODE] Символ вида котировки.
		\end{description}

		\item[SELLER]
		Продавец (публикатор котировки).
		Персоналия (транслируется в аналитическую статью таблицы GetSupplAccSheet()).

		Подкритерии:
		\begin{description}
			\item[ID]   (default) Идентификатор персоналии.
			\item[CODE]  Номер поискового регистра вида персоналии (не путать с поисковым регистром таблицы аналитических статей).
			\item[NAME]  Наименование персоналии (поиск по точному соответствию имени без учета регистров символов).
		\end{description}

		\item[BUYER]
		Покупатель. Персоналия (транслируется в аналитическую статью таблицы GetSupplAccSheet()).

		Подкритерии:
		\begin{description}
			\item[ID]   (default) Идентификатор персоналии.
			\item[CODE]  Номер поискового регистра вида персоналии (не путать с поисковым регистром таблицы аналитических статей).
			\item[NAME]  Наименование персоналии (поиск по точному соответствию имени без учета регистров символов).
		\end{description}

		\item[ARTICLE]
		Аналитическая статья, с которой ассоциированы котировки. Этот критерий, дублируя критерии
		\ppyrsrv{SELLER} и \ppyrsrv{BUYER}, введен для того, чтобы можно было явно определить критерий
		зависимости котировок от статьи, заданной идентификатором (например, для случаев, когда
		статья не ассоциирована с персоналией и пр).

		Подкритерии:
		\begin{description}
			\item[ID]   (default) Идентификатор статьи.
		\end{description}

		\item[LOCATION]
		Адрес продавца. Имеется в виду либо склад, либо любой адрес персоналии
		(юридический, фактический, либо адрес доставки).

		Подкритерии:
		\begin{description}
			\item[ID]    (default) Идентификатор адреса.
			\item[CODE]  Код адреса. Сначала ищется код склада, в случае неудачи - код адреса.
		\end{description}

		\item[LOCWORLD]
		Географический объект, которому должен принадлежать адрес продавца.

		Подкритерии:
		\begin{description}
			\item[ID]   (default) Идентификатор географического объекта.
			\item[CODE] Символ географического объекта.
		\end{description}

		\item[GOODS]
		Товар, к которому относятся котировки.

		Подкритерии:
		\begin{description}
			\item[ID]   (default) Идентификатор товара.
			\item[CODE] Код товара (без привязки к контрагенту).
		\end{description}

		\item[GOODSGROUP]
		Товарная группа, для товаров которой необходимо извлечь котировки.
		Отменяется критерием GOODS.

		Подкритерии:
		\begin{description}
			\item[ID]   (default) Идентификатор товарной группы.
			\item[CODE]  Код группы.
			\item[NAME]  Наименование группы (поиск по точному соответствию имени без учета регистров символов).
		\end{description}

		\item[BRAND]
		Торговая марка, для товаров которой необходимо извлечь котировки.
		Отменяется критерием GOODS.

		Подкритерии:
		\begin{description}
			\item[ID]   (default) Идентификатор брэнда.
			\item[NAME]  Наименование брэнда (поиск по точному соответствию имени без учета регистров символов).
		\end{description}

		\item[CURRENCY]
		Валюта значения котировки. Если не указана, то извлекаются котировки без
		ограничения по валюте, в которой они определены.

		Подкритерии:
		\begin{description}
			\item[ID]   (default) Идентификатор валюты.
			\item[CODE] Символ валюты (не путать с цифровым кодом валюты).
		\end{description}
	\end{description}

	%\item[GOODSARCODE]
\end{description}

\paragraph{Примеры} Приведем несколько примеров использования команды SELECT:

SELECT goods BY goodsgroup.code(33)

SELECT goods BY brand(10014) goodsgroup(14)

SELECT goods BY barcode(4607089460013)

SELECT person BY kind.symb(BANK)

SELECT person BY register.def(10022, 5550005)

SELECT PERSON BY ID(19) ID(2301) ID(1429)

SELECT personkind by id(1002) id(1003)

SELECT DL600 UhttPerson by id(21319)

SELECT QUOT BY KIND(1) GOODS.CODE(4602666140609)

SELECT QUOT BY ACTUAL KIND(1) LOCATION.CODE(1400000001)

\subsubsection{CREATE}

Эта команда позволяет создать некоторые объекты данных с
ограниченным набором атрибутов.

\begin{description}
	\item[PERSON]
	Создает запись персоналии.

	\begin{description}
		\item[Name]
		Наименование персоналии.

		Обязательный параметр.

		\item[Status]
		Юридический статус новой персоналии.

		Может быть указан только один статус. Если указано более одного,
		то применяется последний (в лексикографическом порядке).

		Если статус не указан, то персоналия получает принадлежность
		статусу по первому встретившемуся виду (в порядке следования идентификаторов),
		для которого задан статус персоналий по умолчанию, если такой вид
		отсутствует, то персоналия получает зарезервированный статус \ppyrsrv{Юридическое лицо}.

		Подкритерии:
		\begin{description}
			\item[ID]   (default) Идентификатор статуса.
			\item[CODE]  Символ юридического статуса.
			\item[NAME]  Наименование статуса (поиск по точному соответствию имени без учета регистров символов).
		\end{description}

		\item[Kind]
		Вид персоналии.

		Может быть указано более одного вида, которым должна принадлежать новая персоналия.

		Если не указано ни одного вида, то новая персоналия получает принадлежность
		к виду \ppyrsrv{Неизвестные}.

		Подкритерии:
		\begin{description}
			\item[ID]   (default) Идентификатор вида.
			\item[CODE]  Символ вида персоналии.
			\item[NAME]  Наименование вида (поиск по точному соответствию имени без учета регистров символов).
		\end{description}

		\item[Category]
		Категория персоналии.

		Может быть указана только одна категория. Если указано более одной,
		то применяется последняя (в лексикографическом порядке).

		Если категория не указана, то новая персоналия создается с неопределенной категорией.

		Подкритерии:
		\begin{description}
			\item[ID]   (default) Идентификатор категории.
			\item[CODE]  Символ категории.
			\item[NAME]  Наименование категории персоналий (поиск по точному соответствию имени без учета регистров символов).
		\end{description}
	\end{description}

	\item[GLOBALACC]
	Создает глобальную учетную запись.

	\begin{description}
		\item[Name]
		Наименование учетной записи.
		Обязательный параметр.

		\item[Password]
		Пароль, сопоставленный с записью.

		\item[Owner]
		Персоналия, сопоставленная с учетной записью.

		Подкритерии:
		\begin{description}
			\item[ID]   (default) Идентификатор персоналии.
			\item[CODE]  Номер поискового регистра вида персоналии (не путать с поисковым регистром таблицы аналитических статей).
			\item[NAME]  Наименование персоналии (поиск по точному соответствию имени без учета регистров символов).
		\end{description}
	\end{description}

	Пример:

	create globalacc name(serg-admin) password(tea09..14)


\end{description}

\subsubsection{SET}

Команда SET позволяет установить некоторые атрибуты для ряда
объектов данных.

Синтаксис этой команды аналогичен синтаксису команды SELECT, однако
здесь отсутствует ключевое слово BY.

\begin{description}
	\item[GOODSARCODE]
	Устанавливает код товара, связанного с заданным контрагентом.

	\begin{description}
		\item[SELLER]
		Обязательный параметр.
		Персоналия, с которой должен быть связан код товара.

		Подкритерии:
		\begin{description}
			\item[ID]   (default) Идентификатор персоналии.
			\item[CODE]  Номер поискового регистра вида персоналии (не путать с поисковым регистром таблицы аналитических статей).
			\item[NAME]  Наименование персоналии (поиск по точному соответсвию имени без учета регистров символов).
		\end{description}

		\item[GOODS]
		Обязательный параметр.
		Товар, для которого задается код.

		Подкритерии:
		\begin{description}
			\item[ID]   (default) Идентификатор товара.
			\item[CODE] Код товара (без привязки к контрагенту).
		\end{description}

		\item[VALUE]
		Строка кода, который должен быть присвоен товар. Если эта строка
		пустая, то у товара будет отозван код, связанный с заданным
		контрагентом.
	\end{description}

	\item[QUOT]
	Устанавливает значение котировки в соответствии с набором
	критериев. Далее приведен список допустимых критериев и подкритериев
	для этого типа объектов.
	\begin{description}
		\item[KIND]
		Вид котировки. Этот критерий обязателен.

		Подкритерии:
		\begin{description}
			\item[ID]   (default) Идентификатор вида котировки.
			\item[CODE] Символ вида котировки.
		\end{description}

		\item[SELLER]
		Продавец (публикатор котировки).
		Персоналия (транслируется в аналитическую статью таблицы GetSupplAccSheet()).

		Подкритерии:
		\begin{description}
			\item[ID]   (default) Идентификатор персоналии.
			\item[CODE]  Номер поискового регистра вида персоналии (не путать с поисковым регистром таблицы аналитических статей).
			\item[NAME]  Наименование персоналии (поиск по точному соответсвию имени без учета регистров символов).
		\end{description}

		\item[BUYER]
		Покупатель. Персоналия (транслируется в аналитическую статью таблицы GetSupplAccSheet()).

		Подкритерии:
		\begin{description}
			\item[ID]   (default) Идентификатор персоналии.
			\item[CODE]  Номер поискового регистра вида персоналии (не путать с поисковым регистром таблицы аналитических статей).
			\item[NAME]  Наименование персоналии (поиск по точному соответсвию имени без учета регистров символов).
		\end{description}

		\item[LOCATION]
		Адрес продавца. Имеется в виду либо склад, либо любой адрес персоналии
		(юридический, фактический, либо адрес доставки).

		Подкритерии:
		\begin{description}
			\item[ID]    (default) Идентификатор адреса.
			\item[CODE]  Код адреса. Сначала ищется код склада, в случае неудачи - код адреса.
		\end{description}

		\item[GOODS]
		Товар, к которому относятся котировки.

		Подкритерии:
		\begin{description}
			\item[ID]   (default) Идентификатор товара.
			\item[CODE] Код товара (без привязки к контрагенту).
		\end{description}

		\item[CURRENCY]
		Валюта значения котировки. Если не указана, то устанавливается значение
		котировки с неопределенной валютой.

		Подкритерии:
		\begin{description}
			\item[ID]   (default) Идентификатор валюты.
			\item[CODE] Символ валюты (не путать с цифровым кодом валюты).
		\end{description}

		\item[VALUE]
		Собственно, значение котировки.
	\end{description}
\end{description}

\paragraph{Примеры} Приведем примеры использования команды SET:

set quot kind(1) goods.code(4602666140609) location.code(1400000001) value(65.90)

set goodsarcode goods.code(46072740) seller.code(tobacco-world) value(33001)

\subsubsection{SETGLOBALUSER}

Устанавливает значение глобальной учетной записи для текущего потока сервера.
	\paragraph{Параметры}
	\begin{description}
		\item[GlobalUser] Наименование или идентификатор устанавливаемой глобальной
		учетной записи. Если этот параметры может быть интерпретирован системой
		как число и существует идентификатор глобальной учетной записи, равный этому
		числу, то текущей устанавливается эта запись. В противном случае система ищет
		запись по имен, соответствующем этому параметру и, если находит, то устанавливает
		такую запись текущей.

		Если идентифицировать запись по параметру не удалось, то возвращается ошибка.
	\end{description}
	\paragraph{Возвращаемые значения}
	\begin{description}
		\item[1] Удалось установить текущую глобальную учетную запись.
		\item[0] Ошибка. Сообщение об ошибке можно получить вызовом команды GETLASTERR.
	\end{description}

\subsubsection{GETGLOBALUSER}

Возвращает идентификатор текущей глобальной учетной записи.
	\paragraph{Параметры} Отсутствуют.

\subsubsection{CCHECKCREATE}
Инициирующая команда для создания распределенного кассового чека.

\paragraph{Параметры} Синтаксис параметров этой команды аналогичен синтаксису параметров
команды \ppyrsrv{SELECT}. То есть, в произвольном порядке перечисляются критерии запроса.
Вот список допустимый критериев:
\begin{description}
	\item[POSNODE] Определяет кассовый узел, которому должен принадлежать чек.
	Этот узел обязательно должен иметь тип распределенного кассового узла.
	\item[LOCATION]
	\item[SCARD]
	\item[AMOUNT]
	\item[DISCOUNT]
\end{description}

\subsubsection{CCHECKADDLINE}
Не реализована. Команда добавления в распределенный кассовый чек новой
строки.

\subsubsection{CCHECKFINISH}
Завершающая команда создания распределенного кассового чека.

\subsubsection{SCARDREST}
Возвращает остаток стредств на кредитной либо бонусной карте.

\subsubsection{SCARDWITHDRAW}
Выполняет операцию списания заданной суммы с кредитной либо бонусной карты.

\subsubsection{SETPERSONREL}
Создает отношение заданного типа между персоналиями.

Критерии:
\begin{description}
	\item[PRIMARY]
	Обязательный параметр.
	Первичная персоналия в отношении.
	Подкритерии:
		\begin{description}
			\item[ID]   (default) Идентификатор персоналии.
			\item[CODE]  Номер поискового регистра вида персоналии (не путать с поисковым регистром таблицы аналитических статей).
			\item[NAME]  Наименование персоналии (поиск по точному соответствию имени без учета регистров символов).
		\end{description}

	\item[SECONDARY]
	Обязательный параметр.
	Вторичная персоналия в отношении.

	Подкритерии те же, что и у первичной персоналии.

	\item[PERSONRELTYPE]
	Обязательный параметр.
	Тип персонального отношения.
	Подкритерии:
		\begin{description}
			\item[ID]   (default) Идентификатор типа персонального отношения.
			\item[CODE]  Символ типа персонального отношения.
			\item[NAME]  Наименование типа персонального отношения (поиск по точному соответствию имени без учета регистров символов).
		\end{description}

\end{description}

\subsubsection{GETPERSONREL}
Возвращает список персоналий, связанных с заданной отношениями.

Критерии:
\begin{description}
	\item[PRIMARY]
	Первичная персоналия в отношении.
	Подкритерии аналогичны используемым в команде SETPERSONREL.

	Если этот параметр указан, то команда возвращает список персоналий, с которыми связана эта персоналия.

	\item[SECONDARY]
	Вторичная персоналия в отношении.
	Подкритерии аналогичны используемым в команде SETPERSONREL.

	Если этот параметр указан, но PRIMARY не определен, то команда возвращает список персоналий, которые связаны с этой персоналией (обратные отношения).
	Если определены и PRIMARY и SECONDARY, то возвращается SECONDARY, если она связана с PRIMARY либо отношением PERSONRELTYPE,
	либо любым отношением при отсутствии критерия PERSONRELTYPE.

	\item[PERSONRELTYPE]
	Тип персонального отношения.
	Подкритерии аналогичны используемым в команде SETPERSONREL.

	Критерий ограничивает список возвращаемых персоналий только теми, которые имеют данный тип отношения.

\end{description}

\subsubsection{SETOBJECTTAG} % TAG.CODE(LikeCount) PERSON(95302) VALUE(10)
Устанавливает значение тега для объекта данных.

Критерии:
\begin{description}
	\item[TAG]
	Обязательный параметр. Может присутствовать в команде один и только один раз.
	Тип тега, значение которого должно быть установлено.
	Подкритерии:
		\begin{description}
			\item[ID]   (default) Идентификатор типа тега.
			\item[CODE]  Символ типа тега.
			\item[NAME]  Наименование типа тега.
		\end{description}

	\item[PERSON]
	Если тег относится к персоналиям, то этот критерий определяет персоналию, для которой должно быть
	установлено значение тега.

	Критерий может присутствовать в команде более одного раза: в этом случае значение тега будет установлено
	для каждой из идентифицированных этим критерием персоналии.

	Если до этого критерия в команде уже встречались критерии \ppyrsrv{GOODS} или \ppyrsrv{GLOBALUSER},
	то сервер вернет ошибку смешения типов объектов.

	Если тег, заданный критерием \ppyrsrv{TAG} не относится к типу объектов \ppyrsrv{Персоналии}, то сервер
	вернет ошибку несоответствия тега объекту, к которому он применяется.

	\item[GOODS]
	Если тег относится к товару, то этот критерий определяет товар, для которого должно быть
	установлено значение тега.

	Критерий может присутствовать в команде более одного раза: в этом случае значение тега будет установлено
	для каждого из идентифицированных этим критерием товаров.

	Если до этого критерия в команде уже встречались критерии \ppyrsrv{PERSON} или \ppyrsrv{GLOBALUSER},
	то сервер вернет ошибку смешения типов объектов.

	Если тег, заданный критерием \ppyrsrv{TAG} не относится к типу объектов \ppyrsrv{Товары}, то сервер
	вернет ошибку несоответствия тега объекту, к которому он применяется.

	\item[GLOBALUSER]
	Если тег относится к глобальной учетной записи, то этот критерий определяет учетную запись, для которой должно быть
	установлено значение тега.

	Критерий может присутствовать в команде более одного раза: в этом случае значение тега будет установлено
	для каждой из идентифицированных этим критерием глобальных учетных записей.

	Если до этого критерия в команде уже встречались критерии \ppyrsrv{PERSON} или \ppyrsrv{GOODS},
	то сервер вернет ошибку смешения типов объектов.

	Если тег, заданный критерием \ppyrsrv{TAG} не относится к типу объектов \ppyrsrv{Глобальные учетные записи}, то сервер
	вернет ошибку несоответствия тега объекту, к которому он применяется.

	\item[VALUE]
	Значение, которое должно быть установлено у тега. Если критерий пустой или отсутствует, то значение тега
	для выбранных объектов будет удалено.

\end{description}

\paragraph{Примеры} Приведем примеры использования команды SETOBJECTTAG:

setobjecttag tag{key} goods.code(4602666140609) value(коврик)
setobjecttag tag{vip} person.code(51207) person.code(14018) value(1)

\subsubsection{INCOBJECTTAG} % TAG.CODE(DislikeCount) PERSON(95302)
Увеличивает значение тега для объекта данных.

Критерии аналогичны тем, что применяются для команды \ppyrsrv{SETOBJECTTAG}. Несколько меняется смысл критерия \ppyrsrv{VALUE}:
если критерий пуст или отсутствует, то значение тега увеличивается на единицу.

Если значение критерия \ppyrsrv{VALUE} не пустое и не может быть преобразовано к положительному числу, то сервер
возвращает ошибку.

Если тип тега не числовой, то сервер возвращает ошибку.

\subsubsection{DECOBJECTTAG} % TAG.CODE(DislikeCount) PERSON(95302)
Уменьшает значение тега для объекта данных.

Команда полностью аналогична \ppyrsrv{INCOBJECTTAG} с той лишь разницей, что значение тега уменьшается.

\subsubsection{GETOBJECTTAG} % TAG.CODE(DislikeCount) PERSON(95302)
Возвращает значение тега объекта данных.

Критерии:
\begin{description}
	\item[TAG]
	Обязательный параметр. Может присутствовать в команде один и только один раз.
	Тип тега, значение которого должно быть возвращено.
	Подкритерии:
		\begin{description}
			\item[ID]   (default) Идентификатор типа тега.
			\item[CODE]  Символ типа тега.
			\item[NAME]  Наименование типа тега.
		\end{description}

	\item[PERSON]
	Если тег относится к персоналиям, то этот критерий определяет персоналию, для которой должно быть
	возвращено значение тега.

	Критерий может присутствовать в команде более одного раза: в этом случае будет возврашено значение тега
	для каждой из идентифицированных этим критерием персоналии.

	Если до этого критерия в команде уже встречались критерии \ppyrsrv{GOODS} или \ppyrsrv{GLOBALUSER},
	то сервер вернет ошибку смешения типов объектов.

	Если тег, заданный критерием \ppyrsrv{TAG} не относится к типу объектов \ppyrsrv{Персоналии}, то сервер
	вернет ошибку несоответствия тега объекту, к которому он применяется.

	\item[GOODS]
	Если тег относится к товарам, то этот критерий определяет товар, для которого должно быть
	возвращено значение тега.

	Критерий может присутствовать в команде более одного раза: в этом случае будет возврашено значение тега
	для каждого из идентифицированных этим критерием товаров.

	Если до этого критерия в команде уже встречались критерии \ppyrsrv{PERSON} или \ppyrsrv{GLOBALUSER},
	то сервер вернет ошибку смешения типов объектов.

	Если тег, заданный критерием \ppyrsrv{TAG} не относится к типу объектов \ppyrsrv{Товары}, то сервер
	вернет ошибку несоответствия тега объекту, к которому он применяется.

	\item[GLOBALUSER]
	Если тег относится к глобальным учетным записям, то этот критерий определяет учетную запись, для которй должно быть
	возвращено значение тега.

	Критерий может присутствовать в команде более одного раза: в этом случае будет возврашено значение тега
	для каждой из идентифицированных этим критерием глобальных учетных записей.

	Если до этого критерия в команде уже встречались критерии \ppyrsrv{PERSON} или \ppyrsrv{GOODS},
	то сервер вернет ошибку смешения типов объектов.

	Если тег, заданный критерием \ppyrsrv{TAG} не относится к типу объектов \ppyrsrv{Глобальные учетные записи}, то сервер
	вернет ошибку несоответствия тега объекту, к которому он применяется.

\end{description}

\chapter{Настройка и администрирование системы\label{sec-config}}

Система \ppybrand{}, являясь достаточно сложным программным продуктом, требует квалифицированной
и аккуратной настройки для того, чтобы приносить максимальную пользу при использовании на
конкретном предприятии. Кроме того, для эффективного разграничения прав пользователей
система предусматривает ведение справочников пользователей и пользовательских групп.
Настоящий раздел посвящен именно этим темам и адресован, главным образом, персоналу,
занимающемуся сопровождением и администрированием системы.

\section{Файлы конфигурации}
Некоторые параметры системы, особенно те, которые необходимы для первичной инициализации рабочих сеансов, задаются в
специальном файле конфигурации pp.ini, который находится в том же каталоге, где и исполняемые файлы системы (обычно, PPY/BIN).
Кроме того, в этом же каталге есть ряд других ini-файлов, используемых системой для работы.

\subsection{Параметры файла pp.ini}
В этом подразделе мы перечислим основные параметры файла pp.ini. Из описание мы разобъем по зонам, в которых они
определяются.

\begin{description}
	\item[[path]] Эта зона описывает каталоги файловой системы, используемые системой для различных
	операций. Не все каталоги задаются здесь, часть определяются настройками в базе данных для пользователей и их групп.

	\begin{description}
		\item[sys]
		\obsolete{Путь к словарю данных}.
		\item[dat]
		Путь к базе данных (по умолчанию)
		\item[arc]
		\obsolete{Путь к архивной копии базы данных}.
		\item[pack]
		Путь к каталогу, в котором хранятся некоторые, распространяемые
		с дистрибутивом файлы, необходимые для правильной работы различных функций.
		\item[temp]
		Путь к каталогу временных файлов.
		\item[BizScorePath]
		Путь к каталогу содержащему папки бизнес-показателей.
	\end{description}

	\item[[drivemapping]] Зона, которая устанавливает соответствия между привычными буквенными обозначениями
	дисков (в том числе подключаемых сетевых) и канонизированными определениями путей в вашей компьютерной сети (UNC).

	\item[[server]] Сюда включены параметры, необходимые для работы сервера \ppybrand{}.
	\begin{description}
		\item[name]
			Адрес компьютера, на котором запущен JobServer. Это может быть как ip-адрес, так и символьное наименование.
			\ppyexample{
				server = servercomp

				server = 192\.168\.0\.15
			}

		\item[port]
			Номер порта JobServer'а. Если этот параметр отсутствует либо его значение
			меньше или равно нулю, то полагается порт по умолчанию =28015.

		\item[sockettimeout]
			Таймаут серверного сокета при чтении данных сервером от клиента в миллисекундах.
			По умолчанию = 60000.
		\item[clientsockettimeout]
			Таймаут клиентского сокета при чтении данных клиентом от сервера в миллисекундах.
			По умолчанию = 120000.
		\item[ClosedSocketTimeout]
			Таймаут жизни серверной сессии после разрыва соединения с клиентом в миллисекундах.
			Допускается нулевое значение.
			По умолчанию = 60000.
		\item[SuspendedSocketTimeout]
			Таймаут ожидания серверной сессией возврата клиентской сессии после команды SUSPEND.
			Клиентская сессия может самостоятельно переопределить данное значение параметром команды SUSPEND (см документацию).
			Допускается нулевое значение.
			По умолчанию = 3600000.
		\item[SleepSocketTimeout]
			Таймаут ожидания серверной сессией хоть какой-то активности со стороны клиента.
			После завершения таймаута, если активности не было, сессия закрывается.
			По умолчанию бесконечность.
		\item[TextCommandTerminal]
			Терминальная последовательность текстовых команд сервера.
			Возможно одно из следующих значений:
			\begin{description}
				\item[-1] по умолчанию (без терминала).
				\item[0] без терминала: команда считывается из сокета до тех пор, пока в сокете есть что-то.
				\item[1] \textbackslash xD\textbackslash xA символ перевода каретки совмещенный с символом новой строки.
					Стандартная для Windows последовательность перехода на новую строку.
				\item[2] \textbackslash xD\textbackslash xA\textbackslash xD\textbackslash xA сдвоенная пара "перевод каретки/новая строка"
				\item[3] \textbackslash xD одиночный (8 бит) символ перевода каретки
				\item[4] \textbackslash xA одиночный (8 бит) символ новой строки
				\item[5] \textbackslash x0 одиночный (8 бит) бинарный ноль
			\end{description}
			Клиентская сессия может переопределить терминальную последовательность командой SETTXTCMDTERM code.
	\end{description}

	\item[[dbname]] Зона, описывающая точка входа в базы данных, используемых вашей инсталляцией \ppybrand{}.

	\item[[system]] Эта зона предназначена для определения ряда системных параметров. Она на текущий момент
	устаревшая и никакие новые параметры в нее не добавляются. Те, которые привязаны к ней, переносятся постепенно
	в иные зоны.

	\item[[config]] Основная зона для конфигурационных параметров.
		\begin{description}
		\item[invoice\_excise\_columns]
			[1|0]

			Печатать счет-фактуру с колонками акциза
		\item[label\_file]
			Имя файла с описанием этикеток принтера штрихкодов
		\item[barlabelprint\_delay]
			Печать этикеток на принтере штрихкодов.
			Задержка в миллисекундах между отправкой на принтер каждой
			строки товарного документа. Допустимые пределы [1..10000].
			Если параметр не задан или выходит за указанные пределы,
			то задержка принимается в 250 миллисекунд.
			Замечание: после каждой десятой строки программа формирует неуправляемую задержку в 2000 миллисекунд.
		\item[goodsrest\_pack]
			[1|0]

			Остатки товаров показываются с емкостью упаковки
		\item[trfritem\_pack]
			[1|0]

			В диалоге строки товарного документа остатки показываются в упаковках
		\item[goodsbillfilt\_showdebt]
			[1|0]

			В фильтре товарных документов сразу устанавливать флаг "Показывать долги"
		\item[ecogoodssel]
			[1|0]

			(Только DOS) Выбор товаров реализуется в экономичном (по памяти) режиме
		\item[nologinprompt]
			[1|0]

			Если база данных и имя пользователя указаны в командной строке, то
			система не выдает запрос на вход в систему. Пароль у пользователя должен отсутствовать.
		\item[UseSjLoginEvent]
			[1|0]

			Если параметр UseSjLoginEvent установлен в значение, отличное от 0, то при авторизации
			и при завершении сеанса создаются события в системном журнале LOGIN и LOGOUT.
			До версии 8.2.5 такие события создавались безусловно, однако теперь надобность в них
			практически отсутствует.
			По умолчанию - 0
		\item[MaxLogFileSize]
			Максимальный размер файла журнала, после превышения которого файл переименовывается и
			создается новый.
			Размер указывается в килобайтах (Kb).
			Например: MaxLogFileSize=65536 означает, что размер файлов не должен превышать 64MB
			По умолчанию: 32768 (32MB)
		\item[3tier]
			[1|0]

			Сеанс пытается установить соединение с JobServer'ом.
			Адрес сервера берется из секции [server].

		\item[cashordincstax]
			[1|0]

			В сумму приходного кассового ордера включать налог с продаж из налоговых сумм
			Если по документу отгрузки налог с продаж не выделяется, а платеж должен включать налог с продаж,
			то в налоговой сумме, отражающей налог с продаж может быть указана сумма налога. Тогда сумма
			приходника увеличивается на сумму налога с продаж.
		\item[433OldGenBarcodeMethod]
			[1|0]

			Запрет на использование нового метода генерации
			штрихкода по шаблону. Аварийный параметр, на случай, если новый (более быстрый,
			но и более сложный) метод будет сбоить.
		\item[TimeServer]
			time\_server\_name[,force]

			Имя или адрес сервера, с которым синхронизировать время рабочей станции

			Если после запятой установлено не нулевое значение,
			то при изменении системного времени в течении сеанса программа
			сверит новое время с сервером time\_server\_name и при расхождении
			вернет время на рабочей станции в значение, соответствующее серверу.

			Примеры:
				TimeServer=192\.168\.0\.1

				TimeServer=CentralSever,1

		\item[SupportMail]
			Электронный адрес службы поддержки.

		\item[ExportCrukmSections]
			[1|0]

			Загружать в кассовый модуль Кристалл-УКМ номера секций для товаров.
		\item[BarcodeLowPriority]
			prefix,length

			Штрихкоды с минимальным приоритетом (в нижней части списка штрихкодов товара)
			Первое значение - префикс, второе - длина. Можно опустить как один так и второй параметр.
			Например: BarcodeLowPriority=,9 означает что штрихкоды с длиной 9 символов
			имеют самый низкий приоритет независимо от префикса.
		\item[ShtrihFRNoUseContPrn]
			[1|0]

			В модуле управления фискальным регистратором
			Штрих-ФР не проверять вывод чека на продолжение печати.
			see SCS\_SHTRIHFRF::AnnulateCheck() file SHTRIHFR.CPP
		\item[ShtrihFRConnectParam]
			baud\_rate,timeout

			Параметры обмена для Штрих-ФР
			baud\_rate\=(2..6): 2\-9600, 3\-19200, 4\-38400, 5\-57600, 6\-115200

			timeout=(0..255)

		\item[ShtrihFRNotUseWeightSensor]
			Не использовать весовые датчики наличия чековой ленты в Штрих-ФР.
		\item[CashierTabNumSymb]
			набор символов в типе регистрационного документа.

		\item[TwosizeBarcodeFormat]
			min\_barcode\_len,fmt\_descr\_offset,fmt\_descr,barcode\_offset,barcode\_len[;...]

			Описание формата для двумерных штрихкодов
			min\_barcode\_len  - min длина штрихкода, который надо преобразовать
			fmt\_descr\_offset - смещение описания формата [0..]
			fmt\_descr        - описание формата (не более 15 символов)
			barcode\_offset   - смещение штрихкода [0..]
			barcode\_len      - длина штрихкода

			Например: TwosizeBarcodeFormat=20,,0178,12,6;20,0,0278,12,6
		\item[SCardPatterns]
			"prefix*C*postfix"

			Описание шаблонов персональных карт (если несколько - через ;, обязательно в кавычках)
				prefix, postfix - любой набор символов (включая ; и ", исключение - ";)
		\item[acgialg]
			[0,1,2]

			Алгоритм формирования списка измененных товаров для асинхронных кассовых сессий.
			\begin{description}
				\item[0] традиционный - перебирается весь справочник товаров для идентификации
					тех позиций, цены по которым изменились. Список измененных товаров
					извлекается из системного журнала
				\item[1] традиционный с тестом алгоритма "по измененным документам". Переходный
					режим, позволяющий оценить погрешность перехода на алгоритм 2. Позиции,
					которые должны быть признаны измененными в соответствии с алгоритмом 0,
					но не признаны таковыми в соответствии с алгоритмом 2, заносятся в
					файл журнала ppinfo.log сообщением
					"AsyncCashGoodsIterator miss: [id=ид товара] наименование товара"
				\item[2] алгоритм "по изменениям документов". По системному журналу извлекается
					список документов, которые были добавлены или изменены с момента
					последней загрузки кассового узла. По документам, которые влияют на состояние
					склада, извлекается список товаров, в него вливается список измененных
					товаров, и перебор идет уже по результирующему списку, а не по всему
					справочнику товаров
			\end{description}
		\item[AcgiPriceLookBackPeriod]
			Специальный параметр для идентификации нескольких различных цен на один
			товар. Задает количество дней, за которые необходимо просмотреть лоты
			товара на предмет наличия нескольких открытых лотов с различными ценами.
			Максимальное допустимое значение 730
			Отрицательные знания и значения, превышающие максимум трактуются как 0 (не определенные)
		\item[SCardDefPerson]
			PersonName

			Описание персоналии для автоматического заполнения персональных карт.
			PersonName - имя персоналии без кавычек.
		\item[SupplExpBillFileMaxSize]
			Максимальный размер файла с накладными для экспорта данных для поставщика в килобайтах.
		\item[SetR\_AddTimeToFileNames]
			Имена DBF-файлов для экспорта в Сет-Ретейл дополнять временем создания.
		\item[SetR\_UseNewDscntCodeAlg]
			При экспорте в Сет-Ретейл использовать новый алгоритм формирования кодов скидок.
		\item[UseGoodsLocAssocToExtCashNode]
			Использовать ассоциацию товар-склад для печати чека на дополнительный кассовый узел (Штрих-ФР).
		\item[PSales\_GoodsQuant]
			Заполнение таблицы продаж: размер кванта товарных идентификаторов
			по которому формируются записи в таблице. Чем больше это значение,
			тем быстрее осуществляется расчет, но, с другой стороны, при увеличении
			значения возникает вероятность того, что сервер базы данных не справится //
			с большими транзакциями (сообщение "Нет доступных кэш-буферов").
			Кроме того, при росте этой величины значительно увеличивается требование
			к доступной памяти на рабочей станции, на которой выполянется обработка.
			! Указанное здесь значение округляется до степени 2 в меньшую сторону.
			По умолчанию: 512. Максимальное допустимое значение: 32*1024.
		\item[PSales\_MaxTime]
		Предельное время работы процесса заполнения таблицы продаж в секундах.
		Процесс построения после завершения каждого кванта товаров
		проверяет общее время работы и, если оно превышает указанное
		этим параметром, то процесс обрывается.
		Нулевое или отрицательное значение не ограничивает процесс по времени.

		Допустимый диапазон [0..24*60*60*7].
		По умолчанию 0.

		\item[debug\_trfr\_error]
			Если значение параметра не ноль, то после каждого проведения
			товарного документа система проверяет корректность лотов и текущих товарных
			остатков, затрагиваемых этим документом.
			Опция необходима из-за того, что с этой проблемой пора кончать.

			По умолчанию 0.
		\item[debug\_mtx\_dirty]
			При ненулевом значении параметра в журнал mtxdirty.log будет
			выводиться информация об актуализации кэша товарной матрицы.
			Данный лог отладочный и нужен только на время идентификации
			проблем с означенной актуализацией.

			По умолчанию 0.
		\item[DontUse3TierGMtx]
			[0|1]

			Начиная с версии 8.1.9 в 3-tier режиме клиентские сессии извлекают
			товарную матрицу с сервева. Если в механизме такого извлечения возникнут
			проблемы, то его следует отключить установкой данного параметра в 1
		\item[jobserver\_notify]
			Список email-адресов, разделяемых символом ";",
			для рассылки уведомлений о выполнении задач сервером

			Пример: jobserver\_notify=mail@petroglif.ru;admin@petroglif.ru
		\item[AcceptDupTimeCheck]
			[0|1]

			Принимать из другого раздела чеки с дублируемым ключем {Dt, Tm, CashID}
			Если параметр равен 1, тогда при приеме кассовых чеков
			из другого раздела программа будет смещать время чека, если
			в базе данных уже есть чек с такой же комбинацией {Dt, Tm, CashID}.

			ВНИМАНИЕ! Флаг аварийный. Предназначен только для временного применения.
			При неоправаднном использовании может привести к неправильному
			акцепту кассовых сессий.

		\item[RcptDlvrLocAsWarehouse]
			[0|1]

			Если !0, то в диалоге товарного документа прихода (тип операции "Приход товара") при выборе
			адреса доставки выбор осуществляется из списка складов главной организации.
			Если параметр отсутствует или 0, то выбор осуществляется из списка адресов доставки
			контрагента (как для осталный типов операций, кроме драфт-прихода, для которого
			выбор склада как адреса доставки безусловный).

			Параметр проверяется только при запуске сеанса.
			v9.1.11 Параметр устарел. Вместо него следует использовать соответствующий флаг в виде операции.
		\item[GoodsClassAlc]
			GoodsClassSymb,proof,volume

			Класс товара алкоголь (используется в CrystallSetV10)
			proof(процент крепости) и volume(объем) принимают значения [x|y|w|z] из класса товара
		\item[GoodsClassTobacco]
			Символ класс товара табачных изделий (используется в CrystallSetV10).

		\item[GoodsClassGiftCard] ;=GoodsClassSymb
			Символ класса товара подарочных карт (используется в CrystallSetV10).

		\item[CloseAsyncSess\_UseAltImport]
			1[;file\_rpt,file\_flag,file\_goods,file\_goods\_flag]

			Использовать альтернативный вариант импорта кассовых сессий
			(для Сет-Ритейл или Атола, работающих со сторонними приложениями).
			\begin{description}
				\item[file\_rpt] имя файла отчета по кассовым сессиям. По умолчанию atolexp.txt
				\item[file\_flag] имя файла запроса отчета по кассовым сессиям. По умолчанию atolexp.flg
				\item[file\_goods] имя файла справочника товаров. По умолчанию goods.txt
				\item[file\_goods\_flag] имя файла запроса справочника товаров. По умолчанию getgoods.txt
			\end{description}
		\item[JobServerAddrPort]
			addr:port

			Адрес и порт (через :) Job сервера для получения информации о запущенных задачах
		\item[report\_force\_ddf]
			[1|0]

			Если значение параметра != 0, то
			при формировании данных для отчетов система будет создавать
			файлы словарей. В противном случае, если используется словарь
			на основе DL600, то файлы словаря создаваться не будут.

			Ранее файлы словаря создавались в любом случае. Однако, как
			выясняется, для печати CrystalReports'у словарь не нужен,
			но требуется лишь в том случае, если по сформированным данным
			вы хотите создать или отредактировать отчет.

		\item[DetectDbtExistByOpen]
			[1|0|100]
			Идентификация существования файла базы данных осуществляется путем попытки открытия файла
			а не методом операционной системы, выявляющей существование файла.
			Опция экспериментальная - введенна в рамках борьбы с задержками при создании
			файлов Btrieve в Windows 7, Windows 8 и Windows Server 2008
			По умолчанию 1.

			Если установлено значение 100, то при подготовке данных для печати также используется функция Btrieve.

		\item[BtrNwLock]
			MaxTries[,Delay]

			Параметры блокировки записей без ожидания.
			MaxTries - максимальное количество повторных попыток если запись заблокирована.
			  Если MaxTries=0 - то используются блокировки с ожиданием (как в версиях до 8.0.2)
			Delay - таймаут между повторными попытками блокировки в миллисекундах (по умолчанию 10).
			Если BtrNwLock отсутствует либо задан некорректно, то используются блокировки без ожидания с
			максимальным числом попыток 20 и таймаутом 10мс.
		\item[AutoInputTolerance]
			[1..100]

			Минимальная средняя задержка между вводом последовательных
			символов в строке ввода, при значениях выше которой, система
			считает, что символы введены в ручную.
		\item[KitchenBellCmd]
			hex\_command

			Строка команды, посылаемой на локальный принтер, оснащенный кухонным звонком,
			для подачи сигнала. Эта строка должна быть представлена набором пар шестнадцатиричных
			символов. Каждая пара преобразуется программой в бинарный байт, посылаемый на устройство.
			Например: 1B70000505.
			Если количество символов в строке нечетное либо хотя бы один из символов не
			является шестнадцатиричным [0-9A-Fa-f] строка считается не действительной и сигнал на принтер
			не подается (в файле pperror.log появится запись об ошибке).
			Если этот параметр пустой или отсутствует, то система подает команду по умолчанию.
		\item[PosRegisterKeepAlive]
			При работе с кассовым регистратором удерживать открытым соединение.
			Опция введена в качестве возможности аварийного отключения режима (которые обещает увеличение
			производительности при работе с оборудованием).
			По умолчанию=1.
		\item[SpecEncodeSymbs] ;=EncodeSymb1,SubStr1;EncodeSymb2,SubStr2...

			Где EncodeSymb1,EncodeSymb2... специальные символы которыми кодируются подстроки
			SubStr1,SubStr2...

		\item[LikenessRate]
			В таблицу похожих объектов заносятся только те объекты, рейтинг похожести которых
			>= LikenessRate. Если LikenessRate не задан или <=0, то считается что он равен 0.5.

		\item[BizScore\_DbSymb]
			Символ базы данных для получения бизнес-показателей через TCP/IP (при этом
			используется учетная запись $SYSSERVICE$.

		\item[TSGGroupsAsButtons]
			В кассовой панели для сенсорного экрана элементы списка товаров и групп отображаются как кнопки.

		\item[TSGGroupListFlat]
			[1|0]

			В кассовой панели для сенсорного экрана список товарных групп не иерархический, но при выборе
			группы верхнего уровня следующий уровень полностью заполняет список. Возврат к следующему
			уровню осуществляется кнопкой [Back] (над списком).

		\item[Shtrih\_MFRK\_Timeout]
			Таймаут (в милисекундах) для Штрих-М-ФР-К на получение файлов с устройства

		\item[AtolTimeout]
			Таймаут при загрузке чеков из кассового модуля АТОЛ (миллисекунды).
			По умолчанию 5000.
		\item[AtolQuantityWOSale]
			При обновлении сессии в Атоле остатки за вычетом продаж.
		\item[FrontolImportDelay]
			Задержка в миллисекундах между исчезновением сигнального файла и началом
			импорта из файла чеков, сформированного кассовым модулем Frontol
			Если значение параметра меньше нуля, то задержка не применяется вообще.
			Если параметр отсутствует или имеет нулевое значение, то
			применяется задержка по умолчанию (1000 миллисекунд)

		\item[FrontolCrdCardAsDsc]
			[1|0]

			Если этот параметр установлен в значении !0, то
			на кассовый модуль Фронтол кредитные карты
			загружаются так же как и дисконтные. В противном
			случае кредитные карты загружаются как сертификаты.
		\item[FrontolSkipDiscountSchemes]
			[1|0]

			Если значение параметра установлено в 1, то на frontol не будут загружаться дисконтные схемы.
			По умолчанию 0.
		\item[EnableExcelImpExp]
			Возможность экспорта/импорта данных в excel
		\item[LogCCheck]
			[1|0]

			Заносить в журнал ccheck.log информацию об операциях с кассовымии чеками.
			До версии 6.5.10 признаком необходимости вести такой журнал был параметр debug=1.
			Так как необходимость ведения данного журнала определяется функциональными требованиями
			к использованию системы, пришлось ввести отдельный параметр для этого.

		\item[DL600XMLEntity]
			Строка символов, которые должны заменяться XML-сущностями при экспорте в XML
			средствами модуля DL600. Если первый символ '-', то последующие символы исключаются из замены.
			Например:
				\&<>'     будут заменены только приведенные символы
				-,./\textbackslash    будут заменены все, предполагаемые (программой) символы, кроме ,./\textbackslash

		\item[adjcpancclinetrans]
			[1|0]

			При преобразовании строки чека из кассовой панели в запись CCheckLine корректировать
			разницу за счет скидки.
			Необходимость в установке параметра может возникнуть при работе с товарами, которые продаются большими
			количествами и по ценам, имеющим более двух знаков после точки.
			Возможно, правило такой корректировки должно быть применено во всех случаях, однако, во
			избежании проблем с работающими инсталляциями, страхуемся вводом данного параметра.

		\item[CodePrefixedList]

		\item[DisableAsyncAdvQueue]
			Если !0, то асинхронная очередь системных событий не применяется.
			Асинхронная очередь системных событий - это специальный поток, которых
			извлекает события из системного журнала и других источников для онлайнового оповещения
			пользовательского сеанса.

		\item[AdviseEventCollectorPeriod]
			Период опроса потоком асинхронной очереди системных событий системного журнала (в миллисекундах).

		\item[InvcMergeTaxCalcAlg2Since]
			Дата, начиная с которой применяется алгоритм 2 для расчета налогов по объединенным строкам счет-фактуры (для печати).
			Алгоритм 2 заключается в расчете налогов раздельно по каждой из объединяемых строк и последующем суммировании
			результата. Алгоритм 1, применяющийся по умолчанию (и ранее релиза 8.6.0) рассчитывает налоги по объединенной строке
			в целом.
			Отсутствие параметра или не допустимое значение даты трактуется как предписание применять традиционный алгоритм (1).
\end{description}


\end{description}



\section{Главная конфигурация}

Главная конфигурация содержит набор параметров и прав доступа, определенных либо для всех
пользователей и пользовательских групп, либо используемых по умолчанию в случае, если параметр
либо право доступа не определены для конкретного пользователя.

Перечислим основные группы параметров главной конфигурации:
\begin{itemize}
	\item Пути к каталогам системы
	\item Конфигурационные параметры
	\item Права доступа
\end{itemize}

\section{Объекты администрирования конфигурации и прав доступа}

Система управляет следующими категориями объектов администрирования основной конфигурации и правами доступа:
\begin{description}
	\item[Главная конфигуация] Корневой объект, содержащий набор параметров, которые могут быть унаследованы остальными
	объектами.

	\item[Пользователи] Основной объект управления параметрами конфигурации. При открытии любого сеанса работы
	с базой данных человек (или компьютерный компонент) обязан зарегистрироваться в базе данных под определенным
	именем, соответствующим записи пользователя. Авторизация доступа осуществляется путем ввода пароля.

	\item[Группы пользователей] Контейнерный объект, позволяющий объединить несколько пользователей. Каждый
	пользователь принадлежит одной и только одной группе. Права доступа и параметры конфигурации могут
	наследоваться от группы к пользователю (что не исключает для конкретного пользователя определения прав доступа и конфигурации,
	отличных от аналогичных, заданных для группы, которой он принадлежит).

	\item[Исключения прав доступа]
	Специальный объект управления, позволяющий сделать исключения в правах доступа пользователя при выполнении
	некоторых операций. Как правило, такие исключения применяются для того, чтобы предоставить пользователю
	возможность выполнить некоторое сложное действие, включающее операции, права на которые у него отсутствуют.
	Например, списание кассовой сессии для пользователя не имеющего права создавать документы.
\end{description}

\ppypict{dlg-grpnusr}{Окно администрирования групп и пользователей}

Права доступа и многие конфигурационные параметры в системе \ppybrand{} разграничиваются по
пользователям.

Пользователь - это регистрационное имя под которым тот или иной человек входит в систему для
работы с ней. Хотя это и не обязательно, но желательно, чтобы каждый человек, который работает
с системой имел сопоставленное ему имя пользователя. Это позволит четко специфицировать права
доступа и ответственность каждого конкретного человека. Для повышения секретности рекомендуется
каждому пользователю сопоставлять пароль для доступа к системе.

Группы пользователей - это объединение одного или нескольких пользователей по схожим
конфигурационным параметрам и правам доступа. Каждый пользователь принадлежит одной и только
одной группе.

Обратиться к полному списку групп, пользователей, главной конфигурации и исключений прав доступа
можно посредством пункта меню \ppymenu{Админ\rdir Группы и пользователи}. При этом в левой части экрана открывается
список, изображенный на рис.~\ref{pic-dlg-grpnusr}.



\section{Права доступа\label{sec-rights}}

Права доступа представляю собой обширный набор параметров, регламентирующих возможность
пользователей осуществлять те или иные действия, а также может ограничивать их в просмотре
ряда чувствительных данных.

\subsection{Общий диалог прав доступа}

\ppypict{dlg-rights}{Диалог редактирования прав доступа}

\begin{description}
	\item[Права по объектам]
	Список, в котором перечислены все объекты данных системы (кроме динамических).
	Для редактирования прав по конкретному объекту данных необходимо выбрать его
	в списке и нажать кнопку \dlgbutton{Редакт} или дважды щелкнуть мышью на
	этой строке.

	\item[Мин длина пароля]
	Не используется.

	\item[Период пароля]
	Не используется.

	\item[Период доступа к документа]
	Поля ограничивающих права на доступ к документам. Здесь могут быть
	применены шаблонизированные периоды (см. стр.~\pageref{sec-input-tamplatedate}).

	\ppynote {
		При использовании шаблонизированных периодов в полях ограничения
		периода доступа к документам следует иметь в виду, что это
		является потенциальной брешью в защите доступа, поскольку при
		определении эффективного периода доступа в этом случае программа
		опирается на текущую системную дату, которая может быть изменена
		пользователем компьютера (если он имеет для этого соответствующие
		привилегии).
	}
	\begin{description}
		\item[На чтение]
		Период доступа к документам на чтение блокирует возможность
		пользователя видеть документы, выходящие за этот период.

		Это включает в себя не только ограничение возможности видеть
		собственно документы, но и лимитирует расчет отчетов, по которым
		можно получить косвенную информацию о документах, выходящих за
		данных период.

		\item[На изменение]
		Если данное поле содержит не пустой период, то пользователь,
		на которого распространяется это ограничение, не сможет создать,
		изменить или удалить документ, выходящий за период.

		\item[\dlgflag{Действует и для кассовых сессий}]
		Если флаг установлен, то указанные периоды влияют на доступность кассовых сессий.
	\end{description}

	Следует иметь в виду, что ограничивающий период на чтение
	накладывается на период доступа на изменение. Связано это с тем,
	что раз пользователь не имеет права видеть документ, то автоматически
	он лишается прав на его изменение или удаление.

	\item[\dlgradioc{Доступ к документам по критерию создателя}]
	Переключатель, регламентирующий доступ к документам в зависимости
	от того, кто этот документ создал.

	\begin{description}
		\item[\dlgradioi{Не определено}]
		Ограничение не применяется.

		\item[\dlgradioi{Только к собственным документам}]
		Пользователь может видеть только те документы, которые
		сам же и создал.

		\item[\dlgradioi{Только к документам собственной группы}]
		Пользователь может видеть документы, которые созданы любым
		из пользователей, \emph{на данный момент} относящихся к той же
		группе, что и текущий пользователь.

		Обратим внимание на выделенное: если на момент создания документа
		пользователь относился к группе $A$, но на текущий момент
		относится к группе $B$ то в данное время все пользователи имеющие
		обсуждаемый тип ограничения доступа и принадлежащие группе $B$
		смогут видеть этот документ.
	\end{description}

	\item[Рабочие столы]
	Два флага, регламентирующие ограничения на использование рабочих столов.

	\begin{description}
		\item[\dlgflag{Создавать}]
		Пользователь имеет возможность создавать новые рабочие столы.

		\item[\dlgflag{Изменять}]
		Пользователь имеет право на изменение рабочего стола.
	\end{description}

	\item[\dlgbutton{Доступные операции...}]
	Кнопка, открывающая список доступных видов операций. Подробно этот список описан ниже.

	\item[\dlgbutton{Доступные склады...}]
	Кнопка, открывающая диалог со списком доступных складов.

	\item[\dlgbutton{Доступные счета...}]
	Эта кнопка открывает диалог, в котором могут быть определены
	доступные бухгалтерские счета, с которыми пользователь может работать.

	\item[\dlgbutton{Доступные конфигурации...}]
	Данная команда позволяет редактировать список конфигураций,
	которые пользователю разрешено изменять.

	\item[\dlgbutton{Доступные кассовые узлы...}]

	\item[\dlgbutton{Доступные виды котировок...}]

	\item[\dlgcombo{Единственная доступная товарная группа}]
	Товарная группа, ограничивающая пользователя работой со списком
	только тех товаров, которые принадлежат данной группе.

	\item[\dlgflag{Строгое ограничение группы}]
	Флаг, ассоциированный с комбо-боксом \dlgcombo{Единственная доступная товарная группа}. Его установка
	накладывает дополнительные рамки на пользователя, ограничивая его в выборе каких-либо иных товарных
	групп.

\end{description}

\subsubsection{Управление доступными видами операций}

\ppypict{dlg-rights-oplist}{Список доступных видов операций}

На рис.~\ref{pic-dlg-rights-oplist} изображен диалог редактирования списка доступных видов операций.
Для этого списка действуют следующие правила:
\begin{itemize}
	\item Если список пустой, то пользователю доступны все виды операций в рамках общих ограничений
	прав доступа по документам.
	\item Если список не пуст и какой-либо вид операции в нем не перечислен, то ни этот вид операции,
	ни документы, к нему относящиеся, пользователю не доступны вообще.
	\item Список может содержать обобщенные виды операций. В этом случае ограничения накладываются на
	все операции, принадлежащие обобщению с поправкой на метод разрешения неоднозначности, описанный
	ниже.
	\item Если список содержит одну и ту же операцию (например, в составе обобщений и саму по себе),
	то эффективными для этого вида операции оказываются только ограничения, заданные последними.
	Например, если операция \qu{Продажа покупателю} включена в список сама по себе, а вслед за ней
	включена обобщенная операция \qu{Все продажи}, включающая и \qu{Продажа покупателю}, то работать
	будут ограничения, накладываемые на \qu{Все продажи}, поскольку в списке они находятся ниже.
\end{itemize}

\ppypict{dlg-rights-oplistitem}{Элемент списка доступных видов операций}

Диалог редактирования элемента списка доступных операций изображен на рис.~\ref{pic-dlg-rights-oplistitem}.
Вот описание его управляющих элементов:

\begin{description}
	\item[\dlgflag{Действуют общие права доступа к документам}]
	Если флаг установлен, то документы, относящиеся к этому виду операций, доступны пользователю в рамках
	общих ограничений. При этом все остальные флаги, описанные ниже, блокируются.

	\item[\dlgflag{Просмотр}]
	Пользователь имеет право на просмотр документов, относящихся к этому виду операций.
	\item[\dlgflag{Создание}]
	Пользователь имеет право на создание документов, относящихся к этому виду операций.
	\item[\dlgflag{Модификация}]
	Пользователь имеет право на изменение документов, относящихся к этому виду операций.
	\item[\dlgflag{Удаление}]
	Пользователь имеет право на удаление документов, относящихся к этому виду операций.
\end{description}

%topic(DLG_COMMCFG)

\section{Общие настройки\label{sec-commcfg}}

\ppypict{dlg-099}{Общие настройки}

Общие параметры системы именуются так потому, что воздействуют на работу системы одинаково
для всех пользователей.

Для просмотра и редактирования этих настроек используется пункт меню \ppymenu{Админ\rdir Настройки}.
Следующая таблица поясняет параметры, которые можно выбрать в показанном на рис.~\ref{pic-dlg-099} диалоге.

\begin{description}
	\item[Счет поставщиков]
	Бухгалтерский счет, который вы используете для расчетов с поставщиками продукции и услуг.
	Система использует этот параметр для расчета некоторых отчетов. Например, оборотной ведомости
	по поставщикам.

	\item[Счет покупателей]
	Бухгалтерский счет, который вы используете для расчетов с вашими клиентами. Система использует
	этот параметр для расчета некоторых отчетов.

	\item[Счет кассы]
	Бухгалтерский счет, который вы используете для учета основных кассовых операций. Этот параметр
	используется, например, в отчете \qu{Кассовая книга}, при печати кассовых ордеров.

	\item[Счет расчетов с подотчетными лицами]
	\item[Счет учета основных средств]

	\item[\dlgradioc{Метод расчета доходности}]
	Метод, которым вы пользуетесь для вычисления налогооблагаемой базы и налоговых отчислений.
	Здесь возможны три варианта:
	\begin{description}
	 	\item[\dlgradioi{По флажкам операций}] система определяет способ расчета доходности
	 	по признаку \dlgflag{Доходная операция}, установленному или не установленному в видах
	 	операций, к которым относятся рассчитываемые документы.
		\item[\dlgradioi{По отгрузке}] доходность рассчитывается по документам отгрузки
		товара (предоставления услуг) либо прихода товара (получения услуги от поставщика).
		\item[\dlgradioi{По оплате}] доходность рассчитывается по мере поступления оплаты
		от клиентов, либо оплаты вами товаров либо услуг поставщика.
	\end{description}
	Мы не рекомендуем использовать первый вариант. Он нужен для совместимости с более старыми
	версиями системы.

	\item[\dlgflag{Цены заданы без налога с продаж}]
	Если этот флаг установлен, то система считает, что все цены реализации, заданные для
	товаров, не содержат налога с продаж. При этом, помечая документ отгрузки покупателю
	как облагаемый налогом с продаж, вы заставляете систему увеличивать общую сумму документа
	на величину этого налога. Если флаг не установлен, то система в аналогичном случае уменьшит
	сумму документа на величину налога с продаж.

	\ppynote{
		Внимание: ни в коем случае не следует переключать этот флаг без согласования с лицами,
		отвечающими за учетную политику предприятия, поскольку это может повлечь за собой
		значительные изменения в характере расчета товарных документов.
		Следующий флаг вносит изменение в описанную схему поведения системы.
	}

	\item[\dlgflag{Переключать налог с продаж не меняя цену}]
	Этот флаг используется в том случае, когда вы хотите помечать документ отгрузки товара
	покупателю как облагаемый налогом с продаж, но не изменять при этом общей суммы документа.

	\item[\dlgflag{Отображать WL на связанные документы}]
	Специальный флаг.

	\item[\dlgflag{Цены поступления по умолчанию без НДС}]
	При установке этого флага система будет автоматически выставлять признак \dlgflag{Цена поступления %
	без НДС} в новых строках документов товарного прихода. Это не отменяет вашего права вручную
	снять этот признак.

	\item[dlgflag{Если ЦП без НДС, то НДС рассчитывать по сумме}]
	Специальный флаг.

	\item[\dlgbutton{Операции}]
	Кнопка, предоставляющая доступ к общим настройкам специфических опций операций.

	\item[\dlgbutton{Главная организация}]
	Кнопка, предоставляющая доступ к общим настройкам специфических опций, относящимся
	к  параметрам главной организации.

	\item[\dlgbutton{Системные параметры}]
	Кнопка, открывающая диалог настройки специфических системных параметров.

\end{description}

%topic(DLG_CCFGOP)

\subsection{Общие настройки операций\label{sec-commcfg-op}}

\ppypictsc{dlg-101}{Конфигурация операций}{0.6}

В этом разделе общих настроек перечисляются параметры, необходимые системе для правильной
работы с документами, отчетами и некоторыми автоматическими функциями.

Пример диалог редактирования настроек показан на рис.~\ref{pic-dlg-101}.
Таблица перечисляет эти параметры и поясняет их значение.

\begin{description}
	\item[\dlgcombo{Таблица поставщиков}]
	Аналитическая таблица, используемая для хранения поставщиков товаров и услуг. Система
	должна знать, какую именно аналитическую таблицу вы используете для этих целей. Как правило,
	это изначально существующая в поставляемой пустой базе данных таблица \ppyrsrv{Поставщики}.

	\item[\dlgcombo{Таблица покупателей}]
	Этот параметр подобен предыдущему. С той лишь разницей, что указывает на аналитическую
	таблицу покупателей.

	\item[\dlgcombo{Приход от поставщика}]
	Вид операции, как правило, используемый на вашем предприятии для ввода документов поступления
	товаров от поставщиков. Система применяет этот параметр для автоматизации некоторых функций.

	\item[\dlgcombo{Розничная продажа}]
	Вид операции, как правило, используемый на вашем предприятии для ввода документов розничной
	продажи (то есть, продажи анонимному клиенту). Система применяет этот параметр для
	автоматизации некоторых функций.

	\item[\dlgcombo{Розничный возврат}]

	\item[\dlgcombo{Межскладской приход}]
	Вид операции межскладского прихода товара. Эта операция должна относиться к типу  \ppyrsrv{Приход
	товара} и использовать таблицу объектов \ppyrsrv{Склады}. Системой используется при синхронизации
	документов между разделами базы данных.

	\item[\dlgcombo{Автокомплектация}]
	Вид операции автокомплектации. Эта операция относится к типу операций \ppyrsrv{Модификация товара}
	и используется для формирования теневых документов автокомплектации товара.

	\item[\dlgcombo{Заказ поставщику}]
	Вид операции, применяемый при автоматическом формировании заказа поставщику.
	Подробности см. на стр.~\pageref{sec-suppl-order}.

	\item[\dlgflag{Использовать флаг \qu{Не изменять остатки по лоту}}]
	Флаг \dlgflag{Не изменять остатки по лоту} является атрибутом вида операции.
	Учитывая крайне узкую область использования этого флага и значительную
	опасность неоправданного его применения, данную опцию конфигурации
	следует держать выключенной.

	Устанавливать ее (как и сам флаг в виде операции) следует только
	проконсультировавшись со специалистом.

	\item[\dlgflag{Запрет бухгалтерских проводок}]
	Аварийная опция, позволяющая блокировать проведение любых бухгалтерских
	проводок по документам.

	Включать ее можно только в экстремальных ситуациях связанных с
	нарушением целостности базы данных и массированным перепроведением
	документов \qu{задним числом}.

	Если вы прибегните к данной опции, то после устранения ситуации,
	приведшей к этому, пересчитайте проводки по документам.

	\item[\dlgflag{Не учитывать долги по заказам}]
	Если флаг установлен, то при расчете долгов, документы, относящиеся к операциям
	типа \ppyrsrv{Товарный заказ} не принимаются в расчет даже если соответствующий
	вид операции имеет флаг \dlgflag{Требует платежного документа}.

	\item[\dlgflag{Не применять выравнивание при списании драфт-документов}]
	Защитная опция, блокирующая использование сложного механизма выравнивания сумм документа
	списания с соответствующими суммами исходного драфт-документа.

	Флаг следует включить в случае, если в процессе или в результате списания драфт-документа
	вы обнаруживаете сбои системы или значительное (именно, значительное) расхождение сумм драфт-документа
	с документом списания.

	\item[\dlgflag{Не откатывать счетчик операций при отказе от документа}]
	Защитная опция, блокирующая откат значения счетчика операций при отказе пользователя от проведения
	документа. Опция введена в экспериментальных целях: использовать не рекомендуется (однако и вреда от
	нее замечено не было).

	\item[\dlgcombo{Динамический тип товара для лотов, имеющих агента поставщика}]
	Очень и очень специфическая опция. Если в этом комбо-боксе выбран тип товара, то при расчете налоговых
	сумм по операциям, привязанным к лотам, которые были сформированы документами с ненулевым
	агентом (любым), программа динамически полагает, что соответствующий товар относится к выбранному типу.

	Опция была реализована давно и на текущий момент не ясно, может ли она иметь какую либо практическую пользу.

	\item[\dlgcombo{Товар для счета-фактуры на предоплату}]
	В этом поле можно выбрать товар (как правило, нелимитируемый), который используется
	при формировании счетов-фактур и книги продаж (покупок) по бухгалтерским документам.

	Кроме того, этот товар применяется для печати кассовых чеков по бухгалтерским документам
	для расчета НДС и прочих необходимых при этом параметров.

\end{description}

%topic(DLG_MAINORG)

\subsection{Общие настройки главной организации\label{sec-commcfg-mainorg}}

Настройки главной организации необходимы для правильной печати первичных документов,
отчетов и для некоторых иных целей. Вот эти параметры:

\ppypict{dlg-commcfg-mainorg}{Параметры главной организации}

\begin{description}
	\item[Главная организация по умолчанию]
	Так как в системе может быть задано несколько главных организаций, то этот параметр уточняет
	какую именно персоналию использовать как главную организацию. Даже если вы имеете только одну
	запись персоналии - главной организации, то все равно желательно определить этот параметр.

	\item[Директор]
	Первое лицо организации. Здесь система предлагает выбрать персоналии имеющую вид \ppyrsrv{Персонал}.

	\item[Главный бухгалтер]
	Также, как и предыдущем пункте, это персоналия, относящаяся к  виду \ppyrsrv{Персонал} и
	идентифицирующая главного бухгалтера предприятия.
\end{description}

%topic(DLG_CCFGSYS)

\subsection{Общие настройки системных параметров\label{sec-commcfg-sys}}
Этот набор параметров определяет некоторые специальные аспекты функционирования системы.
Большинство этих параметров имеют очень специальное значение. Для ознакомления с
подробностями следует обратиться к технической документации по системе или к разработчикам.
Здесь мы лишь кратко опишем их действие и приведем рекомендуемые значения.

\ppypictsc{dlg-100}{Системные параметры}{0.6}

\begin{description}
	\item[Максимальное количество строк в товарном документе]
	Определяет предельное количество товарных строк, которое может содержаться в одном товарном
	документе. Этот предел необходим потому, что, во-первых, большие документы не помещаются в
	памяти (актуально для DOS-версии системы), и, во-вторых, с большими документами неудобно
	работать по причине значительных задержек при их загрузке и пересчете.
	При автоматическом формировании документов система отслеживает размер документов и, если
	количество строк в создаваемом документе превышает заданный предел, то начинает новый.
	При ручном вводе товарного документа, когда его размер превышает предельное количество
	строк, система выдает предупреждение.
	Если это поле пустое или в нем стоит значение меньше или равное нулю, то система полагает
	этот параметр равным 300.

	\item[Порог блокировки пересчета форвардных остатков, дней]
	При вводе или изменении бухгалтерских проводок, дата которых отстает от текущей операционной
	даты на количество дней, превышающих определяемое этим параметром значение, система не
	пересчитывает сразу форвардные остатки по затрагиваемым бухгалтерским счетам, а откладывает
	выполнение этой процедуры до завершения всех транзакций по документу. Благодаря этому
	достигается значительное ускорение выполнения некоторых операций.
	Рекомендуемое значение - 7 дней.

	\item[Порог расчета остатков товаров по группе, \%\%]
	Из-за того, что для расчета остатков товаров используется два различных алгоритма: по
	всему множеству товаров и по небольшой группе товаров, системе требуется надежный критерий
	для выбора алгоритма в зависимости от того, какая часть общего множества товаров включается
	в рассматриваемую группу. Рассматриваемый параметр как раз и предоставляет такой критерий -
	он определяет максимальную долю (в десятых долях процента) рассчитываемых товаров среди
	всего справочника товаров, ниже которой уже следует включать алгоритм для группы.
	Неправильный выбор этого параметра может привести к значительному замедлению расчета
	остатков товаров.

	По умолчанию, система полагает этот параметр равным 100 (10\%).

	\item[Максимальный количественный дефицит, 1E-7]
	Параметр, регламентирующий  терпимость подсистемы списания драфт-документов к небольшому дефициту
	расходуемых товаров. Главная причина для существования данного параметра в том, что мизерные нечеткости в учете
	могут порождать непреодолимое препятствие для автоматического списания с остатков товаров.

	В качестве параметра указывается 10-ти миллионная часть торговой единицы. То есть, введя в этом поле 50
	вы предписываете системе игнорировать нехватку 0.0000050 единиц товара (сырья).

	\item[Период объединения кассовых сессий, мин]
	При объединении асинхронных кассовых сессий в суперсессию, один из критерием, по которому
	система определяет принадлежность различных сессий к одной суперсессии, является время,
	между закрытиями этих сессий.
	Значение по умолчанию - 720 минут (12 часов).

	\item[Период действия форвардной кассовой сессии, мин]
	Некоторые драйверы кассовых аппаратов не фиксируют в выходных данных о чеках  номер
	сессии. В этом случае система самостоятельно по ряду признаков определяет к какой сессии
	относится тот или иной чек. Такие сессии называются форвардными. Рассматриваемый параметр
	предоставляет системе один из критериев ассоциации чека с кассовой сессией.
	Значение по умолчанию - 1440 минут (24 часа).

	\item[\dlgflag{Использовать классы товаров}]
	Этот флаг следует включить если вам необходима возможность использования классов товаров
	в системе.

	\item[\dlgflag{Использовать товарные пакеты}]
	Этот флаг следует включить при необходимости использования товарных пакетов.

	\item[\dlgflag{Использовать драфт-документы}]
	Это флаг во включенном состоянии позволяет работать с драфт-документами.

	\item[\dlgflag{Проверка серийных номеров на принадлежность к браку}]
	Опция, используемая обычно в аптечном бизнесе. Если данных флаг
	установлен, то программа будет проверять новые строки в товарных
	документах на отсутствие соответствия между серийным номером лота,
	к которому привязана товарная операций и какой-либо из серий,
	определенной в предварительно импортированной таблице запрещенных
	к продаже серий лекарственных препаратов или иных товаров.

	\item[\dlgflag{Сквозная уникальная дисконтная карта}]
	Система по умолчанию поддерживает уникальность номеров дисконтных карт
	в пределах одной серии.

	При установке этого флага система будет поддерживать абсолютную
	уникальность номеров дисконтных карт. То есть не будет допускать
	существования двух карт, не зависимо от их принадлежности к сериям,
	с одинаковыми номерами.

	Если вы включите этот флаг, система перед сохранением этой конфигурации
	проверит список карт на предмет того, чтобы среди них не было дубликатов
	по сериям.

	Рекомендуется устанавливать данную опцию в том случае, если ваше
	предприятие работает с кассовыми модулями независимых разработчиков
	поскольку большинство кассовых модулей предполагают сквозную
	уникальность карт.

	\item[\dlgflag{Использовать расширение кассовых чеков}]
	Флаг должен быть включен если ваше предприятие использует
	дополнительные атрибуты кассовых чеков: агент и номер стола.

	Расширение кассовых чеков несколько увеличивает размер базы
	данных и незначительно снижает быстродействие системы при обработке
	чеков.

	Наиболее распространенной сферой применения названных расширений
	является ресторанный бизнес.

	\item[\dlgflag{Использовать расширение строк кассовых чеков}]
	Следует включить этот флаг в том случае, если предприятие
	применяет расширенные атрибуты строк кассовых чеков. На текущий
	момент это - серийные номера.

	Примером сферы применения этого расширения является аптечный бизнес.

	\item[\dlgflag{Генерировать лоты по заказам нелимитируемого товара}]

	\item[\dlgflag{Использовать товарные коды по контрагентам}]
	Этот флаг следует включить в том случае, если ваше предприятие будет
	вести артикулы товаров, связанные с контрагентами.

	Чаще всего такие артикулы используются для обмена информацией
	о товарных операциях (документы, отчеты и т.д.) с поставщиками и покупателями.

	\item[\dlgflag{Индивидуальная фильтрация по расширению документов}\label{loc-commcfg-sys-01}]
	Эта опция модифицирует алгоритм фильтрации документов по агенту или плательщику
	(см. стр.~\pageref{sec-billfilt-ext}).

	Стандартный (без рассматриваемой опции) алгоритм подразумевает предварительную
	выборку списка всех документов, имеющих в качестве расширения заданных в фильтре
	агента и (или) плательщика и затем отбор документов по остальным критерием с
	проверкой принадлежности извлеченному списку.

	В подавляющем большинстве случаев этот алгоритм обеспечивает очень высокую
	производительность. Однако, существуют ситуации, когда он становится очень
	медленным. Основные характеристики таких ситуаций:
	\begin{itemize}
		\item В базе данных очень много документов (сотни тысяч и более)
		\item Значительная доля документов имеет расширение.
	\end{itemize}

	В таких ситуациях и следует применять обсуждаемый флаг. При его установке
	система будет проверять расширение каждого отдельного документа.

	Резюмировать сказанное можно так: значительного снижения скорости выборки
	документов опция не вызовет никогда, но в некоторых случаях может дать очень
	большое ускорение.

	\item[\dlgflag{Использовать распределение себестоимости}]
	Предохранительный флаг, включающий возможность распределения себестоимости,
	заданным дистрибутивными суммами, по строкам приходного товарного документа.

	Если вы намерены использовать эту возможность системы, то установите
	данный флаг.

	\ppynote{
		После того, как флаг установлен и были созданы документы с распределенной
		себестоимостью, ни в коем случае не следует отключать этот флаг, поскольку
		это может привести к ошибкам при пересчете существующих документов.
	}

	\item[\dlgflag{Использовать аварийный системный журнал}]
	Если опция включена, то при невозможности добавления записи события в системный журнал,
	система будет заносить эту запись в резервный системный журнал, из которого в дальнейшем
	записи могут быть перенесены в основной журнал функцией обслуживания базы данных.

	\item[\dlgradioc{Применение текущих остатков по лотам}]
	Переключатель регламентирует уровень использования техники индексации остатков.

	\begin{description}
		\item[\dlgradioi{Не использовать}]
		Индексация текущих остатков по лотам не используется.

		\item[\dlgradioi{Поддерживать в актуальном состоянии}]
		Система при проведении документов поддерживает индексацию
		текущих остатков по лотам, но не применяет ее ни в каких
		расчетах.

		Этот вариант необходим для переходного периода ввода
		индексации в работу.

		\item[\dlgradioi{Использовать при расчетах}]
		Текущие остатки по лотам поддерживаются системой в актуальном
		состоянии и применяются для расчетов (как минимум, для расчета
		остатков на дату).
	\end{description}

	\item[\dlgflag{Использовать QUOT-II}]
	Установка этого флага переключает систему на использование нового механизма
	котировок, реализованного в версии 7.2.0.

	Опция временная. После того, как большая часть инсталляций перейдет на
	новый механизм его использование будет предполагаться по умолчанию.

	\item[\dlgflag{Индексировать телефоны}]
	Данный флаг следует включить, если вам необходим быстрый поиск адресов и персоналий по телефонным номерам.
	Скорее всего это может быть обусловлено совместным использованием системы \ppybrand{} и телефонных сервисов.

	\item[\dlgflag{Синхронизировать лоты}]
	Если флаг установлен, то при передаче товарных документов между разделами система будет
	синхронизировать лоты.

	Синхронизация лотов дает следующие преимущества:
	\begin{itemize}
		\item При акцепте товарного документа из другого раздела система преимущественно (но не обязательно)
		использует лот, синхронизированный с лотом, который использовать в разделе-отправителе.
		Это значительно улучшает соответствие учета между разделами.
		\item Начиная с версии 8.0.3 система \ppybrand{} \qu{научилась} принимать изменения товарных документов из
		других разделов. Но такая функция доступна только для документов, все строки которых связаны с синхронизированными
		лотами. Таким образом, если рассматриваемый флаг не включен, то прием изменений товарных документов становится не возможным.
	\end{itemize}

	Единственная и незначительная отрицательная сторона синхронизации лотов - небольшое увеличение нагрузки на сервер базы данных
	при передаче и приеме документов.

	Соответственно, мы рекомендуем устанавливать данный флаг, если вы применяете синхронизацию данных между разделами.

	\item[\dlgflag{Использовать расширенные оплаты по чекам}]
	Не применяется.

	\item[\dlgflag{Применять включенные суммы оплаты}]

	\item[\dlgflag{Использовать расширенные коды строк документа}]

	\item[\dlgflag{Использовать базу данных Sartre}]

	\item[Вести историю изменения объектов]
		Блок флагов, определяющих необходимость хранения версий измененных объектов данных.

		Включение флагов предписывает системе хранить историю всех
		модифицированных и удаленных версий объектов.

		Это - очень удобная опция, позволяющая увидеть каким был документ, товар или
		иной объект из списка, до любого изменения либо удаления. Кроме того, история документов
		позволяет сравнивать различные версии модифицированных документов.

		Оборотной стороной рассматриваемой опции является то, что
		она значительно увеличивает размер базы данных и увеличивает
		нагрузку на сервер базы данных при сохранении объектов.

		\begin{description}
			\item[\dlgflag{История документов}]
				Флаг предписывает сохранять историю изменения документов.

				Обратим внимание на то, что история документов не предоставляет
				сервиса по восстановлению удаленных либо измененных документов
				поскольку копии оригинальных документов хранятся в сжатом виде.
			\item[\dlgflag{История товаров}]
				Опция, позволяющая сохранять копии записей товаров в том виде,
				который предшествовал их изменению либо удалению.
			\item[\dlgflag{История персоналий}]
				Включенный флаг предписывает системе хранить историю изменения персоналий.
			\item[\dlgflag{История персональных карт}]
				Если этот флаг установлен, то при изменении или удалении персональных
				карт, копия инофрмации о карте, предшествующая действию, будет сохранена
				в базе данных.
		\end{description}

\end{description}

\ppynote{
	Следует иметь в виду, что из-за постоянного совершенствования системы могут появляться
	новые параметры настройки и, соответственно, меняться форма показанного на рисунке диалога.
}

%endtopic

\section{Прочие настройки и параметры}

\section{Системный журнал\label{sec-sj}}

Системный журнал является одной из наиболее важных инфраструктурных компонент системы.
Технически, системный журнал представлен таблицей данных, в которой фиксируются различные
события, происходящие с базой данных.

Каждое событие содержит следующие атрибуты:

\begin{itemize}
	\item Дата и время события.
	\item Тип события.
	\item Пользователь, выполнивший событие.
	\item Тип объекта данных, с которым связано событие.
	\item Идентификатор объекта данных, с которым связано событие.
	\item Дополнительная целочисленная величина, смысл которой определяется типом события.
\end{itemize}

Важной особенностью системного журнала является то, что записи в него могут только
добавляться, в то время как система принципиально не содержит никаких
средств для изменение или удаление записей из него. Это обеспечивает объективность
информации, хранящейся в системном журнале.

\subsection{Функции системного журнала}

Системных журнал выполняет множество функций, часть которых может
рассматриваться как пользовательские (то есть, направленные на непосредственное
удовлетворение требований по использованию и администрированию системы),
а часть - как системные (используемые системой для решения внутренних
задач).

Вот перечень наиболее существенных функций:

\begin{description}
	\item[Визуальный анализ] Это - пользовательская функция,
	заключающаяся в сервисной таблице анализа системных событий.
	Подробно она будет описана ниже.

	\item[Отслеживание действий пользователей] Смежная с предыдущей
	функция, позволяющая провести беспристрастный аудит действий
	пользователей по времени и событиям.

	Для примера, благодаря системному журналу, есть возможность
	увидеть в какое именно время и кто изменил документ или
	совершил какое-либо иное действие.

	\item[Учет истории изменений некоторых объектов]
	Программа может сохранять историю изменений документов и товаров.
	Если соответствующие функции активированы, состояние документа
	или товара сохраняется в том виде, каким этот объект был до
	изменения или удаления.

	Подробно эти функции рассмотрены в разделах, посвященных
	документам и товарам.

	\item[Идентификация объектов, с которыми произошли события за заданный период]
	Данная функция имеет и пользовательский и системные аспекты применения.

	Пользователи, благодаря этой функции, получают возможность
	фильтрации некоторых объектов (на текущий момент, документов и товаров)
	по критериям системного журнала.

	Системный аспект функции состоит в возможности программы
	идентифицировать набор объектов, которые изменились (появились)
	за какой-то период, и осуществить с ними некоторое действие.

	Например, передача изменений объектов между разделами базы
	данных тесно \qu{сотрудничает} с системным журналом
	для определения списка объектов, которые необходимо передать
	в другой раздел.

	\item[Актуализация кэшированных объектов]
	Системная и крайне важная функция, обеспечивающая актуальность
	и непротиворечивость данных в кэше.

	Кратко ситуацию можно описать так: для оптимизации производительности
	и снижения нагрузки на сервер базы данных, система запоминает в оперативной памяти значительную
	часть данных, извлеченных из базы данных. Эти данные, собственно,
	и именуются кэшем. Так как другие пользователи непрерывно изменяют
	данные в базе данных, система должна поддерживать состояние кэша
	соответствующим текущему состоянию общей базы данных. Этот
	процесс называется актуализацией кэша. Для того, чтобы
	с минимальными затратами времени актуализировать кэш система
	запрашивает данные об изменениях объектов у системного журнала
	и обновляет в кэше только эти данные.
\end{description}

\subsection{Просмотр системного журнала}

Для целей анализа содержимого системного журнала система предоставляет
функцию его просмотра.

Общая функция просмотра системного журнала доступна посредством
пункта меню \ppymenu{Админ\rdir Системный журнал}.

Кроме общей функции, система позволяет анализировать системные
события по отдельным объектам непосредственно из списков
и таблиц просмотра соответствующих данных.

В таблицах эта функция вызывается обычно клавишами \keyb{Ctrl-J},
а в списках - кнопкой \dlgbutton{События}.

%topic(DLG_SYSJFILT)

\subsubsection{Фильтр системного журнала}

\ppypict{dlg-f-sj}{Диалог фильтра системного журнала}

Диалог фильтра системного журнала изображен на рис.~\ref{pic-dlg-f-sj}.

Далее описываются управляющие элементы этого диалога.

\begin{description}
	\item[Период]
	Здесь может быть указан период, за который необходимо вывести
	системные события.

	При первоначальном открытии диалога это поле содержит текущую дату.

	Так как системный журнал обычно содержит огромное количество
	записей, будьте внимательны при задании периода.

	Большой период в купе с другими критериями фильтрации
	способен привести к очень длительному ожиданию
	открытия таблицы с результирующей выборкой.

	\item[\dlgcombo{Событие}]
	В этом комбо-боксе может быть выбран тип, к которому должны
	относится выводимые системные события.

	Справа от комбо-бокса находится кнопка \dlgbutton{\dots},
	позволяющая выбрать несколько событий, по которым следует
	отфильтровать выборку.

	\item[\dlgcombo{Объект}]
	Тип объекта данных, которому должны соответствовать отбираемые
	события.

	Заметим, что неверная комбинация типа события и типа объекта
	способна привести к заведомо пустой выборке.

	Так, события типа \ppyrsrv{Документ изменен} могут быть
	связаны только с типом объектов \ppyrsrv{Документы}. Следовательно,
	выбор любого иного типа объекта приведет (возможно, после длительной
	задержки) к пустой выборке.

	\item[\dlgcombo{Пользователь}]
	Здесь может быть выбран пользователь, инициировавший событие.

	\item[\dlgcombo{Подстановка}]
	\item[\dlgcombo{Подстановка даты}]

	\item[\dlgflag{Показывать объекты}]
	Флаг, предписывающий системе отображать наименования объектов,
	с которыми связаны события.

	Это флаг улучшает наглядность отображения событий, но имеет
	и побочный эффект в виде дополнительной нагрузки на сервер
	базы данных и замедления выполнения функции.

	При выборе значительного периода не рекомендуется устанавливать
	этот флаг, поскольку время расчета при этом может стать запредельным.

	\item[\dlgflag{Показывать версионные данные об объектах}]
	Опция, позволяющая детализировать информацию по некоторым событиям, связанными с
	объектами, для которых есть история изменений.

	Для этого в таблицу включается еще одна колонка \qu{История} содержащая соответствующие сведения:
	\begin{itemize}
		\item Для событий \ppyrsrv{Документ изменен} и \ppyrsrv{Документ удален} показывается
		текстовая строка с номером, датой и дополнительными данными о состоянии документа до
		изменения (удаления).
		\item Для событий \ppyrsrv{Объект изменен} и \ppyrsrv{Объект удален} если они связаны с объектом,
		по которому ведется история изменений (на текущий момент, возможны \ppyrsrv{Товары}, \ppyrsrv{Персоналии},
		\ppyrsrv{Персональные карты}), то отображается наименование объекта до изменения (удаления).
	\end{itemize}
\end{description}

%topic(BROWSER_SYSJ)

\subsubsection{Таблица системного журнала}

\ppypictsc{brw-sj}{Таблица системного журнала}{0.4}

На рис.~\ref{pic-brw-sj} показан пример таблицы системного журнала (с колонкой
наименований объектов).

\subsubsection{Действия в таблице системного журнала}

\paragraph{Просмотр объекта}\indent\keyb{Enter}

Если событие относится к какому-либо объекту данных, то действие
позволяет открыть диалог просмотра и редактирования этого
объекта (при наличии соответствующих прав доступа).

\ppynote {
	Для событий типа \ppyrsrv{Объект удален} и \ppyrsrv{Документ удален}
	данное действие не применимо поскольку объекта, с которым связано
	событие, уже нет.
}

\paragraph{Просмотр документа до изменения}\indent\keyb{F3}
Действие возможно только для событий, связанных с документами, а
именно, \ppyrsrv{Документ изменен}, \ppyrsrv{Документ удален}.
Кроме того, возможность вызова этой функции обусловлена наличием
опции \dlgflag{История документов} в системных настройках.

При вызове функции открывается диалог просмотра копии документа,
каковым он был до изменения (удаления), зафиксированного выбранным
событием.

\paragraph{Сравнение с документом истории}\indent\keyb{F4}
Применимость этой функции определяется теми же факторами, что и
предыдущей.

Обращение к действию открывает таблицу сравнения товарных строк документа.
При этом документом \qu{слева} будет вариант после изменения, а документом
\qu{справа} - тот, что был до изменения.

Открытие таблицы предваряет фильтр, позволяющий управлять опциями
отображения сравнения документов.

\paragraph{Просмотр товара до изменения}\indent\keyb{F6}
Действие возможно для событий \ppyrsrv{Объект изменен} и \ppyrsrv{Объект удален},
связанных с товарами. Дополнительно, необходимым фактором работоспособности
этой функции является установка флага \dlgflag{История товаров} в
системных настройках базы данных.

Вызов функции приводит к открытию диалога, отображающего
товар в том виде, каким он был до выбранного события.

\paragraph{Восстановление товара}\indent\keyb{Ctrl-R}
Действие позволяет восстановить состояние товара в том виде, каком он
был до выбранного события.

Применимость функции такая же, как и для предыдущего действия.

\paragraph{Печать}\indent\keyb{F7}
Выводит на печать выборку событий.

Стандартная форма отчета:
\begin{description}
	\item[Для выборки без наименований объектов] \ppyrsrv{SysJ}.
	\item[Для выборки с наименованиями объектов] \ppyrsrv{SysJObj}.
\end{description}

\paragraph{Передать выборку объектов}\indent\keyb{Ctrl-H}
Данное действие позволяет отправить в другой раздел базы данных, все
объекты, с которыми связаны события в текущей выборке таблицы.

\paragraph{Фильтр}\indent\keyb{Ctrl-V}
Дает возможность изменить условия фильтрации выборки.

\subsubsection{Автоматическое обновление таблицы}
Таблица системного журнала относится к группе автоматически обновляемых. То есть, каждые
несколько секунд программа обновляет видимую область таблицы для того, чтобы в ней
отобразились изменения.

%endtopic

\subsection{Фильтрация объектов по системному журналу\label{loc-sj-f-obj}}

\ppypict{dlg-f-sjobj}{Диалог фильтра системных событий, используемый для фильтрации объектов}

Выше, описывая функции системного журнала, мы упоминали о том, что
система позволяет использовать системные события для управления выборкой
документов и товаров.

Принцип такой фильтрации заключается в том, что если пользователь
указал один или несколько критериев встроенного фильтра по системным
событиям, то, кроме прочих критериев, общая выборка включает только
те объекты, заданные события по которым удовлетворяют требованиям
фильтра системных событий.

При этом применяется сокращенный аналог фильтра системного
журнала (см. рис.~\ref{pic-dlg-f-sjobj}). Как видно, здесь, по сравнению с рис.~\ref{pic-dlg-f-sj},
отсутствуют критерии по объектам данных, поскольку они системе и так известны из контекста.

\subsection{Прочие аспекты системного журнала}

\subsubsection{Усечение таблицы системного журнала}

В базе данных системный журнал занимает значительное пространство. Связано это
с огромным числом записей, заносимых в него. Особенно сильно системный журнал
может увеличиваться при использовании базы данных большим числом пользователей.

Если вы хотите удалить старые записи системного журнала, то для этого
можно воспользоваться функцией обслуживания базы данных.

\subsubsection{Сбои при записи в системный журнал}

Если по каким-либо причинам программа не может занести очередную запись
в системный журнал (например, из-за сбоя таблицы базы данных), то
в текстовый файл журнала LOG/PPERROR.LOG вносится строка информации об этом,
содержащая все атрибуты записи, которую не удалось сохранить в таблице.

Конечно, это не заменит сбойную запись, но, по крайней мере, дает
возможность идентифицировать проблему.

\chapter{Защита и восстановление данных\label{ch-dataprotection}}

\section{Резервное копирование}

Резервное копирование является необходимым элементом использования любой системы, работающей
с критически важными для функционирования предприятия данными. Резервная копия позволяет
восстановить безнадежно испорченные в результате аппаратно-программных сбоев либо
непредвиденных обстоятельств данные.

Система \ppybrand{} предоставляет развитые средства управления резервным копированием данных,
включающие возможность поддержки нескольких копий одной или нескольких баз данных
одновременно, циклическое обновление и опциональное сжатие резервных копий.

\subsection{Сценарии резервного копирования}

Управление резервным копированием баз данных осуществляется на основе так называемых
сценариев. Для каждой базы данных может существовать любое число сценариев резервного
копирования или не существовать вообще (в этом случае используется сценарий по умолчанию).
Сценарий резервного копирования представляет собой следующий набор параметров:

\begin{description}
	\item[Наименование сценария]
	Символическая уникальная строка, идентифицирующая данный сценарий. Например:
	BackupCopyOfMainBase.
	Наименование сценария может содержать как русские, так и латинские буквы, а также любые
	другие печатные символы и пробелы.

	\item[База данных]
	Символическое имя, идентифицирующее базу данных, для которой создан сценарий.

	\item[Каталог хранения резервных копий]
	Путь к существующему каталогу, в котором будут храниться резервные копии, сделанные
	в соответствии с этим сценарием. Несколько сценариев могут ссылаться на один и тот
	же каталог хранения резервной копии, поскольку каждая резервная копия в
	действительности хранится в специально создаваемом для нее одной подкаталоге с
	уникальным именем заданного каталога.

	\item[Период резервного копирования]
	Количество дней, прошедшее после последнего копирования по заданному сценарию, через
	которое должна делаться очередная копия.

	\item[\dlgflag{Сжимать копию}]
	Признак, предписывающий программе копирования сжимать исходную базу данных. Это позволяет
	экономить место на диске.

	\item[Максимальное количество копий]
	Количество резервных копий, которое необходимо хранить. Если при создании очередной
	резервной копии общее количество копий будет превышать значение, указанное этим параметром,
	то наиболее старая копия удаляется.

	Если этот параметр равен 0, то максимальное количество резервных копий не ограничено.
\end{description}

\subsubsection{Сценарий по умолчанию}

Если для некоторой базы данных не задан сценарий резервного копирования, то программа
предполагает существование так называемого сценария по умолчанию. Он имеет следующие
параметры:

\begin{description}
	\item[Наименование сценария] Default
	\item[Каталог хранения резервных копий] Подкаталог BACKUP каталога, в котором хранится база данных
	\item[Период резервного копирования] 1 день
	\item[Флаг сжатия копии] 0
	\item[Максимальное количество копий] 0 (без ограничения)
\end{description}

\subsection{Создание и редактирование сценариев резервного копирования}

Сценарии резервного копирования хранятся в файле pp.ini в разделе [$backup$]. Формат
представления сценария в этом файле следующий:

$Scen\_name=database\_symb,backup\_path,period,compress\_flag,max\_copies$

Где
\begin{description}
	\item[Scen\_name] - наименование сценария,
	\item[database\_name] - символическое имя базы данных,
	\item[backup\_path] - путь к каталогу резервной копии,
	\item[period] - период резервного копирования,
	\item[compress\_flag] - признак сжатия копии (1 или 0),
	\item[max\_copies] - максимальное количество копий.
\end{description}

Для создания, изменения или удаления сценария можно в соответствии с указанным синтаксисом
просто модифицировать файл pp.ini в подкаталоге BIN заголовочного каталога, в котором установлена
система \ppybrand{}.

В тоже время, более правильным и удобным способом для достижения этих же целей является
использование функции визуальной настройки сценариев, доступной в панели сервисных функций
системы.

\subsection{Создание резервной копии}

Для создания резервной копии следует в диалоге входа в систему нажать кнопку
\dlgbutton{Сервис}.

\ppypict{dlg-backup-copy}{Резервное копирование}

Затем, в следующем диалоге выбрать базу данных и нажать кнопку \dlgbutton{Копирование\dots}.
На экране появится диалог аналогичный показанному на рис.~\ref{pic-dlg-backup-copy}.

В комбо-боксе \qu{Сценарий} необходимо выбрать сценарий, в соответствии с которым требуется
сделать резервную копию. В списке \qu{Копии} можно видеть все существующие копии выбранной
базы данных, отсортированные в порядке \qu{от более новых к более старым}. Первая строка
списка предназначена для создания новой копии. Если же выбрана одна из существующих копий в
списке, то очередная копия заменит выбранную (то есть выбранная копия будет удалена).

Нажатие кнопки \dlgbutton{Копировать} инициирует процесс создания резервной копии. При этом
программа проверит, чтобы с копируемой базой данных никто не работал, и если это не так, то
выдаст соответствующее сообщение и предложит автоматически дождаться момента, когда все
пользователи перестанут работать с базой данных и начать копирование. Это освобождает
человека, ответственного за резервное копирование, от необходимости дожидаться, когда все
закончат работу.

Во время создания резервной копии вход в программу для работы с копируемой базой заблокирован.

\subsubsection{Автокопирование}

Для того чтобы процесс резервного копирования был максимально простым, система \ppybrand{}
содержит функцию для автоматического создания резервных копий по всем базам данных в
соответствии с заданными сценариями. Для этого предназначена кнопка \dlgbutton{Автокопирование}
в диалоге служебных функций, вызываемом по кнопке \dlgbutton{Сервис} диалога входа в систему.
При автокопировании программа автоматически выбирает те сценарии, для которых пришло время
создавать резервную копию и делает это.

\subsubsection{Автоматическое предупреждение о необходимости сделать резервную копию}
Чтобы пользователи не забывали регулярно делать резервную копию, можно заставить систему
напоминать выбранным пользователям о необходимости таких действий. Для этого следует в файл
pp.ini в группе [system] занести параметр
\newline [system]
\newline backupuser=master

В данном примере пользователем, ответственным за резервное копирование назначен тот, кто
работает в системе под именем master. Этот пользователь при выходе из системы будет получать
предупреждение о том, что пора сделать резервную копию. После утвердительного ответа запускается
процедура автокопирования. Если необходимо назначить ответственным за резервное копирование
более одного пользователя, то их имена должны быть перечислены через запятую. Например:
backupuser=alla, semen.

\subsection{Удаление резервной копии}

Чтобы удалить резервную копию, достаточно повторить шаги, описанные в предыдущем разделе
(создание резервной копии) для входа в диалог резервного копирования. Затем выбрать ту копию,
которую следует удалить и нажать кнопку \dlgbutton{Удалить копию}.

\ppynote{
	Если файловая система, в которой хранится резервная копия, не предусматривает средств
	восстановления удаленных файлов, то восстановить удаленную резервную копию будет невозможно.}

\subsection{Восстановление данных из резервной копии}

При необходимости восстановить данные из резервной копии следует нажать кнопку
\dlgbutton{Сервис} в диалоге входа в систему, выбрать базу данных которую требуется
восстановить и нажать кнопку \dlgbutton{Восстановление…}. В диалоге, который появится
на экране после этого, выбрать в списке копий нужную и нажать кнопку \dlgbutton{Восстановить}.

\ppynote{
	При восстановлении данных из резервной копии, все изменения в базе данных, сделанные после
	создания этой резервной копии будут потеряны. В тех случаях, когда необходимость
	восстановления данных обусловлена небольшими сбоями в базе данных, следует попытаться сначала
	сделать ремонт базы, и только тогда, когда это не помогает воспользоваться восстановлением
	из резервной копии.
}

\section{Восстановление испорченных данных}

Система \ppybrand{} предоставляет средства для восстановления испорченных в результате
аппаратных либо программных сбоев данных.

\subsection{Признаки сбоя данных}

Наиболее частыми проявлениями сбоя в файлах данных являются следующие:
\begin{itemize}
	\item	Программа выдает сообщение \qu{Ошибка ввода-вывода} при попытке провести документ,
	либо в иных случаях. Чаще всего это означает, что часть какого-то из файлов данных была
	повреждена. Такое сообщение не всегда является признаком сбоя файлов данных, однако в
	любом случае при его возникновении необходимо обратиться в службу поддержки.
	\item	Данные по непонятным причинам начинают странным образом вести себя. Например, в
	списке выбора или в таблице при перемещении вверх или вниз,  все строки списка (таблицы)
	исчезают или нарушается их обычный порядок. Могут быть и иные проявления. Отличительной
	чертой этих симптомов сбоя является отсутствие явных сообщений об ошибках в то время как
	данные ведут себя не так как обычно. В этом случае в первую очередь также необходимо
	обратиться к сопровождению.
\end{itemize}

\subsection{Причины сбоя данных}

Чаще всего причиной сбоя данных является некорректности в функционировании системных
ресурсов. Так неправильное выключение сервера Novell NetWare является рекордсменом среди
причин сбоя данных. Для того, чтобы обезопасить систему от таких сбоев настоятельно
рекомендуется обеспечить сервер источником бесперебойного питания с установленным на
сервере программным обеспечением, выключающем сервер при длительном отсутствии электрического
питания.

Если система \ppybrand{} на вашем предприятии работает на отдельном компьютере, то рекомендуется
этот компьютер оснастить источником бесперебойного питания.

Сбои в файловой системе компьютера также являются частой причиной нарушения целостности базы
данных.

\subsection{Процедура восстановления данных}

Для восстановления испорченных данных в системе необходимо произвести следующую
последовательность шагов:
\begin{enumerate}
	\item	Убедитесь, что никто не работает в системе с испорченной базой данных.
	\item	Сделайте аварийную резервную копию (без разрушения последних резервных копий).
	\item	Запустите программу
	\item	В диалоге входа в систему выберите базу данных, которую следует восстановить
	\item	Нажмите кнопку \dlgbutton{Сервис\dots}. На экране появится панель сервисных функций.
	\item	Нажмите кнопку \dlgbutton{Ремонт базы данных\dots}.
	\item	Убедитесь, что в поле \qu{База данных} указана именно та база, которую вам следует
	восстановить.
	\item	Если причиной восстановления базы данных явилось сообщение \qu{Ошибка ввода/вывода},
	то в комбо-боксе \qu{Таблица} выберите имя таблицы, которое было указано в сообщение об
	ошибке. Если вы не помните имени таблицы или причина обращения к функции ремонта была
	другой, то не выбирайте никакой таблицы. При этом система будет восстанавливать всю базу
	данных целиком.
	\ppynote{
		Ремонт всей базы данных может занять очень продолжительное время.
	}
	\item	Поле каталог оставьте пустым. Его следует заполнить только в том случае, если вы
	хотите сформировать восстановленные файлы в каталоге, отличном от того, в котором
	располагается база данных.
	\item	В поле \qu{Log-файл} введите имя файла журнала восстановления.
	\ppynote{
		Имя этого файла обязательно следует указать для того, чтобы можно было проверить
		результаты ремонта базы данных.
	}
	\item Нажмите кнопку \dlgbutton{ОК}.
	\item Если с базой данных работают пользователи, то система выдаст сообщение об ошибке с
	предложением дождаться завершения работы других пользователей. Согласитесь с этим предложением
	(нажмите кнопку \dlgbutton{Да}) и попросите всех, кто работает с системой завершить работу
	в программе.
	\item После того, как система завершит ремонт базы данных, внимательно просмотрите файл
	журнала, имя которого вы указали, согласно пункту 10. Если вами было указано просто имя
	файла, то ищите его в каталоге, в котором находится система \ppybrand{} (например, H:/PPY),
	или подкаталоге BIN этого каталога. Если вы не можете найти этот файл, то обратитесь к
	своему системному администратору с просьбой помочь вам в этом.

	Просмотрите содержимое файла журнала. Каждому ремонтируемому файлу в этом журнале
	соответствуют две строки:

	первая строка указывает имя ремонтируемого файла, вторая строка содержит дробь вида количество
	восстановленных записей/общее количество записей исходного файла. Оба значения в этой дроби
	должны быть одинаковы. Если это не так, то ни в коем случае не начинайте работу до консультаций
	с человеком или фирмой, осуществляющей поддержку системы \ppybrand{} в вашей организации.
\end{enumerate}

\subsection{Другие способы восстановления данных}

Кроме предоставляемых системой Papyrus средств восстановления данных, можно воспользоваться
сервисом Btrieve для достижения той же цели. Это более трудоемкий способ, но в некоторых
случаях он может позволить восстановить данные за более короткое время. В комплект поставки
Btrieve входит утилита BUTIL, при помощи которой можно восстановить данные. Для более
подробной информации обратитесь к руководству по Btrieve для той операционной системе, в
которой он функционирует на вашем предприятии.

\subsection{Восстановление данных при помощи утилиты BUTIL}

Btrieve File Manager Utility (BUTIL.EXE) - это утилита, позволяющая восстанавливать
данные Btrieve-файлов. Запуск этой утилиты возможен из командной строки  вашей рабочей
станции. Напоминаем, что перед тем как запустить  утилиту BUTIL, необходимо, чтобы на
вашем компьютере был загружен Btrieve.
Синтаксис команды восстановления данных следующий:

\ppysyntax{BUTIL  -RECOVER  <btrvFile>  <outputFile> [/O <owner>]}

Параметры
\begin{itemize}
	\item	btrvFile - путь Btrieve-файла, данные которого вы восстанавливаете
	\item	outputFile - путь ASCII-файла, в который утилита BUTIL последовательно поместит
	восстановленные  записи
	\item	owner - необязательный параметр имени доступа в Btrieve
\end{itemize}
Что касается ASCII-файла, то его лучше создать с тем же именем что и у btrvFile, но с
расширением  dat.

После  процедуры восстановления данных нужно полученный ASCII-файл отформатировать  в
Btrieve-файл. Для этого можно воспользоваться командой LOAD утилиты BUTIL.
Синтаксис команды следующий:

\ppysyntax{BUTIL  -LOAD  <inputFile>  <btrvFile> [/O <owner>]}

Параметры:
\begin{itemize}
	\item	inputFile - путь ASCII-файла, содержащего восстановленные записи
	\item	btrvFile - путь Btrieve-файла, в который сгружаем восстановленные данные
	\item	owner - необязательный параметр имени доступа в Btrieve
\end{itemize}
По окончании работы этих процедур должен сформироваться  Btrieve-файл с восстановленными
данными. Осталось заменить старый испорченный файл в вашей рабочей базе данных новым файлом
с восстановленными записями.

\section{Корректировка данных}

\subsection{Пересчет проводок по документам}

Функция пересчета проводок по документам бывает необходима в случаях, когда вы изменяете
настройку шаблонов проводок в видах операций, модифицируете типы уже существующих товаров
и в некоторых других случаях. Сущность этой функции состоит в пересчете выборки документов,
при котором учитываются все последние изменения в настройках видов операций, типов товаров
и других существенных параметров учета.
Также, пересчет проводок по документам поможет при серьезном сбое в данных, при котором
разрушился файл accturn.btr либо файл billamt.btr.

\ppypict{dlg-recalcaturn}{Перерасчет проводок по документам}

\ppynote{
	Пересчет проводок по старым документам может повлечь за собой изменение оборотов и остатков
	по бухгалтерским счетам предприятия и рассогласованию их значений с уже сданными в вышестоящие,
	контролирующие и фискальные организации отчетами.

	В связи с этим, отнеситесь с максимальным вниманием и ответственностью, как к самому
	использованию этой функции системы, так и к выбору ее параметров.
}

Для запуска функции пересчета выберите пункт меню \ppymenu{Админ\rdir Корректировка\rdir Пересчет проводок по документам}.
На экране появится диалог, изображенный на рисунке. Параметры
пересчета пояснены в следующей таблице

\begin{description}
	\item[Период]
	Период, в который попадают документы, которые следует пересчитать.

	\item[\dlgcombo{Вид операции}]
	Вид операции, к которой относятся документы, подлежащие пересчету.

	\item[\dlgflag{Не пересчитывать суммы}]
	Если этот флаг установлен, то система не станет пересчитывать суммы документов. В противном
	случае суммы будут пересчитаны. Обратите внимание, что пересчет сумм по документам увеличивает
	время, требуемое на выполнение операции.
	При выборе признака \dlgflag{Не пересчитывать суммы} фактически будут пересчитаны только
	бухгалтерские проводки, соответствующие документам выборки. Это наиболее безопасный метод
	корректировки документов, введенных до внесения изменений в шаблоны бухгалтерских проводок
	по операциям.

	\item[\dlgflag{Пересчитывать товарные строки}]
	Этот признак заставляет систему пересматривать некоторые параметры товарных строк документов
	в соответствии с изменившимися параметрами типов товаров и изменившейся принадлежностью
	товаров к типам. Установка этого флага увеличивает время исполнения операции.

	При установке этого флага автоматически отключается признак \dlgflag{Не пересчитывать суммы}.
\end{description}

\subsection{Проверка сумм по документам}

\ppypict{dlg-chkbillamt}{Проверка сумм по документам}

Эта функция является проверяющей и не вносит никаких изменений в базу данных. Ее цель -
выявление товарных документов, суммы по которым не соответствуют суммам, рассчитанным по
их товарным строкам. Несмотря на то, что сбои подобные тем, что выявляются этой процедурой,
весьма редки, она способна помочь в определении причин расхождения одних данных с другими,
и в случаях сбоев в базе данных.

Для запуска проверки сумм по документам необходимо выбрать пункт меню
\ppymenu{Админ\rdir Корректировка\rdir Проверка сумм по документам}.

Вслед за этим, система предложит вам диалог для выбора параметров проверки.
Вид диалога показан на рис.~\ref{pic-dlg-chkbillamt}. Таблица перечисляет и описывает
его управляющие элементы.

\begin{description}
	\item[Период]
	Период, в который попадают документы, которые следует проверить.

	\item[\dlgcombo{Вид операции}]
	Вид операции, к которой относятся документы, подлежащие проверке.
	Здесь может быть указана обобщенная операция.

	Если вы оставите этот комбо-бокс пустым, то будут проверены документы,
	относящиеся к любому виду операций.

	\item[Log-файл]
	Имя файла, в который будут занесены результаты проверки.
\end{description}

Если система, в ходе проверки, выявит ошибки, то она выведет их в окне журнала. Кроме того,
по завершению процедуры, вы сможете проанализировать обнаруженные проблемы в файле, имя
которого ввели в поле log-файл. При отсутствии ошибок система не выведет никаких сообщений.

\subsection{Корректировка платежей по документам}

Функция корректировки платежей по документам проверяет в исправляет ошибки в расчете долгов
по документам требующим оплаты и зачетным документам. Эта процедура не требует ввода
каких-либо параметров, а просто пробегает все документы и выполняет свою работу. Время
исполнения этой функции весьма небольшое даже при значительном объеме базы данных. Кроме
того, она безопасна в смысле неизменности оборотов и остатков по бухгалтерским счетам и по
товарным остаткам.

Необходимость в запуске корректировки платежей по документам может возникнуть тогда, когда
вы обнаруживаете, что сумма долга по какому-то документу не соответствует внесенным по этому
документу платежам.

\subsection{Поиск оплат без связанного документа}

Все документы, принадлежащим типам операций \ppyrsrv{Оплата} и \ppyrsrv{Возврат} должны быть привязаны
к каким-либо документам. В общем случае система следит за тем, что бы это так и было. Однако,
в редких случаях это правило нарушается. Причиной этого может быть сбой в базе данных либо
ошибки при обмене данными между разделами базы данных.

Самым распространенным симптомом такой ситуации является ошибка при расчете товарного отчета
по операции с выбором \dlgradioi{Доходных оплаченных} операций (подробнее см. раздел, посвященный
этому отчету). Ошибка эта выглядит так \qu{Объект не найден. Документы (ID=xxx)}.

Система \ppybrand{} предоставляет возможность идентифицировать документы оплат и возвратов, имеющих
\qu{висячие} или нулевые ссылки на соответствующие документы. Для того, что бы воспользоваться
этой функцией, выберите пункт меню \ppymenu{Админ\rdir Корректировка\rdir Поиск оплат без связанного документа}.
После того, как функция отработает, на экран в окне журнала будет выведен список документов,
которые имеют обозначенные проблемы. Кроме того, эти сообщения попадут в файл LOG/PAYMLINK.LOG.

К сожалению, не существует универсального рецепта решения проблемы таких документов. Общая
рекомендация заключается в том, чтобы предварительно проконсультировавшись со службой
технической поддержки системы, удалить эти документы и ввести их заново.

\subsection{Корректировка текущих товарных остатков\label{c-currest}}

Корректировка текущих товарных остатков применяется в следующих случаях:
\begin{itemize}
	\item 	Пытаясь выбрать товар в расходном товарном документе, вы не обнаруживаете его в
	списке выбора, хотя уверены, что товар есть на остатке
	\item 	При автоматическом формировании расходных товарных документов (например, при
	списании кассовой сессии), система выдает сообщение об ошибке \qu{Товарная операция не
	проходит: остаток товара слишком мал}
	\item   После корректировки лотов, в ходе которой были обнаружены и исправлены остатки по
	лотам
\end{itemize}

Для запуска корректировки текущих товарных остатков следует выбрать пункт меню
\ppymenu{Админ\rdir Корректировка\rdir Корректировка текущих товарных остатков}. Система выдаст
диалог с запросом имени файла, в который будут записываться результаты проверки, и флажком
\dlgflag{Исправлять ошибки}. Если вы не установите этот флажок, то система только проверит
состояние текущих товарных остатков, но не станет предпринимать каких-либо действий для
исправления ошибок.

В ходе процесса проверки и исправления текущих товарных остатков программа будет показывать
обнаруженные ошибки в окне в нижней части экрана.

\subsection{Корректировка остатков в проводках}

В случаях обнаружения несоответствия между входящим остатком по какому-либо бухгалтерскому
счету, его оборотами за период и исходящим остатком следует использовать функцию корректировки
остатков в проводках. Самым надежным признаком указанного рассогласования является индикация
значения этого рассогласования в диалоге итогов по простому анализу счета.

Для вызова этой функции обратитесь к пункту меню \ppymenu{Админ\rdir Корректировка\rdir Корректировка остатков в проводках}.
На экране появится диалог с предложением ввести имя файла журнала, в
который будут записываться результаты проверки. Если кроме проверки, вы одновременно хотите
и исправить ошибки, то включите флажок  \dlgflag{Исправлять ошибки}. Ход проверки остатков будет
отображаться в нижней части окна программы.

Функция корректировки остатков в проводках исполняется достаточно быстро даже на большой базе
данных. Для исключения нежелательных побочных эффектов во время исполнения процедуры следует
исключить ввод и изменение каких-либо документов.
Если в ходе проверки остатков в проводках обнаружились ошибки, которые были исправлены, то
сразу вслед за этим необходимо запустить функцию корректировки балансов.

\subsection{Корректировка балансов}
%
%
%
\chapter{Язык описания формул\label{ch-lang-formula}}

Разнообразные формулы широко применяются при настройке системы.
По существу, язык описания арифметических формул использует традиционный
синтаксис описания таких формул, базирующийся на четырех арифметических
операция (сложение, вычитание, умножение и деление), с возможностью
использования нескольких дополнительных операций, а также функций.

\ppyexampletitle{Самый простейший пример формулы}
{
	$5+8/2-4.5*2$

	Конечно, от такой формулы пользы не много, но она демонстрирует простоту
	и очевидность синтаксиса.
}

\ppyexampletitle{Чуть более сложный пример}
{
	$5+8/2-pow(sqrt(9), 2)$

	Здесь, в дополнение к арифметическим операциям, добавилось
	использование функций. Мы подробно рассмотрим ниже все
	функции. Касательно данного примере, скажем лишь, что здесь
	применяются популярные функции возведения в степень ($pow$) и
	извлечения квадратного корня ($sqrt$).
}

Кроме функций в выражениях могут быть использованы, так называемые, символы.
Практически все символы зависят от контекста исполнения.

\section{Общие операции, функции и символы}

\subsection{Операции}

В формулах могут быть использованы следующие арифметические операции:

\begin{description}
	\item[*] Операция умножения.
	\item[/] Операция деления.
	\item[\%] Операция остатка от целочисленного деления.
	\item[+] Операция сложения.
	\item[-] Операция вычитания.
\end{description}

Кроме того, допускается использование операций сравнения:

\begin{description}
	\item[>] Больше.
	\item[>=] Больше или равно.
	\item[<] Меньше.
	\item[<=] Меньше или равно.
	\item[=] Равно.
	\item[!=] Не равно.
\end{description}

Результат сравнения является числом. Если сравнение истинно, то его результат
равен 1, в противном случае 0. Таким образом, допустимы довольно причудливые
конструкции вроде следующей

$(5 > 3) + 10$ будет равно 11.

\subsection{Функции}

\begin{description}
	\item[abs]
	Принимает один аргумент. Возвращает модуль (абсолютное значение) аргумента.

	\ppyexample{

		$abs(-10)$ равно 10.

		$abs(31)$ равно 31.
	}

	\item[sqrt]
	Принимает один аргумент. Возвращает квадратный корень аргумента.

	\ppyexample{
		$sqrt(9)$ равно 3.
	}

	\item[pow]
	Возводит число в степень.
	Принимает два аргумента: первый - число, которое необходимо возвести в степень,
	второй - значение степени. Если второй аргумент не задан, то функция возвращает
	просто первый аргумент (возведение в степень 1).

	\ppyexample{
		$pow(5, 3)$ равно 125.
	}

	\item[sin]
	Возвращает синус аргумента, заданного в радианах.
	Принимает один аргумент.

	\item[cos]
	Возвращает косинус аргумента, заданного в радианах.
	Принимает один аргумент.

	\item[tan]
	Возвращает тангенс аргумента, заданного в радианах.
	Принимает один аргумент.

	\item[round]
	Округляет первый аргумент до точности, заданной вторым аргументом.
	Округление осуществляется по бухгалтерскому правилу, то есть,
	5 округляется вверх.

	Принимает два аргумента. У второго аргумента (точность) отбрасывается дробная часть.
	Отрицательная точность округляет значение до соответствующей позиции перед десятичной
	точкой.

	Если задан только один аргумент, то первый округляется до целого значения.

	\ppyexample{

		$round(15.235, 2)$ равно 5.24.

		$round(15.235)$ равно 5.

		$round(15.235, -1)$ равно 20.
	}

	\item[roundup]
	Округляет первый аргумент до точности, заданной вторым аргументом.
	Округление осуществляется до наибольшего значения.

	Аргументы этой функции аналогичны round.

	\item[rounddown]
	Округляет первый аргумент до точности, заданной вторым аргументом.
	Округление осуществляется до наименьшего значения.

	Аргументы этой функции аналогичны round.

	\item[min]
	Возвращает минимальное из списка аргументов значение.
	Принимает любое число аргументов.

	Если не задано ни одного аргумента, то возвращает 0.

	\ppyexample{
		$min(-1, 2.3, 0, 5, -2.2)$ равно -2.2.
	}

	\item[minz]
	Возвращает минимальное из списка аргументов значение, не принимая в расчет
	величины, равные нулю.
	Принимает любое число аргументов.

	Если не задано ни одного отличного от нуля аргумента, то возвращает 0.

	\ppyexample{
		$minz(2.3, 0, 5)$ равно 2.3.
	}

	\item[max]
	Возвращает максимальное из списка аргументов значение.
	Принимает любое число аргументов.

	Если не задано ни одного аргумента, то возвращает отрицательное максимально
	возможное число с плавающей точкой двойной точности (-1.7976931348623158e+308).

	\ppyexample{
		$max(-1, 2.3, 0, 5, -2.2)$ равно 5.
	}

	\item[?]
	Функция возвращает второй или третий аргумент в зависимости от результата
	вычисления первого аргумента.

	\ppyexample{

		$?(5 > 3, 10, 20)$ равно 10.

		$?(5 < 3, 10, 20)$ равно 20.
	}

	\item[sieve]
	Функция (по русски означает \qu{решето}) возвращает величину, зависящую от
	того, в какой диапазон попадает аргумент.

	Формат функции несколько необычен: \ppysyntax{sieve[определитель-решета](аргумент)}

	определитель-решета выглядит так: \ppysyntax{значение-по-умолчанию; список-диапазонов}

	список-диапазонов представлен произвольным количеством конструкций следующего
	вида: \ppysyntax{нижняя-граница-диапазона ? значение}

	\ppyexampletitle{Теперь пример}{
		$sieve[1; 5 ? 1.1; 15 ? 1.2; 30 ? 1.3](21)$ равно 1.2

		В этом примере решето представлено следующими компонентами:
		\begin{description}
			\item[\ppysyntax{определитель-решета}] 1; 5 ? 1.1; 15 ? 1.2; 30 ? 1.3
			\item[\ppysyntax{значение-по-умолчанию}] 1
			\item[\ppysyntax{список-диапазонов}] 5 ? 1.1; 15 ? 1.2; 30 ? 1.3
			\item[диапазоны]

				$5 ? 1.1$ величинам больше или равным 5 соответствует значение 1.1.
				Сверху этот диапазон ограничен следующим диапазоном.

				$15 ? 1.2$ величинам больше или равным 15 соответствует значение 1.2.
				Сверху этот диапазон ограничен следующим диапазоном.

				$30 ? 1.3$ величинам больше или равным 30 соответствует значение 1.3
				Сверху этот диапазон не ограничен, так как является последним.

		\end{description}

		Величинам, которые меньше нижней границы диапазона с наименьшей
		границей (в нашем примере $5$) будет соответствовать значение-по-умолчанию
		(в примере $1$).
	}

	\item[oid]
	Функция возвращает полный идентификатор объекта данных. Под полным идентификатором
	подразумевается то, что возвращаемое значение содержит и тип объекта и его идентификатор.

	Функция используется в специальных случаях.

	Параметры:
	\begin{itemize}
		\item Символ типа объекта данных. Допустимы следующие значения:
		\begin{description}
			\item[UNIT] Единицы измерения.
			% \item[GOODS] Товары.
			% \item[GOODSGROUP] Группы товаров.
			% \item[BRAND] Торговые марки.
			\item[GOODSTYPE] Типы товаров.
			\item[GOODSCLASS] Классы товаров.
			% \item[GOODSARCODE] Коды товаров по статьям.
			% \item[PERSON] Персоналии.
			\item[PERSONKIND] Виды персоналий.
			\item[PERSONSTATUS] Юридические статусы персоналий.
			\item[PERSONCATEGORY] Категории персоналий.
			\item[LOCATION] Склад или иная локация (адрес, место хранения).
			\item[GLOBALUSER] Глобальные учетные записи.
			% \item[DL600] Структуры DL600.
			% \item[WORLD] Географические объекты.
			% \item[CITY] Частный случай географических объектов - города.
			% \item[COUNTRY] Частный случай географических объектов - государства.
			% \item[QUOT] Котировки.
			\item[CURRENCY] Валюта.
			\item[CURRATETYPE] Тип валютного курса.
			\item[QUOTKIND] Виды котировок.
			\item[Символ типа динамического объекта]
			Если динамический объект данных имеет собственный символ, то этот символ
			может быть использован в этой функции.

			Пример для этого случая приведен ниже.
		\end{description}

		В дальнейшем приведенный выше список будет расширяться.

		\item Символ объекта данных. Если значение параметра числовое, то функция ищет
		объект заданного первым параметром типа по идентификатору, равному второму аргументу.
		В противном случае функция пытается найти объект по строке символа, заданного
		этим аргументом.

		Идентификация объекта по символу возможна для следующих типов объектов данных:
		\begin{description}
			\item[UNIT]
			\item[GOODSTYPE]
			\item[GOODSCLASS]
			\item[PERSONKIND]
			\item[PERSONSTATUS]
			\item[PERSONCATEGORY]
			\item[LOCATION]
				Для этого типа объекта есть две особенности:
				\begin{itemize}
					\item Специальный символ \_undef определяет нулевое значение локации (используется как параметр в функциях определения значений котировок).
					\item Символ локации чувствителен к регистру знаков.
				\end{itemize}
			\item[GLOBALUSER]
			\item[QUOTKIND]
			\item[CURRENCY]
			\item[CURRATETYPE]
			\item[Динамические объекты]
		\end{description}

	\end{itemize}

	\ppyexample{
		$oid(UNIT, meter)$ возвращает идентификатор единицы измерения с символом \qu{meter}.

		$oid(QUOTKIND, 1)$ возвращает идентификатор вида котировки 1 (если вид котировки с таким идентификатором существует).

		Пример получения идентификатора динамического объекта.
		Допустим у нас есть динамический объект \qu{Виды алкогольной продукции}
		и символом этого типа является \ppyrsrv{ALCTYPE}. Тогда для получения идентификатора,
		скажем, вида \qu{Водка} (предположим, эта запись имеет символ \ppyrsrv{VOD})
		необходимо вызвать функцию в следующем виде $oid(ALCTYPE, VOD)$.
	}

\end{description}

\section{Контексты исполнения}

Важным аспектом применения формул является, так называемый, контекст исполнения. Собственно,
именно контекст исполнения делает формулы полезным инструментом, поскольку позволяет
оперировать атрибутами документов, товаров и иных сущностей, применяемых системой.

Так формулы могут использоваться для расчета сумм бухгалтерских проводок по документам.
В этом случае система рассматривает формулы в контексте документа.

Вот список контекстов:

\begin{description}
	\item[Контекст документа] % BillContext
	Используется при расчете сумм документов и формирования бухгалтерских
	проводок по документам.

	\item[Контекст товара] % GoodsContext
	Используется при вычислении различных параметров товаров, особенно это
	относится к классифицированным товарам.

	\item[Контекст расчета зарплаты] % SalaryContext
	Как следует из названия, используется при расчетах заработной платы.

	\item[Контекст формул DL200] %
	Применяется в языке описания данных DL200.

	\item[Контекст импорта/экспорта] % ImpExpExprEvalContext
	Используется при импорте/экспорте.

\end{description}

Принципиальным различием контекстов является разный набор используемых
в них функций. После описания общих функций и символов, мы перечислим функции,
применяемые в рамках каждого из описанных контекстов.

\subsection{Контекст документа}

\subsubsection{Символы}

Далее приведены правила распознавания символов документа программой.
Правила перечислены в том порядке, в котором система их пытается идентифицировать.
Этот порядок важен потому, что определяет результат работы разборщика
формулы в случае совпадения символов, имеющих разный смысл.

\begin{description}
	\item[QTTY]
	Суммарное количество торговых единиц товаров в документе.

	\item[PHQTTY]
	Суммарное количество физических единиц товаров в документе.

	\item[Символы типов сумм документов]
	Если распознается символ типа суммы документа, то
	результатом подстановки будет являться значение суммы
	этого типа в документе, связанном с контекстом.

	\ppyexample{
		$PRICE-DISCOUNT$ Вычисляет чистую цену продажи по документу
		(обычно, символом $PRICE$ обозначается сумма документа в учетных
		ценах реализации, а $PRICE$ - сумма скидки по документу).
	}

	\item[Символы формул]
	Извлекается формула, соответствующая символу и вычисляется как
	подвыражение текущей формулы.

	\item[ALAMT]
	Сумма по строке многострочного бухгалтерского документа (например,
	авансового отчета).

\end{description}

\subsubsection{Префиксы символов}

Для символов типов сумм документов а также для $QTTY$ и $PHQTTY$ могут
применяться специальные префиксы, позволяющие ссылаться на документы,
с которым связан документ контекста.

Префикс отделяется от символа точкой. Например: $LINK.COST$ здесь $LINK$ - префикс,
$COST$ - символ.

Допустимы следующие префиксы:

\begin{description}
	\item[LINK]
	Извлекает заданный символ из связанного документа. Связанные
	документы обычно есть у документов оплаты и привязанного возврата.

	Так выражение $LINK.COST * AMOUNT / LINK.AMOUNT$ вычислит пропорциональную
	сумму оплаты в учетных ценах поступления для документа оплаты, привязанной
	к документу отгрузки.

	\item[RCKN]
	Извлекает заданный символ из зачитываемого документа. Зачитываемый документ
	обычно есть у документов зачетных документов оплаты.

\end{description}

\subsubsection{Функции}

В контексте документа могут быть использованы следующие специальные
функции:

\begin{description}
	\item[amountbyvat]
	Сумма документа по строкам, товары которых облагаются указанной аргументом
	ставкой НДС.

	\item[amountbygvat]
	Сумма документа по строкам, товары которых облагаются указанной первым аргументом ставкой НДС.

	Отличается от $amountbyvat$ тем, что суммируются строки, по которым не эффективная,
	но номинальная (то есть, заданная для товара) ставка НДС равна указанной. Другими
	словами, эта функция игнорирует признаки освобождения поставщика или главной
	организации от НДС.

	\item[amountbytvat]
	Сумма документа по строкам, товары которых принадлежат типу oid(GOODSTYPE, id),
	заданному первым параметром и облагаются ставкой НДС, заданной вторым параметром.
	То есть, результат аналогичен $amountbyvat$ с той разницей, что суммирование
	ограничивается товарами с заданным типом.

	\ppyexample{
		$amountbytvat(oid(GOODSTYPE, Tare), 18)$

		Вычисляет сумму документа по строкам,
		товары которых имеют тип с символом $Tare$ и облагаемых 18-процентным НДС.
	}

	\item[costbyvat]
	Сумма документа в ценах поступления по строкам, товары которых облагаются указанной аргументом
	ставкой НДС.

	\item[costvat]
	Сумма НДС в ценах поступления по строкам документа, товары которых облагаются указанной аргументом
	ставкой НДС.

	\item[pricebyvat]
	Сумма документа в ценах реализации по строкам, товары которых облагаются указанной аргументом
	ставкой НДС.

	\item[pricevat]
	Сумма НДС в ценах реализации по строкам документа, товары которых облагаются указанной аргументом
	ставкой НДС.

	\item[haswhitelabel]
	Функция не имеет аргументов. То есть, она должна вызываться так: $haswhitelabel()$.
	Возвращает 1.0 если у документа установлен признак \ppyrsrv{WhiteLabel} и 0.0 в противном случае.

\end{description}

\subsection{Контекст товара}

Этот контекст используется во множестве различных ситуаций, в связи с чем может
иметь несколько форм. А именно:

\begin{itemize}
	\item Контекст может содержать полный пакет товара (например, при вызове из
	диалога редактирования товара при разрешении формул классифицированных товаров).
	\item При расчете формул компонентов товарной структуры контекст содержит эту структуру.
	\item В случае использования при экспорте документов контекст будет
	содержать пакет документа, что позволяет ссылаться на числовые атрибуты,
	присущие строкам товарных документов.
	\item Контекст может быть связан с технологической сессией.
\end{itemize}

\subsubsection{Функции}

\begin{description}
	\item[vat]
	Сумма НДС, которое облагается величина, переданная функции в качестве аргумента.
	По умолчанию предполагается, что значение первого аргумента не содержит в себе сумму
	НДС, которую необходимо вычленить.
	Если же в функции задан второй аргумент и его значение не равно нулю, тогда
	функция считает, что значение первого аргумента содержит в себе сумму НДС.

	\item[vatplus]
	Прибавляет сумму НДС, которое облагается величина, переданная функции в качестве аргумента.
	Предполагается, что величина, переданная в качестве аргумента, не содержит сумму НДС.

	\item[vatminus]
	Вычитает сумму НДС из величины, переданной в качестве аргумента.
	Предполагается, что эта величина, содержит сумму НДС.

	\item[getquot]
	Возвращает значение котировки товара.
	В качестве параметров функции могут быть переданы идентификаторы
	объектов (oid), определяющих значение котировки.
	Как минимум, в функцию должен быть передан идентификатор вида котировки,
	кроме того, опционально, могут быть переданы идентификаторы валюты, аналитической
	статьи (с которой связана котировка) и склада.

	\ppyexample{

		getquot(oid(QUOTKIND, Q01), oid(LOCATION))
	}

	\item[getquotcp]
	Возвращает значение котировки товара, возможно, относительно заданных
	параметров цены поступления и цены реализации (для относительных котировок).

	\ppyexample{

		getquotcp(oid(QUOTKIND, Q01), oid(LOCATION), quot.sdeal, quot.sdeal)
	}

\end{description}

\subsubsection{Префиксы символов}

Префикс уточняет товар, к которому относится символ, следующий за префиксом после точки.
Пример: $MAIN.X$ - классификатор X основного товара структуры.

\begin{description}
	\item[MAIN]
	Основной товар структуры. Применяется в случае, если контекст работает с товарной
	структурой (например, при автоматическом расчете формул в компонентах структур).

	\item[MAINCOM]
	Товар главного компонента структуры. По этому префиксу может быть идентифицирован
	товар только в том случае, если контекст ссылается на структуру и эта структура имеет
	один компонент с признаком \dlgflag{Основной компонент}.

	\item[PREV]
	Специализированный префикс, применяемый для расчетов по технологическим сессиям перенастройки
	процессоров.

	Вместо этого префикса подставляется товар, который производился процессором до сессии
	перенастройки.

	\item[QUOT]
	Этот префикс позволяет получить значение котировки по основному товару контекста.
	Вслед за этим префиксом должен следовать символ вида котировки.

	Например: $QUOT.BASE$ возвращает значение базовой ($BASE$) котировки для основного
	товара контекста. Если контекст содержит товарный документ, то будет возвращено значение
	котировки, связанное со складом, валютой и контрагентом документа.

	\item[LOTTAG]
	При использовании контекста с товарным документом, этот префикс возвращает значение
	тега лота, с символом, заданным после точки.

	Например: $LOTTAG.SPCCOST$ возвращает значение некоторой специализированной цены ($SPCCOST$),
	связанной с лотом текущей строки товарного документа.

	\item[TAG]
	Префикс возвращает значение тега товара. Символ типа тега определяется строкой,
	следующей после точки.

	Например: $TAG.MAXPRICE$ возвращает значение тега товара с символом $MAXPRICE$.

	\ppyadmin{
		Префикс введен в релизе 7.5.1.
	}
\end{description}

\subsubsection{Символы}

\begin{description}
	\item[ID] Возвращает значение идентификатора товара.
	\ppyadmin{
		Символ введен в релизе 7.5.1.
	}
	\item[X] Возвращает значение классификатора X товара.
	\item[Y] Возвращает значение классификатора Y товара.
	\item[Z] Возвращает значение классификатора Z товара.
	\item[W] Возвращает значение классификатора W товара.
	\item[KIND] Возвращает идентификатор перечисляемого объекта \ppyrsrv{Вид}
	товара.
	Идентификатор возвращается в форме, аналогичной той, что
	возвращается функцией $oid()$ и может применяться только для сравнения
	посредством операторов $=$ или $!=$.

	Например: $KIND==oid(ALCTYPE, VOD)$

	\item[GRADE] Тоже, что и KIND, только для классификатора \ppyrsrv{Сорт}.
	\item[ADDPROP] Тоже, что и KIND, только для классификатора \ppyrsrv{Классификатор}.
	\item[ADDPROP2] Тоже, что и KIND, только для классификатора \ppyrsrv{Классификатор 2}.
	\item[TYPE] Возвращает идентификатор типа товара.
	Идентификатор возвращается в форме, аналогичной той, что
	возвращается функцией $oid()$ и может применяться только для сравнения
	посредством операторов $=$ или $!=$.

	Например: $TYPE==oid(GOODSTYPE, ASSETS)$

	\item[PHUPERU] Возвращает соотношение физических единиц товара к торговым.
	\item[QTTY] При использовании контекста с товарным документом возвращает количество
	в текущей товарной строке документа.

	Если контекст связан с технологической сессией, то этот символ заменяется на значение
	количества товара в строках сессии.

	\item[QTY] Тоже, что и QTTY.

	\item[PHQTTY] Тоже, что и QTTY только в пересчете на физические единицы измерения.
	\item[PHQTY] Тоже, что и PHQTTY.
	\item[QTTYCOM] Применяется для контекста, связанного с товарной структурой. Возвращает
	количества компонента структуры.

	\item[COST] При использовании контекста с товарным документом возвращает цену
	поступления текущей строки документа.
	\item[PRICE] При использовании контекста с товарным документом возвращает цену
	реализации текущей строки документа.
	\item[DISCOUNT] При использовании контекста с товарным документом возвращает
	скидку текущей строки документа.
	\item[A1] При ручном расчете значения по формуле этот символ заменяется на первый параметр,
	введенный пользователем.
	\item[A2] При ручном расчете значения по формуле этот символ заменяется на второй параметр,
	введенный пользователем.
	\item[A3] При ручном расчете значения по формуле этот символ заменяется на третий параметр,
	введенный пользователем.
	\item[PI] Константа $\pi$.
\end{description}

\subsection{Контекст расчета зарплаты}

\subsection{Контекст формул DL200}

\subsection{Контекст импорта/экспорта}

\chapter{Язык описания данных DL600\label{ch-lang-dl600}}

Язык DL600 является декларативным языком, применяемым для описания разнообразных
структур данных, используемых системой \ppybrand{}.

С помощью этого языка определяются следующие категории данных системы:
\begin{description}
	\item[COM-интерфейсы] Внутреннее применение языка. Используется только на
	стадии разработки.
	\item[Структуры таблиц баз данных] Внутреннее применение языка.
	Используется на стадии разработки для определения структур таблиц баз данных.
	\item[Экспортные структуры данных] Применяется как на этапе разработки, так
	и при эксплуатации системы для кастомизации стандартных (определенных в дистрибутиве)
	структур данных для печати и экспорта.
\end{description}

\section{Синтаксис языка}

\subsection{Лексические соглашения}

\paragraph{Чувствительность к регистру}
Язык DL600 является чувствительным к регистру символов.

Например, слова Goods и goods с точки зрения компилятора языка различны.

\paragraph{Пробелы и перевод каретки}
Символы пробела, табуляции, перевода каретки, за исключением разделения слов,
являются не значащими. То есть, несколько таких символов, следующих последовательно
друг за другом воспринимаются компилятором как один.

\subsection{Зарезервированные слова}

Следующие слова зарезервированы компилятором:
\begin{description}
	\item[IMPORT]
	\item[import]
	\item[data]
	\item[interface]
	\item[struct]
	\item[enum]
	\item[iclass]
	\item[declare]
	\item[iteration]
	\item[link]
	\item[if]
	\item[else]
	\item[format]
	\item[in]
	\item[out]
	\item[inout]
	\item[default]
	\item[version]
	\item[library]
	\item[uuid]
	\item[abstract]
	\item[property]
	\item[table]
	\item[index]
	\item[file]
\end{description}

Кроме того, зарезервированы следующие слова, обозначающие типы данных:

\begin{description}
	\item[void]
	\item[bool]
	\item[int]
	\item[long]
	\item[uint]
	\item[char]
	\item[int8]
	\item[int16]
	\item[short]
	\item[int32]
	\item[autolong]
	\item[int64]
	\item[uint8]
	\item[uint16]
	\item[uint32]
	\item[float]
	\item[double]
	\item[money]
	\item[decimal]
	\item[string]
	\item[lstring]
	\item[date]
	\item[time]
	\item[datetime]
	\item[key]
	\item[variant]
	\item[wchar]
	\item[note]
	\item[raw]
	\item[blob]
	\item[clob]
\end{description}

\subsection{Структура файла}

Файл DL600 представляет собой набор описаний данных. Каждый набор состоит из полей заголовка
(DEFAULT HEAD) и итераторов.

\subsection{Определение поля}

<type> <field\_name> [ [ <length> [ .<prec> ] ] ] [<alias>] [\~<format>] ;

<type> :
\subsection{Вычисляемые поля}
\subsubsection{Функции}

\begin{description}
	\item[@(struc-name, int)]
	Специальная синтаксическая конструкция, возвращающая ссылку на структуру данных struc-name
	с идентификатором, определяемым вторым параметром.

	\ppyexample{

		$@(Goods, 20).Name$

		Выражение возвращает наименование из структуры данных Goods с идентификатором 20.

		$@(Person, GetTag("MANUF").ObjID)$

		Выражение в данном примере возвращает ссылку на структуру Person с идентификатором,
		возвращаемом функцией $GetTag("MANUF").ObjID$.
	}

	\item[length(string)] Возвращает  длину строки.

	Результат long.

	\item[sqrt(double a)] Возвращает квадратный корень аргумента a.

	Результат: double.

	\item[sqrt(int a)] Возвращает квадратный корень аргумента a.

	Результат: double.

	\item[round(double v, int p)]
	Округляет значение первого аргумента $v$ до точности $p$ знаков после
	десятичной точки. Если $p$ меньше нуля, то округляет до $-p$ десятичного
	разряда.

	Результат: double.

	\item[abs(double)] Возвращает абсолютное значение аргумента.

	Результат: double.

	\item[left(string s, int N)] Возвращает  первые N символов.

	Результат: string.

	Номинальная длина результирующего поля равна номинальной длине аргумента $s$.

	\item[right(string s, int N)] Возвращает последние N символов.

	Результат: string.

	\item[middle(string s, int B, int N)]
	Возвращает часть строки $s$ с символа номер $B$ длиной $N$ символов.

	Результат: string.

	Номинальная длина результата равна номинальной длине аргумента $s$.

	\item[wrap(string s, int N)]
	Возвращает первые $N$ символов, если в них нет пробела, иначе - часть строки до последнего
	пробела в первых $N$ символах.

	Результат: string.

	\item[replace(string source, string pattern, string replacer)]
	Замещает в строке source образец pattern на строку replacer.

	Результат: string.

	Поиск pattern в строке source осуществляется с учетом регистра символов.

	Номинальная длина результата равна номинальной длине аргумента source.

	\item[format(data, format\_spec)]
	Возвращает строку отформатированных данных data в соответствии со спецификацией format\_spec.

	Результат: string.

	\item[money2str(double D, long L)]
	Возвращает сумму $D$ прописью. $L$ - максимальная длина строки.

	Результат: string.

	\item[num2str(double D, long L)]
	Возвращает число $D$ прописью. $L$ - максимальная длина строки.

	Результат: string.

	\item[date2str(date D, long L)]
	Возвращает число $D$ в виде dd/mm/yy. $L$ - максимальная длина строки.

	Результат: string.

	\item[date2wstr(date D, long L)]
	Возвращает число $D$ прописью. $L$ - максимальная длина строки.

	Результат: string.

	\item[formatperiod(date start, date end)]
	Форматирует строку периода, ограниченную датами $start$ и $end$.

	Результат: string[30].

	\item[printablebarcode(string barcode, long codeType)]
	Преобразует штрихкод в формат, пригодный для печати штрихкода на обычном принтере.

	Если $codeType$ равно нулю, то система считает,  что передаваемый ей код $barcode$ является
	розничным кодом (EAN-13, EAN-8, UPC-A, UPC-E конкретный тип кода система идентифицирует
	в зависимости от длины и символов кода).

	Если $codeType$ равно 39, то система формирует печатаемую версию штрихкода в формате
	Code39 (допустимы цифры и латинские символы, которые система переводит в верхний регистр).\\

	Результат: string[20].

	\item[barcodeaddcd(string barcode)]
	Возвращает строку штрихкода, эквивалентную $barcode$, дополняя ее контрольной
	цифрой, если в конфигурации справочника товаров не установлен флаг
	\dlgflag{Штрихкод содержит контрольную цифру} и длина $barcode$ больше 3 и
	начальные символы $barcode$ не соответствуют префиксу весового кода, заданного
	в конфигурации справочника товаров.

	Результат: string[16].

	\item[datedmy(int day, int month, int year)]
	Возвращает дату в которой день равен аргументу $day$, месяц - аргументу $month$, год - аргументу $year$.

	Результат: date.

	\item[datezero()] Возвращает пустую дату.

	Результат: date.

	\item[timehms(int hour, int minut, int second)]
	Возвращает время в котором час равен аргументу $hour$, минуты - аргументу $minut$, секунды - аргументу $second$.

	Результат: time.

	\item[timezero()] Возвращает пустое значение времени.

	Результат: time.

	\item[(double) string] Конвертирует строку в число, если это возможно, иначе возвращает 0.

	Результат: double.

	\item[(double) int] Преобразует число из типа int в тип double.

	Результат: double.

	\item[(int) string] Конвертирует строку в число, если это возможно, иначе возвращает 0.

	Результат: int.

	\item[(int) double] Преобразует число из типа double в тип int.

	Результат: int.

	\item[if (long L) expr] Возвращает expr, если L не равно 0.

	Результат имеет тот же тип, что и expr.

	\item[if (long L) expr1 else expr2]
	Возвращает expr1, если L не равно 0, иначе expr2. Типы данных у expr1 и expr2 должны
	быть одинаковыми.

	Результат имеет тот же тип, что и expr1.

	\item[long L  ? expr1 : expr2]
	Возвращает expr1, если L не равно 0, иначе expr2. Типы данных у expr1 и expr2 должны
	быть одинаковыми.

	Результат имеет тот же тип, что и expr1.
\end{description}

\subsubsection{Операторы}

\begin{description}
	\item[+] Оператор сложения. Его поведение зависит от типа операндов, к которому
	он применяется.
	\begin{description}
		\item[int+int] Складывает два целых числа. Результат int.
		\item[double+double] Складывает два действительных числа. Результат double.
		Если первый или второй операнд является целочисленным, то он преобразуется к double.
		\item[date+int] Прибавляет к дате указанное вторым операндом количество дней. Результат date.
		Если второй операнд является действительным числом, то он преобразуется к целочисленному
		отбрасыванием дробной чисти.
		\item[string+string] \qu{Склеивает} две строки. Результат string.
	\end{description}

	\item[-] Оператор вычитания. Поведение зависит от типа операндов.
	\begin{description}
		\item[int-int] Вычитает из первого целого числа второе. Результат int.
		\item[double-double] Вычитает из первого действительного числа второе. Результат double.
		Если первый или второй операнд является целочисленным, то он преобразуется к double.
		\item[date-date] Вычитает из первой даты вторую вычисляя таким образом разницу в днях между ними.
		Результат int.
	\end{description}

	\item[*] Оператор умножения. Поведение зависит от типа операндов.
	\begin{description}
		\item[int*int] Перемножает два целых числа. Результат int.
		\item[double*double] Перемножает два действительных числа. Результат double.
		Если первый или второй операнд является целочисленным, то он преобразуется к double.
		\item[string*string] \qu{Склеивает} две строки таким образом, что между ними остается один пробел.
		Результат string.
	\end{description}

	\item[/] Оператор деления. Может быть применен либо к целочисленным либо к действительным
	операндам.

	В случае, если делитель равен нулю, то возвращается 0. Такое правило, хотя не согласуется с
	общепринятыми канонами, позволяет избежать исключительных ситуаций, при которых программа
	аварийно завершает работу.
	%\item[\&]
	%\item[\|]
	%\item[\&\&]
	%\item[\|\|]
	%\item[\~]
	%\item[\^]
	%\item[==]
	%\item[!=]
\end{description}

\subsection{Спецификаторы формата вывода}

\~[alignment][overflow][length][.prec][flags]

	\paragraph{Alignment}
	Параметр выравнивания.
	\begin{description}
		\item[<] по левому краю
		\item[|] по центру
		\item[>] по правому краю
	\end{description}

	\paragraph{Overflow}
	Заполнение при переполнении.
	\begin{description}
		\item[*] заполняет символом '\#' все поле, если длина строки выходит
		за заданные пределы
	\end{description}

	\paragraph{Length}
	Полная длина поля вывода.

	\paragraph{Prec}
	Максимальное количество знаков после десятичной точки.

	\paragraph{flags}
	Флаги форматирования.

	Строка (prefix '@')
	\begin{description}
		\item[U] Все буквы в верхнем регистре.
		\item[L] Все буквы в нижнем регистре.
		\item[P] Все символы заменяются символом *.
	\end{description}

	Число (prefix '\$')
	\begin{description}
		\item[C] Разделять триады чисел запятыми.
		\item[S] Разделять триады чисел пробелами.
		\item[A] Разделять триады чисел апострофами (').
		\item[F] Перед положительными числами ставить знак +.
		\item[Z] Не пропечатывать нулевые значения.
		\item[N] Опускать незначащие нули.
	\end{description}

	Дата (prefix '\#')
	\begin{description}
		\item[A] American (mm.dd.yy)
		\item[B] British
		\item[D] DMY (dd/mm/yy)
		\item[F] French
		\item[G] German (dd.mm.yy)
		\item[I] Italian
		\item[J] Japan
		\item[M] MDY (mm/dd/yy)
		\item[U] USA
		\item[W] ANSI
		\item[Y] YMD (yy/mm/dd)
	\end{description}

	Если второй символ 'C' or 'c', то полностью выдавать год (например: 2003 вместо 03).

	Время (prefix '\&')
	\begin{description}
		\item[F] hh:mm:ss.dd
		\item[N] hh:mm:ss
		\item[H] hh:mm
		\item[L] mm:ss.dd
		\item[L] mm:ss
		\item[S] ss.dd
		\item[S] Ss
	\end{description}

	Если второй символ 'B', то - пустая строка для времени 00:00:00.

\chapter{COM-интерфейсы\label{ch-comifc}}

\section{Концепции}

\section{Замечания по типам данных}

В представлении интерфейсов повсеместно применяются VARIANT-совместимые типы данных.
Учитывая, что большая часть разработчиков, для которых предназначены эти интерфейсы,
пользуются языком Visual Basic, при разработке интерфейсов приняты меры для того, чтобы
они корректно работали с этим языком.
Из-за того, что в Visual Basic нет беззнакового целого числа, в интерфейсах такие типы
не применяются.

Далее мы перечислим типы, используемые в описании структур и интерфейсов.

\newcommand\dltype[4]{
	\paragraph{#1} [VisualBasic] #2. [C++] #3.
	\newline #4
}

\dltype{int}{Int}{int}{4-x байтовое знаковое целое}
\dltype{long}{Long}{long}{4-x байтовое знаковое целое}
\dltype{string}{String}{BSTR}{
	Указатель на UNICODE-строку. За разрушение указателя отвечает клиент
	(в случае VisualBasic - система исполнения этого языка)
}
\dltype{date}{Date}{DATE}{
	Число с плавающей точкой двойной точности. Формат представления в нем
	даты и времени описан в MSDN.

	Нулевое значение интерпретируется как неопределенное.
}
\dltype{time}{Date}{DATE}{То же, что и date}
\dltype{datetime}{Date}{DATE}{То же, что и date}

\section{Спецификации}

\newcommand\dldeclstruct[2]{
	\paragraph{Структура {\ttfamily #1}}\indent{\itshape Описание:}{#2}
}
\newcommand\dldeclfld[3]{
	\\ \indent{\itshape Поле }{\ttfamily #1} {\ttfamily #2}. #3
}
\newcommand\dldeclifc[2]{
	\paragraph{Интерфейс {\ttfamily #1}}\indent{\itshape Описание:}{#2}
}
\newcommand\dldeclmethod[3]{
	{\itshape Метод }{\ttfamily #1} {\ttfamily #2}. #3
}
\newcommand\dldeclarg[2]{
	 \indent{\ttfamily ARG(#1):} \\ \indent{\ttfamily #2}
}
\newcommand\dldeclret[1]{
	\indent{\ttfamily Returns:} \\ \indent{\ttfamily #1}
}

\dldeclstruct{SDateRange}{
	Представление периода между двумя датами. Все функции, использующие структуру периода,
	считают, что нижняя и верхняя границы включены в период.

	Если нижняя граница не определена (Low = 0), то, как правило, рассматриваются данные с
	начала ведения учета в базе данных. Если верхняя граница не определена (Upp = 0), как
	правило, рассматриваются данные до самой последней записи (в хронологическом порядке),
	введенной в базу данных.

	Оговоренное правило - наиболее общее. В зависимости от контекста,
	оно может изменяться. В некоторых случаях указанный извне период может быть
	наложен на период, определенный правами доступа.
}
\dldeclfld{Low}{date}{Нижняя граница периода}
\dldeclfld{Upp}{date}{Верхняя граница периода}

\dldeclstruct{SIterCounter}{
	Счетчик итераций. Используется в объектах КАД для подсчета итераций с целью
	информирования пользователя о прогрессе хода процесса перечисления.
}
\dldeclfld{Count}{long}{Текущая (завершенная) итерация}
\dldeclfld{Total}{long}{Общее количество итераций}

\dldeclstruct{STaggedString}{
	Структура используемая для организации списков строковых ассоциаций. Нулевым элементом
	STaggedString считается такой, у которого: Id = 0, ParentId = 0, Text = "".
}
\dldeclfld{Id}{long}{Идентификатор элемента}
\dldeclfld{ParentId}{long}{Идентификатор родительского элемента. Если 0, то верхний уровень}
\dldeclfld{Text}{string}{Текст}

\dldeclstruct{SPpyDatabaseInfo}{
	Представление информации об одной базе данных системы
}
\dldeclfld{ID}{long}{
	Ид базы данных. Этот идентификатор является неявным и нефиксированным. Физически, он
	представляет номер позиции точки входа в базу данных, описанной в файле pp.ini
}
\dldeclfld{Flags}{long}{Зарезервировано (0)}
\dldeclfld{Type}{long}{Зарезервировано (0)}
\dldeclfld{Symb}{string}{Символ базы данных}
\dldeclfld{Name}{string}{Дружественное пользователю наименование базы данных}
\dldeclfld{Path}{string}{Путь к каталогу базы данных}
\dldeclfld{SysPath}{string}{Путь к каталого словаря данных}

\dldeclstruct{SPpySessionInfo}{
	Представление информации о текущем состоянии класса, реализующего интерфейс IPapyrusSession.
}
\dldeclfld{SessID}{long}{Ид сессии}
\dldeclfld{Flags}{long}{}
\dldeclfld{MainOrgID}{long}{Ид главной организации}
\dldeclfld{DbDivID}{long}{Ид раздела базы данных}
\dldeclfld{UserID}{long}{Ид пользователя}
\dldeclfld{DbName}{string}{Наименование базы данных}
\dldeclfld{DbSymb}{string}{Символ базы данных}
\dldeclfld{SysPath}{string}{Путь к словарю данных}
\dldeclfld{DbPath}{string}{Путь к базе данных}

\dldeclifc{StrAssoc}{
	Интерфейс обеспечивающий управление списком строк, ассоциированных с целочисленными
	идентификаторами.

	attention: В текущих версиях поле STaggedString::ParentId не поддерживается //
}

	Методы
	\dldeclmethod{long}{GetCount()}{
		Descr: Возвращает количество элементов в списке.
	}
	\dldeclmethod{int}{Get(long pos, out STaggedString * pItem)}{
		Descr: Возвращает элемент по индексу pos. Если pos < GetCount(), то pItem обнуляется %
		(Id = 0, ParentId = 0, Text = "").
	}
	\dldeclarg{pos IN}{
		\@\#{0..GetCount()-1}

		позиция в списке, по которой следует вернуть элемент.
	}
	\dldeclarg{pItem OUT}{
		\@\#{vptr0}

		Указатель на структуру STaggedString, по которому присваивается
		найденный элемент. Если pItem == 0, то функция просто ничего не присваивает, но возвращает
		значение то же, как будто pItem != 0.
	}
	\dldeclret{
	  \\>0 - элемент успешно извлечен из списка и присвоен по адресу pItem
	  \\0  - индекс pos выходит за диапазон [0..GetCount()-1]. По адресу pItem присвоен нулевой
	  элемент.
	}
	\dldeclmethod{int}{SearchById(long id, out STaggedString * pItem)}{
		Descr: Ищет в списке элемент с идентификатором STaggedString::Id == id. Поиск осуществляется в
		линейном порядке (не взирая на сортировку, если она есть). По этому, если в списке присутствует
		более одного элемента с таким идентификатором, то функция обнаружит и вернет тот, у которого
		меньшее значение индекса позиции.
	}
	\dldeclarg{id IN}{
		Идентификатор элемента, который должен быть найден.
	}
	\dldeclarg{pItem OUT}{
		\@\#{vptr0} Указатель на структуру STaggedString, по которому присваивается
		найденный элемент. Если pItem == 0, то функция просто ничего не присваивает, но возвращает
		значение то же, как будто pItem != 0.
	}
	\dldeclret{
	  \\>0 - элемент со значением STaggedString::Id == id найден и присвоен по адресу pItem.
	  \\0  - элемент со значением STaggedString::Id == id не найден. По адресу pItem присвоен
	  нулевой элемент.
	}
	\dldeclmethod{int}{SearchByText(string text, out STaggedString * pItem)}{
		Descr: Ищет в списке элемент со строкой, равной text. Равенство строк определяется по
		последовательному соответствию всех символов с точностью до регистра букв.
		Поиск осуществляется в линейном порядке (не взирая на сортировку, если она есть).
		По этому, если в списке присутствует более одного элемента с похжодящим полем Text,
		то функция обнаружит и вернет тот, у которого меньшее значение индекса позиции.
	}
	\dldeclarg{text IN}{
		Строка, соответствующая полю STaggedString::Text элемента, который должен
		быть найден.
	}
	\dldeclarg{pItem OUT}{
		\@\#{vptr0} Указатель на структуру STaggedString, по которому присваивается //
		найденный элемент. Если pItem == 0, то функция просто ничего не присваивает, но возвращает
		значение то же, как будто pItem != 0.
	}
	\dldeclret{
	  \\>0 - элемент со значением STaggedString::Id == id найден и присвоен по адресу pItem.
	  \\0  - элемент со значением STaggedString::Id == id не найден.
	       По адресу pItem присвоен нулевой элемент.
	}
	\dldeclmethod{string}{GetTextById(long id)}{
		Descr: Ищет в списке элемент с идентификатором STaggedString::Id == id и, в случае успеха,
		возвращает строку, соответствующую этому элементу. Поиск осуществляется в линейном порядке
		(не взирая на сортировку, если она есть). По этому, если в списке присутствует более одного
		элемента с таким идентификатором, то функция обнаружит и вернет тот, у которого меньшее
		значение индекса позиции.
	}
	\dldeclarg{id IN}{Идентификатор элемента, который должен быть найден.}
	\dldeclret{
	  Поле STaggedString::Text найденного элемента. Если элемент с заданным идентификатором не
	  найден, то возвращается пустая строка.
	}
	\dldeclmethod{void}{InitIteration()}{
		Descr: Инициализирует внутренний счетчик для последующих вызовов функци NextIteration.
	}
	\dldeclmethod{int}{NextIteration(out STaggedString * pItem)}{
		Descr: Возвращает элемент, соответствующий внутреннему счетчику объекта и увеличивает
		на единицу значение этого счетчика.
		Если внутренний счетчик выход за пределы [0..GetCount()-1], то возвращает 0.
	}
	\dldeclarg{pItem OUT}{
		\@\#{vptr0} Указатель на структуру STaggedString, по которому присваивается //
		очередной элемент. Если pItem == 0, то функция просто ничего не присваивает, но возвращает
		значение то же, как будто pItem != 0.
	}
	\dldeclret{
	  \\>0 - очередной элемент получен и присвоен по укзателю pItem. Внутренний счетчик увеличен
	       на единицу.
	  \\0  - больше нет ни одного элемента для перечисления //
	       По адресу pItem присвоен нулевой элемент.
	}
	\dldeclmethod{void}{Clear()}{
		Descr: Удаляет все элементы из списка. Единственный гарантированный результат этой функции
		состоит в том, что количество доступных элементов в списке станет равным нулю.
		Предположений об очистке внутренней памяти делать не следует.
	}
	\dldeclmethod{void}{Add(long itemId, long parentId, string text)}{
		Добавляет в список новый элемент с полями:
		STaggedString::Id = itemId, STaggedString::ParentId = parentId, STaggedString::Text = text;
		Если в списке уже присутсвует элемент с идентификатором itemId, то новый не добавляется,
		но у существующего заменяются атрибуты ParentId и Text на те, что указаны в аргументах.
		Не следет делать предположения относительно индекса позиции, в которую был добавлен новый
		элемент.
	}
	\dldeclmethod{void}{Sort(int byText)}{
		Descr: Сортирует элементы списка.
	}
	\dldeclarg{byText IN}{
		Если этот параметр равен 1, то сортировка осуществляется по полю STaggedString::Text,
		в противном случае - по полю STaggedString::Id.
	}
	\dldeclmethod{void}{Clone(out IStrAssocList ** ppClone)}{
		Создает экземпляр списка, содержащего такие же элементы, что в оригинальном экземпляре.
		Элементы в копии находятся в той же последовательности, что и в оригинале.
	}
	\dldeclmethod{int}{CloneByParent(long parentId, out IStrAssocList ** ppClone)}{
		Создает экземпляр списка, содержащий выборку элементов из оригинального списка, у которых
		поле STaggedString::ParentId = parentId.
	}
	\dldeclret{
	  \\>0 - создана копия, содержащая по крайней мере один элемент
	  \\<0 - создана копия, не содержащая ни одного элемента из оригинального списка. Это означает,
	  что в оригинальном списке нет ни одного элемента с STaggedString::ParentId = parentId
	  \\0  - ошибка
	}
	attention: В текущих версиях функция не поддерживается %


	\dldeclifc{ IPapyrusSession}
	{Обеспечивает интерфейс рабочей сессии в базе данных. Предоставляет сервисы для авторизации
	в базе данных, доступа к объектам данных, контроллерам анализа данных (КАД) и др.}

	Методы
	\dldeclmethod{}{IStrAssocList * GetDatabaseList(int nameKind)}{
	Возвращает список строк, идентифицирующий базы данных, доступные для авторизации. Для
	выполнения функции нет необходимости авторизоваться в какой-либо БД. После использования,
	возвращенный список должен быть разрушен обычным образом.}

	\dldeclarg{nameKind IN}{ Значение, определяющее, какую строку передавать в списке вместе с
	идентификатором. Возможные значения:
	\\0 - символ базы данных
	\\1 - дружественное наименование базы данных
	\\2 - путь к каталогу базы данных
	\\Любое другое значение интерпретируется как 0.
	}
	\dldeclret{
	Указатель на интерфейс сформированного списка. В случае ошибки - 0.
	}

	\dldeclmethod{int}{GetDatabaseInfo(long id, SPpyDatabaseInfo * pInfo)}{
	Возвращает начальную информацию о базе данных. Для выполнения функции нет
	необходимости авторизоваться в какой-либо БД.}

	\dldeclarg{id     IN}{ @\#[1..] Идентификатор базы данных. Этот идентификатор является неявным и
	нефиксированным. Физически, он представляет номер позиции точки входа в базу данных,
	описанной в файле pp.ini. Самым естественным способом получения этого идентификатора
	видится извлечение его из списка, полученного вызовом IPapyrusSession::GetDatabaseList().}

	\dldeclarg{pInfo OUT} {@\#\{vptr0\} Указатель на структуру SPpyDatabaseInfo, по которому будет записана
	информация о базе данных.}
	\dldeclret{
	\\	>0 - информация о базе данных успешно извлечена и присвоена по указателю pInfo
	\\	0  - ошибка
		}

	\dldeclmethod{int}{Login(string dbName, string userName, string password)}{
	Descr: Реализует авторизацию в базе данных. Конфигурация и ограничения прав доступа для
	сеанса, авторизованного через этот метод, действуют так же, как и для интерактивного
	сеанса системы. После завершения работы с сеансом необходимо выполнить функцию Logout().
	Несколько последовательных Login() без соответствующего вызова Logout() могут привести
	к тому, что следующее обращение к Login() завершится с ошибкой.}

	\dldeclarg{dbName   IN}{ символ базы данных, в которой необходимо авторизоваться}

	\dldeclarg{userName IN} {имя пользователя}

	\dldeclarg{password IN}{ пароль, соответствующий имени userName}
	\dldeclret{
	  \\>0 - авторизация успешно выполнена
	  \\0  - ошибка}

	\dldeclmethod{int}{    Logout()}{
		Descr: Завершает авторизованный сеанс работы в базе данных.
		}

	\dldeclmethod{string}{ GetObjectTitle(PpyObjectIdent objType)}{
	Descr: Возвращает наименование типа объекта данных objType. Например, вызов
	GetObjectTitle(ppoAccSheet) вернет строку "Таблица аналитического учета".
	}
	\dldeclret{
	  	Наименование типа объекта данных. Если objType задан неверно, то вернет пустую строку.
	  	}
	\dldeclmethod{}{IPapyrusObject * CreateObject(PpyObjectIdent objType)}{
	Descr: Создает экземпляр объекта данных типа objType. После завершения работы с этим
	экземпляром объекта, он должен быть разрушен обычным образом.
	}
	\dldeclret{
		  Указатель на интерфейс созданного экземпляра объекта данных. В случае ошибки - 0.
		  }
	\dldeclmethod{}{IPapyrusView   * CreateView(PpyViewIdent viewID)}{
	Descr: Создает экземпляр контроллера анализа данных (КАД) типа viewID. После завершения
	работы с этим экземпляром КАД, он должен быть разрушен обычным образом.
	}
	\dldeclret{
		  Указатель на интерфейс созданного экземпляра КАД. В случае ошибки - 0.
		  }
	\dldeclmethod{int}{GetStatusInfo(out SPpySessionInfo * pInfo)}{
	Descr: Инициализирует структуру с информацией о текущем состоянии сеанса.}

	\dldeclarg{pInfo OUT}{ {vptr0} Указатель на структура SPpySessionInfo в которой содержатся
	поля информации о текущем состоянии сеанса.
	}
	\dldeclret{
	 \\ >0 - информация извлечена успешно и присвоена по указателю pInfo.
	 \\ 0  - ошибка}





	Перечисление PpyViewIdent
	Descr: Перечисление типов контроллеров анализа данных PPView.
	\\ppvCCheck   = 1
	\\PPViewCCheck
	\\ppvTrfrAnlz = 2
	\\PPViewTrfrAnlz

	Перечисление PpyObjectIdent
	Descr: Перечисление типов объектов PPObject. Каждый элемент перечисления должен иметь
	соответствие PPOBJ\_XXX в файле ppdefs.h (значения идентификаторов ppoXXX и PPOBJ\_XXX
	обязательно должны совпадать)
	\\ppoAccSheet =   13
	\\=PPOBJ\_ACCSHEET Таблицы аналитического учета
	\\ppoCashNode =   17
	\\=PPOBJ\_CASHNODE Расчетные кассовые узлы
	\\ppoArticle  = 1006
	\\=PPOBJ\_ARTICLE  Статьи аналитического учета
	\dldeclifc{IPapyrusObject}
	{Descr: Основной интерфейс доступа к функциям объектов данных. Экземпляры объектов данных
	должны создаваться методом IPapyrusSession::CreateObject()}
	Методы
	\dldeclmethod{int}{   Search(long id, out PPYOBJREC rec)}{
	Descr: Ищет запись объекта по идентификатору id. Поиск осуществляется непосредственно в
	базе данных (механизм кэширования \ppybrand{} не используется).}

	\dldeclarg{id   IN}{ Идентификатор записи объекта, которую необходимо найти.}

	\dldeclarg{rec OUT}{ @\#{vptr0} Указатель на буфер, по которому будет записано содержание записи в
	случае, если она будет найдена. Структура буфера определяется конкретным типом объекта. В
	этом файле намиенования таких структур начинаются с префикса "SPpyO\_" и продолжаются
	наименованием типа объекта данных. Например: SPpyO\_Article - структура записи статьи
	аналитического учета. Не следует делать предположений о формате хранения записи объекта
	данных, непосредственно в базе данных, на основании структуры, используемой в методах
	IPapyrusObject.
	}

	\dldeclret{
	 \\ >0 - запись по идентификатору id найдена и присвоена по указателю rec
	 \\<0 - запись по идентификатору id не найдена. Содержимое по указателю rec не изменилось.
	 \\ 0  - ошибка. Не следует далеть предположений о содержимом указателя rec
	}

	\dldeclmethod{int}{ SearchByName(string text, int kind, long extraParam, out PPYOBJREC rec)}{
	Descr: Ищет запись объекта по наименованию. При этом, смысл наименования трактуется в
	зависимости от параметра kind.}
	\dldeclarg{text       IN}{ Строка, по которой ищется запись.}

	\dldeclarg{kind       IN}{ Вид поиска.
	  \\0 - собственно, по наименованию
	  \\1 - по коду (каждым типом объекта трактуется особо)}

	\dldeclarg{extraParam IN}{ Дополнительный параметр, необходимый для правильной интерпретации кода
	некоторыми типами объектов.}

	\dldeclarg{rec       OUT}{ Указатель, по которому будет присвоена запись объекта в случае успешного
	поиска.
	}
	\dldeclret{
	  \\>0 - объект найден
	  \\<0 - объект не найден
	  \\ 0 - ошибка
	}

	\dldeclmethod{string}{ GetName(long id)}{
	Descr: Возвращает наименование объекта с идентификатором id. Если такой объект не найден,
	то возвращает строку вида "ID=xxx", где xxx - значение id. Реализация интерфейса в праве
	использовать внутреннее кэширование для поиска требуемого наименования. Как следствие, вызов
	этого метода может быть значительно быстрее, чем использование метода Search, но актуальность
	результата гарантирована
	  быть не может (однако, вероятность ошибки ничтожна).
	  }
	\dldeclret{
	Если запись по идентификатору id найдена, то возвращает строку, содержащую наименование
	объекта. В противном случае, либо в случае ошибки, возвращает пустую строку.
	}

	\dldeclmethod{}{IStrAssocList * GetSelector(long extraParam)}{
	Descr: Возвращает список строк, ассоциированных с идентификаторами и соответствующих наименованиям
	выбоки записей объекта данных, полученных на основе ограниченной фильтрации по аргументу
	extraParam. Каждый тип объектов данных имеет собственную спицифику использования extraParam
	для ограниченной фильтрации записей. Соответствующие пояснения приведены в описании этих объектов.
	}

	\dldeclret{
	  Указатель на интерфейс IStrAssocList списка наименований объекта данных. 0 - оишбка
	}

	\dldeclmethod{int}{ Create(PPYOBJREC pRec, long flags, out long * pID)}{
	Descr: Создает новую запись объекта в соответствии со структурой pRec. Особенности создания
	записей объектов конкретных типов описаны в комментариях к соответствующим компонентам.}

	\dldeclarg{pRec  IN}{ Указатель на структуру записи объекта. Реализация функции проверяет корректность
	тега структуры pRec\rdir RecTag.}

	\dldeclarg{flags IN}{ Флаги создания записи. Сейчас используется только флаг 0x0001 означающий что
	функция НЕ ДОЛЖНА использовать внутреннюю транзакцию.}

	\dldeclarg{pID  OUT}{ Указатель на идентификатор созданной записи. При неудачном завершении функции
	значение по этому указателю не определено.
	}

	\dldeclret{
	  \\>0 - объект успешно создан
	  \\ 0 - ошибка
	   }

	\dldeclmethod{int}{ Update(long id, long flags, in PPYOBJREC rec)}{
	Descr: Изменяет запись объекта по идентификатору id в соответствии со структурой pRec.
	Особенности изменения записей объектов конкретных типов описаны в комментариях к соответствующим
	компонентам.}
	\dldeclarg{id    IN}{ Идентификатор изменяемого объекта.}

	\dldeclarg{flags IN}{ Флаги создания записи. Сейчас используется только флаг 0x0001 означающий что
	функция НЕ ДОЛЖНА использовать внутреннюю транзакцию.}

	\dldeclarg{pRec  IN}{ Указатель на структуру записи объекта. Реализация функции проверяет корректность
	тега структуры pRec\rdir RecTag.
	}

	\dldeclret{
	  >0 - объект успешно изменен
	   0 - ошибка
	}

	\dldeclifc{ IPapyrusView}
	{Descr: Основной интерфейс контроллера анализа данных (КАД). Реализация этого интерфейса обычно
	представлена следующими компонентами (в скобках указаны префиксы наименований соответствующих
	компонентов):
	\\- структурой элемента выборки (SPpyVI\_XXX)
	\\- опциональной структурой итогов выборки (SPpyVT\_XXX)
	\\- интерфейсом фильтра (IPpyFilt\_XXX)
	\\- классом реализации интерфейса фильтра (PPFiltXXX)
	\\- классом реализации собственно интерфейса IPapyrusView (PPViewXXX)
	\\Экземпляры КАД должны создаваться вызовом метода IPapyrusSession::CreateView().}

	Методы
	\dldeclmethod{}{IUnknown * CreateFilt(long param)}
	{Descr: создает экземпляр фильтра выборки и возвращает его интерфейс. В зависимости от
	особенностей класса, параметр param может определять предварительную инициализацию фильтра.}

	\dldeclmethod{int}{    Init(IUnknown * pFilt)}{
	Descr: инициализирует объект в соответствии со свойствами фильтра pFilt. После успешной
	инициализации объект готов к обработке других методов интерфейса. Действительный интерфейс
	фильтра должен быть создан функцией CreateFilt() того же класса, заполнен, и передан в
	функцию Init().}

	\dldeclret{
	  \\>0 - инициализация объекта в соответствии с фильтром pFilt прошла успешно
	  \\0  - ошибка}

	Performance: Время выполнения функции сильно зависит от условий, заданных фильтром, и
	конкретного
	  типа КАД. При необходимости, реализация этого метода можжет строить временные таблицы.

	\dldeclmethod{int}{ InitIteration(int order)}{
	Descr: Инициализирует итератор объекта. После вызова этой функции, последовательными
	вызовами NextIteration можно перебрать все записи выборки, полученной в соответствии с
	фильтром, установленным функцией Init().}

	\dldeclarg{order IN}{ определяет порядок сортировки построенной выборки данных. Возможные значения
	этого аргумента зависят от конкретной реализации КАД. Значение 0 принимается всегда и не
	может быть отвергнуто как ошибочное.}

	\dldeclret{
	 \\ >0 - итератор объекта инициализирован успешно
	 \\ 0  - ошибка}
	Performance:
	  Как правило, время выполнения этой функции невелико.

	\dldeclmethod{int}{    NextIteration(out PPYVIEWITEM item)}{
	Descr: Извлекает следующую запись выборки, построенной на основе фильтра, заданного в
	функции Init() и инициализированной вызовом InitIteration().}

	\dldeclarg{item OUT}{ Указатель на структуру, в которую записывается запись выборки данных.
	Действительная структура записи определяется конкретным типом КАД.}

	\dldeclret{
	  \\>0 - очередная запись успешно извлечена и присвоена по указателю item.
	  \\<0 - больше нет записей для извлечения. Запись по указателю item не изменяется.
	  \\0  - ошибка. Не следует далеть предположений относительно содержимого по указателю item.}

	\dldeclmethod{}{SIterCounter GetIterCounter()}{
	Descr: Возвращает счетчик итераций, изменяемый вызовами NextIteration(). Возвращаемый
	счетчик несет чисто информационную (декоративную) нагрузку. Он никак не используется
	при фактической работе методов InitIteration() и NextIteration(), но лишь изменяется
	ими. Кроме того, не все (но все же, подавляющее большинство) КАД корректно реализуют
	этот метод.}

	\dldeclmethod{int}{    GetTotal(out PPYVIEWTOTAL total)}{
	Descr: Возвращает итоговые значения выборки, инициализированной методом Init().}
	\dldeclarg{total OUT}{ Указатель на структуру, в которую записываются занчения итоговых показателей
	выборки. Действительная структура total определяется конкретным типом КАД.}

	\dldeclret{
	  \\>0 - функция выполнена успешно - итоговые данные занесены по указателю total.
	  \\<0 - функция не поддерживается
	  \\0  - ошибка}


	Перечисление PpyVSubstGrpGoods
	Descr: Значения параметра подстановки товара. Используется в контроллерах анализа данных.
	\\\_sggNone = 0
	\\Без подстановки.
	\\\_sggGeneric
	\\Обобщение. Если товар является членом обощения, то подставляется это обобщение. В противном
	\\случае - остается тот же товар.
	\\\_sggGroup
	\\Родительская группа (непосредственная родительская группа).
	\\\_sggManuf
	\\Производитель.
	\\\_sggDimX
	\\Размерность X классифицированного товара. Если товар не классифицирова, либо размерность X
	для него не определена, то остается тот же товар.
	\\\_sggDimY
	\\Размерность Y классифицированного товара. Если товар не классифицирова, либо размерность Y
	для него не определена, то остается тот же товар.
	\\\_sggDimZ
	\\Размерность Z классифицированного товара. Если товар не классифицирова, либо размерность Z
	для него не определена, то остается тот же товар.
	\\\_sggClsKind
	\\Вид классифицированного товара. Если товар не классифицирова, либо вид для него не определен,
	то остается тот же товар.
	\\\_sggClsGrade
	\\Сортность классифицированного товара. Если товар не классифицирова, либо сортность для него
	не определена, то остается тот же товар.
	\\\_sggClsAddObj
	\\Дополнительный объект классифицированного товара. Если товар не классифицирова, либо
	дополнительный классификатор для него не определен, то остается тот же товар.
	\\\_sggClsKind\_Grade
	\\Вид, сортность классифицированного товара. Если товар не классифицирован, то остается тот же
	товар.
	\\\_sggSuppl
	\\Поставщик. Такая подстановка возможна только в тех случаях, когда расчет ведется в контексте
	товарных операций (то есть, существует привязка операции к лоту, из которого и можно получить
	поставщика).
	\\\_sggBrand
	\\Торговая марка.
	\\\_sggClsKind\_Grade\_AddObj
	\\Вид, сортность, доп объект классифицированного товара. Если товар не классифицирован, то
	остается тот же товар.
	\\\_sggClsKind\_AddObj\_Grade
	\\Вид, доп объект, сортность классифицированного товара. Если товар не классифицирован, то
	остается тот же товар.
	\\\_sggSupplAgent
	\\Агент поставщика. Агент поставщика извлекается как агент по документу прихода, которым был
	сформирован лот. Такая подстановка возможна только в тех случаях, когда расчет ведется в
	контексте товарных операций (то есть, существует привязка операции к лоту, из которого и
	можно получить требуемую информацию).
	\\\_sggLocation
	\\Склад по операции. Такая подстановка возможна только в тех случаях, когда расчет ведется в
	контексте товарных операций (при этом в качестве склада, берется тот, к которому привязана
	операция).

	Класс StrAssocList
	\\Реализует интерфейс IStrAssocList
	\\Класс PPUtil
	\\Реализует интерфейс IPapyrusUtil
	\\Класс PPSession
	\\Реализует интерфейс IPapyrusSession
	\\Класс PPObjAccSheet
	\\Реализует интерфейс IPapyrusObject
	\\Комментарии по методам интерфейса IPapyrusObject

	Класс PPObjArticle
	\\Реализует интерфейс IPapyrusObject
	\\Комментарии по методам интерфейса IPapyrusObject

	Класс PPObjCashNode
	\\Реализует интерфейс IPapyrusObject
	\\Комментарии по методам интерфейса IPapyrusObject

	Класс PPViewTrfrAnlz
	\\Реализует интерфейс IPapyrusView
	\\Интерфейс IPpyFilt\_TrfrAnlz

	Методы
	\dldeclmethod{void}{ SetPeriod(date low, date upp)}{
		Descr: Устанавливает период документов, которые должны попасть в обработку.
	}

	\dldeclmethod{void}{ SetLotsPeriod(date low, date upp)} {
		Descr: Устанавливает период поступления лотов, по которым должен проводится анализ. Если
		устанавливается не пустой период, то в анализ попадут только те товарные операции, которые
		привязаны к лотам, дата которых попадает в указанный период. Обращаем внимание на то, что
		имеется в виду именно дата лота, а не дата оригинального лота.
	}

	Свойства
	out SDateRange Period
	Период обрабатываемых операций. Для установки - SetPeriod
	out SDateRange LotsPeriod
	Период поступления лотов, которыми ограничиваются обрабатываемые операции. Для установки -
	SetLotsPeriod
	long   OpID
	Вид операции (возможно обобщенной)
	long   LocID
	Склад
	long   SupplID
	Поставщик
	long   ArID
	Если !0, то перебираются только те документы, у которых ObjectID == ArID
	long   DlvrAddrID
	Адрес доставки. Если ArID == 0, то не используется //
	long   AgentID
	Если !0, то перебираются только те документы, в которых установлен этот агент.
	long   PsnCatID
	Категория персоналии
	long   CityID
	Город контрагентов, по которым перебираются операции
	long   GoodsGrpID
	Товарная группа, по которой ведется перебор операций. Если GoodsID != 0, то этот параметр
	игнорируется (используется только как ограничение выбора товара в диалоге)
	long   GoodsID
	Товар, по которому ведется перебор операций (может быть обобщенным)
	PpyVTrfrAnlzFlags Flags
	Флаги фильтрации. Возможные значения определены перечислением PpyVTrfrAnlzFlags:
	tavfLabelOnly          = 0x0001
	Только помеченные операции: отбираются только те операции, которые привязаны к документам,
	помеченным признаком WL.
	tavfGByDate            = 0x0002
	Группировка по дате (только если выбран товар - GoodsID). Если флаг установлен, то все
	операции по товару группируются по датам. При этом расходы и приходы учитываются раздельно.
	tavfGetRest            = 0x0004
	Рассчитывать товарные остатки.
	tavfSubstPersonRAddr   = 0x0008
	При подстановке персоналии использовать фактический адрес. Если этот флаг не установлен,
	то используется юридический адрес.
	tavfSubstDlvrAddr      = 0x0010
	При подстановке персоналии использовать адрес доставки.
	tavfDiffByDlvrAddr     = 0x0020
	При группировке по контрагенту заменять контрагента на конкатенацию (контрагент+адрес доставки).
	tavfDontInitSubstNames = 0x0040
	Не инициализировать имена подставляемых объектов. Эта опция экономит время подготовки данных
	если нет необходимости сортировать записи или выводить отчет на экран.
	tavfInitLocCount       = 0x0080
	Рассчитывать количество адресов доставки для каждого элемента группировки. Внутренний флаг
	(инициализируется программно)
	tavfCalcRest           = 0x0100
	Для группировки gGoods, gGoodsBill, gGoodsDate рассчитывать остатки
	tavfShowAllArticles    = 0x0200
	Показывать отсутствующие позиции контрагентов
	tavfShowAllAgents      = 0x0400
	Показывать отсутствующие позиции агентов
	tavfShowAllGoods       = 0x0800
	Показывать отсутствующие позиции товаров
	int    InitOrd
	Порядок сортировки сформированной выборки. Возможны следующие значения:
	0 - по умолчанию (на усмотрение внутренней реализации)
	1 - по дате
	2 - по наименованию товара
	3 - по наименованию контрагента
	При использовании подстановки элементы выборки сортируются по результирующему значению.
	long   CtKind
	Вид кросстабулированного отчета. Возможны следующие значения:
	0 - без кросстабуляции
	1 - кросстабуляция по дате (с учетом подстановки, если таковая определена)
	long   CtVal
	Показатель, вычисляемый в кросстабулированном-отчете. Этот параметр значим только в том
	случае, если CtKind не равен 0. Допустимы следующие значения:
	1 - сумма в ценах поступления
	2 - сумма в чистых ценах реализации (с учетом скидки)
	3 - сумма доходности по операции (разница между суммой в чистых ценах реализации и суммой в
	ценах поступления)
	4 - процентная доходность (отношение суммы в чистых ценах реализации к сумме в ценах
	поступления умноженное на 100)
	5 - количество адресов доставки, по строке
	PpyVTrfrAnlzGrouping Grp
	Параметр группировки. Возможные значения определены перечислением PpyVTrfrAnlzGrouping:
	tavgNone = 0
	Без группировки
	tavgGoods = 1
	По товару
	tavgCntragent = 2
	По контрагенту
	tavgCntragentDate = 3
	По контрагенту, дате
	tavgGoodsCntragent = 4
	По товару, контрагенту
	tavgGoodsCntragentDate = 5
	По товару, контрагенту, дате
	tavgGoodsBill = 6
	По товару, документу
	tavgDateCntragentAgentGoods = 7
	По дате, контрагенту, агенту, товару
	tavgGoodsDate = 8
	По товару, дате
	tavgBillCntragent = 9
	По документу, контрагенту
	PpyVSubstGrpGoods    Sgg
	Подстановка товара. Варианты значений определены в описании перечисления PpyVSubstGrpGoods.
	PpyVSubstGrpPerson   Sgp
	Подстановка персоналии. Варианты значений определены в описании перечисления PpyVSubstGrpPerson.
	PpyVSubstGrpDate     Sgd
	Подстановка даты. Варианты значений определены в описании перечисления PpyVSubstGrpDate.
	Класс PPFiltTrfrAnlz
	Реализует интерфейс IPpyFilt\_TrfrAnlz. Создавать экземпляр этого класса следует только
	посредством метода PPViewCCheck::CreateFilt().
	Класс PPViewCCheck
	Реализует интерфейс IpapyrusView. Создавать экземпляр этого класса следует только
	посредством вызова метода PPSession::CreateView(ppvCCheck).
	Интерфейс IPpyFilt\_CCheck
	Методы
	\dldeclmethod{void}{ SetPeriod(date low, date upp);}{
	Descr: Устанавливает период перебора чеков.}
	Свойства
	long   CashNodeID
	\rdir PPOBJ\_CASHNODE ИД кассового узла
	long   CashNumber
	Номер кассового аппарата (не путать с кассовым узлом)
	long   GoodsGrpID
	\rdir PPOBJ\_GOODSGROUP ИД группы товаров (допустимы: обыкновенные группы, группы верхнего
	уровня, альтернативные группы). Если это значение не нулевое, то чеки перебираются по
	строкам.
	long   GoodsID
	\rdir PPOBJ\_GOODS ИД товара. Если это значение не нулевое, то чеки перебираются по строкам.
	long   SCardSerID
	\rdir PPOBJ\_SCARDSERIES ИД серии дисконтных карт. Если SCardID не нулевое, то этот критерий
	игнорируется.
	long   SCardID

	\rdir PPOBJ\_SCARD ИД дисконтной карты. Если значение не нулевое, то перебираются только те
	чеки, которые привязаны к выбранной карте.
	long   CashierID
	\rdir PPOBJ\_PERSON  ИД кассира.
	long   AgentID
	\rdir PPOBJ\_ARTICLE ИД агента (официанта)
	long   TableCode
	Номер стола
	long   MinCode
	Минимальный номер чека (0 - не определено)
	long   MaxCode
	Максимальный номер чека (0 - не определено)
	double MinAmount
	Минимальная сумма чека (0 - не определено)
	double MaxAmount
	Максимальная сумма чека (0 - не определено)
	double MinQtty
	Минимальное количество товара по строке (0 - не определено)
	double MaxQtty
	Максимальное количество товара по строке (0 - не определено)
	double AmountQuant
	Квант суммы чека или количества по строке для группировке по соответствующему критерию.
	Используется только при группировке по критериям: ccgAmount, ccgQtty
	PpyVCCheckFlags Flags
	Флаги фильтрации. Возможные значения определены перечислением PpyVCCheckFlags:
	ccfZeroSess       = 0x0001
	Только чеки по неопределенным кассовым сессиям
	ccfActiveSess     = 0x0002
	Только чеки активной синхронной кассовой сессии
	ccfCheckLines     = 0x0004
	Просматривать строки чеков (для группировки по товарам)
	ccfImmOpenPanel   = 0x0008
	Не влияет на состав выборки
	ccfShowSuspended  = 0x0010
	Показывать отложенные
	ccfSuspendedOnly  = 0x0020
	Только отложенные
	ccfRetOnly        = 0x0040
	Показывать только возвраты
	ccfShowJunk       = 0x0080
	Отложенные чеки, которые были загружены в панель чеков. Если панель аварийно завершила
	работу, то этот чек зависнет.
	ccfFillCashNodeID = 0x0100
	Заполнять поле CashNodeID
	ccfNotPrintedOnly = 0x0200
	Показывать только ненапечатанные чеки
	ccfCashOnly       = 0x0400
	Только чеки, проведенные за наличные
	ccfBankingOnly    = 0x0800
	Только чека, проведенные по безналичной оплате
	PpyVCCheckGrouping Grp
	Варианты группировки. Возможные значения определены перечислением PpyVCCheckGrouping:
	ccgNone = 0
	Не группировать
	ccgTime = 1
	По времени чека
	ccgDate = 2
	По дате чека
	ccgCash = 3
	По номеру кассового аппарата
	ccgCard = 4
	По дисконтным картам
	ccgAmount = 5
	По сумме чека (градация определяется свойством фильтра AmountQuant)
	ccgQtty = 6
	По количеству в строке чека (градация определяется свойством фильтра AmountQuant)
	ccgGoods = 7
	По товарам
	ccgCashiers = 8
	По кассирам
	out SDateRange Period
	Период, в который должны попадать чеки из выборки. Устанавливать это свойство следует
	вызовом метода SetPeriod(). Замечание: дата чека может не совпадать с датой кассовой
	сессии, к которой это чек относится.
	time   MinTime
	Нижнее время отсечки выборки
	time   MaxTime
	Верхнее время отсечки выборки
	long   WeekDays
	Битовая маска дней недели, которым следует ограничить выборку. Если WeekDays = 0, то
	маска считается неопределенной (все дни недели). Бит 0 соответствует воскресенью, бит
	1 - понедельнику, бит 2 - вторнику и т.д.
	long   HourBefore

	Класс PPFiltCCheck
	Реализует интерфейс IPpyFilt\_Ccheck. Создавать экземпляр этого класса следует только
	посредством метода PPViewCCheck::CreateFilt().
%\begin{Verbatim}
%\end{Verbatim}


\chapter{Приложения\label{ch-appendix}}

\section{Приложение А. Структура каталогов}

Рекомендуемая структура каталогов установленной системы показана на рисунке. Следующая
таблица описывает назначение каждого из каталогов.

\ppypict{dir-struct}{}


\begin{description}
	\item[PPY]
	Корневой каталог системы.

	\item[PPY/BIN]
	Каталог, в котором содержаться исполняемые (.exe) и файлы, необходимые для функционирования
	системы, а также файлы конфигурации pp.ini и report.ini, impexp.ini и другие.

	\item[PPY/BIN/DRV]
	Этот каталог предназначен для хранения модулей драйверов устройств.

	\item[PPY/BIN/RPT]
	Здесь хранятся файлы отчетов (.rpt) Windows-версии системы.

	\item[PPY/BIN/RPT/LOCAL]
	Если на вашем предприятии используются модифицированные формы отчетов, которые должны
	подставляться вместо стандартных (поставляемых с дистрибутивом системы), то они должны
	храниться в этом каталоге. Система сначала ищет файл формы отчета здесь, а затем, если
	ей не удается найти требуемый файл, обращается к каталогу PPY/BIN/RPT.

	\item[PPY/DATA]
	Корневой каталог для баз данных, временных файлов, а также системных файлов, необходимых
	для работы с базами данных.

	\item[PPY/DATA/BACKUP]
	Рекомендуемое расположение каталога архивных копий баз данных.

	\item[PPY/DATA/BASE]
	Рекомендуемое расположение каталога основной базы данных.

	\item[PPY/DATA/SYS]
	Каталог, в котором хранится словарь базы данных, состоящий из трех файлов: file.ddf,
	field.ddf, index.ddf. На этот каталог ссылается параметр [path] sys=… файла pp.ini.

	\item[PPY/DATA/TMP]
	Рекомендуемое расположение каталога временных файлов. На него ссылается параметр [path]
	temp=… файла pp.ini.

	\item[PPY/DD]
	Каталог, содержащий файлы описания данных. Здесь должны находиться как исходные, так и
	скомпилированные версии файлов описания внешних отчетов DL200.

	\item[PPY/DD/VBA]
	Каталог, содержащий рабочие файлы внешних приложений, использующие интерфейсы Papyrus.
	При первичной инсталяции в подкаталог SAMPLE копируются файлы примеров для обучения.

	\item[PPY/DD/WTM]
	Каталог содержит файлы описания полотен (интерактивных схем).

	\item[PPY/DOC]
	Здесь находятся текстовые файлы документации, необходимые для поддержки системы.
	Сюда же копируется руководство, которое вы сейчас читаете.

	\item[PPY/IN]
	Каталог для входящих файлов, используемый системой для приема данных из внешних
	источников.

	\item[PPY/OUT]
	Каталог исходящих файлов. Используется системой для передачи данных во внешний мир.

	\item[PPY/LOG]
	В этот каталог сбрасываются файлы журналов, информирующих о протекании тех или иных
	процессов. На этот каталог ссылается параметр [path] log=… файла pp.ini.

	\item[PPY/PACK]
	Каталог, содержащий конфигурационные файлы, необходимые для функционирования и
	поддержки системы. На этот каталог ссылается параметр [path] pack=… файла pp.ini.

\end{description}

\section{Приложение B. Список поддерживаемого оборудования}


\subsection{Кассовые модули}


\begin{itemize}
	\item Атол
	\item Фронтол
	\item Кристалл УКМ
	\item Кристалл Сет
	\item Петрович
	\item Супермаг УКМ
	\item Штрих-М
\end{itemize}

\subsection{Кассовые аппараты}

\begin{itemize}
	\item Wincor Nixdorf Beetle
	\item IPC-POS
	\item Ладога-Ф
	\item Аквариус Электроника-92
	\item Фискальный регистратор Штрих-ФР
	\item Фискальный регистратор Элвес-ФР-К
	\item Рабочее место кассира с использованием любого Windows-принтера в
	качестве принтера чеков.
\end{itemize}

\subsection{Весы с печатью этикеток}

\begin{itemize}
	\item CAS-LP15 (включая версию протокола обмена 1.6)
	\item CAS CL5000J
	\item Масса-К
	\item Mettler Toledo - Tiger
	\item DIGI
	\item Bizerba
	\item Штрих-Принт
\end{itemize}

\subsection{Принтеры этикеток}

\begin{itemize}
	\item Datamax
	\item Zebra
	\item Zebra (Eltron)
\end{itemize}

\subsection{Ручные терминалы сбора данных}

\begin{itemize}
	\item Denso BHT-5000
	\item Denso BHT-7000
	\item Denso BHT-400 (вся серия 400 на базе WinCE)
	\item Cipher CPT720
	\item Symbol CPT1550
	\item PSC Falkon (WinCE)
\end{itemize}


\section{Приложение C. Настройка системы для работы с различными типами оборудования}

\subsection{Кассовый сервер Кристалл-Сет}

Настройка
\begin{enumerate}
	\item 	Вызвать список кассовых узлов (меню \ppymenu{Справочники\rdir Оборудование\rdir Кассы})
	\item 	Создать кассовый узел, выбрав тип кассы \qu{Кассовый сервер Кристалл}

	\begin{itemize}
		\item 	Поля \qu{Версия драйвера} не используются
		\item 	В поле \qu{Файлы импорта} указать путь к каталогу, в который кассовый модуль
		экспортирует отчеты о продажах (например: j:/ses/export)
		\item 	В поле \qu{Пути экспорта} указать путь к каталогу, из которого кассовый модуль
		импортирует данные для загрузки кассовых аппаратов (например: j:/ses/import)
		\item 	В поле \qu{Логические номера касс} перечислить через запятую номера кассовых
		аппаратов, с которыми должен осуществляться обмен данными (например: 1,2,3,4,5)
		\item 	В комбо-боксе \qu{Объект} выбрать склад, к которому относятся кассовые аппараты
		создаваемого узла
		\item 	Признаки \qu{Импортировать чеки до закрытия сессии} и {Загружать товарные остатки}
		для этого кассового модуля не используются.
		\item 	Остальные поля и признаки используются на общих основаниях.
	\end{itemize}
	\item 	В каталоги экспорта и импорта кассового модуля скопировать файлы export.cfg и
	import.cfg соответственно, поставляемые вместе с системой \ppybrand{} (если в дистрибутиве
	системы \ppybrand{} их нет, то запросить их у вашего поставщика)
	\item 	Если магазин работает круглосуточно, то для параметра \qu{период объединения
	кассовых сессий} рекомендуется установить значение 720 (12 часов). Для установки этого
	параметра следует выбрать пункт меню \ppymenu{Админ\rdir Настройки} и в диалоге \qu{Общие настройки}
	нажать кнопку \qu{Системные параметры} (не трогайте никаких других параметров в этом диалоге,
	если не уверены в том, что знаете что делаете).
\end{enumerate}

\begin{Verbatim}
Содержимое файла import.cfg
; IMPORT.CFG
; Файл настройки импорта кассового сервера
; Кристалл-Сет
; для работы с системой Papyrus
;
; 30/10/2004
;

;Общая секция
[GENERAL]
;разделитель строки в виде списка кодов символов
DELIMITER=001;202;002;003;205
;кодировка исходного файла данных (DOS или WIN)
ENCODING=DOS

[CS_GOODS]
;товары
_DATA=1
_DEVICE=1
_STOPFLAG=CS_CASH.UPD
_STOPTIMEOUT=1
_USESTOP=1
_USEGO=0
_GOFLAG=ADDGO
ARTICUL=GOODSITEM
NAME=GOODSNAME
UNIT=GOODSUNIT
ENABLE=GOODSENABLE
GROUP1=GOODSGROUP1
PRICE=GOODSPRICE
PRECIS=GOODSPRECISION
SECTION=GOODSDEPART
RSTRID=GOODSRESTRICTID
RSPCNT=GOODSRESTRICTMINPRICE
VAT=GOODSNDS

[CS_DSCCC]
;скидки по категориям карт
_DATA=1
_DEVICE=1
_STOPFLAG=CS_CASH.UPD
_STOPTIMEOUT=1
_USESTOP=1
_USEGO=0
_GOFLAG=ADDGO
ARTICUL=GOODSITEM
SCRDID=DISCCARDCATEGORY
DSCNSUM=DISCGOODSBYDISCCARDSUM

[CS_BAR]
;штрих-коды
_DATA=1
_DEVICE=1
_STOPFLAG=CS_CASH.UPD
_STOPTIMEOUT=1
_USESTOP=1
_USEGO=0
_GOFLAG=ADDGO
ARTICUL=GOODSITEM
BARCODE=GOODSBARCODE
UNTPERPACK=GOODSBARCODEQUANTITY

[CS_CARDS]
;дисконтные карты
_DATA=1
_DEVICE=1
_STOPFLAG=CS_CASH.UPD
_STOPTIMEOUT=1
_USESTOP=1
_USEGO=0
_GOFLAG=ADDGO
_ACTIONFIELD=MODE
CODE=DISCCARDCODE
PERSON=DISCCARDCUSTOMER
NAME=DISCCARDNAME
TYPE=DISCCARDTYPE
SCRDID=DISCCARDCATEGORY
DSCNT=DISCCARDPERCENT
MAXCREDIT=DISCCARDMAXCREDIT
ISSUE=DISCCARDTIMEBEGIN
EXPIRY=DISCCARDTIMEEND

[CS_CSHRS]
;кассиры
_DATA=1
_DEVICE=1
_STOPFLAG=CS_CASH.UPD
_STOPTIMEOUT=1
_USESTOP=1
_USEGO=0
_GOFLAG=ADDGO
_ACTIONFIELD=MODE
TABNUM=CASHIERTABNUMBER
NAME=CASHIERNAME
PASSWORD=CASHIERPASSWORD
RIGHTS=CASHIERPERMISSIONS

[CS_SCALE]
;загрузка весов
_DATA=1
_DEVICE=2
_DEVICEFIELD=DEVICENO
_STOPFLAG=CS_SCALE.UPD
_STOPTIMEOUT=1
_USESTOP=1
_USEGO=0
_GOFLAG=ADDGO
BARCODE=SHORTGOODSITEM
PREFIX=BARCODEPREFIX
NAME1=GOODSNAMEFIRST
NAME2=GOODSNAMESECOND
GOODSNO=PLUNUMBER
PRICE=GOODSPRICESALE
EXPIRY=EFFECTIVELIFE
SECTION=SCALEDEPARTNUMBER

Содержимое файла export.cfg
; EXPORT.CFG
; Файл настройки экспорта кассового сервера
; Кристалл-Сет
; для работы с системой Papyrus
;
; 30/10/2004
;
[GENERAL]
INNEREXPORTPATH=C:\SES\ImpExp\Export
VERIFYSTATE=0
EXPORTTYPE=DBF

[PATH]
C:\SES\ImpExp\Export=C:\SES\ImpExp\Export

[REPORTS]
REPGANG=CS_ZREP;0;1
REPCHEQUEHEAD=CS_CHKHD;0;1
REPCHEQUEPOS=CS_CHKLN;0;1
REPCHEQUEDISC=CS_DSCNT;0;1

[CS_ZREP]
_USESTOP=1
_STOPFLAG=CS_WAIT
OPERDAY=OPERDAY;C;20;0
CashNumber=CASHNMB;N;10;0
GangNumber=SMENA;N;10;0
GangDateStart=START;C;20;0
GangDateStop=STOP;C;20;0
ChequeNumberFirst=CHK_FIRST;N;10;0
ChequeNumberLast=CHK_LAST;N;10;0
CheckStatus=STATUS;N;6;0

[CS_CHKHD]
_USESTOP=1
_STOPFLAG=CS_WAIT
OPERATION=OPERATION;C;1;0
DATEOPERATION=DATEOPER;C;20;0
CK_NUMBER=NUMCHK;N;10;0
CASH_CODE=CASHCODE;N;10;0
NSMENA=SMENA;N;10;0

[CS_CHKLN]
_USESTOP=1
_STOPFLAG=CS_WAIT
ID=CHKLN_ID;N;10;0
CK_NUMBER=NUMCHK;N;10;0
GRCODE=DIV;N;4;0
CODE=COD;C;20;0
QUANT=QUANT;N;10;3
PRICE=PRICE;N;12;2
DISC_SUMM=DISC;N;12;2
CASH_CODE=CASHCODE;N;10;0
NSMENA=SMENA;N;10;0
BANK=BANK;C;1;0

[CS_DSCNT]
_USESTOP=1
_STOPFLAG=CS_WAIT
POSID=CHKLN_ID;N;10;0
DISCTYPE=TYPE;N;10;0
CARDNUMBER=CARDNO;C;22;0
\end{Verbatim}

\subsubsection{Особенности работы}

Этот кассовый модуль экспортирует данные о продажах по запросу только за один день. При
этом если Z-отчет, соответствующий экспортируемым чекам, был снят на следующий день и
данные за этот день есть, то модуль вернет все чеки этого Z-отчета (включая чеки следующего
дня).

\ppybrand{}, при закрытии сессии этого кассового модуля, запрашивает период, за который надо
получить данные. Если вы указываете открытый справа период, то к текущей операционной дате
прибавляется два дня и полученная дата закрывает период. \ppybrand{} обращается к кассовому
модулю за данными на каждый день из указанного периода.

Кристалл-Сет при экспорте результатов продаж не инициализирует секунды в полях времени,
поэтому, \ppybrand{} искусственно инициализирует секунды во времени пробития чека как остаток
от деления номера чека на 60 (это необходимо для обеспечения уникальности времени пробития
чека в пределах каждого кассового аппарата).

При экспорте данных в Кристалл-Сет главная неприятность в том, что этот кассовый модуль не
предоставляет интерфейса для очистки внутренней базы данных товаров. Из-за этого могут
возникать коллизии, связанные с изменениями штрихкодов товаров.

\subsection{Кассовый модуль Кристалл УКМ}

\subsection{Кассовый модуль Атол}

\subsection{Кассовый модуль Петрович}

\section{Приложение D. Специальные форматы штрихкодов}

Для управления терминалами сбора данных, а также для упрощения работы в панели процессора
система \ppybrand{} использует штрихкоды, кодирующие команды и данные.
Для таких штрихкодов всегда используется стандарт CODE39.
Если код содержит несколько полей, то эти поля отделяются друг от друга символом разделителя
X (заглавная латинская буква X). Неявное разделение полей на основании их длины не
используется, поскольку действительная длина поля в различных условиях могут существенно
отличаться.

\subsection{Серийные номера}

Серийные номера кодируются простой последовательностью цифр. Система отличает серийный номер
от номенклатурного номера по контексту. То есть, при необходимости идентифицировать некоторую
последовательность цифр, система сначала ищет номенклатурный номер с такой последовательностью
и, если такого номенклатурного номера нет, то пытается найти серийный номер, совпадающий с
заданной последовательностью.

Комбинация серийного номера с номенклатурным
В некоторых случаях требуется кодировать в одном штрихкоде и серийный, и номенклатурный
номера. В этом случае штрихкод имеет следующий формат: SSSSXNNNNXQQQQ
\newline Здесь:
\begin{itemize}
 	\item	SSSS - цифры серийного номера (длина произвольная),
	\item	NNNN - цифры номенклатурного номера (длина произвольная).
	\item	QQQQ - количество, содержащееся в промаркированной упаковке
	\item	X - разделитель (заглавная латинская буква X).
\end{itemize}
Примеры:

\begin{ppytable2}
	100014X30005	&
	Серия 100014, номенклатурный номер 30005, количество явно не указано  \eor

	505XX120	&
	Серия 505, номенклатурный номер отсутствует, количество 120 единиц \eor

	X30005	&
	Серия не указана, номенклатурный номер 30005, количество явно не указано \eor

\end{ppytable2}


Код документа
Маркировка документа используется для идентификации его посредством терминала сбора данных
или в панели процессора.
\newline Формат кодировки документа следующий: BILLPPPPXOOOOXIIII
\newline Здесь:
\begin{itemize}
 	\item	BILL - фиксированный префикс кода документа
	\item	PPPP - код процессора, на котором должен обрабатываться документ
	\item	OOOO - идентификатор контрагента по документу
	\item	IIII - идентификатор документа
\end{itemize}
Примеры:

\begin{ppytable2}
	BILL80001X217X34011	&
	Процессор 80001, ИД контрагента 217, ИД документа 34011 \eor

	BILLXX34011	&
	Процессор не определен, контрагент не определен, ИД документа 34011  \eor

	BILLX000X34011	&
	Тоже  \eor

\end{ppytable2}

\section{Приложение E. Сообщения об ошибках}

\newcommand\ppymsg[3]{
	\paragraph{[#1] #2}{#3}
}

	\ppymsg{79}{Остаток товара слишком мал}{
		Недостаточное количество товара на дату проведения операции по складу, к которому относится
		документ.

		Если сообщение появляется при выборе товара в товарном документе, то кроме тривиальной
		причины  (учетный остаток просто недостаточен), возможно, что товара не хватает из-за
		дополнительных ограничений, как-то: возвратная операций поставщику при  недостаточности
		товара именно этого поставщика; товар \qu{перехвачен} более поздними операциями (в случае
		проведения документа задним числом).

		Если сообщение появляется при проведении товарного документа или при закрытии кассовой
		сессии, то причина, скорее всего, кроется в нарушениях в таблице текущих товарных остатков.
		В этом случае следует запустить корректировку текущих товарных остатков
		(\ppymenu{Админ\rdir Корректировки\rdir Корректировка текущих товарных остатков}). Если и это не помогло, то
		следует выполнить корректировку лотов, и, если в лотах были ошибки, снова выполнить
		корректировку текущих товарных остатков.

		Dev: mnem(PPERR\_LOTRESTBOUND)
	}
	\ppymsg{83}{Товара 'ABC' на складе нет}{
		Выбранный для вставки в строки документа товар ABC на складе, к которому относится документ,
		отсутствует.

		Это сообщение появляется при выборе расходуемого или переоцениваемого товара товара в
		документе либо из списка, либо по штрихкоду.

		Dev: mnem(PPERR\_NOGOODS), locfunc(TrfrItemDialog::replyGoodsSelection)
	}

	\ppymsg{128}{Попытка объединить несовместимые документы}{
	Появляется при попытке объединить несколько документов в один. Объединяемые документы должны
	принадлежать одному виду операции, иметь одинаковых (возможно нулевых) контрагентов (основная
	и дополнительная статьи аналитического учета), а также принадлежать одному складу и иметь
	одну и ту же валюту учета.

	Это сообщение появится и в том случае, если один или несколько объединяемых документов имеют
	ссылку на связанный документ (например, не удастся объединить документы списания инвентаризации).

	DEV: mnem(PPERR\_UNMATCHEDUBILLS), locfunc(IsBillsCompatible)
	}
	\ppymsg{134}{Попытка открыть день с датой меньшей предыдущего}{
	Это сообщение появляется при попытке открыть новый кассовый день в синхронном кассовом узле,
	если дата нового дня меньше, чем текущая дата в записи кассового узла.

	DEV: mnem(PPERR\_STARTBACKDATE), locfunc(PPCashMachine::SyncOpenSession)
	}
	\ppymsg{193}{Ошибка чтения пакета связи разделов 'имя файла'}{
	Сообщение появляется при приеме или отправке данных в другой раздел. Причиной возникновения
	ошибки чаще всего является нарушение целостности одного из файлов, находящихся в каталоге
	IN (OUT). В нескольких версиях системы (до 5.3.5) такая ошибка могла возникать при передаче
	данных с использованием встроенного сжатия (система неверно рассчитывала CRC файла).
	Для устранения ошибки:

	\begin{itemize}
 		\item	при отправке данных выполните процедуру удаления временных файлов.
		\item	при получении данных выполните процедуру удаления временных файлов, в разделе -
	отправителе также выполните эту процедуру и передайте данные снова.
	\end{itemize}

	DEV: mnem(PPERR\_PPOSREADFAULT), locfunc(PPObjectTransmit::GetHeader, PPObjectTransmit::Read,
	PPObject::ReadBlk)
	}
	\ppymsg{323}{Обнаружена циклическая зависимость между лотами}{
	Ошибка возникает, если программа обнаружила циклическую зависимость между лотами. То есть,
	лот A порождает лот B, лот B порождает лот C, а лот C, наконец снова порождает лот A. Причина
	ошибки возникает крайне редко и источники на текущий момент (версия 4.7.10) не ясны.
	Может проявляться при попытке открытия документа,  просмотре системной информации по лоту,
	при расчете некоторых отчетов.
	При возникновении необходимо немедленно обратиться в службу технической поддержки.

	DEV: mnen(PPERR\_LOTLOOP), locfunc(ReceiptCore::SearchOrigin),
	locfunc(LotInfoDialog::setupLinkedLot)
	}
	\ppymsg{335}{Недопустимое действие по персональной операции}{
	При выборе действия по виду персональной операции тип этого действия не соответствует другим
	условиям вида персональной операции. Например, действие по установке или снятию тега
	недопустимо для вида операции, для которого не определены теги.

	DEV: mnen(PPERR\_INADMISSPOVERB), locfunc(PoClauseDialog::replyVerbSelected)
	}
	\ppymsg{351}{Ошибка создания файла синхронизации}{
	Программе не удалось создать файл синхронизации ppsync.bin.
	Проблема возникает из-за недоступности каталога базы данных. Путь к базе данных
	прописывается в файле pp.ini.
	}

	\ppymsg{355}{Ошибка открытия файла синхронизации}{
	Программе не удалось открыть файл ppsync.bin.
	Обычно проблема кроется в отсутствии прав доступа на чтение или на запись к каталогу
	базы данных.}

	\ppymsg{909}{Невозможно подставить счет вместо алиаса в проводке}{
	При проведении документа не удалось вместо алиаса счета, указанного в одном из шаблонов
	проводок, подставить действительный счет из таблицы подстановки алиасов, связанных с
	аналитической статьей, используемой в документе.
	После текста сообщения система выводит наименование алиаса счета и наименование статьи, в
	которой должна быть правильная таблица подстановки алиасов.

	DEV: mnem(PPERR\_UNABLERESOLVEALIAS), locfunc(PPAccTurnTempl::ResolveAlias)
	}
	\ppymsg{909}{Невозможно подставить счет вместо алиаса в проводке}{
	При проведении документа не удалось вместо алиаса счета, указанного в одном из шаблонов
	проводок подставить действительный счет из таблицы подстановки алиасов, связанных с
	аналитической статьей, используемой в документе.
	После текста сообщения система выводит наименование алиаса счета и наименование статьи, в
	которой должна быть правильная таблица подстановки алиасов.

	DEV: mnem(PPERR\_UNABLERESOLVEALIAS), locfunc(PPAccTurnTempl::ResolveAlias)
	}
	\ppymsg{910}{Завершение кассовых сессий сверх 10-го уровня блокировано}{
	Сообщение выдается при попытке завершения кассовой сессии, если в конфигурации оборудования
	установлен флаг \qu{Закрывать кассовые сессии до 10-го уровня}. Для консультаций по поводу
	правомерности установки этого флага следует обратиться к администратору системы.

	DEV: mnem(PPERR\_CSESSCOMPLLOCKED).
	}
	\ppymsg{912}{Инвалидная ассоциация статья-склад}{
	Не существует соответствия между статьей, название которой указано после текста сообщения,
	и складом. Проблема может быть связана с неверной установкой таблицы позиций в конфигурации
	(относительно пользователя) или с потерянной ссылкой на склад в статье аналитического учета,
	относящейся к аналитической таблице, указанной в конфигурации.

	DEV: mnem(PPERR\_INVAR2LOCASSOC), locfunc(PPObjLocation::ObjToWarehouse)
	}
	\ppymsg{913}{Инвалидная ассоциация склад-статья}{
	Не существует соответствия между складом, название которого указано после текста сообщения,
	и статьей. Проблема может быть связана с неверной установкой таблицы позиций в конфигурации
	(относительно пользователя) или с отсутствием статьи аналитического учета, относящейся к
	таблице позиций (указанной в конфигурации),  привязанной к складу.

	DEV: mnem(PPERR\_INVLOC2ARASSOC), locfunc(PPObjLocation::WarehouseToObj)
	}
	\ppymsg{1247}{Персоналия не принадлежит заданному виду}{
	Выбранная или обрабатываемая персоналия не относится к ограничивающему виду. \#define
	PPERR\_PSNDONTBELONGTOKIND   1247 // Персоналия не принадлежит заданному виду

	DEV: mnem(PPERR\_PSNDONTBELONGTOKIND), locfunc(PersonCore::IsBelongToKind)
	}
	\ppymsg{1248}{Персоналия по регистру xxx не найдена}{
	При попытке идентифицировать персоналию по регистрационному номеру не удалось обнаружить
	ни одной персоналии с указанным номером. Для устранения проблемы либо введите правильный
	номер, либо задайте требуемый регистрационный номер для персоналии.

	DEV: mnem(PPERR\_PERSONBYREGNFOUND), locfunc(PPObjPerson::GetListByRegNumber)
	}
	\ppymsg{1249}{Персоналия xxx по регистру не соответствует заданному виду}{
	При попытке идентифицировать персоналию по регистрационному номеру, одна персоналия,
	соответствующая указанному номеру, была обнаружена, но ни один из видов, которым она
	принадлежит, не соответствует заданному.

	DEV: mnem(PPERR\_PERSONBYREGNKIND),
	locfunc(PPObjPerson::GetListByRegNumber)
	}
	\ppymsg{1250}{Персоналии по регистру xxx не соответствуют заданному виду}{
	При попытке идентифицировать персоналию по регистрационному номеру, несколько персоналий,
	соответствующих указанному номеру, были обнаружены, но ни один из видов, которым они
	принадлежат, не соответствует заданному.

	DEV: mnem(PPERR\_PERSONSBYREGNKIND), locfunc(PPObjPerson::GetListByRegNumber)
	}
	\ppymsg{1343}{Заданный вид котировки не соответствует категории}{
	Сообщение появляется при использовании интерфейса IPapyrusQuot при попытке  установить
	значение котировки с категорией \qu{Матрица} или \qu{Контрактная цена} и видом котировки, не
	соответствующем этой категории.

	DEV: mnen(PPERR\_UNMATCHEDQUOTKIND)
	}
	\ppymsg{DBError 103}{Ошибка открытия файла для резервного копирования}{
	При создании резервной копии базы данных не удалось открыть для чтения один из файлов,
	предназначенных для копирования (вероятнее всего файл открыт для записи каким-либо
	приложением или файл прихвачен фантомным сеансом на серверы базы данных).
	Возможный вариант решения проблемы - перезагрузка сервера базы данных.

	DEV: mnem(SDBERR\_BU\_SRCFOPEN), locfunc(DBBackup::GetFileParams)
	}
	\ppymsg{нет кода}{Добавляемый в документ товар должен иметь код по статье}{
	В соглашении с поставщиком или покупателем, связанном со статьей контрагента по документу
	установлен флаг \dlgflag{В документы добавлять только товары, имеющие код по статье}.
	При этом, пользователь пытается добавить в документ строку с товаром, который не имеет кода, связанного с контрагентом по документу.

	Подробно соглашения с клиентами описаны на стр.~\pageref{sec-cliagt}, соглашения с поставщиками - на стр.~\pageref{sec-supplagt}.

	DEV: mnem(PPERR\_BILLGOODSRESTRICTBYARCODE) locfunc(PPBillPacket::CheckGoodsForRestrictions)
	}

	\subsection{Уведомительные сообщения}

	\ppymsg{38}{Неоднозначный альтернативный товар в выборке излишков по кассовым сессиям}{
	Это сообщение появляется при попытке редактирования подстановки альтернативного товара
	в излишках по кассовым сессиям. Причинной сообщения является то, что, излишки рассчитаны
	по выборке кассовых сессий, причем в двух или более сессиях из выборки реализована
	подстановка разных альтернативных товаров.
	Пример: в кассовой сессии за 1 марта вместо товара \qu{БАНАНЫ} подставлен альтернативный
	товар \qu{БАНАНЫ ЭКВАДОР}. В кассовой сессии за 3 марта вместо товара \qu{БАНАНЫ} подставлен
	товар \qu{БАНАНЫ КОЛУМБИЯ}. Выборка кассовых сессий взята за период с 1 по 3 марта. Излишки
	по кассовым сессиям рассчитаны по всей выборке. При попытке просмотра подстановки
	альтернативного товара по товару \qu{БАНАНЫ} появится описываемое сообщение.

	DEV: mnem(PPINF\_AMBIGUITYCSEXCALTGOODS), locfunc(PPViewCSessExc::SetAltGoods)
	}

	\subsection{Сообщения при приеме данных из другого раздела базы данных}

	\ppymsg{нет кода}{Ошибка разрешения ссылки объекта (Type = \#, ID = \#)}{
	Ссылочный объект не был передан вместе с тем объектом, который от него зависит, а также
	нет информации о синхронизации этого объекта в таблице синхронизации. Наиболее частая
	причина - висячая ссылка на объект в базе-отправителе. Решение - восстановление ссылки в
	базе - отправителе (следует проконсультироваться со служббой поддержки).

	DEV: mnem(PPTXT\_RCVREFUNRESOLVED), locfunc(PPObjectTransmit::RestoreObj)
	}
	\ppymsg{нет кода}{Ошибка разрешения ссылки объекта (Type = \#, ID = \#)}{
	Ссылочный объект не был передан вместе с тем объектом, который от него зависит, а также
	нет информации о синхронизации этого объекта в таблице синхронизации. Наиболее частая
	причина - висячая ссылка на объект в базе-отправителе. Решение - восстановление ссылки в
	базе - отправителе (следует проконсультироваться со служббой поддержки).

	DEV: mnem(PPTXT\_RCVREFUNRESOLVED), locfunc(PPObjectTransmit::RestoreObj)
	}
	\ppymsg{нет кода}{Ошибка акцепта документа}{
	Не удалось провести документ, принятый из другого раздела БД.
	После этого сообщения в строке выводится идентификатор документа в базе-отправителе, а также
	номер документа и дата. Далее идет текст сообщения об ошибке.

	DEV: mnem(PPTXT\_ERRACCEPTBILL), locfunc(PPObjBill::Write)
	}
	\ppymsg{нет кода}{Ошибка конвертации документа}{
	Не удалось преобразовать пакет документа, принятый из другого раздела БД, в формат,
	необходимый для сохранения в базе данных.
	После этого сообщения в строке выводится идентификатор документа в базе-отправителе, а
	также номер документа и дата. Далее идет текст сообщения об ошибке.

	DEV: mnem(PPTXT\_ERRACCEPTBILL\_CONVERT), locfunc(PPObjBill::Write)
	}

\chapter{Глоссарий\label{ch-glossary}}


	\paragraph{Алиас счета}
	Объект, служащий посредником для подстановки бухгалтерских счетов в шаблоны проводок по
	документам, в зависимости от аналитических статей, применяемых в документе.

	\paragraph{База данных}
	Совокупность файлов, логически объединенных для хранения информации.

	\paragraph{Вид котировки}
	Логически объединенная группа котировок. С видом котировки может быть ассоциирован набор
	атрибутов, определяющих некоторые из условий формирования цен по котировкам, относящимся
	к этому виду.

	\paragraph{Группа товара}
	Набор товаров, объединенных общими свойствами, специфичными для данного предприятия.
	Например: \qu{Овощные консервы}, \qu{Телевизоры}, \qu{Мягкая мебель}.

	\paragraph{Документ}
	Отражение одной операции в базе данных.

	\paragraph{Документ бухгалтерский}
	Документ, отражающий бухгалтерскую операцию. Например: приход денег в кассу, выдача денег
	под отчет.

	\paragraph{Документ долговой}
	Документ, требующий оплаты. Долговые документы относятся к видам операций, имеющий признак
	\qu{Требует платежного документа}.

	\paragraph{Документ зачетный}
	Документ, относящийся к виду операций, имеющему признак \qu{Зачетная операция}. Зачетный
	документ может оплачивать один или несколько долговых документов посредством
	зачитывающих оплат.

	\paragraph{Документ товарный}
	Документ, отражающий товарную операцию.

	Например: приходная накладная, акт переоценки, заказ товара.

	\paragraph{Драфт-документ}
	Документ, необходимый для временного хранения информации о движении товаров. Драфт-документ
	прямо не участвует в учете (не изменяет товарных остатков, не формирует бухгалтерских
	проводок, не учитывает заказы). Главное назначение драфт-документов состоит в сохранении
	информации о перемещении товаров за определенный период времени, для того, чтобы затем быть
	превращенными в учетные документы.

	\paragraph{Зачет обратный}
	Закрытие долгового документа через один или несколько зачетных документов. Обратный зачет
	предполагает, что инициатором зачета является долговой документ.

	\paragraph{Зачет прямой}
	Закрытие из зачетного документа одного или нескольких долговых документов. Другими словами,
	при прямом зачете инициатором процесса зачета является зачетный документ.

	\paragraph{Зачитывающая оплата}
	Документ, относящийся к типу операций \qu{Оплата} и являющийся посредником в оплате долгового
	документа зачетным документом. Зачитывающая оплата одновременно связана и с долговым и с
	зачетным документами.

	\paragraph{КАД} Контроллер анализа данных. Компонент системы \ppybrand{}, отвечающий за построение,
	отображение табличных данных и за реакцию на управляющие действия пользователя над этими данными.

	\paragraph{Компонент составного товара}
	Товар, который является или может являться частью составного товара. Компонент сам может
	быть составным товаром, и просто товаром.

	\paragraph{Контрагент}
	Персоналия или склад, с которым взаимодействует предприятие в ходе одной операции. В
	системе \ppybrand{} контрагенты представлены статьями аналитического учета, которые, в свою
	очередь, могут ссылаться на другие объекты (персоналии, склады, бухгалтерские счета и т.д.).
	Котировка	Величина, ассоциированная с товаром, и регламентирующая цену на этот товар,
	предоставляемую покупателю при определенных условиях.

	\paragraph{Лот}
	Партия одного товара, поступившая за одну операцию. Лот характеризуется собственно
	товаром, датой поступления, поставщиком, поступившим количеством, остатком, ценой
	поступления, ценой реализации и некоторыми другими параметрами.

	\paragraph{Лот оригинальный}
	Лот, не имеющий родительского лота. В общепринятом смысле, оригинальный лот - это тот,
	который поступил в распределительную систему организации из вне (сформирован документом
	прихода).  Оригинальному лоту можно противопоставить лот, который сформирован внутренней
	передачей на складе получателе. Такой лот будет иметь связку с родительским лотом,
	находящимся на складе-отправителе.

	\paragraph{Лота состав}
	Динамическая характеристика лота, определяющая компоненты, которые были использованы
	для его формирования. Лот, поступивший от поставщика, имеет пустой состав. Не пустой
	состав лота может быть только в случае, если лот был скомплектован документом модификации
	из набора компонентов.

	Состав лота может меняться только в результате декомплектации либо рекомплектации.

	\paragraph{Матрица товарная}
	Специализированная структура, объединяющая выборку товаров, возможно посредством товарных
	групп. Применяется для ограничения списка товаров, используемом на том или ином складе
	предприятия. Принадлежность товара матрице определяется в привязке к складу (ко всем
	складам) и характеризуется одним из трех возможных значений:
	\begin{itemize}
		\item принадлежит
		\item на принадлежит
		\item не определено
	\end{itemize}

	Для товаров, имеющих признак принадлежности матрице \qu{не определено}, действует правило
	наследования этого признака от родительской группы.

	Для альтернативных групп принадлежность матрице не применима.

	\paragraph{Номинальная сумма}
	Сумма, определяющая стоимость документа. Документ может содержать множество различных сумм.
	Однако, как правило, одна из этих сумм выделяется как основная. Чаще всего это та сумма,
	которая определяет общую сумму операции или сделки, отраженной документом.

	\paragraph{Операция}
	Отдельная транзакция учета, изменяющая состояние предприятия.

	\paragraph{Операция бухгалтерская}
	Категория операций, изменяющих только состояние бухгалтерского баланса предприятия.

	\paragraph{Операция товарная}
	Категория операций, изменяющих структурный и количественный состав материальных и
	нематериальных активов предприятия.

	\paragraph{Отчет альтернативный}
	Отчет, который может быть распечатан наряду со стандартным или локальным простым выбором в
	поле \qu{Вид отчета} диалога печати, описанного в предыдущем пункте. В отличии от
	локального отчета, который замещает стандартный, альтернативный отчет не лишает
	пользователя возможности пользоваться стандартной формой.

	\paragraph{Отчет локальный}
	Форма отчета, имеющая имя, совпадающее с именем стандартного отчета, но отличающееся по
	виду от стандартной формы и хранимая в специальном подкаталоге BIN/RPT/LOCAL.
	При печати какого-либо отчета, система ищет файл этого отчета сначала в каталоге
	BIN/RPT/LOCAL. Если искомая форма найдена в этом каталоге, то для печати используется она,
	в противном случае используется стандартная форма.

	При обновлении версии системы каталог локальных форм не затрагивается, по этому, измененные
	формы отчетов утеряны не будут.

	\paragraph{Отчет стандартный}
	Форма отчета, поставляемая вместе с дистрибутивом системы. Все стандартные отчеты
	хранятся в каталоге BIN/RPT.

	При обновлении версии системы стандартные отчеты могут быть заменены процедурой инсталляции
	без предупреждения. По этому, если вы меняете какой-либо из стандартных отчетов, не
	следует оставлять его в этом каталоге.

	\paragraph{Персоналии}
	Более или менее строго персоналии можно определить как субъекты гражданского права.
	Если быть проще, то персоналии - это физические и юридические лица, с которыми
	взаимодействует предприятие (включая и само предприятие).

	\paragraph{Приоритет котировки}
	Порядок, по которому величина котировки применяется при назначении цены покупателю.
	Обычно, чем более четко определены условия котировки, тем больший приоритет она имеет.
	Так, котировка на товар имеет приоритет перед котировкой на товарную группу, а котировка
	для заданного клиента имеет более высокий приоритет по сравнению с котировкой для всех
	клиентов.

	\paragraph{Процессор}
	Некоторый ресурс (станок, сотрудник, гостиничный номер и т.д.), использование которого
	в каждый момент времени ограничено его производительностью. Работа процессора учитывается
	по времени и по используемой производительности.

	\paragraph{Пул документов}
	Набор документов, объединяемых некоторыми общими свойствами и привязанных к документу,
	имеющему тип операции \qu{Пул документов}.

	\paragraph{Реестр документов}
	Список документов, соответствующих заданным условиям выборки по фильтру.

	\paragraph{Синхронизация объекта}
	Синхронизация одного и того же объекта данных между разделами базы данных. При разделении
	базы данных система должна иметь информацию о том, как идентифицируется один и тот же
	объект данных (товар, документ, вид операции и т.д.) в разных разделах. Для этого используется
	таблица ObjSync, хранящая связи между идентификаторами таких объектов.

	\paragraph{Синхронизация объекта контекстная}
	Идентификация объекта, принятого из другого раздела базы данных, но не зарегистрированного
	в таблице синхронизации, как эквивалентного уже существующему объекту в разделе-приемнике.
	Контекстная синхронизация используется, например, при синхронизации товаров (по наименованию,
	штрихкоду), и позволяет избежать дублирования объектов.
	После установления контекстной синхронизации система регистрирует новый объект в таблице
	синхронизации и, в дальнейшем, работает с ним в обычном режиме.

	\paragraph{Склад}
	Место хранения товаров, по которому ведется учет. Складом может считаться собственно товарный
	склад, магазин, торговый киоск, производственный цех, контейнер и любое другое место. Важно
	лишь то, что  в системе ведется учет остатков товаров по этому месту.

	\paragraph{Состояние предприятия}
	Совокупность внутренних и внешних параметров, характеризующих предприятие с точки зрения
	хозяйственного учета.

	\paragraph{Счет бухгалтерский терминальный}
	Бухгалтерский счет, непосредственно по которому ведутся бухгалтерские проводки. В качестве
	терминального счета может выступать как сочетание {счет.субсчет.статья}, так и просто {счет}
	либо {счет.субсчет}, даже если по счету кроме того ведется аналитика (это нежелательная
	ситуация, однако система это допускает).

	\paragraph{Таблица продаж}
	Суммированные данные о продажах по каждому товару на каждом складе и за каждый день,
	необходимые для прогнозирования спроса и анализа статистики продаж.

	\paragraph{Технологическая сессия}
	Период использования процессора, в течении которого он непрерывно работает по одной или
	нескольким технологиям (в зависимости от производительности). Технологическая сессия
	является минимальной учетной операцией процессора.

	\paragraph{Технологическая суперсессия}
	Сессия, логически объединяющая несколько простых технологических сессий. Простой
	производственной интерпретацией технологической суперсессии может быть рабочая смена.

	\paragraph{Технология}
	Способ обработки некоторого товара на процессоре. Обычно технология связывает процессор
	(группу процессоров), производимый или расходуемый товар и структуру этого товара.

	\paragraph{Тип величины котировки}
	Способ задания величины котировки. На текущий момент существуют следующие типы величины
	котировки:

	\begin{itemize}
		\item 	Абсолютная котировка
		\item 	Блокированная котировка
		\item 	Относительная котировка от цены поступления
		\item 	Относительная котировка от цены реализации
		\item 	Относительная котировка от наценки
	\end{itemize}
	Последние три типа величин котировки обобщенно назваются относительными котировками.

	\paragraph{Тип товара}
	Категория товаров, обладающая определенными признаками, объединенная общностью
	характеристик учета.

	\paragraph{Товар}
	Материальные или нематериальные активы (за исключением финансовых) предприятия, по
	которым ведется количественный учет.

	\paragraph{Товар составной}
	Товар, который может быть скомплектован либо разукомплектован.

	\paragraph{Товарный документ}
	Документ, отражающий товарную операцию. Например: приходная накладная, акт переоценки,
	заказ товара.

	\paragraph{Торговая марка}
	Атрибут товара, отражающий набор маркетинговых мероприятий, предпринимаемых его
	производителем или владельцем торговой марки для продвижения этого товара на рынках.

	Синонимом этого понятия является слово брэнд (brand).

	Характерными примерами торговых марок являются: Coca-Cola, Смирнофф и т.д.

	\paragraph{Торговая марка неформальная}
	Некоторые товары не имеют четко выраженной торговой марки. Причиной этому может быть
	либо отсутствие желания производителя прилагать дорогостоящие усилия по продвижению
	своих товаров, либо намеренное нежелание фигурировать в явном виде в качестве производителя
	этого товара.

	В таких случаях, для классификации товара в целях учета, приходится использовать любую
	доступную характерную особенность товара, позволяющую отличить его от аналогов. Например,
	город, в котором товар произведен, рисунок на этикетке и т.д. Именно эта особенность и
	есть \qu{торговая марка неформальная}.

	\paragraph{Цена контрактная}
	Цена, по которой поставщик обязался поставлять товар. С контрактными ценами тесно связано
	понятие допустимых отклонений от контрактных цен.

	В системе контрактные цены представлены специальным видом товарных котировок.

	\paragraph{Цена поступления}
	Цена одной торговой единицы товара, по которой этот товар закуплен у поставщика. Если
	не оговорено обратное, этот термин подразумевает цену со всеми налогами.

	\paragraph{Цена реализации}
	Цена одной торговой единицы товара, по которой этот товар предполагается продавать
	покупателю. Если не оговорено обратное, то этот термин подразумевает цену, включающую
	все налоги.

	\paragraph{Цена учетная}
	Цена поступления или цена реализации, связанная с конкретным лотом. Учетная цена
	поступления означает, что лот пришел от поставщика по этой цене. Напротив, учетная
	цена реализации не обязательно означает, что товар с этого лота будет продан по этой
	цене. Как правило, учетная цена реализации является типичной ценой продажи одной торговой
	единицы товара. Так как в системе учет партионный, на любой момент времени, вообще
	говоря, по одному товару может быть несколько значений учетной цены поступления и учетной
	цены реализации.

	Понятие учетной цены позволяет, кроме всего прочего, организовать сходимость бухгалтерского
	и товарного учета в системе.

\printindex

%\begin{theindex}
%\input{ppmanual.idx}
%\end{theindex}

%\begin{Verbatim}[fontfamily=courier, fontsize=\small, frame=single]
%\end{Verbatim}

% \chapter{}
% \section{}
% \subsection{}
% \subsubsection{}
% \paragraph{}
% \subparagraph{}
%
%	\indent\keyb{
%
%
%\ppypict{brw-}{}
%
%
%
%~\ref{pic-dlg-009}
%
%
%\newline
%
% Длина строки - до 90 символов
% 1. Расставляем заголовки
% 2. Приводим в порядок списки
% 3. Замечания \ppynote{}
%    Замечание в таблице \ppynotewidth{0.6}{}
% 4. Примеры: \ppyexample{}
%    Пример с заголовком: \ppyexampletitle{заголовок примера}{}
% 5. Таблица описания диалогов и т.д. (2 колонки)
%    \begin{ppytable2} \end{ppytable2}
%			текст-колонки-1 &
%    	текст-колонки-2 \eor
%
%    	текст-колонки-1 &
%    	текст-колонки-2 %\eor
% 6. Таблица описания действий в КАД'ах (3 колонки. средняя - коды клавишь)
%    \begin{ppytable-cda-act} \end{ppytable-cda-act}
%    	текст-колонки-1 & код клавиши &
%    	текст-колонки-3 \eor
%
%    	текст-колонки-1 & код клавиши &
%    	текст-колонки-3 \eor  %
%
%
% 7. Установка символьных стилей:
%     Papyrus - \ppybrand{}
%     Клавиши - \keyb{}
%     Кнопки - \dlgbutton{}
%     Пункт меню - \ppymenu{Админ\rdir Процие конфигурации}
%     Кавычки - \qu{}
%			флаг - 	\dlgflag{
%     Слово "броузер" заменяем на "таблица"
%

\end{document}
